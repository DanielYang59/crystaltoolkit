window.crystal_toolkit=function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=104)}([function(e,t,i){var r=i(58),n="object"==typeof self&&self&&self.Object===Object&&self,o=r||n||Function("return this")();e.exports=o},function(e,t){var i=Array.isArray;e.exports=i},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,i){var r=i(115),n=i(120);e.exports=function(e,t){var i=n(e,t);return r(i)?i:void 0}},function(e,t,i){var r=i(6),n=i(116),o=i(117),a="[object Null]",s="[object Undefined]",l=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?s:a:l&&l in Object(e)?n(e):o(e)}},function(e,t,i){var r=i(0).Symbol;e.exports=r},function(e,t){e.exports=function(e,t){var i=-1,r=e.length;for(t||(t=Array(r));++i<r;)t[i]=e[i];return t}},function(e,t,i){var r=i(5),n=i(3),o="[object Symbol]";e.exports=function(e){return"symbol"==typeof e||n(e)&&r(e)==o}},function(e,t,i){var r=i(75),n=i(38);e.exports=function(e,t,i,o){var a=!i;i||(i={});for(var s=-1,l=t.length;++s<l;){var u=t[s],h=o?o(i[u],e[u],u,i,e):void 0;void 0===h&&(h=e[u]),a?n(i,u,h):r(i,u,h)}return i}},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,i){var r=i(179),n=i(44),o=i(180),a=i(181),s=i(57),l=i(5),u=i(60),h=u(r),c=u(n),d=u(o),p=u(a),f=u(s),m=l;(r&&"[object DataView]"!=m(new r(new ArrayBuffer(1)))||n&&"[object Map]"!=m(new n)||o&&"[object Promise]"!=m(o.resolve())||a&&"[object Set]"!=m(new a)||s&&"[object WeakMap]"!=m(new s))&&(m=function(e){var t=l(e),i="[object Object]"==t?e.constructor:void 0,r=i?u(i):"";if(r)switch(r){case h:return"[object DataView]";case c:return"[object Map]";case d:return"[object Promise]";case p:return"[object Set]";case f:return"[object WeakMap]"}return t}),e.exports=m},function(e,t,i){var r=i(8),n=1/0;e.exports=function(e){if("string"==typeof e||r(e))return e;var t=e+"";return"0"==t&&1/e==-n?"-0":t}},function(e,t){e.exports=function(e){return e}},function(e,t,i){var r=i(5),n=i(2),o="[object AsyncFunction]",a="[object Function]",s="[object GeneratorFunction]",l="[object Proxy]";e.exports=function(e){if(!n(e))return!1;var t=r(e);return t==a||t==s||t==o||t==l}},function(e,t,i){var r=i(16),n=i(2);e.exports=function(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var i=r(e.prototype),o=e.apply(i,t);return n(o)?o:i}}},function(e,t,i){var r=i(2),n=Object.create,o=function(){function e(){}return function(t){if(!r(t))return{};if(n)return n(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}();e.exports=o},function(e,t){e.exports=function(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}},function(e,t){var i=9007199254740991,r=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var n=typeof e;return!!(t=null==t?i:t)&&("number"==n||"symbol"!=n&&r.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t,i){var r=i(76),n=i(77),o=i(23);e.exports=function(e){return o(e)?r(e):n(e)}},function(e,t,i){var r=i(145),n=i(3),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,l=r(function(){return arguments}())?r:function(e){return n(e)&&a.call(e,"callee")&&!s.call(e,"callee")};e.exports=l},function(e,t,i){(function(e){var r=i(0),n=i(146),o=t&&!t.nodeType&&t,a=o&&"object"==typeof e&&e&&!e.nodeType&&e,s=a&&a.exports===o?r.Buffer:void 0,l=(s?s.isBuffer:void 0)||n;e.exports=l}).call(this,i(39)(e))},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t,i){var r=i(14),n=i(41);e.exports=function(e){return null!=e&&n(e.length)&&!r(e)}},function(e,t,i){var r=i(25),n=i(155),o=i(156),a=i(157),s=i(158),l=i(159);function u(e){var t=this.__data__=new r(e);this.size=t.size}u.prototype.clear=n,u.prototype.delete=o,u.prototype.get=a,u.prototype.has=s,u.prototype.set=l,e.exports=u},function(e,t,i){var r=i(150),n=i(151),o=i(152),a=i(153),s=i(154);function l(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}l.prototype.clear=r,l.prototype.delete=n,l.prototype.get=o,l.prototype.has=a,l.prototype.set=s,e.exports=l},function(e,t,i){var r=i(10);e.exports=function(e,t){for(var i=e.length;i--;)if(r(e[i][0],t))return i;return-1}},function(e,t,i){var r=i(4)(Object,"create");e.exports=r},function(e,t,i){var r=i(168);e.exports=function(e,t){var i=e.__data__;return r(t)?i["string"==typeof t?"string":"hash"]:i.map}},function(e,t,i){var r=i(76),n=i(173),o=i(23);e.exports=function(e){return o(e)?r(e,!0):n(e)}},function(e,t){e.exports=window.React},function(e,t,i){e.exports=i(106)()},function(e,t,i){var r=i(55),n=i(121),o=i(122),a=i(61),s=i(140),l=i(65),u=i(141),h=i(67),c=i(69),d=i(73),p="Expected a function",f=1,m=2,v=8,g=16,y=32,_=64,b=Math.max;e.exports=function(e,t,i,x,w,S,M,T){var A=t&m;if(!A&&"function"!=typeof e)throw new TypeError(p);var C=x?x.length:0;if(C||(t&=~(y|_),x=w=void 0),M=void 0===M?M:b(d(M),0),T=void 0===T?T:d(T),C-=w?w.length:0,t&_){var L=x,N=w;x=w=void 0}var P=A?void 0:l(e),k=[e,t,i,x,w,L,N,S,M,T];if(P&&u(k,P),e=k[0],t=k[1],i=k[2],x=k[3],w=k[4],!(T=k[9]=void 0===k[9]?A?0:e.length:b(k[9]-C,0))&&t&(v|g)&&(t&=~(v|g)),t&&t!=f)E=t==v||t==g?o(e,t,T):t!=y&&t!=(f|y)||w.length?a.apply(void 0,k):s(e,t,i,x);else var E=n(e,t,i);return c((P?r:h)(E,k),e,t)}},function(e,t,i){var r=i(16),n=i(34),o=4294967295;function a(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=o,this.__views__=[]}a.prototype=r(n.prototype),a.prototype.constructor=a,e.exports=a},function(e,t){e.exports=function(){}},function(e,t,i){var r=i(132),n=i(68)(r);e.exports=n},function(e,t){e.exports=function(e,t){for(var i=-1,r=null==e?0:e.length;++i<r&&!1!==t(e[i],i,e););return e}},function(e,t){var i="__lodash_placeholder__";e.exports=function(e,t){for(var r=-1,n=e.length,o=0,a=[];++r<n;){var s=e[r];s!==t&&s!==i||(e[r]=i,a[o++]=r)}return a}},function(e,t,i){var r=i(70);e.exports=function(e,t,i){"__proto__"==t&&r?r(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,i){var r=i(147),n=i(22),o=i(42),a=o&&o.isTypedArray,s=a?n(a):r;e.exports=s},function(e,t){var i=9007199254740991;e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=i}},function(e,t,i){(function(e){var r=i(58),n=t&&!t.nodeType&&t,o=n&&"object"==typeof e&&e&&!e.nodeType&&e,a=o&&o.exports===n&&r.process,s=function(){try{var e=o&&o.require&&o.require("util").types;return e||a&&a.binding&&a.binding("util")}catch(e){}}();e.exports=s}).call(this,i(39)(e))},function(e,t){var i=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||i)}},function(e,t,i){var r=i(4)(i(0),"Map");e.exports=r},function(e,t,i){var r=i(160),n=i(167),o=i(169),a=i(170),s=i(171);function l(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}l.prototype.clear=r,l.prototype.delete=n,l.prototype.get=o,l.prototype.has=a,l.prototype.set=s,e.exports=l},function(e,t,i){var r=i(176),n=i(81),o=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,s=a?function(e){return null==e?[]:(e=Object(e),r(a(e),function(t){return o.call(e,t)}))}:n;e.exports=s},function(e,t){e.exports=function(e,t){for(var i=-1,r=t.length,n=e.length;++i<r;)e[n+i]=t[i];return e}},function(e,t,i){var r=i(78)(Object.getPrototypeOf,Object);e.exports=r},function(e,t,i){var r=i(85);e.exports=function(e){var t=new e.constructor(e.byteLength);return new r(t).set(new r(e)),t}},function(e,t,i){var r=i(198),n=i(3);e.exports=function e(t,i,o,a,s){return t===i||(null==t||null==i||!n(t)&&!n(i)?t!=t&&i!=i:r(t,i,o,a,e,s))}},function(e,t,i){var r=i(1),n=i(8),o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;e.exports=function(e,t){if(r(e))return!1;var i=typeof e;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=e&&!n(e))||a.test(e)||!o.test(e)||null!=t&&e in Object(t)}},function(e,t){e.exports=function(e,t){for(var i=-1,r=null==e?0:e.length,n=Array(r);++i<r;)n[i]=t(e[i],i,e);return n}},function(e,t,i){var r=i(13),n=i(99),o=i(35);e.exports=function(e,t){return o(n(e,t,r),e+"")}},function(e,t){e.exports={}},function(e,t,i){var r=i(13),n=i(56),o=n?function(e,t){return n.set(e,t),e}:r;e.exports=o},function(e,t,i){var r=i(57),n=r&&new r;e.exports=n},function(e,t,i){var r=i(4)(i(0),"WeakMap");e.exports=r},function(e,t,i){(function(t){var i="object"==typeof t&&t&&t.Object===Object&&t;e.exports=i}).call(this,i(59))},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t){var i=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return i.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t,i){var r=i(62),n=i(63),o=i(123),a=i(15),s=i(64),l=i(72),u=i(139),h=i(37),c=i(0),d=1,p=2,f=8,m=16,v=128,g=512;e.exports=function e(t,i,y,_,b,x,w,S,M,T){var A=i&v,C=i&d,L=i&p,N=i&(f|m),P=i&g,k=L?void 0:a(t);return function d(){for(var p=arguments.length,f=Array(p),m=p;m--;)f[m]=arguments[m];if(N)var v=l(d),g=o(f,v);if(_&&(f=r(f,_,b,N)),x&&(f=n(f,x,w,N)),p-=g,N&&p<T){var E=h(f,v);return s(t,i,e,d.placeholder,y,f,E,S,M,T-p)}var D=C?y:this,O=L?D[t]:t;return p=f.length,S?f=u(f,S):P&&p>1&&f.reverse(),A&&M<p&&(f.length=M),this&&this!==c&&this instanceof d&&(O=k||a(O)),O.apply(D,f)}}},function(e,t){var i=Math.max;e.exports=function(e,t,r,n){for(var o=-1,a=e.length,s=r.length,l=-1,u=t.length,h=i(a-s,0),c=Array(u+h),d=!n;++l<u;)c[l]=t[l];for(;++o<s;)(d||o<a)&&(c[r[o]]=e[o]);for(;h--;)c[l++]=e[o++];return c}},function(e,t){var i=Math.max;e.exports=function(e,t,r,n){for(var o=-1,a=e.length,s=-1,l=r.length,u=-1,h=t.length,c=i(a-l,0),d=Array(c+h),p=!n;++o<c;)d[o]=e[o];for(var f=o;++u<h;)d[f+u]=t[u];for(;++s<l;)(p||o<a)&&(d[f+r[s]]=e[o++]);return d}},function(e,t,i){var r=i(124),n=i(67),o=i(69),a=1,s=2,l=4,u=8,h=32,c=64;e.exports=function(e,t,i,d,p,f,m,v,g,y){var _=t&u;t|=_?h:c,(t&=~(_?c:h))&l||(t&=~(a|s));var b=[e,t,p,_?f:void 0,_?m:void 0,_?void 0:f,_?void 0:m,v,g,y],x=i.apply(void 0,b);return r(e)&&n(x,b),x.placeholder=d,o(x,e,t)}},function(e,t,i){var r=i(56),n=i(125),o=r?function(e){return r.get(e)}:n;e.exports=o},function(e,t,i){var r=i(16),n=i(34);function o(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=void 0}o.prototype=r(n.prototype),o.prototype.constructor=o,e.exports=o},function(e,t,i){var r=i(55),n=i(68)(r);e.exports=n},function(e,t){var i=800,r=16,n=Date.now;e.exports=function(e){var t=0,o=0;return function(){var a=n(),s=r-(a-o);if(o=a,s>0){if(++t>=i)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}},function(e,t,i){var r=i(130),n=i(131),o=i(35),a=i(134);e.exports=function(e,t,i){var s=t+"";return o(e,n(s,a(r(s),i)))}},function(e,t,i){var r=i(4),n=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=n},function(e,t,i){var r=i(135);e.exports=function(e,t){return!(null==e||!e.length)&&r(e,t,0)>-1}},function(e,t){e.exports=function(e){return e.placeholder}},function(e,t,i){var r=i(142);e.exports=function(e){var t=r(e),i=t%1;return t==t?i?t-i:t:0}},function(e,t,i){var r=i(9),n=i(19);e.exports=function(e,t){return e&&r(t,n(t),e)}},function(e,t,i){var r=i(38),n=i(10),o=Object.prototype.hasOwnProperty;e.exports=function(e,t,i){var a=e[t];o.call(e,t)&&n(a,i)&&(void 0!==i||t in e)||r(e,t,i)}},function(e,t,i){var r=i(144),n=i(20),o=i(1),a=i(21),s=i(18),l=i(40),u=Object.prototype.hasOwnProperty;e.exports=function(e,t){var i=o(e),h=!i&&n(e),c=!i&&!h&&a(e),d=!i&&!h&&!c&&l(e),p=i||h||c||d,f=p?r(e.length,String):[],m=f.length;for(var v in e)!t&&!u.call(e,v)||p&&("length"==v||c&&("offset"==v||"parent"==v)||d&&("buffer"==v||"byteLength"==v||"byteOffset"==v)||s(v,m))||f.push(v);return f}},function(e,t,i){var r=i(43),n=i(148),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return n(e);var t=[];for(var i in Object(e))o.call(e,i)&&"constructor"!=i&&t.push(i);return t}},function(e,t){e.exports=function(e,t){return function(i){return e(t(i))}}},function(e,t,i){var r=i(24),n=i(36),o=i(75),a=i(74),s=i(172),l=i(80),u=i(7),h=i(175),c=i(177),d=i(83),p=i(178),f=i(11),m=i(182),v=i(183),g=i(87),y=i(1),_=i(21),b=i(187),x=i(2),w=i(189),S=i(19),M=1,T=2,A=4,C="[object Arguments]",L="[object Function]",N="[object GeneratorFunction]",P="[object Object]",k={};k[C]=k["[object Array]"]=k["[object ArrayBuffer]"]=k["[object DataView]"]=k["[object Boolean]"]=k["[object Date]"]=k["[object Float32Array]"]=k["[object Float64Array]"]=k["[object Int8Array]"]=k["[object Int16Array]"]=k["[object Int32Array]"]=k["[object Map]"]=k["[object Number]"]=k[P]=k["[object RegExp]"]=k["[object Set]"]=k["[object String]"]=k["[object Symbol]"]=k["[object Uint8Array]"]=k["[object Uint8ClampedArray]"]=k["[object Uint16Array]"]=k["[object Uint32Array]"]=!0,k["[object Error]"]=k[L]=k["[object WeakMap]"]=!1,e.exports=function e(t,i,E,D,O,R){var F,I=i&M,B=i&T,U=i&A;if(E&&(F=O?E(t,D,O,R):E(t)),void 0!==F)return F;if(!x(t))return t;var V=y(t);if(V){if(F=m(t),!I)return u(t,F)}else{var z=f(t),G=z==L||z==N;if(_(t))return l(t,I);if(z==P||z==C||G&&!O){if(F=B||G?{}:g(t),!I)return B?c(t,s(F,t)):h(t,a(F,t))}else{if(!k[z])return O?t:{};F=v(t,z,I)}}R||(R=new r);var j=R.get(t);if(j)return j;if(R.set(t,F),w(t))return t.forEach(function(r){F.add(e(r,i,E,r,t,R))}),F;if(b(t))return t.forEach(function(r,n){F.set(n,e(r,i,E,n,t,R))}),F;var W=U?B?p:d:B?keysIn:S,H=V?void 0:W(t);return n(H||t,function(r,n){H&&(r=t[n=r]),o(F,n,e(r,i,E,n,t,R))}),F}},function(e,t,i){(function(e){var r=i(0),n=t&&!t.nodeType&&t,o=n&&"object"==typeof e&&e&&!e.nodeType&&e,a=o&&o.exports===n?r.Buffer:void 0,s=a?a.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var i=e.length,r=s?s(i):new e.constructor(i);return e.copy(r),r}}).call(this,i(39)(e))},function(e,t){e.exports=function(){return[]}},function(e,t,i){var r=i(47),n=i(48),o=i(46),a=i(81),s=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)r(t,o(e)),e=n(e);return t}:a;e.exports=s},function(e,t,i){var r=i(84),n=i(46),o=i(19);e.exports=function(e){return r(e,o,n)}},function(e,t,i){var r=i(47),n=i(1);e.exports=function(e,t,i){var o=t(e);return n(e)?o:r(o,i(e))}},function(e,t,i){var r=i(0).Uint8Array;e.exports=r},function(e,t,i){var r=i(49);e.exports=function(e,t){var i=t?r(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}},function(e,t,i){var r=i(16),n=i(48),o=i(43);e.exports=function(e){return"function"!=typeof e.constructor||o(e)?{}:r(n(e))}},function(e,t,i){var r=i(5),n=i(48),o=i(3),a="[object Object]",s=Function.prototype,l=Object.prototype,u=s.toString,h=l.hasOwnProperty,c=u.call(Object);e.exports=function(e){if(!o(e)||r(e)!=a)return!1;var t=n(e);if(null===t)return!0;var i=h.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&u.call(i)==c}},function(e,t,i){var r=i(90),n=i(201),o=i(91),a=1,s=2;e.exports=function(e,t,i,l,u,h){var c=i&a,d=e.length,p=t.length;if(d!=p&&!(c&&p>d))return!1;var f=h.get(e);if(f&&h.get(t))return f==t;var m=-1,v=!0,g=i&s?new r:void 0;for(h.set(e,t),h.set(t,e);++m<d;){var y=e[m],_=t[m];if(l)var b=c?l(_,y,m,t,e,h):l(y,_,m,e,t,h);if(void 0!==b){if(b)continue;v=!1;break}if(g){if(!n(t,function(e,t){if(!o(g,t)&&(y===e||u(y,e,i,l,h)))return g.push(t)})){v=!1;break}}else if(y!==_&&!u(y,_,i,l,h)){v=!1;break}}return h.delete(e),h.delete(t),v}},function(e,t,i){var r=i(45),n=i(199),o=i(200);function a(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new r;++t<i;)this.add(e[t])}a.prototype.add=a.prototype.push=n,a.prototype.has=o,e.exports=a},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t,i){var r=i(2);e.exports=function(e){return e==e&&!r(e)}},function(e,t){e.exports=function(e,t){return function(i){return null!=i&&i[e]===t&&(void 0!==t||e in Object(i))}}},function(e,t,i){var r=i(95),n=i(12);e.exports=function(e,t){for(var i=0,o=(t=r(t,e)).length;null!=e&&i<o;)e=e[n(t[i++])];return i&&i==o?e:void 0}},function(e,t,i){var r=i(1),n=i(51),o=i(96),a=i(97);e.exports=function(e,t){return r(e)?e:n(e,t)?[e]:o(a(e))}},function(e,t,i){var r=i(209),n=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,o=/\\(\\)?/g,a=r(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(n,function(e,i,r,n){t.push(r?n.replace(o,"$1"):i||e)}),t});e.exports=a},function(e,t,i){var r=i(211);e.exports=function(e){return null==e?"":r(e)}},function(e,t,i){var r=i(47),n=i(221);e.exports=function e(t,i,o,a,s){var l=-1,u=t.length;for(o||(o=n),s||(s=[]);++l<u;){var h=t[l];i>0&&o(h)?i>1?e(h,i-1,o,a,s):r(s,h):a||(s[s.length]=h)}return s}},function(e,t,i){var r=i(17),n=Math.max;e.exports=function(e,t,i){return t=n(void 0===t?e.length-1:t,0),function(){for(var o=arguments,a=-1,s=n(o.length-t,0),l=Array(s);++a<s;)l[a]=o[t+a];a=-1;for(var u=Array(t+1);++a<t;)u[a]=o[a];return u[t]=i(l),r(e,this,u)}}},function(e,t,i){var r=i(24),n=i(101),o=i(225),a=i(227),s=i(2),l=i(29),u=i(103);e.exports=function e(t,i,h,c,d){t!==i&&o(i,function(o,l){if(s(o))d||(d=new r),a(t,i,l,h,e,c,d);else{var p=c?c(u(t,l),o,l+"",t,i,d):void 0;void 0===p&&(p=o),n(t,l,p)}},l)}},function(e,t,i){var r=i(38),n=i(10);e.exports=function(e,t,i){(void 0===i||n(e[t],i))&&(void 0!==i||t in e)||r(e,t,i)}},function(e,t,i){var r=i(23),n=i(3);e.exports=function(e){return n(e)&&r(e)}},function(e,t){e.exports=function(e,t){if("__proto__"!=t)return e[t]}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Simple3DSceneComponent=t.GraphComponent=void 0;var r=o(i(105)),n=o(i(240));function o(e){return e&&e.__esModule?e:{default:e}}t.GraphComponent=r.default,t.Simple3DSceneComponent=n.default},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=i(30),o=l(n),a=l(i(31)),s=l(i(108));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return r.state={network:{}},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.Component),r(t,[{key:"render",value:function(){var e=this,t=this.props,i=t.graph,r=t.options;t.setProps;return o.default.createElement(s.default,{graph:i,options:r,getNetwork:function(t){return e.setState({network:t})}})}},{key:"componentWillUpdate",value:function(e,t){e.graph!==this.props.graph&&(this.state.network.nodes=e.graph.nodes,this.state.network.edges=e.graph.edges,this.forceUpdate(),this.state.network.fit())}}]),t}();t.default=u,u.propTypes={id:a.default.string,graph:a.default.object,options:a.default.object,setProps:a.default.func}},function(e,t,i){"use strict";var r=i(107);function n(){}e.exports=function(){function e(e,t,i,n,o,a){if(a!==r){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var i={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return i.checkPropTypes=n,i.PropTypes=i,i}},function(e,t,i){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=i(30),o=d(n),a=d(i(109)),s=d(i(232)),l=d(i(233)),u=d(i(237)),h=d(i(238)),c=d(i(31));function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.identifier;return i.updateGraph=i.updateGraph.bind(i),i.state={identifier:void 0!==r?r:h.default.v4()},i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.Component),r(t,[{key:"componentDidMount",value:function(){this.edges=new u.default.DataSet,this.edges.add(this.props.graph.edges),this.nodes=new u.default.DataSet,this.nodes.add(this.props.graph.nodes),this.updateGraph()}},{key:"shouldComponentUpdate",value:function(e,t){var i=!(0,s.default)(this.props.graph.nodes,e.graph.nodes),r=!(0,s.default)(this.props.graph.edges,e.graph.edges),n=!(0,s.default)(this.props.options,e.options),o=!(0,s.default)(this.props.events,e.events);if(i){var a=function(e,t){return e.id===t.id},u=(0,l.default)(this.props.graph.nodes,e.graph.nodes,a),h=(0,l.default)(e.graph.nodes,this.props.graph.nodes,a),c=(0,l.default)((0,l.default)(e.graph.nodes,this.props.graph.nodes,s.default),h);this.patchNodes({nodesRemoved:u,nodesAdded:h,nodesChanged:c})}if(r){var d=(0,l.default)(this.props.graph.edges,e.graph.edges,s.default),p=(0,l.default)(e.graph.edges,this.props.graph.edges,s.default);this.patchEdges({edgesRemoved:d,edgesAdded:p})}if(n&&this.Network.setOptions(e.options),o){var f=this.props.events||{},m=!0,v=!1,g=void 0;try{for(var y,_=Object.keys(f)[Symbol.iterator]();!(m=(y=_.next()).done);m=!0){var b=y.value;this.Network.off(b,f[b])}}catch(e){v=!0,g=e}finally{try{!m&&_.return&&_.return()}finally{if(v)throw g}}f=e.events||{};var x=!0,w=!1,S=void 0;try{for(var M,T=Object.keys(f)[Symbol.iterator]();!(x=(M=T.next()).done);x=!0){var A=M.value;this.Network.on(A,f[A])}}catch(e){w=!0,S=e}finally{try{!x&&T.return&&T.return()}finally{if(w)throw S}}}return!1}},{key:"componentDidUpdate",value:function(){this.updateGraph()}},{key:"patchEdges",value:function(e){var t=e.edgesRemoved,i=e.edgesAdded;this.edges.remove(t),this.edges.add(i)}},{key:"patchNodes",value:function(e){var t=e.nodesRemoved,i=e.nodesAdded,r=e.nodesChanged;this.nodes.remove(t),this.nodes.add(i),this.nodes.update(r)}},{key:"updateGraph",value:function(){var e=document.getElementById(this.state.identifier),t=(0,a.default)({physics:{stabilization:!1},autoResize:!1,edges:{smooth:!1,color:"#000000",width:.5,arrows:{to:{enabled:!0,scaleFactor:.5}}}},this.props.options);this.Network=new u.default.Network(e,Object.assign({},this.props.graph,{edges:this.edges,nodes:this.nodes}),t),this.props.getNetwork&&this.props.getNetwork(this.Network),this.props.getNodes&&this.props.getNodes(this.nodes);var i=this.props.events||{},r=!0,n=!1,o=void 0;try{for(var s,l=Object.keys(i)[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var h=s.value;this.Network.on(h,i[h])}}catch(e){n=!0,o=e}finally{try{!r&&l.return&&l.return()}finally{if(n)throw o}}}},{key:"render",value:function(){var e=this.state.identifier,t=this.props.style;return o.default.createElement("div",{id:e,style:t},e)}}]),t}();p.defaultProps={graph:{},style:{width:"100%",height:"100%"}},p.propTypes={graph:c.default.object,style:c.default.object,getNetwork:c.default.func,getNodes:c.default.func},t.default=p},function(e,t,i){var r=i(110)("defaultsDeep",i(223));r.placeholder=i(54),e.exports=r},function(e,t,i){var r=i(111),n=i(113);e.exports=function(e,t,i){return r(n,e,t,i)}},function(e,t,i){var r=i(112),n=i(54),o=Array.prototype.push;function a(e,t){return 2==t?function(t,i){return e(t,i)}:function(t){return e(t)}}function s(e){for(var t=e?e.length:0,i=Array(t);t--;)i[t]=e[t];return i}function l(e,t){return function(){var i=arguments.length;if(i){for(var r=Array(i);i--;)r[i]=arguments[i];var n=r[0]=t.apply(void 0,r);return e.apply(void 0,r),n}}}e.exports=function e(t,i,u,h){var c="function"==typeof i,d=i===Object(i);if(d&&(h=u,u=i,i=void 0),null==u)throw new TypeError;h||(h={});var p={cap:!("cap"in h)||h.cap,curry:!("curry"in h)||h.curry,fixed:!("fixed"in h)||h.fixed,immutable:!("immutable"in h)||h.immutable,rearg:!("rearg"in h)||h.rearg},f=c?u:n,m="curry"in h&&h.curry,v="fixed"in h&&h.fixed,g="rearg"in h&&h.rearg,y=c?u.runInContext():void 0,_=c?u:{ary:t.ary,assign:t.assign,clone:t.clone,curry:t.curry,forEach:t.forEach,isArray:t.isArray,isError:t.isError,isFunction:t.isFunction,isWeakMap:t.isWeakMap,iteratee:t.iteratee,keys:t.keys,rearg:t.rearg,toInteger:t.toInteger,toPath:t.toPath},b=_.ary,x=_.assign,w=_.clone,S=_.curry,M=_.forEach,T=_.isArray,A=_.isError,C=_.isFunction,L=_.isWeakMap,N=_.keys,P=_.rearg,k=_.toInteger,E=_.toPath,D=N(r.aryMethod),O={castArray:function(e){return function(){var t=arguments[0];return T(t)?e(s(t)):e.apply(void 0,arguments)}},iteratee:function(e){return function(){var t=arguments[0],i=arguments[1],r=e(t,i),n=r.length;return p.cap&&"number"==typeof i?(i=i>2?i-2:1,n&&n<=i?r:a(r,i)):r}},mixin:function(e){return function(t){var i=this;if(!C(i))return e(i,Object(t));var r=[];return M(N(t),function(e){C(t[e])&&r.push([e,i.prototype[e]])}),e(i,Object(t)),M(r,function(e){var t=e[1];C(t)?i.prototype[e[0]]=t:delete i.prototype[e[0]]}),i}},nthArg:function(e){return function(t){var i=t<0?1:k(t)+1;return S(e(t),i)}},rearg:function(e){return function(t,i){var r=i?i.length:0;return S(e(t,i),r)}},runInContext:function(i){return function(r){return e(t,i(r),h)}}};function R(e,t){if(p.cap){var i=r.iterateeRearg[e];if(i)return function(e,t){return V(e,function(e){var i=t.length;return function(e,t){return 2==t?function(t,i){return e.apply(void 0,arguments)}:function(t){return e.apply(void 0,arguments)}}(P(a(e,i),t),i)})}(t,i);var n=!c&&r.iterateeAry[e];if(n)return function(e,t){return V(e,function(e){return"function"==typeof e?a(e,t):e})}(t,n)}return t}function F(e,t,i){if(p.fixed&&(v||!r.skipFixed[e])){var n=r.methodSpread[e],a=n&&n.start;return void 0===a?b(t,i):function(e,t){return function(){for(var i=arguments.length,r=i-1,n=Array(i);i--;)n[i]=arguments[i];var a=n[t],s=n.slice(0,t);return a&&o.apply(s,a),t!=r&&o.apply(s,n.slice(t+1)),e.apply(this,s)}}(t,a)}return t}function I(e,t,i){return p.rearg&&i>1&&(g||!r.skipRearg[e])?P(t,r.methodRearg[e]||r.aryRearg[i]):t}function B(e,t){for(var i=-1,r=(t=E(t)).length,n=r-1,o=w(Object(e)),a=o;null!=a&&++i<r;){var s=t[i],l=a[s];null==l||C(l)||A(l)||L(l)||(a[s]=w(i==n?l:Object(l))),a=a[s]}return o}function U(t,i){var n=r.aliasToReal[t]||t,o=r.remap[n]||n,a=h;return function(t){var r=c?y:_,s=c?y[o]:i,l=x(x({},a),t);return e(r,n,s,l)}}function V(e,t){return function(){var i=arguments.length;if(!i)return e();for(var r=Array(i);i--;)r[i]=arguments[i];var n=p.rearg?0:i-1;return r[n]=t(r[n]),e.apply(void 0,r)}}function z(e,t,i){var n,o=r.aliasToReal[e]||e,a=t,u=O[o];return u?a=u(t):p.immutable&&(r.mutate.array[o]?a=l(t,s):r.mutate.object[o]?a=l(t,function(e){return function(t){return e({},t)}}(t)):r.mutate.set[o]&&(a=l(t,B))),M(D,function(e){return M(r.aryMethod[e],function(t){if(o==t){var i=r.methodSpread[o],s=i&&i.afterRearg;return n=s?F(o,I(o,a,e),e):I(o,F(o,a,e),e),n=R(o,n),l=n,u=e,n=m||p.curry&&u>1?S(l,u):l,!1}var l,u}),!n}),n||(n=a),n==t&&(n=m?S(n,1):function(){return t.apply(this,arguments)}),n.convert=U(o,t),n.placeholder=t.placeholder=i,n}if(!d)return z(i,u,f);var G=u,j=[];return M(D,function(e){M(r.aryMethod[e],function(e){var t=G[r.remap[e]||e];t&&j.push([e,z(e,t,G)])})}),M(N(G),function(e){var t=G[e];if("function"==typeof t){for(var i=j.length;i--;)if(j[i][0]==e)return;t.convert=U(e,t),j.push([e,t])}}),M(j,function(e){G[e[0]]=e[1]}),G.convert=function(e){return G.runInContext.convert(e)(void 0)},G.placeholder=G,M(N(G),function(e){M(r.realToAlias[e]||[],function(t){G[t]=G[e]})}),G}},function(e,t){t.aliasToReal={each:"forEach",eachRight:"forEachRight",entries:"toPairs",entriesIn:"toPairsIn",extend:"assignIn",extendAll:"assignInAll",extendAllWith:"assignInAllWith",extendWith:"assignInWith",first:"head",conforms:"conformsTo",matches:"isMatch",property:"get",__:"placeholder",F:"stubFalse",T:"stubTrue",all:"every",allPass:"overEvery",always:"constant",any:"some",anyPass:"overSome",apply:"spread",assoc:"set",assocPath:"set",complement:"negate",compose:"flowRight",contains:"includes",dissoc:"unset",dissocPath:"unset",dropLast:"dropRight",dropLastWhile:"dropRightWhile",equals:"isEqual",identical:"eq",indexBy:"keyBy",init:"initial",invertObj:"invert",juxt:"over",omitAll:"omit",nAry:"ary",path:"get",pathEq:"matchesProperty",pathOr:"getOr",paths:"at",pickAll:"pick",pipe:"flow",pluck:"map",prop:"get",propEq:"matchesProperty",propOr:"getOr",props:"at",symmetricDifference:"xor",symmetricDifferenceBy:"xorBy",symmetricDifferenceWith:"xorWith",takeLast:"takeRight",takeLastWhile:"takeRightWhile",unapply:"rest",unnest:"flatten",useWith:"overArgs",where:"conformsTo",whereEq:"isMatch",zipObj:"zipObject"},t.aryMethod={1:["assignAll","assignInAll","attempt","castArray","ceil","create","curry","curryRight","defaultsAll","defaultsDeepAll","floor","flow","flowRight","fromPairs","invert","iteratee","memoize","method","mergeAll","methodOf","mixin","nthArg","over","overEvery","overSome","rest","reverse","round","runInContext","spread","template","trim","trimEnd","trimStart","uniqueId","words","zipAll"],2:["add","after","ary","assign","assignAllWith","assignIn","assignInAllWith","at","before","bind","bindAll","bindKey","chunk","cloneDeepWith","cloneWith","concat","conformsTo","countBy","curryN","curryRightN","debounce","defaults","defaultsDeep","defaultTo","delay","difference","divide","drop","dropRight","dropRightWhile","dropWhile","endsWith","eq","every","filter","find","findIndex","findKey","findLast","findLastIndex","findLastKey","flatMap","flatMapDeep","flattenDepth","forEach","forEachRight","forIn","forInRight","forOwn","forOwnRight","get","groupBy","gt","gte","has","hasIn","includes","indexOf","intersection","invertBy","invoke","invokeMap","isEqual","isMatch","join","keyBy","lastIndexOf","lt","lte","map","mapKeys","mapValues","matchesProperty","maxBy","meanBy","merge","mergeAllWith","minBy","multiply","nth","omit","omitBy","overArgs","pad","padEnd","padStart","parseInt","partial","partialRight","partition","pick","pickBy","propertyOf","pull","pullAll","pullAt","random","range","rangeRight","rearg","reject","remove","repeat","restFrom","result","sampleSize","some","sortBy","sortedIndex","sortedIndexOf","sortedLastIndex","sortedLastIndexOf","sortedUniqBy","split","spreadFrom","startsWith","subtract","sumBy","take","takeRight","takeRightWhile","takeWhile","tap","throttle","thru","times","trimChars","trimCharsEnd","trimCharsStart","truncate","union","uniqBy","uniqWith","unset","unzipWith","without","wrap","xor","zip","zipObject","zipObjectDeep"],3:["assignInWith","assignWith","clamp","differenceBy","differenceWith","findFrom","findIndexFrom","findLastFrom","findLastIndexFrom","getOr","includesFrom","indexOfFrom","inRange","intersectionBy","intersectionWith","invokeArgs","invokeArgsMap","isEqualWith","isMatchWith","flatMapDepth","lastIndexOfFrom","mergeWith","orderBy","padChars","padCharsEnd","padCharsStart","pullAllBy","pullAllWith","rangeStep","rangeStepRight","reduce","reduceRight","replace","set","slice","sortedIndexBy","sortedLastIndexBy","transform","unionBy","unionWith","update","xorBy","xorWith","zipWith"],4:["fill","setWith","updateWith"]},t.aryRearg={2:[1,0],3:[2,0,1],4:[3,2,0,1]},t.iterateeAry={dropRightWhile:1,dropWhile:1,every:1,filter:1,find:1,findFrom:1,findIndex:1,findIndexFrom:1,findKey:1,findLast:1,findLastFrom:1,findLastIndex:1,findLastIndexFrom:1,findLastKey:1,flatMap:1,flatMapDeep:1,flatMapDepth:1,forEach:1,forEachRight:1,forIn:1,forInRight:1,forOwn:1,forOwnRight:1,map:1,mapKeys:1,mapValues:1,partition:1,reduce:2,reduceRight:2,reject:1,remove:1,some:1,takeRightWhile:1,takeWhile:1,times:1,transform:2},t.iterateeRearg={mapKeys:[1],reduceRight:[1,0]},t.methodRearg={assignInAllWith:[1,0],assignInWith:[1,2,0],assignAllWith:[1,0],assignWith:[1,2,0],differenceBy:[1,2,0],differenceWith:[1,2,0],getOr:[2,1,0],intersectionBy:[1,2,0],intersectionWith:[1,2,0],isEqualWith:[1,2,0],isMatchWith:[2,1,0],mergeAllWith:[1,0],mergeWith:[1,2,0],padChars:[2,1,0],padCharsEnd:[2,1,0],padCharsStart:[2,1,0],pullAllBy:[2,1,0],pullAllWith:[2,1,0],rangeStep:[1,2,0],rangeStepRight:[1,2,0],setWith:[3,1,2,0],sortedIndexBy:[2,1,0],sortedLastIndexBy:[2,1,0],unionBy:[1,2,0],unionWith:[1,2,0],updateWith:[3,1,2,0],xorBy:[1,2,0],xorWith:[1,2,0],zipWith:[1,2,0]},t.methodSpread={assignAll:{start:0},assignAllWith:{start:0},assignInAll:{start:0},assignInAllWith:{start:0},defaultsAll:{start:0},defaultsDeepAll:{start:0},invokeArgs:{start:2},invokeArgsMap:{start:2},mergeAll:{start:0},mergeAllWith:{start:0},partial:{start:1},partialRight:{start:1},without:{start:1},zipAll:{start:0}},t.mutate={array:{fill:!0,pull:!0,pullAll:!0,pullAllBy:!0,pullAllWith:!0,pullAt:!0,remove:!0,reverse:!0},object:{assign:!0,assignAll:!0,assignAllWith:!0,assignIn:!0,assignInAll:!0,assignInAllWith:!0,assignInWith:!0,assignWith:!0,defaults:!0,defaultsAll:!0,defaultsDeep:!0,defaultsDeepAll:!0,merge:!0,mergeAll:!0,mergeAllWith:!0,mergeWith:!0},set:{set:!0,setWith:!0,unset:!0,update:!0,updateWith:!0}},t.realToAlias=function(){var e=Object.prototype.hasOwnProperty,i=t.aliasToReal,r={};for(var n in i){var o=i[n];e.call(r,o)?r[o].push(n):r[o]=[n]}return r}(),t.remap={assignAll:"assign",assignAllWith:"assignWith",assignInAll:"assignIn",assignInAllWith:"assignInWith",curryN:"curry",curryRightN:"curryRight",defaultsAll:"defaults",defaultsDeepAll:"defaultsDeep",findFrom:"find",findIndexFrom:"findIndex",findLastFrom:"findLast",findLastIndexFrom:"findLastIndex",getOr:"get",includesFrom:"includes",indexOfFrom:"indexOf",invokeArgs:"invoke",invokeArgsMap:"invokeMap",lastIndexOfFrom:"lastIndexOf",mergeAll:"merge",mergeAllWith:"mergeWith",padChars:"pad",padCharsEnd:"padEnd",padCharsStart:"padStart",propertyOf:"get",rangeStep:"range",rangeStepRight:"rangeRight",restFrom:"rest",spreadFrom:"spread",trimChars:"trim",trimCharsEnd:"trimEnd",trimCharsStart:"trimStart",zipAll:"zip"},t.skipFixed={castArray:!0,flow:!0,flowRight:!0,iteratee:!0,mixin:!0,rearg:!0,runInContext:!0},t.skipRearg={add:!0,assign:!0,assignIn:!0,bind:!0,bindKey:!0,concat:!0,difference:!0,divide:!0,eq:!0,gt:!0,gte:!0,isEqual:!0,lt:!0,lte:!0,matchesProperty:!0,merge:!0,multiply:!0,overArgs:!0,partial:!0,partialRight:!0,propertyOf:!0,random:!0,range:!0,rangeRight:!0,subtract:!0,zip:!0,zipObject:!0,zipObjectDeep:!0}},function(e,t,i){e.exports={ary:i(114),assign:i(74),clone:i(149),curry:i(191),forEach:i(36),isArray:i(1),isError:i(192),isFunction:i(14),isWeakMap:i(193),iteratee:i(194),keys:i(77),rearg:i(218),toInteger:i(73),toPath:i(222)}},function(e,t,i){var r=i(32),n=128;e.exports=function(e,t,i){return t=i?void 0:t,t=e&&null==t?e.length:t,r(e,n,void 0,void 0,void 0,void 0,t)}},function(e,t,i){var r=i(14),n=i(118),o=i(2),a=i(60),s=/^\[object .+?Constructor\]$/,l=Function.prototype,u=Object.prototype,h=l.toString,c=u.hasOwnProperty,d=RegExp("^"+h.call(c).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||n(e))&&(r(e)?d:s).test(a(e))}},function(e,t,i){var r=i(6),n=Object.prototype,o=n.hasOwnProperty,a=n.toString,s=r?r.toStringTag:void 0;e.exports=function(e){var t=o.call(e,s),i=e[s];try{e[s]=void 0;var r=!0}catch(e){}var n=a.call(e);return r&&(t?e[s]=i:delete e[s]),n}},function(e,t){var i=Object.prototype.toString;e.exports=function(e){return i.call(e)}},function(e,t,i){var r,n=i(119),o=(r=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!o&&o in e}},function(e,t,i){var r=i(0)["__core-js_shared__"];e.exports=r},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,i){var r=i(15),n=i(0),o=1;e.exports=function(e,t,i){var a=t&o,s=r(e);return function t(){return(this&&this!==n&&this instanceof t?s:e).apply(a?i:this,arguments)}}},function(e,t,i){var r=i(17),n=i(15),o=i(61),a=i(64),s=i(72),l=i(37),u=i(0);e.exports=function(e,t,i){var h=n(e);return function n(){for(var c=arguments.length,d=Array(c),p=c,f=s(n);p--;)d[p]=arguments[p];var m=c<3&&d[0]!==f&&d[c-1]!==f?[]:l(d,f);return(c-=m.length)<i?a(e,t,o,n.placeholder,void 0,d,m,void 0,void 0,i-c):r(this&&this!==u&&this instanceof n?h:e,this,d)}}},function(e,t){e.exports=function(e,t){for(var i=e.length,r=0;i--;)e[i]===t&&++r;return r}},function(e,t,i){var r=i(33),n=i(65),o=i(126),a=i(128);e.exports=function(e){var t=o(e),i=a[t];if("function"!=typeof i||!(t in r.prototype))return!1;if(e===i)return!0;var s=n(i);return!!s&&e===s[0]}},function(e,t){e.exports=function(){}},function(e,t,i){var r=i(127),n=Object.prototype.hasOwnProperty;e.exports=function(e){for(var t=e.name+"",i=r[t],o=n.call(r,t)?i.length:0;o--;){var a=i[o],s=a.func;if(null==s||s==e)return a.name}return t}},function(e,t){e.exports={}},function(e,t,i){var r=i(33),n=i(66),o=i(34),a=i(1),s=i(3),l=i(129),u=Object.prototype.hasOwnProperty;function h(e){if(s(e)&&!a(e)&&!(e instanceof r)){if(e instanceof n)return e;if(u.call(e,"__wrapped__"))return l(e)}return new n(e)}h.prototype=o.prototype,h.prototype.constructor=h,e.exports=h},function(e,t,i){var r=i(33),n=i(66),o=i(7);e.exports=function(e){if(e instanceof r)return e.clone();var t=new n(e.__wrapped__,e.__chain__);return t.__actions__=o(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}},function(e,t){var i=/\{\n\/\* \[wrapped with (.+)\] \*/,r=/,? & /;e.exports=function(e){var t=e.match(i);return t?t[1].split(r):[]}},function(e,t){var i=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/;e.exports=function(e,t){var r=t.length;if(!r)return e;var n=r-1;return t[n]=(r>1?"& ":"")+t[n],t=t.join(r>2?", ":" "),e.replace(i,"{\n/* [wrapped with "+t+"] */\n")}},function(e,t,i){var r=i(133),n=i(70),o=i(13),a=n?function(e,t){return n(e,"toString",{configurable:!0,enumerable:!1,value:r(t),writable:!0})}:o;e.exports=a},function(e,t){e.exports=function(e){return function(){return e}}},function(e,t,i){var r=i(36),n=i(71),o=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]];e.exports=function(e,t){return r(o,function(i){var r="_."+i[0];t&i[1]&&!n(e,r)&&e.push(r)}),e.sort()}},function(e,t,i){var r=i(136),n=i(137),o=i(138);e.exports=function(e,t,i){return t==t?o(e,t,i):r(e,n,i)}},function(e,t){e.exports=function(e,t,i,r){for(var n=e.length,o=i+(r?1:-1);r?o--:++o<n;)if(t(e[o],o,e))return o;return-1}},function(e,t){e.exports=function(e){return e!=e}},function(e,t){e.exports=function(e,t,i){for(var r=i-1,n=e.length;++r<n;)if(e[r]===t)return r;return-1}},function(e,t,i){var r=i(7),n=i(18),o=Math.min;e.exports=function(e,t){for(var i=e.length,a=o(t.length,i),s=r(e);a--;){var l=t[a];e[a]=n(l,i)?s[l]:void 0}return e}},function(e,t,i){var r=i(17),n=i(15),o=i(0),a=1;e.exports=function(e,t,i,s){var l=t&a,u=n(e);return function t(){for(var n=-1,a=arguments.length,h=-1,c=s.length,d=Array(c+a),p=this&&this!==o&&this instanceof t?u:e;++h<c;)d[h]=s[h];for(;a--;)d[h++]=arguments[++n];return r(p,l?i:this,d)}}},function(e,t,i){var r=i(62),n=i(63),o=i(37),a="__lodash_placeholder__",s=1,l=2,u=4,h=8,c=128,d=256,p=Math.min;e.exports=function(e,t){var i=e[1],f=t[1],m=i|f,v=m<(s|l|c),g=f==c&&i==h||f==c&&i==d&&e[7].length<=t[8]||f==(c|d)&&t[7].length<=t[8]&&i==h;if(!v&&!g)return e;f&s&&(e[2]=t[2],m|=i&s?0:u);var y=t[3];if(y){var _=e[3];e[3]=_?r(_,y,t[4]):y,e[4]=_?o(e[3],a):t[4]}return(y=t[5])&&(_=e[5],e[5]=_?n(_,y,t[6]):y,e[6]=_?o(e[5],a):t[6]),(y=t[7])&&(e[7]=y),f&c&&(e[8]=null==e[8]?t[8]:p(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=m,e}},function(e,t,i){var r=i(143),n=1/0,o=1.7976931348623157e308;e.exports=function(e){return e?(e=r(e))===n||e===-n?(e<0?-1:1)*o:e==e?e:0:0===e?e:0}},function(e,t,i){var r=i(2),n=i(8),o=NaN,a=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,u=/^0o[0-7]+$/i,h=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(n(e))return o;if(r(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=r(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(a,"");var i=l.test(e);return i||u.test(e)?h(e.slice(2),i?2:8):s.test(e)?o:+e}},function(e,t){e.exports=function(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}},function(e,t,i){var r=i(5),n=i(3),o="[object Arguments]";e.exports=function(e){return n(e)&&r(e)==o}},function(e,t){e.exports=function(){return!1}},function(e,t,i){var r=i(5),n=i(41),o=i(3),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&n(e.length)&&!!a[r(e)]}},function(e,t,i){var r=i(78)(Object.keys,Object);e.exports=r},function(e,t,i){var r=i(79),n=4;e.exports=function(e){return r(e,n)}},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,i){var r=i(26),n=Array.prototype.splice;e.exports=function(e){var t=this.__data__,i=r(t,e);return!(i<0||(i==t.length-1?t.pop():n.call(t,i,1),--this.size,0))}},function(e,t,i){var r=i(26);e.exports=function(e){var t=this.__data__,i=r(t,e);return i<0?void 0:t[i][1]}},function(e,t,i){var r=i(26);e.exports=function(e){return r(this.__data__,e)>-1}},function(e,t,i){var r=i(26);e.exports=function(e,t){var i=this.__data__,n=r(i,e);return n<0?(++this.size,i.push([e,t])):i[n][1]=t,this}},function(e,t,i){var r=i(25);e.exports=function(){this.__data__=new r,this.size=0}},function(e,t){e.exports=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,i){var r=i(25),n=i(44),o=i(45),a=200;e.exports=function(e,t){var i=this.__data__;if(i instanceof r){var s=i.__data__;if(!n||s.length<a-1)return s.push([e,t]),this.size=++i.size,this;i=this.__data__=new o(s)}return i.set(e,t),this.size=i.size,this}},function(e,t,i){var r=i(161),n=i(25),o=i(44);e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(o||n),string:new r}}},function(e,t,i){var r=i(162),n=i(163),o=i(164),a=i(165),s=i(166);function l(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}l.prototype.clear=r,l.prototype.delete=n,l.prototype.get=o,l.prototype.has=a,l.prototype.set=s,e.exports=l},function(e,t,i){var r=i(27);e.exports=function(){this.__data__=r?r(null):{},this.size=0}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,i){var r=i(27),n="__lodash_hash_undefined__",o=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(r){var i=t[e];return i===n?void 0:i}return o.call(t,e)?t[e]:void 0}},function(e,t,i){var r=i(27),n=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?void 0!==t[e]:n.call(t,e)}},function(e,t,i){var r=i(27),n="__lodash_hash_undefined__";e.exports=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=r&&void 0===t?n:t,this}},function(e,t,i){var r=i(28);e.exports=function(e){var t=r(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,i){var r=i(28);e.exports=function(e){return r(this,e).get(e)}},function(e,t,i){var r=i(28);e.exports=function(e){return r(this,e).has(e)}},function(e,t,i){var r=i(28);e.exports=function(e,t){var i=r(this,e),n=i.size;return i.set(e,t),this.size+=i.size==n?0:1,this}},function(e,t,i){var r=i(9),n=i(29);e.exports=function(e,t){return e&&r(t,n(t),e)}},function(e,t,i){var r=i(2),n=i(43),o=i(174),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return o(e);var t=n(e),i=[];for(var s in e)("constructor"!=s||!t&&a.call(e,s))&&i.push(s);return i}},function(e,t){e.exports=function(e){var t=[];if(null!=e)for(var i in Object(e))t.push(i);return t}},function(e,t,i){var r=i(9),n=i(46);e.exports=function(e,t){return r(e,n(e),t)}},function(e,t){e.exports=function(e,t){for(var i=-1,r=null==e?0:e.length,n=0,o=[];++i<r;){var a=e[i];t(a,i,e)&&(o[n++]=a)}return o}},function(e,t,i){var r=i(9),n=i(82);e.exports=function(e,t){return r(e,n(e),t)}},function(e,t,i){var r=i(84),n=i(82),o=i(29);e.exports=function(e){return r(e,o,n)}},function(e,t,i){var r=i(4)(i(0),"DataView");e.exports=r},function(e,t,i){var r=i(4)(i(0),"Promise");e.exports=r},function(e,t,i){var r=i(4)(i(0),"Set");e.exports=r},function(e,t){var i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&i.call(e,"index")&&(r.index=e.index,r.input=e.input),r}},function(e,t,i){var r=i(49),n=i(184),o=i(185),a=i(186),s=i(86),l="[object Boolean]",u="[object Date]",h="[object Map]",c="[object Number]",d="[object RegExp]",p="[object Set]",f="[object String]",m="[object Symbol]",v="[object ArrayBuffer]",g="[object DataView]",y="[object Float32Array]",_="[object Float64Array]",b="[object Int8Array]",x="[object Int16Array]",w="[object Int32Array]",S="[object Uint8Array]",M="[object Uint8ClampedArray]",T="[object Uint16Array]",A="[object Uint32Array]";e.exports=function(e,t,i){var C=e.constructor;switch(t){case v:return r(e);case l:case u:return new C(+e);case g:return n(e,i);case y:case _:case b:case x:case w:case S:case M:case T:case A:return s(e,i);case h:return new C;case c:case f:return new C(e);case d:return o(e);case p:return new C;case m:return a(e)}}},function(e,t,i){var r=i(49);e.exports=function(e,t){var i=t?r(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}},function(e,t){var i=/\w*$/;e.exports=function(e){var t=new e.constructor(e.source,i.exec(e));return t.lastIndex=e.lastIndex,t}},function(e,t,i){var r=i(6),n=r?r.prototype:void 0,o=n?n.valueOf:void 0;e.exports=function(e){return o?Object(o.call(e)):{}}},function(e,t,i){var r=i(188),n=i(22),o=i(42),a=o&&o.isMap,s=a?n(a):r;e.exports=s},function(e,t,i){var r=i(11),n=i(3),o="[object Map]";e.exports=function(e){return n(e)&&r(e)==o}},function(e,t,i){var r=i(190),n=i(22),o=i(42),a=o&&o.isSet,s=a?n(a):r;e.exports=s},function(e,t,i){var r=i(11),n=i(3),o="[object Set]";e.exports=function(e){return n(e)&&r(e)==o}},function(e,t,i){var r=i(32),n=8;function o(e,t,i){var a=r(e,n,void 0,void 0,void 0,void 0,void 0,t=i?void 0:t);return a.placeholder=o.placeholder,a}o.placeholder={},e.exports=o},function(e,t,i){var r=i(5),n=i(3),o=i(88),a="[object DOMException]",s="[object Error]";e.exports=function(e){if(!n(e))return!1;var t=r(e);return t==s||t==a||"string"==typeof e.message&&"string"==typeof e.name&&!o(e)}},function(e,t,i){var r=i(11),n=i(3),o="[object WeakMap]";e.exports=function(e){return n(e)&&r(e)==o}},function(e,t,i){var r=i(79),n=i(195),o=1;e.exports=function(e){return n("function"==typeof e?e:r(e,o))}},function(e,t,i){var r=i(196),n=i(207),o=i(13),a=i(1),s=i(215);e.exports=function(e){return"function"==typeof e?e:null==e?o:"object"==typeof e?a(e)?n(e[0],e[1]):r(e):s(e)}},function(e,t,i){var r=i(197),n=i(206),o=i(93);e.exports=function(e){var t=n(e);return 1==t.length&&t[0][2]?o(t[0][0],t[0][1]):function(i){return i===e||r(i,e,t)}}},function(e,t,i){var r=i(24),n=i(50),o=1,a=2;e.exports=function(e,t,i,s){var l=i.length,u=l,h=!s;if(null==e)return!u;for(e=Object(e);l--;){var c=i[l];if(h&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++l<u;){var d=(c=i[l])[0],p=e[d],f=c[1];if(h&&c[2]){if(void 0===p&&!(d in e))return!1}else{var m=new r;if(s)var v=s(p,f,d,e,t,m);if(!(void 0===v?n(f,p,o|a,s,m):v))return!1}}return!0}},function(e,t,i){var r=i(24),n=i(89),o=i(202),a=i(205),s=i(11),l=i(1),u=i(21),h=i(40),c=1,d="[object Arguments]",p="[object Array]",f="[object Object]",m=Object.prototype.hasOwnProperty;e.exports=function(e,t,i,v,g,y){var _=l(e),b=l(t),x=_?p:s(e),w=b?p:s(t),S=(x=x==d?f:x)==f,M=(w=w==d?f:w)==f,T=x==w;if(T&&u(e)){if(!u(t))return!1;_=!0,S=!1}if(T&&!S)return y||(y=new r),_||h(e)?n(e,t,i,v,g,y):o(e,t,x,i,v,g,y);if(!(i&c)){var A=S&&m.call(e,"__wrapped__"),C=M&&m.call(t,"__wrapped__");if(A||C){var L=A?e.value():e,N=C?t.value():t;return y||(y=new r),g(L,N,i,v,y)}}return!!T&&(y||(y=new r),a(e,t,i,v,g,y))}},function(e,t){var i="__lodash_hash_undefined__";e.exports=function(e){return this.__data__.set(e,i),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t){e.exports=function(e,t){for(var i=-1,r=null==e?0:e.length;++i<r;)if(t(e[i],i,e))return!0;return!1}},function(e,t,i){var r=i(6),n=i(85),o=i(10),a=i(89),s=i(203),l=i(204),u=1,h=2,c="[object Boolean]",d="[object Date]",p="[object Error]",f="[object Map]",m="[object Number]",v="[object RegExp]",g="[object Set]",y="[object String]",_="[object Symbol]",b="[object ArrayBuffer]",x="[object DataView]",w=r?r.prototype:void 0,S=w?w.valueOf:void 0;e.exports=function(e,t,i,r,w,M,T){switch(i){case x:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case b:return!(e.byteLength!=t.byteLength||!M(new n(e),new n(t)));case c:case d:case m:return o(+e,+t);case p:return e.name==t.name&&e.message==t.message;case v:case y:return e==t+"";case f:var A=s;case g:var C=r&u;if(A||(A=l),e.size!=t.size&&!C)return!1;var L=T.get(e);if(L)return L==t;r|=h,T.set(e,t);var N=a(A(e),A(t),r,w,M,T);return T.delete(e),N;case _:if(S)return S.call(e)==S.call(t)}return!1}},function(e,t){e.exports=function(e){var t=-1,i=Array(e.size);return e.forEach(function(e,r){i[++t]=[r,e]}),i}},function(e,t){e.exports=function(e){var t=-1,i=Array(e.size);return e.forEach(function(e){i[++t]=e}),i}},function(e,t,i){var r=i(83),n=1,o=Object.prototype.hasOwnProperty;e.exports=function(e,t,i,a,s,l){var u=i&n,h=r(e),c=h.length;if(c!=r(t).length&&!u)return!1;for(var d=c;d--;){var p=h[d];if(!(u?p in t:o.call(t,p)))return!1}var f=l.get(e);if(f&&l.get(t))return f==t;var m=!0;l.set(e,t),l.set(t,e);for(var v=u;++d<c;){var g=e[p=h[d]],y=t[p];if(a)var _=u?a(y,g,p,t,e,l):a(g,y,p,e,t,l);if(!(void 0===_?g===y||s(g,y,i,a,l):_)){m=!1;break}v||(v="constructor"==p)}if(m&&!v){var b=e.constructor,x=t.constructor;b!=x&&"constructor"in e&&"constructor"in t&&!("function"==typeof b&&b instanceof b&&"function"==typeof x&&x instanceof x)&&(m=!1)}return l.delete(e),l.delete(t),m}},function(e,t,i){var r=i(92),n=i(19);e.exports=function(e){for(var t=n(e),i=t.length;i--;){var o=t[i],a=e[o];t[i]=[o,a,r(a)]}return t}},function(e,t,i){var r=i(50),n=i(208),o=i(212),a=i(51),s=i(92),l=i(93),u=i(12),h=1,c=2;e.exports=function(e,t){return a(e)&&s(t)?l(u(e),t):function(i){var a=n(i,e);return void 0===a&&a===t?o(i,e):r(t,a,h|c)}}},function(e,t,i){var r=i(94);e.exports=function(e,t,i){var n=null==e?void 0:r(e,t);return void 0===n?i:n}},function(e,t,i){var r=i(210),n=500;e.exports=function(e){var t=r(e,function(e){return i.size===n&&i.clear(),e}),i=t.cache;return t}},function(e,t,i){var r=i(45),n="Expected a function";function o(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(n);var i=function(){var r=arguments,n=t?t.apply(this,r):r[0],o=i.cache;if(o.has(n))return o.get(n);var a=e.apply(this,r);return i.cache=o.set(n,a)||o,a};return i.cache=new(o.Cache||r),i}o.Cache=r,e.exports=o},function(e,t,i){var r=i(6),n=i(52),o=i(1),a=i(8),s=1/0,l=r?r.prototype:void 0,u=l?l.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(o(t))return n(t,e)+"";if(a(t))return u?u.call(t):"";var i=t+"";return"0"==i&&1/t==-s?"-0":i}},function(e,t,i){var r=i(213),n=i(214);e.exports=function(e,t){return null!=e&&n(e,t,r)}},function(e,t){e.exports=function(e,t){return null!=e&&t in Object(e)}},function(e,t,i){var r=i(95),n=i(20),o=i(1),a=i(18),s=i(41),l=i(12);e.exports=function(e,t,i){for(var u=-1,h=(t=r(t,e)).length,c=!1;++u<h;){var d=l(t[u]);if(!(c=null!=e&&i(e,d)))break;e=e[d]}return c||++u!=h?c:!!(h=null==e?0:e.length)&&s(h)&&a(d,h)&&(o(e)||n(e))}},function(e,t,i){var r=i(216),n=i(217),o=i(51),a=i(12);e.exports=function(e){return o(e)?r(a(e)):n(e)}},function(e,t){e.exports=function(e){return function(t){return null==t?void 0:t[e]}}},function(e,t,i){var r=i(94);e.exports=function(e){return function(t){return r(t,e)}}},function(e,t,i){var r=i(32),n=i(219),o=n(function(e,t){return r(e,256,void 0,void 0,void 0,t)});e.exports=o},function(e,t,i){var r=i(220),n=i(99),o=i(35);e.exports=function(e){return o(n(e,void 0,r),e+"")}},function(e,t,i){var r=i(98);e.exports=function(e){return null!=e&&e.length?r(e,1):[]}},function(e,t,i){var r=i(6),n=i(20),o=i(1),a=r?r.isConcatSpreadable:void 0;e.exports=function(e){return o(e)||n(e)||!!(a&&e&&e[a])}},function(e,t,i){var r=i(52),n=i(7),o=i(1),a=i(8),s=i(96),l=i(12),u=i(97);e.exports=function(e){return o(e)?r(e,l):a(e)?[e]:n(s(u(e)))}},function(e,t,i){var r=i(17),n=i(53),o=i(224),a=i(229),s=n(function(e){return e.push(void 0,o),r(a,void 0,e)});e.exports=s},function(e,t,i){var r=i(100),n=i(2);e.exports=function e(t,i,o,a,s,l){return n(t)&&n(i)&&(l.set(i,t),r(t,i,void 0,e,l),l.delete(i)),t}},function(e,t,i){var r=i(226)();e.exports=r},function(e,t){e.exports=function(e){return function(t,i,r){for(var n=-1,o=Object(t),a=r(t),s=a.length;s--;){var l=a[e?s:++n];if(!1===i(o[l],l,o))break}return t}}},function(e,t,i){var r=i(101),n=i(80),o=i(86),a=i(7),s=i(87),l=i(20),u=i(1),h=i(102),c=i(21),d=i(14),p=i(2),f=i(88),m=i(40),v=i(103),g=i(228);e.exports=function(e,t,i,y,_,b,x){var w=v(e,i),S=v(t,i),M=x.get(S);if(M)r(e,i,M);else{var T=b?b(w,S,i+"",e,t,x):void 0,A=void 0===T;if(A){var C=u(S),L=!C&&c(S),N=!C&&!L&&m(S);T=S,C||L||N?u(w)?T=w:h(w)?T=a(w):L?(A=!1,T=n(S,!0)):N?(A=!1,T=o(S,!0)):T=[]:f(S)||l(S)?(T=w,l(w)?T=g(w):p(w)&&!d(w)||(T=s(S))):A=!1}A&&(x.set(S,T),_(T,S,y,b,x),x.delete(S)),r(e,i,T)}}},function(e,t,i){var r=i(9),n=i(29);e.exports=function(e){return r(e,n(e))}},function(e,t,i){var r=i(100),n=i(230)(function(e,t,i,n){r(e,t,i,n)});e.exports=n},function(e,t,i){var r=i(53),n=i(231);e.exports=function(e){return r(function(t,i){var r=-1,o=i.length,a=o>1?i[o-1]:void 0,s=o>2?i[2]:void 0;for(a=e.length>3&&"function"==typeof a?(o--,a):void 0,s&&n(i[0],i[1],s)&&(a=o<3?void 0:a,o=1),t=Object(t);++r<o;){var l=i[r];l&&e(t,l,r,a)}return t})}},function(e,t,i){var r=i(10),n=i(23),o=i(18),a=i(2);e.exports=function(e,t,i){if(!a(i))return!1;var s=typeof t;return!!("number"==s?n(i)&&o(t,i.length):"string"==s&&t in i)&&r(i[t],e)}},function(e,t,i){var r=i(50);e.exports=function(e,t){return r(e,t)}},function(e,t,i){var r=i(234),n=i(98),o=i(53),a=i(102),s=i(236),l=o(function(e,t){var i=s(t);return a(i)&&(i=void 0),a(e)?r(e,n(t,1,a,!0),void 0,i):[]});e.exports=l},function(e,t,i){var r=i(90),n=i(71),o=i(235),a=i(52),s=i(22),l=i(91),u=200;e.exports=function(e,t,i,h){var c=-1,d=n,p=!0,f=e.length,m=[],v=t.length;if(!f)return m;i&&(t=a(t,s(i))),h?(d=o,p=!1):t.length>=u&&(d=l,p=!1,t=new r(t));e:for(;++c<f;){var g=e[c],y=null==i?g:i(g);if(g=h||0!==g?g:0,p&&y==y){for(var _=v;_--;)if(t[_]===y)continue e;m.push(g)}else d(t,y,h)||m.push(g)}return m}},function(e,t){e.exports=function(e,t,i){for(var r=-1,n=null==e?0:e.length;++r<n;)if(i(t,e[r]))return!0;return!1}},function(e,t){e.exports=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}},function(e,t,i){"use strict";
/**
 * vis.js
 * https://github.com/almende/vis
 *
 * A dynamic, browser-based visualization library.
 *
 * @version 4.21.0
 * @date    2017-10-12
 *
 * @license
 * Copyright (C) 2011-2017 Almende B.V, http://almende.com
 *
 * Vis.js is dual licensed under both
 *
 * * The Apache 2.0 License
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * and
 *
 * * The MIT License
 *   http://opensource.org/licenses/MIT
 *
 * Vis.js may be distributed under either license.
 */
/**
 * vis.js
 * https://github.com/almende/vis
 *
 * A dynamic, browser-based visualization library.
 *
 * @version 4.21.0
 * @date    2017-10-12
 *
 * @license
 * Copyright (C) 2011-2017 Almende B.V, http://almende.com
 *
 * Vis.js is dual licensed under both
 *
 * * The Apache 2.0 License
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * and
 *
 * * The MIT License
 *   http://opensource.org/licenses/MIT
 *
 * Vis.js may be distributed under either license.
 */
var r;r=function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=123)}([function(e,t,i){t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,i){t.__esModule=!0;var r,n=i(169),o=(r=n)&&r.__esModule?r:{default:r};t.default=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,o.default)(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}()},function(e,t,i){var r=s(i(77)),n=s(i(29)),o=s(i(8)),a=s(i(6));function s(e){return e&&e.__esModule?e:{default:e}}var l=i(9),u=i(157);function h(e,t,i,r){var n=!1;!0===r&&(n=null===t[i]&&void 0!==e[i]),n?delete e[i]:e[i]=t[i]}t.isNumber=function(e){return e instanceof Number||"number"==typeof e},t.recursiveDOMDelete=function(e){if(e)for(;!0===e.hasChildNodes();)t.recursiveDOMDelete(e.firstChild),e.removeChild(e.firstChild)},t.giveRange=function(e,t,i,r){if(t==e)return.5;var n=1/(t-e);return Math.max(0,(r-e)*n)},t.isString=function(e){return e instanceof String||"string"==typeof e},t.isDate=function(e){if(e instanceof Date)return!0;if(t.isString(e)){if(c.exec(e))return!0;if(!isNaN(Date.parse(e)))return!0}return!1},t.randomUUID=function(){return u.v4()},t.assignAllKeys=function(e,t){for(var i in e)e.hasOwnProperty(i)&&"object"!==(0,a.default)(e[i])&&(e[i]=t)},t.fillIfDefined=function(e,i){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(var n in e)void 0!==i[n]&&(null===i[n]||"object"!==(0,a.default)(i[n])?h(e,i,n,r):"object"===(0,a.default)(e[n])&&t.fillIfDefined(e[n],i[n],r))},t.extend=function(e,t){for(var i=1;i<arguments.length;i++){var r=arguments[i];for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}return e},t.selectiveExtend=function(e,t,i){if(!Array.isArray(e))throw new Error("Array with property names expected as first argument");for(var r=2;r<arguments.length;r++)for(var n=arguments[r],o=0;o<e.length;o++){var a=e[o];n&&n.hasOwnProperty(a)&&(t[a]=n[a])}return t},t.selectiveDeepExtend=function(e,i,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Array.isArray(r))throw new TypeError("Arrays are not supported by deepExtend");for(var o=0;o<e.length;o++){var a=e[o];if(r.hasOwnProperty(a))if(r[a]&&r[a].constructor===Object)void 0===i[a]&&(i[a]={}),i[a].constructor===Object?t.deepExtend(i[a],r[a],!1,n):h(i,r,a,n);else{if(Array.isArray(r[a]))throw new TypeError("Arrays are not supported by deepExtend");h(i,r,a,n)}}return i},t.selectiveNotDeepExtend=function(e,i,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Array.isArray(r))throw new TypeError("Arrays are not supported by deepExtend");for(var o in r)if(r.hasOwnProperty(o)&&-1===e.indexOf(o))if(r[o]&&r[o].constructor===Object)void 0===i[o]&&(i[o]={}),i[o].constructor===Object?t.deepExtend(i[o],r[o]):h(i,r,o,n);else if(Array.isArray(r[o])){i[o]=[];for(var a=0;a<r[o].length;a++)i[o].push(r[o][a])}else h(i,r,o,n);return i},t.deepExtend=function(e,i){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];for(var o in i)if(i.hasOwnProperty(o)||!0===r)if(i[o]&&i[o].constructor===Object)void 0===e[o]&&(e[o]={}),e[o].constructor===Object?t.deepExtend(e[o],i[o],r):h(e,i,o,n);else if(Array.isArray(i[o])){e[o]=[];for(var a=0;a<i[o].length;a++)e[o].push(i[o][a])}else h(e,i,o,n);return e},t.equalArray=function(e,t){if(e.length!=t.length)return!1;for(var i=0,r=e.length;i<r;i++)if(e[i]!=t[i])return!1;return!0},t.convert=function(e,i){var r;if(void 0!==e){if(null===e)return null;if(!i)return e;if("string"!=typeof i&&!(i instanceof String))throw new Error("Type must be a string");switch(i){case"boolean":case"Boolean":return Boolean(e);case"number":case"Number":return t.isString(e)&&!isNaN(Date.parse(e))?l(e).valueOf():Number(e.valueOf());case"string":case"String":return String(e);case"Date":if(t.isNumber(e))return new Date(e);if(e instanceof Date)return new Date(e.valueOf());if(l.isMoment(e))return new Date(e.valueOf());if(t.isString(e))return(r=c.exec(e))?new Date(Number(r[1])):l(new Date(e)).toDate();throw new Error("Cannot convert object of type "+t.getType(e)+" to type Date");case"Moment":if(t.isNumber(e))return l(e);if(e instanceof Date)return l(e.valueOf());if(l.isMoment(e))return l(e);if(t.isString(e))return r=c.exec(e),l(r?Number(r[1]):e);throw new Error("Cannot convert object of type "+t.getType(e)+" to type Date");case"ISODate":if(t.isNumber(e))return new Date(e);if(e instanceof Date)return e.toISOString();if(l.isMoment(e))return e.toDate().toISOString();if(t.isString(e))return(r=c.exec(e))?new Date(Number(r[1])).toISOString():l(e).format();throw new Error("Cannot convert object of type "+t.getType(e)+" to type ISODate");case"ASPDate":if(t.isNumber(e))return"/Date("+e+")/";if(e instanceof Date)return"/Date("+e.valueOf()+")/";if(t.isString(e))return"/Date("+((r=c.exec(e))?new Date(Number(r[1])).valueOf():new Date(e).valueOf())+")/";throw new Error("Cannot convert object of type "+t.getType(e)+" to type ASPDate");default:throw new Error('Unknown type "'+i+'"')}}};var c=/^\/?Date\((\-?\d+)/i;t.getType=function(e){var t=void 0===e?"undefined":(0,a.default)(e);return"object"==t?null===e?"null":e instanceof Boolean?"Boolean":e instanceof Number?"Number":e instanceof String?"String":Array.isArray(e)?"Array":e instanceof Date?"Date":"Object":"number"==t?"Number":"boolean"==t?"Boolean":"string"==t?"String":void 0===t?"undefined":t},t.copyAndExtendArray=function(e,t){for(var i=[],r=0;r<e.length;r++)i.push(e[r]);return i.push(t),i},t.copyArray=function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i]);return t},t.getAbsoluteLeft=function(e){return e.getBoundingClientRect().left},t.getAbsoluteRight=function(e){return e.getBoundingClientRect().right},t.getAbsoluteTop=function(e){return e.getBoundingClientRect().top},t.addClassName=function(e,t){var i=e.className.split(" "),r=t.split(" ");i=i.concat(r.filter(function(e){return i.indexOf(e)<0})),e.className=i.join(" ")},t.removeClassName=function(e,t){var i=e.className.split(" "),r=t.split(" ");i=i.filter(function(e){return r.indexOf(e)<0}),e.className=i.join(" ")},t.forEach=function(e,t){var i,r;if(Array.isArray(e))for(i=0,r=e.length;i<r;i++)t(e[i],i,e);else for(i in e)e.hasOwnProperty(i)&&t(e[i],i,e)},t.toArray=function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(e[i]);return t},t.updateProperty=function(e,t,i){return e[t]!==i&&(e[t]=i,!0)},t.throttle=function(e){var t=!1;return function(){t||(t=!0,requestAnimationFrame(function(){t=!1,e()}))}},t.addEventListener=function(e,t,i,r){e.addEventListener?(void 0===r&&(r=!1),"mousewheel"===t&&navigator.userAgent.indexOf("Firefox")>=0&&(t="DOMMouseScroll"),e.addEventListener(t,i,r)):e.attachEvent("on"+t,i)},t.removeEventListener=function(e,t,i,r){e.removeEventListener?(void 0===r&&(r=!1),"mousewheel"===t&&navigator.userAgent.indexOf("Firefox")>=0&&(t="DOMMouseScroll"),e.removeEventListener(t,i,r)):e.detachEvent("on"+t,i)},t.preventDefault=function(e){e||(e=window.event),e.preventDefault?e.preventDefault():e.returnValue=!1},t.getTarget=function(e){var t;return e||(e=window.event),e.target?t=e.target:e.srcElement&&(t=e.srcElement),null!=t.nodeType&&3==t.nodeType&&(t=t.parentNode),t},t.hasParent=function(e,t){for(var i=e;i;){if(i===t)return!0;i=i.parentNode}return!1},t.option={},t.option.asBoolean=function(e,t){return"function"==typeof e&&(e=e()),null!=e?0!=e:t||null},t.option.asNumber=function(e,t){return"function"==typeof e&&(e=e()),null!=e?Number(e)||t||null:t||null},t.option.asString=function(e,t){return"function"==typeof e&&(e=e()),null!=e?String(e):t||null},t.option.asSize=function(e,i){return"function"==typeof e&&(e=e()),t.isString(e)?e:t.isNumber(e)?e+"px":i||null},t.option.asElement=function(e,t){return"function"==typeof e&&(e=e()),e||t||null},t.hexToRGB=function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,i,r){return t+t+i+i+r+r});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},t.overrideOpacity=function(e,i){var r;return-1!=e.indexOf("rgba")?e:-1!=e.indexOf("rgb")?"rgba("+(r=e.substr(e.indexOf("(")+1).replace(")","").split(","))[0]+","+r[1]+","+r[2]+","+i+")":null==(r=t.hexToRGB(e))?e:"rgba("+r.r+","+r.g+","+r.b+","+i+")"},t.RGBToHex=function(e,t,i){return"#"+((1<<24)+(e<<16)+(t<<8)+i).toString(16).slice(1)},t.parseColor=function(e){var i;if(!0===t.isString(e)){if(!0===t.isValidRGB(e)){var r=e.substr(4).substr(0,e.length-5).split(",").map(function(e){return parseInt(e)});e=t.RGBToHex(r[0],r[1],r[2])}if(!0===t.isValidHex(e)){var n=t.hexToHSV(e),o={h:n.h,s:.8*n.s,v:Math.min(1,1.02*n.v)},a={h:n.h,s:Math.min(1,1.25*n.s),v:.8*n.v},s=t.HSVToHex(a.h,a.s,a.v),l=t.HSVToHex(o.h,o.s,o.v);i={background:e,border:s,highlight:{background:l,border:s},hover:{background:l,border:s}}}else i={background:e,border:e,highlight:{background:e,border:e},hover:{background:e,border:e}}}else(i={}).background=e.background||void 0,i.border=e.border||void 0,t.isString(e.highlight)?i.highlight={border:e.highlight,background:e.highlight}:(i.highlight={},i.highlight.background=e.highlight&&e.highlight.background||void 0,i.highlight.border=e.highlight&&e.highlight.border||void 0),t.isString(e.hover)?i.hover={border:e.hover,background:e.hover}:(i.hover={},i.hover.background=e.hover&&e.hover.background||void 0,i.hover.border=e.hover&&e.hover.border||void 0);return i},t.RGBToHSV=function(e,t,i){e/=255,t/=255,i/=255;var r=Math.min(e,Math.min(t,i)),n=Math.max(e,Math.max(t,i));return r==n?{h:0,s:0,v:r}:{h:60*((e==r?3:i==r?1:5)-(e==r?t-i:i==r?e-t:i-e)/(n-r))/360,s:(n-r)/n,v:n}};var d=function(e){var t={};return e.split(";").forEach(function(e){if(""!=e.trim()){var i=e.split(":"),r=i[0].trim(),n=i[1].trim();t[r]=n}}),t},p=function(e){return(0,o.default)(e).map(function(t){return t+": "+e[t]}).join("; ")};t.addCssText=function(e,i){var r=d(e.style.cssText),n=d(i),o=t.extend(r,n);e.style.cssText=p(o)},t.removeCssText=function(e,t){var i=d(e.style.cssText),r=d(t);for(var n in r)r.hasOwnProperty(n)&&delete i[n];e.style.cssText=p(i)},t.HSVToRGB=function(e,t,i){var r,n,o,a=Math.floor(6*e),s=6*e-a,l=i*(1-t),u=i*(1-s*t),h=i*(1-(1-s)*t);switch(a%6){case 0:r=i,n=h,o=l;break;case 1:r=u,n=i,o=l;break;case 2:r=l,n=i,o=h;break;case 3:r=l,n=u,o=i;break;case 4:r=h,n=l,o=i;break;case 5:r=i,n=l,o=u}return{r:Math.floor(255*r),g:Math.floor(255*n),b:Math.floor(255*o)}},t.HSVToHex=function(e,i,r){var n=t.HSVToRGB(e,i,r);return t.RGBToHex(n.r,n.g,n.b)},t.hexToHSV=function(e){var i=t.hexToRGB(e);return t.RGBToHSV(i.r,i.g,i.b)},t.isValidHex=function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},t.isValidRGB=function(e){return e=e.replace(" ",""),/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/i.test(e)},t.isValidRGBA=function(e){return e=e.replace(" ",""),/rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),(.{1,3})\)/i.test(e)},t.selectiveBridgeObject=function(e,i){if(null!==i&&"object"===(void 0===i?"undefined":(0,a.default)(i))){for(var r=(0,n.default)(i),o=0;o<e.length;o++)i.hasOwnProperty(e[o])&&"object"==(0,a.default)(i[e[o]])&&(r[e[o]]=t.bridgeObject(i[e[o]]));return r}return null},t.bridgeObject=function(e){if(null!==e&&"object"===(void 0===e?"undefined":(0,a.default)(e))){var i=(0,n.default)(e);if(e instanceof Element)i=e;else for(var r in i=(0,n.default)(e),e)e.hasOwnProperty(r)&&"object"==(0,a.default)(e[r])&&(i[r]=t.bridgeObject(e[r]));return i}return null},t.insertSort=function(e,t){for(var i=0;i<e.length;i++){for(var r=e[i],n=i;n>0&&t(r,e[n-1])<0;n--)e[n]=e[n-1];e[n]=r}return e},t.mergeOptions=function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=function(e){return null!=e},s=function(e){return null!==e&&"object"===(void 0===e?"undefined":(0,a.default)(e))};if(!s(e))throw new Error("Parameter mergeTarget must be an object");if(!s(t))throw new Error("Parameter options must be an object");if(!o(i))throw new Error("Parameter option must have a value");if(!s(r))throw new Error("Parameter globalOptions must be an object");var l=t[i],u=s(r)&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(r)?r[i]:void 0,h=u?u.enabled:void 0;if(void 0!==l){if("boolean"==typeof l)return s(e[i])||(e[i]={}),void(e[i].enabled=l);if(null===l&&!s(e[i])){if(!o(u))return;e[i]=(0,n.default)(u)}if(s(l)){var c=!0;void 0!==l.enabled?c=l.enabled:void 0!==h&&(c=u.enabled),function(e,t,i){s(e[i])||(e[i]={});var r=t[i],n=e[i];for(var o in r)r.hasOwnProperty(o)&&(n[o]=r[o])}(e,t,i),e[i].enabled=c}}},t.binarySearchCustom=function(e,t,i,r){for(var n=0,o=0,a=e.length-1;o<=a&&n<1e4;){var s=Math.floor((o+a)/2),l=e[s],u=t(void 0===r?l[i]:l[i][r]);if(0==u)return s;-1==u?o=s+1:a=s-1,n++}return-1},t.binarySearchValue=function(e,t,i,r,n){var o,a,s,l,u=0,h=0,c=e.length-1;for(n=null!=n?n:function(e,t){return e==t?0:e<t?-1:1};h<=c&&u<1e4;){if(l=Math.floor(.5*(c+h)),o=e[Math.max(0,l-1)][i],a=e[l][i],s=e[Math.min(e.length-1,l+1)][i],0==n(a,t))return l;if(n(o,t)<0&&n(a,t)>0)return"before"==r?Math.max(0,l-1):l;if(n(a,t)<0&&n(s,t)>0)return"before"==r?l:Math.min(e.length-1,l+1);n(a,t)<0?h=l+1:c=l-1,u++}return-1},t.easingFunctions={linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}},t.getScrollBarWidth=function(){var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);var i=e.offsetWidth;t.style.overflow="scroll";var r=e.offsetWidth;return i==r&&(r=t.clientWidth),document.body.removeChild(t),i-r},t.topMost=function(e,t){var i=void 0;Array.isArray(t)||(t=[t]);var n=!0,o=!1,a=void 0;try{for(var s,l=(0,r.default)(e);!(n=(s=l.next()).done);n=!0){var u=s.value;if(u){i=u[t[0]];for(var h=1;h<t.length;h++)i&&(i=i[t[h]]);if(void 0!==i)break}}}catch(e){o=!0,a=e}finally{try{!n&&l.return&&l.return()}finally{if(o)throw a}}return i}},function(e,t,i){e.exports={default:i(194),__esModule:!0}},function(e,t,i){t.__esModule=!0;var r,n=i(6),o=(r=n)&&r.__esModule?r:{default:r};t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,o.default)(t))&&"function"!=typeof t?e:t}},function(e,t,i){t.__esModule=!0;var r=a(i(196)),n=a(i(29)),o=a(i(6));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,o.default)(t)));e.prototype=(0,n.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(r.default?(0,r.default)(e,t):e.__proto__=t)}},function(e,t,i){t.__esModule=!0;var r=a(i(142)),n=a(i(144)),o="function"==typeof n.default&&"symbol"==typeof r.default?function(e){return typeof e}:function(e){return e&&"function"==typeof n.default&&e.constructor===n.default&&e!==n.default.prototype?"symbol":typeof e};function a(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof n.default&&"symbol"===o(r.default)?function(e){return void 0===e?"undefined":o(e)}:function(e){return e&&"function"==typeof n.default&&e.constructor===n.default&&e!==n.default.prototype?"symbol":void 0===e?"undefined":o(e)}},function(e,t){var i=e.exports={version:"2.5.1"};"number"==typeof __e&&(__e=i)},function(e,t,i){e.exports={default:i(140),__esModule:!0}},function(e,t,i){e.exports="undefined"!=typeof window&&window.moment||i(154)},function(e,t,i){if("undefined"!=typeof window){var r=i(175),n=window.Hammer||i(176);e.exports=r(n,{preventDefault:"mouse"})}else e.exports=function(){return{on:e=function(){},off:e,destroy:e,emit:e,get:function(t){return{set:e}}};var e}},function(e,t,i){var r=a(i(19)),n=a(i(6)),o=a(i(8));function a(e){return e&&e.__esModule?e:{default:e}}var s=i(2),l=i(43);function u(e,t){if(e&&!Array.isArray(e)&&(t=e,e=null),this._options=t||{},this._data={},this.length=0,this._fieldId=this._options.fieldId||"id",this._type={},this._options.type)for(var i=(0,o.default)(this._options.type),r=0,n=i.length;r<n;r++){var a=i[r],s=this._options.type[a];this._type[a]="Date"==s||"ISODate"==s||"ASPDate"==s?"Date":s}this._subscribers={},e&&this.add(e),this.setOptions(t)}u.prototype.setOptions=function(e){e&&void 0!==e.queue&&(!1===e.queue?this._queue&&(this._queue.destroy(),delete this._queue):(this._queue||(this._queue=l.extend(this,{replace:["add","update","remove"]})),"object"===(0,n.default)(e.queue)&&this._queue.setOptions(e.queue)))},u.prototype.on=function(e,t){var i=this._subscribers[e];i||(i=[],this._subscribers[e]=i),i.push({callback:t})},u.prototype.off=function(e,t){var i=this._subscribers[e];i&&(this._subscribers[e]=i.filter(function(e){return e.callback!=t}))},u.prototype._trigger=function(e,t,i){if("*"==e)throw new Error("Cannot trigger event *");var r=[];e in this._subscribers&&(r=r.concat(this._subscribers[e])),"*"in this._subscribers&&(r=r.concat(this._subscribers["*"]));for(var n=0,o=r.length;n<o;n++){var a=r[n];a.callback&&a.callback(e,t,i||null)}},u.prototype.add=function(e,t){var i,r=[];if(Array.isArray(e))for(var o=0,a=e.length;o<a;o++)i=this._addItem(e[o]),r.push(i);else{if(!e||"object"!==(void 0===e?"undefined":(0,n.default)(e)))throw new Error("Unknown dataType");i=this._addItem(e),r.push(i)}return r.length&&this._trigger("add",{items:r},t),r},u.prototype.update=function(e,t){var i=[],r=[],o=[],a=[],l=this,u=l._fieldId,h=function(e){var t=e[u];if(l._data[t]){var n=s.extend({},l._data[t]);t=l._updateItem(e),r.push(t),a.push(e),o.push(n)}else t=l._addItem(e),i.push(t)};if(Array.isArray(e))for(var c=0,d=e.length;c<d;c++)e[c]&&"object"===(0,n.default)(e[c])?h(e[c]):console.warn("Ignoring input item, which is not an object at index "+c);else{if(!e||"object"!==(void 0===e?"undefined":(0,n.default)(e)))throw new Error("Unknown dataType");h(e)}if(i.length&&this._trigger("add",{items:i},t),r.length){var p={items:r,oldData:o,data:a};this._trigger("update",p,t)}return i.concat(r)},u.prototype.get=function(e){var t,i,r,n,a=s.getType(arguments[0]);if("String"==a||"Number"==a?(t=arguments[0],r=arguments[1]):"Array"==a?(i=arguments[0],r=arguments[1]):r=arguments[0],r&&r.returnType){n=-1==["Array","Object"].indexOf(r.returnType)?"Array":r.returnType}else n="Array";var l,u,h,c,d,p=r&&r.type||this._options.type,f=r&&r.filter,m=[];if(null!=t)(l=this._getItem(t,p))&&f&&!f(l)&&(l=null);else if(null!=i)for(c=0,d=i.length;c<d;c++)l=this._getItem(i[c],p),f&&!f(l)||m.push(l);else for(c=0,d=(u=(0,o.default)(this._data)).length;c<d;c++)h=u[c],l=this._getItem(h,p),f&&!f(l)||m.push(l);if(r&&r.order&&null==t&&this._sort(m,r.order),r&&r.fields){var v=r.fields;if(null!=t)l=this._filterFields(l,v);else for(c=0,d=m.length;c<d;c++)m[c]=this._filterFields(m[c],v)}if("Object"==n){var g,y={};for(c=0,d=m.length;c<d;c++)y[(g=m[c]).id]=g;return y}return null!=t?l:m},u.prototype.getIds=function(e){var t,i,r,n,a,s=this._data,l=e&&e.filter,u=e&&e.order,h=e&&e.type||this._options.type,c=(0,o.default)(s),d=[];if(l)if(u){for(a=[],t=0,i=c.length;t<i;t++)r=c[t],l(n=this._getItem(r,h))&&a.push(n);for(this._sort(a,u),t=0,i=a.length;t<i;t++)d.push(a[t][this._fieldId])}else for(t=0,i=c.length;t<i;t++)r=c[t],l(n=this._getItem(r,h))&&d.push(n[this._fieldId]);else if(u){for(a=[],t=0,i=c.length;t<i;t++)r=c[t],a.push(s[r]);for(this._sort(a,u),t=0,i=a.length;t<i;t++)d.push(a[t][this._fieldId])}else for(t=0,i=c.length;t<i;t++)n=s[r=c[t]],d.push(n[this._fieldId]);return d},u.prototype.getDataSet=function(){return this},u.prototype.forEach=function(e,t){var i,r,n,a,s=t&&t.filter,l=t&&t.type||this._options.type,u=this._data,h=(0,o.default)(u);if(t&&t.order){var c=this.get(t);for(i=0,r=c.length;i<r;i++)e(n=c[i],a=n[this._fieldId])}else for(i=0,r=h.length;i<r;i++)a=h[i],n=this._getItem(a,l),s&&!s(n)||e(n,a)},u.prototype.map=function(e,t){var i,r,n,a,s=t&&t.filter,l=t&&t.type||this._options.type,u=[],h=this._data,c=(0,o.default)(h);for(i=0,r=c.length;i<r;i++)n=c[i],a=this._getItem(n,l),s&&!s(a)||u.push(e(a,n));return t&&t.order&&this._sort(u,t.order),u},u.prototype._filterFields=function(e,t){if(!e)return e;var i,r,n={},a=(0,o.default)(e),s=a.length;if(Array.isArray(t))for(i=0;i<s;i++)r=a[i],-1!=t.indexOf(r)&&(n[r]=e[r]);else for(i=0;i<s;i++)r=a[i],t.hasOwnProperty(r)&&(n[t[r]]=e[r]);return n},u.prototype._sort=function(e,t){if(s.isString(t)){var i=t;e.sort(function(e,t){var r=e[i],n=t[i];return r>n?1:r<n?-1:0})}else{if("function"!=typeof t)throw new TypeError("Order must be a function or a string");e.sort(t)}},u.prototype.remove=function(e,t){var i,r,n,o,a,s=[],l=[];for(r=0,n=(i=Array.isArray(e)?e:[e]).length;r<n;r++)(a=this._remove(i[r]))&&null!=(o=a[this._fieldId])&&(s.push(o),l.push(a));return s.length&&this._trigger("remove",{items:s,oldData:l},t),s},u.prototype._remove=function(e){var t,i;return s.isNumber(e)||s.isString(e)?i=e:e&&"object"===(void 0===e?"undefined":(0,n.default)(e))&&(i=e[this._fieldId]),void 0!==i&&this._data[i]?(t=this._data[i],delete this._data[i],this.length--,t):null},u.prototype.clear=function(e){var t,i,r=(0,o.default)(this._data),n=[];for(t=0,i=r.length;t<i;t++)n.push(this._data[r[t]]);return this._data={},this.length=0,this._trigger("remove",{items:r,oldData:n},e),r},u.prototype.max=function(e){var t,i,r=this._data,n=(0,o.default)(r),a=null,s=null;for(t=0,i=n.length;t<i;t++){var l=r[n[t]],u=l[e];null!=u&&(!a||u>s)&&(a=l,s=u)}return a},u.prototype.min=function(e){var t,i,r=this._data,n=(0,o.default)(r),a=null,s=null;for(t=0,i=n.length;t<i;t++){var l=r[n[t]],u=l[e];null!=u&&(!a||u<s)&&(a=l,s=u)}return a},u.prototype.distinct=function(e){var t,i,r,n=this._data,a=(0,o.default)(n),l=[],u=this._options.type&&this._options.type[e]||null,h=0;for(t=0,r=a.length;t<r;t++){var c=n[a[t]][e],d=!1;for(i=0;i<h;i++)if(l[i]==c){d=!0;break}d||void 0===c||(l[h]=c,h++)}if(u)for(t=0,r=l.length;t<r;t++)l[t]=s.convert(l[t],u);return l},u.prototype._addItem=function(e){var t=e[this._fieldId];if(null!=t){if(this._data[t])throw new Error("Cannot add item: item with id "+t+" already exists")}else t=s.randomUUID(),e[this._fieldId]=t;var i,r,n={},a=(0,o.default)(e);for(i=0,r=a.length;i<r;i++){var l=a[i],u=this._type[l];n[l]=s.convert(e[l],u)}return this._data[t]=n,this.length++,t},u.prototype._getItem=function(e,t){var i,r,n,a,l=this._data[e];if(!l)return null;var u={},h=(0,o.default)(l);if(t)for(n=0,a=h.length;n<a;n++)r=l[i=h[n]],u[i]=s.convert(r,t[i]);else for(n=0,a=h.length;n<a;n++)r=l[i=h[n]],u[i]=r;return u[this._fieldId]||(u[this._fieldId]=l.id),u},u.prototype._updateItem=function(e){var t=e[this._fieldId];if(null==t)throw new Error("Cannot update item: item has no id (item: "+(0,r.default)(e)+")");var i=this._data[t];if(!i)throw new Error("Cannot update item: no item with id "+t+" found");for(var n=(0,o.default)(e),a=0,l=n.length;a<l;a++){var u=n[a],h=this._type[u];i[u]=s.convert(e[u],h)}return t},e.exports=u},function(e,t,i){var r,n=i(8),o=(r=n)&&r.__esModule?r:{default:r};var a=i(2),s=i(11);function l(e,t){this._data=null,this._ids={},this.length=0,this._options=t||{},this._fieldId="id",this._subscribers={};var i=this;this.listener=function(){i._onEvent.apply(i,arguments)},this.setData(e)}l.prototype.setData=function(e){var t,i,r,n,o;if(this._data){for(this._data.off&&this._data.off("*",this.listener),o=[],r=0,n=(t=this._data.getIds({filter:this._options&&this._options.filter})).length;r<n;r++)o.push(this._data._data[t[r]]);this._ids={},this.length=0,this._trigger("remove",{items:t,oldData:o})}if(this._data=e,this._data){for(this._fieldId=this._options.fieldId||this._data&&this._data.options&&this._data.options.fieldId||"id",r=0,n=(t=this._data.getIds({filter:this._options&&this._options.filter})).length;r<n;r++)i=t[r],this._ids[i]=!0;this.length=t.length,this._trigger("add",{items:t}),this._data.on&&this._data.on("*",this.listener)}},l.prototype.refresh=function(){var e,t,i,r=this._data.getIds({filter:this._options&&this._options.filter}),n=(0,o.default)(this._ids),a={},s=[],l=[],u=[];for(t=0,i=r.length;t<i;t++)a[e=r[t]]=!0,this._ids[e]||(s.push(e),this._ids[e]=!0);for(t=0,i=n.length;t<i;t++)a[e=n[t]]||(l.push(e),u.push(this._data._data[e]),delete this._ids[e]);this.length+=s.length-l.length,s.length&&this._trigger("add",{items:s}),l.length&&this._trigger("remove",{items:l,oldData:u})},l.prototype.get=function(e){var t,i,r,n=this,o=a.getType(arguments[0]);"String"==o||"Number"==o||"Array"==o?(t=arguments[0],i=arguments[1],r=arguments[2]):(i=arguments[0],r=arguments[1]);var s=a.extend({},this._options,i);this._options.filter&&i&&i.filter&&(s.filter=function(e){return n._options.filter(e)&&i.filter(e)});var l=[];return null!=t&&l.push(t),l.push(s),l.push(r),this._data&&this._data.get.apply(this._data,l)},l.prototype.getIds=function(e){var t;if(this._data){var i,r=this._options.filter;i=e&&e.filter?r?function(t){return r(t)&&e.filter(t)}:e.filter:r,t=this._data.getIds({filter:i,order:e&&e.order})}else t=[];return t},l.prototype.map=function(e,t){var i=[];if(this._data){var r,n=this._options.filter;r=t&&t.filter?n?function(e){return n(e)&&t.filter(e)}:t.filter:n,i=this._data.map(e,{filter:r,order:t&&t.order})}else i=[];return i},l.prototype.getDataSet=function(){for(var e=this;e instanceof l;)e=e._data;return e||null},l.prototype._onEvent=function(e,t,i){var r,n,o,a=t&&t.items,s=[],l=[],u=[],h=[],c=[],d=[];if(a&&this._data){switch(e){case"add":for(r=0,n=a.length;r<n;r++)o=a[r],this.get(o)&&(this._ids[o]=!0,s.push(o));break;case"update":for(r=0,n=a.length;r<n;r++)o=a[r],this.get(o)?this._ids[o]?(l.push(o),c.push(t.data[r]),h.push(t.oldData[r])):(this._ids[o]=!0,s.push(o)):this._ids[o]&&(delete this._ids[o],u.push(o),d.push(t.oldData[r]));break;case"remove":for(r=0,n=a.length;r<n;r++)o=a[r],this._ids[o]&&(delete this._ids[o],u.push(o),d.push(t.oldData[r]))}this.length+=s.length-u.length,s.length&&this._trigger("add",{items:s},i),l.length&&this._trigger("update",{items:l,oldData:h,data:c},i),u.length&&this._trigger("remove",{items:u,oldData:d},i)}},l.prototype.on=s.prototype.on,l.prototype.off=s.prototype.off,l.prototype._trigger=s.prototype._trigger,l.prototype.subscribe=l.prototype.on,l.prototype.unsubscribe=l.prototype.off,e.exports=l},function(e,t,i){var r=i(57)("wks"),n=i(40),o=i(18).Symbol,a="function"==typeof o;(e.exports=function(e){return r[e]||(r[e]=a&&o[e]||(a?o:n)("Symbol."+e))}).store=r},function(e,t,i){t.prepareElements=function(e){for(var t in e)e.hasOwnProperty(t)&&(e[t].redundant=e[t].used,e[t].used=[])},t.cleanupElements=function(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t].redundant){for(var i=0;i<e[t].redundant.length;i++)e[t].redundant[i].parentNode.removeChild(e[t].redundant[i]);e[t].redundant=[]}},t.resetElements=function(e){t.prepareElements(e),t.cleanupElements(e),t.prepareElements(e)},t.getSVGElement=function(e,t,i){var r;return t.hasOwnProperty(e)?t[e].redundant.length>0?(r=t[e].redundant[0],t[e].redundant.shift()):(r=document.createElementNS("http://www.w3.org/2000/svg",e),i.appendChild(r)):(r=document.createElementNS("http://www.w3.org/2000/svg",e),t[e]={used:[],redundant:[]},i.appendChild(r)),t[e].used.push(r),r},t.getDOMElement=function(e,t,i,r){var n;return t.hasOwnProperty(e)?t[e].redundant.length>0?(n=t[e].redundant[0],t[e].redundant.shift()):(n=document.createElement(e),void 0!==r?i.insertBefore(n,r):i.appendChild(n)):(n=document.createElement(e),t[e]={used:[],redundant:[]},void 0!==r?i.insertBefore(n,r):i.appendChild(n)),t[e].used.push(n),n},t.drawPoint=function(e,i,r,n,o,a){var s;if("circle"==r.style?((s=t.getSVGElement("circle",n,o)).setAttributeNS(null,"cx",e),s.setAttributeNS(null,"cy",i),s.setAttributeNS(null,"r",.5*r.size)):((s=t.getSVGElement("rect",n,o)).setAttributeNS(null,"x",e-.5*r.size),s.setAttributeNS(null,"y",i-.5*r.size),s.setAttributeNS(null,"width",r.size),s.setAttributeNS(null,"height",r.size)),void 0!==r.styles&&s.setAttributeNS(null,"style",r.styles),s.setAttributeNS(null,"class",r.className+" vis-point"),a){var l=t.getSVGElement("text",n,o);a.xOffset&&(e+=a.xOffset),a.yOffset&&(i+=a.yOffset),a.content&&(l.textContent=a.content),a.className&&l.setAttributeNS(null,"class",a.className+" vis-label"),l.setAttributeNS(null,"x",e),l.setAttributeNS(null,"y",i)}return s},t.drawBar=function(e,i,r,n,o,a,s,l){if(0!=n){n<0&&(i-=n*=-1);var u=t.getSVGElement("rect",a,s);u.setAttributeNS(null,"x",e-.5*r),u.setAttributeNS(null,"y",i),u.setAttributeNS(null,"width",r),u.setAttributeNS(null,"height",n),u.setAttributeNS(null,"class",o),l&&u.setAttributeNS(null,"style",l)}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.printStyle=void 0;var r=l(i(19)),n=l(i(6)),o=l(i(8)),a=l(i(0)),s=l(i(1));function l(e){return e&&e.__esModule?e:{default:e}}var u=i(2),h=!1,c=void 0,d="background: #FFeeee; color: #dd0000",p=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,null,[{key:"validate",value:function(t,i,r){h=!1,c=i;var n=i;return void 0!==r&&(n=i[r]),e.parse(t,n,[]),h}},{key:"parse",value:function(t,i,r){for(var n in t)t.hasOwnProperty(n)&&e.check(n,t,i,r)}},{key:"check",value:function(t,i,r,n){if(void 0!==r[t]||void 0!==r.__any__){var o=t,a=!0;void 0===r[t]&&void 0!==r.__any__&&(o="__any__",a="object"===e.getType(i[t]));var s=r[o];a&&void 0!==s.__type__&&(s=s.__type__),e.checkFields(t,i,r,o,s,n)}else e.getSuggestion(t,r,n)}},{key:"checkFields",value:function(t,i,r,n,a,s){var l=function(i){console.log("%c"+i+e.printLocation(s,t),d)},c=e.getType(i[t]),p=a[c];void 0!==p?"array"===e.getType(p)&&-1===p.indexOf(i[t])?(l('Invalid option detected in "'+t+'". Allowed values are:'+e.print(p)+' not "'+i[t]+'". '),h=!0):"object"===c&&"__any__"!==n&&(s=u.copyAndExtendArray(s,t),e.parse(i[t],r[n],s)):void 0===a.any&&(l('Invalid type received for "'+t+'". Expected: '+e.print((0,o.default)(a))+". Received ["+c+'] "'+i[t]+'"'),h=!0)}},{key:"getType",value:function(e){var t=void 0===e?"undefined":(0,n.default)(e);return"object"===t?null===e?"null":e instanceof Boolean?"boolean":e instanceof Number?"number":e instanceof String?"string":Array.isArray(e)?"array":e instanceof Date?"date":void 0!==e.nodeType?"dom":!0===e._isAMomentObject?"moment":"object":"number"===t?"number":"boolean"===t?"boolean":"string"===t?"string":void 0===t?"undefined":t}},{key:"getSuggestion",value:function(t,i,r){var n=e.findInOptions(t,i,r,!1),a=e.findInOptions(t,c,[],!0),s=void 0;s=void 0!==n.indexMatch?" in "+e.printLocation(n.path,t,"")+'Perhaps it was incomplete? Did you mean: "'+n.indexMatch+'"?\n\n':a.distance<=4&&n.distance>a.distance?" in "+e.printLocation(n.path,t,"")+"Perhaps it was misplaced? Matching option found at: "+e.printLocation(a.path,a.closestMatch,""):n.distance<=8?'. Did you mean "'+n.closestMatch+'"?'+e.printLocation(n.path,t):". Did you mean one of these: "+e.print((0,o.default)(i))+e.printLocation(r,t),console.log('%cUnknown option detected: "'+t+'"'+s,d),h=!0}},{key:"findInOptions",value:function(t,i,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=1e9,a="",s=[],l=t.toLowerCase(),h=void 0;for(var c in i){var d=void 0;if(void 0!==i[c].__type__&&!0===n){var p=e.findInOptions(t,i[c],u.copyAndExtendArray(r,c));o>p.distance&&(a=p.closestMatch,s=p.path,o=p.distance,h=p.indexMatch)}else-1!==c.toLowerCase().indexOf(l)&&(h=c),o>(d=e.levenshteinDistance(t,c))&&(a=c,s=u.copyArray(r),o=d)}return{closestMatch:a,path:s,distance:o,indexMatch:h}}},{key:"printLocation",value:function(e,t){for(var i="\n\n"+(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Problem value found at: \n")+"options = {\n",r=0;r<e.length;r++){for(var n=0;n<r+1;n++)i+="  ";i+=e[r]+": {\n"}for(var o=0;o<e.length+1;o++)i+="  ";i+=t+"\n";for(var a=0;a<e.length+1;a++){for(var s=0;s<e.length-a;s++)i+="  ";i+="}\n"}return i+"\n\n"}},{key:"print",value:function(e){return(0,r.default)(e).replace(/(\")|(\[)|(\])|(,"__type__")/g,"").replace(/(\,)/g,", ")}},{key:"levenshteinDistance",value:function(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;var i,r,n=[];for(i=0;i<=t.length;i++)n[i]=[i];for(r=0;r<=e.length;r++)n[0][r]=r;for(i=1;i<=t.length;i++)for(r=1;r<=e.length;r++)t.charAt(i-1)==e.charAt(r-1)?n[i][r]=n[i-1][r-1]:n[i][r]=Math.min(n[i-1][r-1]+1,Math.min(n[i][r-1]+1,n[i-1][r]+1));return n[t.length][e.length]}}]),e}();t.default=p,t.printStyle=d},function(e,t,i){var r=i(2);function n(e,t){this.options=null,this.props=null}n.prototype.setOptions=function(e){e&&r.extend(this.options,e)},n.prototype.redraw=function(){return!1},n.prototype.destroy=function(){},n.prototype._isResized=function(){var e=this.props._previousWidth!==this.props.width||this.props._previousHeight!==this.props.height;return this.props._previousWidth=this.props.width,this.props._previousHeight=this.props.height,e},e.exports=n},function(e,t,i){var r=i(18),n=i(7),o=i(80),a=i(26),s=function(e,t,i){var l,u,h,c=e&s.F,d=e&s.G,p=e&s.S,f=e&s.P,m=e&s.B,v=e&s.W,g=d?n:n[t]||(n[t]={}),y=g.prototype,_=d?r:p?r[t]:(r[t]||{}).prototype;for(l in d&&(i=t),i)(u=!c&&_&&void 0!==_[l])&&l in g||(h=u?_[l]:i[l],g[l]=d&&"function"!=typeof _[l]?i[l]:m&&u?o(h,r):v&&_[l]==h?function(e){var t=function(t,i,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,i)}return new e(t,i,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(h):f&&"function"==typeof h?o(Function.call,h):h,f&&((g.virtual||(g.virtual={}))[l]=h,e&s.R&&y&&!y[l]&&a(y,l,h)))};s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,s.U=64,s.R=128,e.exports=s},function(e,t){var i=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(e,t,i){e.exports={default:i(160),__esModule:!0}},function(e,t,i){var r=i(27),n=i(81),o=i(53),a=Object.defineProperty;t.f=i(21)?Object.defineProperty:function(e,t,i){if(r(e),t=o(t,!0),r(i),n)try{return a(e,t,i)}catch(e){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(e[t]=i.value),e}},function(e,t,i){e.exports=!i(28)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t){var i={}.hasOwnProperty;e.exports=function(e,t){return i.call(e,t)}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=a(i(6)),n=a(i(0)),o=a(i(1));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t,i,r){(0,n.default)(this,e),this.body=i,this.labelModule=r,this.setOptions(t),this.top=void 0,this.left=void 0,this.height=void 0,this.width=void 0,this.radius=void 0,this.margin=void 0,this.refreshNeeded=!0,this.boundingBox={top:0,left:0,right:0,bottom:0}}return(0,o.default)(e,[{key:"setOptions",value:function(e){this.options=e}},{key:"_setMargins",value:function(e){this.margin={},this.options.margin&&("object"==(0,r.default)(this.options.margin)?(this.margin.top=this.options.margin.top,this.margin.right=this.options.margin.right,this.margin.bottom=this.options.margin.bottom,this.margin.left=this.options.margin.left):(this.margin.top=this.options.margin,this.margin.right=this.options.margin,this.margin.bottom=this.options.margin,this.margin.left=this.options.margin)),e.adjustSizes(this.margin)}},{key:"_distanceToBorder",value:function(e,t){var i=this.options.borderWidth;return this.resize(e),Math.min(Math.abs(this.width/2/Math.cos(t)),Math.abs(this.height/2/Math.sin(t)))+i}},{key:"enableShadow",value:function(e,t){t.shadow&&(e.shadowColor=t.shadowColor,e.shadowBlur=t.shadowSize,e.shadowOffsetX=t.shadowX,e.shadowOffsetY=t.shadowY)}},{key:"disableShadow",value:function(e,t){t.shadow&&(e.shadowColor="rgba(0,0,0,0)",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0)}},{key:"enableBorderDashes",value:function(e,t){if(!1!==t.borderDashes)if(void 0!==e.setLineDash){var i=t.borderDashes;!0===i&&(i=[5,15]),e.setLineDash(i)}else console.warn("setLineDash is not supported in this browser. The dashed borders cannot be used."),this.options.shapeProperties.borderDashes=!1,t.borderDashes=!1}},{key:"disableBorderDashes",value:function(e,t){!1!==t.borderDashes&&(void 0!==e.setLineDash?e.setLineDash([0]):(console.warn("setLineDash is not supported in this browser. The dashed borders cannot be used."),this.options.shapeProperties.borderDashes=!1,t.borderDashes=!1))}},{key:"needsRefresh",value:function(e,t){return!0===this.refreshNeeded?(this.refreshNeeded=!1,!0):void 0===this.width||this.labelModule.differentState(e,t)}},{key:"initContextForDraw",value:function(e,t){var i=t.borderWidth/this.body.view.scale;e.lineWidth=Math.min(this.width,i),e.strokeStyle=t.borderColor,e.fillStyle=t.color}},{key:"performStroke",value:function(e,t){var i=t.borderWidth/this.body.view.scale;e.save(),i>0&&(this.enableBorderDashes(e,t),e.stroke(),this.disableBorderDashes(e,t)),e.restore()}},{key:"performFill",value:function(e,t){this.enableShadow(e,t),e.fill(),this.disableShadow(e,t),this.performStroke(e,t)}},{key:"_addBoundingBoxMargin",value:function(e){this.boundingBox.left-=e,this.boundingBox.top-=e,this.boundingBox.bottom+=e,this.boundingBox.right+=e}},{key:"_updateBoundingBox",value:function(e,t,i,r,n){void 0!==i&&this.resize(i,r,n),this.left=e-this.width/2,this.top=t-this.height/2,this.boundingBox.left=this.left,this.boundingBox.top=this.top,this.boundingBox.bottom=this.top+this.height,this.boundingBox.right=this.left+this.width}},{key:"updateBoundingBox",value:function(e,t,i,r,n){this._updateBoundingBox(e,t,i,r,n)}},{key:"getDimensionsFromLabel",value:function(e,t,i){this.textSize=this.labelModule.getTextSize(e,t,i);var r=this.textSize.width,n=this.textSize.height;return 0===r&&(r=14,n=14),{width:r,height:n}}}]),e}();t.default=s},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o){return(0,n.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"resize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selected,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.hover,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:this.options.size};if(this.needsRefresh(t,i)){this.labelModule.getTextSize(e,t,i);var n=2*r.size;this.width=n,this.height=n,this.radius=.5*this.width}}},{key:"_drawShape",value:function(e,t,i,r,n,o,a,s){if(this.resize(e,o,a,s),this.left=r-this.width/2,this.top=n-this.height/2,this.initContextForDraw(e,s),e[t](r,n,s.size),this.performFill(e,s),void 0!==this.options.label){this.labelModule.calculateLabelSize(e,o,a,r,n,"hanging");var l=n+.5*this.height+.5*this.labelModule.size.height;this.labelModule.draw(e,r,l,o,a,"hanging")}this.updateBoundingBox(r,n)}},{key:"updateBoundingBox",value:function(e,t){this.boundingBox.top=t-this.options.size,this.boundingBox.left=e-this.options.size,this.boundingBox.right=e+this.options.size,this.boundingBox.bottom=t+this.options.size,void 0!==this.options.label&&this.labelModule.size.width>0&&(this.boundingBox.left=Math.min(this.boundingBox.left,this.labelModule.size.left),this.boundingBox.right=Math.max(this.boundingBox.right,this.labelModule.size.left+this.labelModule.size.width),this.boundingBox.bottom=Math.max(this.boundingBox.bottom,this.boundingBox.bottom+this.labelModule.size.height))}}]),t}(l(i(23)).default);t.default=u},function(e,t,i){var r=i(78),n=i(51);e.exports=function(e){return r(n(e))}},function(e,t,i){var r=i(20),n=i(39);e.exports=i(21)?function(e,t,i){return r.f(e,t,n(1,i))}:function(e,t,i){return e[t]=i,e}},function(e,t,i){var r=i(32);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,i){e.exports={default:i(138),__esModule:!0}},function(e,t,i){t.__esModule=!0;var r=o(i(188)),n=o(i(77));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){return function(e,t){if(Array.isArray(e))return e;if((0,r.default)(Object(e)))return function(e,t){var i=[],r=!0,o=!1,a=void 0;try{for(var s,l=(0,n.default)(e);!(r=(s=l.next()).done)&&(i.push(s.value),!t||i.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{!r&&l.return&&l.return()}finally{if(o)throw a}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},function(e,t){e.exports={}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,i){var r=i(84),n=i(58);e.exports=Object.keys||function(e){return r(e,n)}},function(e,t,i){function r(e,t,i){this.x=void 0!==e?e:0,this.y=void 0!==t?t:0,this.z=void 0!==i?i:0}r.subtract=function(e,t){var i=new r;return i.x=e.x-t.x,i.y=e.y-t.y,i.z=e.z-t.z,i},r.add=function(e,t){var i=new r;return i.x=e.x+t.x,i.y=e.y+t.y,i.z=e.z+t.z,i},r.avg=function(e,t){return new r((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2)},r.crossProduct=function(e,t){var i=new r;return i.x=e.y*t.z-e.z*t.y,i.y=e.z*t.x-e.x*t.z,i.z=e.x*t.y-e.y*t.x,i},r.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},e.exports=r},function(e,t,i){var r,n,o;n=[],void 0===(o="function"==typeof(r=function(){return function(e){var t,i=e&&e.preventDefault||!1,r=e&&e.container||window,n={},o={keydown:{},keyup:{}},a={};for(t=97;t<=122;t++)a[String.fromCharCode(t)]={code:t-97+65,shift:!1};for(t=65;t<=90;t++)a[String.fromCharCode(t)]={code:t,shift:!0};for(t=0;t<=9;t++)a[""+t]={code:48+t,shift:!1};for(t=1;t<=12;t++)a["F"+t]={code:111+t,shift:!1};for(t=0;t<=9;t++)a["num"+t]={code:96+t,shift:!1};a["num*"]={code:106,shift:!1},a["num+"]={code:107,shift:!1},a["num-"]={code:109,shift:!1},a["num/"]={code:111,shift:!1},a["num."]={code:110,shift:!1},a.left={code:37,shift:!1},a.up={code:38,shift:!1},a.right={code:39,shift:!1},a.down={code:40,shift:!1},a.space={code:32,shift:!1},a.enter={code:13,shift:!1},a.shift={code:16,shift:void 0},a.esc={code:27,shift:!1},a.backspace={code:8,shift:!1},a.tab={code:9,shift:!1},a.ctrl={code:17,shift:!1},a.alt={code:18,shift:!1},a.delete={code:46,shift:!1},a.pageup={code:33,shift:!1},a.pagedown={code:34,shift:!1},a["="]={code:187,shift:!1},a["-"]={code:189,shift:!1},a["]"]={code:221,shift:!1},a["["]={code:219,shift:!1};var s=function(e){u(e,"keydown")},l=function(e){u(e,"keyup")},u=function(e,t){if(void 0!==o[t][e.keyCode]){for(var r=o[t][e.keyCode],n=0;n<r.length;n++)void 0===r[n].shift?r[n].fn(e):1==r[n].shift&&1==e.shiftKey?r[n].fn(e):0==r[n].shift&&0==e.shiftKey&&r[n].fn(e);1==i&&e.preventDefault()}};return n.bind=function(e,t,i){if(void 0===i&&(i="keydown"),void 0===a[e])throw new Error("unsupported key: "+e);void 0===o[i][a[e].code]&&(o[i][a[e].code]=[]),o[i][a[e].code].push({fn:t,shift:a[e].shift})},n.bindAll=function(e,t){for(var i in void 0===t&&(t="keydown"),a)a.hasOwnProperty(i)&&n.bind(i,e,t)},n.getKey=function(e){for(var t in a)if(a.hasOwnProperty(t)){if(1==e.shiftKey&&1==a[t].shift&&e.keyCode==a[t].code)return t;if(0==e.shiftKey&&0==a[t].shift&&e.keyCode==a[t].code)return t;if(e.keyCode==a[t].code&&"shift"==t)return t}return"unknown key, currently not supported"},n.unbind=function(e,t,i){if(void 0===i&&(i="keydown"),void 0===a[e])throw new Error("unsupported key: "+e);if(void 0!==t){var r=[],n=o[i][a[e].code];if(void 0!==n)for(var s=0;s<n.length;s++)n[s].fn==t&&n[s].shift==a[e].shift||r.push(o[i][a[e].code][s]);o[i][a[e].code]=r}else o[i][a[e].code]=[]},n.reset=function(){o={keydown:{},keyup:{}}},n.destroy=function(){o={keydown:{},keyup:{}},r.removeEventListener("keydown",s,!0),r.removeEventListener("keyup",l,!0)},r.addEventListener("keydown",s,!0),r.addEventListener("keyup",l,!0),n}})?r.apply(t,n):r)||(e.exports=o)},function(e,t,i){t.convertHiddenOptions=function(e,i,r){if(r&&!Array.isArray(r))return t.convertHiddenOptions(e,i,[r]);if(i.hiddenDates=[],r&&1==Array.isArray(r)){for(var n=0;n<r.length;n++)if(void 0===r[n].repeat){var o={};o.start=e(r[n].start).toDate().valueOf(),o.end=e(r[n].end).toDate().valueOf(),i.hiddenDates.push(o)}i.hiddenDates.sort(function(e,t){return e.start-t.start})}},t.updateHiddenDates=function(e,i,r){if(r&&!Array.isArray(r))return t.updateHiddenDates(e,i,[r]);if(r&&void 0!==i.domProps.centerContainer.width){t.convertHiddenOptions(e,i,r);for(var n=e(i.range.start),o=e(i.range.end),a=(i.range.end-i.range.start)/i.domProps.centerContainer.width,s=0;s<r.length;s++)if(void 0!==r[s].repeat){var l=e(r[s].start),u=e(r[s].end);if("Invalid Date"==l._d)throw new Error("Supplied start date is not valid: "+r[s].start);if("Invalid Date"==u._d)throw new Error("Supplied end date is not valid: "+r[s].end);if(u-l>=4*a){var h=0,c=o.clone();switch(r[s].repeat){case"daily":l.day()!=u.day()&&(h=1),l.dayOfYear(n.dayOfYear()),l.year(n.year()),l.subtract(7,"days"),u.dayOfYear(n.dayOfYear()),u.year(n.year()),u.subtract(7-h,"days"),c.add(1,"weeks");break;case"weekly":var d=u.diff(l,"days"),p=l.day();l.date(n.date()),l.month(n.month()),l.year(n.year()),u=l.clone(),l.day(p),u.day(p),u.add(d,"days"),l.subtract(1,"weeks"),u.subtract(1,"weeks"),c.add(1,"weeks");break;case"monthly":l.month()!=u.month()&&(h=1),l.month(n.month()),l.year(n.year()),l.subtract(1,"months"),u.month(n.month()),u.year(n.year()),u.subtract(1,"months"),u.add(h,"months"),c.add(1,"months");break;case"yearly":l.year()!=u.year()&&(h=1),l.year(n.year()),l.subtract(1,"years"),u.year(n.year()),u.subtract(1,"years"),u.add(h,"years"),c.add(1,"years");break;default:return void console.log("Wrong repeat format, allowed are: daily, weekly, monthly, yearly. Given:",r[s].repeat)}for(;l<c;)switch(i.hiddenDates.push({start:l.valueOf(),end:u.valueOf()}),r[s].repeat){case"daily":l.add(1,"days"),u.add(1,"days");break;case"weekly":l.add(1,"weeks"),u.add(1,"weeks");break;case"monthly":l.add(1,"months"),u.add(1,"months");break;case"yearly":l.add(1,"y"),u.add(1,"y");break;default:return void console.log("Wrong repeat format, allowed are: daily, weekly, monthly, yearly. Given:",r[s].repeat)}i.hiddenDates.push({start:l.valueOf(),end:u.valueOf()})}}t.removeDuplicates(i);var f=t.isHidden(i.range.start,i.hiddenDates),m=t.isHidden(i.range.end,i.hiddenDates),v=i.range.start,g=i.range.end;1==f.hidden&&(v=1==i.range.startToFront?f.startDate-1:f.endDate+1),1==m.hidden&&(g=1==i.range.endToFront?m.startDate-1:m.endDate+1),1!=f.hidden&&1!=m.hidden||i.range._applyRange(v,g)}},t.removeDuplicates=function(e){for(var t=e.hiddenDates,i=[],r=0;r<t.length;r++)for(var n=0;n<t.length;n++)r!=n&&1!=t[n].remove&&1!=t[r].remove&&(t[n].start>=t[r].start&&t[n].end<=t[r].end?t[n].remove=!0:t[n].start>=t[r].start&&t[n].start<=t[r].end?(t[r].end=t[n].end,t[n].remove=!0):t[n].end>=t[r].start&&t[n].end<=t[r].end&&(t[r].start=t[n].start,t[n].remove=!0));for(r=0;r<t.length;r++)!0!==t[r].remove&&i.push(t[r]);e.hiddenDates=i,e.hiddenDates.sort(function(e,t){return e.start-t.start})},t.printDates=function(e){for(var t=0;t<e.length;t++)console.log(t,new Date(e[t].start),new Date(e[t].end),e[t].start,e[t].end,e[t].remove)},t.stepOverHiddenDates=function(e,t,i){for(var r=!1,n=t.current.valueOf(),o=0;o<t.hiddenDates.length;o++){var a=t.hiddenDates[o].start,s=t.hiddenDates[o].end;if(n>=a&&n<s){r=!0;break}}if(1==r&&n<t._end.valueOf()&&n!=i){var l=e(i),u=e(s);l.year()!=u.year()?t.switchedYear=!0:l.month()!=u.month()?t.switchedMonth=!0:l.dayOfYear()!=u.dayOfYear()&&(t.switchedDay=!0),t.current=u}},t.toScreen=function(e,i,r){var n;if(0==e.body.hiddenDates.length)return n=e.range.conversion(r),(i.valueOf()-n.offset)*n.scale;var o=t.isHidden(i,e.body.hiddenDates);1==o.hidden&&(i=o.startDate);var a=t.getHiddenDurationBetween(e.body.hiddenDates,e.range.start,e.range.end);if(i<e.range.start){n=e.range.conversion(r,a);var s=t.getHiddenDurationBeforeStart(e.body.hiddenDates,i,n.offset);return i=e.options.moment(i).toDate().valueOf(),i+=s,-(n.offset-i.valueOf())*n.scale}if(i>e.range.end){var l={start:e.range.start,end:i};return i=t.correctTimeForHidden(e.options.moment,e.body.hiddenDates,l,i),n=e.range.conversion(r,a),(i.valueOf()-n.offset)*n.scale}return i=t.correctTimeForHidden(e.options.moment,e.body.hiddenDates,e.range,i),n=e.range.conversion(r,a),(i.valueOf()-n.offset)*n.scale},t.toTime=function(e,i,r){if(0==e.body.hiddenDates.length){var n=e.range.conversion(r);return new Date(i/n.scale+n.offset)}var o=t.getHiddenDurationBetween(e.body.hiddenDates,e.range.start,e.range.end),a=(e.range.end-e.range.start-o)*i/r,s=t.getAccumulatedHiddenDuration(e.body.hiddenDates,e.range,a);return new Date(s+a+e.range.start)},t.getHiddenDurationBetween=function(e,t,i){for(var r=0,n=0;n<e.length;n++){var o=e[n].start,a=e[n].end;o>=t&&a<i&&(r+=a-o)}return r},t.getHiddenDurationBeforeStart=function(e,t,i){for(var r=0,n=0;n<e.length;n++){var o=e[n].start,a=e[n].end;o>=t&&a<=i&&(r+=a-o)}return r},t.correctTimeForHidden=function(e,i,r,n){return n=e(n).toDate().valueOf(),n-=t.getHiddenDurationBefore(e,i,r,n)},t.getHiddenDurationBefore=function(e,t,i,r){var n=0;r=e(r).toDate().valueOf();for(var o=0;o<t.length;o++){var a=t[o].start,s=t[o].end;a>=i.start&&s<i.end&&r>=s&&(n+=s-a)}return n},t.getAccumulatedHiddenDuration=function(e,t,i){for(var r=0,n=0,o=t.start,a=0;a<e.length;a++){var s=e[a].start,l=e[a].end;if(s>=t.start&&l<t.end){if(n+=s-o,o=l,n>=i)break;r+=l-s}}return r},t.snapAwayFromHidden=function(e,i,r,n){var o=t.isHidden(i,e);return 1==o.hidden?r<0?1==n?o.startDate-(o.endDate-i)-1:o.startDate-1:1==n?o.endDate+(i-o.startDate)+1:o.endDate+1:i},t.isHidden=function(e,t){for(var i=0;i<t.length;i++){var r=t[i].start,n=t[i].end;if(e>=r&&e<n)return{hidden:!0,startDate:r,endDate:n}}return{hidden:!1,startDate:r,endDate:n}}},function(e,t,i){t.onTouch=function(e,t){t.inputHandler=function(e){e.isFirst&&t(e)},e.on("hammer.input",t.inputHandler)},t.onRelease=function(e,t){return t.inputHandler=function(e){e.isFinal&&t(e)},e.on("hammer.input",t.inputHandler)},t.offTouch=function(e,t){e.off("hammer.input",t.inputHandler)},t.offRelease=t.offTouch,t.disablePreventDefaultVertically=function(e){return e.getTouchAction=function(){return["pan-y"]},e}},function(e,t,i){var r=o(i(6)),n=o(i(8));function o(e){return e&&e.__esModule?e:{default:e}}var a=i(10),s=i(2),l=i(9);function u(e,t,i){this.id=null,this.parent=null,this.data=e,this.dom=null,this.conversion=t||{},this.options=i||{},this.selected=!1,this.displayed=!1,this.groupShowing=!0,this.dirty=!0,this.top=null,this.right=null,this.left=null,this.width=null,this.height=null,this.editable=null,this._updateEditStatus()}u.prototype.stack=!0,u.prototype.select=function(){this.selected=!0,this.dirty=!0,this.displayed&&this.redraw()},u.prototype.unselect=function(){this.selected=!1,this.dirty=!0,this.displayed&&this.redraw()},u.prototype.setData=function(e){null!=e.group&&this.data.group!=e.group&&null!=this.parent&&this.parent.itemSet._moveToGroup(this,e.group),this.parent&&(this.parent.stackDirty=!0),null!=e.subgroup&&this.data.subgroup!=e.subgroup&&null!=this.parent&&this.parent.changeSubgroup(this,this.data.subgroup,e.subgroup),this.data=e,this._updateEditStatus(),this.dirty=!0,this.displayed&&this.redraw()},u.prototype.setParent=function(e){this.displayed?(this.hide(),this.parent=e,this.parent&&this.show()):this.parent=e},u.prototype.isVisible=function(e){return!1},u.prototype.show=function(){return!1},u.prototype.hide=function(){return!1},u.prototype.redraw=function(){},u.prototype.repositionX=function(){},u.prototype.repositionY=function(){},u.prototype._repaintDragCenter=function(){if(this.selected&&this.options.editable.updateTime&&!this.dom.dragCenter){var e=this,t=document.createElement("div");t.className="vis-drag-center",t.dragCenterItem=this;var i=new a(t);i.on("tap",function(t){e.parent.itemSet.body.emitter.emit("click",{event:t,item:e.id})}),i.on("doubletap",function(t){t.stopPropagation(),e.parent.itemSet._onUpdateItem(e),e.parent.itemSet.body.emitter.emit("doubleClick",{event:t,item:e.id})}),this.dom.box?this.dom.dragLeft?this.dom.box.insertBefore(t,this.dom.dragLeft):this.dom.box.appendChild(t):this.dom.point&&this.dom.point.appendChild(t),this.dom.dragCenter=t}else!this.selected&&this.dom.dragCenter&&(this.dom.dragCenter.parentNode&&this.dom.dragCenter.parentNode.removeChild(this.dom.dragCenter),this.dom.dragCenter=null)},u.prototype._repaintDeleteButton=function(e){var t=(this.options.editable.overrideItems||null==this.editable)&&this.options.editable.remove||!this.options.editable.overrideItems&&null!=this.editable&&this.editable.remove;if(this.selected&&t&&!this.dom.deleteButton){var i=this,r=document.createElement("div");this.options.rtl?r.className="vis-delete-rtl":r.className="vis-delete",r.title="Delete this item",new a(r).on("tap",function(e){e.stopPropagation(),i.parent.removeFromDataSet(i)}),e.appendChild(r),this.dom.deleteButton=r}else!this.selected&&this.dom.deleteButton&&(this.dom.deleteButton.parentNode&&this.dom.deleteButton.parentNode.removeChild(this.dom.deleteButton),this.dom.deleteButton=null)},u.prototype._repaintOnItemUpdateTimeTooltip=function(e){if(this.options.tooltipOnItemUpdateTime){var t=(this.options.editable.updateTime||!0===this.data.editable)&&!1!==this.data.editable;if(this.selected&&t&&!this.dom.onItemUpdateTimeTooltip){var i=document.createElement("div");i.className="vis-onUpdateTime-tooltip",e.appendChild(i),this.dom.onItemUpdateTimeTooltip=i}else!this.selected&&this.dom.onItemUpdateTimeTooltip&&(this.dom.onItemUpdateTimeTooltip.parentNode&&this.dom.onItemUpdateTimeTooltip.parentNode.removeChild(this.dom.onItemUpdateTimeTooltip),this.dom.onItemUpdateTimeTooltip=null);if(this.dom.onItemUpdateTimeTooltip){this.dom.onItemUpdateTimeTooltip.style.visibility=this.parent.itemSet.touchParams.itemIsDragging?"visible":"hidden",this.options.rtl?this.dom.onItemUpdateTimeTooltip.style.right=this.dom.content.style.right:this.dom.onItemUpdateTimeTooltip.style.left=this.dom.content.style.left;var r,n=this.parent.itemSet.body.domProps.scrollTop;("top"==this.options.orientation.item?this.top:this.parent.height-this.top-this.height)+this.parent.top-50<-n?(this.dom.onItemUpdateTimeTooltip.style.bottom="",this.dom.onItemUpdateTimeTooltip.style.top=this.height+2+"px"):(this.dom.onItemUpdateTimeTooltip.style.top="",this.dom.onItemUpdateTimeTooltip.style.bottom=this.height+2+"px"),this.options.tooltipOnItemUpdateTime&&this.options.tooltipOnItemUpdateTime.template?r=this.options.tooltipOnItemUpdateTime.template.bind(this)(this.data):(r="start: "+l(this.data.start).format("MM/DD/YYYY hh:mm"),this.data.end&&(r+="<br> end: "+l(this.data.end).format("MM/DD/YYYY hh:mm"))),this.dom.onItemUpdateTimeTooltip.innerHTML=r}}},u.prototype._updateContents=function(e){var t,i,r,n,o=this.parent.itemSet.itemsData.get(this.id),a=this.dom.box||this.dom.point,s=a.getElementsByClassName("vis-item-visible-frame")[0];if(r=this.options.visibleFrameTemplate?(n=this.options.visibleFrameTemplate.bind(this))(o,a):"",s)if(r instanceof Object&&!(r instanceof Element))n(o,s);else if(this._contentToString(this.itemVisibleFrameContent)!==this._contentToString(r)){if(r instanceof Element)s.innerHTML="",s.appendChild(r);else if(null!=r)s.innerHTML=r;else if("background"!=this.data.type||void 0!==this.data.content)throw new Error('Property "content" missing in item '+this.id);this.itemVisibleFrameContent=r}if((t=this.options.template?(i=this.options.template.bind(this))(o,e,this.data):this.data.content)instanceof Object&&!(t instanceof Element))i(o,e);else if(this._contentToString(this.content)!==this._contentToString(t)){if(t instanceof Element)e.innerHTML="",e.appendChild(t);else if(null!=t)e.innerHTML=t;else if("background"!=this.data.type||void 0!==this.data.content)throw new Error('Property "content" missing in item '+this.id);this.content=t}},u.prototype._updateDataAttributes=function(e){if(this.options.dataAttributes&&this.options.dataAttributes.length>0){var t=[];if(Array.isArray(this.options.dataAttributes))t=this.options.dataAttributes;else{if("all"!=this.options.dataAttributes)return;t=(0,n.default)(this.data)}for(var i=0;i<t.length;i++){var r=t[i],o=this.data[r];null!=o?e.setAttribute("data-"+r,o):e.removeAttribute("data-"+r)}}},u.prototype._updateStyle=function(e){this.style&&(s.removeCssText(e,this.style),this.style=null),this.data.style&&(s.addCssText(e,this.data.style),this.style=this.data.style)},u.prototype._contentToString=function(e){return"string"==typeof e?e:e&&"outerHTML"in e?e.outerHTML:e},u.prototype._updateEditStatus=function(){this.options&&("boolean"==typeof this.options.editable?this.editable={updateTime:this.options.editable,updateGroup:this.options.editable,remove:this.options.editable}:"object"===(0,r.default)(this.options.editable)&&(this.editable={},s.selectiveExtend(["updateTime","updateGroup","remove"],this.editable,this.options.editable))),this.options&&this.options.editable&&!0===this.options.editable.overrideItems||this.data&&("boolean"==typeof this.data.editable?this.editable={updateTime:this.data.editable,updateGroup:this.data.editable,remove:this.data.editable}:"object"===(0,r.default)(this.data.editable)&&(this.editable={},s.selectiveExtend(["updateTime","updateGroup","remove"],this.editable,this.data.editable)))},u.prototype.getWidthLeft=function(){return 0},u.prototype.getWidthRight=function(){return 0},u.prototype.getTitle=function(){return this.data.title},e.exports=u},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){var i=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++i+r).toString(36))}},function(e,t,i){var r=i(51);e.exports=function(e){return Object(r(e))}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,i){function r(e){this.delay=null,this.max=1/0,this._queue=[],this._timeout=null,this._extended=null,this.setOptions(e)}r.prototype.setOptions=function(e){e&&void 0!==e.delay&&(this.delay=e.delay),e&&void 0!==e.max&&(this.max=e.max),this._flushIfNeeded()},r.extend=function(e,t){var i=new r(t);if(void 0!==e.flush)throw new Error("Target object already has a property flush");e.flush=function(){i.flush()};var n=[{name:"flush",original:void 0}];if(t&&t.replace)for(var o=0;o<t.replace.length;o++){var a=t.replace[o];n.push({name:a,original:e[a]}),i.replace(e,a)}return i._extended={object:e,methods:n},i},r.prototype.destroy=function(){if(this.flush(),this._extended){for(var e=this._extended.object,t=this._extended.methods,i=0;i<t.length;i++){var r=t[i];r.original?e[r.name]=r.original:delete e[r.name]}this._extended=null}},r.prototype.replace=function(e,t){var i=this,r=e[t];if(!r)throw new Error("Method "+t+" undefined");e[t]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.queue({args:e,fn:r,context:this})}},r.prototype.queue=function(e){"function"==typeof e?this._queue.push({fn:e}):this._queue.push(e),this._flushIfNeeded()},r.prototype._flushIfNeeded=function(){if(this._queue.length>this.max&&this.flush(),clearTimeout(this._timeout),this.queue.length>0&&"number"==typeof this.delay){var e=this;this._timeout=setTimeout(function(){e.flush()},this.delay)}},r.prototype.flush=function(){for(;this._queue.length>0;){var e=this._queue.shift();e.fn.apply(e.context||e.fn,e.args||[])}},e.exports=r},function(e,t){function i(e){if(e)return function(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}(e)}e.exports=i,i.prototype.on=i.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},i.prototype.once=function(e,t){var i=this;function r(){i.off(e,r),t.apply(this,arguments)}return this._callbacks=this._callbacks||{},r.fn=t,this.on(e,r),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var i,r=this._callbacks[e];if(!r)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var n=0;n<r.length;n++)if((i=r[n])===t||i.fn===t){r.splice(n,1);break}return this},i.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),i=this._callbacks[e];if(i)for(var r=0,n=(i=i.slice(0)).length;r<n;++r)i[r].apply(this,t);return this},i.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},i.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,i){var r,n=i(6),o=(r=n)&&r.__esModule?r:{default:r};var a=i(2),s=i(16),l=i(66),u=i(36),h=i(9);function c(e,t){this.dom={foreground:null,lines:[],majorTexts:[],minorTexts:[],redundant:{lines:[],majorTexts:[],minorTexts:[]}},this.props={range:{start:0,end:0,minimumStep:0},lineTop:0},this.defaultOptions={orientation:{axis:"bottom"},showMinorLabels:!0,showMajorLabels:!0,maxMinorChars:7,format:l.FORMAT,moment:h,timeAxis:null},this.options=a.extend({},this.defaultOptions),this.body=e,this._create(),this.setOptions(t)}c.prototype=new s,c.prototype.setOptions=function(e){e&&(a.selectiveExtend(["showMinorLabels","showMajorLabels","maxMinorChars","hiddenDates","timeAxis","moment","rtl"],this.options,e),a.selectiveDeepExtend(["format"],this.options,e),"orientation"in e&&("string"==typeof e.orientation?this.options.orientation.axis=e.orientation:"object"===(0,o.default)(e.orientation)&&"axis"in e.orientation&&(this.options.orientation.axis=e.orientation.axis)),"locale"in e&&("function"==typeof h.locale?h.locale(e.locale):h.lang(e.locale)))},c.prototype._create=function(){this.dom.foreground=document.createElement("div"),this.dom.background=document.createElement("div"),this.dom.foreground.className="vis-time-axis vis-foreground",this.dom.background.className="vis-time-axis vis-background"},c.prototype.destroy=function(){this.dom.foreground.parentNode&&this.dom.foreground.parentNode.removeChild(this.dom.foreground),this.dom.background.parentNode&&this.dom.background.parentNode.removeChild(this.dom.background),this.body=null},c.prototype.redraw=function(){var e=this.props,t=this.dom.foreground,i=this.dom.background,r="top"==this.options.orientation.axis?this.body.dom.top:this.body.dom.bottom,n=t.parentNode!==r;this._calculateCharSize();var o=this.options.showMinorLabels&&"none"!==this.options.orientation.axis,a=this.options.showMajorLabels&&"none"!==this.options.orientation.axis;e.minorLabelHeight=o?e.minorCharHeight:0,e.majorLabelHeight=a?e.majorCharHeight:0,e.height=e.minorLabelHeight+e.majorLabelHeight,e.width=t.offsetWidth,e.minorLineHeight=this.body.domProps.root.height-e.majorLabelHeight-("top"==this.options.orientation.axis?this.body.domProps.bottom.height:this.body.domProps.top.height),e.minorLineWidth=1,e.majorLineHeight=e.minorLineHeight+e.majorLabelHeight,e.majorLineWidth=1;var s=t.nextSibling,l=i.nextSibling;return t.parentNode&&t.parentNode.removeChild(t),i.parentNode&&i.parentNode.removeChild(i),t.style.height=this.props.height+"px",this._repaintLabels(),s?r.insertBefore(t,s):r.appendChild(t),l?this.body.dom.backgroundVertical.insertBefore(i,l):this.body.dom.backgroundVertical.appendChild(i),this._isResized()||n},c.prototype._repaintLabels=function(){var e=this.options.orientation.axis,t=a.convert(this.body.range.start,"Number"),i=a.convert(this.body.range.end,"Number"),r=this.body.util.toTime((this.props.minorCharWidth||10)*this.options.maxMinorChars).valueOf(),n=r-u.getHiddenDurationBefore(this.options.moment,this.body.hiddenDates,this.body.range,r);n-=this.body.util.toTime(0).valueOf();var o=new l(new Date(t),new Date(i),n,this.body.hiddenDates,this.options);o.setMoment(this.options.moment),this.options.format&&o.setFormat(this.options.format),this.options.timeAxis&&o.setScale(this.options.timeAxis),this.step=o;var s,h,c,p,f,m=this.dom;m.redundant.lines=m.lines,m.redundant.majorTexts=m.majorTexts,m.redundant.minorTexts=m.minorTexts,m.lines=[],m.majorTexts=[],m.minorTexts=[];var v,g,y,_,b=0,x=void 0,w=0;for(o.start(),s=o.getCurrent(),c=this.body.util.toScreen(s);o.hasNext()&&w<1e3;){switch(w++,p=o.isMajor(),_=o.getClassName(),y=o.getLabelMinor(),s,h=c,o.next(),s=o.getCurrent(),o.isMajor(),v=b,b=(c=this.body.util.toScreen(s))-h,o.scale){case"week":f=!0;break;default:f=b>=.4*v}if(this.options.showMinorLabels&&f){var S=this._repaintMinorText(h,y,e,_);S.style.width=b+"px"}p&&this.options.showMajorLabels?(h>0&&(null==x&&(x=h),S=this._repaintMajorText(h,o.getLabelMajor(),e,_)),g=this._repaintMajorLine(h,b,e,_)):f?g=this._repaintMinorLine(h,b,e,_):g&&(g.style.width=parseInt(g.style.width)+b+"px")}if(1e3!==w||d||(console.warn("Something is wrong with the Timeline scale. Limited drawing of grid lines to 1000 lines."),d=!0),this.options.showMajorLabels){var M=this.body.util.toTime(0),T=o.getLabelMajor(M),A=T.length*(this.props.majorCharWidth||10)+10;(null==x||A<x)&&this._repaintMajorText(0,T,e,_)}a.forEach(this.dom.redundant,function(e){for(;e.length;){var t=e.pop();t&&t.parentNode&&t.parentNode.removeChild(t)}})},c.prototype._repaintMinorText=function(e,t,i,r){var n=this.dom.redundant.minorTexts.shift();if(!n){var o=document.createTextNode("");(n=document.createElement("div")).appendChild(o),this.dom.foreground.appendChild(n)}return this.dom.minorTexts.push(n),n.innerHTML=t,n.style.top="top"==i?this.props.majorLabelHeight+"px":"0",this.options.rtl?(n.style.left="",n.style.right=e+"px"):n.style.left=e+"px",n.className="vis-text vis-minor "+r,n},c.prototype._repaintMajorText=function(e,t,i,r){var n=this.dom.redundant.majorTexts.shift();if(!n){var o=document.createElement("div");(n=document.createElement("div")).appendChild(o),this.dom.foreground.appendChild(n)}return n.childNodes[0].innerHTML=t,n.className="vis-text vis-major "+r,n.style.top="top"==i?"0":this.props.minorLabelHeight+"px",this.options.rtl?(n.style.left="",n.style.right=e+"px"):n.style.left=e+"px",this.dom.majorTexts.push(n),n},c.prototype._repaintMinorLine=function(e,t,i,r){var n=this.dom.redundant.lines.shift();n||(n=document.createElement("div"),this.dom.background.appendChild(n)),this.dom.lines.push(n);var o=this.props;return n.style.top="top"==i?o.majorLabelHeight+"px":this.body.domProps.top.height+"px",n.style.height=o.minorLineHeight+"px",this.options.rtl?(n.style.left="",n.style.right=e-o.minorLineWidth/2+"px",n.className="vis-grid vis-vertical-rtl vis-minor "+r):(n.style.left=e-o.minorLineWidth/2+"px",n.className="vis-grid vis-vertical vis-minor "+r),n.style.width=t+"px",n},c.prototype._repaintMajorLine=function(e,t,i,r){var n=this.dom.redundant.lines.shift();n||(n=document.createElement("div"),this.dom.background.appendChild(n)),this.dom.lines.push(n);var o=this.props;return n.style.top="top"==i?"0":this.body.domProps.top.height+"px",this.options.rtl?(n.style.left="",n.style.right=e-o.majorLineWidth/2+"px",n.className="vis-grid vis-vertical-rtl vis-major "+r):(n.style.left=e-o.majorLineWidth/2+"px",n.className="vis-grid vis-vertical vis-major "+r),n.style.height=o.majorLineHeight+"px",n.style.width=t+"px",n},c.prototype._calculateCharSize=function(){this.dom.measureCharMinor||(this.dom.measureCharMinor=document.createElement("DIV"),this.dom.measureCharMinor.className="vis-text vis-minor vis-measure",this.dom.measureCharMinor.style.position="absolute",this.dom.measureCharMinor.appendChild(document.createTextNode("0")),this.dom.foreground.appendChild(this.dom.measureCharMinor)),this.props.minorCharHeight=this.dom.measureCharMinor.clientHeight,this.props.minorCharWidth=this.dom.measureCharMinor.clientWidth,this.dom.measureCharMajor||(this.dom.measureCharMajor=document.createElement("DIV"),this.dom.measureCharMajor.className="vis-text vis-major vis-measure",this.dom.measureCharMajor.style.position="absolute",this.dom.measureCharMajor.appendChild(document.createTextNode("0")),this.dom.foreground.appendChild(this.dom.measureCharMajor)),this.props.majorCharHeight=this.dom.measureCharMajor.clientHeight,this.props.majorCharWidth=this.dom.measureCharMajor.clientWidth};var d=!1;e.exports=c},function(e,t,i){var r=i(10),n=i(2),o=i(16),a=i(9),s=i(98);function l(e,t){this.body=e,this.defaultOptions={moment:a,locales:s,locale:"en",id:void 0,title:void 0},this.options=n.extend({},this.defaultOptions),t&&t.time?this.customTime=t.time:this.customTime=new Date,this.eventParams={},this.setOptions(t),this._create()}l.prototype=new o,l.prototype.setOptions=function(e){e&&n.selectiveExtend(["moment","locale","locales","id"],this.options,e)},l.prototype._create=function(){var e=document.createElement("div");e["custom-time"]=this,e.className="vis-custom-time "+(this.options.id||""),e.style.position="absolute",e.style.top="0px",e.style.height="100%",this.bar=e;var t=document.createElement("div");function i(e){this.body.range._onMouseWheel(e)}t.style.position="relative",t.style.top="0px",t.style.left="-10px",t.style.height="100%",t.style.width="20px",t.addEventListener?(t.addEventListener("mousewheel",i.bind(this),!1),t.addEventListener("DOMMouseScroll",i.bind(this),!1)):t.attachEvent("onmousewheel",i.bind(this)),e.appendChild(t),this.hammer=new r(t),this.hammer.on("panstart",this._onDragStart.bind(this)),this.hammer.on("panmove",this._onDrag.bind(this)),this.hammer.on("panend",this._onDragEnd.bind(this)),this.hammer.get("pan").set({threshold:5,direction:r.DIRECTION_HORIZONTAL})},l.prototype.destroy=function(){this.hide(),this.hammer.destroy(),this.hammer=null,this.body=null},l.prototype.redraw=function(){var e=this.body.dom.backgroundVertical;this.bar.parentNode!=e&&(this.bar.parentNode&&this.bar.parentNode.removeChild(this.bar),e.appendChild(this.bar));var t=this.body.util.toScreen(this.customTime),i=this.options.locales[this.options.locale];i||(this.warned||(console.log("WARNING: options.locales['"+this.options.locale+"'] not found. See http://visjs.org/docs/timeline/#Localization"),this.warned=!0),i=this.options.locales.en);var r=this.options.title;return void 0===r?r=(r=i.time+": "+this.options.moment(this.customTime).format("dddd, MMMM Do YYYY, H:mm:ss")).charAt(0).toUpperCase()+r.substring(1):"function"==typeof r&&(r=r.call(this.customTime)),this.bar.style.left=t+"px",this.bar.title=r,!1},l.prototype.hide=function(){this.bar.parentNode&&this.bar.parentNode.removeChild(this.bar)},l.prototype.setCustomTime=function(e){this.customTime=n.convert(e,"Date"),this.redraw()},l.prototype.getCustomTime=function(){return new Date(this.customTime.valueOf())},l.prototype.setCustomTitle=function(e){this.options.title=e},l.prototype._onDragStart=function(e){this.eventParams.dragging=!0,this.eventParams.customTime=this.customTime,e.stopPropagation()},l.prototype._onDrag=function(e){if(this.eventParams.dragging){var t=this.body.util.toScreen(this.eventParams.customTime)+e.deltaX,i=this.body.util.toTime(t);this.setCustomTime(i),this.body.emitter.emit("timechange",{id:this.options.id,time:new Date(this.customTime.valueOf()),event:e}),e.stopPropagation()}},l.prototype._onDragEnd=function(e){this.eventParams.dragging&&(this.body.emitter.emit("timechanged",{id:this.options.id,time:new Date(this.customTime.valueOf()),event:e}),e.stopPropagation())},l.customTimeFromTarget=function(e){for(var t=e.target;t;){if(t.hasOwnProperty("custom-time"))return t["custom-time"];t=t.parentNode}return null},e.exports=l},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=i(2),s=i(117).default,l=i(48).default,u=i(193).default,h=i(200).default,c=i(201).default,d=i(202).default,p=i(203).default,f=i(204).default,m=i(205).default,v=i(206).default,g=i(207).default,y=i(208).default,_=i(209).default,b=i(210).default,x=i(211).default,w=i(212).default,S=i(213).default,M=i(15).printStyle,T=function(){function e(t,i,n,o,l,u){(0,r.default)(this,e),this.options=a.bridgeObject(l),this.globalOptions=l,this.defaultOptions=u,this.body=i,this.edges=[],this.id=void 0,this.imagelist=n,this.grouplist=o,this.x=void 0,this.y=void 0,this.baseSize=this.options.size,this.baseFontSize=this.options.font.size,this.predefinedPosition=!1,this.selected=!1,this.hover=!1,this.labelModule=new s(this.body,this.options,!1),this.setOptions(t)}return(0,n.default)(e,[{key:"attachEdge",value:function(e){-1===this.edges.indexOf(e)&&this.edges.push(e)}},{key:"detachEdge",value:function(e){var t=this.edges.indexOf(e);-1!=t&&this.edges.splice(t,1)}},{key:"setOptions",value:function(t){var i=this.options.shape;if(t){if(void 0!==t.id&&(this.id=t.id),void 0===this.id)throw new Error("Node must have an id");e.checkMass(t,this.id),void 0!==t.x&&(null===t.x?(this.x=void 0,this.predefinedPosition=!1):(this.x=parseInt(t.x),this.predefinedPosition=!0)),void 0!==t.y&&(null===t.y?(this.y=void 0,this.predefinedPosition=!1):(this.y=parseInt(t.y),this.predefinedPosition=!0)),void 0!==t.size&&(this.baseSize=t.size),void 0!==t.value&&(t.value=parseFloat(t.value)),e.parseOptions(this.options,t,!0,this.globalOptions,this.grouplist);var r=[t,this.options,this.defaultOptions];return this.chooser=l.choosify("node",r),this._load_images(),this.updateLabelModule(t),this.updateShape(i),void 0!==t.hidden||void 0!==t.physics}}},{key:"_load_images",value:function(){if("circularImage"===this.options.shape||"image"===this.options.shape){if(void 0===this.options.image)throw new Error("Option image must be defined for node type '"+this.options.shape+"'");if(void 0===this.imagelist)throw new Error("Internal Error: No images provided");if("string"==typeof this.options.image)this.imageObj=this.imagelist.load(this.options.image,this.options.brokenImage,this.id);else{if(void 0===this.options.image.unselected)throw new Error("No unselected image provided");this.imageObj=this.imagelist.load(this.options.image.unselected,this.options.brokenImage,this.id),void 0!==this.options.image.selected?this.imageObjAlt=this.imagelist.load(this.options.image.selected,this.options.brokenImage,this.id):this.imageObjAlt=void 0}}}},{key:"getFormattingValues",value:function(){var e={color:this.options.color.background,borderWidth:this.options.borderWidth,borderColor:this.options.color.border,size:this.options.size,borderDashes:this.options.shapeProperties.borderDashes,borderRadius:this.options.shapeProperties.borderRadius,shadow:this.options.shadow.enabled,shadowColor:this.options.shadow.color,shadowSize:this.options.shadow.size,shadowX:this.options.shadow.x,shadowY:this.options.shadow.y};return this.selected||this.hover?!0===this.chooser?this.selected?(e.borderWidth*=2,e.color=this.options.color.highlight.background,e.borderColor=this.options.color.highlight.border,e.shadow=this.options.shadow.enabled):this.hover&&(e.color=this.options.color.hover.background,e.borderColor=this.options.color.hover.border,e.shadow=this.options.shadow.enabled):"function"==typeof this.chooser&&(this.chooser(e,this.options.id,this.selected,this.hover),!1===e.shadow&&(e.shadowColor===this.options.shadow.color&&e.shadowSize===this.options.shadow.size&&e.shadowX===this.options.shadow.x&&e.shadowY===this.options.shadow.y||(e.shadow=!0))):e.shadow=this.options.shadow.enabled,e}},{key:"updateLabelModule",value:function(t){void 0!==this.options.label&&null!==this.options.label||(this.options.label=""),e.updateGroupOptions(this.options,t,this.grouplist);var i=this.grouplist.get(this.options.group,!1),r=[t,this.options,i,this.globalOptions,this.defaultOptions];this.labelModule.update(this.options,r),void 0!==this.labelModule.baseSize&&(this.baseFontSize=this.labelModule.baseSize)}},{key:"updateShape",value:function(e){if(e===this.options.shape&&this.shape)this.shape.setOptions(this.options,this.imageObj,this.imageObjAlt);else switch(this.options.shape){case"box":this.shape=new u(this.options,this.body,this.labelModule);break;case"circle":this.shape=new h(this.options,this.body,this.labelModule);break;case"circularImage":this.shape=new c(this.options,this.body,this.labelModule,this.imageObj,this.imageObjAlt);break;case"database":this.shape=new d(this.options,this.body,this.labelModule);break;case"diamond":this.shape=new p(this.options,this.body,this.labelModule);break;case"dot":this.shape=new f(this.options,this.body,this.labelModule);break;case"ellipse":this.shape=new m(this.options,this.body,this.labelModule);break;case"icon":this.shape=new v(this.options,this.body,this.labelModule);break;case"image":this.shape=new g(this.options,this.body,this.labelModule,this.imageObj,this.imageObjAlt);break;case"square":this.shape=new y(this.options,this.body,this.labelModule);break;case"hexagon":this.shape=new _(this.options,this.body,this.labelModule);break;case"star":this.shape=new b(this.options,this.body,this.labelModule);break;case"text":this.shape=new x(this.options,this.body,this.labelModule);break;case"triangle":this.shape=new w(this.options,this.body,this.labelModule);break;case"triangleDown":this.shape=new S(this.options,this.body,this.labelModule);break;default:this.shape=new m(this.options,this.body,this.labelModule)}this.needsRefresh()}},{key:"select",value:function(){this.selected=!0,this.needsRefresh()}},{key:"unselect",value:function(){this.selected=!1,this.needsRefresh()}},{key:"needsRefresh",value:function(){this.shape.refreshNeeded=!0}},{key:"getTitle",value:function(){return this.options.title}},{key:"distanceToBorder",value:function(e,t){return this.shape.distanceToBorder(e,t)}},{key:"isFixed",value:function(){return this.options.fixed.x&&this.options.fixed.y}},{key:"isSelected",value:function(){return this.selected}},{key:"getValue",value:function(){return this.options.value}},{key:"getLabelSize",value:function(){return this.labelModule.size()}},{key:"setValueRange",value:function(e,t,i){if(void 0!==this.options.value){var r=this.options.scaling.customScalingFunction(e,t,i,this.options.value),n=this.options.scaling.max-this.options.scaling.min;if(!0===this.options.scaling.label.enabled){var o=this.options.scaling.label.max-this.options.scaling.label.min;this.options.font.size=this.options.scaling.label.min+r*o}this.options.size=this.options.scaling.min+r*n}else this.options.size=this.baseSize,this.options.font.size=this.baseFontSize;this.updateLabelModule()}},{key:"draw",value:function(e){var t=this.getFormattingValues();this.shape.draw(e,this.x,this.y,this.selected,this.hover,t)}},{key:"updateBoundingBox",value:function(e){this.shape.updateBoundingBox(this.x,this.y,e)}},{key:"resize",value:function(e){var t=this.getFormattingValues();this.shape.resize(e,this.selected,this.hover,t)}},{key:"getItemsOnPoint",value:function(e){var t=[];return this.labelModule.visible()&&l.pointInRect(this.labelModule.getSize(),e)&&t.push({nodeId:this.id,labelId:0}),l.pointInRect(this.shape.boundingBox,e)&&t.push({nodeId:this.id}),t}},{key:"isOverlappingWith",value:function(e){return this.shape.left<e.right&&this.shape.left+this.shape.width>e.left&&this.shape.top<e.bottom&&this.shape.top+this.shape.height>e.top}},{key:"isBoundingBoxOverlappingWith",value:function(e){return this.shape.boundingBox.left<e.right&&this.shape.boundingBox.right>e.left&&this.shape.boundingBox.top<e.bottom&&this.shape.boundingBox.bottom>e.top}}],[{key:"updateGroupOptions",value:function(e,t,i){if(void 0!==i){var r=e.group;if(void 0!==t&&void 0!==t.group&&r!==t.group)throw new Error("updateGroupOptions: group values in options don't match.");if("number"==typeof r||"string"==typeof r&&""!=r){var n=i.get(r);a.selectiveNotDeepExtend(["font"],e,n),e.color=a.parseColor(e.color)}}}},{key:"parseOptions",value:function(t,i){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments[4];if(a.selectiveNotDeepExtend(["color","fixed","shadow"],t,i,r),e.checkMass(i),a.mergeOptions(t,i,"shadow",n),void 0!==i.color&&null!==i.color){var s=a.parseColor(i.color);a.fillIfDefined(t.color,s)}else!0===r&&null===i.color&&(t.color=a.bridgeObject(n.color));void 0!==i.fixed&&null!==i.fixed&&("boolean"==typeof i.fixed?(t.fixed.x=i.fixed,t.fixed.y=i.fixed):(void 0!==i.fixed.x&&"boolean"==typeof i.fixed.x&&(t.fixed.x=i.fixed.x),void 0!==i.fixed.y&&"boolean"==typeof i.fixed.y&&(t.fixed.y=i.fixed.y))),!0===r&&null===i.font&&(t.font=a.bridgeObject(n.font)),e.updateGroupOptions(t,i,o),void 0!==i.scaling&&a.mergeOptions(t.scaling,i.scaling,"label",n.scaling)}},{key:"checkMass",value:function(e,t){if(void 0!==e.mass&&e.mass<=0){var i="";void 0!==t&&(i=" in node id: "+t),console.log("%cNegative or zero mass disallowed"+i+", setting mass to 1.",M),e.mass=1}}}]),e}();t.default=T},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=a(i(6)),n=a(i(0)),o=a(i(1));function a(e){return e&&e.__esModule?e:{default:e}}var s=i(2),l=function(){function e(){(0,n.default)(this,e)}return(0,o.default)(e,null,[{key:"choosify",value:function(e,t){var i=["node","edge","label"],n=!0,o=s.topMost(t,"chosen");if("boolean"==typeof o)n=o;else if("object"===(void 0===o?"undefined":(0,r.default)(o))){if(-1===i.indexOf(e))throw new Error("choosify: subOption '"+e+"' should be one of '"+i.join("', '")+"'");var a=s.topMost(t,["chosen",e]);"boolean"!=typeof a&&"function"!=typeof a||(n=a)}return n}},{key:"pointInRect",value:function(e,t,i){if(e.width<=0||e.height<=0)return!1;if(void 0!==i){var r={x:t.x-i.x,y:t.y-i.y};if(0!==i.angle){var n=-i.angle;t={x:Math.cos(n)*r.x-Math.sin(n)*r.y,y:Math.sin(n)*r.x+Math.cos(n)*r.y}}else t=r}var o=e.x+e.width,a=e.y+e.width;return e.left<t.x&&o>t.x&&e.top<t.y&&a>t.y}},{key:"isValidLabel",value:function(e){return"string"==typeof e&&""!==e}}]),e}();t.default=l},function(e,t,i){i(125);for(var r=i(18),n=i(26),o=i(31),a=i(13)("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),l=0;l<s.length;l++){var u=s[l],h=r[u],c=h&&h.prototype;c&&!c[a]&&n(c,a,u),o[u]=o.Array}},function(e,t){var i={}.toString;e.exports=function(e){return i.call(e).slice(8,-1)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){e.exports=!0},function(e,t,i){var r=i(32);e.exports=function(e,t){if(!r(e))return e;var i,n;if(t&&"function"==typeof(i=e.toString)&&!r(n=i.call(e)))return n;if("function"==typeof(i=e.valueOf)&&!r(n=i.call(e)))return n;if(!t&&"function"==typeof(i=e.toString)&&!r(n=i.call(e)))return n;throw TypeError("Can't convert object to primitive value")}},function(e,t,i){var r=i(27),n=i(130),o=i(58),a=i(56)("IE_PROTO"),s=function(){},l=function(){var e,t=i(82)("iframe"),r=o.length;for(t.style.display="none",i(134).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),l=e.F;r--;)delete l.prototype[o[r]];return l()};e.exports=Object.create||function(e,t){var i;return null!==e?(s.prototype=r(e),i=new s,s.prototype=null,i[a]=e):i=l(),void 0===t?i:n(i,t)}},function(e,t){var i=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:i)(e)}},function(e,t,i){var r=i(57)("keys"),n=i(40);e.exports=function(e){return r[e]||(r[e]=n(e))}},function(e,t,i){var r=i(18),n=r["__core-js_shared__"]||(r["__core-js_shared__"]={});e.exports=function(e){return n[e]||(n[e]={})}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,i){var r=i(20).f,n=i(22),o=i(13)("toStringTag");e.exports=function(e,t,i){e&&!n(e=i?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},function(e,t,i){var r=i(135)(!0);i(79)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,i=this._i;return i>=t.length?{value:void 0,done:!0}:(e=r(t,i),this._i+=e.length,{value:e,done:!1})})},function(e,t,i){t.f=i(13)},function(e,t,i){var r=i(18),n=i(7),o=i(52),a=i(61),s=i(20).f;e.exports=function(e){var t=n.Symbol||(n.Symbol=o?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:a.f(e)})}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,i){var r=a(i(8)),n=a(i(19)),o=a(i(6));function a(e){return e&&e.__esModule?e:{default:e}}var s=i(2),l=i(9),u=i(16),h=i(36);function c(e,t){var i=l().hours(0).minutes(0).seconds(0).milliseconds(0),r=i.clone().add(-3,"days").valueOf(),n=i.clone().add(3,"days").valueOf();this.millisecondsPerPixelCache=void 0,void 0===t?(this.start=r,this.end=n):(this.start=t.start||r,this.end=t.end||n),this.rolling=!1,this.body=e,this.deltaDifference=0,this.scaleOffset=0,this.startToFront=!1,this.endToFront=!0,this.defaultOptions={rtl:!1,start:null,end:null,moment:l,direction:"horizontal",moveable:!0,zoomable:!0,min:null,max:null,zoomMin:10,zoomMax:31536e10,rollingMode:{follow:!1,offset:.5}},this.options=s.extend({},this.defaultOptions),this.props={touch:{}},this.animationTimer=null,this.body.emitter.on("panstart",this._onDragStart.bind(this)),this.body.emitter.on("panmove",this._onDrag.bind(this)),this.body.emitter.on("panend",this._onDragEnd.bind(this)),this.body.emitter.on("mousewheel",this._onMouseWheel.bind(this)),this.body.emitter.on("touch",this._onTouch.bind(this)),this.body.emitter.on("pinch",this._onPinch.bind(this)),this.body.dom.rollingModeBtn.addEventListener("click",this.startRolling.bind(this)),this.setOptions(t)}function d(e){if("horizontal"!=e&&"vertical"!=e)throw new TypeError('Unknown direction "'+e+'". Choose "horizontal" or "vertical".')}c.prototype=new u,c.prototype.setOptions=function(e){if(e){s.selectiveExtend(["animation","direction","min","max","zoomMin","zoomMax","moveable","zoomable","moment","activate","hiddenDates","zoomKey","rtl","showCurrentTime","rollingMode","horizontalScroll"],this.options,e),e.rollingMode&&e.rollingMode.follow&&this.startRolling(),("start"in e||"end"in e)&&this.setRange(e.start,e.end)}},c.prototype.startRolling=function(){var e=this;!function t(){e.stopRolling(),e.rolling=!0;var i=e.end-e.start,r=s.convert(new Date,"Date").valueOf(),n=r-i*e.options.rollingMode.offset,o=r+i*(1-e.options.rollingMode.offset);e.setRange(n,o,{animation:!1}),(i=1/e.conversion(e.body.domProps.center.width).scale/10)<30&&(i=30),i>1e3&&(i=1e3),e.body.dom.rollingModeBtn.style.visibility="hidden",e.currentTimeTimer=setTimeout(t,i)}()},c.prototype.stopRolling=function(){void 0!==this.currentTimeTimer&&(clearTimeout(this.currentTimeTimer),this.rolling=!1,this.body.dom.rollingModeBtn.style.visibility="visible")},c.prototype.setRange=function(e,t,i,a,l){i||(i={}),!0!==i.byUser&&(i.byUser=!1);var u=this,c=null!=e?s.convert(e,"Date").valueOf():null,d=null!=t?s.convert(t,"Date").valueOf():null;if(this._cancelAnimation(),this.millisecondsPerPixelCache=void 0,i.animation){var p=this.start,f=this.end,m="object"===(0,o.default)(i.animation)&&"duration"in i.animation?i.animation.duration:500,v="object"===(0,o.default)(i.animation)&&"easingFunction"in i.animation?i.animation.easingFunction:"easeInOutQuad",g=s.easingFunctions[v];if(!g)throw new Error("Unknown easing function "+(0,n.default)(v)+". Choose from: "+(0,r.default)(s.easingFunctions).join(", "));var y=(new Date).valueOf(),_=!1;return function e(){if(!u.props.touch.dragging){var t=(new Date).valueOf()-y,r=g(t/m),n=t>m,o=n||null===c?c:p+(c-p)*r,s=n||null===d?d:f+(d-f)*r;b=u._applyRange(o,s),h.updateHiddenDates(u.options.moment,u.body,u.options.hiddenDates),_=_||b;var v={start:new Date(u.start),end:new Date(u.end),byUser:i.byUser,event:i.event};if(l&&l(r,b,n),b&&u.body.emitter.emit("rangechange",v),n){if(_&&(u.body.emitter.emit("rangechanged",v),a))return a()}else u.animationTimer=setTimeout(e,20)}}()}var b=this._applyRange(c,d);if(h.updateHiddenDates(this.options.moment,this.body,this.options.hiddenDates),b){var x={start:new Date(this.start),end:new Date(this.end),byUser:i.byUser,event:i.event};if(this.body.emitter.emit("rangechange",x),clearTimeout(u.timeoutID),u.timeoutID=setTimeout(function(){u.body.emitter.emit("rangechanged",x)},200),a)return a()}},c.prototype.getMillisecondsPerPixel=function(){return void 0===this.millisecondsPerPixelCache&&(this.millisecondsPerPixelCache=(this.end-this.start)/this.body.dom.center.clientWidth),this.millisecondsPerPixelCache},c.prototype._cancelAnimation=function(){this.animationTimer&&(clearTimeout(this.animationTimer),this.animationTimer=null)},c.prototype._applyRange=function(e,t){var i,r=null!=e?s.convert(e,"Date").valueOf():this.start,n=null!=t?s.convert(t,"Date").valueOf():this.end,o=null!=this.options.max?s.convert(this.options.max,"Date").valueOf():null,a=null!=this.options.min?s.convert(this.options.min,"Date").valueOf():null;if(isNaN(r)||null===r)throw new Error('Invalid start "'+e+'"');if(isNaN(n)||null===n)throw new Error('Invalid end "'+t+'"');if(n<r&&(n=r),null!==a&&r<a&&(r+=i=a-r,n+=i,null!=o&&n>o&&(n=o)),null!==o&&n>o&&(r-=i=n-o,n-=i,null!=a&&r<a&&(r=a)),null!==this.options.zoomMin){var l=parseFloat(this.options.zoomMin);if(l<0&&(l=0),n-r<l){this.end-this.start===l&&r>=this.start-.5&&n<=this.end?(r=this.start,n=this.end):(r-=(i=l-(n-r))/2,n+=i/2)}}if(null!==this.options.zoomMax){var u=parseFloat(this.options.zoomMax);u<0&&(u=0),n-r>u&&(this.end-this.start===u&&r<this.start&&n>this.end?(r=this.start,n=this.end):(r+=(i=n-r-u)/2,n-=i/2))}var h=this.start!=r||this.end!=n;return r>=this.start&&r<=this.end||n>=this.start&&n<=this.end||this.start>=r&&this.start<=n||this.end>=r&&this.end<=n||this.body.emitter.emit("checkRangedItems"),this.start=r,this.end=n,h},c.prototype.getRange=function(){return{start:this.start,end:this.end}},c.prototype.conversion=function(e,t){return c.conversion(this.start,this.end,e,t)},c.conversion=function(e,t,i,r){return void 0===r&&(r=0),0!=i&&t-e!=0?{offset:e,scale:i/(t-e-r)}:{offset:0,scale:1}},c.prototype._onDragStart=function(e){this.deltaDifference=0,this.previousDelta=0,this.options.moveable&&this._isInsideRange(e)&&this.props.touch.allowDragging&&(this.stopRolling(),this.props.touch.start=this.start,this.props.touch.end=this.end,this.props.touch.dragging=!0,this.body.dom.root&&(this.body.dom.root.style.cursor="move"))},c.prototype._onDrag=function(e){if(e&&this.props.touch.dragging&&this.options.moveable&&this.props.touch.allowDragging){var t=this.options.direction;d(t);var i="horizontal"==t?e.deltaX:e.deltaY;i-=this.deltaDifference;var r=this.props.touch.end-this.props.touch.start;r-=h.getHiddenDurationBetween(this.body.hiddenDates,this.start,this.end);var n,o="horizontal"==t?this.body.domProps.center.width:this.body.domProps.center.height;n=this.options.rtl?i/o*r:-i/o*r;var a=this.props.touch.start+n,s=this.props.touch.end+n,l=h.snapAwayFromHidden(this.body.hiddenDates,a,this.previousDelta-i,!0),u=h.snapAwayFromHidden(this.body.hiddenDates,s,this.previousDelta-i,!0);if(l!=a||u!=s)return this.deltaDifference+=i,this.props.touch.start=l,this.props.touch.end=u,void this._onDrag(e);this.previousDelta=i,this._applyRange(a,s);var c=new Date(this.start),p=new Date(this.end);this.body.emitter.emit("rangechange",{start:c,end:p,byUser:!0,event:e}),this.body.emitter.emit("panmove")}},c.prototype._onDragEnd=function(e){this.props.touch.dragging&&this.options.moveable&&this.props.touch.allowDragging&&(this.props.touch.dragging=!1,this.body.dom.root&&(this.body.dom.root.style.cursor="auto"),this.body.emitter.emit("rangechanged",{start:new Date(this.start),end:new Date(this.end),byUser:!0,event:e}))},c.prototype._onMouseWheel=function(e){var t=0;if(e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),!(this.options.zoomKey&&!e[this.options.zoomKey]&&this.options.zoomable||!this.options.zoomable&&this.options.moveable)&&this.options.zoomable&&this.options.moveable&&this._isInsideRange(e)&&t){var i,r;if(i=t<0?1-t/5:1/(1+t/5),this.rolling)r=this.start+(this.end-this.start)*this.options.rollingMode.offset;else{var n=this.getPointer({x:e.clientX,y:e.clientY},this.body.dom.center);r=this._pointerToDate(n)}this.zoom(i,r,t,e),e.preventDefault()}},c.prototype._onTouch=function(e){this.props.touch.start=this.start,this.props.touch.end=this.end,this.props.touch.allowDragging=!0,this.props.touch.center=null,this.scaleOffset=0,this.deltaDifference=0,s.preventDefault(e)},c.prototype._onPinch=function(e){if(this.options.zoomable&&this.options.moveable){s.preventDefault(e),this.props.touch.allowDragging=!1,this.props.touch.center||(this.props.touch.center=this.getPointer(e.center,this.body.dom.center)),this.stopRolling();var t=1/(e.scale+this.scaleOffset),i=this._pointerToDate(this.props.touch.center),r=h.getHiddenDurationBetween(this.body.hiddenDates,this.start,this.end),n=h.getHiddenDurationBefore(this.options.moment,this.body.hiddenDates,this,i),o=r-n,a=i-n+(this.props.touch.start-(i-n))*t,l=i+o+(this.props.touch.end-(i+o))*t;this.startToFront=1-t<=0,this.endToFront=t-1<=0;var u=h.snapAwayFromHidden(this.body.hiddenDates,a,1-t,!0),c=h.snapAwayFromHidden(this.body.hiddenDates,l,t-1,!0);u==a&&c==l||(this.props.touch.start=u,this.props.touch.end=c,this.scaleOffset=1-e.scale,a=u,l=c);var d={animation:!1,byUser:!0,event:e};this.setRange(a,l,d),this.startToFront=!1,this.endToFront=!0}},c.prototype._isInsideRange=function(e){var t,i=e.center?e.center.x:e.clientX;t=this.options.rtl?i-s.getAbsoluteLeft(this.body.dom.centerContainer):s.getAbsoluteRight(this.body.dom.centerContainer)-i;var r=this.body.util.toTime(t);return r>=this.start&&r<=this.end},c.prototype._pointerToDate=function(e){var t,i=this.options.direction;if(d(i),"horizontal"==i)return this.body.util.toTime(e.x).valueOf();var r=this.body.domProps.center.height;return t=this.conversion(r),e.y/t.scale+t.offset},c.prototype.getPointer=function(e,t){return this.options.rtl?{x:s.getAbsoluteRight(t)-e.x,y:e.y-s.getAbsoluteTop(t)}:{x:e.x-s.getAbsoluteLeft(t),y:e.y-s.getAbsoluteTop(t)}},c.prototype.zoom=function(e,t,i,r){null==t&&(t=(this.start+this.end)/2);var n=h.getHiddenDurationBetween(this.body.hiddenDates,this.start,this.end),o=h.getHiddenDurationBefore(this.options.moment,this.body.hiddenDates,this,t),a=n-o,s=t-o+(this.start-(t-o))*e,l=t+a+(this.end-(t+a))*e;this.startToFront=!(i>0),this.endToFront=!(-i>0);var u=h.snapAwayFromHidden(this.body.hiddenDates,s,i,!0),c=h.snapAwayFromHidden(this.body.hiddenDates,l,-i,!0);u==s&&c==l||(s=u,l=c);var d={animation:!1,byUser:!0,event:r};this.setRange(s,l,d),this.startToFront=!1,this.endToFront=!0},c.prototype.move=function(e){var t=this.end-this.start,i=this.start+t*e,r=this.end+t*e;this.start=i,this.end=r},c.prototype.moveTo=function(e){var t=(this.start+this.end)/2-e,i=this.start-t,r=this.end-t;this.setRange(i,r,{animation:!1,byUser:!0,event:null})},e.exports=c},function(e,t,i){var r=o(i(19)),n=o(i(6));function o(e){return e&&e.__esModule?e:{default:e}}var a=i(44),s=i(10),l=i(37),u=i(2),h=i(45),c=i(97),d=i(36),p=i(46);function f(){}a(f.prototype),f.prototype._create=function(e){this.dom={},this.dom.container=e,this.dom.root=document.createElement("div"),this.dom.background=document.createElement("div"),this.dom.backgroundVertical=document.createElement("div"),this.dom.backgroundHorizontal=document.createElement("div"),this.dom.centerContainer=document.createElement("div"),this.dom.leftContainer=document.createElement("div"),this.dom.rightContainer=document.createElement("div"),this.dom.center=document.createElement("div"),this.dom.left=document.createElement("div"),this.dom.right=document.createElement("div"),this.dom.top=document.createElement("div"),this.dom.bottom=document.createElement("div"),this.dom.shadowTop=document.createElement("div"),this.dom.shadowBottom=document.createElement("div"),this.dom.shadowTopLeft=document.createElement("div"),this.dom.shadowBottomLeft=document.createElement("div"),this.dom.shadowTopRight=document.createElement("div"),this.dom.shadowBottomRight=document.createElement("div"),this.dom.rollingModeBtn=document.createElement("div"),this.dom.root.className="vis-timeline",this.dom.background.className="vis-panel vis-background",this.dom.backgroundVertical.className="vis-panel vis-background vis-vertical",this.dom.backgroundHorizontal.className="vis-panel vis-background vis-horizontal",this.dom.centerContainer.className="vis-panel vis-center",this.dom.leftContainer.className="vis-panel vis-left",this.dom.rightContainer.className="vis-panel vis-right",this.dom.top.className="vis-panel vis-top",this.dom.bottom.className="vis-panel vis-bottom",this.dom.left.className="vis-content",this.dom.center.className="vis-content",this.dom.right.className="vis-content",this.dom.shadowTop.className="vis-shadow vis-top",this.dom.shadowBottom.className="vis-shadow vis-bottom",this.dom.shadowTopLeft.className="vis-shadow vis-top",this.dom.shadowBottomLeft.className="vis-shadow vis-bottom",this.dom.shadowTopRight.className="vis-shadow vis-top",this.dom.shadowBottomRight.className="vis-shadow vis-bottom",this.dom.rollingModeBtn.className="vis-rolling-mode-btn",this.dom.root.appendChild(this.dom.background),this.dom.root.appendChild(this.dom.backgroundVertical),this.dom.root.appendChild(this.dom.backgroundHorizontal),this.dom.root.appendChild(this.dom.centerContainer),this.dom.root.appendChild(this.dom.leftContainer),this.dom.root.appendChild(this.dom.rightContainer),this.dom.root.appendChild(this.dom.top),this.dom.root.appendChild(this.dom.bottom),this.dom.root.appendChild(this.dom.bottom),this.dom.root.appendChild(this.dom.rollingModeBtn),this.dom.centerContainer.appendChild(this.dom.center),this.dom.leftContainer.appendChild(this.dom.left),this.dom.rightContainer.appendChild(this.dom.right),this.dom.centerContainer.appendChild(this.dom.shadowTop),this.dom.centerContainer.appendChild(this.dom.shadowBottom),this.dom.leftContainer.appendChild(this.dom.shadowTopLeft),this.dom.leftContainer.appendChild(this.dom.shadowBottomLeft),this.dom.rightContainer.appendChild(this.dom.shadowTopRight),this.dom.rightContainer.appendChild(this.dom.shadowBottomRight),this.props={root:{},background:{},centerContainer:{},leftContainer:{},rightContainer:{},center:{},left:{},right:{},top:{},bottom:{},border:{},scrollTop:0,scrollTopMin:0},this.on("rangechange",function(){!0===this.initialDrawDone&&this._redraw()}.bind(this)),this.on("rangechanged",function(){this.initialRangeChangeDone||(this.initialRangeChangeDone=!0)}.bind(this)),this.on("touch",this._onTouch.bind(this)),this.on("panmove",this._onDrag.bind(this));var t=this;this._origRedraw=this._redraw.bind(this),this._redraw=u.throttle(this._origRedraw),this.on("_change",function(e){t.itemSet&&t.itemSet.initialItemSetDrawn&&e&&1==e.queue?t._redraw():t._origRedraw()}),this.hammer=new s(this.dom.root);var i=this.hammer.get("pinch").set({enable:!0});l.disablePreventDefaultVertically(i),this.hammer.get("pan").set({threshold:5,direction:s.DIRECTION_HORIZONTAL}),this.listeners={};function r(e){this.isActive()&&this.emit("mousewheel",e);var t=0,i=0;if("detail"in e&&(i=-1*e.detail),"wheelDelta"in e&&(i=e.wheelDelta),"wheelDeltaY"in e&&(i=e.wheelDeltaY),"wheelDeltaX"in e&&(t=-1*e.wheelDeltaX),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=-1*i,i=0),"deltaY"in e&&(i=-1*e.deltaY),"deltaX"in e&&(t=e.deltaX),this.options.zoomKey&&!e[this.options.zoomKey])if(e.preventDefault(),this.options.verticalScroll&&Math.abs(i)>=Math.abs(t)){var r=this.props.scrollTop+i;this.isActive()&&(this._setScrollTop(r),this._redraw(),this.emit("scroll",e))}else if(this.options.horizontalScroll){var n=(Math.abs(t)>=Math.abs(i)?t:i)/120*(this.range.end-this.range.start)/20,o=this.range.start+n,a=this.range.end+n,s={animation:!1,byUser:!0,event:e};this.range.setRange(o,a,s)}}function n(e){if(t.options.verticalScroll&&(e.preventDefault(),t.isActive())){var i=-e.target.scrollTop;t._setScrollTop(i),t._redraw(),t.emit("scrollSide",e)}}["tap","doubletap","press","pinch","pan","panstart","panmove","panend"].forEach(function(e){var i=function(i){t.isActive()&&t.emit(e,i)};t.hammer.on(e,i),t.listeners[e]=i}),l.onTouch(this.hammer,function(e){t.emit("touch",e)}.bind(this)),l.onRelease(this.hammer,function(e){t.emit("release",e)}.bind(this)),this.dom.centerContainer.addEventListener?(this.dom.centerContainer.addEventListener("mousewheel",r.bind(this),!1),this.dom.centerContainer.addEventListener("DOMMouseScroll",r.bind(this),!1)):this.dom.centerContainer.attachEvent("onmousewheel",r.bind(this)),this.dom.left.parentNode.addEventListener("scroll",n.bind(this)),this.dom.right.parentNode.addEventListener("scroll",n.bind(this));var o=!1;if(this.dom.center.addEventListener("dragover",function(e){if(e.preventDefault&&e.preventDefault(),!(!e.target.className.indexOf("vis")>-1||o))return e.dataTransfer.dropEffect="move",o=!0,!1}.bind(this),!1),this.dom.center.addEventListener("drop",function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation();try{var i=JSON.parse(e.dataTransfer.getData("text"));if(!i||!i.content)return}catch(e){return!1}return o=!1,e.center={x:e.clientX,y:e.clientY},"item"!==i.target?t.itemSet._onAddItem(e):t.itemSet._onDropObjectOnItem(e),t.emit("drop",t.getEventProperties(e)),!1}.bind(this),!1),this.customTimes=[],this.touch={},this.redrawCount=0,this.initialDrawDone=!1,this.initialRangeChangeDone=!1,!e)throw new Error("No container provided");e.appendChild(this.dom.root)},f.prototype.setOptions=function(e){if(e){if(u.selectiveExtend(["width","height","minHeight","maxHeight","autoResize","start","end","clickToUse","dataAttributes","hiddenDates","locale","locales","moment","rtl","zoomKey","horizontalScroll","verticalScroll"],this.options,e),this.dom.rollingModeBtn.style.visibility="hidden",this.options.rtl&&(this.dom.container.style.direction="rtl",this.dom.backgroundVertical.className="vis-panel vis-background vis-vertical-rtl"),this.options.verticalScroll&&(this.options.rtl?this.dom.rightContainer.className="vis-panel vis-right vis-vertical-scroll":this.dom.leftContainer.className="vis-panel vis-left vis-vertical-scroll"),"object"!==(0,n.default)(this.options.orientation)&&(this.options.orientation={item:void 0,axis:void 0}),"orientation"in e&&("string"==typeof e.orientation?this.options.orientation={item:e.orientation,axis:e.orientation}:"object"===(0,n.default)(e.orientation)&&("item"in e.orientation&&(this.options.orientation.item=e.orientation.item),"axis"in e.orientation&&(this.options.orientation.axis=e.orientation.axis))),"both"===this.options.orientation.axis){if(!this.timeAxis2){var t=this.timeAxis2=new h(this.body);t.setOptions=function(e){var i=e?u.extend({},e):{};i.orientation="top",h.prototype.setOptions.call(t,i)},this.components.push(t)}}else if(this.timeAxis2){var i=this.components.indexOf(this.timeAxis2);-1!==i&&this.components.splice(i,1),this.timeAxis2.destroy(),this.timeAxis2=null}if("function"==typeof e.drawPoints&&(e.drawPoints={onRender:e.drawPoints}),"hiddenDates"in this.options&&d.convertHiddenOptions(this.options.moment,this.body,this.options.hiddenDates),"clickToUse"in e&&(e.clickToUse?this.activator||(this.activator=new c(this.dom.root)):this.activator&&(this.activator.destroy(),delete this.activator)),"showCustomTime"in e)throw new Error("Option `showCustomTime` is deprecated. Create a custom time bar via timeline.addCustomTime(time [, id])");this._initAutoResize()}if(this.components.forEach(function(t){return t.setOptions(e)}),"configure"in e){this.configurator||(this.configurator=this._createConfigurator()),this.configurator.setOptions(e.configure);var r=u.deepExtend({},this.options);this.components.forEach(function(e){u.deepExtend(r,e.options)}),this.configurator.setModuleOptions({global:r})}this._redraw()},f.prototype.isActive=function(){return!this.activator||this.activator.active},f.prototype.destroy=function(){for(var e in this.setItems(null),this.setGroups(null),this.off(),this._stopAutoResize(),this.dom.root.parentNode&&this.dom.root.parentNode.removeChild(this.dom.root),this.dom=null,this.activator&&(this.activator.destroy(),delete this.activator),this.listeners)this.listeners.hasOwnProperty(e)&&delete this.listeners[e];this.listeners=null,this.hammer=null,this.components.forEach(function(e){return e.destroy()}),this.body=null},f.prototype.setCustomTime=function(e,t){var i=this.customTimes.filter(function(e){return t===e.options.id});if(0===i.length)throw new Error("No custom time bar found with id "+(0,r.default)(t));i.length>0&&i[0].setCustomTime(e)},f.prototype.getCustomTime=function(e){var t=this.customTimes.filter(function(t){return t.options.id===e});if(0===t.length)throw new Error("No custom time bar found with id "+(0,r.default)(e));return t[0].getCustomTime()},f.prototype.setCustomTimeTitle=function(e,t){var i=this.customTimes.filter(function(e){return e.options.id===t});if(0===i.length)throw new Error("No custom time bar found with id "+(0,r.default)(t));if(i.length>0)return i[0].setCustomTitle(e)},f.prototype.getEventProperties=function(e){return{event:e}},f.prototype.addCustomTime=function(e,t){var i=void 0!==e?u.convert(e,"Date").valueOf():new Date;if(this.customTimes.some(function(e){return e.options.id===t}))throw new Error("A custom time with id "+(0,r.default)(t)+" already exists");var n=new p(this.body,u.extend({},this.options,{time:i,id:t}));return this.customTimes.push(n),this.components.push(n),this._redraw(),t},f.prototype.removeCustomTime=function(e){var t=this.customTimes.filter(function(t){return t.options.id===e});if(0===t.length)throw new Error("No custom time bar found with id "+(0,r.default)(e));t.forEach(function(e){this.customTimes.splice(this.customTimes.indexOf(e),1),this.components.splice(this.components.indexOf(e),1),e.destroy()}.bind(this))},f.prototype.getVisibleItems=function(){return this.itemSet&&this.itemSet.getVisibleItems()||[]},f.prototype.fit=function(e,t){var i=this.getDataRange();if(null!==i.min||null!==i.max){var r=i.max-i.min,n=new Date(i.min.valueOf()-.01*r),o=new Date(i.max.valueOf()+.01*r),a=!e||void 0===e.animation||e.animation;this.range.setRange(n,o,{animation:a},t)}},f.prototype.getDataRange=function(){throw new Error("Cannot invoke abstract method getDataRange")},f.prototype.setWindow=function(e,t,i,r){var n,o;"function"==typeof arguments[2]&&(r=arguments[2],i={}),1==arguments.length?(n=void 0===(o=arguments[0]).animation||o.animation,this.range.setRange(o.start,o.end,{animation:n})):2==arguments.length&&"function"==typeof arguments[1]?(o=arguments[0],r=arguments[1],n=void 0===o.animation||o.animation,this.range.setRange(o.start,o.end,{animation:n},r)):(n=!i||void 0===i.animation||i.animation,this.range.setRange(e,t,{animation:n},r))},f.prototype.moveTo=function(e,t,i){"function"==typeof arguments[1]&&(i=arguments[1],t={});var r=this.range.end-this.range.start,n=u.convert(e,"Date").valueOf(),o=n-r/2,a=n+r/2,s=!t||void 0===t.animation||t.animation;this.range.setRange(o,a,{animation:s},i)},f.prototype.getWindow=function(){var e=this.range.getRange();return{start:new Date(e.start),end:new Date(e.end)}},f.prototype.zoomIn=function(e,t,i){if(!(!e||e<0||e>1)){"function"==typeof arguments[1]&&(i=arguments[1],t={});var r=this.getWindow(),n=r.start.valueOf(),o=r.end.valueOf(),a=o-n,s=(a-a/(1+e))/2,l=n+s,u=o-s;this.setWindow(l,u,t,i)}},f.prototype.zoomOut=function(e,t,i){if(!(!e||e<0||e>1)){"function"==typeof arguments[1]&&(i=arguments[1],t={});var r=this.getWindow(),n=r.start.valueOf(),o=r.end.valueOf(),a=o-n,s=n-a*e/2,l=o+a*e/2;this.setWindow(s,l,t,i)}},f.prototype.redraw=function(){this._redraw()},f.prototype._redraw=function(){this.redrawCount++;var e=!1,t=this.options,i=this.props,r=this.dom;if(r&&r.container&&0!=r.root.offsetWidth){d.updateHiddenDates(this.options.moment,this.body,this.options.hiddenDates),"top"==t.orientation?(u.addClassName(r.root,"vis-top"),u.removeClassName(r.root,"vis-bottom")):(u.removeClassName(r.root,"vis-top"),u.addClassName(r.root,"vis-bottom")),r.root.style.maxHeight=u.option.asSize(t.maxHeight,""),r.root.style.minHeight=u.option.asSize(t.minHeight,""),r.root.style.width=u.option.asSize(t.width,""),i.border.left=(r.centerContainer.offsetWidth-r.centerContainer.clientWidth)/2,i.border.right=i.border.left,i.border.top=(r.centerContainer.offsetHeight-r.centerContainer.clientHeight)/2,i.border.bottom=i.border.top,i.borderRootHeight=r.root.offsetHeight-r.root.clientHeight,i.borderRootWidth=r.root.offsetWidth-r.root.clientWidth,0===r.centerContainer.clientHeight&&(i.border.left=i.border.top,i.border.right=i.border.left),0===r.root.clientHeight&&(i.borderRootWidth=i.borderRootHeight),i.center.height=r.center.offsetHeight,i.left.height=r.left.offsetHeight,i.right.height=r.right.offsetHeight,i.top.height=r.top.clientHeight||-i.border.top,i.bottom.height=r.bottom.clientHeight||-i.border.bottom;var n=Math.max(i.left.height,i.center.height,i.right.height),o=i.top.height+n+i.bottom.height+i.borderRootHeight+i.border.top+i.border.bottom;r.root.style.height=u.option.asSize(t.height,o+"px"),i.root.height=r.root.offsetHeight,i.background.height=i.root.height-i.borderRootHeight;var a=i.root.height-i.top.height-i.bottom.height-i.borderRootHeight;i.centerContainer.height=a,i.leftContainer.height=a,i.rightContainer.height=i.leftContainer.height,i.root.width=r.root.offsetWidth,i.background.width=i.root.width-i.borderRootWidth,this.initialDrawDone||(i.scrollbarWidth=u.getScrollBarWidth()),t.verticalScroll?t.rtl?(i.left.width=r.leftContainer.clientWidth||-i.border.left,i.right.width=r.rightContainer.clientWidth+i.scrollbarWidth||-i.border.right):(i.left.width=r.leftContainer.clientWidth+i.scrollbarWidth||-i.border.left,i.right.width=r.rightContainer.clientWidth||-i.border.right):(i.left.width=r.leftContainer.clientWidth||-i.border.left,i.right.width=r.rightContainer.clientWidth||-i.border.right),this._setDOM();var l=this._updateScrollTop();"top"!=t.orientation.item&&(l+=Math.max(i.centerContainer.height-i.center.height-i.border.top-i.border.bottom,0)),r.center.style.top=l+"px";var h=0==i.scrollTop?"hidden":"",c=i.scrollTop==i.scrollTopMin?"hidden":"";r.shadowTop.style.visibility=h,r.shadowBottom.style.visibility=c,r.shadowTopLeft.style.visibility=h,r.shadowBottomLeft.style.visibility=c,r.shadowTopRight.style.visibility=h,r.shadowBottomRight.style.visibility=c,t.verticalScroll&&(r.rightContainer.className="vis-panel vis-right vis-vertical-scroll",r.leftContainer.className="vis-panel vis-left vis-vertical-scroll",r.shadowTopRight.style.visibility="hidden",r.shadowBottomRight.style.visibility="hidden",r.shadowTopLeft.style.visibility="hidden",r.shadowBottomLeft.style.visibility="hidden",r.left.style.top="0px",r.right.style.top="0px"),(!t.verticalScroll||i.center.height<i.centerContainer.height)&&(r.left.style.top=l+"px",r.right.style.top=l+"px",r.rightContainer.className=r.rightContainer.className.replace(new RegExp("(?:^|\\s)vis-vertical-scroll(?:\\s|$)")," "),r.leftContainer.className=r.leftContainer.className.replace(new RegExp("(?:^|\\s)vis-vertical-scroll(?:\\s|$)")," "),i.left.width=r.leftContainer.clientWidth||-i.border.left,i.right.width=r.rightContainer.clientWidth||-i.border.right,this._setDOM());var p=i.center.height>i.centerContainer.height;this.hammer.get("pan").set({direction:p?s.DIRECTION_ALL:s.DIRECTION_HORIZONTAL}),this.components.forEach(function(t){e=t.redraw()||e});if(e){if(this.redrawCount<5)return void this.body.emitter.emit("_change");console.log("WARNING: infinite loop in redraw?")}else this.redrawCount=0;this.body.emitter.emit("changed")}},f.prototype._setDOM=function(){var e=this.props,t=this.dom;e.leftContainer.width=e.left.width,e.rightContainer.width=e.right.width;var i=e.root.width-e.left.width-e.right.width-e.borderRootWidth;e.center.width=i,e.centerContainer.width=i,e.top.width=i,e.bottom.width=i,t.background.style.height=e.background.height+"px",t.backgroundVertical.style.height=e.background.height+"px",t.backgroundHorizontal.style.height=e.centerContainer.height+"px",t.centerContainer.style.height=e.centerContainer.height+"px",t.leftContainer.style.height=e.leftContainer.height+"px",t.rightContainer.style.height=e.rightContainer.height+"px",t.background.style.width=e.background.width+"px",t.backgroundVertical.style.width=e.centerContainer.width+"px",t.backgroundHorizontal.style.width=e.background.width+"px",t.centerContainer.style.width=e.center.width+"px",t.top.style.width=e.top.width+"px",t.bottom.style.width=e.bottom.width+"px",t.background.style.left="0",t.background.style.top="0",t.backgroundVertical.style.left=e.left.width+e.border.left+"px",t.backgroundVertical.style.top="0",t.backgroundHorizontal.style.left="0",t.backgroundHorizontal.style.top=e.top.height+"px",t.centerContainer.style.left=e.left.width+"px",t.centerContainer.style.top=e.top.height+"px",t.leftContainer.style.left="0",t.leftContainer.style.top=e.top.height+"px",t.rightContainer.style.left=e.left.width+e.center.width+"px",t.rightContainer.style.top=e.top.height+"px",t.top.style.left=e.left.width+"px",t.top.style.top="0",t.bottom.style.left=e.left.width+"px",t.bottom.style.top=e.top.height+e.centerContainer.height+"px",t.center.style.left="0",t.left.style.left="0",t.right.style.left="0"},f.prototype.repaint=function(){throw new Error("Function repaint is deprecated. Use redraw instead.")},f.prototype.setCurrentTime=function(e){if(!this.currentTime)throw new Error("Option showCurrentTime must be true");this.currentTime.setCurrentTime(e)},f.prototype.getCurrentTime=function(){if(!this.currentTime)throw new Error("Option showCurrentTime must be true");return this.currentTime.getCurrentTime()},f.prototype._toTime=function(e){return d.toTime(this,e,this.props.center.width)},f.prototype._toGlobalTime=function(e){return d.toTime(this,e,this.props.root.width)},f.prototype._toScreen=function(e){return d.toScreen(this,e,this.props.center.width)},f.prototype._toGlobalScreen=function(e){return d.toScreen(this,e,this.props.root.width)},f.prototype._initAutoResize=function(){1==this.options.autoResize?this._startAutoResize():this._stopAutoResize()},f.prototype._startAutoResize=function(){var e=this;this._stopAutoResize(),this._onResize=function(){1==e.options.autoResize?e.dom.root&&(e.dom.root.offsetWidth==e.props.lastWidth&&e.dom.root.offsetHeight==e.props.lastHeight||(e.props.lastWidth=e.dom.root.offsetWidth,e.props.lastHeight=e.dom.root.offsetHeight,e.props.scrollbarWidth=u.getScrollBarWidth(),e.body.emitter.emit("_change"))):e._stopAutoResize()},u.addEventListener(window,"resize",this._onResize),e.dom.root&&(e.props.lastWidth=e.dom.root.offsetWidth,e.props.lastHeight=e.dom.root.offsetHeight),this.watchTimer=setInterval(this._onResize,1e3)},f.prototype._stopAutoResize=function(){this.watchTimer&&(clearInterval(this.watchTimer),this.watchTimer=void 0),this._onResize&&(u.removeEventListener(window,"resize",this._onResize),this._onResize=null)},f.prototype._onTouch=function(e){this.touch.allowDragging=!0,this.touch.initialScrollTop=this.props.scrollTop},f.prototype._onPinch=function(e){this.touch.allowDragging=!1},f.prototype._onDrag=function(e){if(e&&this.touch.allowDragging){var t=e.deltaY,i=this._getScrollTop(),r=this._setScrollTop(this.touch.initialScrollTop+t);this.options.verticalScroll&&(this.dom.left.parentNode.scrollTop=-this.props.scrollTop,this.dom.right.parentNode.scrollTop=-this.props.scrollTop),r!=i&&this.emit("verticalDrag")}},f.prototype._setScrollTop=function(e){return this.props.scrollTop=e,this._updateScrollTop(),this.props.scrollTop},f.prototype._updateScrollTop=function(){var e=Math.min(this.props.centerContainer.height-this.props.center.height,0);return e!=this.props.scrollTopMin&&("top"!=this.options.orientation.item&&(this.props.scrollTop+=e-this.props.scrollTopMin),this.props.scrollTopMin=e),this.props.scrollTop>0&&(this.props.scrollTop=0),this.props.scrollTop<e&&(this.props.scrollTop=e),this.options.verticalScroll&&(this.dom.left.parentNode.scrollTop=-this.props.scrollTop,this.dom.right.parentNode.scrollTop=-this.props.scrollTop),this.props.scrollTop},f.prototype._getScrollTop=function(){return this.props.scrollTop},f.prototype._createConfigurator=function(){throw new Error("Cannot invoke abstract method _createConfigurator")},e.exports=f},function(e,t,i){var r=i(9),n=i(36),o=i(2);function a(e,t,i,n,o){this.moment=r,this.current=this.moment(),this._start=this.moment(),this._end=this.moment(),this.autoScale=!0,this.scale="day",this.step=1,this.setRange(e,t,i),this.switchedDay=!1,this.switchedMonth=!1,this.switchedYear=!1,Array.isArray(n)?this.hiddenDates=n:this.hiddenDates=null!=n?[n]:[],this.format=a.FORMAT,this.options=o||{}}a.FORMAT={minorLabels:{millisecond:"SSS",second:"s",minute:"HH:mm",hour:"HH:mm",weekday:"ddd D",day:"D",week:"w",month:"MMM",year:"YYYY"},majorLabels:{millisecond:"HH:mm:ss",second:"D MMMM HH:mm",minute:"ddd D MMMM",hour:"ddd D MMMM",weekday:"MMMM YYYY",day:"MMMM YYYY",week:"MMMM YYYY",month:"YYYY",year:""}},a.prototype.setMoment=function(e){this.moment=e,this.current=this.moment(this.current.valueOf()),this._start=this.moment(this._start.valueOf()),this._end=this.moment(this._end.valueOf())},a.prototype.setFormat=function(e){var t=o.deepExtend({},a.FORMAT);this.format=o.deepExtend(t,e)},a.prototype.setRange=function(e,t,i){if(!(e instanceof Date&&t instanceof Date))throw"No legal start or end date in method setRange";this._start=null!=e?this.moment(e.valueOf()):new Date,this._end=null!=t?this.moment(t.valueOf()):new Date,this.autoScale&&this.setMinimumStep(i)},a.prototype.start=function(){this.current=this._start.clone(),this.roundToMinor()},a.prototype.roundToMinor=function(){switch("week"==this.scale&&this.current.weekday(0),this.scale){case"year":this.current.year(this.step*Math.floor(this.current.year()/this.step)),this.current.month(0);case"month":this.current.date(1);case"week":case"day":case"weekday":this.current.hours(0);case"hour":this.current.minutes(0);case"minute":this.current.seconds(0);case"second":this.current.milliseconds(0)}if(1!=this.step)switch(this.scale){case"millisecond":this.current.subtract(this.current.milliseconds()%this.step,"milliseconds");break;case"second":this.current.subtract(this.current.seconds()%this.step,"seconds");break;case"minute":this.current.subtract(this.current.minutes()%this.step,"minutes");break;case"hour":this.current.subtract(this.current.hours()%this.step,"hours");break;case"weekday":case"day":this.current.subtract((this.current.date()-1)%this.step,"day");break;case"week":this.current.subtract(this.current.week()%this.step,"week");break;case"month":this.current.subtract(this.current.month()%this.step,"month");break;case"year":this.current.subtract(this.current.year()%this.step,"year")}},a.prototype.hasNext=function(){return this.current.valueOf()<=this._end.valueOf()},a.prototype.next=function(){var e=this.current.valueOf();switch(this.scale){case"millisecond":this.current.add(this.step,"millisecond");break;case"second":this.current.add(this.step,"second");break;case"minute":this.current.add(this.step,"minute");break;case"hour":this.current.add(this.step,"hour"),this.current.month()<6?this.current.subtract(this.current.hours()%this.step,"hour"):this.current.hours()%this.step!=0&&this.current.add(this.step-this.current.hours()%this.step,"hour");break;case"weekday":case"day":this.current.add(this.step,"day");break;case"week":if(0!==this.current.weekday())this.current.weekday(0),this.current.add(this.step,"week");else if(!1===this.options.showMajorLabels)this.current.add(this.step,"week");else{var t=this.current.clone();t.add(1,"week"),t.isSame(this.current,"month")?this.current.add(this.step,"week"):(this.current.add(this.step,"week"),this.current.date(1))}break;case"month":this.current.add(this.step,"month");break;case"year":this.current.add(this.step,"year")}if(1!=this.step)switch(this.scale){case"millisecond":this.current.milliseconds()>0&&this.current.milliseconds()<this.step&&this.current.milliseconds(0);break;case"second":this.current.seconds()>0&&this.current.seconds()<this.step&&this.current.seconds(0);break;case"minute":this.current.minutes()>0&&this.current.minutes()<this.step&&this.current.minutes(0);break;case"hour":this.current.hours()>0&&this.current.hours()<this.step&&this.current.hours(0);break;case"weekday":case"day":this.current.date()<this.step+1&&this.current.date(1);break;case"week":this.current.week()<this.step&&this.current.week(1);break;case"month":this.current.month()<this.step&&this.current.month(0)}this.current.valueOf()==e&&(this.current=this._end.clone()),this.switchedDay=!1,this.switchedMonth=!1,this.switchedYear=!1,n.stepOverHiddenDates(this.moment,this,e)},a.prototype.getCurrent=function(){return this.current},a.prototype.setScale=function(e){e&&"string"==typeof e.scale&&(this.scale=e.scale,this.step=e.step>0?e.step:1,this.autoScale=!1)},a.prototype.setAutoScale=function(e){this.autoScale=e},a.prototype.setMinimumStep=function(e){if(null!=e){31104e9>e&&(this.scale="year",this.step=1e3),15552e9>e&&(this.scale="year",this.step=500),31104e8>e&&(this.scale="year",this.step=100),15552e8>e&&(this.scale="year",this.step=50),31104e7>e&&(this.scale="year",this.step=10),15552e7>e&&(this.scale="year",this.step=5),31104e6>e&&(this.scale="year",this.step=1),7776e6>e&&(this.scale="month",this.step=3),2592e6>e&&(this.scale="month",this.step=1),432e6>e&&(this.scale="day",this.step=5),1728e5>e&&(this.scale="day",this.step=2),864e5>e&&(this.scale="day",this.step=1),432e5>e&&(this.scale="weekday",this.step=1),144e5>e&&(this.scale="hour",this.step=4),36e5>e&&(this.scale="hour",this.step=1),9e5>e&&(this.scale="minute",this.step=15),6e5>e&&(this.scale="minute",this.step=10),3e5>e&&(this.scale="minute",this.step=5),6e4>e&&(this.scale="minute",this.step=1),15e3>e&&(this.scale="second",this.step=15),1e4>e&&(this.scale="second",this.step=10),5e3>e&&(this.scale="second",this.step=5),1e3>e&&(this.scale="second",this.step=1),200>e&&(this.scale="millisecond",this.step=200),100>e&&(this.scale="millisecond",this.step=100),50>e&&(this.scale="millisecond",this.step=50),10>e&&(this.scale="millisecond",this.step=10),5>e&&(this.scale="millisecond",this.step=5),1>e&&(this.scale="millisecond",this.step=1)}},a.snap=function(e,t,i){var n=r(e);if("year"==t){var o=n.year()+Math.round(n.month()/12);n.year(Math.round(o/i)*i),n.month(0),n.date(0),n.hours(0),n.minutes(0),n.seconds(0),n.milliseconds(0)}else if("month"==t)n.date()>15?(n.date(1),n.add(1,"month")):n.date(1),n.hours(0),n.minutes(0),n.seconds(0),n.milliseconds(0);else if("week"==t)n.weekday()>2?(n.weekday(0),n.add(1,"week")):n.weekday(0),n.hours(0),n.minutes(0),n.seconds(0),n.milliseconds(0);else if("day"==t){switch(i){case 5:case 2:n.hours(24*Math.round(n.hours()/24));break;default:n.hours(12*Math.round(n.hours()/12))}n.minutes(0),n.seconds(0),n.milliseconds(0)}else if("weekday"==t){switch(i){case 5:case 2:n.hours(12*Math.round(n.hours()/12));break;default:n.hours(6*Math.round(n.hours()/6))}n.minutes(0),n.seconds(0),n.milliseconds(0)}else if("hour"==t){switch(i){case 4:n.minutes(60*Math.round(n.minutes()/60));break;default:n.minutes(30*Math.round(n.minutes()/30))}n.seconds(0),n.milliseconds(0)}else if("minute"==t){switch(i){case 15:case 10:n.minutes(5*Math.round(n.minutes()/5)),n.seconds(0);break;case 5:n.seconds(60*Math.round(n.seconds()/60));break;default:n.seconds(30*Math.round(n.seconds()/30))}n.milliseconds(0)}else if("second"==t)switch(i){case 15:case 10:n.seconds(5*Math.round(n.seconds()/5)),n.milliseconds(0);break;case 5:n.milliseconds(1e3*Math.round(n.milliseconds()/1e3));break;default:n.milliseconds(500*Math.round(n.milliseconds()/500))}else if("millisecond"==t){var a=i>5?i/2:1;n.milliseconds(Math.round(n.milliseconds()/a)*a)}return n},a.prototype.isMajor=function(){if(1==this.switchedYear)switch(this.scale){case"year":case"month":case"week":case"weekday":case"day":case"hour":case"minute":case"second":case"millisecond":return!0;default:return!1}else if(1==this.switchedMonth)switch(this.scale){case"week":case"weekday":case"day":case"hour":case"minute":case"second":case"millisecond":return!0;default:return!1}else if(1==this.switchedDay)switch(this.scale){case"millisecond":case"second":case"minute":case"hour":return!0;default:return!1}var e=this.moment(this.current);switch(this.scale){case"millisecond":return 0==e.milliseconds();case"second":return 0==e.seconds();case"minute":return 0==e.hours()&&0==e.minutes();case"hour":return 0==e.hours();case"weekday":case"day":case"week":return 1==e.date();case"month":return 0==e.month();case"year":default:return!1}},a.prototype.getLabelMinor=function(e){if(null==e&&(e=this.current),e instanceof Date&&(e=this.moment(e)),"function"==typeof this.format.minorLabels)return this.format.minorLabels(e,this.scale,this.step);var t=this.format.minorLabels[this.scale];switch(this.scale){case"week":if(this.isMajor()&&0!==e.weekday())return"";default:return t&&t.length>0?this.moment(e).format(t):""}},a.prototype.getLabelMajor=function(e){if(null==e&&(e=this.current),e instanceof Date&&(e=this.moment(e)),"function"==typeof this.format.majorLabels)return this.format.majorLabels(e,this.scale,this.step);var t=this.format.majorLabels[this.scale];return t&&t.length>0?this.moment(e).format(t):""},a.prototype.getClassName=function(){var e=this.moment,t=this.moment(this.current),i=t.locale?t.locale("en"):t.lang("en"),r=this.step,n=[];function o(e){return e/r%2==0?" vis-even":" vis-odd"}function a(t){return t.isSame(new Date,"day")?" vis-today":t.isSame(e().add(1,"day"),"day")?" vis-tomorrow":t.isSame(e().add(-1,"day"),"day")?" vis-yesterday":""}function s(e){return e.isSame(new Date,"week")?" vis-current-week":""}function l(e){return e.isSame(new Date,"month")?" vis-current-month":""}switch(this.scale){case"millisecond":n.push(a(i)),n.push(o(i.milliseconds()));break;case"second":n.push(a(i)),n.push(o(i.seconds()));break;case"minute":n.push(a(i)),n.push(o(i.minutes()));break;case"hour":n.push("vis-h"+i.hours()+(4==this.step?"-h"+(i.hours()+4):"")),n.push(a(i)),n.push(o(i.hours()));break;case"weekday":n.push("vis-"+i.format("dddd").toLowerCase()),n.push(a(i)),n.push(s(i)),n.push(o(i.date()));break;case"day":n.push("vis-day"+i.date()),n.push("vis-"+i.format("MMMM").toLowerCase()),n.push(a(i)),n.push(l(i)),n.push(this.step<=2?a(i):""),n.push(this.step<=2?"vis-"+i.format("dddd").toLowerCase():""),n.push(o(i.date()-1));break;case"week":n.push("vis-week"+i.format("w")),n.push(s(i)),n.push(o(i.week()));break;case"month":n.push("vis-"+i.format("MMMM").toLowerCase()),n.push(l(i)),n.push(o(i.month()));break;case"year":n.push("vis-year"+i.year()),n.push(i.isSame(new Date,"year")?" vis-current-year":""),n.push(o(i.year()))}return n.filter(String).join(" ")},e.exports=a},function(e,t,i){var r=i(2),n=i(16),o=i(9),a=i(98);function s(e,t){this.body=e,this.defaultOptions={rtl:!1,showCurrentTime:!0,moment:o,locales:a,locale:"en"},this.options=r.extend({},this.defaultOptions),this.offset=0,this._create(),this.setOptions(t)}s.prototype=new n,s.prototype._create=function(){var e=document.createElement("div");e.className="vis-current-time",e.style.position="absolute",e.style.top="0px",e.style.height="100%",this.bar=e},s.prototype.destroy=function(){this.options.showCurrentTime=!1,this.redraw(),this.body=null},s.prototype.setOptions=function(e){e&&r.selectiveExtend(["rtl","showCurrentTime","moment","locale","locales"],this.options,e)},s.prototype.redraw=function(){if(this.options.showCurrentTime){var e=this.body.dom.backgroundVertical;this.bar.parentNode!=e&&(this.bar.parentNode&&this.bar.parentNode.removeChild(this.bar),e.appendChild(this.bar),this.start());var t=this.options.moment((new Date).valueOf()+this.offset),i=this.body.util.toScreen(t),r=this.options.locales[this.options.locale];r||(this.warned||(console.log("WARNING: options.locales['"+this.options.locale+"'] not found. See http://visjs.org/docs/timeline/#Localization"),this.warned=!0),r=this.options.locales.en);var n=r.current+" "+r.time+": "+t.format("dddd, MMMM Do YYYY, H:mm:ss");n=n.charAt(0).toUpperCase()+n.substring(1),this.options.rtl?this.bar.style.right=i+"px":this.bar.style.left=i+"px",this.bar.title=n}else this.bar.parentNode&&this.bar.parentNode.removeChild(this.bar),this.stop();return!1},s.prototype.start=function(){var e=this;!function t(){e.stop();var i=1/e.body.range.conversion(e.body.domProps.center.width).scale/10;i<30&&(i=30),i>1e3&&(i=1e3),e.redraw(),e.body.emitter.emit("currentTimeTick"),e.currentTimeTimer=setTimeout(t,i)}()},s.prototype.stop=function(){void 0!==this.currentTimeTimer&&(clearTimeout(this.currentTimeTimer),delete this.currentTimeTimer)},s.prototype.setCurrentTime=function(e){var t=r.convert(e,"Date").valueOf(),i=(new Date).valueOf();this.offset=t-i,this.redraw()},s.prototype.getCurrentTime=function(){return new Date((new Date).valueOf()+this.offset)},e.exports=s},function(e,t,i){var r,n=i(8),o=(r=n)&&r.__esModule?r:{default:r};var a=i(2),s=i(100);function l(e,t,i){if(this.groupId=e,this.subgroups={},this.subgroupStack={},this.subgroupStackAll=!1,this.doInnerStack=!1,this.subgroupIndex=0,this.subgroupOrderer=t&&t.subgroupOrder,this.itemSet=i,this.isVisible=null,this.stackDirty=!0,t&&t.nestedGroups&&(this.nestedGroups=t.nestedGroups,0==t.showNested?this.showNested=!1:this.showNested=!0),t&&t.subgroupStack)if("boolean"==typeof t.subgroupStack)this.doInnerStack=t.subgroupStack,this.subgroupStackAll=t.subgroupStack;else for(var r in t.subgroupStack)this.subgroupStack[r]=t.subgroupStack[r],this.doInnerStack=this.doInnerStack||t.subgroupStack[r];this.nestedInGroup=null,this.dom={},this.props={label:{width:0,height:0}},this.className=null,this.items={},this.visibleItems=[],this.itemsInRange=[],this.orderedItems={byStart:[],byEnd:[]},this.checkRangedItems=!1;var n=this;this.itemSet.body.emitter.on("checkRangedItems",function(){n.checkRangedItems=!0}),this._create(),this.setData(t)}l.prototype._create=function(){var e=document.createElement("div");this.itemSet.options.groupEditable.order?e.className="vis-label draggable":e.className="vis-label",this.dom.label=e;var t=document.createElement("div");t.className="vis-inner",e.appendChild(t),this.dom.inner=t;var i=document.createElement("div");i.className="vis-group",i["timeline-group"]=this,this.dom.foreground=i,this.dom.background=document.createElement("div"),this.dom.background.className="vis-group",this.dom.axis=document.createElement("div"),this.dom.axis.className="vis-group",this.dom.marker=document.createElement("div"),this.dom.marker.style.visibility="hidden",this.dom.marker.style.position="absolute",this.dom.marker.innerHTML="",this.dom.background.appendChild(this.dom.marker)},l.prototype.setData=function(e){var t,i;if((t=this.itemSet.options&&this.itemSet.options.groupTemplate?(i=this.itemSet.options.groupTemplate.bind(this))(e,this.dom.inner):e&&e.content)instanceof Element){for(this.dom.inner.appendChild(t);this.dom.inner.firstChild;)this.dom.inner.removeChild(this.dom.inner.firstChild);this.dom.inner.appendChild(t)}else t instanceof Object?i(e,this.dom.inner):this.dom.inner.innerHTML=null!=t?t:this.groupId||"";if(this.dom.label.title=e&&e.title||"",this.dom.inner.firstChild?a.removeClassName(this.dom.inner,"vis-hidden"):a.addClassName(this.dom.inner,"vis-hidden"),e&&e.nestedGroups){this.nestedGroups&&this.nestedGroups==e.nestedGroups||(this.nestedGroups=e.nestedGroups),void 0===e.showNested&&void 0!==this.showNested||(0==e.showNested?this.showNested=!1:this.showNested=!0),a.addClassName(this.dom.label,"vis-nesting-group");var r=this.itemSet.options.rtl?"collapsed-rtl":"collapsed";this.showNested?(a.removeClassName(this.dom.label,r),a.addClassName(this.dom.label,"expanded")):(a.removeClassName(this.dom.label,"expanded"),a.addClassName(this.dom.label,r))}else this.nestedGroups&&(this.nestedGroups=null,r=this.itemSet.options.rtl?"collapsed-rtl":"collapsed",a.removeClassName(this.dom.label,r),a.removeClassName(this.dom.label,"expanded"),a.removeClassName(this.dom.label,"vis-nesting-group"));e&&e.nestedInGroup&&(a.addClassName(this.dom.label,"vis-nested-group"),this.itemSet.options&&this.itemSet.options.rtl?this.dom.inner.style.paddingRight="30px":this.dom.inner.style.paddingLeft="30px");var n=e&&e.className||null;n!=this.className&&(this.className&&(a.removeClassName(this.dom.label,this.className),a.removeClassName(this.dom.foreground,this.className),a.removeClassName(this.dom.background,this.className),a.removeClassName(this.dom.axis,this.className)),a.addClassName(this.dom.label,n),a.addClassName(this.dom.foreground,n),a.addClassName(this.dom.background,n),a.addClassName(this.dom.axis,n),this.className=n),this.style&&(a.removeCssText(this.dom.label,this.style),this.style=null),e&&e.style&&(a.addCssText(this.dom.label,e.style),this.style=e.style)},l.prototype.getLabelWidth=function(){return this.props.label.width},l.prototype._didMarkerHeightChange=function(){var e=this.dom.marker.clientHeight;if(e!=this.lastMarkerHeight){this.lastMarkerHeight=e;var t={},i=0;if(a.forEach(this.items,function(e,r){if(e.dirty=!0,e.displayed){t[r]=e.redraw(!0),i=t[r].length}}),i>0)for(var r=0;r<i;r++)a.forEach(t,function(e){e[r]()});return!0}},l.prototype._calculateGroupSizeAndPosition=function(){var e=this.dom.foreground.offsetTop,t=this.dom.foreground.offsetLeft,i=this.dom.foreground.offsetWidth;this.top=e,this.right=t,this.width=i},l.prototype._redrawItems=function(e,t,i,r){if(e||this.stackDirty||this.isVisible&&!t){var n={},o=null;if("function"==typeof this.itemSet.options.order){var l=this,u={},h=0;if(a.forEach(this.items,function(e,t){if(!e.displayed){u[t]=e.redraw(!0),h=u[t].length,l.visibleItems.push(e)}}),h>0)for(var c=0;c<h;c++)a.forEach(u,function(e){e[c]()});if(a.forEach(this.items,function(e){e.repositionX(!1)}),this.doInnerStack&&this.itemSet.options.stackSubgroups){for(o in this.subgroups)n[o]=this.subgroups[o].items.slice().sort(function(e,t){return l.itemSet.options.order(e.data,t.data)});s.stackSubgroupsWithInnerStack(n,i,this.subgroups)}else{var d=this.orderedItems.byStart.slice().sort(function(e,t){return l.itemSet.options.order(e.data,t.data)});s.stack(d,i,!0)}this.visibleItems=this._updateItemsInRange(this.orderedItems,this.visibleItems,r)}else if(this.visibleItems=this._updateItemsInRange(this.orderedItems,this.visibleItems,r),this.itemSet.options.stack)if(this.doInnerStack&&this.itemSet.options.stackSubgroups){for(o in this.subgroups)n[o]=this.subgroups[o].items;s.stackSubgroupsWithInnerStack(n,i,this.subgroups)}else s.stack(this.visibleItems,i,!0);else s.nostack(this.visibleItems,i,this.subgroups,this.itemSet.options.stackSubgroups);this.stackDirty=!1}},l.prototype._didResize=function(e,t){e=a.updateProperty(this,"height",t)||e;var i=this.dom.inner.clientWidth,r=this.dom.inner.clientHeight;return e=a.updateProperty(this.props.label,"width",i)||e,e=a.updateProperty(this.props.label,"height",r)||e},l.prototype._applyGroupHeight=function(e){this.dom.background.style.height=e+"px",this.dom.foreground.style.height=e+"px",this.dom.label.style.height=e+"px"},l.prototype._updateItemsVerticalPosition=function(e){for(var t=0,i=this.visibleItems.length;t<i;t++){var r=this.visibleItems[t];r.repositionY(e),this.isVisible||"__background__"==this.groupId||r.displayed&&r.hide()}},l.prototype.redraw=function(e,t,i,r){var n,o,a=!1,s=this.isVisible,l=[function(){i=this._didMarkerHeightChange.bind(this)}.bind(this),this._updateSubGroupHeights.bind(this,t),this._calculateGroupSizeAndPosition.bind(this),function(){this.isVisible=this._isGroupVisible.bind(this)(e,t)}.bind(this),function(){this._redrawItems.bind(this)(i,s,t,e)}.bind(this),this._updateSubgroupsSizes.bind(this),function(){n=this._calculateHeight.bind(this)(t)}.bind(this),this._calculateGroupSizeAndPosition.bind(this),function(){a=this._didResize.bind(this)(a,n)}.bind(this),function(){this._applyGroupHeight.bind(this)(n)}.bind(this),function(){this._updateItemsVerticalPosition.bind(this)(t)}.bind(this),function(){return!this.isVisible&&this.height&&(a=!1),a}];return r?l:(l.forEach(function(e){o=e()}),o)},l.prototype._updateSubGroupHeights=function(e){if((0,o.default)(this.subgroups).length>0){var t=this;this.resetSubgroups(),a.forEach(this.visibleItems,function(i){void 0!==i.data.subgroup&&(t.subgroups[i.data.subgroup].height=Math.max(t.subgroups[i.data.subgroup].height,i.height+e.item.vertical),t.subgroups[i.data.subgroup].visible=!0)})}},l.prototype._isGroupVisible=function(e,t){return this.top<=e.body.domProps.centerContainer.height-e.body.domProps.scrollTop+t.axis&&this.top+this.height+t.axis>=-e.body.domProps.scrollTop},l.prototype._calculateHeight=function(e){var t,i=this.visibleItems;if(i.length>0){var r=i[0].top,n=i[0].top+i[0].height;if(a.forEach(i,function(e){r=Math.min(r,e.top),n=Math.max(n,e.top+e.height)}),r>e.axis){var o=r-e.axis;n-=o,a.forEach(i,function(e){e.top-=o})}t=n+e.item.vertical/2}else t=0;return t=Math.max(t,this.props.label.height)},l.prototype.show=function(){this.dom.label.parentNode||this.itemSet.dom.labelSet.appendChild(this.dom.label),this.dom.foreground.parentNode||this.itemSet.dom.foreground.appendChild(this.dom.foreground),this.dom.background.parentNode||this.itemSet.dom.background.appendChild(this.dom.background),this.dom.axis.parentNode||this.itemSet.dom.axis.appendChild(this.dom.axis)},l.prototype.hide=function(){var e=this.dom.label;e.parentNode&&e.parentNode.removeChild(e);var t=this.dom.foreground;t.parentNode&&t.parentNode.removeChild(t);var i=this.dom.background;i.parentNode&&i.parentNode.removeChild(i);var r=this.dom.axis;r.parentNode&&r.parentNode.removeChild(r)},l.prototype.add=function(e){if(this.items[e.id]=e,e.setParent(this),this.stackDirty=!0,void 0!==e.data.subgroup&&(this._addToSubgroup(e),this.orderSubgroups()),-1==this.visibleItems.indexOf(e)){var t=this.itemSet.body.range;this._checkIfVisible(e,this.visibleItems,t)}},l.prototype._addToSubgroup=function(e,t){null!=(t=t||e.data.subgroup)&&void 0===this.subgroups[t]&&(this.subgroups[t]={height:0,top:0,start:e.data.start,end:e.data.end||e.data.start,visible:!1,index:this.subgroupIndex,items:[],stack:this.subgroupStackAll||this.subgroupStack[t]||!1},this.subgroupIndex++),new Date(e.data.start)<new Date(this.subgroups[t].start)&&(this.subgroups[t].start=e.data.start);var i=e.data.end||e.data.start;new Date(i)>new Date(this.subgroups[t].end)&&(this.subgroups[t].end=i),this.subgroups[t].items.push(e)},l.prototype._updateSubgroupsSizes=function(){var e=this;if(e.subgroups)for(var t in e.subgroups){var i=e.subgroups[t].items[0].data.end||e.subgroups[t].items[0].data.start,r=e.subgroups[t].items[0].data.start,n=i-1;e.subgroups[t].items.forEach(function(e){new Date(e.data.start)<new Date(r)&&(r=e.data.start);var t=e.data.end||e.data.start;new Date(t)>new Date(n)&&(n=t)}),e.subgroups[t].start=r,e.subgroups[t].end=new Date(n-1)}},l.prototype.orderSubgroups=function(){if(void 0!==this.subgroupOrderer){var e,t=[];if("string"==typeof this.subgroupOrderer){for(e in this.subgroups)t.push({subgroup:e,sortField:this.subgroups[e].items[0].data[this.subgroupOrderer]});t.sort(function(e,t){return e.sortField-t.sortField})}else if("function"==typeof this.subgroupOrderer){for(e in this.subgroups)t.push(this.subgroups[e].items[0].data);t.sort(this.subgroupOrderer)}if(t.length>0)for(var i=0;i<t.length;i++)this.subgroups[t[i].subgroup].index=i}},l.prototype.resetSubgroups=function(){for(var e in this.subgroups)this.subgroups.hasOwnProperty(e)&&(this.subgroups[e].visible=!1,this.subgroups[e].height=0)},l.prototype.remove=function(e){delete this.items[e.id],e.setParent(null),this.stackDirty=!0;var t=this.visibleItems.indexOf(e);-1!=t&&this.visibleItems.splice(t,1),void 0!==e.data.subgroup&&(this._removeFromSubgroup(e),this.orderSubgroups())},l.prototype._removeFromSubgroup=function(e,t){if(null!=(t=t||e.data.subgroup)){var i=this.subgroups[t];if(i){var r=i.items.indexOf(e);r>=0&&(i.items.splice(r,1),i.items.length?this._updateSubgroupsSizes():delete this.subgroups[t])}}},l.prototype.removeFromDataSet=function(e){this.itemSet.removeItem(e.id)},l.prototype.order=function(){for(var e=a.toArray(this.items),t=[],i=[],r=0;r<e.length;r++)void 0!==e[r].data.end&&i.push(e[r]),t.push(e[r]);this.orderedItems={byStart:t,byEnd:i},s.orderByStart(this.orderedItems.byStart),s.orderByEnd(this.orderedItems.byEnd)},l.prototype._updateItemsInRange=function(e,t,i){var r=[],n={},o=(i.end-i.start)/4,s=i.start-o,l=i.end+o,u=function(e){return e<s?-1:e<=l?0:1};if(t.length>0)for(var h=0;h<t.length;h++)this._checkIfVisibleWithReference(t[h],r,n,i);var c=a.binarySearchCustom(e.byStart,u,"data","start");if(this._traceVisible(c,e.byStart,r,n,function(e){return e.data.start<s||e.data.start>l}),1==this.checkRangedItems)for(this.checkRangedItems=!1,h=0;h<e.byEnd.length;h++)this._checkIfVisibleWithReference(e.byEnd[h],r,n,i);else{var d=a.binarySearchCustom(e.byEnd,u,"data","end");this._traceVisible(d,e.byEnd,r,n,function(e){return e.data.end<s||e.data.end>l})}var p={},f=0;for(h=0;h<r.length;h++){var m=r[h];if(!m.displayed){p[h]=m.redraw(!0),f=p[h].length}}if(f>0)for(var v=0;v<f;v++)a.forEach(p,function(e){e[v]()});for(h=0;h<r.length;h++)r[h].repositionX();return r},l.prototype._traceVisible=function(e,t,i,r,n){if(-1!=e){var o,a;for(o=e;o>=0&&!n(a=t[o]);o--)void 0===r[a.id]&&(r[a.id]=!0,i.push(a));for(o=e+1;o<t.length&&!n(a=t[o]);o++)void 0===r[a.id]&&(r[a.id]=!0,i.push(a))}},l.prototype._checkIfVisible=function(e,t,i){e.isVisible(i)?(e.displayed||e.show(),e.repositionX(),t.push(e)):e.displayed&&e.hide()},l.prototype._checkIfVisibleWithReference=function(e,t,i,r){e.isVisible(r)?void 0===i[e.id]&&(i[e.id]=!0,t.push(e)):e.displayed&&e.hide()},l.prototype.changeSubgroup=function(e,t,i){this._removeFromSubgroup(e,t),this._addToSubgroup(e,i),this.orderSubgroups()},e.exports=l},function(e,t,i){var r,n=i(29),o=(r=n)&&r.__esModule?r:{default:r};var a=i(68);function s(e,t,i){a.call(this,e,t,i),this.width=0,this.height=0,this.top=0,this.left=0}s.prototype=(0,o.default)(a.prototype),s.prototype.redraw=function(e,t,i){this.visibleItems=this._updateItemsInRange(this.orderedItems,this.visibleItems,e),this.width=this.dom.background.offsetWidth,this.dom.background.style.height="0";for(var r=0,n=this.visibleItems.length;r<n;r++){this.visibleItems[r].repositionY(t)}return!1},s.prototype.show=function(){this.dom.background.parentNode||this.itemSet.dom.background.appendChild(this.dom.background)},e.exports=s},function(e,t,i){var r=i(38);function n(e,t,i){if(this.props={content:{width:0}},this.overflow=!1,this.options=i,e){if(null==e.start)throw new Error('Property "start" missing in item '+e.id);if(null==e.end)throw new Error('Property "end" missing in item '+e.id)}r.call(this,e,t,i)}n.prototype=new r(null,null,null),n.prototype.baseClassName="vis-item vis-range",n.prototype.isVisible=function(e){return this.data.start<e.end&&this.data.end>e.start},n.prototype._createDomElement=function(){this.dom||(this.dom={},this.dom.box=document.createElement("div"),this.dom.frame=document.createElement("div"),this.dom.frame.className="vis-item-overflow",this.dom.box.appendChild(this.dom.frame),this.dom.visibleFrame=document.createElement("div"),this.dom.visibleFrame.className="vis-item-visible-frame",this.dom.box.appendChild(this.dom.visibleFrame),this.dom.content=document.createElement("div"),this.dom.content.className="vis-item-content",this.dom.frame.appendChild(this.dom.content),this.dom.box["timeline-item"]=this,this.dirty=!0)},n.prototype._appendDomElement=function(){if(!this.parent)throw new Error("Cannot redraw item: no parent attached");if(!this.dom.box.parentNode){var e=this.parent.dom.foreground;if(!e)throw new Error("Cannot redraw item: parent has no foreground container element");e.appendChild(this.dom.box)}this.displayed=!0},n.prototype._updateDirtyDomComponents=function(){if(this.dirty){this._updateContents(this.dom.content),this._updateDataAttributes(this.dom.box),this._updateStyle(this.dom.box);var e=this.editable.updateTime||this.editable.updateGroup,t=(this.data.className?" "+this.data.className:"")+(this.selected?" vis-selected":"")+(e?" vis-editable":" vis-readonly");this.dom.box.className=this.baseClassName+t,this.dom.content.style.maxWidth="none"}},n.prototype._getDomComponentsSizes=function(){return this.overflow="hidden"!==window.getComputedStyle(this.dom.frame).overflow,{content:{width:this.dom.content.offsetWidth},box:{height:this.dom.box.offsetHeight}}},n.prototype._updateDomComponentsSizes=function(e){this.props.content.width=e.content.width,this.height=e.box.height,this.dom.content.style.maxWidth="",this.dirty=!1},n.prototype._repaintDomAdditionals=function(){this._repaintOnItemUpdateTimeTooltip(this.dom.box),this._repaintDeleteButton(this.dom.box),this._repaintDragCenter(),this._repaintDragLeft(),this._repaintDragRight()},n.prototype.redraw=function(e){var t,i,r=[this._createDomElement.bind(this),this._appendDomElement.bind(this),this._updateDirtyDomComponents.bind(this),function(){this.dirty&&(t=this._getDomComponentsSizes.bind(this)())}.bind(this),function(){this.dirty&&this._updateDomComponentsSizes.bind(this)(t)}.bind(this),this._repaintDomAdditionals.bind(this)];return e?r:(r.forEach(function(e){i=e()}),i)},n.prototype.show=function(){this.displayed||this.redraw()},n.prototype.hide=function(){if(this.displayed){var e=this.dom.box;e.parentNode&&e.parentNode.removeChild(e),this.displayed=!1}},n.prototype.repositionX=function(e){var t,i,r=this.parent.width,n=this.conversion.toScreen(this.data.start),o=this.conversion.toScreen(this.data.end),a=void 0===this.data.align?this.options.align:this.data.align;!1===this.data.limitSize||void 0!==e&&!0!==e||(n<-r&&(n=-r),o>2*r&&(o=2*r));var s=Math.max(o-n+.5,1);switch(this.overflow?(this.options.rtl?this.right=n:this.left=n,this.width=s+this.props.content.width,i=this.props.content.width):(this.options.rtl?this.right=n:this.left=n,this.width=s,i=Math.min(o-n,this.props.content.width)),this.options.rtl?this.dom.box.style.right=this.right+"px":this.dom.box.style.left=this.left+"px",this.dom.box.style.width=s+"px",a){case"left":this.options.rtl?this.dom.content.style.right="0":this.dom.content.style.left="0";break;case"right":this.options.rtl?this.dom.content.style.right=Math.max(s-i,0)+"px":this.dom.content.style.left=Math.max(s-i,0)+"px";break;case"center":this.options.rtl?this.dom.content.style.right=Math.max((s-i)/2,0)+"px":this.dom.content.style.left=Math.max((s-i)/2,0)+"px";break;default:t=this.overflow?o>0?Math.max(-n,0):-i:n<0?-n:0,this.options.rtl?this.dom.content.style.right=t+"px":(this.dom.content.style.left=t+"px",this.dom.content.style.width="calc(100% - "+t+"px)")}},n.prototype.repositionY=function(){var e=this.options.orientation.item,t=this.dom.box;t.style.top="top"==e?this.top+"px":this.parent.height-this.top-this.height+"px"},n.prototype._repaintDragLeft=function(){if((this.selected||this.options.itemsAlwaysDraggable.range)&&this.options.editable.updateTime&&!this.dom.dragLeft){var e=document.createElement("div");e.className="vis-drag-left",e.dragLeftItem=this,this.dom.box.appendChild(e),this.dom.dragLeft=e}else this.selected||this.options.itemsAlwaysDraggable.range||!this.dom.dragLeft||(this.dom.dragLeft.parentNode&&this.dom.dragLeft.parentNode.removeChild(this.dom.dragLeft),this.dom.dragLeft=null)},n.prototype._repaintDragRight=function(){if((this.selected||this.options.itemsAlwaysDraggable.range)&&this.options.editable.updateTime&&!this.dom.dragRight){var e=document.createElement("div");e.className="vis-drag-right",e.dragRightItem=this,this.dom.box.appendChild(e),this.dom.dragRight=e}else this.selected||this.options.itemsAlwaysDraggable.range||!this.dom.dragRight||(this.dom.dragRight.parentNode&&this.dom.dragRight.parentNode.removeChild(this.dom.dragRight),this.dom.dragRight=null)},e.exports=n},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=s(i(19)),n=s(i(6)),o=s(i(0)),a=s(i(1));function s(e){return e&&e.__esModule?e:{default:e}}var l=i(2),u=i(179).default,h=function(){function e(t,i,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;(0,o.default)(this,e),this.parent=t,this.changedOptions=[],this.container=i,this.allowCreation=!1,this.options={},this.initialized=!1,this.popupCounter=0,this.defaultOptions={enabled:!1,filter:!0,container:void 0,showButton:!0},l.extend(this.options,this.defaultOptions),this.configureOptions=r,this.moduleOptions={},this.domElements=[],this.popupDiv={},this.popupLimit=5,this.popupHistory={},this.colorPicker=new u(n),this.wrapper=void 0}return(0,a.default)(e,[{key:"setOptions",value:function(e){if(void 0!==e){this.popupHistory={},this._removePopup();var t=!0;"string"==typeof e?this.options.filter=e:e instanceof Array?this.options.filter=e.join():"object"===(void 0===e?"undefined":(0,n.default)(e))?(void 0!==e.container&&(this.options.container=e.container),void 0!==e.filter&&(this.options.filter=e.filter),void 0!==e.showButton&&(this.options.showButton=e.showButton),void 0!==e.enabled&&(t=e.enabled)):"boolean"==typeof e?(this.options.filter=!0,t=e):"function"==typeof e&&(this.options.filter=e,t=!0),!1===this.options.filter&&(t=!1),this.options.enabled=t}this._clean()}},{key:"setModuleOptions",value:function(e){this.moduleOptions=e,!0===this.options.enabled&&(this._clean(),void 0!==this.options.container&&(this.container=this.options.container),this._create())}},{key:"_create",value:function(){var e=this;this._clean(),this.changedOptions=[];var t=this.options.filter,i=0,r=!1;for(var n in this.configureOptions)this.configureOptions.hasOwnProperty(n)&&(this.allowCreation=!1,r=!1,"function"==typeof t?r=(r=t(n,[]))||this._handleObject(this.configureOptions[n],[n],!0):!0!==t&&-1===t.indexOf(n)||(r=!0),!1!==r&&(this.allowCreation=!0,i>0&&this._makeItem([]),this._makeHeader(n),this._handleObject(this.configureOptions[n],[n])),i++);if(!0===this.options.showButton){var o=document.createElement("div");o.className="vis-configuration vis-config-button",o.innerHTML="generate options",o.onclick=function(){e._printOptions()},o.onmouseover=function(){o.className="vis-configuration vis-config-button hover"},o.onmouseout=function(){o.className="vis-configuration vis-config-button"},this.optionsContainer=document.createElement("div"),this.optionsContainer.className="vis-configuration vis-config-option-container",this.domElements.push(this.optionsContainer),this.domElements.push(o)}this._push()}},{key:"_push",value:function(){this.wrapper=document.createElement("div"),this.wrapper.className="vis-configuration-wrapper",this.container.appendChild(this.wrapper);for(var e=0;e<this.domElements.length;e++)this.wrapper.appendChild(this.domElements[e]);this._showPopupIfNeeded()}},{key:"_clean",value:function(){for(var e=0;e<this.domElements.length;e++)this.wrapper.removeChild(this.domElements[e]);void 0!==this.wrapper&&(this.container.removeChild(this.wrapper),this.wrapper=void 0),this.domElements=[],this._removePopup()}},{key:"_getValue",value:function(e){for(var t=this.moduleOptions,i=0;i<e.length;i++){if(void 0===t[e[i]]){t=void 0;break}t=t[e[i]]}return t}},{key:"_makeItem",value:function(e){if(!0===this.allowCreation){var t=document.createElement("div");t.className="vis-configuration vis-config-item vis-config-s"+e.length;for(var i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];return r.forEach(function(e){t.appendChild(e)}),this.domElements.push(t),this.domElements.length}return 0}},{key:"_makeHeader",value:function(e){var t=document.createElement("div");t.className="vis-configuration vis-config-header",t.innerHTML=e,this._makeItem([],t)}},{key:"_makeLabel",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=document.createElement("div");return r.className="vis-configuration vis-config-label vis-config-s"+t.length,r.innerHTML=!0===i?"<i><b>"+e+":</b></i>":e+":",r}},{key:"_makeDropdown",value:function(e,t,i){var r=document.createElement("select");r.className="vis-configuration vis-config-select";var n=0;void 0!==t&&-1!==e.indexOf(t)&&(n=e.indexOf(t));for(var o=0;o<e.length;o++){var a=document.createElement("option");a.value=e[o],o===n&&(a.selected="selected"),a.innerHTML=e[o],r.appendChild(a)}var s=this;r.onchange=function(){s._update(this.value,i)};var l=this._makeLabel(i[i.length-1],i);this._makeItem(i,l,r)}},{key:"_makeRange",value:function(e,t,i){var r=e[0],n=e[1],o=e[2],a=e[3],s=document.createElement("input");s.className="vis-configuration vis-config-range";try{s.type="range",s.min=n,s.max=o}catch(e){}s.step=a;var l="",u=0;if(void 0!==t){t<0&&1.2*t<n?(s.min=Math.ceil(1.2*t),u=s.min,l="range increased"):t/1.2<n&&(s.min=Math.ceil(t/1.2),u=s.min,l="range increased"),1.2*t>o&&1!==o&&(s.max=Math.ceil(1.2*t),u=s.max,l="range increased"),s.value=t}else s.value=r;var h=document.createElement("input");h.className="vis-configuration vis-config-rangeinput",h.value=s.value;var c=this;s.onchange=function(){h.value=this.value,c._update(Number(this.value),i)},s.oninput=function(){h.value=this.value};var d=this._makeLabel(i[i.length-1],i),p=this._makeItem(i,d,s,h);""!==l&&this.popupHistory[p]!==u&&(this.popupHistory[p]=u,this._setupPopup(l,p))}},{key:"_setupPopup",value:function(e,t){var i=this;if(!0===this.initialized&&!0===this.allowCreation&&this.popupCounter<this.popupLimit){var r=document.createElement("div");r.id="vis-configuration-popup",r.className="vis-configuration-popup",r.innerHTML=e,r.onclick=function(){i._removePopup()},this.popupCounter+=1,this.popupDiv={html:r,index:t}}}},{key:"_removePopup",value:function(){void 0!==this.popupDiv.html&&(this.popupDiv.html.parentNode.removeChild(this.popupDiv.html),clearTimeout(this.popupDiv.hideTimeout),clearTimeout(this.popupDiv.deleteTimeout),this.popupDiv={})}},{key:"_showPopupIfNeeded",value:function(){var e=this;if(void 0!==this.popupDiv.html){var t=this.domElements[this.popupDiv.index].getBoundingClientRect();this.popupDiv.html.style.left=t.left+"px",this.popupDiv.html.style.top=t.top-30+"px",document.body.appendChild(this.popupDiv.html),this.popupDiv.hideTimeout=setTimeout(function(){e.popupDiv.html.style.opacity=0},1500),this.popupDiv.deleteTimeout=setTimeout(function(){e._removePopup()},1800)}}},{key:"_makeCheckbox",value:function(e,t,i){var r=document.createElement("input");r.type="checkbox",r.className="vis-configuration vis-config-checkbox",r.checked=e,void 0!==t&&(r.checked=t,t!==e&&("object"===(void 0===e?"undefined":(0,n.default)(e))?t!==e.enabled&&this.changedOptions.push({path:i,value:t}):this.changedOptions.push({path:i,value:t})));var o=this;r.onchange=function(){o._update(this.checked,i)};var a=this._makeLabel(i[i.length-1],i);this._makeItem(i,a,r)}},{key:"_makeTextInput",value:function(e,t,i){var r=document.createElement("input");r.type="text",r.className="vis-configuration vis-config-text",r.value=t,t!==e&&this.changedOptions.push({path:i,value:t});var n=this;r.onchange=function(){n._update(this.value,i)};var o=this._makeLabel(i[i.length-1],i);this._makeItem(i,o,r)}},{key:"_makeColorField",value:function(e,t,i){var r=this,n=e[1],o=document.createElement("div");"none"!==(t=void 0===t?n:t)?(o.className="vis-configuration vis-config-colorBlock",o.style.backgroundColor=t):o.className="vis-configuration vis-config-colorBlock none",t=void 0===t?n:t,o.onclick=function(){r._showColorPicker(t,o,i)};var a=this._makeLabel(i[i.length-1],i);this._makeItem(i,a,o)}},{key:"_showColorPicker",value:function(e,t,i){var r=this;t.onclick=function(){},this.colorPicker.insertTo(t),this.colorPicker.show(),this.colorPicker.setColor(e),this.colorPicker.setUpdateCallback(function(e){var n="rgba("+e.r+","+e.g+","+e.b+","+e.a+")";t.style.backgroundColor=n,r._update(n,i)}),this.colorPicker.setCloseCallback(function(){t.onclick=function(){r._showColorPicker(e,t,i)}})}},{key:"_handleObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!1,n=this.options.filter,o=!1;for(var a in e)if(e.hasOwnProperty(a)){r=!0;var s=e[a],u=l.copyAndExtendArray(t,a);if("function"==typeof n&&!1===(r=n(a,t))&&!(s instanceof Array)&&"string"!=typeof s&&"boolean"!=typeof s&&s instanceof Object&&(this.allowCreation=!1,r=this._handleObject(s,u,!0),this.allowCreation=!1===i),!1!==r){o=!0;var h=this._getValue(u);if(s instanceof Array)this._handleArray(s,h,u);else if("string"==typeof s)this._makeTextInput(s,h,u);else if("boolean"==typeof s)this._makeCheckbox(s,h,u);else if(s instanceof Object){var c=!0;if(-1!==t.indexOf("physics")&&this.moduleOptions.physics.solver!==a&&(c=!1),!0===c)if(void 0!==s.enabled){var d=l.copyAndExtendArray(u,"enabled"),p=this._getValue(d);if(!0===p){var f=this._makeLabel(a,u,!0);this._makeItem(u,f),o=this._handleObject(s,u)||o}else this._makeCheckbox(s,p,u)}else{var m=this._makeLabel(a,u,!0);this._makeItem(u,m),o=this._handleObject(s,u)||o}}else console.error("dont know how to handle",s,a,u)}}return o}},{key:"_handleArray",value:function(e,t,i){"string"==typeof e[0]&&"color"===e[0]?(this._makeColorField(e,t,i),e[1]!==t&&this.changedOptions.push({path:i,value:t})):"string"==typeof e[0]?(this._makeDropdown(e,t,i),e[0]!==t&&this.changedOptions.push({path:i,value:t})):"number"==typeof e[0]&&(this._makeRange(e,t,i),e[0]!==t&&this.changedOptions.push({path:i,value:Number(t)}))}},{key:"_update",value:function(e,t){var i=this._constructOptions(e,t);this.parent.body&&this.parent.body.emitter&&this.parent.body.emitter.emit&&this.parent.body.emitter.emit("configChange",i),this.initialized=!0,this.parent.setOptions(i)}},{key:"_constructOptions",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i;e="false"!==(e="true"===e||e)&&e;for(var n=0;n<t.length;n++)"global"!==t[n]&&(void 0===r[t[n]]&&(r[t[n]]={}),n!==t.length-1?r=r[t[n]]:r[t[n]]=e);return i}},{key:"_printOptions",value:function(){var e=this.getOptions();this.optionsContainer.innerHTML="<pre>var options = "+(0,r.default)(e,null,2)+"</pre>"}},{key:"getOptions",value:function(){for(var e={},t=0;t<this.changedOptions.length;t++)this._constructOptions(this.changedOptions[t].value,this.changedOptions[t].path,e);return e}}]),e}();t.default=h},function(e,t,i){var r,n=i(6),o=(r=n)&&r.__esModule?r:{default:r};var a=i(14);function s(e,t){}function l(e,t){return{style:(t=void 0===t?{}:t).style||e.options.drawPoints.style,styles:t.styles||e.options.drawPoints.styles,size:t.size||e.options.drawPoints.size,className:t.className||e.className}}s.draw=function(e,t,i,r){r=r||0;for(var n=function(e,t){var i=void 0;e.options&&e.options.drawPoints&&e.options.drawPoints.onRender&&"function"==typeof e.options.drawPoints.onRender&&(i=e.options.drawPoints.onRender);t.group.options&&t.group.options.drawPoints&&t.group.options.drawPoints.onRender&&"function"==typeof t.group.options.drawPoints.onRender&&(i=t.group.options.drawPoints.onRender);return i}(i,t),s=0;s<e.length;s++)if(n){var u=n(e[s],t);!0!==u&&"object"!==(void 0===u?"undefined":(0,o.default)(u))||a.drawPoint(e[s].screen_x+r,e[s].screen_y,l(t,u),i.svgElements,i.svg,e[s].label)}else a.drawPoint(e[s].screen_x+r,e[s].screen_y,l(t),i.svgElements,i.svg,e[s].label)},s.drawIcon=function(e,t,i,r,n,o){var s=.5*n,u=a.getSVGElement("rect",o.svgElements,o.svg);u.setAttributeNS(null,"x",t),u.setAttributeNS(null,"y",i-s),u.setAttributeNS(null,"width",r),u.setAttributeNS(null,"height",2*s),u.setAttributeNS(null,"class","vis-outline"),a.drawPoint(t+.5*r,i,l(e),o.svgElements,o.svg)},e.exports=s},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o){(0,n.default)(this,t);var s=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o));return s.labelOffset=0,s.selected=!1,s}return(0,s.default)(t,e),(0,o.default)(t,[{key:"setOptions",value:function(e,t,i){this.options=e,void 0===t&&void 0===i||this.setImages(t,i)}},{key:"setImages",value:function(e,t){t&&this.selected?(this.imageObj=t,this.imageObjAlt=e):(this.imageObj=e,this.imageObjAlt=t)}},{key:"switchImages",value:function(e){var t=e&&!this.selected||!e&&this.selected;if(this.selected=e,void 0!==this.imageObjAlt&&t){var i=this.imageObj;this.imageObj=this.imageObjAlt,this.imageObjAlt=i}}},{key:"_resizeImage",value:function(){var e,t;if(!1===this.options.shapeProperties.useImageSize){var i=1,r=1;this.imageObj.width&&this.imageObj.height&&(this.imageObj.width>this.imageObj.height?i=this.imageObj.width/this.imageObj.height:r=this.imageObj.height/this.imageObj.width),e=2*this.options.size*i,t=2*this.options.size*r}else e=this.imageObj.width,t=this.imageObj.height;this.width=e,this.height=t,this.radius=.5*this.width}},{key:"_drawRawCircle",value:function(e,t,i,r){this.initContextForDraw(e,r),e.circle(t,i,r.size),this.performFill(e,r)}},{key:"_drawImageAtPosition",value:function(e,t){if(0!=this.imageObj.width){e.globalAlpha=1,this.enableShadow(e,t);var i=1;!0===this.options.shapeProperties.interpolation&&(i=this.imageObj.width/this.width/this.body.view.scale),this.imageObj.drawImageAtPosition(e,i,this.left,this.top,this.width,this.height),this.disableShadow(e,t)}}},{key:"_drawImageLabel",value:function(e,t,i,r,n){var o,a=0;if(void 0!==this.height){a=.5*this.height;var s=this.labelModule.getTextSize(e,r,n);s.lineCount>=1&&(a+=s.height/2)}o=i+a,this.options.label&&(this.labelOffset=a),this.labelModule.draw(e,t,o,r,n,"hanging")}}]),t}(l(i(23)).default);t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(19)),n=l(i(6)),o=l(i(29)),a=l(i(0)),s=l(i(1));function l(e){return e&&e.__esModule?e:{default:e}}var u=i(2),h=i(117).default,c=i(48).default,d=i(215).default,p=i(217).default,f=i(218).default,m=i(219).default,v=function(){function e(t,i,r,n){if((0,a.default)(this,e),void 0===i)throw new Error("No body provided");this.options=u.bridgeObject(r),this.globalOptions=r,this.defaultOptions=n,this.body=i,this.id=void 0,this.fromId=void 0,this.toId=void 0,this.selected=!1,this.hover=!1,this.labelDirty=!0,this.baseWidth=this.options.width,this.baseFontSize=this.options.font.size,this.from=void 0,this.to=void 0,this.edgeType=void 0,this.connected=!1,this.labelModule=new h(this.body,this.options,!0),this.setOptions(t)}return(0,s.default)(e,[{key:"setOptions",value:function(t){if(t){e.parseOptions(this.options,t,!0,this.globalOptions),void 0!==t.id&&(this.id=t.id),void 0!==t.from&&(this.fromId=t.from),void 0!==t.to&&(this.toId=t.to),void 0!==t.title&&(this.title=t.title),void 0!==t.value&&(t.value=parseFloat(t.value));var i=[t,this.options,this.defaultOptions];this.chooser=c.choosify("edge",i),this.updateLabelModule(t);var r=this.updateEdgeType();return this._setInteractionWidths(),this.connect(),void 0===t.hidden&&void 0===t.physics||(r=!0),r}}},{key:"getFormattingValues",value:function(){var e=!0===this.options.arrows.to||!0===this.options.arrows.to.enabled,t=!0===this.options.arrows.from||!0===this.options.arrows.from.enabled,i=!0===this.options.arrows.middle||!0===this.options.arrows.middle.enabled,r=this.options.color.inherit,n={toArrow:e,toArrowScale:this.options.arrows.to.scaleFactor,toArrowType:this.options.arrows.to.type,middleArrow:i,middleArrowScale:this.options.arrows.middle.scaleFactor,middleArrowType:this.options.arrows.middle.type,fromArrow:t,fromArrowScale:this.options.arrows.from.scaleFactor,fromArrowType:this.options.arrows.from.type,arrowStrikethrough:this.options.arrowStrikethrough,color:r?void 0:this.options.color.color,inheritsColor:r,opacity:this.options.color.opacity,hidden:this.options.hidden,length:this.options.length,shadow:this.options.shadow.enabled,shadowColor:this.options.shadow.color,shadowSize:this.options.shadow.size,shadowX:this.options.shadow.x,shadowY:this.options.shadow.y,dashes:this.options.dashes,width:this.options.width};if(this.selected||this.hover)if(!0===this.chooser){if(this.selected){var o=this.options.selectionWidth;"function"==typeof o?n.width=o(n.width):"number"==typeof o&&(n.width+=o),n.width=Math.max(n.width,.3/this.body.view.scale),n.color=this.options.color.highlight,n.shadow=this.options.shadow.enabled}else if(this.hover){var a=this.options.hoverWidth;"function"==typeof a?n.width=a(n.width):"number"==typeof a&&(n.width+=a),n.width=Math.max(n.width,.3/this.body.view.scale),n.color=this.options.color.hover,n.shadow=this.options.shadow.enabled}}else"function"==typeof this.chooser&&(this.chooser(n,this.options.id,this.selected,this.hover),void 0!==n.color&&(n.inheritsColor=!1),!1===n.shadow&&(n.shadowColor===this.options.shadow.color&&n.shadowSize===this.options.shadow.size&&n.shadowX===this.options.shadow.x&&n.shadowY===this.options.shadow.y||(n.shadow=!0)));else n.shadow=this.options.shadow.enabled,n.width=Math.max(n.width,.3/this.body.view.scale);return n}},{key:"updateLabelModule",value:function(e){var t=[e,this.options,this.globalOptions,this.defaultOptions];this.labelModule.update(this.options,t),void 0!==this.labelModule.baseSize&&(this.baseFontSize=this.labelModule.baseSize)}},{key:"updateEdgeType",value:function(){var e=this.options.smooth,t=!1,i=!0;return void 0!==this.edgeType&&((this.edgeType instanceof p&&!0===e.enabled&&"dynamic"===e.type||this.edgeType instanceof d&&!0===e.enabled&&"cubicBezier"===e.type||this.edgeType instanceof f&&!0===e.enabled&&"dynamic"!==e.type&&"cubicBezier"!==e.type||this.edgeType instanceof m&&!1===e.type.enabled)&&(i=!1),!0===i&&(t=this.cleanup())),!0===i?!0===e.enabled?"dynamic"===e.type?(t=!0,this.edgeType=new p(this.options,this.body,this.labelModule)):"cubicBezier"===e.type?this.edgeType=new d(this.options,this.body,this.labelModule):this.edgeType=new f(this.options,this.body,this.labelModule):this.edgeType=new m(this.options,this.body,this.labelModule):this.edgeType.setOptions(this.options),t}},{key:"connect",value:function(){this.disconnect(),this.from=this.body.nodes[this.fromId]||void 0,this.to=this.body.nodes[this.toId]||void 0,this.connected=void 0!==this.from&&void 0!==this.to,!0===this.connected?(this.from.attachEdge(this),this.to.attachEdge(this)):(this.from&&this.from.detachEdge(this),this.to&&this.to.detachEdge(this)),this.edgeType.connect()}},{key:"disconnect",value:function(){this.from&&(this.from.detachEdge(this),this.from=void 0),this.to&&(this.to.detachEdge(this),this.to=void 0),this.connected=!1}},{key:"getTitle",value:function(){return this.title}},{key:"isSelected",value:function(){return this.selected}},{key:"getValue",value:function(){return this.options.value}},{key:"setValueRange",value:function(e,t,i){if(void 0!==this.options.value){var r=this.options.scaling.customScalingFunction(e,t,i,this.options.value),n=this.options.scaling.max-this.options.scaling.min;if(!0===this.options.scaling.label.enabled){var o=this.options.scaling.label.max-this.options.scaling.label.min;this.options.font.size=this.options.scaling.label.min+r*o}this.options.width=this.options.scaling.min+r*n}else this.options.width=this.baseWidth,this.options.font.size=this.baseFontSize;this._setInteractionWidths(),this.updateLabelModule()}},{key:"_setInteractionWidths",value:function(){"function"==typeof this.options.hoverWidth?this.edgeType.hoverWidth=this.options.hoverWidth(this.options.width):this.edgeType.hoverWidth=this.options.hoverWidth+this.options.width,"function"==typeof this.options.selectionWidth?this.edgeType.selectionWidth=this.options.selectionWidth(this.options.width):this.edgeType.selectionWidth=this.options.selectionWidth+this.options.width}},{key:"draw",value:function(e){var t=this.getFormattingValues();if(!t.hidden){var i=this.edgeType.getViaNode(),r={};this.edgeType.fromPoint=this.edgeType.from,this.edgeType.toPoint=this.edgeType.to,t.fromArrow&&(r.from=this.edgeType.getArrowData(e,"from",i,this.selected,this.hover,t),!1===t.arrowStrikethrough&&(this.edgeType.fromPoint=r.from.core)),t.toArrow&&(r.to=this.edgeType.getArrowData(e,"to",i,this.selected,this.hover,t),!1===t.arrowStrikethrough&&(this.edgeType.toPoint=r.to.core)),t.middleArrow&&(r.middle=this.edgeType.getArrowData(e,"middle",i,this.selected,this.hover,t)),this.edgeType.drawLine(e,t,this.selected,this.hover,i),this.drawArrows(e,r,t),this.drawLabel(e,i)}}},{key:"drawArrows",value:function(e,t,i){i.fromArrow&&this.edgeType.drawArrowHead(e,i,this.selected,this.hover,t.from),i.middleArrow&&this.edgeType.drawArrowHead(e,i,this.selected,this.hover,t.middle),i.toArrow&&this.edgeType.drawArrowHead(e,i,this.selected,this.hover,t.to)}},{key:"drawLabel",value:function(e,t){if(void 0!==this.options.label){var i=this.from,r=this.to;if(this.labelModule.differentState(this.selected,this.hover)&&this.labelModule.getTextSize(e,this.selected,this.hover),i.id!=r.id){this.labelModule.pointToSelf=!1;var n=this.edgeType.getPoint(.5,t);e.save();var o=this._getRotation(e);0!=o.angle&&(e.translate(o.x,o.y),e.rotate(o.angle)),this.labelModule.draw(e,n.x,n.y,this.selected,this.hover),e.restore()}else{var a,s;this.labelModule.pointToSelf=!0;var l=this.options.selfReferenceSize;i.shape.width>i.shape.height?(a=i.x+.5*i.shape.width,s=i.y-l):(a=i.x+l,s=i.y-.5*i.shape.height),n=this._pointOnCircle(a,s,l,.125),this.labelModule.draw(e,n.x,n.y,this.selected,this.hover)}}}},{key:"getItemsOnPoint",value:function(e){var t=[];if(this.labelModule.visible()){var i=this._getRotation();c.pointInRect(this.labelModule.getSize(),e,i)&&t.push({edgeId:this.id,labelId:0})}var r={left:e.x,top:e.y};return this.isOverlappingWith(r)&&t.push({edgeId:this.id}),t}},{key:"isOverlappingWith",value:function(e){if(this.connected){var t=this.from.x,i=this.from.y,r=this.to.x,n=this.to.y,o=e.left,a=e.top;return this.edgeType.getDistanceToEdge(t,i,r,n,o,a)<10}return!1}},{key:"_getRotation",value:function(e){var t=this.edgeType.getViaNode(),i=this.edgeType.getPoint(.5,t);void 0!==e&&this.labelModule.calculateLabelSize(e,this.selected,this.hover,i.x,i.y);var r={x:i.x,y:this.labelModule.size.yLine,angle:0};if(!this.labelModule.visible())return r;if("horizontal"===this.options.font.align)return r;var n=this.from.y-this.to.y,o=this.from.x-this.to.x,a=Math.atan2(n,o);return(a<-1&&o<0||a>0&&o<0)&&(a+=Math.PI),r.angle=a,r}},{key:"_pointOnCircle",value:function(e,t,i,r){var n=2*r*Math.PI;return{x:e+i*Math.cos(n),y:t-i*Math.sin(n)}}},{key:"select",value:function(){this.selected=!0}},{key:"unselect",value:function(){this.selected=!1}},{key:"cleanup",value:function(){return this.edgeType.cleanup()}},{key:"remove",value:function(){this.cleanup(),this.disconnect(),delete this.body.edges[this.id]}},{key:"endPointsValid",value:function(){return void 0!==this.body.nodes[this.fromId]&&void 0!==this.body.nodes[this.toId]}}],[{key:"parseOptions",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(u.selectiveDeepExtend(["arrowStrikethrough","id","from","hidden","hoverWidth","labelHighlightBold","length","line","opacity","physics","scaling","selectionWidth","selfReferenceSize","to","title","value","width","font","chosen","widthConstraint"],e,t,i),c.isValidLabel(t.label)?e.label=t.label:e.label=void 0,u.mergeOptions(e,t,"smooth",a),u.mergeOptions(e,t,"shadow",a),void 0!==t.dashes&&null!==t.dashes?e.dashes=t.dashes:!0===i&&null===t.dashes&&(e.dashes=(0,o.default)(a.dashes)),void 0!==t.scaling&&null!==t.scaling?(void 0!==t.scaling.min&&(e.scaling.min=t.scaling.min),void 0!==t.scaling.max&&(e.scaling.max=t.scaling.max),u.mergeOptions(e.scaling,t.scaling,"label",a.scaling)):!0===i&&null===t.scaling&&(e.scaling=(0,o.default)(a.scaling)),void 0!==t.arrows&&null!==t.arrows)if("string"==typeof t.arrows){var l=t.arrows.toLowerCase();e.arrows.to.enabled=-1!=l.indexOf("to"),e.arrows.middle.enabled=-1!=l.indexOf("middle"),e.arrows.from.enabled=-1!=l.indexOf("from")}else{if("object"!==(0,n.default)(t.arrows))throw new Error("The arrow newOptions can only be an object or a string. Refer to the documentation. You used:"+(0,r.default)(t.arrows));u.mergeOptions(e.arrows,t.arrows,"to",a.arrows),u.mergeOptions(e.arrows,t.arrows,"middle",a.arrows),u.mergeOptions(e.arrows,t.arrows,"from",a.arrows)}else!0===i&&null===t.arrows&&(e.arrows=(0,o.default)(a.arrows));if(void 0!==t.color&&null!==t.color){var h=t.color,d=e.color;if(s)u.deepExtend(d,a.color,!1,i);else for(var p in d)d.hasOwnProperty(p)&&delete d[p];if(u.isString(d))d.color=d,d.highlight=d,d.hover=d,d.inherit=!1,void 0===h.opacity&&(d.opacity=1);else{var f=!1;void 0!==h.color&&(d.color=h.color,f=!0),void 0!==h.highlight&&(d.highlight=h.highlight,f=!0),void 0!==h.hover&&(d.hover=h.hover,f=!0),void 0!==h.inherit&&(d.inherit=h.inherit),void 0!==h.opacity&&(d.opacity=Math.min(1,Math.max(0,h.opacity))),!0===f?d.inherit=!1:void 0===d.inherit&&(d.inherit="from")}}else!0===i&&null===t.color&&(e.color=u.bridgeObject(a.color));!0===i&&null===t.font&&(e.font=u.bridgeObject(a.font))}}]),e}();t.default=v},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o){return(0,n.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"_findBorderPositionBezier",value:function(e,t){var i,r,n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._getViaCoordinates(),a=0,s=0,l=1,u=this.to,h=!1;for(e.id===this.from.id&&(u=this.from,h=!0);s<=l&&a<10;){var c=.5*(s+l);if(i=this.getPoint(c,o),r=Math.atan2(u.y-i.y,u.x-i.x),n=u.distanceToBorder(t,r)-Math.sqrt(Math.pow(i.x-u.x,2)+Math.pow(i.y-u.y,2)),Math.abs(n)<.2)break;n<0?!1===h?s=c:l=c:!1===h?l=c:s=c,a++}return i.t=c,i}},{key:"_getDistanceToBezierEdge",value:function(e,t,i,r,n,o,a){var s=1e9,l=void 0,u=void 0,h=void 0,c=void 0,d=void 0,p=e,f=t;for(u=1;u<10;u++)h=.1*u,c=Math.pow(1-h,2)*e+2*h*(1-h)*a.x+Math.pow(h,2)*i,d=Math.pow(1-h,2)*t+2*h*(1-h)*a.y+Math.pow(h,2)*r,u>0&&(s=(l=this._getDistanceToLine(p,f,c,d,n,o))<s?l:s),p=c,f=d;return s}},{key:"_bezierCurve",value:function(e,t,i,r){var n=void 0!==i&&void 0!==i.x,o=void 0!==r&&void 0!==r.x;e.beginPath(),e.moveTo(this.fromPoint.x,this.fromPoint.y),n&&o?e.bezierCurveTo(i.x,i.y,r.x,r.y,this.toPoint.x,this.toPoint.y):n?e.quadraticCurveTo(i.x,i.y,this.toPoint.x,this.toPoint.y):e.lineTo(this.toPoint.x,this.toPoint.y),this.enableShadow(e,t),e.stroke(),this.disableShadow(e,t)}},{key:"getViaNode",value:function(){return this._getViaCoordinates()}}]),t}(l(i(118)).default);t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=i(2),s=function(){function e(){(0,r.default)(this,e)}return(0,n.default)(e,null,[{key:"getRange",value:function(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=1e9,n=-1e9,o=1e9,a=-1e9;if(i.length>0)for(var s=0;s<i.length;s++)o>(t=e[i[s]]).shape.boundingBox.left&&(o=t.shape.boundingBox.left),a<t.shape.boundingBox.right&&(a=t.shape.boundingBox.right),r>t.shape.boundingBox.top&&(r=t.shape.boundingBox.top),n<t.shape.boundingBox.bottom&&(n=t.shape.boundingBox.bottom);return 1e9===o&&-1e9===a&&1e9===r&&-1e9===n&&(r=0,n=0,o=0,a=0),{minX:o,maxX:a,minY:r,maxY:n}}},{key:"getRangeCore",value:function(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=1e9,n=-1e9,o=1e9,a=-1e9;if(i.length>0)for(var s=0;s<i.length;s++)o>(t=e[i[s]]).x&&(o=t.x),a<t.x&&(a=t.x),r>t.y&&(r=t.y),n<t.y&&(n=t.y);return 1e9===o&&-1e9===a&&1e9===r&&-1e9===n&&(r=0,n=0,o=0,a=0),{minX:o,maxX:a,minY:r,maxY:n}}},{key:"findCenter",value:function(e){return{x:.5*(e.maxX+e.minX),y:.5*(e.maxY+e.minY)}}},{key:"cloneOptions",value:function(e,t){var i={};return void 0===t||"node"===t?(a.deepExtend(i,e.options,!0),i.x=e.x,i.y=e.y,i.amountOfConnections=e.edges.length):a.deepExtend(i,e.options,!0),i}}]),e}();t.default=s},function(e,t,i){e.exports={default:i(124),__esModule:!0}},function(e,t,i){var r=i(50);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t,i){var r=i(52),n=i(17),o=i(83),a=i(26),s=i(22),l=i(31),u=i(129),h=i(59),c=i(85),d=i(13)("iterator"),p=!([].keys&&"next"in[].keys()),f=function(){return this};e.exports=function(e,t,i,m,v,g,y){u(i,t,m);var _,b,x,w=function(e){if(!p&&e in A)return A[e];switch(e){case"keys":case"values":return function(){return new i(this,e)}}return function(){return new i(this,e)}},S=t+" Iterator",M="values"==v,T=!1,A=e.prototype,C=A[d]||A["@@iterator"]||v&&A[v],L=C||w(v),N=v?M?w("entries"):L:void 0,P="Array"==t&&A.entries||C;if(P&&(x=c(P.call(new e)))!==Object.prototype&&x.next&&(h(x,S,!0),r||s(x,d)||a(x,d,f)),M&&C&&"values"!==C.name&&(T=!0,L=function(){return C.call(this)}),r&&!y||!p&&!T&&A[d]||a(A,d,L),l[t]=L,l[S]=f,v)if(_={values:M?L:w("values"),keys:g?L:w("keys"),entries:N},y)for(b in _)b in A||o(A,b,_[b]);else n(n.P+n.F*(p||T),t,_);return _}},function(e,t,i){var r=i(128);e.exports=function(e,t,i){if(r(e),void 0===t)return e;switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,r){return e.call(t,i,r)};case 3:return function(i,r,n){return e.call(t,i,r,n)}}return function(){return e.apply(t,arguments)}}},function(e,t,i){e.exports=!i(21)&&!i(28)(function(){return 7!=Object.defineProperty(i(82)("div"),"a",{get:function(){return 7}}).a})},function(e,t,i){var r=i(32),n=i(18).document,o=r(n)&&r(n.createElement);e.exports=function(e){return o?n.createElement(e):{}}},function(e,t,i){e.exports=i(26)},function(e,t,i){var r=i(22),n=i(25),o=i(131)(!1),a=i(56)("IE_PROTO");e.exports=function(e,t){var i,s=n(e),l=0,u=[];for(i in s)i!=a&&r(s,i)&&u.push(i);for(;t.length>l;)r(s,i=t[l++])&&(~o(u,i)||u.push(i));return u}},function(e,t,i){var r=i(22),n=i(41),o=i(56)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=n(e),r(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t,i){var r=i(50),n=i(13)("toStringTag"),o="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,i,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),n))?i:o?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t,i){var r=i(17),n=i(7),o=i(28);e.exports=function(e,t){var i=(n.Object||{})[e]||Object[e],a={};a[e]=t(i),r(r.S+r.F*o(function(){i(1)}),"Object",a)}},function(e,t,i){var r=i(84),n=i(58).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,n)}},function(e,t,i){var r=i(42),n=i(39),o=i(25),a=i(53),s=i(22),l=i(81),u=Object.getOwnPropertyDescriptor;t.f=i(21)?u:function(e,t){if(e=o(e),t=a(t,!0),l)try{return u(e,t)}catch(e){}if(s(e,t))return n(!r.f.call(e,t),e[t])}},function(e,t,i){e.exports={default:i(162),__esModule:!0}},function(e,t,i){e.exports=function(e,t){this.x=void 0!==e?e:0,this.y=void 0!==t?t:0}},function(e,t,i){var r=i(2);function n(e,t){if(void 0===e)throw new Error("No container element defined");if(this.container=e,this.visible=!t||null==t.visible||t.visible,this.visible){this.frame=document.createElement("DIV"),this.frame.style.width="100%",this.frame.style.position="relative",this.container.appendChild(this.frame),this.frame.prev=document.createElement("INPUT"),this.frame.prev.type="BUTTON",this.frame.prev.value="Prev",this.frame.appendChild(this.frame.prev),this.frame.play=document.createElement("INPUT"),this.frame.play.type="BUTTON",this.frame.play.value="Play",this.frame.appendChild(this.frame.play),this.frame.next=document.createElement("INPUT"),this.frame.next.type="BUTTON",this.frame.next.value="Next",this.frame.appendChild(this.frame.next),this.frame.bar=document.createElement("INPUT"),this.frame.bar.type="BUTTON",this.frame.bar.style.position="absolute",this.frame.bar.style.border="1px solid red",this.frame.bar.style.width="100px",this.frame.bar.style.height="6px",this.frame.bar.style.borderRadius="2px",this.frame.bar.style.MozBorderRadius="2px",this.frame.bar.style.border="1px solid #7F7F7F",this.frame.bar.style.backgroundColor="#E5E5E5",this.frame.appendChild(this.frame.bar),this.frame.slide=document.createElement("INPUT"),this.frame.slide.type="BUTTON",this.frame.slide.style.margin="0px",this.frame.slide.value=" ",this.frame.slide.style.position="relative",this.frame.slide.style.left="-100px",this.frame.appendChild(this.frame.slide);var i=this;this.frame.slide.onmousedown=function(e){i._onMouseDown(e)},this.frame.prev.onclick=function(e){i.prev(e)},this.frame.play.onclick=function(e){i.togglePlay(e)},this.frame.next.onclick=function(e){i.next(e)}}this.onChangeCallback=void 0,this.values=[],this.index=void 0,this.playTimeout=void 0,this.playInterval=1e3,this.playLoop=!0}n.prototype.prev=function(){var e=this.getIndex();e>0&&(e--,this.setIndex(e))},n.prototype.next=function(){var e=this.getIndex();e<this.values.length-1&&(e++,this.setIndex(e))},n.prototype.playNext=function(){var e=new Date,t=this.getIndex();t<this.values.length-1?(t++,this.setIndex(t)):this.playLoop&&(t=0,this.setIndex(t));var i=new Date-e,r=Math.max(this.playInterval-i,0),n=this;this.playTimeout=setTimeout(function(){n.playNext()},r)},n.prototype.togglePlay=function(){void 0===this.playTimeout?this.play():this.stop()},n.prototype.play=function(){this.playTimeout||(this.playNext(),this.frame&&(this.frame.play.value="Stop"))},n.prototype.stop=function(){clearInterval(this.playTimeout),this.playTimeout=void 0,this.frame&&(this.frame.play.value="Play")},n.prototype.setOnChangeCallback=function(e){this.onChangeCallback=e},n.prototype.setPlayInterval=function(e){this.playInterval=e},n.prototype.getPlayInterval=function(){return this.playInterval},n.prototype.setPlayLoop=function(e){this.playLoop=e},n.prototype.onChange=function(){void 0!==this.onChangeCallback&&this.onChangeCallback()},n.prototype.redraw=function(){if(this.frame){this.frame.bar.style.top=this.frame.clientHeight/2-this.frame.bar.offsetHeight/2+"px",this.frame.bar.style.width=this.frame.clientWidth-this.frame.prev.clientWidth-this.frame.play.clientWidth-this.frame.next.clientWidth-30+"px";var e=this.indexToLeft(this.index);this.frame.slide.style.left=e+"px"}},n.prototype.setValues=function(e){this.values=e,this.values.length>0?this.setIndex(0):this.index=void 0},n.prototype.setIndex=function(e){if(!(e<this.values.length))throw new Error("Index out of range");this.index=e,this.redraw(),this.onChange()},n.prototype.getIndex=function(){return this.index},n.prototype.get=function(){return this.values[this.index]},n.prototype._onMouseDown=function(e){if(e.which?1===e.which:1===e.button){this.startClientX=e.clientX,this.startSlideX=parseFloat(this.frame.slide.style.left),this.frame.style.cursor="move";var t=this;this.onmousemove=function(e){t._onMouseMove(e)},this.onmouseup=function(e){t._onMouseUp(e)},r.addEventListener(document,"mousemove",this.onmousemove),r.addEventListener(document,"mouseup",this.onmouseup),r.preventDefault(e)}},n.prototype.leftToIndex=function(e){var t=parseFloat(this.frame.bar.style.width)-this.frame.slide.clientWidth-10,i=e-3,r=Math.round(i/t*(this.values.length-1));return r<0&&(r=0),r>this.values.length-1&&(r=this.values.length-1),r},n.prototype.indexToLeft=function(e){var t=parseFloat(this.frame.bar.style.width)-this.frame.slide.clientWidth-10;return e/(this.values.length-1)*t+3},n.prototype._onMouseMove=function(e){var t=e.clientX-this.startClientX,i=this.startSlideX+t,n=this.leftToIndex(i);this.setIndex(n),r.preventDefault()},n.prototype._onMouseUp=function(e){this.frame.style.cursor="auto",r.removeEventListener(document,"mousemove",this.onmousemove),r.removeEventListener(document,"mouseup",this.onmouseup),r.preventDefault()},e.exports=n},function(e,t,i){function r(e,t,i,r){this._start=0,this._end=0,this._step=1,this.prettyStep=!0,this.precision=5,this._current=0,this.setRange(e,t,i,r)}r.prototype.isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},r.prototype.setRange=function(e,t,i,r){if(!this.isNumeric(e))throw new Error("Parameter 'start' is not numeric; value: "+e);if(!this.isNumeric(t))throw new Error("Parameter 'end' is not numeric; value: "+e);if(!this.isNumeric(i))throw new Error("Parameter 'step' is not numeric; value: "+e);this._start=e||0,this._end=t||0,this.setStep(i,r)},r.prototype.setStep=function(e,t){void 0===e||e<=0||(void 0!==t&&(this.prettyStep=t),!0===this.prettyStep?this._step=r.calculatePrettyStep(e):this._step=e)},r.calculatePrettyStep=function(e){var t=function(e){return Math.log(e)/Math.LN10},i=Math.pow(10,Math.round(t(e))),r=2*Math.pow(10,Math.round(t(e/2))),n=5*Math.pow(10,Math.round(t(e/5))),o=i;return Math.abs(r-e)<=Math.abs(o-e)&&(o=r),Math.abs(n-e)<=Math.abs(o-e)&&(o=n),o<=0&&(o=1),o},r.prototype.getCurrent=function(){return parseFloat(this._current.toPrecision(this.precision))},r.prototype.getStep=function(){return this._step},r.prototype.start=function(e){void 0===e&&(e=!1),this._current=this._start-this._start%this._step,e&&this.getCurrent()<this._start&&this.next()},r.prototype.next=function(){this._current+=this._step},r.prototype.end=function(){return this._current>this._end},e.exports=r},function(e,t,i){var r,n=i(6),o=(r=n)&&r.__esModule?r:{default:r};var a=i(2),s=i(95),l=i(34),u={BAR:0,BARCOLOR:1,BARSIZE:2,DOT:3,DOTLINE:4,DOTCOLOR:5,DOTSIZE:6,GRID:7,LINE:8,SURFACE:9},h={dot:u.DOT,"dot-line":u.DOTLINE,"dot-color":u.DOTCOLOR,"dot-size":u.DOTSIZE,line:u.LINE,grid:u.GRID,surface:u.SURFACE,bar:u.BAR,"bar-color":u.BARCOLOR,"bar-size":u.BARSIZE},c=["width","height","filterLabel","legendLabel","xLabel","yLabel","zLabel","xValueLabel","yValueLabel","zValueLabel","showXAxis","showYAxis","showZAxis","showGrid","showPerspective","showShadow","keepAspectRatio","verticalRatio","dotSizeRatio","dotSizeMinFraction","dotSizeMaxFraction","showAnimationControls","animationInterval","animationPreload","animationAutoStart","axisColor","gridColor","xCenter","yCenter"],d=["xBarWidth","yBarWidth","valueMin","valueMax","xMin","xMax","xStep","yMin","yMax","yStep","zMin","zMax","zStep"],p=void 0;function f(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function m(e,t){return void 0===e||""===e?t:e+(void 0===(i=t)||""===i||"string"!=typeof i?i:i.charAt(0).toUpperCase()+i.slice(1));var i}function v(e,t,i,r){for(var n,o=0;o<i.length;++o)t[m(r,n=i[o])]=e[n]}function g(e,t,i,r){for(var n,o=0;o<i.length;++o)void 0!==e[n=i[o]]&&(t[m(r,n)]=e[n])}function y(e,t){void 0!==e.backgroundColor&&function(e,t){var i="white",r="gray",n=1;if("string"==typeof e)i=e,r="none",n=0;else{if("object"!==(void 0===e?"undefined":(0,o.default)(e)))throw new Error("Unsupported type of backgroundColor");void 0!==e.fill&&(i=e.fill),void 0!==e.stroke&&(r=e.stroke),void 0!==e.strokeWidth&&(n=e.strokeWidth)}t.frame.style.backgroundColor=i,t.frame.style.borderColor=r,t.frame.style.borderWidth=n+"px",t.frame.style.borderStyle="solid"}(e.backgroundColor,t),function(e,t){if(void 0===e)return;void 0===t.dataColor&&(t.dataColor={});"string"==typeof e?(t.dataColor.fill=e,t.dataColor.stroke=e):(e.fill&&(t.dataColor.fill=e.fill),e.stroke&&(t.dataColor.stroke=e.stroke),void 0!==e.strokeWidth&&(t.dataColor.strokeWidth=e.strokeWidth))}(e.dataColor,t),function(e,t){if(void 0===e)return;var i;if("string"==typeof e){if(-1===(i=function(e){var t=h[e];if(void 0===t)return-1;return t}(e)))throw new Error("Style '"+e+"' is invalid")}else{if(!function(e){var t=!1;for(var i in u)if(u[i]===e){t=!0;break}return t}(e))throw new Error("Style '"+e+"' is invalid");i=e}t.style=i}(e.style,t),function(e,t){if(void 0===e){var i=void 0===p.showLegend;if(i){var r=t.style===u.DOTCOLOR||t.style===u.DOTSIZE;t.showLegend=r}}else t.showLegend=e}(e.showLegend,t),_(e.cameraPosition,t),void 0!==e.tooltip&&(t.showTooltip=e.tooltip),null!=e.onclick&&(t.onclick_callback=e.onclick),void 0!==e.tooltipStyle&&a.selectiveDeepExtend(["tooltipStyle"],t,e)}function _(e,t){var i=e;void 0!==i&&(void 0===t.camera&&(t.camera=new s),t.camera.setArmRotation(i.horizontal,i.vertical),t.camera.setArmLength(i.distance))}e.exports.STYLE=u,e.exports.setDefaults=function(e,t){if(void 0===e||f(e))throw new Error("No DEFAULTS passed");if(void 0===t)throw new Error("No dst passed");p=e,v(e,t,c),v(e,t,d,"default"),y(e,t),t.margin=10,t.showGrayBottom=!1,t.showTooltip=!1,t.onclick_callback=null,t.eye=new l(0,0,-1)},e.exports.setOptions=function(e,t){if(void 0!==e){if(void 0===t)throw new Error("No dst passed");if(void 0===p||f(p))throw new Error("DEFAULTS not set for module Settings");g(e,t,c),g(e,t,d,"default"),y(e,t)}},e.exports.setCameraPosition=_},function(e,t,i){var r,n=i(165),o=(r=n)&&r.__esModule?r:{default:r};var a=i(34);function s(){this.armLocation=new a,this.armRotation={},this.armRotation.horizontal=0,this.armRotation.vertical=0,this.armLength=1.7,this.cameraOffset=new a,this.offsetMultiplier=.6,this.cameraLocation=new a,this.cameraRotation=new a(.5*Math.PI,0,0),this.calculateCameraOrientation()}s.prototype.setOffset=function(e,t){var i=Math.abs,r=o.default,n=this.offsetMultiplier,a=this.armLength*n;i(e)>a&&(e=r(e)*a),i(t)>a&&(t=r(t)*a),this.cameraOffset.x=e,this.cameraOffset.y=t,this.calculateCameraOrientation()},s.prototype.getOffset=function(){return this.cameraOffset},s.prototype.setArmLocation=function(e,t,i){this.armLocation.x=e,this.armLocation.y=t,this.armLocation.z=i,this.calculateCameraOrientation()},s.prototype.setArmRotation=function(e,t){void 0!==e&&(this.armRotation.horizontal=e),void 0!==t&&(this.armRotation.vertical=t,this.armRotation.vertical<0&&(this.armRotation.vertical=0),this.armRotation.vertical>.5*Math.PI&&(this.armRotation.vertical=.5*Math.PI)),void 0===e&&void 0===t||this.calculateCameraOrientation()},s.prototype.getArmRotation=function(){var e={};return e.horizontal=this.armRotation.horizontal,e.vertical=this.armRotation.vertical,e},s.prototype.setArmLength=function(e){void 0!==e&&(this.armLength=e,this.armLength<.71&&(this.armLength=.71),this.armLength>5&&(this.armLength=5),this.setOffset(this.cameraOffset.x,this.cameraOffset.y),this.calculateCameraOrientation())},s.prototype.getArmLength=function(){return this.armLength},s.prototype.getCameraLocation=function(){return this.cameraLocation},s.prototype.getCameraRotation=function(){return this.cameraRotation},s.prototype.calculateCameraOrientation=function(){this.cameraLocation.x=this.armLocation.x-this.armLength*Math.sin(this.armRotation.horizontal)*Math.cos(this.armRotation.vertical),this.cameraLocation.y=this.armLocation.y-this.armLength*Math.cos(this.armRotation.horizontal)*Math.cos(this.armRotation.vertical),this.cameraLocation.z=this.armLocation.z+this.armLength*Math.sin(this.armRotation.vertical),this.cameraRotation.x=Math.PI/2-this.armRotation.vertical,this.cameraRotation.y=0,this.cameraRotation.z=-this.armRotation.horizontal;var e=this.cameraRotation.x,t=this.cameraRotation.z,i=this.cameraOffset.x,r=this.cameraOffset.y,n=Math.sin,o=Math.cos;this.cameraLocation.x=this.cameraLocation.x+i*o(t)+r*-n(t)*o(e),this.cameraLocation.y=this.cameraLocation.y+i*n(t)+r*o(t)*o(e),this.cameraLocation.z=this.cameraLocation.z+r*n(e)},e.exports=s},function(e,t,i){var r=i(12);function n(e,t,i){this.dataGroup=e,this.column=t,this.graph=i,this.index=void 0,this.value=void 0,this.values=e.getDistinctValues(this.column),this.values.length>0&&this.selectValue(0),this.dataPoints=[],this.loaded=!1,this.onLoadCallback=void 0,i.animationPreload?(this.loaded=!1,this.loadInBackground()):this.loaded=!0}n.prototype.isLoaded=function(){return this.loaded},n.prototype.getLoadedProgress=function(){for(var e=this.values.length,t=0;this.dataPoints[t];)t++;return Math.round(t/e*100)},n.prototype.getLabel=function(){return this.graph.filterLabel},n.prototype.getColumn=function(){return this.column},n.prototype.getSelectedValue=function(){if(void 0!==this.index)return this.values[this.index]},n.prototype.getValues=function(){return this.values},n.prototype.getValue=function(e){if(e>=this.values.length)throw new Error("Index out of range");return this.values[e]},n.prototype._getDataPoints=function(e){if(void 0===e&&(e=this.index),void 0===e)return[];var t;if(this.dataPoints[e])t=this.dataPoints[e];else{var i={};i.column=this.column,i.value=this.values[e];var n=new r(this.dataGroup.getDataSet(),{filter:function(e){return e[i.column]==i.value}}).get();t=this.dataGroup._getDataPoints(n),this.dataPoints[e]=t}return t},n.prototype.setOnLoadCallback=function(e){this.onLoadCallback=e},n.prototype.selectValue=function(e){if(e>=this.values.length)throw new Error("Index out of range");this.index=e,this.value=this.values[e]},n.prototype.loadInBackground=function(e){void 0===e&&(e=0);var t=this.graph.frame;if(e<this.values.length){void 0===t.progress&&(t.progress=document.createElement("DIV"),t.progress.style.position="absolute",t.progress.style.color="gray",t.appendChild(t.progress));var i=this.getLoadedProgress();t.progress.innerHTML="Loading animation... "+i+"%",t.progress.style.bottom="60px",t.progress.style.left="10px";var r=this;setTimeout(function(){r.loadInBackground(e+1)},10),this.loaded=!1}else this.loaded=!0,void 0!==t.progress&&(t.removeChild(t.progress),t.progress=void 0),this.onLoadCallback&&this.onLoadCallback()},e.exports=n},function(e,t,i){var r=i(35),n=i(44),o=i(10),a=i(2);function s(e){this.active=!1,this.dom={container:e},this.dom.overlay=document.createElement("div"),this.dom.overlay.className="vis-overlay",this.dom.container.appendChild(this.dom.overlay),this.hammer=o(this.dom.overlay),this.hammer.on("tap",this._onTapOverlay.bind(this));var t=this;["tap","doubletap","press","pinch","pan","panstart","panmove","panend"].forEach(function(e){t.hammer.on(e,function(e){e.stopPropagation()})}),document&&document.body&&(this.onClick=function(i){(function(e,t){for(;e;){if(e===t)return!0;e=e.parentNode}return!1})(i.target,e)||t.deactivate()},document.body.addEventListener("click",this.onClick)),void 0!==this.keycharm&&this.keycharm.destroy(),this.keycharm=r(),this.escListener=this.deactivate.bind(this)}n(s.prototype),s.current=null,s.prototype.destroy=function(){this.deactivate(),this.dom.overlay.parentNode.removeChild(this.dom.overlay),this.onClick&&document.body.removeEventListener("click",this.onClick),this.hammer.destroy(),this.hammer=null},s.prototype.activate=function(){s.current&&s.current.deactivate(),s.current=this,this.active=!0,this.dom.overlay.style.display="none",a.addClassName(this.dom.container,"vis-active"),this.emit("change"),this.emit("activate"),this.keycharm.bind("esc",this.escListener)},s.prototype.deactivate=function(){this.active=!1,this.dom.overlay.style.display="",a.removeClassName(this.dom.container,"vis-active"),this.keycharm.unbind("esc",this.escListener),this.emit("change"),this.emit("deactivate")},s.prototype._onTapOverlay=function(e){this.activate(),e.stopPropagation()},e.exports=s},function(e,t,i){t.en={current:"current",time:"time"},t.en_EN=t.en,t.en_US=t.en,t.it={current:"attuale",time:"tempo"},t.it_IT=t.it,t.it_CH=t.it,t.nl={current:"huidige",time:"tijd"},t.nl_NL=t.nl,t.nl_BE=t.nl,t.de={current:"Aktuelle",time:"Zeit"},t.de_DE=t.de,t.fr={current:"actuel",time:"heure"},t.fr_FR=t.fr,t.fr_CA=t.fr,t.fr_BE=t.fr,t.es={current:"corriente",time:"hora"},t.es_ES=t.es},function(e,t,i){var r=o(i(29)),n=o(i(6));function o(e){return e&&e.__esModule?e:{default:e}}var a=i(10),s=i(2),l=i(11),u=i(12),h=i(66),c=i(16),d=i(68),p=i(69),f=i(101),m=i(102),v=i(70),g=i(103),y=i(104).default,_="__ungrouped__",b="__background__";function x(e,t){this.body=e,this.defaultOptions={type:null,orientation:{item:"bottom"},align:"auto",stack:!0,stackSubgroups:!0,groupOrderSwap:function(e,t,i){var r=t.order;t.order=e.order,e.order=r},groupOrder:"order",selectable:!0,multiselect:!1,itemsAlwaysDraggable:{item:!1,range:!1},editable:{updateTime:!1,updateGroup:!1,add:!1,remove:!1,overrideItems:!1},groupEditable:{order:!1,add:!1,remove:!1},snap:h.snap,onDropObjectOnItem:function(e,t,i){i(t)},onAdd:function(e,t){t(e)},onUpdate:function(e,t){t(e)},onMove:function(e,t){t(e)},onRemove:function(e,t){t(e)},onMoving:function(e,t){t(e)},onAddGroup:function(e,t){t(e)},onMoveGroup:function(e,t){t(e)},onRemoveGroup:function(e,t){t(e)},margin:{item:{horizontal:10,vertical:10},axis:20},showTooltips:!0,tooltip:{followMouse:!1,overflowMethod:"flip"},tooltipOnItemUpdateTime:!1},this.options=s.extend({},this.defaultOptions),this.options.rtl=t.rtl,this.itemOptions={type:{start:"Date",end:"Date"}},this.conversion={toScreen:e.util.toScreen,toTime:e.util.toTime},this.dom={},this.props={},this.hammer=null;var i=this;this.itemsData=null,this.groupsData=null,this.itemListeners={add:function(e,t,r){i._onAdd(t.items)},update:function(e,t,r){i._onUpdate(t.items)},remove:function(e,t,r){i._onRemove(t.items)}},this.groupListeners={add:function(e,t,r){if(i._onAddGroups(t.items),i.groupsData&&i.groupsData.length>0){var n=i.groupsData.getDataSet();n.get().forEach(function(e){if(e.nestedGroups){0!=e.showNested&&(e.showNested=!0);var t=[];e.nestedGroups.forEach(function(i){var r=n.get(i);r&&(r.nestedInGroup=e.id,0==e.showNested&&(r.visible=!1),t=t.concat(r))}),n.update(t,r)}})}},update:function(e,t,r){i._onUpdateGroups(t.items)},remove:function(e,t,r){i._onRemoveGroups(t.items)}},this.items={},this.groups={},this.groupIds=[],this.selection=[],this.popup=null,this.touchParams={},this.groupTouchParams={},this._create(),this.setOptions(t)}x.prototype=new c,x.types={background:g,box:f,range:v,point:m},x.prototype._create=function(){var e=document.createElement("div");e.className="vis-itemset",e["timeline-itemset"]=this,this.dom.frame=e;var t=document.createElement("div");t.className="vis-background",e.appendChild(t),this.dom.background=t;var i=document.createElement("div");i.className="vis-foreground",e.appendChild(i),this.dom.foreground=i;var r=document.createElement("div");r.className="vis-axis",this.dom.axis=r;var n=document.createElement("div");n.className="vis-labelset",this.dom.labelSet=n,this._updateUngrouped();var o=new p(b,null,this);o.show(),this.groups[b]=o,this.hammer=new a(this.body.dom.centerContainer),this.hammer.on("hammer.input",function(e){e.isFirst&&this._onTouch(e)}.bind(this)),this.hammer.on("panstart",this._onDragStart.bind(this)),this.hammer.on("panmove",this._onDrag.bind(this)),this.hammer.on("panend",this._onDragEnd.bind(this)),this.hammer.get("pan").set({threshold:5,direction:a.DIRECTION_HORIZONTAL}),this.hammer.on("tap",this._onSelectItem.bind(this)),this.hammer.on("press",this._onMultiSelectItem.bind(this)),this.hammer.on("doubletap",this._onAddItem.bind(this)),this.options.rtl?this.groupHammer=new a(this.body.dom.rightContainer):this.groupHammer=new a(this.body.dom.leftContainer),this.groupHammer.on("tap",this._onGroupClick.bind(this)),this.groupHammer.on("panstart",this._onGroupDragStart.bind(this)),this.groupHammer.on("panmove",this._onGroupDrag.bind(this)),this.groupHammer.on("panend",this._onGroupDragEnd.bind(this)),this.groupHammer.get("pan").set({threshold:5,direction:a.DIRECTION_VERTICAL}),this.body.dom.centerContainer.addEventListener("mouseover",this._onMouseOver.bind(this)),this.body.dom.centerContainer.addEventListener("mouseout",this._onMouseOut.bind(this)),this.body.dom.centerContainer.addEventListener("mousemove",this._onMouseMove.bind(this)),this.body.dom.centerContainer.addEventListener("contextmenu",this._onDragEnd.bind(this)),this.body.dom.centerContainer.addEventListener("mousewheel",this._onMouseWheel.bind(this)),this.show()},x.prototype.setOptions=function(e){if(e){s.selectiveExtend(["type","rtl","align","order","stack","stackSubgroups","selectable","multiselect","multiselectPerGroup","groupOrder","dataAttributes","template","groupTemplate","visibleFrameTemplate","hide","snap","groupOrderSwap","showTooltips","tooltip","tooltipOnItemUpdateTime"],this.options,e),"itemsAlwaysDraggable"in e&&("boolean"==typeof e.itemsAlwaysDraggable?(this.options.itemsAlwaysDraggable.item=e.itemsAlwaysDraggable,this.options.itemsAlwaysDraggable.range=!1):"object"===(0,n.default)(e.itemsAlwaysDraggable)&&(s.selectiveExtend(["item","range"],this.options.itemsAlwaysDraggable,e.itemsAlwaysDraggable),this.options.itemsAlwaysDraggable.item||(this.options.itemsAlwaysDraggable.range=!1))),"orientation"in e&&("string"==typeof e.orientation?this.options.orientation.item="top"===e.orientation?"top":"bottom":"object"===(0,n.default)(e.orientation)&&"item"in e.orientation&&(this.options.orientation.item=e.orientation.item)),"margin"in e&&("number"==typeof e.margin?(this.options.margin.axis=e.margin,this.options.margin.item.horizontal=e.margin,this.options.margin.item.vertical=e.margin):"object"===(0,n.default)(e.margin)&&(s.selectiveExtend(["axis"],this.options.margin,e.margin),"item"in e.margin&&("number"==typeof e.margin.item?(this.options.margin.item.horizontal=e.margin.item,this.options.margin.item.vertical=e.margin.item):"object"===(0,n.default)(e.margin.item)&&s.selectiveExtend(["horizontal","vertical"],this.options.margin.item,e.margin.item)))),"editable"in e&&("boolean"==typeof e.editable?(this.options.editable.updateTime=e.editable,this.options.editable.updateGroup=e.editable,this.options.editable.add=e.editable,this.options.editable.remove=e.editable,this.options.editable.overrideItems=!1):"object"===(0,n.default)(e.editable)&&s.selectiveExtend(["updateTime","updateGroup","add","remove","overrideItems"],this.options.editable,e.editable)),"groupEditable"in e&&("boolean"==typeof e.groupEditable?(this.options.groupEditable.order=e.groupEditable,this.options.groupEditable.add=e.groupEditable,this.options.groupEditable.remove=e.groupEditable):"object"===(0,n.default)(e.groupEditable)&&s.selectiveExtend(["order","add","remove"],this.options.groupEditable,e.groupEditable));var t=function(t){var i=e[t];if(i){if(!(i instanceof Function))throw new Error("option "+t+" must be a function "+t+"(item, callback)");this.options[t]=i}}.bind(this);["onDropObjectOnItem","onAdd","onUpdate","onRemove","onMove","onMoving","onAddGroup","onMoveGroup","onRemoveGroup"].forEach(t),this.markDirty()}},x.prototype.markDirty=function(e){this.groupIds=[],e&&e.refreshItems&&s.forEach(this.items,function(e){e.dirty=!0,e.displayed&&e.redraw()})},x.prototype.destroy=function(){this.hide(),this.setItems(null),this.setGroups(null),this.hammer=null,this.body=null,this.conversion=null},x.prototype.hide=function(){this.dom.frame.parentNode&&this.dom.frame.parentNode.removeChild(this.dom.frame),this.dom.axis.parentNode&&this.dom.axis.parentNode.removeChild(this.dom.axis),this.dom.labelSet.parentNode&&this.dom.labelSet.parentNode.removeChild(this.dom.labelSet)},x.prototype.show=function(){this.dom.frame.parentNode||this.body.dom.center.appendChild(this.dom.frame),this.dom.axis.parentNode||this.body.dom.backgroundVertical.appendChild(this.dom.axis),this.dom.labelSet.parentNode||(this.options.rtl?this.body.dom.right.appendChild(this.dom.labelSet):this.body.dom.left.appendChild(this.dom.labelSet))},x.prototype.setSelection=function(e){var t,i,r,n;for(null==e&&(e=[]),Array.isArray(e)||(e=[e]),t=0,i=this.selection.length;t<i;t++)r=this.selection[t],(n=this.items[r])&&n.unselect();for(this.selection=[],t=0,i=e.length;t<i;t++)r=e[t],(n=this.items[r])&&(this.selection.push(r),n.select())},x.prototype.getSelection=function(){return this.selection.concat([])},x.prototype.getVisibleItems=function(){var e,t,i=this.body.range.getRange();this.options.rtl?(e=this.body.util.toScreen(i.start),t=this.body.util.toScreen(i.end)):(t=this.body.util.toScreen(i.start),e=this.body.util.toScreen(i.end));var r=[];for(var n in this.groups)if(this.groups.hasOwnProperty(n))for(var o=this.groups[n],a=o.isVisible?o.visibleItems:[],s=0;s<a.length;s++){var l=a[s];this.options.rtl?l.right<t&&l.right+l.width>e&&r.push(l.id):l.left<e&&l.left+l.width>t&&r.push(l.id)}return r},x.prototype._deselect=function(e){for(var t=this.selection,i=0,r=t.length;i<r;i++)if(t[i]==e){t.splice(i,1);break}},x.prototype.redraw=function(){var e=this.options.margin,t=this.body.range,i=s.option.asSize,r=this.options,n=r.orientation.item,o=!1,a=this.dom.frame;this.props.top=this.body.domProps.top.height+this.body.domProps.border.top,this.options.rtl?this.props.right=this.body.domProps.right.width+this.body.domProps.border.right:this.props.left=this.body.domProps.left.width+this.body.domProps.border.left,a.className="vis-itemset",o=this._orderGroups()||o;var l=t.end-t.start,u=l!=this.lastVisibleInterval||this.props.width!=this.props.lastWidth,h=t.start!=this.lastRangeStart,c=r.stack!=this.lastStack,d=r.stackSubgroups!=this.lastStackSubgroups,p=u||h||c||d;this.lastVisibleInterval=l,this.lastRangeStart=t.start,this.lastStack=r.stack,this.lastStackSubgroups=r.stackSubgroups,this.props.lastWidth=this.props.width;var f=this._firstGroup(),m={item:e.item,axis:e.axis},v={item:e.item,axis:e.item.vertical/2},g=0,y=e.axis+e.item.vertical;this.groups[b].redraw(t,v,p);var _={},x=0;if(s.forEach(this.groups,function(e,i){if(i!==b){var r=e==f?m:v;_[i]=e.redraw(t,r,p,!0),x=_[i].length}}),x>0){for(var w={},S=0;S<x;S++)s.forEach(_,function(e,t){w[t]=e[S]()});s.forEach(this.groups,function(e,t){if(t!==b){var i=w[t];o=i||o,g+=e.height}}),g=Math.max(g,y)}return g=Math.max(g,y),a.style.height=i(g),this.props.width=a.offsetWidth,this.props.height=g,this.dom.axis.style.top=i("top"==n?this.body.domProps.top.height+this.body.domProps.border.top:this.body.domProps.top.height+this.body.domProps.centerContainer.height),this.options.rtl?this.dom.axis.style.right="0":this.dom.axis.style.left="0",this.initialItemSetDrawn=!0,o=this._isResized()||o},x.prototype._firstGroup=function(){var e="top"==this.options.orientation.item?0:this.groupIds.length-1,t=this.groupIds[e];return this.groups[t]||this.groups[_]||null},x.prototype._updateUngrouped=function(){var e,t,i=this.groups[_];if(this.groupsData){if(i)for(t in i.hide(),delete this.groups[_],this.items)if(this.items.hasOwnProperty(t)){(e=this.items[t]).parent&&e.parent.remove(e);var r=this._getGroupId(e.data),n=this.groups[r];n&&n.add(e)||e.hide()}}else if(!i){for(t in i=new d(null,null,this),this.groups[_]=i,this.items)this.items.hasOwnProperty(t)&&(e=this.items[t],i.add(e));i.show()}},x.prototype.getLabelSet=function(){return this.dom.labelSet},x.prototype.setItems=function(e){var t,i=this,r=this.itemsData;if(e){if(!(e instanceof l||e instanceof u))throw new TypeError("Data must be an instance of DataSet or DataView");this.itemsData=e}else this.itemsData=null;if(r&&(s.forEach(this.itemListeners,function(e,t){r.off(t,e)}),t=r.getIds(),this._onRemove(t)),this.itemsData){var n=this.id;s.forEach(this.itemListeners,function(e,t){i.itemsData.on(t,e,n)}),t=this.itemsData.getIds(),this._onAdd(t),this._updateUngrouped()}this.body.emitter.emit("_change",{queue:!0})},x.prototype.getItems=function(){return this.itemsData},x.prototype.setGroups=function(e){var t,i=this;if(this.groupsData&&(s.forEach(this.groupListeners,function(e,t){i.groupsData.off(t,e)}),t=this.groupsData.getIds(),this.groupsData=null,this._onRemoveGroups(t)),e){if(!(e instanceof l||e instanceof u))throw new TypeError("Data must be an instance of DataSet or DataView");this.groupsData=e}else this.groupsData=null;if(this.groupsData){var r=this.groupsData;this.groupsData instanceof u&&(r=this.groupsData.getDataSet()),r.get().forEach(function(e){e.nestedGroups&&e.nestedGroups.forEach(function(t){var i=r.get(t);i.nestedInGroup=e.id,0==e.showNested&&(i.visible=!1),r.update(i)})});var n=this.id;s.forEach(this.groupListeners,function(e,t){i.groupsData.on(t,e,n)}),t=this.groupsData.getIds(),this._onAddGroups(t)}this._updateUngrouped(),this._order(),this.body.emitter.emit("_change",{queue:!0})},x.prototype.getGroups=function(){return this.groupsData},x.prototype.removeItem=function(e){var t=this.itemsData.get(e),i=this.itemsData.getDataSet();t&&this.options.onRemove(t,function(t){t&&i.remove(e)})},x.prototype._getType=function(e){return e.type||this.options.type||(e.end?"range":"box")},x.prototype._getGroupId=function(e){return"background"==this._getType(e)&&null==e.group?b:this.groupsData?e.group:_},x.prototype._onUpdate=function(e){var t=this;e.forEach(function(e){var i,r=t.itemsData.get(e,t.itemOptions),n=t.items[e],o=r?t._getType(r):null,a=x.types[o];if(n&&(a&&n instanceof a?t._updateItem(n,r):(i=n.selected,t._removeItem(n),n=null)),!n&&r){if(!a)throw"rangeoverflow"==o?new TypeError('Item type "rangeoverflow" is deprecated. Use css styling instead: .vis-item.vis-range .vis-item-content {overflow: visible;}'):new TypeError('Unknown item type "'+o+'"');(n=new a(r,t.conversion,t.options)).id=e,t._addItem(n),i&&(this.selection.push(e),n.select())}}.bind(this)),this._order(),this.body.emitter.emit("_change",{queue:!0})},x.prototype._onAdd=x.prototype._onUpdate,x.prototype._onRemove=function(e){var t=0,i=this;e.forEach(function(e){var r=i.items[e];r&&(t++,i._removeItem(r))}),t&&(this._order(),this.body.emitter.emit("_change",{queue:!0}))},x.prototype._order=function(){s.forEach(this.groups,function(e){e.order()})},x.prototype._onUpdateGroups=function(e){this._onAddGroups(e)},x.prototype._onAddGroups=function(e){var t=this;e.forEach(function(e){var i=t.groupsData.get(e),n=t.groups[e];if(n)n.setData(i);else{if(e==_||e==b)throw new Error("Illegal group id. "+e+" is a reserved id.");var o=(0,r.default)(t.options);for(var a in s.extend(o,{height:null}),n=new d(e,i,t),t.groups[e]=n,t.items)if(t.items.hasOwnProperty(a)){var l=t.items[a];l.data.group==e&&n.add(l)}n.order(),n.show()}}),this.body.emitter.emit("_change",{queue:!0})},x.prototype._onRemoveGroups=function(e){var t=this.groups;e.forEach(function(e){var i=t[e];i&&(i.hide(),delete t[e])}),this.markDirty(),this.body.emitter.emit("_change",{queue:!0})},x.prototype._orderGroups=function(){if(this.groupsData){var e=this.groupsData.getIds({order:this.options.groupOrder});e=this._orderNestedGroups(e);var t=!s.equalArray(e,this.groupIds);if(t){var i=this.groups;e.forEach(function(e){i[e].hide()}),e.forEach(function(e){i[e].show()}),this.groupIds=e}return t}return!1},x.prototype._orderNestedGroups=function(e){var t=[];return e.forEach(function(e){var i=this.groupsData.get(e);if(i.nestedInGroup||t.push(e),i.nestedGroups){var r=this.groupsData.get({filter:function(t){return t.nestedInGroup==e},order:this.options.groupOrder}).map(function(e){return e.id});t=t.concat(r)}},this),t},x.prototype._addItem=function(e){this.items[e.id]=e;var t=this._getGroupId(e.data),i=this.groups[t];i?i&&i.data&&i.data.showNested&&(e.groupShowing=!0):e.groupShowing=!1,i&&i.add(e)},x.prototype._updateItem=function(e,t){e.setData(t);var i=this._getGroupId(e.data),r=this.groups[i];r?r&&r.data&&r.data.showNested&&(e.groupShowing=!0):e.groupShowing=!1},x.prototype._removeItem=function(e){e.hide(),delete this.items[e.id];var t=this.selection.indexOf(e.id);-1!=t&&this.selection.splice(t,1),e.parent&&e.parent.remove(e)},x.prototype._constructByEndArray=function(e){for(var t=[],i=0;i<e.length;i++)e[i]instanceof v&&t.push(e[i]);return t},x.prototype._onTouch=function(e){this.touchParams.item=this.itemFromTarget(e),this.touchParams.dragLeftItem=e.target.dragLeftItem||!1,this.touchParams.dragRightItem=e.target.dragRightItem||!1,this.touchParams.itemProps=null},x.prototype._getGroupIndex=function(e){for(var t=0;t<this.groupIds.length;t++)if(e==this.groupIds[t])return t},x.prototype._onDragStart=function(e){if(!this.touchParams.itemIsDragging){var t,i=this.touchParams.item||null,r=this;if(i&&(i.selected||this.options.itemsAlwaysDraggable.item)){if(this.options.editable.overrideItems&&!this.options.editable.updateTime&&!this.options.editable.updateGroup)return;if(null!=i.editable&&!i.editable.updateTime&&!i.editable.updateGroup&&!this.options.editable.overrideItems)return;var n=this.touchParams.dragLeftItem,o=this.touchParams.dragRightItem;if(this.touchParams.itemIsDragging=!0,this.touchParams.selectedItem=i,n)t={item:n,initialX:e.center.x,dragLeft:!0,data:this._cloneItemData(i.data)},this.touchParams.itemProps=[t];else if(o)t={item:o,initialX:e.center.x,dragRight:!0,data:this._cloneItemData(i.data)},this.touchParams.itemProps=[t];else if(this.options.editable.add&&(e.srcEvent.ctrlKey||e.srcEvent.metaKey))this._onDragStartAddItem(e);else{this.groupIds.length<1&&this.redraw();var a=this._getGroupIndex(i.data.group),s=this.options.itemsAlwaysDraggable.item&&!i.selected?[i.id]:this.getSelection();this.touchParams.itemProps=s.map(function(t){var i=r.items[t],n=r._getGroupIndex(i.data.group);return{item:i,initialX:e.center.x,groupOffset:a-n,data:this._cloneItemData(i.data)}}.bind(this))}e.stopPropagation()}else this.options.editable.add&&(e.srcEvent.ctrlKey||e.srcEvent.metaKey)&&this._onDragStartAddItem(e)}},x.prototype._onDragStartAddItem=function(e){var t,i,r=this.options.snap||null;this.options.rtl?i=(t=s.getAbsoluteRight(this.dom.frame))-e.center.x+10:(t=s.getAbsoluteLeft(this.dom.frame),i=e.center.x-t-10);var n=this.body.util.toTime(i),o=this.body.util.getScale(),a=this.body.util.getStep(),l=r?r(n,o,a):n,u={type:"range",start:l,end:l,content:"new item"},h=s.randomUUID();u[this.itemsData._fieldId]=h;var c=this.groupFromTarget(e);c&&(u.group=c.groupId);var d=new v(u,this.conversion,this.options);d.id=h,d.data=this._cloneItemData(u),this._addItem(d),this.touchParams.selectedItem=d;var p={item:d,initialX:e.center.x,data:d.data};this.options.rtl?p.dragLeft=!0:p.dragRight=!0,this.touchParams.itemProps=[p],e.stopPropagation()},x.prototype._onDrag=function(e){if(this.touchParams.itemProps){e.stopPropagation();var t,i=this,r=this.options.snap||null;t=this.options.rtl?this.body.dom.root.offsetLeft+this.body.domProps.right.width:this.body.dom.root.offsetLeft+this.body.domProps.left.width;var n=this.body.util.getScale(),o=this.body.util.getStep(),a=this.touchParams.selectedItem,l=(this.options.editable.overrideItems||null==a.editable)&&this.options.editable.updateGroup||!this.options.editable.overrideItems&&null!=a.editable&&a.editable.updateGroup,u=null;if(l&&a&&null!=a.data.group){var h=i.groupFromTarget(e);h&&(u=this._getGroupIndex(h.groupId))}this.touchParams.itemProps.forEach(function(h){var c,d,p,f,m,v=i.body.util.toTime(e.center.x-t),g=i.body.util.toTime(h.initialX-t);c=this.options.rtl?-(v-g):v-g;var y=this._cloneItemData(h.item.data);if(null==h.item.editable||h.item.editable.updateTime||h.item.editable.updateGroup||i.options.editable.overrideItems){if((this.options.editable.overrideItems||null==a.editable)&&this.options.editable.updateTime||!this.options.editable.overrideItems&&null!=a.editable&&a.editable.updateTime)if(h.dragLeft)this.options.rtl?null!=y.end&&(p=s.convert(h.data.end,"Date"),m=new Date(p.valueOf()+c),y.end=r?r(m,n,o):m):null!=y.start&&(d=s.convert(h.data.start,"Date"),f=new Date(d.valueOf()+c),y.start=r?r(f,n,o):f);else if(h.dragRight)this.options.rtl?null!=y.start&&(d=s.convert(h.data.start,"Date"),f=new Date(d.valueOf()+c),y.start=r?r(f,n,o):f):null!=y.end&&(p=s.convert(h.data.end,"Date"),m=new Date(p.valueOf()+c),y.end=r?r(m,n,o):m);else if(null!=y.start)if(d=s.convert(h.data.start,"Date").valueOf(),f=new Date(d+c),null!=y.end){var _=(p=s.convert(h.data.end,"Date")).valueOf()-d.valueOf();y.start=r?r(f,n,o):f,y.end=new Date(y.start.valueOf()+_)}else y.start=r?r(f,n,o):f;if(l&&!h.dragLeft&&!h.dragRight&&null!=u&&null!=y.group){var b=u-h.groupOffset;b=Math.max(0,b),b=Math.min(i.groupIds.length-1,b),y.group=i.groupIds[b]}y=this._cloneItemData(y),i.options.onMoving(y,function(e){e&&h.item.setData(this._cloneItemData(e,"Date"))}.bind(this))}}.bind(this)),this.body.emitter.emit("_change")}},x.prototype._moveToGroup=function(e,t){var i=this.groups[t];if(i&&i.groupId!=e.data.group){var r=e.parent;r.remove(e),r.order(),e.data.group=i.groupId,i.add(e),i.order()}},x.prototype._onDragEnd=function(e){if(this.touchParams.itemIsDragging=!1,this.touchParams.itemProps){e.stopPropagation();var t=this,i=this.itemsData.getDataSet(),r=this.touchParams.itemProps;this.touchParams.itemProps=null,r.forEach(function(e){var r=e.item.id;if(null!=t.itemsData.get(r,t.itemOptions)){var n=this._cloneItemData(e.item.data);t.options.onMove(n,function(n){n?(n[i._fieldId]=r,i.update(n)):(e.item.setData(e.data),t.body.emitter.emit("_change"))})}else t.options.onAdd(e.item.data,function(i){t._removeItem(e.item),i&&t.itemsData.getDataSet().add(i),t.body.emitter.emit("_change")})}.bind(this))}},x.prototype._onGroupClick=function(e){var t=this.groupFromTarget(e);if(t&&t.nestedGroups){var i=this.groupsData.getDataSet(),r=i.get(t.groupId);null==r.showNested&&(r.showNested=!0),r.showNested=!r.showNested;var n=i.get(t.nestedGroups).map(function(e){return e.visible=r.showNested,e});if(i.update(n.concat(r)),r.showNested)s.removeClassName(t.dom.label,"collapsed"),s.addClassName(t.dom.label,"expanded");else{s.removeClassName(t.dom.label,"expanded");var o=this.options.rtl?"collapsed-rtl":"collapsed";s.addClassName(t.dom.label,o)}}},x.prototype._onGroupDragStart=function(e){this.options.groupEditable.order&&(this.groupTouchParams.group=this.groupFromTarget(e),this.groupTouchParams.group&&(e.stopPropagation(),this.groupTouchParams.originalOrder=this.groupsData.getIds({order:this.options.groupOrder})))},x.prototype._onGroupDrag=function(e){if(this.options.groupEditable.order&&this.groupTouchParams.group){e.stopPropagation();var t=this.groupsData;this.groupsData instanceof u&&(t=this.groupsData.getDataSet());var i=this.groupFromTarget(e);if(i&&i.height!=this.groupTouchParams.group.height){var r=i.top<this.groupTouchParams.group.top,n=e.center?e.center.y:e.clientY,o=s.getAbsoluteTop(i.dom.foreground),a=this.groupTouchParams.group.height;if(r){if(o+a<n)return}else if(o+i.height-a>n)return}if(i&&i!=this.groupTouchParams.group){var l=t.get(i.groupId),h=t.get(this.groupTouchParams.group.groupId);h&&l&&(this.options.groupOrderSwap(h,l,t),t.update(h),t.update(l));var c=t.getIds({order:this.options.groupOrder});if(!s.equalArray(c,this.groupTouchParams.originalOrder))for(var d=this.groupTouchParams.originalOrder,p=this.groupTouchParams.group.groupId,f=Math.min(d.length,c.length),m=0,v=0,g=0;m<f;){for(;m+v<f&&m+g<f&&c[m+v]==d[m+g];)m++;if(m+v>=f)break;if(c[m+v]==p)v=1;else if(d[m+g]==p)g=1;else{var y=c.indexOf(d[m+g]),_=t.get(c[m+v]),b=t.get(d[m+g]);this.options.groupOrderSwap(_,b,t),t.update(_),t.update(b);var x=c[m+v];c[m+v]=d[m+g],c[y]=x,m++}}}}},x.prototype._onGroupDragEnd=function(e){if(this.options.groupEditable.order&&this.groupTouchParams.group){e.stopPropagation();var t=this,i=t.groupTouchParams.group.groupId,r=t.groupsData.getDataSet(),n=s.extend({},r.get(i));t.options.onMoveGroup(n,function(e){if(e)e[r._fieldId]=i,r.update(e);else{var n=r.getIds({order:t.options.groupOrder});if(!s.equalArray(n,t.groupTouchParams.originalOrder))for(var o=t.groupTouchParams.originalOrder,a=Math.min(o.length,n.length),l=0;l<a;){for(;l<a&&n[l]==o[l];)l++;if(l>=a)break;var u=n.indexOf(o[l]),h=r.get(n[l]),c=r.get(o[l]);t.options.groupOrderSwap(h,c,r),r.update(h),r.update(c);var d=n[l];n[l]=o[l],n[u]=d,l++}}}),t.body.emitter.emit("groupDragged",{groupId:i})}},x.prototype._onSelectItem=function(e){if(this.options.selectable){var t=e.srcEvent&&(e.srcEvent.ctrlKey||e.srcEvent.metaKey),i=e.srcEvent&&e.srcEvent.shiftKey;if(t||i)this._onMultiSelectItem(e);else{var r=this.getSelection(),n=this.itemFromTarget(e),o=n?[n.id]:[];this.setSelection(o);var a=this.getSelection();(a.length>0||r.length>0)&&this.body.emitter.emit("select",{items:a,event:e})}}},x.prototype._onMouseOver=function(e){var t=this.itemFromTarget(e);if(t&&t!==this.itemFromRelatedTarget(e)){var i=t.getTitle();if(this.options.showTooltips&&i){null==this.popup&&(this.popup=new y(this.body.dom.root,this.options.tooltip.overflowMethod||"flip")),this.popup.setText(i);var r=this.body.dom.centerContainer;this.popup.setPosition(e.clientX-s.getAbsoluteLeft(r)+r.offsetLeft,e.clientY-s.getAbsoluteTop(r)+r.offsetTop),this.popup.show()}else null!=this.popup&&this.popup.hide();this.body.emitter.emit("itemover",{item:t.id,event:e})}},x.prototype._onMouseOut=function(e){var t=this.itemFromTarget(e);t&&(t!==this.itemFromRelatedTarget(e)&&(null!=this.popup&&this.popup.hide(),this.body.emitter.emit("itemout",{item:t.id,event:e})))},x.prototype._onMouseMove=function(e){if(this.itemFromTarget(e)&&this.options.showTooltips&&this.options.tooltip.followMouse&&this.popup&&!this.popup.hidden){var t=this.body.dom.centerContainer;this.popup.setPosition(e.clientX-s.getAbsoluteLeft(t)+t.offsetLeft,e.clientY-s.getAbsoluteTop(t)+t.offsetTop),this.popup.show()}},x.prototype._onMouseWheel=function(e){this.touchParams.itemIsDragging&&this._onDragEnd(e)},x.prototype._onUpdateItem=function(e){if(this.options.selectable&&this.options.editable.add){var t=this;if(e){var i=t.itemsData.get(e.id);this.options.onUpdate(i,function(e){e&&t.itemsData.getDataSet().update(e)})}}},x.prototype._onDropObjectOnItem=function(e){var t=this.itemFromTarget(e),i=JSON.parse(e.dataTransfer.getData("text"));this.options.onDropObjectOnItem(i,t)},x.prototype._onAddItem=function(e){if(this.options.selectable&&this.options.editable.add){var t,i,r=this,n=this.options.snap||null;this.options.rtl?i=(t=s.getAbsoluteRight(this.dom.frame))-e.center.x:(t=s.getAbsoluteLeft(this.dom.frame),i=e.center.x-t);var o,a,l=this.body.util.toTime(i),u=this.body.util.getScale(),h=this.body.util.getStep();"drop"==e.type?((a=JSON.parse(e.dataTransfer.getData("text"))).content=a.content?a.content:"new item",a.start=a.start?a.start:n?n(l,u,h):l,a.type=a.type||"box",a[this.itemsData._fieldId]=a.id||s.randomUUID(),"range"!=a.type||a.end||(o=this.body.util.toTime(i+this.props.width/5),a.end=n?n(o,u,h):o)):((a={start:n?n(l,u,h):l,content:"new item"})[this.itemsData._fieldId]=s.randomUUID(),"range"===this.options.type&&(o=this.body.util.toTime(i+this.props.width/5),a.end=n?n(o,u,h):o));var c=this.groupFromTarget(e);c&&(a.group=c.groupId),a=this._cloneItemData(a),this.options.onAdd(a,function(t){t&&(r.itemsData.getDataSet().add(t),"drop"==e.type&&r.setSelection([t.id]))})}},x.prototype._onMultiSelectItem=function(e){if(this.options.selectable){var t=this.itemFromTarget(e);if(t){var i=this.options.multiselect?this.getSelection():[];if((e.srcEvent&&e.srcEvent.shiftKey||!1)&&this.options.multiselect){var r=this.itemsData.get(t.id).group,n=void 0;this.options.multiselectPerGroup&&i.length>0&&(n=this.itemsData.get(i[0]).group),this.options.multiselectPerGroup&&null!=n&&n!=r||i.push(t.id);var o=x._getItemRange(this.itemsData.get(i,this.itemOptions));if(!this.options.multiselectPerGroup||n==r)for(var a in i=[],this.items)if(this.items.hasOwnProperty(a)){var s=this.items[a],l=s.data.start,u=void 0!==s.data.end?s.data.end:l;!(l>=o.min&&u<=o.max)||this.options.multiselectPerGroup&&n!=this.itemsData.get(s.id).group||s instanceof g||i.push(s.id)}}else{var h=i.indexOf(t.id);-1==h?i.push(t.id):i.splice(h,1)}this.setSelection(i),this.body.emitter.emit("select",{items:this.getSelection(),event:e})}}},x._getItemRange=function(e){var t=null,i=null;return e.forEach(function(e){(null==i||e.start<i)&&(i=e.start),null!=e.end?(null==t||e.end>t)&&(t=e.end):(null==t||e.start>t)&&(t=e.start)}),{min:i,max:t}},x.prototype.itemFromElement=function(e){for(var t=e;t;){if(t.hasOwnProperty("timeline-item"))return t["timeline-item"];t=t.parentNode}return null},x.prototype.itemFromTarget=function(e){return this.itemFromElement(e.target)},x.prototype.itemFromRelatedTarget=function(e){return this.itemFromElement(e.relatedTarget)},x.prototype.groupFromTarget=function(e){var t=e.center?e.center.y:e.clientY,i=this.groupIds;i.length<=0&&this.groupsData&&(i=this.groupsData.getIds({order:this.options.groupOrder}));for(var r=0;r<i.length;r++){var n=i[r],o=this.groups[n],a=o.dom.foreground,l=s.getAbsoluteTop(a);if(t>l&&t<l+a.offsetHeight)return o;if("top"===this.options.orientation.item){if(r===this.groupIds.length-1&&t>l)return o}else if(0===r&&t<l+a.offset)return o}return null},x.itemSetFromTarget=function(e){for(var t=e.target;t;){if(t.hasOwnProperty("timeline-itemset"))return t["timeline-itemset"];t=t.parentNode}return null},x.prototype._cloneItemData=function(e,t){var i=s.extend({},e);return t||(t=this.itemsData.getDataSet()._options.type),null!=i.start&&(i.start=s.convert(i.start,t&&t.start||"Date")),null!=i.end&&(i.end=s.convert(i.end,t&&t.end||"Date")),i},e.exports=x},function(e,t,i){t.orderByStart=function(e){e.sort(function(e,t){return e.data.start-t.data.start})},t.orderByEnd=function(e){e.sort(function(e,t){return("end"in e.data?e.data.end:e.data.start)-("end"in t.data?t.data.end:t.data.start)})},t.stack=function(e,i,r){if(r)for(var n=0;n<e.length;n++)e[n].top=null;for(n=0;n<e.length;n++){var o=e[n];if(o.stack&&null===o.top){o.top=i.axis;do{for(var a=null,s=0,l=e.length;s<l;s++){var u=e[s];if(null!==u.top&&u!==o&&u.stack&&t.collision(o,u,i.item,u.options.rtl)){a=u;break}}null!=a&&(o.top=a.top+a.height+i.item.vertical)}while(a)}}},t.substack=function(e,i,r){for(var n=0;n<e.length;n++)e[n].top=null;var o=r.height;for(n=0;n<e.length;n++){var a=e[n];if(a.stack&&null===a.top){a.top=a.baseTop;do{for(var s=null,l=0,u=e.length;l<u;l++){var h=e[l];if(null!==h.top&&h!==a&&t.collision(a,h,i.item,h.options.rtl)){s=h;break}}null!=s&&(a.top=s.top+s.height+i.item.vertical),a.top+a.height>o&&(o=a.top+a.height)}while(s)}}r.height=o-r.top+.5*i.item.vertical},t.nostack=function(e,i,r,n){for(var o=0;o<e.length;o++)if(null==e[o].data.subgroup)e[o].top=i.item.vertical;else if(void 0!==e[o].data.subgroup&&n){var a=0;for(var s in r)r.hasOwnProperty(s)&&1==r[s].visible&&r[s].index<r[e[o].data.subgroup].index&&(a+=r[s].height,r[e[o].data.subgroup].top=a);e[o].top=a+.5*i.item.vertical}n||t.stackSubgroups(e,i,r)},t.stackSubgroups=function(e,i,r){for(var n in r)if(r.hasOwnProperty(n)){r[n].top=0;do{var o=null;for(var a in r)if(null!==r[a].top&&a!==n&&r[n].index>r[a].index&&t.collisionByTimes(r[n],r[a])){o=r[a];break}null!=o&&(r[n].top=o.top+o.height)}while(o)}for(var s=0;s<e.length;s++)void 0!==e[s].data.subgroup&&(e[s].top=r[e[s].data.subgroup].top+.5*i.item.vertical)},t.stackSubgroupsWithInnerStack=function(e,i,r){var n=!1,o=[];for(var a in r)r[a].hasOwnProperty("index")?o[r[a].index]=a:o.push(a);for(var s=0;s<o.length;s++)if(a=o[s],r.hasOwnProperty(a)){for(var l in n=n||r[a].stack,r[a].top=0,r)r[l].visible&&r[a].index>r[l].index&&(r[a].top+=r[l].height);for(var u=e[a],h=0;h<u.length;h++)void 0!==u[h].data.subgroup&&(u[h].top=r[u[h].data.subgroup].top+.5*i.item.vertical,r[a].stack&&(u[h].baseTop=u[h].top));n&&r[a].stack&&t.substack(e[a],i,r[a])}},t.collision=function(e,t,i,r){return r?e.right-i.horizontal+.001<t.right+t.width&&e.right+e.width+i.horizontal-.001>t.right&&e.top-i.vertical+.001<t.top+t.height&&e.top+e.height+i.vertical-.001>t.top:e.left-i.horizontal+.001<t.left+t.width&&e.left+e.width+i.horizontal-.001>t.left&&e.top-i.vertical+.001<t.top+t.height&&e.top+e.height+i.vertical-.001>t.top},t.collisionByTimes=function(e,t){return e.start<=t.start&&e.end>=t.start&&e.top<t.top+t.height&&e.top+e.height>t.top||t.start<=e.start&&t.end>=e.start&&t.top<e.top+e.height&&t.top+t.height>e.top}},function(e,t,i){var r=i(38);function n(e,t,i){if(this.props={dot:{width:0,height:0},line:{width:0,height:0}},this.options=i,e&&null==e.start)throw new Error('Property "start" missing in item '+e);r.call(this,e,t,i)}n.prototype=new r(null,null,null),n.prototype.isVisible=function(e){var t=this.options.align,i=this.width*e.getMillisecondsPerPixel();return"right"==t?this.data.start.getTime()>e.start&&this.data.start.getTime()-i<e.end:"left"==t?this.data.start.getTime()+i>e.start&&this.data.start.getTime()<e.end:this.data.start.getTime()+i/2>e.start&&this.data.start.getTime()-i/2<e.end},n.prototype._createDomElement=function(){this.dom||(this.dom={},this.dom.box=document.createElement("DIV"),this.dom.content=document.createElement("DIV"),this.dom.content.className="vis-item-content",this.dom.box.appendChild(this.dom.content),this.dom.line=document.createElement("DIV"),this.dom.line.className="vis-line",this.dom.dot=document.createElement("DIV"),this.dom.dot.className="vis-dot",this.dom.box["timeline-item"]=this,this.dirty=!0)},n.prototype._appendDomElement=function(){if(!this.parent)throw new Error("Cannot redraw item: no parent attached");if(!this.dom.box.parentNode){var e=this.parent.dom.foreground;if(!e)throw new Error("Cannot redraw item: parent has no foreground container element");e.appendChild(this.dom.box)}if(!this.dom.line.parentNode){var t=this.parent.dom.background;if(!t)throw new Error("Cannot redraw item: parent has no background container element");t.appendChild(this.dom.line)}if(!this.dom.dot.parentNode){var i=this.parent.dom.axis;if(!t)throw new Error("Cannot redraw item: parent has no axis container element");i.appendChild(this.dom.dot)}this.displayed=!0},n.prototype._updateDirtyDomComponents=function(){if(this.dirty){this._updateContents(this.dom.content),this._updateDataAttributes(this.dom.box),this._updateStyle(this.dom.box);var e=this.editable.updateTime||this.editable.updateGroup,t=(this.data.className?" "+this.data.className:"")+(this.selected?" vis-selected":"")+(e?" vis-editable":" vis-readonly");this.dom.box.className="vis-item vis-box"+t,this.dom.line.className="vis-item vis-line"+t,this.dom.dot.className="vis-item vis-dot"+t}},n.prototype._getDomComponentsSizes=function(){return{previous:{right:this.dom.box.style.right,left:this.dom.box.style.left},dot:{height:this.dom.dot.offsetHeight,width:this.dom.dot.offsetWidth},line:{width:this.dom.line.offsetWidth},box:{width:this.dom.box.offsetWidth,height:this.dom.box.offsetHeight}}},n.prototype._updateDomComponentsSizes=function(e){this.options.rtl?this.dom.box.style.right="0px":this.dom.box.style.left="0px",this.props.dot.height=e.dot.height,this.props.dot.width=e.dot.width,this.props.line.width=e.line.width,this.width=e.box.width,this.height=e.box.height,this.options.rtl?this.dom.box.style.right=e.previous.right:this.dom.box.style.left=e.previous.left,this.dirty=!1},n.prototype._repaintDomAdditionals=function(){this._repaintOnItemUpdateTimeTooltip(this.dom.box),this._repaintDragCenter(),this._repaintDeleteButton(this.dom.box)},n.prototype.redraw=function(e){var t,i,r=[this._createDomElement.bind(this),this._appendDomElement.bind(this),this._updateDirtyDomComponents.bind(this),function(){this.dirty&&(t=this._getDomComponentsSizes())}.bind(this),function(){this.dirty&&this._updateDomComponentsSizes.bind(this)(t)}.bind(this),this._repaintDomAdditionals.bind(this)];return e?r:(r.forEach(function(e){i=e()}),i)},n.prototype.show=function(){this.displayed||this.redraw()},n.prototype.hide=function(){if(this.displayed){var e=this.dom;e.box.parentNode&&e.box.parentNode.removeChild(e.box),e.line.parentNode&&e.line.parentNode.removeChild(e.line),e.dot.parentNode&&e.dot.parentNode.removeChild(e.dot),this.displayed=!1}},n.prototype.repositionX=function(){var e=this.conversion.toScreen(this.data.start),t=this.options.align;"right"==t?this.options.rtl?(this.right=e-this.width,this.dom.box.style.right=this.right+"px",this.dom.line.style.right=e-this.props.line.width+"px",this.dom.dot.style.right=e-this.props.line.width/2-this.props.dot.width/2+"px"):(this.left=e-this.width,this.dom.box.style.left=this.left+"px",this.dom.line.style.left=e-this.props.line.width+"px",this.dom.dot.style.left=e-this.props.line.width/2-this.props.dot.width/2+"px"):"left"==t?this.options.rtl?(this.right=e,this.dom.box.style.right=this.right+"px",this.dom.line.style.right=e+"px",this.dom.dot.style.right=e+this.props.line.width/2-this.props.dot.width/2+"px"):(this.left=e,this.dom.box.style.left=this.left+"px",this.dom.line.style.left=e+"px",this.dom.dot.style.left=e+this.props.line.width/2-this.props.dot.width/2+"px"):this.options.rtl?(this.right=e-this.width/2,this.dom.box.style.right=this.right+"px",this.dom.line.style.right=e-this.props.line.width+"px",this.dom.dot.style.right=e-this.props.dot.width/2+"px"):(this.left=e-this.width/2,this.dom.box.style.left=this.left+"px",this.dom.line.style.left=e-this.props.line.width/2+"px",this.dom.dot.style.left=e-this.props.dot.width/2+"px")},n.prototype.repositionY=function(){var e=this.options.orientation.item,t=this.dom.box,i=this.dom.line,r=this.dom.dot;if("top"==e)t.style.top=(this.top||0)+"px",i.style.top="0",i.style.height=this.parent.top+this.top+1+"px",i.style.bottom="";else{var n=this.parent.itemSet.props.height,o=n-this.parent.top-this.parent.height+this.top;t.style.top=(this.parent.height-this.top-this.height||0)+"px",i.style.top=n-o+"px",i.style.bottom="0"}r.style.top=-this.props.dot.height/2+"px"},n.prototype.getWidthLeft=function(){return this.width/2},n.prototype.getWidthRight=function(){return this.width/2},e.exports=n},function(e,t,i){var r=i(38);function n(e,t,i){if(this.props={dot:{top:0,width:0,height:0},content:{height:0,marginLeft:0,marginRight:0}},this.options=i,e&&null==e.start)throw new Error('Property "start" missing in item '+e);r.call(this,e,t,i)}n.prototype=new r(null,null,null),n.prototype.isVisible=function(e){var t=this.width*e.getMillisecondsPerPixel();return this.data.start.getTime()+t>e.start&&this.data.start<e.end},n.prototype._createDomElement=function(){this.dom||(this.dom={},this.dom.point=document.createElement("div"),this.dom.content=document.createElement("div"),this.dom.content.className="vis-item-content",this.dom.point.appendChild(this.dom.content),this.dom.dot=document.createElement("div"),this.dom.point.appendChild(this.dom.dot),this.dom.point["timeline-item"]=this,this.dirty=!0)},n.prototype._appendDomElement=function(){if(!this.parent)throw new Error("Cannot redraw item: no parent attached");if(!this.dom.point.parentNode){var e=this.parent.dom.foreground;if(!e)throw new Error("Cannot redraw item: parent has no foreground container element");e.appendChild(this.dom.point)}this.displayed=!0},n.prototype._updateDirtyDomComponents=function(){if(this.dirty){this._updateContents(this.dom.content),this._updateDataAttributes(this.dom.point),this._updateStyle(this.dom.point);var e=this.editable.updateTime||this.editable.updateGroup,t=(this.data.className?" "+this.data.className:"")+(this.selected?" vis-selected":"")+(e?" vis-editable":" vis-readonly");this.dom.point.className="vis-item vis-point"+t,this.dom.dot.className="vis-item vis-dot"+t}},n.prototype._getDomComponentsSizes=function(){return{dot:{width:this.dom.dot.offsetWidth,height:this.dom.dot.offsetHeight},content:{width:this.dom.content.offsetWidth,height:this.dom.content.offsetHeight},point:{width:this.dom.point.offsetWidth,height:this.dom.point.offsetHeight}}},n.prototype._updateDomComponentsSizes=function(e){this.props.dot.width=e.dot.width,this.props.dot.height=e.dot.height,this.props.content.height=e.content.height,this.options.rtl?this.dom.content.style.marginRight=2*this.props.dot.width+"px":this.dom.content.style.marginLeft=2*this.props.dot.width+"px",this.width=e.point.width,this.height=e.point.height,this.dom.dot.style.top=(this.height-this.props.dot.height)/2+"px",this.options.rtl?this.dom.dot.style.right=this.props.dot.width/2+"px":this.dom.dot.style.left=this.props.dot.width/2+"px",this.dirty=!1},n.prototype._repaintDomAdditionals=function(){this._repaintOnItemUpdateTimeTooltip(this.dom.point),this._repaintDragCenter(),this._repaintDeleteButton(this.dom.point)},n.prototype.redraw=function(e){var t,i,r=[this._createDomElement.bind(this),this._appendDomElement.bind(this),this._updateDirtyDomComponents.bind(this),function(){this.dirty&&(t=this._getDomComponentsSizes())}.bind(this),function(){this.dirty&&this._updateDomComponentsSizes.bind(this)(t)}.bind(this),this._repaintDomAdditionals.bind(this)];return e?r:(r.forEach(function(e){i=e()}),i)},n.prototype.show=function(){this.displayed||this.redraw()},n.prototype.hide=function(){this.displayed&&(this.dom.point.parentNode&&this.dom.point.parentNode.removeChild(this.dom.point),this.displayed=!1)},n.prototype.repositionX=function(){var e=this.conversion.toScreen(this.data.start);this.options.rtl?(this.right=e-this.props.dot.width,this.dom.point.style.right=this.right+"px"):(this.left=e-this.props.dot.width,this.dom.point.style.left=this.left+"px")},n.prototype.repositionY=function(){var e=this.options.orientation.item,t=this.dom.point;t.style.top="top"==e?this.top+"px":this.parent.height-this.top-this.height+"px"},n.prototype.getWidthLeft=function(){return this.props.dot.width},n.prototype.getWidthRight=function(){return this.props.dot.width},e.exports=n},function(e,t,i){var r=i(38),n=i(69),o=i(70);function a(e,t,i){if(this.props={content:{width:0}},this.overflow=!1,e){if(null==e.start)throw new Error('Property "start" missing in item '+e.id);if(null==e.end)throw new Error('Property "end" missing in item '+e.id)}r.call(this,e,t,i)}a.prototype=new r(null,null,null),a.prototype.baseClassName="vis-item vis-background",a.prototype.stack=!1,a.prototype.isVisible=function(e){return this.data.start<e.end&&this.data.end>e.start},a.prototype._createDomElement=function(){this.dom||(this.dom={},this.dom.box=document.createElement("div"),this.dom.frame=document.createElement("div"),this.dom.frame.className="vis-item-overflow",this.dom.box.appendChild(this.dom.frame),this.dom.content=document.createElement("div"),this.dom.content.className="vis-item-content",this.dom.frame.appendChild(this.dom.content),this.dirty=!0)},a.prototype._appendDomElement=function(){if(!this.parent)throw new Error("Cannot redraw item: no parent attached");if(!this.dom.box.parentNode){var e=this.parent.dom.background;if(!e)throw new Error("Cannot redraw item: parent has no background container element");e.appendChild(this.dom.box)}this.displayed=!0},a.prototype._updateDirtyDomComponents=function(){if(this.dirty){this._updateContents(this.dom.content),this._updateDataAttributes(this.dom.content),this._updateStyle(this.dom.box);var e=(this.data.className?" "+this.data.className:"")+(this.selected?" vis-selected":"");this.dom.box.className=this.baseClassName+e}},a.prototype._getDomComponentsSizes=function(){return this.overflow="hidden"!==window.getComputedStyle(this.dom.content).overflow,{content:{width:this.dom.content.offsetWidth}}},a.prototype._updateDomComponentsSizes=function(e){this.props.content.width=e.content.width,this.height=0,this.dirty=!1},a.prototype._repaintDomAdditionals=function(){},a.prototype.redraw=function(e){var t,i,r=[this._createDomElement.bind(this),this._appendDomElement.bind(this),this._updateDirtyDomComponents.bind(this),function(){this.dirty&&(t=this._getDomComponentsSizes.bind(this)())}.bind(this),function(){this.dirty&&this._updateDomComponentsSizes.bind(this)(t)}.bind(this),this._repaintDomAdditionals.bind(this)];return e?r:(r.forEach(function(e){i=e()}),i)},a.prototype.show=o.prototype.show,a.prototype.hide=o.prototype.hide,a.prototype.repositionX=o.prototype.repositionX,a.prototype.repositionY=function(e){var t,i=this.options.orientation.item;if(void 0!==this.data.subgroup){var r=this.data.subgroup;this.dom.box.style.height=this.parent.subgroups[r].height+"px",this.dom.box.style.top="top"==i?this.parent.top+this.parent.subgroups[r].top+"px":this.parent.top+this.parent.height-this.parent.subgroups[r].top-this.parent.subgroups[r].height+"px",this.dom.box.style.bottom=""}else this.parent instanceof n?(t=Math.max(this.parent.height,this.parent.itemSet.body.domProps.center.height,this.parent.itemSet.body.domProps.centerContainer.height),this.dom.box.style.bottom="bottom"==i?"0":"",this.dom.box.style.top="top"==i?"0":""):(t=this.parent.height,this.dom.box.style.top=this.parent.top+"px",this.dom.box.style.bottom="");this.dom.box.style.height=t+"px"},e.exports=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(t,i){(0,r.default)(this,e),this.container=t,this.overflowMethod=i||"cap",this.x=0,this.y=0,this.padding=5,this.hidden=!1,this.frame=document.createElement("div"),this.frame.className="vis-tooltip",this.container.appendChild(this.frame)}return(0,n.default)(e,[{key:"setPosition",value:function(e,t){this.x=parseInt(e),this.y=parseInt(t)}},{key:"setText",value:function(e){e instanceof Element?(this.frame.innerHTML="",this.frame.appendChild(e)):this.frame.innerHTML=e}},{key:"show",value:function(e){if(void 0===e&&(e=!0),!0===e){var t=this.frame.clientHeight,i=this.frame.clientWidth,r=this.frame.parentNode.clientHeight,n=this.frame.parentNode.clientWidth,o=0,a=0;if("flip"==this.overflowMethod){var s=!1,l=!0;this.y-t<this.padding&&(l=!1),this.x+i>n-this.padding&&(s=!0),o=s?this.x-i:this.x,a=l?this.y-t:this.y}else(a=this.y-t)+t+this.padding>r&&(a=r-t-this.padding),a<this.padding&&(a=this.padding),(o=this.x)+i+this.padding>n&&(o=n-i-this.padding),o<this.padding&&(o=this.padding);this.frame.style.left=o+"px",this.frame.style.top=a+"px",this.frame.style.visibility="visible",this.hidden=!1}else this.hide()}},{key:"hide",value:function(){this.hidden=!0,this.frame.style.left="0",this.frame.style.top="0",this.frame.style.visibility="hidden"}},{key:"destroy",value:function(){this.frame.parentNode.removeChild(this.frame)}}]),e}();t.default=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r="string",n="boolean",o="number",a="object",s={configure:{enabled:{boolean:n},filter:{boolean:n,function:"function"},container:{dom:"dom"},__type__:{object:a,boolean:n,function:"function"}},align:{string:r},rtl:{boolean:n,undefined:"undefined"},rollingMode:{follow:{boolean:n},offset:{number:o,undefined:"undefined"},__type__:{object:a}},verticalScroll:{boolean:n,undefined:"undefined"},horizontalScroll:{boolean:n,undefined:"undefined"},autoResize:{boolean:n},throttleRedraw:{number:o},clickToUse:{boolean:n},dataAttributes:{string:r,array:"array"},editable:{add:{boolean:n,undefined:"undefined"},remove:{boolean:n,undefined:"undefined"},updateGroup:{boolean:n,undefined:"undefined"},updateTime:{boolean:n,undefined:"undefined"},overrideItems:{boolean:n,undefined:"undefined"},__type__:{boolean:n,object:a}},end:{number:o,date:"date",string:r,moment:"moment"},format:{minorLabels:{millisecond:{string:r,undefined:"undefined"},second:{string:r,undefined:"undefined"},minute:{string:r,undefined:"undefined"},hour:{string:r,undefined:"undefined"},weekday:{string:r,undefined:"undefined"},day:{string:r,undefined:"undefined"},week:{string:r,undefined:"undefined"},month:{string:r,undefined:"undefined"},year:{string:r,undefined:"undefined"},__type__:{object:a,function:"function"}},majorLabels:{millisecond:{string:r,undefined:"undefined"},second:{string:r,undefined:"undefined"},minute:{string:r,undefined:"undefined"},hour:{string:r,undefined:"undefined"},weekday:{string:r,undefined:"undefined"},day:{string:r,undefined:"undefined"},week:{string:r,undefined:"undefined"},month:{string:r,undefined:"undefined"},year:{string:r,undefined:"undefined"},__type__:{object:a,function:"function"}},__type__:{object:a}},moment:{function:"function"},groupOrder:{string:r,function:"function"},groupEditable:{add:{boolean:n,undefined:"undefined"},remove:{boolean:n,undefined:"undefined"},order:{boolean:n,undefined:"undefined"},__type__:{boolean:n,object:a}},groupOrderSwap:{function:"function"},height:{string:r,number:o},hiddenDates:{start:{date:"date",number:o,string:r,moment:"moment"},end:{date:"date",number:o,string:r,moment:"moment"},repeat:{string:r},__type__:{object:a,array:"array"}},itemsAlwaysDraggable:{item:{boolean:n,undefined:"undefined"},range:{boolean:n,undefined:"undefined"},__type__:{boolean:n,object:a}},limitSize:{boolean:n},locale:{string:r},locales:{__any__:{any:"any"},__type__:{object:a}},margin:{axis:{number:o},item:{horizontal:{number:o,undefined:"undefined"},vertical:{number:o,undefined:"undefined"},__type__:{object:a,number:o}},__type__:{object:a,number:o}},max:{date:"date",number:o,string:r,moment:"moment"},maxHeight:{number:o,string:r},maxMinorChars:{number:o},min:{date:"date",number:o,string:r,moment:"moment"},minHeight:{number:o,string:r},moveable:{boolean:n},multiselect:{boolean:n},multiselectPerGroup:{boolean:n},onAdd:{function:"function"},onDropObjectOnItem:{function:"function"},onUpdate:{function:"function"},onMove:{function:"function"},onMoving:{function:"function"},onRemove:{function:"function"},onAddGroup:{function:"function"},onMoveGroup:{function:"function"},onRemoveGroup:{function:"function"},onInitialDrawComplete:{function:"function"},order:{function:"function"},orientation:{axis:{string:r,undefined:"undefined"},item:{string:r,undefined:"undefined"},__type__:{string:r,object:a}},selectable:{boolean:n},showCurrentTime:{boolean:n},showMajorLabels:{boolean:n},showMinorLabels:{boolean:n},stack:{boolean:n},stackSubgroups:{boolean:n},snap:{function:"function",null:"null"},start:{date:"date",number:o,string:r,moment:"moment"},template:{function:"function"},groupTemplate:{function:"function"},visibleFrameTemplate:{string:r,function:"function"},showTooltips:{boolean:n},tooltip:{followMouse:{boolean:n},overflowMethod:{string:["cap","flip"]},__type__:{object:a}},tooltipOnItemUpdateTime:{template:{function:"function"},__type__:{boolean:n,object:a}},timeAxis:{scale:{string:r,undefined:"undefined"},step:{number:o,undefined:"undefined"},__type__:{object:a}},type:{string:r},width:{string:r,number:o},zoomable:{boolean:n},zoomKey:{string:["ctrlKey","altKey","metaKey",""]},zoomMax:{number:o},zoomMin:{number:o},__type__:{object:a}};t.allOptions=s,t.configureOptions={global:{align:["center","left","right"],direction:!1,autoResize:!0,clickToUse:!1,editable:{add:!1,remove:!1,updateGroup:!1,updateTime:!1},end:"",format:{minorLabels:{millisecond:"SSS",second:"s",minute:"HH:mm",hour:"HH:mm",weekday:"ddd D",day:"D",week:"w",month:"MMM",year:"YYYY"},majorLabels:{millisecond:"HH:mm:ss",second:"D MMMM HH:mm",minute:"ddd D MMMM",hour:"ddd D MMMM",weekday:"MMMM YYYY",day:"MMMM YYYY",week:"MMMM YYYY",month:"YYYY",year:""}},groupsDraggable:!1,height:"",locale:"",margin:{axis:[20,0,100,1],item:{horizontal:[10,0,100,1],vertical:[10,0,100,1]}},max:"",maxHeight:"",maxMinorChars:[7,0,20,1],min:"",minHeight:"",moveable:!1,multiselect:!1,multiselectPerGroup:!1,orientation:{axis:["both","bottom","top"],item:["bottom","top"]},selectable:!0,showCurrentTime:!1,showMajorLabels:!0,showMinorLabels:!0,stack:!0,stackSubgroups:!0,start:"",showTooltips:!0,tooltip:{followMouse:!1,overflowMethod:"flip"},tooltipOnItemUpdateTime:!1,type:["box","point","range","background"],width:"100%",zoomable:!0,zoomKey:["ctrlKey","altKey","metaKey",""],zoomMax:[31536e10,10,31536e10,1],zoomMin:[10,10,31536e10,1]}}},function(e,t,i){var r,n=i(6),o=(r=n)&&r.__esModule?r:{default:r};var a=i(2),s=i(14),l=i(11),u=i(12),h=i(16),c=i(107),d=i(109),p=i(112),f=i(110),m=i(111),v=i(72);function g(e,t){this.id=a.randomUUID(),this.body=e,this.defaultOptions={yAxisOrientation:"left",defaultGroup:"default",sort:!0,sampling:!0,stack:!1,graphHeight:"400px",shaded:{enabled:!1,orientation:"bottom"},style:"line",barChart:{width:50,sideBySide:!1,align:"center"},interpolation:{enabled:!0,parametrization:"centripetal",alpha:.5},drawPoints:{enabled:!0,size:6,style:"square"},dataAxis:{},legend:{},groups:{visibility:{}}},this.options=a.extend({},this.defaultOptions),this.dom={},this.props={},this.hammer=null,this.groups={},this.abortedGraphUpdate=!1,this.updateSVGheight=!1,this.updateSVGheightOnResize=!1,this.forceGraphUpdate=!0;var i=this;this.itemsData=null,this.groupsData=null,this.itemListeners={add:function(e,t,r){i._onAdd(t.items)},update:function(e,t,r){i._onUpdate(t.items)},remove:function(e,t,r){i._onRemove(t.items)}},this.groupListeners={add:function(e,t,r){i._onAddGroups(t.items)},update:function(e,t,r){i._onUpdateGroups(t.items)},remove:function(e,t,r){i._onRemoveGroups(t.items)}},this.items={},this.selection=[],this.lastStart=this.body.range.start,this.touchParams={},this.svgElements={},this.setOptions(t),this.groupsUsingDefaultStyles=[0],this.body.emitter.on("rangechanged",function(){i.lastStart=i.body.range.start,i.svg.style.left=a.option.asSize(-i.props.width),i.forceGraphUpdate=!0,i.redraw.call(i)}),this._create(),this.framework={svg:this.svg,svgElements:this.svgElements,options:this.options,groups:this.groups}}g.prototype=new h,g.prototype._create=function(){var e=document.createElement("div");e.className="vis-line-graph",this.dom.frame=e,this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.style.position="relative",this.svg.style.height=(""+this.options.graphHeight).replace("px","")+"px",this.svg.style.display="block",e.appendChild(this.svg),this.options.dataAxis.orientation="left",this.yAxisLeft=new c(this.body,this.options.dataAxis,this.svg,this.options.groups),this.options.dataAxis.orientation="right",this.yAxisRight=new c(this.body,this.options.dataAxis,this.svg,this.options.groups),delete this.options.dataAxis.orientation,this.legendLeft=new p(this.body,this.options.legend,"left",this.options.groups),this.legendRight=new p(this.body,this.options.legend,"right",this.options.groups),this.show()},g.prototype.setOptions=function(e){if(e){void 0===e.graphHeight&&void 0!==e.height?(this.updateSVGheight=!0,this.updateSVGheightOnResize=!0):void 0!==this.body.domProps.centerContainer.height&&void 0!==e.graphHeight&&parseInt((e.graphHeight+"").replace("px",""))<this.body.domProps.centerContainer.height&&(this.updateSVGheight=!0),a.selectiveDeepExtend(["sampling","defaultGroup","stack","height","graphHeight","yAxisOrientation","style","barChart","dataAxis","sort","groups"],this.options,e),a.mergeOptions(this.options,e,"interpolation"),a.mergeOptions(this.options,e,"drawPoints"),a.mergeOptions(this.options,e,"shaded"),a.mergeOptions(this.options,e,"legend"),e.interpolation&&"object"==(0,o.default)(e.interpolation)&&e.interpolation.parametrization&&("uniform"==e.interpolation.parametrization?this.options.interpolation.alpha=0:"chordal"==e.interpolation.parametrization?this.options.interpolation.alpha=1:(this.options.interpolation.parametrization="centripetal",this.options.interpolation.alpha=.5)),this.yAxisLeft&&void 0!==e.dataAxis&&(this.yAxisLeft.setOptions(this.options.dataAxis),this.yAxisRight.setOptions(this.options.dataAxis)),this.legendLeft&&void 0!==e.legend&&(this.legendLeft.setOptions(this.options.legend),this.legendRight.setOptions(this.options.legend)),this.groups.hasOwnProperty("__ungrouped__")&&this.groups.__ungrouped__.setOptions(e)}this.dom.frame&&(this.forceGraphUpdate=!0,this.body.emitter.emit("_change",{queue:!0}))},g.prototype.hide=function(){this.dom.frame.parentNode&&this.dom.frame.parentNode.removeChild(this.dom.frame)},g.prototype.show=function(){this.dom.frame.parentNode||this.body.dom.center.appendChild(this.dom.frame)},g.prototype.setItems=function(e){var t,i=this,r=this.itemsData;if(e){if(!(e instanceof l||e instanceof u))throw new TypeError("Data must be an instance of DataSet or DataView");this.itemsData=e}else this.itemsData=null;if(r&&(a.forEach(this.itemListeners,function(e,t){r.off(t,e)}),t=r.getIds(),this._onRemove(t)),this.itemsData){var n=this.id;a.forEach(this.itemListeners,function(e,t){i.itemsData.on(t,e,n)}),t=this.itemsData.getIds(),this._onAdd(t)}},g.prototype.setGroups=function(e){var t,i=this;if(this.groupsData){a.forEach(this.groupListeners,function(e,t){i.groupsData.off(t,e)}),t=this.groupsData.getIds(),this.groupsData=null;for(var r=0;r<t.length;r++)this._removeGroup(t[r])}if(e){if(!(e instanceof l||e instanceof u))throw new TypeError("Data must be an instance of DataSet or DataView");this.groupsData=e}else this.groupsData=null;if(this.groupsData){var n=this.id;a.forEach(this.groupListeners,function(e,t){i.groupsData.on(t,e,n)}),t=this.groupsData.getIds(),this._onAddGroups(t)}},g.prototype._onUpdate=function(e){this._updateAllGroupData(e)},g.prototype._onAdd=function(e){this._onUpdate(e)},g.prototype._onRemove=function(e){this._onUpdate(e)},g.prototype._onUpdateGroups=function(e){this._updateAllGroupData(null,e)},g.prototype._onAddGroups=function(e){this._onUpdateGroups(e)},g.prototype._onRemoveGroups=function(e){for(var t=0;t<e.length;t++)this._removeGroup(e[t]);this.forceGraphUpdate=!0,this.body.emitter.emit("_change",{queue:!0})},g.prototype._removeGroup=function(e){this.groups.hasOwnProperty(e)&&("right"==this.groups[e].options.yAxisOrientation?(this.yAxisRight.removeGroup(e),this.legendRight.removeGroup(e),this.legendRight.redraw()):(this.yAxisLeft.removeGroup(e),this.legendLeft.removeGroup(e),this.legendLeft.redraw()),delete this.groups[e])},g.prototype._updateGroup=function(e,t){this.groups.hasOwnProperty(t)?(this.groups[t].update(e),"right"==this.groups[t].options.yAxisOrientation?(this.yAxisRight.updateGroup(t,this.groups[t]),this.legendRight.updateGroup(t,this.groups[t]),this.yAxisLeft.removeGroup(t),this.legendLeft.removeGroup(t)):(this.yAxisLeft.updateGroup(t,this.groups[t]),this.legendLeft.updateGroup(t,this.groups[t]),this.yAxisRight.removeGroup(t),this.legendRight.removeGroup(t))):(this.groups[t]=new d(e,t,this.options,this.groupsUsingDefaultStyles),"right"==this.groups[t].options.yAxisOrientation?(this.yAxisRight.addGroup(t,this.groups[t]),this.legendRight.addGroup(t,this.groups[t])):(this.yAxisLeft.addGroup(t,this.groups[t]),this.legendLeft.addGroup(t,this.groups[t]))),this.legendLeft.redraw(),this.legendRight.redraw()},g.prototype._updateAllGroupData=function(e,t){if(null!=this.itemsData){var i={},r=this.itemsData.get(),n=this.itemsData._fieldId,o={};e&&e.map(function(e){o[e]=e});for(var s={},l=0;l<r.length;l++){var u=r[l],h=u.group;null==h&&(h="__ungrouped__"),s.hasOwnProperty(h)?s[h]++:s[h]=1}var c={};if(!t&&e)for(h in this.groups)if(this.groups.hasOwnProperty(h)){var d=(v=this.groups[h]).getItems();i[h]=d.filter(function(e){return c[e[n]]=e[n],e[n]!==o[e[n]]});var p=s[h];s[h]-=i[h].length,i[h].length<p&&(i[h][p-1]={})}for(l=0;l<r.length;l++)if(null==(h=(u=r[l]).group)&&(h="__ungrouped__"),t||!e||u[n]===o[u[n]]||!c.hasOwnProperty(u[n])){i.hasOwnProperty(h)||(i[h]=new Array(s[h]));var f=a.bridgeObject(u);f.x=a.convert(u.x,"Date"),f.end=a.convert(u.end,"Date"),f.orginalY=u.y,f.y=Number(u.y),f[n]=u[n];var m=i[h].length-s[h]--;i[h][m]=f}for(h in this.groups)this.groups.hasOwnProperty(h)&&(i.hasOwnProperty(h)||(i[h]=new Array(0)));for(h in i)if(i.hasOwnProperty(h))if(0==i[h].length)this.groups.hasOwnProperty(h)&&this._removeGroup(h);else{var v=void 0;null!=this.groupsData&&(v=this.groupsData.get(h)),null==v&&(v={id:h,content:this.options.defaultGroup+h}),this._updateGroup(v,h),this.groups[h].setItems(i[h])}this.forceGraphUpdate=!0,this.body.emitter.emit("_change",{queue:!0})}},g.prototype.redraw=function(){var e=!1;this.props.width=this.dom.frame.offsetWidth,this.props.height=this.body.domProps.centerContainer.height-this.body.domProps.border.top-this.body.domProps.border.bottom,e=this._isResized()||e;var t=this.body.range.end-this.body.range.start,i=t!=this.lastVisibleInterval;if(this.lastVisibleInterval=t,1==e&&(this.svg.style.width=a.option.asSize(3*this.props.width),this.svg.style.left=a.option.asSize(-this.props.width),-1==(this.options.height+"").indexOf("%")&&1!=this.updateSVGheightOnResize||(this.updateSVGheight=!0)),1==this.updateSVGheight?(this.options.graphHeight!=this.props.height+"px"&&(this.options.graphHeight=this.props.height+"px",this.svg.style.height=this.props.height+"px"),this.updateSVGheight=!1):this.svg.style.height=(""+this.options.graphHeight).replace("px","")+"px",1==e||1==i||1==this.abortedGraphUpdate||1==this.forceGraphUpdate)e=this._updateGraph()||e,this.forceGraphUpdate=!1;else if(0!=this.lastStart){var r=this.body.range.start-this.lastStart,n=this.body.range.end-this.body.range.start;if(0!=this.props.width){var o=r*(this.props.width/n);this.svg.style.left=-this.props.width-o+"px"}}return this.legendLeft.redraw(),this.legendRight.redraw(),e},g.prototype._getSortedGroupIds=function(){var e=[];for(var t in this.groups)if(this.groups.hasOwnProperty(t)){var i=this.groups[t];1!=i.visible||void 0!==this.options.groups.visibility[t]&&1!=this.options.groups.visibility[t]||e.push({id:t,zIndex:i.options.zIndex})}a.insertSort(e,function(e,t){var i=e.zIndex,r=t.zIndex;return void 0===i&&(i=0),void 0===r&&(r=0),i==r?0:i<r?-1:1});for(var r=new Array(e.length),n=0;n<e.length;n++)r[n]=e[n].id;return r},g.prototype._updateGraph=function(){if(s.prepareElements(this.svgElements),0!=this.props.width&&null!=this.itemsData){var e,t,i={},r=this.body.util.toGlobalTime(-this.body.domProps.root.width),n=this.body.util.toGlobalTime(2*this.body.domProps.root.width),o=this._getSortedGroupIds();if(o.length>0){var a={};for(this._getRelevantData(o,a,r,n),this._applySampling(o,a),t=0;t<o.length;t++)this._convertXcoordinates(a[o[t]]);if(this._getYRanges(o,a,i),1==this._updateYAxis(o,i))return s.cleanupElements(this.svgElements),this.abortedGraphUpdate=!0,!0;this.abortedGraphUpdate=!1;var l=void 0;for(t=0;t<o.length;t++)e=this.groups[o[t]],!0===this.options.stack&&"line"===this.options.style&&(null!=e.options.excludeFromStacking&&e.options.excludeFromStacking||(null!=l&&(this._stack(a[e.id],a[l.id]),1==e.options.shaded.enabled&&"group"!==e.options.shaded.orientation&&("top"==e.options.shaded.orientation&&"group"!==l.options.shaded.orientation?(l.options.shaded.orientation="group",l.options.shaded.groupId=e.id):(e.options.shaded.orientation="group",e.options.shaded.groupId=l.id))),l=e)),this._convertYcoordinates(a[o[t]],e);var u={};for(t=0;t<o.length;t++)if("line"===(e=this.groups[o[t]]).options.style&&1==e.options.shaded.enabled){var h=a[o[t]];if(null==h||0==h.length)continue;if(u.hasOwnProperty(o[t])||(u[o[t]]=m.calcPath(h,e)),"group"===e.options.shaded.orientation){var c=e.options.shaded.groupId;if(-1===o.indexOf(c)){console.log(e.id+": Unknown shading group target given:"+c);continue}u.hasOwnProperty(c)||(u[c]=m.calcPath(a[c],this.groups[c])),m.drawShading(u[o[t]],e,u[c],this.framework)}else m.drawShading(u[o[t]],e,void 0,this.framework)}for(f.draw(o,a,this.framework),t=0;t<o.length;t++)if(e=this.groups[o[t]],a[o[t]].length>0)switch(e.options.style){case"line":u.hasOwnProperty(o[t])||(u[o[t]]=m.calcPath(a[o[t]],e)),m.draw(u[o[t]],e,this.framework);case"point":case"points":"point"!=e.options.style&&"points"!=e.options.style&&1!=e.options.drawPoints.enabled||v.draw(a[o[t]],e,this.framework)}}}return s.cleanupElements(this.svgElements),!1},g.prototype._stack=function(e,t){var i,r,n,o,a;i=0;for(var s=0;s<e.length;s++){o=void 0,a=void 0;for(var l=i;l<t.length;l++){if(t[l].x===e[s].x){o=t[l],a=t[l],i=l;break}if(t[l].x>e[s].x){a=t[l],o=0==l?a:t[l-1],i=l;break}}void 0===a&&(o=t[t.length-1],a=t[t.length-1]),r=a.x-o.x,n=a.y-o.y,e[s].y=0==r?e[s].orginalY+a.y:e[s].orginalY+n/r*(e[s].x-o.x)+o.y}},g.prototype._getRelevantData=function(e,t,i,r){var n,o,s,l;if(e.length>0)for(o=0;o<e.length;o++){var u=(n=this.groups[e[o]]).getItems();if(1==n.options.sort){var h=function(e,t){return e.getTime()==t.getTime()?0:e<t?-1:1},c=Math.max(0,a.binarySearchValue(u,i,"x","before",h)),d=Math.min(u.length,a.binarySearchValue(u,r,"x","after",h)+1);d<=0&&(d=u.length);var p=new Array(d-c);for(s=c;s<d;s++)l=n.itemsData[s],p[s-c]=l;t[e[o]]=p}else t[e[o]]=n.itemsData}},g.prototype._applySampling=function(e,t){if(e.length>0)for(var i=0;i<e.length;i++)if(1==this.groups[e[i]].options.sampling){var r=t[e[i]];if(r.length>0){var n,o=r.length,a=o/(this.body.util.toGlobalScreen(r[r.length-1].x)-this.body.util.toGlobalScreen(r[0].x));n=Math.min(Math.ceil(.2*o),Math.max(1,Math.round(a)));for(var s=new Array(o),l=0;l<o;l+=n){s[Math.round(l/n)]=r[l]}t[e[i]]=s.splice(0,Math.round(o/n))}}},g.prototype._getYRanges=function(e,t,i){var r,n,o,a,s=[],l=[];if(e.length>0){for(o=0;o<e.length;o++)r=t[e[o]],a=this.groups[e[o]].options,r.length>0&&(n=this.groups[e[o]],!0===a.stack&&"bar"===a.style?"left"===a.yAxisOrientation?s=s.concat(r):l=l.concat(r):i[e[o]]=n.getYRange(r,e[o]));f.getStackedYRange(s,i,e,"__barStackLeft","left"),f.getStackedYRange(l,i,e,"__barStackRight","right")}},g.prototype._updateYAxis=function(e,t){var i,r,n=!1,o=!1,a=!1,s=1e9,l=1e9,u=-1e9,h=-1e9;if(e.length>0){for(var c=0;c<e.length;c++){var d=this.groups[e[c]];d&&"right"!=d.options.yAxisOrientation?(o=!0,s=1e9,u=-1e9):d&&d.options.yAxisOrientation&&(a=!0,l=1e9,h=-1e9)}for(c=0;c<e.length;c++)t.hasOwnProperty(e[c])&&!0!==t[e[c]].ignore&&(i=t[e[c]].min,r=t[e[c]].max,"right"!=t[e[c]].yAxisOrientation?(o=!0,s=s>i?i:s,u=u<r?r:u):(a=!0,l=l>i?i:l,h=h<r?r:h));1==o&&this.yAxisLeft.setRange(s,u),1==a&&this.yAxisRight.setRange(l,h)}n=this._toggleAxisVisiblity(o,this.yAxisLeft)||n,n=this._toggleAxisVisiblity(a,this.yAxisRight)||n,1==a&&1==o?(this.yAxisLeft.drawIcons=!0,this.yAxisRight.drawIcons=!0):(this.yAxisLeft.drawIcons=!1,this.yAxisRight.drawIcons=!1),this.yAxisRight.master=!o,this.yAxisRight.masterAxis=this.yAxisLeft,0==this.yAxisRight.master?(this.yAxisLeft.lineOffset=1==a?this.yAxisRight.width:0,n=this.yAxisLeft.redraw()||n,n=this.yAxisRight.redraw()||n):n=this.yAxisRight.redraw()||n;var p=["__barStackLeft","__barStackRight","__lineStackLeft","__lineStackRight"];for(c=0;c<p.length;c++)-1!=e.indexOf(p[c])&&e.splice(e.indexOf(p[c]),1);return n},g.prototype._toggleAxisVisiblity=function(e,t){var i=!1;return 0==e?t.dom.frame.parentNode&&0==t.hidden&&(t.hide(),i=!0):t.dom.frame.parentNode||1!=t.hidden||(t.show(),i=!0),i},g.prototype._convertXcoordinates=function(e){for(var t=this.body.util.toScreen,i=0;i<e.length;i++)e[i].screen_x=t(e[i].x)+this.props.width,e[i].screen_y=e[i].y,null!=e[i].end?e[i].screen_end=t(e[i].end)+this.props.width:e[i].screen_end=void 0},g.prototype._convertYcoordinates=function(e,t){var i=this.yAxisLeft,r=Number(this.svg.style.height.replace("px",""));"right"==t.options.yAxisOrientation&&(i=this.yAxisRight);for(var n=0;n<e.length;n++)e[n].screen_y=Math.round(i.convertValue(e[n].y));t.setZeroPosition(Math.min(r,i.convertValue(0)))},e.exports=g},function(e,t,i){var r,n=i(8),o=(r=n)&&r.__esModule?r:{default:r};var a=i(2),s=i(14),l=i(16),u=i(108);function h(e,t,i,r){this.id=a.randomUUID(),this.body=e,this.defaultOptions={orientation:"left",showMinorLabels:!0,showMajorLabels:!0,icons:!1,majorLinesOffset:7,minorLinesOffset:4,labelOffsetX:10,labelOffsetY:2,iconWidth:20,width:"40px",visible:!0,alignZeros:!0,left:{range:{min:void 0,max:void 0},format:function(e){return""+parseFloat(e.toPrecision(3))},title:{text:void 0,style:void 0}},right:{range:{min:void 0,max:void 0},format:function(e){return""+parseFloat(e.toPrecision(3))},title:{text:void 0,style:void 0}}},this.linegraphOptions=r,this.linegraphSVG=i,this.props={},this.DOMelements={lines:{},labels:{},title:{}},this.dom={},this.scale=void 0,this.range={start:0,end:0},this.options=a.extend({},this.defaultOptions),this.conversionFactor=1,this.setOptions(t),this.width=Number((""+this.options.width).replace("px","")),this.minWidth=this.width,this.height=this.linegraphSVG.getBoundingClientRect().height,this.hidden=!1,this.stepPixels=25,this.zeroCrossing=-1,this.amountOfSteps=-1,this.lineOffset=0,this.master=!0,this.masterAxis=null,this.svgElements={},this.iconsRemoved=!1,this.groups={},this.amountOfGroups=0,this._create(),this.framework={svg:this.svg,svgElements:this.svgElements,options:this.options,groups:this.groups};var n=this;this.body.emitter.on("verticalDrag",function(){n.dom.lineContainer.style.top=n.body.domProps.scrollTop+"px"})}h.prototype=new l,h.prototype.addGroup=function(e,t){this.groups.hasOwnProperty(e)||(this.groups[e]=t),this.amountOfGroups+=1},h.prototype.updateGroup=function(e,t){this.groups.hasOwnProperty(e)||(this.amountOfGroups+=1),this.groups[e]=t},h.prototype.removeGroup=function(e){this.groups.hasOwnProperty(e)&&(delete this.groups[e],this.amountOfGroups-=1)},h.prototype.setOptions=function(e){if(e){var t=!1;this.options.orientation!=e.orientation&&void 0!==e.orientation&&(t=!0);a.selectiveDeepExtend(["orientation","showMinorLabels","showMajorLabels","icons","majorLinesOffset","minorLinesOffset","labelOffsetX","labelOffsetY","iconWidth","width","visible","left","right","alignZeros"],this.options,e),this.minWidth=Number((""+this.options.width).replace("px","")),!0===t&&this.dom.frame&&(this.hide(),this.show())}},h.prototype._create=function(){this.dom.frame=document.createElement("div"),this.dom.frame.style.width=this.options.width,this.dom.frame.style.height=this.height,this.dom.lineContainer=document.createElement("div"),this.dom.lineContainer.style.width="100%",this.dom.lineContainer.style.height=this.height,this.dom.lineContainer.style.position="relative",this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.style.position="absolute",this.svg.style.top="0px",this.svg.style.height="100%",this.svg.style.width="100%",this.svg.style.display="block",this.dom.frame.appendChild(this.svg)},h.prototype._redrawGroupIcons=function(){var e;s.prepareElements(this.svgElements);var t=this.options.iconWidth,i=11.5;e="left"===this.options.orientation?4:this.width-t-4;var r=(0,o.default)(this.groups);r.sort(function(e,t){return e<t?-1:1});for(var n=0;n<r.length;n++){var a=r[n];!0!==this.groups[a].visible||void 0!==this.linegraphOptions.visibility[a]&&!0!==this.linegraphOptions.visibility[a]||(this.groups[a].getLegend(t,15,this.framework,e,i),i+=19)}s.cleanupElements(this.svgElements),this.iconsRemoved=!1},h.prototype._cleanupIcons=function(){!1===this.iconsRemoved&&(s.prepareElements(this.svgElements),s.cleanupElements(this.svgElements),this.iconsRemoved=!0)},h.prototype.show=function(){this.hidden=!1,this.dom.frame.parentNode||("left"===this.options.orientation?this.body.dom.left.appendChild(this.dom.frame):this.body.dom.right.appendChild(this.dom.frame)),this.dom.lineContainer.parentNode||this.body.dom.backgroundHorizontal.appendChild(this.dom.lineContainer)},h.prototype.hide=function(){this.hidden=!0,this.dom.frame.parentNode&&this.dom.frame.parentNode.removeChild(this.dom.frame),this.dom.lineContainer.parentNode&&this.dom.lineContainer.parentNode.removeChild(this.dom.lineContainer)},h.prototype.setRange=function(e,t){this.range.start=e,this.range.end=t},h.prototype.redraw=function(){var e=!1,t=0;for(var i in this.dom.lineContainer.style.top=this.body.domProps.scrollTop+"px",this.groups)this.groups.hasOwnProperty(i)&&(!0!==this.groups[i].visible||void 0!==this.linegraphOptions.visibility[i]&&!0!==this.linegraphOptions.visibility[i]||t++);if(0===this.amountOfGroups||0===t)this.hide();else{this.show(),this.height=Number(this.linegraphSVG.style.height.replace("px","")),this.dom.lineContainer.style.height=this.height+"px",this.width=!0===this.options.visible?Number((""+this.options.width).replace("px","")):0;var r=this.props,n=this.dom.frame;n.className="vis-data-axis",this._calculateCharSize();var o=this.options.orientation,a=this.options.showMinorLabels,s=this.options.showMajorLabels;r.minorLabelHeight=a?r.minorCharHeight:0,r.majorLabelHeight=s?r.majorCharHeight:0,r.minorLineWidth=this.body.dom.backgroundHorizontal.offsetWidth-this.lineOffset-this.width+2*this.options.minorLinesOffset,r.minorLineHeight=1,r.majorLineWidth=this.body.dom.backgroundHorizontal.offsetWidth-this.lineOffset-this.width+2*this.options.majorLinesOffset,r.majorLineHeight=1,"left"===o?(n.style.top="0",n.style.left="0",n.style.bottom="",n.style.width=this.width+"px",n.style.height=this.height+"px",this.props.width=this.body.domProps.left.width,this.props.height=this.body.domProps.left.height):(n.style.top="",n.style.bottom="0",n.style.left="0",n.style.width=this.width+"px",n.style.height=this.height+"px",this.props.width=this.body.domProps.right.width,this.props.height=this.body.domProps.right.height),e=this._redrawLabels(),e=this._isResized()||e,!0===this.options.icons?this._redrawGroupIcons():this._cleanupIcons(),this._redrawTitle(o)}return e},h.prototype._redrawLabels=function(){var e=this,t=!1;s.prepareElements(this.DOMelements.lines),s.prepareElements(this.DOMelements.labels);var i=this.options.orientation,r=null!=this.options[i].range?this.options[i].range:{},n=!0;null!=r.max&&(this.range.end=r.max,n=!1);var o=!0;null!=r.min&&(this.range.start=r.min,o=!1),this.scale=new u(this.range.start,this.range.end,o,n,this.dom.frame.offsetHeight,this.props.majorCharHeight,this.options.alignZeros,this.options[i].format),!1===this.master&&null!=this.masterAxis&&this.scale.followScale(this.masterAxis.scale),this.maxLabelSize=0,this.scale.getLines().forEach(function(t){var r=t.y,n=t.major;e.options.showMinorLabels&&!1===n&&e._redrawLabel(r-2,t.val,i,"vis-y-axis vis-minor",e.props.minorCharHeight),n&&r>=0&&e._redrawLabel(r-2,t.val,i,"vis-y-axis vis-major",e.props.majorCharHeight),!0===e.master&&(n?e._redrawLine(r,i,"vis-grid vis-horizontal vis-major",e.options.majorLinesOffset,e.props.majorLineWidth):e._redrawLine(r,i,"vis-grid vis-horizontal vis-minor",e.options.minorLinesOffset,e.props.minorLineWidth))});var a=0;void 0!==this.options[i].title&&void 0!==this.options[i].title.text&&(a=this.props.titleCharHeight);var l=!0===this.options.icons?Math.max(this.options.iconWidth,a)+this.options.labelOffsetX+15:a+this.options.labelOffsetX+15;return this.maxLabelSize>this.width-l&&!0===this.options.visible?(this.width=this.maxLabelSize+l,this.options.width=this.width+"px",s.cleanupElements(this.DOMelements.lines),s.cleanupElements(this.DOMelements.labels),this.redraw(),t=!0):this.maxLabelSize<this.width-l&&!0===this.options.visible&&this.width>this.minWidth?(this.width=Math.max(this.minWidth,this.maxLabelSize+l),this.options.width=this.width+"px",s.cleanupElements(this.DOMelements.lines),s.cleanupElements(this.DOMelements.labels),this.redraw(),t=!0):(s.cleanupElements(this.DOMelements.lines),s.cleanupElements(this.DOMelements.labels),t=!1),t},h.prototype.convertValue=function(e){return this.scale.convertValue(e)},h.prototype.screenToValue=function(e){return this.scale.screenToValue(e)},h.prototype._redrawLabel=function(e,t,i,r,n){var o=s.getDOMElement("div",this.DOMelements.labels,this.dom.frame);o.className=r,o.innerHTML=t,"left"===i?(o.style.left="-"+this.options.labelOffsetX+"px",o.style.textAlign="right"):(o.style.right="-"+this.options.labelOffsetX+"px",o.style.textAlign="left"),o.style.top=e-.5*n+this.options.labelOffsetY+"px",t+="";var a=Math.max(this.props.majorCharWidth,this.props.minorCharWidth);this.maxLabelSize<t.length*a&&(this.maxLabelSize=t.length*a)},h.prototype._redrawLine=function(e,t,i,r,n){if(!0===this.master){var o=s.getDOMElement("div",this.DOMelements.lines,this.dom.lineContainer);o.className=i,o.innerHTML="","left"===t?o.style.left=this.width-r+"px":o.style.right=this.width-r+"px",o.style.width=n+"px",o.style.top=e+"px"}},h.prototype._redrawTitle=function(e){if(s.prepareElements(this.DOMelements.title),void 0!==this.options[e].title&&void 0!==this.options[e].title.text){var t=s.getDOMElement("div",this.DOMelements.title,this.dom.frame);t.className="vis-y-axis vis-title vis-"+e,t.innerHTML=this.options[e].title.text,void 0!==this.options[e].title.style&&a.addCssText(t,this.options[e].title.style),"left"===e?t.style.left=this.props.titleCharHeight+"px":t.style.right=this.props.titleCharHeight+"px",t.style.width=this.height+"px"}s.cleanupElements(this.DOMelements.title)},h.prototype._calculateCharSize=function(){if(!("minorCharHeight"in this.props)){var e=document.createTextNode("0"),t=document.createElement("div");t.className="vis-y-axis vis-minor vis-measure",t.appendChild(e),this.dom.frame.appendChild(t),this.props.minorCharHeight=t.clientHeight,this.props.minorCharWidth=t.clientWidth,this.dom.frame.removeChild(t)}if(!("majorCharHeight"in this.props)){var i=document.createTextNode("0"),r=document.createElement("div");r.className="vis-y-axis vis-major vis-measure",r.appendChild(i),this.dom.frame.appendChild(r),this.props.majorCharHeight=r.clientHeight,this.props.majorCharWidth=r.clientWidth,this.dom.frame.removeChild(r)}if(!("titleCharHeight"in this.props)){var n=document.createTextNode("0"),o=document.createElement("div");o.className="vis-y-axis vis-title vis-measure",o.appendChild(n),this.dom.frame.appendChild(o),this.props.titleCharHeight=o.clientHeight,this.props.titleCharWidth=o.clientWidth,this.dom.frame.removeChild(o)}},e.exports=h},function(e,t,i){function r(e,t,i,r,n,o){var a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(this.majorSteps=[1,2,5,10],this.minorSteps=[.25,.5,1,2],this.customLines=null,this.containerHeight=n,this.majorCharHeight=o,this._start=e,this._end=t,this.scale=1,this.minorStepIdx=-1,this.magnitudefactor=1,this.determineScale(),this.zeroAlign=a,this.autoScaleStart=i,this.autoScaleEnd=r,this.formattingFunction=s,i||r){var l=this,u=function(e){var t=e-e%(l.magnitudefactor*l.minorSteps[l.minorStepIdx]);return e%(l.magnitudefactor*l.minorSteps[l.minorStepIdx])>l.magnitudefactor*l.minorSteps[l.minorStepIdx]*.5?t+l.magnitudefactor*l.minorSteps[l.minorStepIdx]:t};i&&(this._start-=2*this.magnitudefactor*this.minorSteps[this.minorStepIdx],this._start=u(this._start)),r&&(this._end+=this.magnitudefactor*this.minorSteps[this.minorStepIdx],this._end=u(this._end)),this.determineScale()}}r.prototype.setCharHeight=function(e){this.majorCharHeight=e},r.prototype.setHeight=function(e){this.containerHeight=e},r.prototype.determineScale=function(){var e=this._end-this._start;this.scale=this.containerHeight/e;var t=this.majorCharHeight/this.scale,i=e>0?Math.round(Math.log(e)/Math.LN10):0;this.minorStepIdx=-1,this.magnitudefactor=Math.pow(10,i);var r=0;i<0&&(r=i);for(var n=!1,o=r;Math.abs(o)<=Math.abs(i);o++){this.magnitudefactor=Math.pow(10,o);for(var a=0;a<this.minorSteps.length;a++){if(this.magnitudefactor*this.minorSteps[a]>=t){n=!0,this.minorStepIdx=a;break}}if(!0===n)break}},r.prototype.is_major=function(e){return e%(this.magnitudefactor*this.majorSteps[this.minorStepIdx])==0},r.prototype.getStep=function(){return this.magnitudefactor*this.minorSteps[this.minorStepIdx]},r.prototype.getFirstMajor=function(){var e=this.magnitudefactor*this.majorSteps[this.minorStepIdx];return this.convertValue(this._start+(e-this._start%e)%e)},r.prototype.formatValue=function(e){var t=e.toPrecision(5);return"function"==typeof this.formattingFunction&&(t=this.formattingFunction(e)),"number"==typeof t?""+t:"string"==typeof t?t:e.toPrecision(5)},r.prototype.getLines=function(){for(var e=[],t=this.getStep(),i=(t-this._start%t)%t,r=this._start+i;this._end-r>1e-5;r+=t)r!=this._start&&e.push({major:this.is_major(r),y:this.convertValue(r),val:this.formatValue(r)});return e},r.prototype.followScale=function(e){var t=this.minorStepIdx,i=this._start,r=this._end,n=this,o=function(){n.magnitudefactor*=2},a=function(){n.magnitudefactor/=2};e.minorStepIdx<=1&&this.minorStepIdx<=1||e.minorStepIdx>1&&this.minorStepIdx>1||(e.minorStepIdx<this.minorStepIdx?(this.minorStepIdx=1,2==t?o():(o(),o())):(this.minorStepIdx=2,1==t?a():(a(),a())));for(var s=e.convertValue(0),l=e.getStep()*e.scale,u=!1,h=0;!u&&h++<5;){this.scale=l/(this.minorSteps[this.minorStepIdx]*this.magnitudefactor);var c=this.containerHeight/this.scale;this._start=i,this._end=this._start+c;var d=this._end*this.scale,p=this.magnitudefactor*this.majorSteps[this.minorStepIdx],f=this.getFirstMajor()-e.getFirstMajor();if(this.zeroAlign){var m=s-d;this._end+=m/this.scale,this._start=this._end-c}else this.autoScaleStart?(this._start-=f/this.scale,this._end=this._start+c):(this._start+=p-f/this.scale,this._end=this._start+c);if(!this.autoScaleEnd&&this._end>r+1e-5)a(),u=!1;else{if(!this.autoScaleStart&&this._start<i-1e-5){if(!(this.zeroAlign&&i>=0)){a(),u=!1;continue}console.warn("Can't adhere to given 'min' range, due to zeroalign")}this.autoScaleStart&&this.autoScaleEnd&&c<r-i?(o(),u=!1):u=!0}}},r.prototype.convertValue=function(e){return this.containerHeight-(e-this._start)*this.scale},r.prototype.screenToValue=function(e){return(this.containerHeight-e)/this.scale+this._start},e.exports=r},function(e,t,i){var r,n=i(6),o=(r=n)&&r.__esModule?r:{default:r};var a=i(2),s=i(110),l=i(111),u=i(72);function h(e,t,i,r){this.id=t;this.options=a.selectiveBridgeObject(["sampling","style","sort","yAxisOrientation","barChart","drawPoints","shaded","interpolation","zIndex","excludeFromStacking","excludeFromLegend"],i),this.usingDefaultStyle=void 0===e.className,this.groupsUsingDefaultStyles=r,this.zeroPosition=0,this.update(e),1==this.usingDefaultStyle&&(this.groupsUsingDefaultStyles[0]+=1),this.itemsData=[],this.visible=void 0===e.visible||e.visible}h.prototype.setItems=function(e){null!=e?(this.itemsData=e,1==this.options.sort&&a.insertSort(this.itemsData,function(e,t){return e.x>t.x?1:-1})):this.itemsData=[]},h.prototype.getItems=function(){return this.itemsData},h.prototype.setZeroPosition=function(e){this.zeroPosition=e},h.prototype.setOptions=function(e){if(void 0!==e){a.selectiveDeepExtend(["sampling","style","sort","yAxisOrientation","barChart","zIndex","excludeFromStacking","excludeFromLegend"],this.options,e),"function"==typeof e.drawPoints&&(e.drawPoints={onRender:e.drawPoints}),a.mergeOptions(this.options,e,"interpolation"),a.mergeOptions(this.options,e,"drawPoints"),a.mergeOptions(this.options,e,"shaded"),e.interpolation&&"object"==(0,o.default)(e.interpolation)&&e.interpolation.parametrization&&("uniform"==e.interpolation.parametrization?this.options.interpolation.alpha=0:"chordal"==e.interpolation.parametrization?this.options.interpolation.alpha=1:(this.options.interpolation.parametrization="centripetal",this.options.interpolation.alpha=.5))}},h.prototype.update=function(e){this.group=e,this.content=e.content||"graph",this.className=e.className||this.className||"vis-graph-group"+this.groupsUsingDefaultStyles[0]%10,this.visible=void 0===e.visible||e.visible,this.style=e.style,this.setOptions(e.options)},h.prototype.getLegend=function(e,t,i,r,n){null!=i&&null!=i||(i={svg:document.createElementNS("http://www.w3.org/2000/svg","svg"),svgElements:{},options:this.options,groups:[this]});switch(null!=r&&null!=r||(r=0),null!=n&&null!=n||(n=.5*t),this.options.style){case"line":l.drawIcon(this,r,n,e,t,i);break;case"points":case"point":u.drawIcon(this,r,n,e,t,i);break;case"bar":s.drawIcon(this,r,n,e,t,i)}return{icon:i.svg,label:this.content,orientation:this.options.yAxisOrientation}},h.prototype.getYRange=function(e){for(var t=e[0].y,i=e[0].y,r=0;r<e.length;r++)t=t>e[r].y?e[r].y:t,i=i<e[r].y?e[r].y:i;return{min:t,max:i,yAxisOrientation:this.options.yAxisOrientation}},e.exports=h},function(e,t,i){var r=i(14),n=i(72);function o(e,t){}o.drawIcon=function(e,t,i,n,o,a){var s=.5*o,l=r.getSVGElement("rect",a.svgElements,a.svg);l.setAttributeNS(null,"x",t),l.setAttributeNS(null,"y",i-s),l.setAttributeNS(null,"width",n),l.setAttributeNS(null,"height",2*s),l.setAttributeNS(null,"class","vis-outline");var u=Math.round(.3*n),h=e.options.barChart.width/u,c=Math.round(.4*o),d=Math.round(.75*o),p=Math.round((n-2*u)/3);if(r.drawBar(t+.5*u+p,i+s-c-1,u,c,e.className+" vis-bar",a.svgElements,a.svg,e.style),r.drawBar(t+1.5*u+p+2,i+s-d-1,u,d,e.className+" vis-bar",a.svgElements,a.svg,e.style),1==e.options.drawPoints.enabled){var f={style:e.options.drawPoints.style,styles:e.options.drawPoints.styles,size:e.options.drawPoints.size/h,className:e.className};r.drawPoint(t+.5*u+p,i+s-c-1,f,a.svgElements,a.svg),r.drawPoint(t+1.5*u+p+2,i+s-d-1,f,a.svgElements,a.svg)}},o.draw=function(e,t,i){var a,s,l,u,h,c,d=[],p={},f=0;for(h=0;h<e.length;h++)if("bar"===(u=i.groups[e[h]]).options.style&&!0===u.visible&&(void 0===i.options.groups.visibility[e[h]]||!0===i.options.groups.visibility[e[h]]))for(c=0;c<t[e[h]].length;c++)d.push({screen_x:t[e[h]][c].screen_x,screen_end:t[e[h]][c].screen_end,screen_y:t[e[h]][c].screen_y,x:t[e[h]][c].x,end:t[e[h]][c].end,y:t[e[h]][c].y,groupId:e[h],label:t[e[h]][c].label}),f+=1;if(0!==f)for(d.sort(function(e,t){return e.screen_x===t.screen_x?e.groupId<t.groupId?-1:1:e.screen_x-t.screen_x}),o._getDataIntersections(p,d),h=0;h<d.length;h++){var m=null!=(u=i.groups[d[h].groupId]).options.barChart.minWidth?u.options.barChart.minWidth:.1*u.options.barChart.width,v=0;if(void 0===p[s=d[h].screen_x])h+1<d.length&&(a=Math.abs(d[h+1].screen_x-s)),l=o._getSafeDrawData(a,u,m);else{var g=h+(p[s].amount-p[s].resolved);g<d.length&&(a=Math.abs(d[g].screen_x-s)),l=o._getSafeDrawData(a,u,m),p[s].resolved+=1,!0===u.options.stack&&!0!==u.options.excludeFromStacking?d[h].screen_y<u.zeroPosition?(v=p[s].accumulatedNegative,p[s].accumulatedNegative+=u.zeroPosition-d[h].screen_y):(v=p[s].accumulatedPositive,p[s].accumulatedPositive+=u.zeroPosition-d[h].screen_y):!0===u.options.barChart.sideBySide&&(l.width=l.width/p[s].amount,l.offset+=p[s].resolved*l.width-.5*l.width*(p[s].amount+1))}var y=l.width,_=d[h].screen_x;if(null!=d[h].screen_end?_+=.5*(y=d[h].screen_end-d[h].screen_x):_+=l.offset,r.drawBar(_,d[h].screen_y-v,y,u.zeroPosition-d[h].screen_y,u.className+" vis-bar",i.svgElements,i.svg,u.style),!0===u.options.drawPoints.enabled){var b={screen_x:d[h].screen_x,screen_y:d[h].screen_y-v,x:d[h].x,y:d[h].y,groupId:d[h].groupId,label:d[h].label};n.draw([b],u,i,l.offset)}}},o._getDataIntersections=function(e,t){for(var i,r=0;r<t.length;r++)r+1<t.length&&(i=Math.abs(t[r+1].screen_x-t[r].screen_x)),r>0&&(i=Math.min(i,Math.abs(t[r-1].screen_x-t[r].screen_x))),0===i&&(void 0===e[t[r].screen_x]&&(e[t[r].screen_x]={amount:0,resolved:0,accumulatedPositive:0,accumulatedNegative:0}),e[t[r].screen_x].amount+=1)},o._getSafeDrawData=function(e,t,i){var r,n;return e<t.options.barChart.width&&e>0?(r=e<i?i:e,n=0,"left"===t.options.barChart.align?n-=.5*e:"right"===t.options.barChart.align&&(n+=.5*e)):(r=t.options.barChart.width,n=0,"left"===t.options.barChart.align?n-=.5*t.options.barChart.width:"right"===t.options.barChart.align&&(n+=.5*t.options.barChart.width)),{width:r,offset:n}},o.getStackedYRange=function(e,t,i,r,n){if(e.length>0){e.sort(function(e,t){return e.screen_x===t.screen_x?e.groupId<t.groupId?-1:1:e.screen_x-t.screen_x});var a={};o._getDataIntersections(a,e),t[r]=o._getStackedYRange(a,e),t[r].yAxisOrientation=n,i.push(r)}},o._getStackedYRange=function(e,t){for(var i,r=t[0].screen_y,n=t[0].screen_y,o=0;o<t.length;o++)void 0===e[i=t[o].screen_x]?(r=r>t[o].screen_y?t[o].screen_y:r,n=n<t[o].screen_y?t[o].screen_y:n):t[o].screen_y<0?e[i].accumulatedNegative+=t[o].screen_y:e[i].accumulatedPositive+=t[o].screen_y;for(var a in e)e.hasOwnProperty(a)&&(r=(r=r>e[a].accumulatedNegative?e[a].accumulatedNegative:r)>e[a].accumulatedPositive?e[a].accumulatedPositive:r,n=(n=n<e[a].accumulatedNegative?e[a].accumulatedNegative:n)<e[a].accumulatedPositive?e[a].accumulatedPositive:n);return{min:r,max:n}},e.exports=o},function(e,t,i){var r=i(14);function n(e,t){}n.calcPath=function(e,t){if(null!=e&&e.length>0){return 1==t.options.interpolation.enabled?n._catmullRom(e,t):n._linear(e)}},n.drawIcon=function(e,t,i,n,o,a){var s,l,u=.5*o,h=r.getSVGElement("rect",a.svgElements,a.svg);if(h.setAttributeNS(null,"x",t),h.setAttributeNS(null,"y",i-u),h.setAttributeNS(null,"width",n),h.setAttributeNS(null,"height",2*u),h.setAttributeNS(null,"class","vis-outline"),(s=r.getSVGElement("path",a.svgElements,a.svg)).setAttributeNS(null,"class",e.className),void 0!==e.style&&s.setAttributeNS(null,"style",e.style),s.setAttributeNS(null,"d","M"+t+","+i+" L"+(t+n)+","+i),1==e.options.shaded.enabled&&(l=r.getSVGElement("path",a.svgElements,a.svg),"top"==e.options.shaded.orientation?l.setAttributeNS(null,"d","M"+t+", "+(i-u)+"L"+t+","+i+" L"+(t+n)+","+i+" L"+(t+n)+","+(i-u)):l.setAttributeNS(null,"d","M"+t+","+i+" L"+t+","+(i+u)+" L"+(t+n)+","+(i+u)+"L"+(t+n)+","+i),l.setAttributeNS(null,"class",e.className+" vis-icon-fill"),void 0!==e.options.shaded.style&&""!==e.options.shaded.style&&l.setAttributeNS(null,"style",e.options.shaded.style)),1==e.options.drawPoints.enabled){var c={style:e.options.drawPoints.style,styles:e.options.drawPoints.styles,size:e.options.drawPoints.size,className:e.className};r.drawPoint(t+.5*n,i,c,a.svgElements,a.svg)}},n.drawShading=function(e,t,i,n){if(1==t.options.shaded.enabled){var o,a=Number(n.svg.style.height.replace("px","")),s=r.getSVGElement("path",n.svgElements,n.svg),l="L";1==t.options.interpolation.enabled&&(l="C");var u=0;u="top"==t.options.shaded.orientation?0:"bottom"==t.options.shaded.orientation?a:Math.min(Math.max(0,t.zeroPosition),a),o="group"==t.options.shaded.orientation&&null!=i&&null!=i?"M"+e[0][0]+","+e[0][1]+" "+this.serializePath(e,l,!1)+" L"+i[i.length-1][0]+","+i[i.length-1][1]+" "+this.serializePath(i,l,!0)+i[0][0]+","+i[0][1]+" Z":"M"+e[0][0]+","+e[0][1]+" "+this.serializePath(e,l,!1)+" V"+u+" H"+e[0][0]+" Z",s.setAttributeNS(null,"class",t.className+" vis-fill"),void 0!==t.options.shaded.style&&s.setAttributeNS(null,"style",t.options.shaded.style),s.setAttributeNS(null,"d",o)}},n.draw=function(e,t,i){if(null!=e&&null!=e){var n=r.getSVGElement("path",i.svgElements,i.svg);n.setAttributeNS(null,"class",t.className),void 0!==t.style&&n.setAttributeNS(null,"style",t.style);var o="L";1==t.options.interpolation.enabled&&(o="C"),n.setAttributeNS(null,"d","M"+e[0][0]+","+e[0][1]+" "+this.serializePath(e,o,!1))}},n.serializePath=function(e,t,i){if(e.length<2)return"";var r,n=t;if(i)for(r=e.length-2;r>0;r--)n+=e[r][0]+","+e[r][1]+" ";else for(r=1;r<e.length;r++)n+=e[r][0]+","+e[r][1]+" ";return n},n._catmullRomUniform=function(e){var t,i,r,n,o,a,s=[];s.push([Math.round(e[0].screen_x),Math.round(e[0].screen_y)]);for(var l=e.length,u=0;u<l-1;u++)t=0==u?e[0]:e[u-1],i=e[u],r=e[u+1],n=u+2<l?e[u+2]:r,o={screen_x:(-t.screen_x+6*i.screen_x+r.screen_x)*(1/6),screen_y:(-t.screen_y+6*i.screen_y+r.screen_y)*(1/6)},a={screen_x:(i.screen_x+6*r.screen_x-n.screen_x)*(1/6),screen_y:(i.screen_y+6*r.screen_y-n.screen_y)*(1/6)},s.push([o.screen_x,o.screen_y]),s.push([a.screen_x,a.screen_y]),s.push([r.screen_x,r.screen_y]);return s},n._catmullRom=function(e,t){var i=t.options.interpolation.alpha;if(0==i||void 0===i)return this._catmullRomUniform(e);var r,n,o,a,s,l,u,h,c,d,p,f,m,v,g,y,_,b,x,w=[];w.push([Math.round(e[0].screen_x),Math.round(e[0].screen_y)]);for(var S=e.length,M=0;M<S-1;M++)r=0==M?e[0]:e[M-1],n=e[M],o=e[M+1],a=M+2<S?e[M+2]:o,u=Math.sqrt(Math.pow(r.screen_x-n.screen_x,2)+Math.pow(r.screen_y-n.screen_y,2)),h=Math.sqrt(Math.pow(n.screen_x-o.screen_x,2)+Math.pow(n.screen_y-o.screen_y,2)),c=Math.sqrt(Math.pow(o.screen_x-a.screen_x,2)+Math.pow(o.screen_y-a.screen_y,2)),v=Math.pow(c,i),y=Math.pow(c,2*i),g=Math.pow(h,i),_=Math.pow(h,2*i),x=Math.pow(u,i),d=2*(b=Math.pow(u,2*i))+3*x*g+_,p=2*y+3*v*g+_,(f=3*x*(x+g))>0&&(f=1/f),(m=3*v*(v+g))>0&&(m=1/m),s={screen_x:(-_*r.screen_x+d*n.screen_x+b*o.screen_x)*f,screen_y:(-_*r.screen_y+d*n.screen_y+b*o.screen_y)*f},l={screen_x:(y*n.screen_x+p*o.screen_x-_*a.screen_x)*m,screen_y:(y*n.screen_y+p*o.screen_y-_*a.screen_y)*m},0==s.screen_x&&0==s.screen_y&&(s=n),0==l.screen_x&&0==l.screen_y&&(l=o),w.push([s.screen_x,s.screen_y]),w.push([l.screen_x,l.screen_y]),w.push([o.screen_x,o.screen_y]);return w},n._linear=function(e){for(var t=[],i=0;i<e.length;i++)t.push([e[i].screen_x,e[i].screen_y]);return t},e.exports=n},function(e,t,i){var r,n=i(8),o=(r=n)&&r.__esModule?r:{default:r};var a=i(2),s=i(14),l=i(16);function u(e,t,i,r){this.body=e,this.defaultOptions={enabled:!1,icons:!0,iconSize:20,iconSpacing:6,left:{visible:!0,position:"top-left"},right:{visible:!0,position:"top-right"}},this.side=i,this.options=a.extend({},this.defaultOptions),this.linegraphOptions=r,this.svgElements={},this.dom={},this.groups={},this.amountOfGroups=0,this._create(),this.framework={svg:this.svg,svgElements:this.svgElements,options:this.options,groups:this.groups},this.setOptions(t)}u.prototype=new l,u.prototype.clear=function(){this.groups={},this.amountOfGroups=0},u.prototype.addGroup=function(e,t){1!=t.options.excludeFromLegend&&(this.groups.hasOwnProperty(e)||(this.groups[e]=t),this.amountOfGroups+=1)},u.prototype.updateGroup=function(e,t){this.groups[e]=t},u.prototype.removeGroup=function(e){this.groups.hasOwnProperty(e)&&(delete this.groups[e],this.amountOfGroups-=1)},u.prototype._create=function(){this.dom.frame=document.createElement("div"),this.dom.frame.className="vis-legend",this.dom.frame.style.position="absolute",this.dom.frame.style.top="10px",this.dom.frame.style.display="block",this.dom.textArea=document.createElement("div"),this.dom.textArea.className="vis-legend-text",this.dom.textArea.style.position="relative",this.dom.textArea.style.top="0px",this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.style.position="absolute",this.svg.style.top="0px",this.svg.style.width=this.options.iconSize+5+"px",this.svg.style.height="100%",this.dom.frame.appendChild(this.svg),this.dom.frame.appendChild(this.dom.textArea)},u.prototype.hide=function(){this.dom.frame.parentNode&&this.dom.frame.parentNode.removeChild(this.dom.frame)},u.prototype.show=function(){this.dom.frame.parentNode||this.body.dom.center.appendChild(this.dom.frame)},u.prototype.setOptions=function(e){a.selectiveDeepExtend(["enabled","orientation","icons","left","right"],this.options,e)},u.prototype.redraw=function(){var e=0,t=(0,o.default)(this.groups);t.sort(function(e,t){return e<t?-1:1});for(var i=0;i<t.length;i++){var r=t[i];1!=this.groups[r].visible||void 0!==this.linegraphOptions.visibility[r]&&1!=this.linegraphOptions.visibility[r]||e++}if(0==this.options[this.side].visible||0==this.amountOfGroups||0==this.options.enabled||0==e)this.hide();else{if(this.show(),"top-left"==this.options[this.side].position||"bottom-left"==this.options[this.side].position?(this.dom.frame.style.left="4px",this.dom.frame.style.textAlign="left",this.dom.textArea.style.textAlign="left",this.dom.textArea.style.left=this.options.iconSize+15+"px",this.dom.textArea.style.right="",this.svg.style.left="0px",this.svg.style.right=""):(this.dom.frame.style.right="4px",this.dom.frame.style.textAlign="right",this.dom.textArea.style.textAlign="right",this.dom.textArea.style.right=this.options.iconSize+15+"px",this.dom.textArea.style.left="",this.svg.style.right="0px",this.svg.style.left=""),"top-left"==this.options[this.side].position||"top-right"==this.options[this.side].position)this.dom.frame.style.top=4-Number(this.body.dom.center.style.top.replace("px",""))+"px",this.dom.frame.style.bottom="";else{var n=this.body.domProps.center.height-this.body.domProps.centerContainer.height;this.dom.frame.style.bottom=4+n+Number(this.body.dom.center.style.top.replace("px",""))+"px",this.dom.frame.style.top=""}0==this.options.icons?(this.dom.frame.style.width=this.dom.textArea.offsetWidth+10+"px",this.dom.textArea.style.right="",this.dom.textArea.style.left="",this.svg.style.width="0px"):(this.dom.frame.style.width=this.options.iconSize+15+this.dom.textArea.offsetWidth+10+"px",this.drawLegendIcons());var a="";for(i=0;i<t.length;i++)r=t[i],1!=this.groups[r].visible||void 0!==this.linegraphOptions.visibility[r]&&1!=this.linegraphOptions.visibility[r]||(a+=this.groups[r].content+"<br />");this.dom.textArea.innerHTML=a,this.dom.textArea.style.lineHeight=.75*this.options.iconSize+this.options.iconSpacing+"px"}},u.prototype.drawLegendIcons=function(){if(this.dom.frame.parentNode){var e=(0,o.default)(this.groups);e.sort(function(e,t){return e<t?-1:1}),s.resetElements(this.svgElements);var t=window.getComputedStyle(this.dom.frame).paddingTop,i=Number(t.replace("px","")),r=i,n=this.options.iconSize,a=.75*this.options.iconSize,l=i+.5*a+3;this.svg.style.width=n+5+i+"px";for(var u=0;u<e.length;u++){var h=e[u];1!=this.groups[h].visible||void 0!==this.linegraphOptions.visibility[h]&&1!=this.linegraphOptions.visibility[h]||(this.groups[h].getLegend(n,a,this.framework,r,l),l+=a+this.options.iconSpacing)}}},e.exports=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r="string",n="boolean",o="number",a="object",s={configure:{enabled:{boolean:n},filter:{boolean:n,function:"function"},container:{dom:"dom"},__type__:{object:a,boolean:n,function:"function"}},yAxisOrientation:{string:["left","right"]},defaultGroup:{string:r},sort:{boolean:n},sampling:{boolean:n},stack:{boolean:n},graphHeight:{string:r,number:o},shaded:{enabled:{boolean:n},orientation:{string:["bottom","top","zero","group"]},groupId:{object:a},__type__:{boolean:n,object:a}},style:{string:["line","bar","points"]},barChart:{width:{number:o},minWidth:{number:o},sideBySide:{boolean:n},align:{string:["left","center","right"]},__type__:{object:a}},interpolation:{enabled:{boolean:n},parametrization:{string:["centripetal","chordal","uniform"]},alpha:{number:o},__type__:{object:a,boolean:n}},drawPoints:{enabled:{boolean:n},onRender:{function:"function"},size:{number:o},style:{string:["square","circle"]},__type__:{object:a,boolean:n,function:"function"}},dataAxis:{showMinorLabels:{boolean:n},showMajorLabels:{boolean:n},icons:{boolean:n},width:{string:r,number:o},visible:{boolean:n},alignZeros:{boolean:n},left:{range:{min:{number:o,undefined:"undefined"},max:{number:o,undefined:"undefined"},__type__:{object:a}},format:{function:"function"},title:{text:{string:r,number:o,undefined:"undefined"},style:{string:r,undefined:"undefined"},__type__:{object:a}},__type__:{object:a}},right:{range:{min:{number:o,undefined:"undefined"},max:{number:o,undefined:"undefined"},__type__:{object:a}},format:{function:"function"},title:{text:{string:r,number:o,undefined:"undefined"},style:{string:r,undefined:"undefined"},__type__:{object:a}},__type__:{object:a}},__type__:{object:a}},legend:{enabled:{boolean:n},icons:{boolean:n},left:{visible:{boolean:n},position:{string:["top-right","bottom-right","top-left","bottom-left"]},__type__:{object:a}},right:{visible:{boolean:n},position:{string:["top-right","bottom-right","top-left","bottom-left"]},__type__:{object:a}},__type__:{object:a,boolean:n}},groups:{visibility:{any:"any"},__type__:{object:a}},autoResize:{boolean:n},throttleRedraw:{number:o},clickToUse:{boolean:n},end:{number:o,date:"date",string:r,moment:"moment"},format:{minorLabels:{millisecond:{string:r,undefined:"undefined"},second:{string:r,undefined:"undefined"},minute:{string:r,undefined:"undefined"},hour:{string:r,undefined:"undefined"},weekday:{string:r,undefined:"undefined"},day:{string:r,undefined:"undefined"},month:{string:r,undefined:"undefined"},year:{string:r,undefined:"undefined"},__type__:{object:a}},majorLabels:{millisecond:{string:r,undefined:"undefined"},second:{string:r,undefined:"undefined"},minute:{string:r,undefined:"undefined"},hour:{string:r,undefined:"undefined"},weekday:{string:r,undefined:"undefined"},day:{string:r,undefined:"undefined"},month:{string:r,undefined:"undefined"},year:{string:r,undefined:"undefined"},__type__:{object:a}},__type__:{object:a}},moment:{function:"function"},height:{string:r,number:o},hiddenDates:{start:{date:"date",number:o,string:r,moment:"moment"},end:{date:"date",number:o,string:r,moment:"moment"},repeat:{string:r},__type__:{object:a,array:"array"}},locale:{string:r},locales:{__any__:{any:"any"},__type__:{object:a}},max:{date:"date",number:o,string:r,moment:"moment"},maxHeight:{number:o,string:r},maxMinorChars:{number:o},min:{date:"date",number:o,string:r,moment:"moment"},minHeight:{number:o,string:r},moveable:{boolean:n},multiselect:{boolean:n},orientation:{string:r},showCurrentTime:{boolean:n},showMajorLabels:{boolean:n},showMinorLabels:{boolean:n},start:{date:"date",number:o,string:r,moment:"moment"},timeAxis:{scale:{string:r,undefined:"undefined"},step:{number:o,undefined:"undefined"},__type__:{object:a}},width:{string:r,number:o},zoomable:{boolean:n},zoomKey:{string:["ctrlKey","altKey","metaKey",""]},zoomMax:{number:o},zoomMin:{number:o},zIndex:{number:o},__type__:{object:a}};t.allOptions=s,t.configureOptions={global:{sort:!0,sampling:!0,stack:!1,shaded:{enabled:!1,orientation:["zero","top","bottom","group"]},style:["line","bar","points"],barChart:{width:[50,5,100,5],minWidth:[50,5,100,5],sideBySide:!1,align:["left","center","right"]},interpolation:{enabled:!0,parametrization:["centripetal","chordal","uniform"]},drawPoints:{enabled:!0,size:[6,2,30,1],style:["square","circle"]},dataAxis:{showMinorLabels:!0,showMajorLabels:!0,icons:!1,width:[40,0,200,1],visible:!0,alignZeros:!0,left:{title:{text:"",style:""}},right:{title:{text:"",style:""}}},legend:{enabled:!1,icons:!0,left:{visible:!0,position:["top-right","bottom-right","top-left","bottom-left"]},right:{visible:!0,position:["top-right","bottom-right","top-left","bottom-left"]}},autoResize:!0,clickToUse:!1,end:"",format:{minorLabels:{millisecond:"SSS",second:"s",minute:"HH:mm",hour:"HH:mm",weekday:"ddd D",day:"D",month:"MMM",year:"YYYY"},majorLabels:{millisecond:"HH:mm:ss",second:"D MMMM HH:mm",minute:"ddd D MMMM",hour:"ddd D MMMM",weekday:"MMMM YYYY",day:"MMMM YYYY",month:"YYYY",year:""}},height:"",locale:"",max:"",maxHeight:"",maxMinorChars:[7,0,20,1],min:"",minHeight:"",moveable:!0,orientation:["both","bottom","top"],showCurrentTime:!1,showMajorLabels:!0,showMinorLabels:!0,start:"",width:"100%",zoomable:!0,zoomKey:["ctrlKey","altKey","metaKey",""],zoomMax:[31536e10,10,31536e10,1],zoomMin:[10,10,31536e10,1],zIndex:0}}},function(e,t,i){var r,n=i(29),o=(r=n)&&r.__esModule?r:{default:r};function a(e){return c=e,function(){var e={};d=0,p=c.charAt(0),T(),"strict"===f&&(e.strict=!0,T());"graph"!==f&&"digraph"!==f||(e.type=f,T());m===u.IDENTIFIER&&(e.id=f,T());if("{"!=f)throw k("Angle bracket { expected");if(T(),A(e),"}"!=f)throw k("Angle bracket } expected");if(T(),""!==f)throw k("End of file expected");return T(),delete e.node,delete e.edge,delete e.graph,e}()}var s={fontsize:"font.size",fontcolor:"font.color",labelfontcolor:"font.color",fontname:"font.face",color:["color.border","color.background"],fillcolor:"color.background",tooltip:"title",labeltooltip:"title"},l=(0,o.default)(s);l.color="color.color",l.style="dashes";var u={NULL:0,DELIMITER:1,IDENTIFIER:2,UNKNOWN:3},h={"{":!0,"}":!0,"[":!0,"]":!0,";":!0,"=":!0,",":!0,"->":!0,"--":!0},c="",d=0,p="",f="",m=u.NULL;function v(){d++,p=c.charAt(d)}function g(){return c.charAt(d+1)}var y=/[a-zA-Z_0-9.:#]/;function _(e){return y.test(e)}function b(e,t){if(e||(e={}),t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function x(e,t,i){for(var r=t.split("."),n=e;r.length;){var o=r.shift();r.length?(n[o]||(n[o]={}),n=n[o]):n[o]=i}}function w(e,t){for(var i,r,n=null,o=[e],a=e;a.parent;)o.push(a.parent),a=a.parent;if(a.nodes)for(i=0,r=a.nodes.length;i<r;i++)if(t.id===a.nodes[i].id){n=a.nodes[i];break}for(n||(n={id:t.id},e.node&&(n.attr=b(n.attr,e.node))),i=o.length-1;i>=0;i--){var s=o[i];s.nodes||(s.nodes=[]),-1===s.nodes.indexOf(n)&&s.nodes.push(n)}t.attr&&(n.attr=b(n.attr,t.attr))}function S(e,t){if(e.edges||(e.edges=[]),e.edges.push(t),e.edge){var i=b({},e.edge);t.attr=b(i,t.attr)}}function M(e,t,i,r,n){var o={from:t,to:i,type:r};return e.edge&&(o.attr=b({},e.edge)),o.attr=b(o.attr||{},n),o}function T(){for(m=u.NULL,f="";" "===p||"\t"===p||"\n"===p||"\r"===p;)v();do{var e=!1;if("#"===p){for(var t=d-1;" "===c.charAt(t)||"\t"===c.charAt(t);)t--;if("\n"===c.charAt(t)||""===c.charAt(t)){for(;""!=p&&"\n"!=p;)v();e=!0}}if("/"===p&&"/"===g()){for(;""!=p&&"\n"!=p;)v();e=!0}if("/"===p&&"*"===g()){for(;""!=p;){if("*"===p&&"/"===g()){v(),v();break}v()}e=!0}for(;" "===p||"\t"===p||"\n"===p||"\r"===p;)v()}while(e);if(""!==p){var i=p+g();if(h[i])return m=u.DELIMITER,f=i,v(),void v();if(h[p])return m=u.DELIMITER,f=p,void v();if(_(p)||"-"===p){for(f+=p,v();_(p);)f+=p,v();return"false"===f?f=!1:"true"===f?f=!0:isNaN(Number(f))||(f=Number(f)),void(m=u.IDENTIFIER)}if('"'===p){for(v();""!=p&&('"'!=p||'"'===p&&'"'===g());)'"'===p?(f+=p,v()):"\\"===p&&"n"===g()?(f+="\n",v()):f+=p,v();if('"'!=p)throw k('End of string " expected');return v(),void(m=u.IDENTIFIER)}for(m=u.UNKNOWN;""!=p;)f+=p,v();throw new SyntaxError('Syntax error in part "'+E(f,30)+'"')}m=u.DELIMITER}function A(e){for(;""!==f&&"}"!=f;)C(e),";"===f&&T()}function C(e){var t=L(e);if(t)N(e,t);else if(!function(e){if("node"===f)return T(),e.node=P(),"node";if("edge"===f)return T(),e.edge=P(),"edge";if("graph"===f)return T(),e.graph=P(),"graph";return null}(e)){if(m!=u.IDENTIFIER)throw k("Identifier expected");var i=f;if(T(),"="===f){if(T(),m!=u.IDENTIFIER)throw k("Identifier expected");e[i]=f,T()}else!function(e,t){var i={id:t},r=P();r&&(i.attr=r);w(e,i),N(e,t)}(e,i)}}function L(e){var t=null;if("subgraph"===f&&((t={}).type="subgraph",T(),m===u.IDENTIFIER&&(t.id=f,T())),"{"===f){if(T(),t||(t={}),t.parent=e,t.node=e.node,t.edge=e.edge,t.graph=e.graph,A(t),"}"!=f)throw k("Angle bracket } expected");T(),delete t.node,delete t.edge,delete t.graph,delete t.parent,e.subgraphs||(e.subgraphs=[]),e.subgraphs.push(t)}return t}function N(e,t){for(;"->"===f||"--"===f;){var i,r=f;T();var n=L(e);if(n)i=n;else{if(m!=u.IDENTIFIER)throw k("Identifier or subgraph expected");w(e,{id:i=f}),T()}S(e,M(e,t,i,r,P())),t=i}}function P(){for(var e=null,t={dashed:!0,solid:!1,dotted:[1,5]};"["===f;){for(T(),e={};""!==f&&"]"!=f;){if(m!=u.IDENTIFIER)throw k("Attribute name expected");var i=f;if(T(),"="!=f)throw k("Equal sign = expected");if(T(),m!=u.IDENTIFIER)throw k("Attribute value expected");var r=f;"style"===i&&(r=t[r]),x(e,i,r),T(),","==f&&T()}if("]"!=f)throw k("Bracket ] expected");T()}return e}function k(e){return new SyntaxError(e+', got "'+E(f,30)+'" (char '+d+")")}function E(e,t){return e.length<=t?e:e.substr(0,27)+"..."}function D(e,t,i){for(var r=t.split("."),n=r.pop(),o=e,a=0;a<r.length;a++){var s=r[a];s in o||(o[s]={}),o=o[s]}return o[n]=i,e}function O(e,t){var i={};for(var r in e)if(e.hasOwnProperty(r)){var n=t[r];Array.isArray(n)?n.forEach(function(t){D(i,t,e[r])}):D(i,"string"==typeof n?n:r,e[r])}return i}t.parseDOT=a,t.DOTToGraph=function(e){var t=a(e),i={nodes:[],edges:[],options:{}};if(t.nodes&&t.nodes.forEach(function(e){var t={id:e.id,label:String(e.label||e.id)};b(t,O(e.attr,s)),t.image&&(t.shape="image"),i.nodes.push(t)}),t.edges){var r=function(e){var t={from:e.from,to:e.to};return b(t,O(e.attr,l)),t.arrows="->"===e.type?"to":void 0,t};t.edges.forEach(function(e){var t,n,o,a,s;t=e.from instanceof Object?e.from.nodes:{id:e.from},n=e.to instanceof Object?e.to.nodes:{id:e.to},e.from instanceof Object&&e.from.edges&&e.from.edges.forEach(function(e){var t=r(e);i.edges.push(t)}),o=t,a=n,s=function(t,n){var o=M(i,t.id,n.id,e.type,e.attr),a=r(o);i.edges.push(a)},Array.isArray(o)?o.forEach(function(e){Array.isArray(a)?a.forEach(function(t){s(e,t)}):s(e,a)}):Array.isArray(a)?a.forEach(function(e){s(o,e)}):s(o,a),e.to instanceof Object&&e.to.edges&&e.to.edges.forEach(function(e){var t=r(e);i.edges.push(t)})})}return t.attr&&(i.options=t.attr),i}},function(e,t,i){t.parseGephi=function(e,t){var i=[],r=[],n={edges:{inheritColor:!1},nodes:{fixed:!1,parseColor:!1}};void 0!==t&&(void 0!==t.fixed&&(n.nodes.fixed=t.fixed),void 0!==t.parseColor&&(n.nodes.parseColor=t.parseColor),void 0!==t.inheritColor&&(n.edges.inheritColor=t.inheritColor));for(var o=e.edges,a=e.nodes,s=0;s<o.length;s++){var l={},u=o[s];l.id=u.id,l.from=u.source,l.to=u.target,l.attributes=u.attributes,l.label=u.label,l.title=void 0!==u.attributes?u.attributes.title:void 0,"Directed"===u.type&&(l.arrows="to"),u.color&&!1===n.inheritColor&&(l.color=u.color),i.push(l)}for(var h=0;h<a.length;h++){var c={},d=a[h];c.id=d.id,c.attributes=d.attributes,c.x=d.x,c.y=d.y,c.label=d.label,c.title=void 0!==d.attributes?d.attributes.title:d.title,!0===n.nodes.parseColor?c.color=d.color:c.color=void 0!==d.color?{background:d.color,border:d.color,highlight:{background:d.color,border:d.color},hover:{background:d.color,border:d.color}}:void 0,c.size=d.size,c.fixed=n.nodes.fixed&&void 0!==d.x&&void 0!==d.y,r.push(c)}return{nodes:r,edges:i}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=a(i(0)),n=a(i(1)),o=a(i(185));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,r.default)(this,e),this.images={},this.imageBroken={},this.callback=t}return(0,n.default)(e,[{key:"_tryloadBrokenUrl",value:function(e,t,i){void 0!==e&&void 0!==i&&(void 0!==t?(i.onerror=function(){console.error("Could not load brokenImage:",t)},i.image.src=t):console.warn("No broken url image defined"))}},{key:"_redrawWithImage",value:function(e){this.callback&&this.callback(e)}},{key:"load",value:function(e,t){var i=this,r=this.images[e];if(r)return r;var n=new o.default;return this.images[e]=n,n.image.onload=function(){i._fixImageCoordinates(n.image),n.init(),i._redrawWithImage(n)},n.image.onerror=function(){console.error("Could not load image:",e),i._tryloadBrokenUrl(e,t,n)},n.image.src=e,n}},{key:"_fixImageCoordinates",value:function(e){0===e.width&&(document.body.appendChild(e),e.width=e.offsetWidth,e.height=e.offsetHeight,document.body.removeChild(e))}}]),e}();t.default=s},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=s(i(30)),n=s(i(6)),o=s(i(0)),a=s(i(1));function s(e){return e&&e.__esModule?e:{default:e}}var l=i(2),u=i(48).default,h=i(191).default,c=["bold","ital","boldital","mono"],d=function(){function e(t,i){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,o.default)(this,e),this.body=t,this.pointToSelf=!1,this.baseSize=void 0,this.fontOptions={},this.setOptions(i),this.size={top:0,left:0,width:0,height:0,yLine:0},this.isEdgeLabel=r}return(0,a.default)(e,[{key:"setOptions",value:function(e){if(this.elementOptions=e,this.initFontOptions(e.font),u.isValidLabel(e.label)?this.labelDirty=!0:e.label="",void 0!==e.font&&null!==e.font)if("string"==typeof e.font)this.baseSize=this.fontOptions.size;else if("object"===(0,n.default)(e.font)){var t=e.font.size;void 0!==t&&(this.baseSize=t)}}},{key:"initFontOptions",value:function(t){var i=this;l.forEach(c,function(e){i.fontOptions[e]={}}),e.parseFontString(this.fontOptions,t)?this.fontOptions.vadjust=0:l.forEach(t,function(e,t){null!=e&&"object"!==(void 0===e?"undefined":(0,n.default)(e))&&(i.fontOptions[t]=e)})}},{key:"constrain",value:function(e){var t={constrainWidth:!1,maxWdt:-1,minWdt:-1,constrainHeight:!1,minHgt:-1,valign:"middle"},i=l.topMost(e,"widthConstraint");if("number"==typeof i)t.maxWdt=Number(i),t.minWdt=Number(i);else if("object"===(void 0===i?"undefined":(0,n.default)(i))){var r=l.topMost(e,["widthConstraint","maximum"]);"number"==typeof r&&(t.maxWdt=Number(r));var o=l.topMost(e,["widthConstraint","minimum"]);"number"==typeof o&&(t.minWdt=Number(o))}var a=l.topMost(e,"heightConstraint");if("number"==typeof a)t.minHgt=Number(a);else if("object"===(void 0===a?"undefined":(0,n.default)(a))){var s=l.topMost(e,["heightConstraint","minimum"]);"number"==typeof s&&(t.minHgt=Number(s));var u=l.topMost(e,["heightConstraint","valign"]);"string"==typeof u&&("top"!==u&&"bottom"!==u||(t.valign=u))}return t}},{key:"update",value:function(e,t){this.setOptions(e,!0),this.propagateFonts(t),l.deepExtend(this.fontOptions,this.constrain(t)),this.fontOptions.chooser=u.choosify("label",t)}},{key:"adjustSizes",value:function(e){var t=e?e.right+e.left:0;this.fontOptions.constrainWidth&&(this.fontOptions.maxWdt-=t,this.fontOptions.minWdt-=t);var i=e?e.top+e.bottom:0;this.fontOptions.constrainHeight&&(this.fontOptions.minHgt-=i)}},{key:"addFontOptionsToPile",value:function(e,t){for(var i=0;i<t.length;++i)this.addFontToPile(e,t[i])}},{key:"addFontToPile",value:function(e,t){if(void 0!==t&&void 0!==t.font&&null!==t.font){var i=t.font;e.push(i)}}},{key:"getBasicOptions",value:function(t){for(var i={},r=0;r<t.length;++r){var n=t[r],o={};e.parseFontString(o,n)&&(n=o),l.forEach(n,function(e,t){void 0!==e&&(i.hasOwnProperty(t)||(-1!==c.indexOf(t)?i[t]={}:i[t]=e))})}return i}},{key:"getFontOption",value:function(t,i,r){for(var n=void 0,o=0;o<t.length;++o){var a=t[o];if(a.hasOwnProperty(i)){if(null==(n=a[i]))continue;var s={};if(e.parseFontString(s,n)&&(n=s),n.hasOwnProperty(r))return n[r]}}if(this.fontOptions.hasOwnProperty(r))return this.fontOptions[r];throw new Error("Did not find value for multi-font for property: '"+r+"'")}},{key:"getFontOptions",value:function(e,t){for(var i={},r=["color","size","face","mod","vadjust"],n=0;n<r.length;++n){var o=r[n];i[o]=this.getFontOption(e,t,o)}return i}},{key:"propagateFonts",value:function(e){var t=this,i=[];this.addFontOptionsToPile(i,e),this.fontOptions=this.getBasicOptions(i);for(var r=function(e){var r=c[e],n=t.fontOptions[r],o=t.getFontOptions(i,r);l.forEach(o,function(e,t){n[t]=e}),n.size=Number(n.size),n.vadjust=Number(n.vadjust)},n=0;n<c.length;++n)r(n)}},{key:"draw",value:function(e,t,i,r,n){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"middle";if(void 0!==this.elementOptions.label){var a=this.fontOptions.size*this.body.view.scale;this.elementOptions.label&&a<this.elementOptions.scaling.label.drawThreshold-1||(a>=this.elementOptions.scaling.label.maxVisible&&(a=Number(this.elementOptions.scaling.label.maxVisible)/this.body.view.scale),this.calculateLabelSize(e,r,n,t,i,o),this._drawBackground(e),this._drawText(e,t,this.size.yLine,o,a))}}},{key:"_drawBackground",value:function(e){if(void 0!==this.fontOptions.background&&"none"!==this.fontOptions.background){e.fillStyle=this.fontOptions.background;var t=this.getSize();e.fillRect(t.left,t.top,t.width,t.height)}}},{key:"_drawText",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"middle",o=arguments[4],a=this._setAlignment(e,t,i,n),s=(0,r.default)(a,2);t=s[0],i=s[1],e.textAlign="left",t-=this.size.width/2,this.fontOptions.valign&&this.size.height>this.size.labelHeight&&("top"===this.fontOptions.valign&&(i-=(this.size.height-this.size.labelHeight)/2),"bottom"===this.fontOptions.valign&&(i+=(this.size.height-this.size.labelHeight)/2));for(var l=0;l<this.lineCount;l++){var u=this.lines[l];if(u&&u.blocks){var h=0;this.isEdgeLabel||"center"===this.fontOptions.align?h+=(this.size.width-u.width)/2:"right"===this.fontOptions.align&&(h+=this.size.width-u.width);for(var c=0;c<u.blocks.length;c++){var d=u.blocks[c];e.font=d.font;var p=this._getColor(d.color,o,d.strokeColor),f=(0,r.default)(p,2),m=f[0],v=f[1];d.strokeWidth>0&&(e.lineWidth=d.strokeWidth,e.strokeStyle=v,e.lineJoin="round"),e.fillStyle=m,d.strokeWidth>0&&e.strokeText(d.text,t+h,i+d.vadjust),e.fillText(d.text,t+h,i+d.vadjust),h+=d.width}i+=u.height}}}},{key:"_setAlignment",value:function(e,t,i,r){if(this.isEdgeLabel&&"horizontal"!==this.fontOptions.align&&!1===this.pointToSelf){t=0,i=0;"top"===this.fontOptions.align?(e.textBaseline="alphabetic",i-=4):"bottom"===this.fontOptions.align?(e.textBaseline="hanging",i+=4):e.textBaseline="middle"}else e.textBaseline=r;return[t,i]}},{key:"_getColor",value:function(e,t,i){var r=e||"#000000",n=i||"#ffffff";if(t<=this.elementOptions.scaling.label.drawThreshold){var o=Math.max(0,Math.min(1,1-(this.elementOptions.scaling.label.drawThreshold-t)));r=l.overrideOpacity(r,o),n=l.overrideOpacity(n,o)}return[r,n]}},{key:"getTextSize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._processLabel(e,t,i),{width:this.size.width,height:this.size.height,lineCount:this.lineCount}}},{key:"getSize",value:function(){var e=this.size.left,t=this.size.top-1;if(this.isEdgeLabel){var i=.5*-this.size.width;switch(this.fontOptions.align){case"middle":e=i,t=.5*-this.size.height;break;case"top":e=i,t=-(this.size.height+2);break;case"bottom":e=i,t=2}}return{left:e,top:t,width:this.size.width,height:this.size.height}}},{key:"calculateLabelSize",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"middle";this._processLabel(e,t,i),this.size.left=r-.5*this.size.width,this.size.top=n-.5*this.size.height,this.size.yLine=n+.5*(1-this.lineCount)*this.fontOptions.size,"hanging"===o&&(this.size.top+=.5*this.fontOptions.size,this.size.top+=4,this.size.yLine+=4)}},{key:"getFormattingValues",value:function(e,t,i,r){var n=function(e,t,i){return"normal"===t?"mod"===i?"":e[i]:void 0!==e[t][i]?e[t][i]:e[i]},o={color:n(this.fontOptions,r,"color"),size:n(this.fontOptions,r,"size"),face:n(this.fontOptions,r,"face"),mod:n(this.fontOptions,r,"mod"),vadjust:n(this.fontOptions,r,"vadjust"),strokeWidth:this.fontOptions.strokeWidth,strokeColor:this.fontOptions.strokeColor};(t||i)&&("normal"===r&&!0===this.fontOptions.chooser&&this.elementOptions.labelHighlightBold?o.mod="bold":"function"==typeof this.fontOptions.chooser&&this.fontOptions.chooser(o,this.elementOptions.id,t,i));var a="";return void 0!==o.mod&&""!==o.mod&&(a+=o.mod+" "),a+=o.size+"px "+o.face,e.font=a.replace(/"/g,""),o.font=e.font,o.height=o.size,o}},{key:"differentState",value:function(e,t){return e!==this.selectedState||t!==this.hoverState}},{key:"_processLabelText",value:function(e,t,i,r){return new h(e,this,t,i).process(r)}},{key:"_processLabel",value:function(e,t,i){if(!1!==this.labelDirty||this.differentState(t,i)){var r=this._processLabelText(e,t,i,this.elementOptions.label);this.fontOptions.minWdt>0&&r.width<this.fontOptions.minWdt&&(r.width=this.fontOptions.minWdt),this.size.labelHeight=r.height,this.fontOptions.minHgt>0&&r.height<this.fontOptions.minHgt&&(r.height=this.fontOptions.minHgt),this.lines=r.lines,this.lineCount=r.lines.length,this.size.width=r.width,this.size.height=r.height,this.selectedState=t,this.hoverState=i,this.labelDirty=!1}}},{key:"visible",value:function(){return 0!==this.size.width&&0!==this.size.height&&void 0!==this.elementOptions.label&&!(this.fontOptions.size*this.body.view.scale<this.elementOptions.scaling.label.drawThreshold-1)}}],[{key:"parseFontString",value:function(e,t){if(!t||"string"!=typeof t)return!1;var i=t.split(" ");return e.size=i[0].replace("px",""),e.face=i[1],e.color=i[2],!0}}]),e}();t.default=d},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=a(i(30)),n=a(i(0)),o=a(i(1));function a(e){return e&&e.__esModule?e:{default:e}}var s=i(2),l=i(119).default,u=function(){function e(t,i,r){(0,n.default)(this,e),this.body=i,this.labelModule=r,this.options={},this.setOptions(t),this.colorDirty=!0,this.color={},this.selectionWidth=2,this.hoverWidth=1.5,this.fromPoint=this.from,this.toPoint=this.to}return(0,o.default)(e,[{key:"connect",value:function(){this.from=this.body.nodes[this.options.from],this.to=this.body.nodes[this.options.to]}},{key:"cleanup",value:function(){return!1}},{key:"setOptions",value:function(e){this.options=e,this.from=this.body.nodes[this.options.from],this.to=this.body.nodes[this.options.to],this.id=this.options.id}},{key:"drawLine",value:function(e,t,i,r,n){e.strokeStyle=this.getColor(e,t,i,r),e.lineWidth=t.width,!1!==t.dashes?this._drawDashedLine(e,t,n):this._drawLine(e,t,n)}},{key:"_drawLine",value:function(e,t,i,n,o){if(this.from!=this.to)this._line(e,t,i,n,o);else{var a=this._getCircleData(e),s=(0,r.default)(a,3),l=s[0],u=s[1],h=s[2];this._circle(e,t,l,u,h)}}},{key:"_drawDashedLine",value:function(e,t,i,n,o){e.lineCap="round";var a=[5,5];if(!0===Array.isArray(t.dashes)&&(a=t.dashes),void 0!==e.setLineDash){if(e.save(),e.setLineDash(a),e.lineDashOffset=0,this.from!=this.to)this._line(e,t,i);else{var s=this._getCircleData(e),l=(0,r.default)(s,3),u=l[0],h=l[1],c=l[2];this._circle(e,t,u,h,c)}e.setLineDash([0]),e.lineDashOffset=0,e.restore()}else{if(this.from!=this.to)e.dashedLine(this.from.x,this.from.y,this.to.x,this.to.y,a);else{var d=this._getCircleData(e),p=(0,r.default)(d,3),f=p[0],m=p[1],v=p[2];this._circle(e,t,f,m,v)}this.enableShadow(e,t),e.stroke(),this.disableShadow(e,t)}}},{key:"findBorderPosition",value:function(e,t,i){return this.from!=this.to?this._findBorderPosition(e,t,i):this._findBorderPositionCircle(e,t,i)}},{key:"findBorderPositions",value:function(e){var t={},i={};if(this.from!=this.to)t=this._findBorderPosition(this.from,e),i=this._findBorderPosition(this.to,e);else{var n=this._getCircleData(e).slice(0,2),o=(0,r.default)(n,2),a=o[0],s=o[1];t=this._findBorderPositionCircle(this.from,e,{x:a,y:s,low:.25,high:.6,direction:-1}),i=this._findBorderPositionCircle(this.from,e,{x:a,y:s,low:.6,high:.8,direction:1})}return{from:t,to:i}}},{key:"_getCircleData",value:function(e){var t=void 0,i=void 0,r=this.from,n=this.options.selfReferenceSize;return void 0!==e&&void 0===r.shape.width&&r.shape.resize(e),r.shape.width>r.shape.height?(t=r.x+.5*r.shape.width,i=r.y-n):(t=r.x+n,i=r.y-.5*r.shape.height),[t,i,n]}},{key:"_pointOnCircle",value:function(e,t,i,r){var n=2*r*Math.PI;return{x:e+i*Math.cos(n),y:t-i*Math.sin(n)}}},{key:"_findBorderPositionCircle",value:function(e,t,i){for(var r=i.x,n=i.y,o=i.low,a=i.high,s=i.direction,l=0,u=this.options.selfReferenceSize,h=void 0,c=void 0,d=void 0,p=.5*(o+a);o<=a&&l<10&&(p=.5*(o+a),h=this._pointOnCircle(r,n,u,p),c=Math.atan2(e.y-h.y,e.x-h.x),d=e.distanceToBorder(t,c)-Math.sqrt(Math.pow(h.x-e.x,2)+Math.pow(h.y-e.y,2)),!(Math.abs(d)<.05));)d>0?s>0?o=p:a=p:s>0?a=p:o=p,l++;return h.t=p,h}},{key:"getLineWidth",value:function(e,t){return!0===e?Math.max(this.selectionWidth,.3/this.body.view.scale):!0===t?Math.max(this.hoverWidth,.3/this.body.view.scale):Math.max(this.options.width,.3/this.body.view.scale)}},{key:"getColor",value:function(e,t,i,r){if(!1!==t.inheritsColor){if("both"===t.inheritsColor&&this.from.id!==this.to.id){var n=e.createLinearGradient(this.from.x,this.from.y,this.to.x,this.to.y),o=void 0,a=void 0;return o=this.from.options.color.highlight.border,a=this.to.options.color.highlight.border,!1===this.from.selected&&!1===this.to.selected?(o=s.overrideOpacity(this.from.options.color.border,t.opacity),a=s.overrideOpacity(this.to.options.color.border,t.opacity)):!0===this.from.selected&&!1===this.to.selected?a=this.to.options.color.border:!1===this.from.selected&&!0===this.to.selected&&(o=this.from.options.color.border),n.addColorStop(0,o),n.addColorStop(1,a),n}return"to"===t.inheritsColor?s.overrideOpacity(this.to.options.color.border,t.opacity):s.overrideOpacity(this.from.options.color.border,t.opacity)}return s.overrideOpacity(t.color,t.opacity)}},{key:"_circle",value:function(e,t,i,r,n){this.enableShadow(e,t),e.beginPath(),e.arc(i,r,n,0,2*Math.PI,!1),e.stroke(),this.disableShadow(e,t)}},{key:"getDistanceToEdge",value:function(e,t,i,n,o,a,s,l){var u=0;if(this.from!=this.to)u=this._getDistanceToEdge(e,t,i,n,o,a,s);else{var h=this._getCircleData(void 0),c=(0,r.default)(h,3),d=c[0],p=c[1],f=c[2],m=d-o,v=p-a;u=Math.abs(Math.sqrt(m*m+v*v)-f)}return u}},{key:"_getDistanceToLine",value:function(e,t,i,r,n,o){var a=i-e,s=r-t,l=((n-e)*a+(o-t)*s)/(a*a+s*s);l>1?l=1:l<0&&(l=0);var u=e+l*a-n,h=t+l*s-o;return Math.sqrt(u*u+h*h)}},{key:"getArrowData",value:function(e,t,i,n,o,a){var s=void 0,l=void 0,u=void 0,h=void 0,c=void 0,d=void 0,p=void 0,f=a.width;if("from"===t?(u=this.from,h=this.to,c=.1,d=a.fromArrowScale,p=a.fromArrowType):"to"===t?(u=this.to,h=this.from,c=-.1,d=a.toArrowScale,p=a.toArrowType):(u=this.to,h=this.from,d=a.middleArrowScale,p=a.middleArrowType),u!=h)if("middle"!==t)if(!0===this.options.smooth.enabled){l=this.findBorderPosition(u,e,{via:i});var m=this.getPoint(Math.max(0,Math.min(1,l.t+c)),i);s=Math.atan2(l.y-m.y,l.x-m.x)}else s=Math.atan2(u.y-h.y,u.x-h.x),l=this.findBorderPosition(u,e);else s=Math.atan2(u.y-h.y,u.x-h.x),l=this.getPoint(.5,i);else{var v=this._getCircleData(e),g=(0,r.default)(v,3),y=g[0],_=g[1],b=g[2];"from"===t?s=-2*(l=this.findBorderPosition(this.from,e,{x:y,y:_,low:.25,high:.6,direction:-1})).t*Math.PI+1.5*Math.PI+.1*Math.PI:"to"===t?s=-2*(l=this.findBorderPosition(this.from,e,{x:y,y:_,low:.6,high:1,direction:1})).t*Math.PI+1.5*Math.PI-1.1*Math.PI:(l=this._pointOnCircle(y,_,b,.175),s=3.9269908169872414)}"middle"===t&&d<0&&(f*=-1);var x=15*d+3*f;return{point:l,core:{x:l.x-.9*x*Math.cos(s),y:l.y-.9*x*Math.sin(s)},angle:s,length:x,type:p}}},{key:"drawArrowHead",value:function(e,t,i,r,n){e.strokeStyle=this.getColor(e,t,i,r),e.fillStyle=e.strokeStyle,e.lineWidth=t.width,l.draw(e,n),this.enableShadow(e,t),e.fill(),this.disableShadow(e,t)}},{key:"enableShadow",value:function(e,t){!0===t.shadow&&(e.shadowColor=t.shadowColor,e.shadowBlur=t.shadowSize,e.shadowOffsetX=t.shadowX,e.shadowOffsetY=t.shadowY)}},{key:"disableShadow",value:function(e,t){!0===t.shadow&&(e.shadowColor="rgba(0,0,0,0)",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0)}}]),e}();t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(4)),o=l(i(5)),a=l(i(0)),s=l(i(1));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,null,[{key:"transform",value:function(e,t){e instanceof Array||(e=[e]);for(var i=t.point.x,r=t.point.y,n=t.angle,o=t.length,a=0;a<e.length;++a){var s=e[a],l=s.x*Math.cos(n)-s.y*Math.sin(n),u=s.x*Math.sin(n)+s.y*Math.cos(n);s.x=i+o*l,s.y=r+o*u}}},{key:"drawPath",value:function(e,t){e.beginPath(),e.moveTo(t[0].x,t[0].y);for(var i=1;i<t.length;++i)e.lineTo(t[i].x,t[i].y);e.closePath()}}]),e}(),h=function(e){function t(){return(0,a.default)(this,t),(0,n.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,o.default)(t,e),(0,s.default)(t,null,[{key:"draw",value:function(e,t){var i=[{x:0,y:0},{x:-1,y:.3},{x:-.9,y:0},{x:-1,y:-.3}];u.transform(i,t),u.drawPath(e,i)}}]),t}(u),c=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,null,[{key:"draw",value:function(e,t){var i={x:-.4,y:0};u.transform(i,t),e.circle(i.x,i.y,.4*t.length)}}]),e}(),d=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,null,[{key:"draw",value:function(e,t){var i=[{x:0,y:.5},{x:0,y:-.5},{x:-.15,y:-.5},{x:-.15,y:.5}];u.transform(i,t),u.drawPath(e,i)}}]),e}(),p=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,null,[{key:"draw",value:function(e,t){var i;switch(t.type&&(i=t.type.toLowerCase()),i){case"circle":c.draw(e,t);break;case"bar":d.draw(e,t);break;case"arrow":default:h.draw(e,t)}}}]),e}();t.default=p},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(t,i,n){(0,r.default)(this,e),this.body=t,this.physicsBody=i,this.barnesHutTree,this.setOptions(n),this.randomSeed=5}return(0,n.default)(e,[{key:"setOptions",value:function(e){this.options=e,this.thetaInversed=1/this.options.theta,this.overlapAvoidanceFactor=1-Math.max(0,Math.min(1,this.options.avoidOverlap))}},{key:"seededRandom",value:function(){var e=1e4*Math.sin(this.randomSeed++);return e-Math.floor(e)}},{key:"solve",value:function(){if(0!==this.options.gravitationalConstant&&this.physicsBody.physicsNodeIndices.length>0){var e=void 0,t=this.body.nodes,i=this.physicsBody.physicsNodeIndices,r=i.length,n=this._formBarnesHutTree(t,i);this.barnesHutTree=n;for(var o=0;o<r;o++)(e=t[i[o]]).options.mass>0&&this._getForceContributions(n.root,e)}}},{key:"_getForceContributions",value:function(e,t){this._getForceContribution(e.children.NW,t),this._getForceContribution(e.children.NE,t),this._getForceContribution(e.children.SW,t),this._getForceContribution(e.children.SE,t)}},{key:"_getForceContribution",value:function(e,t){if(e.childrenCount>0){var i,r,n;i=e.centerOfMass.x-t.x,r=e.centerOfMass.y-t.y,(n=Math.sqrt(i*i+r*r))*e.calcSize>this.thetaInversed?this._calculateForces(n,i,r,t,e):4===e.childrenCount?this._getForceContributions(e,t):e.children.data.id!=t.id&&this._calculateForces(n,i,r,t,e)}}},{key:"_calculateForces",value:function(e,t,i,r,n){0===e&&(t=e=.1),this.overlapAvoidanceFactor<1&&r.shape.radius&&(e=Math.max(.1+this.overlapAvoidanceFactor*r.shape.radius,e-r.shape.radius));var o=this.options.gravitationalConstant*n.mass*r.options.mass/Math.pow(e,3),a=t*o,s=i*o;this.physicsBody.forces[r.id].x+=a,this.physicsBody.forces[r.id].y+=s}},{key:"_formBarnesHutTree",value:function(e,t){for(var i=void 0,r=t.length,n=e[t[0]].x,o=e[t[0]].y,a=e[t[0]].x,s=e[t[0]].y,l=1;l<r;l++){var u=e[t[l]],h=u.x,c=u.y;u.options.mass>0&&(h<n&&(n=h),h>a&&(a=h),c<o&&(o=c),c>s&&(s=c))}var d=Math.abs(a-n)-Math.abs(s-o);d>0?(o-=.5*d,s+=.5*d):(n+=.5*d,a-=.5*d);var p=Math.max(1e-5,Math.abs(a-n)),f=.5*p,m=.5*(n+a),v=.5*(o+s),g={root:{centerOfMass:{x:0,y:0},mass:0,range:{minX:m-f,maxX:m+f,minY:v-f,maxY:v+f},size:p,calcSize:1/p,children:{data:null},maxWidth:0,level:0,childrenCount:4}};this._splitBranch(g.root);for(var y=0;y<r;y++)(i=e[t[y]]).options.mass>0&&this._placeInTree(g.root,i);return g}},{key:"_updateBranchMass",value:function(e,t){var i=e.centerOfMass,r=e.mass+t.options.mass,n=1/r;i.x=i.x*e.mass+t.x*t.options.mass,i.x*=n,i.y=i.y*e.mass+t.y*t.options.mass,i.y*=n,e.mass=r;var o=Math.max(Math.max(t.height,t.radius),t.width);e.maxWidth=e.maxWidth<o?o:e.maxWidth}},{key:"_placeInTree",value:function(e,t,i){1==i&&void 0!==i||this._updateBranchMass(e,t);var r=e.children.NW.range,n=void 0;n=r.maxX>t.x?r.maxY>t.y?"NW":"SW":r.maxY>t.y?"NE":"SE",this._placeInRegion(e,t,n)}},{key:"_placeInRegion",value:function(e,t,i){var r=e.children[i];switch(r.childrenCount){case 0:r.children.data=t,r.childrenCount=1,this._updateBranchMass(r,t);break;case 1:r.children.data.x===t.x&&r.children.data.y===t.y?(t.x+=this.seededRandom(),t.y+=this.seededRandom()):(this._splitBranch(r),this._placeInTree(r,t));break;case 4:this._placeInTree(r,t)}}},{key:"_splitBranch",value:function(e){var t=null;1===e.childrenCount&&(t=e.children.data,e.mass=0,e.centerOfMass.x=0,e.centerOfMass.y=0),e.childrenCount=4,e.children.data=null,this._insertRegion(e,"NW"),this._insertRegion(e,"NE"),this._insertRegion(e,"SW"),this._insertRegion(e,"SE"),null!=t&&this._placeInTree(e,t)}},{key:"_insertRegion",value:function(e,t){var i=void 0,r=void 0,n=void 0,o=void 0,a=.5*e.size;switch(t){case"NW":i=e.range.minX,r=e.range.minX+a,n=e.range.minY,o=e.range.minY+a;break;case"NE":i=e.range.minX+a,r=e.range.maxX,n=e.range.minY,o=e.range.minY+a;break;case"SW":i=e.range.minX,r=e.range.minX+a,n=e.range.minY+a,o=e.range.maxY;break;case"SE":i=e.range.minX+a,r=e.range.maxX,n=e.range.minY+a,o=e.range.maxY}e.children[t]={centerOfMass:{x:0,y:0},mass:0,range:{minX:i,maxX:r,minY:n,maxY:o},size:.5*e.size,calcSize:2*e.calcSize,children:{data:null},maxWidth:0,level:e.level+1,childrenCount:0}}},{key:"_debug",value:function(e,t){void 0!==this.barnesHutTree&&(e.lineWidth=1,this._drawBranch(this.barnesHutTree.root,e,t))}},{key:"_drawBranch",value:function(e,t,i){void 0===i&&(i="#FF0000"),4===e.childrenCount&&(this._drawBranch(e.children.NW,t),this._drawBranch(e.children.NE,t),this._drawBranch(e.children.SE,t),this._drawBranch(e.children.SW,t)),t.strokeStyle=i,t.beginPath(),t.moveTo(e.range.minX,e.range.minY),t.lineTo(e.range.maxX,e.range.minY),t.stroke(),t.beginPath(),t.moveTo(e.range.maxX,e.range.minY),t.lineTo(e.range.maxX,e.range.maxY),t.stroke(),t.beginPath(),t.moveTo(e.range.maxX,e.range.maxY),t.lineTo(e.range.minX,e.range.maxY),t.stroke(),t.beginPath(),t.moveTo(e.range.minX,e.range.maxY),t.lineTo(e.range.minX,e.range.minY),t.stroke()}}]),e}();t.default=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(t,i,n){(0,r.default)(this,e),this.body=t,this.physicsBody=i,this.setOptions(n)}return(0,n.default)(e,[{key:"setOptions",value:function(e){this.options=e}},{key:"solve",value:function(){for(var e=void 0,t=void 0,i=void 0,r=void 0,n=this.body.nodes,o=this.physicsBody.physicsNodeIndices,a=this.physicsBody.forces,s=0;s<o.length;s++){e=-(r=n[o[s]]).x,t=-r.y,i=Math.sqrt(e*e+t*t),this._calculateForces(i,e,t,a,r)}}},{key:"_calculateForces",value:function(e,t,i,r,n){var o=0===e?0:this.options.centralGravity/e;r[n.id].x=t*o,r[n.id].y=i*o}}]),e}();t.default=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r="string",n="boolean",o="number",a="object",s=["arrow","circle","bar"],l={configure:{enabled:{boolean:n},filter:{boolean:n,string:r,array:"array",function:"function"},container:{dom:"dom"},showButton:{boolean:n},__type__:{object:a,boolean:n,string:r,array:"array",function:"function"}},edges:{arrows:{to:{enabled:{boolean:n},scaleFactor:{number:o},type:{string:s},__type__:{object:a,boolean:n}},middle:{enabled:{boolean:n},scaleFactor:{number:o},type:{string:s},__type__:{object:a,boolean:n}},from:{enabled:{boolean:n},scaleFactor:{number:o},type:{string:s},__type__:{object:a,boolean:n}},__type__:{string:["from","to","middle"],object:a}},arrowStrikethrough:{boolean:n},chosen:{label:{boolean:n,function:"function"},edge:{boolean:n,function:"function"},__type__:{object:a,boolean:n}},color:{color:{string:r},highlight:{string:r},hover:{string:r},inherit:{string:["from","to","both"],boolean:n},opacity:{number:o},__type__:{object:a,string:r}},dashes:{boolean:n,array:"array"},font:{color:{string:r},size:{number:o},face:{string:r},background:{string:r},strokeWidth:{number:o},strokeColor:{string:r},align:{string:["horizontal","top","middle","bottom"]},vadjust:{number:o},multi:{boolean:n,string:r},bold:{color:{string:r},size:{number:o},face:{string:r},mod:{string:r},vadjust:{number:o},__type__:{object:a,string:r}},boldital:{color:{string:r},size:{number:o},face:{string:r},mod:{string:r},vadjust:{number:o},__type__:{object:a,string:r}},ital:{color:{string:r},size:{number:o},face:{string:r},mod:{string:r},vadjust:{number:o},__type__:{object:a,string:r}},mono:{color:{string:r},size:{number:o},face:{string:r},mod:{string:r},vadjust:{number:o},__type__:{object:a,string:r}},__type__:{object:a,string:r}},hidden:{boolean:n},hoverWidth:{function:"function",number:o},label:{string:r,undefined:"undefined"},labelHighlightBold:{boolean:n},length:{number:o,undefined:"undefined"},physics:{boolean:n},scaling:{min:{number:o},max:{number:o},label:{enabled:{boolean:n},min:{number:o},max:{number:o},maxVisible:{number:o},drawThreshold:{number:o},__type__:{object:a,boolean:n}},customScalingFunction:{function:"function"},__type__:{object:a}},selectionWidth:{function:"function",number:o},selfReferenceSize:{number:o},shadow:{enabled:{boolean:n},color:{string:r},size:{number:o},x:{number:o},y:{number:o},__type__:{object:a,boolean:n}},smooth:{enabled:{boolean:n},type:{string:["dynamic","continuous","discrete","diagonalCross","straightCross","horizontal","vertical","curvedCW","curvedCCW","cubicBezier"]},roundness:{number:o},forceDirection:{string:["horizontal","vertical","none"],boolean:n},__type__:{object:a,boolean:n}},title:{string:r,undefined:"undefined"},width:{number:o},widthConstraint:{maximum:{number:o},__type__:{object:a,boolean:n,number:o}},value:{number:o,undefined:"undefined"},__type__:{object:a}},groups:{useDefaultGroups:{boolean:n},__any__:"get from nodes, will be overwritten below",__type__:{object:a}},interaction:{dragNodes:{boolean:n},dragView:{boolean:n},hideEdgesOnDrag:{boolean:n},hideNodesOnDrag:{boolean:n},hover:{boolean:n},keyboard:{enabled:{boolean:n},speed:{x:{number:o},y:{number:o},zoom:{number:o},__type__:{object:a}},bindToWindow:{boolean:n},__type__:{object:a,boolean:n}},multiselect:{boolean:n},navigationButtons:{boolean:n},selectable:{boolean:n},selectConnectedEdges:{boolean:n},hoverConnectedEdges:{boolean:n},tooltipDelay:{number:o},zoomView:{boolean:n},__type__:{object:a}},layout:{randomSeed:{undefined:"undefined",number:o},improvedLayout:{boolean:n},hierarchical:{enabled:{boolean:n},levelSeparation:{number:o},nodeSpacing:{number:o},treeSpacing:{number:o},blockShifting:{boolean:n},edgeMinimization:{boolean:n},parentCentralization:{boolean:n},direction:{string:["UD","DU","LR","RL"]},sortMethod:{string:["hubsize","directed"]},__type__:{object:a,boolean:n}},__type__:{object:a}},manipulation:{enabled:{boolean:n},initiallyActive:{boolean:n},addNode:{boolean:n,function:"function"},addEdge:{boolean:n,function:"function"},editNode:{function:"function"},editEdge:{editWithoutDrag:{function:"function"},__type__:{object:a,boolean:n,function:"function"}},deleteNode:{boolean:n,function:"function"},deleteEdge:{boolean:n,function:"function"},controlNodeStyle:"get from nodes, will be overwritten below",__type__:{object:a,boolean:n}},nodes:{borderWidth:{number:o},borderWidthSelected:{number:o,undefined:"undefined"},brokenImage:{string:r,undefined:"undefined"},chosen:{label:{boolean:n,function:"function"},node:{boolean:n,function:"function"},__type__:{object:a,boolean:n}},color:{border:{string:r},background:{string:r},highlight:{border:{string:r},background:{string:r},__type__:{object:a,string:r}},hover:{border:{string:r},background:{string:r},__type__:{object:a,string:r}},__type__:{object:a,string:r}},fixed:{x:{boolean:n},y:{boolean:n},__type__:{object:a,boolean:n}},font:{align:{string:r},color:{string:r},size:{number:o},face:{string:r},background:{string:r},strokeWidth:{number:o},strokeColor:{string:r},vadjust:{number:o},multi:{boolean:n,string:r},bold:{color:{string:r},size:{number:o},face:{string:r},mod:{string:r},vadjust:{number:o},__type__:{object:a,string:r}},boldital:{color:{string:r},size:{number:o},face:{string:r},mod:{string:r},vadjust:{number:o},__type__:{object:a,string:r}},ital:{color:{string:r},size:{number:o},face:{string:r},mod:{string:r},vadjust:{number:o},__type__:{object:a,string:r}},mono:{color:{string:r},size:{number:o},face:{string:r},mod:{string:r},vadjust:{number:o},__type__:{object:a,string:r}},__type__:{object:a,string:r}},group:{string:r,number:o,undefined:"undefined"},heightConstraint:{minimum:{number:o},valign:{string:r},__type__:{object:a,boolean:n,number:o}},hidden:{boolean:n},icon:{face:{string:r},code:{string:r},size:{number:o},color:{string:r},__type__:{object:a}},id:{string:r,number:o},image:{selected:{string:r,undefined:"undefined"},unselected:{string:r,undefined:"undefined"},__type__:{object:a,string:r}},label:{string:r,undefined:"undefined"},labelHighlightBold:{boolean:n},level:{number:o,undefined:"undefined"},margin:{top:{number:o},right:{number:o},bottom:{number:o},left:{number:o},__type__:{object:a,number:o}},mass:{number:o},physics:{boolean:n},scaling:{min:{number:o},max:{number:o},label:{enabled:{boolean:n},min:{number:o},max:{number:o},maxVisible:{number:o},drawThreshold:{number:o},__type__:{object:a,boolean:n}},customScalingFunction:{function:"function"},__type__:{object:a}},shadow:{enabled:{boolean:n},color:{string:r},size:{number:o},x:{number:o},y:{number:o},__type__:{object:a,boolean:n}},shape:{string:["ellipse","circle","database","box","text","image","circularImage","diamond","dot","star","triangle","triangleDown","square","icon","hexagon"]},shapeProperties:{borderDashes:{boolean:n,array:"array"},borderRadius:{number:o},interpolation:{boolean:n},useImageSize:{boolean:n},useBorderWithImage:{boolean:n},__type__:{object:a}},size:{number:o},title:{string:r,dom:"dom",undefined:"undefined"},value:{number:o,undefined:"undefined"},widthConstraint:{minimum:{number:o},maximum:{number:o},__type__:{object:a,boolean:n,number:o}},x:{number:o},y:{number:o},__type__:{object:a}},physics:{enabled:{boolean:n},barnesHut:{gravitationalConstant:{number:o},centralGravity:{number:o},springLength:{number:o},springConstant:{number:o},damping:{number:o},avoidOverlap:{number:o},__type__:{object:a}},forceAtlas2Based:{gravitationalConstant:{number:o},centralGravity:{number:o},springLength:{number:o},springConstant:{number:o},damping:{number:o},avoidOverlap:{number:o},__type__:{object:a}},repulsion:{centralGravity:{number:o},springLength:{number:o},springConstant:{number:o},nodeDistance:{number:o},damping:{number:o},__type__:{object:a}},hierarchicalRepulsion:{centralGravity:{number:o},springLength:{number:o},springConstant:{number:o},nodeDistance:{number:o},damping:{number:o},__type__:{object:a}},maxVelocity:{number:o},minVelocity:{number:o},solver:{string:["barnesHut","repulsion","hierarchicalRepulsion","forceAtlas2Based"]},stabilization:{enabled:{boolean:n},iterations:{number:o},updateInterval:{number:o},onlyDynamicEdges:{boolean:n},fit:{boolean:n},__type__:{object:a,boolean:n}},timestep:{number:o},adaptiveTimestep:{boolean:n},__type__:{object:a,boolean:n}},autoResize:{boolean:n},clickToUse:{boolean:n},locale:{string:r},locales:{__any__:{any:"any"},__type__:{object:a}},height:{string:r},width:{string:r},__type__:{object:a}};l.groups.__any__=l.nodes,l.manipulation.controlNodeStyle=l.nodes;t.allOptions=l,t.configureOptions={nodes:{borderWidth:[1,0,10,1],borderWidthSelected:[2,0,10,1],color:{border:["color","#2B7CE9"],background:["color","#97C2FC"],highlight:{border:["color","#2B7CE9"],background:["color","#D2E5FF"]},hover:{border:["color","#2B7CE9"],background:["color","#D2E5FF"]}},fixed:{x:!1,y:!1},font:{color:["color","#343434"],size:[14,0,100,1],face:["arial","verdana","tahoma"],background:["color","none"],strokeWidth:[0,0,50,1],strokeColor:["color","#ffffff"]},hidden:!1,labelHighlightBold:!0,physics:!0,scaling:{min:[10,0,200,1],max:[30,0,200,1],label:{enabled:!1,min:[14,0,200,1],max:[30,0,200,1],maxVisible:[30,0,200,1],drawThreshold:[5,0,20,1]}},shadow:{enabled:!1,color:"rgba(0,0,0,0.5)",size:[10,0,20,1],x:[5,-30,30,1],y:[5,-30,30,1]},shape:["ellipse","box","circle","database","diamond","dot","square","star","text","triangle","triangleDown","hexagon"],shapeProperties:{borderDashes:!1,borderRadius:[6,0,20,1],interpolation:!0,useImageSize:!1},size:[25,0,200,1]},edges:{arrows:{to:{enabled:!1,scaleFactor:[1,0,3,.05],type:"arrow"},middle:{enabled:!1,scaleFactor:[1,0,3,.05],type:"arrow"},from:{enabled:!1,scaleFactor:[1,0,3,.05],type:"arrow"}},arrowStrikethrough:!0,color:{color:["color","#848484"],highlight:["color","#848484"],hover:["color","#848484"],inherit:["from","to","both",!0,!1],opacity:[1,0,1,.05]},dashes:!1,font:{color:["color","#343434"],size:[14,0,100,1],face:["arial","verdana","tahoma"],background:["color","none"],strokeWidth:[2,0,50,1],strokeColor:["color","#ffffff"],align:["horizontal","top","middle","bottom"]},hidden:!1,hoverWidth:[1.5,0,5,.1],labelHighlightBold:!0,physics:!0,scaling:{min:[1,0,100,1],max:[15,0,100,1],label:{enabled:!0,min:[14,0,200,1],max:[30,0,200,1],maxVisible:[30,0,200,1],drawThreshold:[5,0,20,1]}},selectionWidth:[1.5,0,5,.1],selfReferenceSize:[20,0,200,1],shadow:{enabled:!1,color:"rgba(0,0,0,0.5)",size:[10,0,20,1],x:[5,-30,30,1],y:[5,-30,30,1]},smooth:{enabled:!0,type:["dynamic","continuous","discrete","diagonalCross","straightCross","horizontal","vertical","curvedCW","curvedCCW","cubicBezier"],forceDirection:["horizontal","vertical","none"],roundness:[.5,0,1,.05]},width:[1,0,30,1]},layout:{hierarchical:{enabled:!1,levelSeparation:[150,20,500,5],nodeSpacing:[100,20,500,5],treeSpacing:[200,20,500,5],blockShifting:!0,edgeMinimization:!0,parentCentralization:!0,direction:["UD","DU","LR","RL"],sortMethod:["hubsize","directed"]}},interaction:{dragNodes:!0,dragView:!0,hideEdgesOnDrag:!1,hideNodesOnDrag:!1,hover:!1,keyboard:{enabled:!1,speed:{x:[10,0,40,1],y:[10,0,40,1],zoom:[.02,0,.1,.005]},bindToWindow:!0},multiselect:!1,navigationButtons:!1,selectable:!0,selectConnectedEdges:!0,hoverConnectedEdges:!0,tooltipDelay:[300,0,1e3,25],zoomView:!0},manipulation:{enabled:!1,initiallyActive:!1},physics:{enabled:!0,barnesHut:{gravitationalConstant:[-2e3,-3e4,0,50],centralGravity:[.3,0,10,.05],springLength:[95,0,500,5],springConstant:[.04,0,1.2,.005],damping:[.09,0,1,.01],avoidOverlap:[0,0,1,.01]},forceAtlas2Based:{gravitationalConstant:[-50,-500,0,1],centralGravity:[.01,0,1,.005],springLength:[95,0,500,5],springConstant:[.08,0,1.2,.005],damping:[.4,0,1,.01],avoidOverlap:[0,0,1,.01]},repulsion:{centralGravity:[.2,0,10,.05],springLength:[200,0,500,5],springConstant:[.05,0,1.2,.005],nodeDistance:[100,0,500,5],damping:[.09,0,1,.01]},hierarchicalRepulsion:{centralGravity:[.2,0,10,.05],springLength:[100,0,500,5],springConstant:[.01,0,1.2,.005],nodeDistance:[120,0,500,5],damping:[.09,0,1,.01]},maxVelocity:[50,0,150,1],minVelocity:[.1,.01,.5,.01],solver:["barnesHut","forceAtlas2Based","repulsion","hierarchicalRepulsion"],timestep:[.5,.01,1,.01]}}},function(e,t,i){var r=i(2);r.extend(t,i(159)),r.extend(t,i(177)),r.extend(t,i(181))},function(e,t,i){i(49),i(60),e.exports=i(136)},function(e,t,i){var r=i(126),n=i(127),o=i(31),a=i(25);e.exports=i(79)(Array,"Array",function(e,t){this._t=a(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,i=this._i++;return!e||i>=e.length?(this._t=void 0,n(1)):n(0,"keys"==t?i:"values"==t?e[i]:[i,e[i]])},"values"),o.Arguments=o.Array,r("keys"),r("values"),r("entries")},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,i){var r=i(54),n=i(39),o=i(59),a={};i(26)(a,i(13)("iterator"),function(){return this}),e.exports=function(e,t,i){e.prototype=r(a,{next:n(1,i)}),o(e,t+" Iterator")}},function(e,t,i){var r=i(20),n=i(27),o=i(33);e.exports=i(21)?Object.defineProperties:function(e,t){n(e);for(var i,a=o(t),s=a.length,l=0;s>l;)r.f(e,i=a[l++],t[i]);return e}},function(e,t,i){var r=i(25),n=i(132),o=i(133);e.exports=function(e){return function(t,i,a){var s,l=r(t),u=n(l.length),h=o(a,u);if(e&&i!=i){for(;u>h;)if((s=l[h++])!=s)return!0}else for(;u>h;h++)if((e||h in l)&&l[h]===i)return e||h||0;return!e&&-1}}},function(e,t,i){var r=i(55),n=Math.min;e.exports=function(e){return e>0?n(r(e),9007199254740991):0}},function(e,t,i){var r=i(55),n=Math.max,o=Math.min;e.exports=function(e,t){return(e=r(e))<0?n(e+t,0):o(e,t)}},function(e,t,i){var r=i(18).document;e.exports=r&&r.documentElement},function(e,t,i){var r=i(55),n=i(51);e.exports=function(e){return function(t,i){var o,a,s=String(n(t)),l=r(i),u=s.length;return l<0||l>=u?e?"":void 0:(o=s.charCodeAt(l))<55296||o>56319||l+1===u||(a=s.charCodeAt(l+1))<56320||a>57343?e?s.charAt(l):o:e?s.slice(l,l+2):a-56320+(o-55296<<10)+65536}}},function(e,t,i){var r=i(27),n=i(137);e.exports=i(7).getIterator=function(e){var t=n(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},function(e,t,i){var r=i(86),n=i(13)("iterator"),o=i(31);e.exports=i(7).getIteratorMethod=function(e){if(null!=e)return e[n]||e["@@iterator"]||o[r(e)]}},function(e,t,i){i(139);var r=i(7).Object;e.exports=function(e,t){return r.create(e,t)}},function(e,t,i){var r=i(17);r(r.S,"Object",{create:i(54)})},function(e,t,i){i(141),e.exports=i(7).Object.keys},function(e,t,i){var r=i(41),n=i(33);i(87)("keys",function(){return function(e){return n(r(e))}})},function(e,t,i){e.exports={default:i(143),__esModule:!0}},function(e,t,i){i(60),i(49),e.exports=i(61).f("iterator")},function(e,t,i){e.exports={default:i(145),__esModule:!0}},function(e,t,i){i(146),i(151),i(152),i(153),e.exports=i(7).Symbol},function(e,t,i){var r=i(18),n=i(22),o=i(21),a=i(17),s=i(83),l=i(147).KEY,u=i(28),h=i(57),c=i(59),d=i(40),p=i(13),f=i(61),m=i(62),v=i(148),g=i(149),y=i(27),_=i(25),b=i(53),x=i(39),w=i(54),S=i(150),M=i(89),T=i(20),A=i(33),C=M.f,L=T.f,N=S.f,P=r.Symbol,k=r.JSON,E=k&&k.stringify,D=p("_hidden"),O=p("toPrimitive"),R={}.propertyIsEnumerable,F=h("symbol-registry"),I=h("symbols"),B=h("op-symbols"),U=Object.prototype,V="function"==typeof P,z=r.QObject,G=!z||!z.prototype||!z.prototype.findChild,j=o&&u(function(){return 7!=w(L({},"a",{get:function(){return L(this,"a",{value:7}).a}})).a})?function(e,t,i){var r=C(U,t);r&&delete U[t],L(e,t,i),r&&e!==U&&L(U,t,r)}:L,W=function(e){var t=I[e]=w(P.prototype);return t._k=e,t},H=V&&"symbol"==typeof P.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof P},q=function(e,t,i){return e===U&&q(B,t,i),y(e),t=b(t,!0),y(i),n(I,t)?(i.enumerable?(n(e,D)&&e[D][t]&&(e[D][t]=!1),i=w(i,{enumerable:x(0,!1)})):(n(e,D)||L(e,D,x(1,{})),e[D][t]=!0),j(e,t,i)):L(e,t,i)},Y=function(e,t){y(e);for(var i,r=v(t=_(t)),n=0,o=r.length;o>n;)q(e,i=r[n++],t[i]);return e},X=function(e){var t=R.call(this,e=b(e,!0));return!(this===U&&n(I,e)&&!n(B,e))&&(!(t||!n(this,e)||!n(I,e)||n(this,D)&&this[D][e])||t)},K=function(e,t){if(e=_(e),t=b(t,!0),e!==U||!n(I,t)||n(B,t)){var i=C(e,t);return!i||!n(I,t)||n(e,D)&&e[D][t]||(i.enumerable=!0),i}},Q=function(e){for(var t,i=N(_(e)),r=[],o=0;i.length>o;)n(I,t=i[o++])||t==D||t==l||r.push(t);return r},Z=function(e){for(var t,i=e===U,r=N(i?B:_(e)),o=[],a=0;r.length>a;)!n(I,t=r[a++])||i&&!n(U,t)||o.push(I[t]);return o};V||(s((P=function(){if(this instanceof P)throw TypeError("Symbol is not a constructor!");var e=d(arguments.length>0?arguments[0]:void 0),t=function(i){this===U&&t.call(B,i),n(this,D)&&n(this[D],e)&&(this[D][e]=!1),j(this,e,x(1,i))};return o&&G&&j(U,e,{configurable:!0,set:t}),W(e)}).prototype,"toString",function(){return this._k}),M.f=K,T.f=q,i(88).f=S.f=Q,i(42).f=X,i(63).f=Z,o&&!i(52)&&s(U,"propertyIsEnumerable",X,!0),f.f=function(e){return W(p(e))}),a(a.G+a.W+a.F*!V,{Symbol:P});for(var J="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),$=0;J.length>$;)p(J[$++]);for(var ee=A(p.store),te=0;ee.length>te;)m(ee[te++]);a(a.S+a.F*!V,"Symbol",{for:function(e){return n(F,e+="")?F[e]:F[e]=P(e)},keyFor:function(e){if(!H(e))throw TypeError(e+" is not a symbol!");for(var t in F)if(F[t]===e)return t},useSetter:function(){G=!0},useSimple:function(){G=!1}}),a(a.S+a.F*!V,"Object",{create:function(e,t){return void 0===t?w(e):Y(w(e),t)},defineProperty:q,defineProperties:Y,getOwnPropertyDescriptor:K,getOwnPropertyNames:Q,getOwnPropertySymbols:Z}),k&&a(a.S+a.F*(!V||u(function(){var e=P();return"[null]"!=E([e])||"{}"!=E({a:e})||"{}"!=E(Object(e))})),"JSON",{stringify:function(e){if(void 0!==e&&!H(e)){for(var t,i,r=[e],n=1;arguments.length>n;)r.push(arguments[n++]);return"function"==typeof(t=r[1])&&(i=t),!i&&g(t)||(t=function(e,t){if(i&&(t=i.call(this,e,t)),!H(t))return t}),r[1]=t,E.apply(k,r)}}}),P.prototype[O]||i(26)(P.prototype,O,P.prototype.valueOf),c(P,"Symbol"),c(Math,"Math",!0),c(r.JSON,"JSON",!0)},function(e,t,i){var r=i(40)("meta"),n=i(32),o=i(22),a=i(20).f,s=0,l=Object.isExtensible||function(){return!0},u=!i(28)(function(){return l(Object.preventExtensions({}))}),h=function(e){a(e,r,{value:{i:"O"+ ++s,w:{}}})},c=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!n(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,r)){if(!l(e))return"F";if(!t)return"E";h(e)}return e[r].i},getWeak:function(e,t){if(!o(e,r)){if(!l(e))return!0;if(!t)return!1;h(e)}return e[r].w},onFreeze:function(e){return u&&c.NEED&&l(e)&&!o(e,r)&&h(e),e}}},function(e,t,i){var r=i(33),n=i(63),o=i(42);e.exports=function(e){var t=r(e),i=n.f;if(i)for(var a,s=i(e),l=o.f,u=0;s.length>u;)l.call(e,a=s[u++])&&t.push(a);return t}},function(e,t,i){var r=i(50);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,i){var r=i(25),n=i(88).f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==o.call(e)?function(e){try{return n(e)}catch(e){return a.slice()}}(e):n(r(e))}},function(e,t){},function(e,t,i){i(62)("asyncIterator")},function(e,t,i){i(62)("observable")},function(e,t,i){(function(e){e.exports=function(){var t,i;function r(){return t.apply(null,arguments)}function n(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function o(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function a(e){return void 0===e}function s(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function l(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function u(e,t){var i,r=[];for(i=0;i<e.length;++i)r.push(t(e[i],i));return r}function h(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function c(e,t){for(var i in t)h(t,i)&&(e[i]=t[i]);return h(t,"toString")&&(e.toString=t.toString),h(t,"valueOf")&&(e.valueOf=t.valueOf),e}function d(e,t,i,r){return Lt(e,t,i,r,!0).utc()}function p(e){return null==e._pf&&(e._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1}),e._pf}function f(e){if(null==e._isValid){var t=p(e),r=i.call(t.parsedDateParts,function(e){return null!=e}),n=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&r);if(e._strict&&(n=n&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour),null!=Object.isFrozen&&Object.isFrozen(e))return n;e._isValid=n}return e._isValid}function m(e){var t=d(NaN);return null!=e?c(p(t),e):p(t).userInvalidated=!0,t}i=Array.prototype.some?Array.prototype.some:function(e){for(var t=Object(this),i=t.length>>>0,r=0;r<i;r++)if(r in t&&e.call(this,t[r],r,t))return!0;return!1};var v=r.momentProperties=[];function g(e,t){var i,r,n;if(a(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),a(t._i)||(e._i=t._i),a(t._f)||(e._f=t._f),a(t._l)||(e._l=t._l),a(t._strict)||(e._strict=t._strict),a(t._tzm)||(e._tzm=t._tzm),a(t._isUTC)||(e._isUTC=t._isUTC),a(t._offset)||(e._offset=t._offset),a(t._pf)||(e._pf=p(t)),a(t._locale)||(e._locale=t._locale),v.length>0)for(i=0;i<v.length;i++)r=v[i],a(n=t[r])||(e[r]=n);return e}var y=!1;function _(e){g(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===y&&(y=!0,r.updateOffset(this),y=!1)}function b(e){return e instanceof _||null!=e&&null!=e._isAMomentObject}function x(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function w(e){var t=+e,i=0;return 0!==t&&isFinite(t)&&(i=x(t)),i}function S(e,t,i){var r,n=Math.min(e.length,t.length),o=Math.abs(e.length-t.length),a=0;for(r=0;r<n;r++)(i&&e[r]!==t[r]||!i&&w(e[r])!==w(t[r]))&&a++;return a+o}function M(e){!1===r.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function T(e,t){var i=!0;return c(function(){if(null!=r.deprecationHandler&&r.deprecationHandler(null,e),i){for(var n,o=[],a=0;a<arguments.length;a++){if(n="","object"==typeof arguments[a]){for(var s in n+="\n["+a+"] ",arguments[0])n+=s+": "+arguments[0][s]+", ";n=n.slice(0,-2)}else n=arguments[a];o.push(n)}M(e+"\nArguments: "+Array.prototype.slice.call(o).join("")+"\n"+(new Error).stack),i=!1}return t.apply(this,arguments)},t)}var A,C={};function L(e,t){null!=r.deprecationHandler&&r.deprecationHandler(e,t),C[e]||(M(t),C[e]=!0)}function N(e){return e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function P(e,t){var i,r=c({},e);for(i in t)h(t,i)&&(o(e[i])&&o(t[i])?(r[i]={},c(r[i],e[i]),c(r[i],t[i])):null!=t[i]?r[i]=t[i]:delete r[i]);for(i in e)h(e,i)&&!h(t,i)&&o(e[i])&&(r[i]=c({},r[i]));return r}function k(e){null!=e&&this.set(e)}r.suppressDeprecationWarnings=!1,r.deprecationHandler=null,A=Object.keys?Object.keys:function(e){var t,i=[];for(t in e)h(e,t)&&i.push(t);return i};var E={};function D(e,t){var i=e.toLowerCase();E[i]=E[i+"s"]=E[t]=e}function O(e){return"string"==typeof e?E[e]||E[e.toLowerCase()]:void 0}function R(e){var t,i,r={};for(i in e)h(e,i)&&(t=O(i))&&(r[t]=e[i]);return r}var F={};function I(e,t){F[e]=t}function B(e,t,i){var r=""+Math.abs(e),n=t-r.length,o=e>=0;return(o?i?"+":"":"-")+Math.pow(10,Math.max(0,n)).toString().substr(1)+r}var U=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,V=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,z={},G={};function j(e,t,i,r){var n=r;"string"==typeof r&&(n=function(){return this[r]()}),e&&(G[e]=n),t&&(G[t[0]]=function(){return B(n.apply(this,arguments),t[1],t[2])}),i&&(G[i]=function(){return this.localeData().ordinal(n.apply(this,arguments),e)})}function W(e,t){return e.isValid()?(t=H(t,e.localeData()),z[t]=z[t]||function(e){var t,i,r,n=e.match(U);for(t=0,i=n.length;t<i;t++)G[n[t]]?n[t]=G[n[t]]:n[t]=(r=n[t]).match(/\[[\s\S]/)?r.replace(/^\[|\]$/g,""):r.replace(/\\/g,"");return function(t){var r,o="";for(r=0;r<i;r++)o+=N(n[r])?n[r].call(t,e):n[r];return o}}(t),z[t](e)):e.localeData().invalidDate()}function H(e,t){var i=5;function r(e){return t.longDateFormat(e)||e}for(V.lastIndex=0;i>=0&&V.test(e);)e=e.replace(V,r),V.lastIndex=0,i-=1;return e}var q=/\d/,Y=/\d\d/,X=/\d{3}/,K=/\d{4}/,Q=/[+-]?\d{6}/,Z=/\d\d?/,J=/\d\d\d\d?/,$=/\d\d\d\d\d\d?/,ee=/\d{1,3}/,te=/\d{1,4}/,ie=/[+-]?\d{1,6}/,re=/\d+/,ne=/[+-]?\d+/,oe=/Z|[+-]\d\d:?\d\d/gi,ae=/Z|[+-]\d\d(?::?\d\d)?/gi,se=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,le={};function ue(e,t,i){le[e]=N(t)?t:function(e,r){return e&&i?i:t}}function he(e,t){return h(le,e)?le[e](t._strict,t._locale):new RegExp(ce(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,i,r,n){return t||i||r||n})))}function ce(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var de={};function pe(e,t){var i,r=t;for("string"==typeof e&&(e=[e]),s(t)&&(r=function(e,i){i[t]=w(e)}),i=0;i<e.length;i++)de[e[i]]=r}function fe(e,t){pe(e,function(e,i,r,n){r._w=r._w||{},t(e,r._w,r,n)})}function me(e,t,i){null!=t&&h(de,e)&&de[e](t,i._a,i,e)}var ve=0,ge=1,ye=2,_e=3,be=4,xe=5,we=6,Se=7,Me=8;function Te(e){return Ae(e)?366:365}function Ae(e){return e%4==0&&e%100!=0||e%400==0}j("Y",0,0,function(){var e=this.year();return e<=9999?""+e:"+"+e}),j(0,["YY",2],0,function(){return this.year()%100}),j(0,["YYYY",4],0,"year"),j(0,["YYYYY",5],0,"year"),j(0,["YYYYYY",6,!0],0,"year"),D("year","y"),I("year",1),ue("Y",ne),ue("YY",Z,Y),ue("YYYY",te,K),ue("YYYYY",ie,Q),ue("YYYYYY",ie,Q),pe(["YYYYY","YYYYYY"],ve),pe("YYYY",function(e,t){t[ve]=2===e.length?r.parseTwoDigitYear(e):w(e)}),pe("YY",function(e,t){t[ve]=r.parseTwoDigitYear(e)}),pe("Y",function(e,t){t[ve]=parseInt(e,10)}),r.parseTwoDigitYear=function(e){return w(e)+(w(e)>68?1900:2e3)};var Ce,Le=Ne("FullYear",!0);function Ne(e,t){return function(i){return null!=i?(ke(this,e,i),r.updateOffset(this,t),this):Pe(this,e)}}function Pe(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function ke(e,t,i){e.isValid()&&!isNaN(i)&&("FullYear"===t&&Ae(e.year())?e._d["set"+(e._isUTC?"UTC":"")+t](i,e.month(),Ee(i,e.month())):e._d["set"+(e._isUTC?"UTC":"")+t](i))}function Ee(e,t){if(isNaN(e)||isNaN(t))return NaN;var i,r=(t%(i=12)+i)%i;return e+=(t-r)/12,1===r?Ae(e)?29:28:31-r%7%2}Ce=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1},j("M",["MM",2],"Mo",function(){return this.month()+1}),j("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),j("MMMM",0,0,function(e){return this.localeData().months(this,e)}),D("month","M"),I("month",8),ue("M",Z),ue("MM",Z,Y),ue("MMM",function(e,t){return t.monthsShortRegex(e)}),ue("MMMM",function(e,t){return t.monthsRegex(e)}),pe(["M","MM"],function(e,t){t[ge]=w(e)-1}),pe(["MMM","MMMM"],function(e,t,i,r){var n=i._locale.monthsParse(e,r,i._strict);null!=n?t[ge]=n:p(i).invalidMonth=e});var De=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Oe="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),Re="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");function Fe(e,t){var i;if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=w(t);else if(!s(t=e.localeData().monthsParse(t)))return e;return i=Math.min(e.date(),Ee(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,i),e}function Ie(e){return null!=e?(Fe(this,e),r.updateOffset(this,!0),this):Pe(this,"Month")}var Be=se,Ue=se;function Ve(){function e(e,t){return t.length-e.length}var t,i,r=[],n=[],o=[];for(t=0;t<12;t++)i=d([2e3,t]),r.push(this.monthsShort(i,"")),n.push(this.months(i,"")),o.push(this.months(i,"")),o.push(this.monthsShort(i,""));for(r.sort(e),n.sort(e),o.sort(e),t=0;t<12;t++)r[t]=ce(r[t]),n[t]=ce(n[t]);for(t=0;t<24;t++)o[t]=ce(o[t]);this._monthsRegex=new RegExp("^("+o.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+n.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+r.join("|")+")","i")}function ze(e){var t=new Date(Date.UTC.apply(null,arguments));return e<100&&e>=0&&isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e),t}function Ge(e,t,i){var r=7+t-i,n=(7+ze(e,0,r).getUTCDay()-t)%7;return-n+r-1}function je(e,t,i,r,n){var o,a,s=(7+i-r)%7,l=Ge(e,r,n),u=1+7*(t-1)+s+l;return u<=0?a=Te(o=e-1)+u:u>Te(e)?(o=e+1,a=u-Te(e)):(o=e,a=u),{year:o,dayOfYear:a}}function We(e,t,i){var r,n,o=Ge(e.year(),t,i),a=Math.floor((e.dayOfYear()-o-1)/7)+1;return a<1?(n=e.year()-1,r=a+He(n,t,i)):a>He(e.year(),t,i)?(r=a-He(e.year(),t,i),n=e.year()+1):(n=e.year(),r=a),{week:r,year:n}}function He(e,t,i){var r=Ge(e,t,i),n=Ge(e+1,t,i);return(Te(e)-r+n)/7}j("w",["ww",2],"wo","week"),j("W",["WW",2],"Wo","isoWeek"),D("week","w"),D("isoWeek","W"),I("week",5),I("isoWeek",5),ue("w",Z),ue("ww",Z,Y),ue("W",Z),ue("WW",Z,Y),fe(["w","ww","W","WW"],function(e,t,i,r){t[r.substr(0,1)]=w(e)}),j("d",0,"do","day"),j("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),j("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),j("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),j("e",0,0,"weekday"),j("E",0,0,"isoWeekday"),D("day","d"),D("weekday","e"),D("isoWeekday","E"),I("day",11),I("weekday",11),I("isoWeekday",11),ue("d",Z),ue("e",Z),ue("E",Z),ue("dd",function(e,t){return t.weekdaysMinRegex(e)}),ue("ddd",function(e,t){return t.weekdaysShortRegex(e)}),ue("dddd",function(e,t){return t.weekdaysRegex(e)}),fe(["dd","ddd","dddd"],function(e,t,i,r){var n=i._locale.weekdaysParse(e,r,i._strict);null!=n?t.d=n:p(i).invalidWeekday=e}),fe(["d","e","E"],function(e,t,i,r){t[r]=w(e)});var qe="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Ye="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Xe="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),Ke=se,Qe=se,Ze=se;function Je(){function e(e,t){return t.length-e.length}var t,i,r,n,o,a=[],s=[],l=[],u=[];for(t=0;t<7;t++)i=d([2e3,1]).day(t),r=this.weekdaysMin(i,""),n=this.weekdaysShort(i,""),o=this.weekdays(i,""),a.push(r),s.push(n),l.push(o),u.push(r),u.push(n),u.push(o);for(a.sort(e),s.sort(e),l.sort(e),u.sort(e),t=0;t<7;t++)s[t]=ce(s[t]),l[t]=ce(l[t]),u[t]=ce(u[t]);this._weekdaysRegex=new RegExp("^("+u.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+l.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+s.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+a.join("|")+")","i")}function $e(){return this.hours()%12||12}function et(e,t){j(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function tt(e,t){return t._meridiemParse}j("H",["HH",2],0,"hour"),j("h",["hh",2],0,$e),j("k",["kk",2],0,function(){return this.hours()||24}),j("hmm",0,0,function(){return""+$e.apply(this)+B(this.minutes(),2)}),j("hmmss",0,0,function(){return""+$e.apply(this)+B(this.minutes(),2)+B(this.seconds(),2)}),j("Hmm",0,0,function(){return""+this.hours()+B(this.minutes(),2)}),j("Hmmss",0,0,function(){return""+this.hours()+B(this.minutes(),2)+B(this.seconds(),2)}),et("a",!0),et("A",!1),D("hour","h"),I("hour",13),ue("a",tt),ue("A",tt),ue("H",Z),ue("h",Z),ue("k",Z),ue("HH",Z,Y),ue("hh",Z,Y),ue("kk",Z,Y),ue("hmm",J),ue("hmmss",$),ue("Hmm",J),ue("Hmmss",$),pe(["H","HH"],_e),pe(["k","kk"],function(e,t,i){var r=w(e);t[_e]=24===r?0:r}),pe(["a","A"],function(e,t,i){i._isPm=i._locale.isPM(e),i._meridiem=e}),pe(["h","hh"],function(e,t,i){t[_e]=w(e),p(i).bigHour=!0}),pe("hmm",function(e,t,i){var r=e.length-2;t[_e]=w(e.substr(0,r)),t[be]=w(e.substr(r)),p(i).bigHour=!0}),pe("hmmss",function(e,t,i){var r=e.length-4,n=e.length-2;t[_e]=w(e.substr(0,r)),t[be]=w(e.substr(r,2)),t[xe]=w(e.substr(n)),p(i).bigHour=!0}),pe("Hmm",function(e,t,i){var r=e.length-2;t[_e]=w(e.substr(0,r)),t[be]=w(e.substr(r))}),pe("Hmmss",function(e,t,i){var r=e.length-4,n=e.length-2;t[_e]=w(e.substr(0,r)),t[be]=w(e.substr(r,2)),t[xe]=w(e.substr(n))});var it,rt=Ne("Hours",!0),nt={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:Oe,monthsShort:Re,week:{dow:0,doy:6},weekdays:qe,weekdaysMin:Xe,weekdaysShort:Ye,meridiemParse:/[ap]\.?m?\.?/i},ot={},at={};function st(e){return e?e.toLowerCase().replace("_","-"):e}function lt(t){var i=null;if(!ot[t]&&void 0!==e&&e&&e.exports)try{i=it._abbr,!function(){var e=new Error('Cannot find module "./locale"');throw e.code="MODULE_NOT_FOUND",e}(),ut(i)}catch(e){}return ot[t]}function ut(e,t){var i;return e&&(i=a(t)?ct(e):ht(e,t))&&(it=i),it._abbr}function ht(e,t){if(null!==t){var i=nt;if(t.abbr=e,null!=ot[e])L("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),i=ot[e]._config;else if(null!=t.parentLocale){if(null==ot[t.parentLocale])return at[t.parentLocale]||(at[t.parentLocale]=[]),at[t.parentLocale].push({name:e,config:t}),null;i=ot[t.parentLocale]._config}return ot[e]=new k(P(i,t)),at[e]&&at[e].forEach(function(e){ht(e.name,e.config)}),ut(e),ot[e]}return delete ot[e],null}function ct(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return it;if(!n(e)){if(t=lt(e))return t;e=[e]}return function(e){for(var t,i,r,n,o=0;o<e.length;){for(n=st(e[o]).split("-"),t=n.length,i=(i=st(e[o+1]))?i.split("-"):null;t>0;){if(r=lt(n.slice(0,t).join("-")))return r;if(i&&i.length>=t&&S(n,i,!0)>=t-1)break;t--}o++}return null}(e)}function dt(e){var t,i=e._a;return i&&-2===p(e).overflow&&(t=i[ge]<0||i[ge]>11?ge:i[ye]<1||i[ye]>Ee(i[ve],i[ge])?ye:i[_e]<0||i[_e]>24||24===i[_e]&&(0!==i[be]||0!==i[xe]||0!==i[we])?_e:i[be]<0||i[be]>59?be:i[xe]<0||i[xe]>59?xe:i[we]<0||i[we]>999?we:-1,p(e)._overflowDayOfYear&&(t<ve||t>ye)&&(t=ye),p(e)._overflowWeeks&&-1===t&&(t=Se),p(e)._overflowWeekday&&-1===t&&(t=Me),p(e).overflow=t),e}function pt(e,t,i){return null!=e?e:null!=t?t:i}function ft(e){var t,i,n,o,a=[];if(!e._d){for(n=function(e){var t=new Date(r.now());return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}(e),e._w&&null==e._a[ye]&&null==e._a[ge]&&function(e){var t,i,r,n,o,a,s,l;if(null!=(t=e._w).GG||null!=t.W||null!=t.E)o=1,a=4,i=pt(t.GG,e._a[ve],We(Nt(),1,4).year),r=pt(t.W,1),((n=pt(t.E,1))<1||n>7)&&(l=!0);else{o=e._locale._week.dow,a=e._locale._week.doy;var u=We(Nt(),o,a);i=pt(t.gg,e._a[ve],u.year),r=pt(t.w,u.week),null!=t.d?((n=t.d)<0||n>6)&&(l=!0):null!=t.e?(n=t.e+o,(t.e<0||t.e>6)&&(l=!0)):n=o}r<1||r>He(i,o,a)?p(e)._overflowWeeks=!0:null!=l?p(e)._overflowWeekday=!0:(s=je(i,r,n,o,a),e._a[ve]=s.year,e._dayOfYear=s.dayOfYear)}(e),null!=e._dayOfYear&&(o=pt(e._a[ve],n[ve]),(e._dayOfYear>Te(o)||0===e._dayOfYear)&&(p(e)._overflowDayOfYear=!0),i=ze(o,0,e._dayOfYear),e._a[ge]=i.getUTCMonth(),e._a[ye]=i.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=a[t]=n[t];for(;t<7;t++)e._a[t]=a[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[_e]&&0===e._a[be]&&0===e._a[xe]&&0===e._a[we]&&(e._nextDay=!0,e._a[_e]=0),e._d=(e._useUTC?ze:function(e,t,i,r,n,o,a){var s=new Date(e,t,i,r,n,o,a);return e<100&&e>=0&&isFinite(s.getFullYear())&&s.setFullYear(e),s}).apply(null,a),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[_e]=24),e._w&&void 0!==e._w.d&&e._w.d!==e._d.getDay()&&(p(e).weekdayMismatch=!0)}}var mt=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,vt=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,gt=/Z|[+-]\d\d(?::?\d\d)?/,yt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],_t=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],bt=/^\/?Date\((\-?\d+)/i;function xt(e){var t,i,r,n,o,a,s=e._i,l=mt.exec(s)||vt.exec(s);if(l){for(p(e).iso=!0,t=0,i=yt.length;t<i;t++)if(yt[t][1].exec(l[1])){n=yt[t][0],r=!1!==yt[t][2];break}if(null==n)return void(e._isValid=!1);if(l[3]){for(t=0,i=_t.length;t<i;t++)if(_t[t][1].exec(l[3])){o=(l[2]||" ")+_t[t][0];break}if(null==o)return void(e._isValid=!1)}if(!r&&null!=o)return void(e._isValid=!1);if(l[4]){if(!gt.exec(l[4]))return void(e._isValid=!1);a="Z"}e._f=n+(o||"")+(a||""),At(e)}else e._isValid=!1}var wt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/;function St(e){var t=parseInt(e,10);return t<=49?2e3+t:t<=999?1900+t:t}var Mt={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Tt(e){var t,i,r,n,o,a,s,l=wt.exec(e._i.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim());if(l){var u=(t=l[4],i=l[3],r=l[2],n=l[5],o=l[6],a=l[7],s=[St(t),Re.indexOf(i),parseInt(r,10),parseInt(n,10),parseInt(o,10)],a&&s.push(parseInt(a,10)),s);if(!function(e,t,i){if(e){var r=Ye.indexOf(e),n=new Date(t[0],t[1],t[2]).getDay();if(r!==n)return p(i).weekdayMismatch=!0,i._isValid=!1,!1}return!0}(l[1],u,e))return;e._a=u,e._tzm=function(e,t,i){if(e)return Mt[e];if(t)return 0;var r=parseInt(i,10),n=r%100,o=(r-n)/100;return 60*o+n}(l[8],l[9],l[10]),e._d=ze.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),p(e).rfc2822=!0}else e._isValid=!1}function At(e){if(e._f!==r.ISO_8601)if(e._f!==r.RFC_2822){e._a=[],p(e).empty=!0;var t,i,n,o,a,s=""+e._i,l=s.length,u=0;for(n=H(e._f,e._locale).match(U)||[],t=0;t<n.length;t++)o=n[t],(i=(s.match(he(o,e))||[])[0])&&((a=s.substr(0,s.indexOf(i))).length>0&&p(e).unusedInput.push(a),s=s.slice(s.indexOf(i)+i.length),u+=i.length),G[o]?(i?p(e).empty=!1:p(e).unusedTokens.push(o),me(o,i,e)):e._strict&&!i&&p(e).unusedTokens.push(o);p(e).charsLeftOver=l-u,s.length>0&&p(e).unusedInput.push(s),e._a[_e]<=12&&!0===p(e).bigHour&&e._a[_e]>0&&(p(e).bigHour=void 0),p(e).parsedDateParts=e._a.slice(0),p(e).meridiem=e._meridiem,e._a[_e]=(h=e._locale,c=e._a[_e],null==(d=e._meridiem)?c:null!=h.meridiemHour?h.meridiemHour(c,d):null!=h.isPM?((f=h.isPM(d))&&c<12&&(c+=12),f||12!==c||(c=0),c):c),ft(e),dt(e)}else Tt(e);else xt(e);var h,c,d,f}function Ct(e){var t=e._i,i=e._f;return e._locale=e._locale||ct(e._l),null===t||void 0===i&&""===t?m({nullInput:!0}):("string"==typeof t&&(e._i=t=e._locale.preparse(t)),b(t)?new _(dt(t)):(l(t)?e._d=t:n(i)?function(e){var t,i,r,n,o;if(0===e._f.length)return p(e).invalidFormat=!0,void(e._d=new Date(NaN));for(n=0;n<e._f.length;n++)o=0,t=g({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[n],At(t),f(t)&&(o+=p(t).charsLeftOver,o+=10*p(t).unusedTokens.length,p(t).score=o,(null==r||o<r)&&(r=o,i=t));c(e,i||t)}(e):i?At(e):function(e){var t=e._i;a(t)?e._d=new Date(r.now()):l(t)?e._d=new Date(t.valueOf()):"string"==typeof t?function(e){var t=bt.exec(e._i);null===t?(xt(e),!1===e._isValid&&(delete e._isValid,Tt(e),!1===e._isValid&&(delete e._isValid,r.createFromInputFallback(e)))):e._d=new Date(+t[1])}(e):n(t)?(e._a=u(t.slice(0),function(e){return parseInt(e,10)}),ft(e)):o(t)?function(e){if(!e._d){var t=R(e._i);e._a=u([t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)}),ft(e)}}(e):s(t)?e._d=new Date(t):r.createFromInputFallback(e)}(e),f(e)||(e._d=null),e))}function Lt(e,t,i,r,a){var s,l={};return!0!==i&&!1!==i||(r=i,i=void 0),(o(e)&&function(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0}(e)||n(e)&&0===e.length)&&(e=void 0),l._isAMomentObject=!0,l._useUTC=l._isUTC=a,l._l=i,l._i=e,l._f=t,l._strict=r,(s=new _(dt(Ct(l))))._nextDay&&(s.add(1,"d"),s._nextDay=void 0),s}function Nt(e,t,i,r){return Lt(e,t,i,r,!1)}r.createFromInputFallback=T("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),r.ISO_8601=function(){},r.RFC_2822=function(){};var Pt=T("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Nt.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:m()}),kt=T("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Nt.apply(null,arguments);return this.isValid()&&e.isValid()?e>this?this:e:m()});function Et(e,t){var i,r;if(1===t.length&&n(t[0])&&(t=t[0]),!t.length)return Nt();for(i=t[0],r=1;r<t.length;++r)t[r].isValid()&&!t[r][e](i)||(i=t[r]);return i}var Dt=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Ot(e){var t=R(e),i=t.year||0,r=t.quarter||0,n=t.month||0,o=t.week||0,a=t.day||0,s=t.hour||0,l=t.minute||0,u=t.second||0,h=t.millisecond||0;this._isValid=function(e){for(var t in e)if(-1===Ce.call(Dt,t)||null!=e[t]&&isNaN(e[t]))return!1;for(var i=!1,r=0;r<Dt.length;++r)if(e[Dt[r]]){if(i)return!1;parseFloat(e[Dt[r]])!==w(e[Dt[r]])&&(i=!0)}return!0}(t),this._milliseconds=+h+1e3*u+6e4*l+1e3*s*60*60,this._days=+a+7*o,this._months=+n+3*r+12*i,this._data={},this._locale=ct(),this._bubble()}function Rt(e){return e instanceof Ot}function Ft(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function It(e,t){j(e,0,0,function(){var e=this.utcOffset(),i="+";return e<0&&(e=-e,i="-"),i+B(~~(e/60),2)+t+B(~~e%60,2)})}It("Z",":"),It("ZZ",""),ue("Z",ae),ue("ZZ",ae),pe(["Z","ZZ"],function(e,t,i){i._useUTC=!0,i._tzm=Ut(ae,e)});var Bt=/([\+\-]|\d\d)/gi;function Ut(e,t){var i=(t||"").match(e);if(null===i)return null;var r=i[i.length-1]||[],n=(r+"").match(Bt)||["-",0,0],o=60*n[1]+w(n[2]);return 0===o?0:"+"===n[0]?o:-o}function Vt(e,t){var i,n;return t._isUTC?(i=t.clone(),n=(b(e)||l(e)?e.valueOf():Nt(e).valueOf())-i.valueOf(),i._d.setTime(i._d.valueOf()+n),r.updateOffset(i,!1),i):Nt(e).local()}function zt(e){return 15*-Math.round(e._d.getTimezoneOffset()/15)}function Gt(){return!!this.isValid()&&this._isUTC&&0===this._offset}r.updateOffset=function(){};var jt=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,Wt=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function Ht(e,t){var i,r,n,o,a,l,u=e,c=null;return Rt(e)?u={ms:e._milliseconds,d:e._days,M:e._months}:s(e)?(u={},t?u[t]=e:u.milliseconds=e):(c=jt.exec(e))?(i="-"===c[1]?-1:1,u={y:0,d:w(c[ye])*i,h:w(c[_e])*i,m:w(c[be])*i,s:w(c[xe])*i,ms:w(Ft(1e3*c[we]))*i}):(c=Wt.exec(e))?(i="-"===c[1]?-1:(c[1],1),u={y:qt(c[2],i),M:qt(c[3],i),w:qt(c[4],i),d:qt(c[5],i),h:qt(c[6],i),m:qt(c[7],i),s:qt(c[8],i)}):null==u?u={}:"object"==typeof u&&("from"in u||"to"in u)&&(o=Nt(u.from),a=Nt(u.to),n=o.isValid()&&a.isValid()?(a=Vt(a,o),o.isBefore(a)?l=Yt(o,a):((l=Yt(a,o)).milliseconds=-l.milliseconds,l.months=-l.months),l):{milliseconds:0,months:0},(u={}).ms=n.milliseconds,u.M=n.months),r=new Ot(u),Rt(e)&&h(e,"_locale")&&(r._locale=e._locale),r}function qt(e,t){var i=e&&parseFloat(e.replace(",","."));return(isNaN(i)?0:i)*t}function Yt(e,t){var i={milliseconds:0,months:0};return i.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(i.months,"M").isAfter(t)&&--i.months,i.milliseconds=+t-+e.clone().add(i.months,"M"),i}function Xt(e,t){return function(i,r){var n;return null===r||isNaN(+r)||(L(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),n=i,i=r,r=n),Kt(this,Ht(i="string"==typeof i?+i:i,r),e),this}}function Kt(e,t,i,n){var o=t._milliseconds,a=Ft(t._days),s=Ft(t._months);e.isValid()&&(n=null==n||n,s&&Fe(e,Pe(e,"Month")+s*i),a&&ke(e,"Date",Pe(e,"Date")+a*i),o&&e._d.setTime(e._d.valueOf()+o*i),n&&r.updateOffset(e,a||s))}Ht.fn=Ot.prototype,Ht.invalid=function(){return Ht(NaN)};var Qt=Xt(1,"add"),Zt=Xt(-1,"subtract");function Jt(e,t){var i,r,n=12*(t.year()-e.year())+(t.month()-e.month()),o=e.clone().add(n,"months");return t-o<0?(i=e.clone().add(n-1,"months"),r=(t-o)/(o-i)):(i=e.clone().add(n+1,"months"),r=(t-o)/(i-o)),-(n+r)||0}function $t(e){var t;return void 0===e?this._locale._abbr:(null!=(t=ct(e))&&(this._locale=t),this)}r.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",r.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var ei=T("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});function ti(){return this._locale}function ii(e,t){j(0,[e,e.length],0,t)}function ri(e,t,i,r,n){var o;return null==e?We(this,r,n).year:(o=He(e,r,n),t>o&&(t=o),function(e,t,i,r,n){var o=je(e,t,i,r,n),a=ze(o.year,0,o.dayOfYear);return this.year(a.getUTCFullYear()),this.month(a.getUTCMonth()),this.date(a.getUTCDate()),this}.call(this,e,t,i,r,n))}j(0,["gg",2],0,function(){return this.weekYear()%100}),j(0,["GG",2],0,function(){return this.isoWeekYear()%100}),ii("gggg","weekYear"),ii("ggggg","weekYear"),ii("GGGG","isoWeekYear"),ii("GGGGG","isoWeekYear"),D("weekYear","gg"),D("isoWeekYear","GG"),I("weekYear",1),I("isoWeekYear",1),ue("G",ne),ue("g",ne),ue("GG",Z,Y),ue("gg",Z,Y),ue("GGGG",te,K),ue("gggg",te,K),ue("GGGGG",ie,Q),ue("ggggg",ie,Q),fe(["gggg","ggggg","GGGG","GGGGG"],function(e,t,i,r){t[r.substr(0,2)]=w(e)}),fe(["gg","GG"],function(e,t,i,n){t[n]=r.parseTwoDigitYear(e)}),j("Q",0,"Qo","quarter"),D("quarter","Q"),I("quarter",7),ue("Q",q),pe("Q",function(e,t){t[ge]=3*(w(e)-1)}),j("D",["DD",2],"Do","date"),D("date","D"),I("date",9),ue("D",Z),ue("DD",Z,Y),ue("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),pe(["D","DD"],ye),pe("Do",function(e,t){t[ye]=w(e.match(Z)[0])});var ni=Ne("Date",!0);j("DDD",["DDDD",3],"DDDo","dayOfYear"),D("dayOfYear","DDD"),I("dayOfYear",4),ue("DDD",ee),ue("DDDD",X),pe(["DDD","DDDD"],function(e,t,i){i._dayOfYear=w(e)}),j("m",["mm",2],0,"minute"),D("minute","m"),I("minute",14),ue("m",Z),ue("mm",Z,Y),pe(["m","mm"],be);var oi=Ne("Minutes",!1);j("s",["ss",2],0,"second"),D("second","s"),I("second",15),ue("s",Z),ue("ss",Z,Y),pe(["s","ss"],xe);var ai,si=Ne("Seconds",!1);for(j("S",0,0,function(){return~~(this.millisecond()/100)}),j(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),j(0,["SSS",3],0,"millisecond"),j(0,["SSSS",4],0,function(){return 10*this.millisecond()}),j(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),j(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),j(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),j(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),j(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),D("millisecond","ms"),I("millisecond",16),ue("S",ee,q),ue("SS",ee,Y),ue("SSS",ee,X),ai="SSSS";ai.length<=9;ai+="S")ue(ai,re);function li(e,t){t[we]=w(1e3*("0."+e))}for(ai="S";ai.length<=9;ai+="S")pe(ai,li);var ui=Ne("Milliseconds",!1);j("z",0,0,"zoneAbbr"),j("zz",0,0,"zoneName");var hi=_.prototype;function ci(e){return e}hi.add=Qt,hi.calendar=function(e,t){var i=e||Nt(),n=Vt(i,this).startOf("day"),o=r.calendarFormat(this,n)||"sameElse",a=t&&(N(t[o])?t[o].call(this,i):t[o]);return this.format(a||this.localeData().calendar(o,this,Nt(i)))},hi.clone=function(){return new _(this)},hi.diff=function(e,t,i){var r,n,o;if(!this.isValid())return NaN;if(!(r=Vt(e,this)).isValid())return NaN;switch(n=6e4*(r.utcOffset()-this.utcOffset()),t=O(t)){case"year":o=Jt(this,r)/12;break;case"month":o=Jt(this,r);break;case"quarter":o=Jt(this,r)/3;break;case"second":o=(this-r)/1e3;break;case"minute":o=(this-r)/6e4;break;case"hour":o=(this-r)/36e5;break;case"day":o=(this-r-n)/864e5;break;case"week":o=(this-r-n)/6048e5;break;default:o=this-r}return i?o:x(o)},hi.endOf=function(e){return void 0===(e=O(e))||"millisecond"===e?this:("date"===e&&(e="day"),this.startOf(e).add(1,"isoWeek"===e?"week":e).subtract(1,"ms"))},hi.format=function(e){e||(e=this.isUtc()?r.defaultFormatUtc:r.defaultFormat);var t=W(this,e);return this.localeData().postformat(t)},hi.from=function(e,t){return this.isValid()&&(b(e)&&e.isValid()||Nt(e).isValid())?Ht({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},hi.fromNow=function(e){return this.from(Nt(),e)},hi.to=function(e,t){return this.isValid()&&(b(e)&&e.isValid()||Nt(e).isValid())?Ht({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},hi.toNow=function(e){return this.to(Nt(),e)},hi.get=function(e){return N(this[e=O(e)])?this[e]():this},hi.invalidAt=function(){return p(this).overflow},hi.isAfter=function(e,t){var i=b(e)?e:Nt(e);return!(!this.isValid()||!i.isValid())&&("millisecond"===(t=O(a(t)?"millisecond":t))?this.valueOf()>i.valueOf():i.valueOf()<this.clone().startOf(t).valueOf())},hi.isBefore=function(e,t){var i=b(e)?e:Nt(e);return!(!this.isValid()||!i.isValid())&&("millisecond"===(t=O(a(t)?"millisecond":t))?this.valueOf()<i.valueOf():this.clone().endOf(t).valueOf()<i.valueOf())},hi.isBetween=function(e,t,i,r){return("("===(r=r||"()")[0]?this.isAfter(e,i):!this.isBefore(e,i))&&(")"===r[1]?this.isBefore(t,i):!this.isAfter(t,i))},hi.isSame=function(e,t){var i,r=b(e)?e:Nt(e);return!(!this.isValid()||!r.isValid())&&("millisecond"===(t=O(t||"millisecond"))?this.valueOf()===r.valueOf():(i=r.valueOf(),this.clone().startOf(t).valueOf()<=i&&i<=this.clone().endOf(t).valueOf()))},hi.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},hi.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},hi.isValid=function(){return f(this)},hi.lang=ei,hi.locale=$t,hi.localeData=ti,hi.max=kt,hi.min=Pt,hi.parsingFlags=function(){return c({},p(this))},hi.set=function(e,t){if("object"==typeof e)for(var i=function(e){var t=[];for(var i in e)t.push({unit:i,priority:F[i]});return t.sort(function(e,t){return e.priority-t.priority}),t}(e=R(e)),r=0;r<i.length;r++)this[i[r].unit](e[i[r].unit]);else if(N(this[e=O(e)]))return this[e](t);return this},hi.startOf=function(e){switch(e=O(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":case"date":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e&&this.weekday(0),"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},hi.subtract=Zt,hi.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},hi.toObject=function(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},hi.toDate=function(){return new Date(this.valueOf())},hi.toISOString=function(){if(!this.isValid())return null;var e=this.clone().utc();return e.year()<0||e.year()>9999?W(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):N(Date.prototype.toISOString)?this.toDate().toISOString():W(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},hi.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e="moment",t="";this.isLocal()||(e=0===this.utcOffset()?"moment.utc":"moment.parseZone",t="Z");var i="["+e+'("]',r=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",n=t+'[")]';return this.format(i+r+"-MM-DD[T]HH:mm:ss.SSS"+n)},hi.toJSON=function(){return this.isValid()?this.toISOString():null},hi.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},hi.unix=function(){return Math.floor(this.valueOf()/1e3)},hi.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},hi.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},hi.year=Le,hi.isLeapYear=function(){return Ae(this.year())},hi.weekYear=function(e){return ri.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},hi.isoWeekYear=function(e){return ri.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},hi.quarter=hi.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},hi.month=Ie,hi.daysInMonth=function(){return Ee(this.year(),this.month())},hi.week=hi.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},hi.isoWeek=hi.isoWeeks=function(e){var t=We(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},hi.weeksInYear=function(){var e=this.localeData()._week;return He(this.year(),e.dow,e.doy)},hi.isoWeeksInYear=function(){return He(this.year(),1,4)},hi.date=ni,hi.day=hi.days=function(e){if(!this.isValid())return null!=e?this:NaN;var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=function(e,t){return"string"!=typeof e?e:isNaN(e)?"number"==typeof(e=t.weekdaysParse(e))?e:null:parseInt(e,10)}(e,this.localeData()),this.add(e-t,"d")):t},hi.weekday=function(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},hi.isoWeekday=function(e){if(!this.isValid())return null!=e?this:NaN;if(null!=e){var t=function(e,t){return"string"==typeof e?t.weekdaysParse(e)%7||7:isNaN(e)?null:e}(e,this.localeData());return this.day(this.day()%7?t:t-7)}return this.day()||7},hi.dayOfYear=function(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},hi.hour=hi.hours=rt,hi.minute=hi.minutes=oi,hi.second=hi.seconds=si,hi.millisecond=hi.milliseconds=ui,hi.utcOffset=function(e,t,i){var n,o=this._offset||0;if(!this.isValid())return null!=e?this:NaN;if(null!=e){if("string"==typeof e){if(null===(e=Ut(ae,e)))return this}else Math.abs(e)<16&&!i&&(e*=60);return!this._isUTC&&t&&(n=zt(this)),this._offset=e,this._isUTC=!0,null!=n&&this.add(n,"m"),o!==e&&(!t||this._changeInProgress?Kt(this,Ht(e-o,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,r.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?o:zt(this)},hi.utc=function(e){return this.utcOffset(0,e)},hi.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(zt(this),"m")),this},hi.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var e=Ut(oe,this._i);null!=e?this.utcOffset(e):this.utcOffset(0,!0)}return this},hi.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?Nt(e).utcOffset():0,(this.utcOffset()-e)%60==0)},hi.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},hi.isLocal=function(){return!!this.isValid()&&!this._isUTC},hi.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},hi.isUtc=Gt,hi.isUTC=Gt,hi.zoneAbbr=function(){return this._isUTC?"UTC":""},hi.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},hi.dates=T("dates accessor is deprecated. Use date instead.",ni),hi.months=T("months accessor is deprecated. Use month instead",Ie),hi.years=T("years accessor is deprecated. Use year instead",Le),hi.zone=T("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}),hi.isDSTShifted=T("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!a(this._isDSTShifted))return this._isDSTShifted;var e={};if(g(e,this),(e=Ct(e))._a){var t=e._isUTC?d(e._a):Nt(e._a);this._isDSTShifted=this.isValid()&&S(e._a,t.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted});var di=k.prototype;function pi(e,t,i,r){var n=ct(),o=d().set(r,t);return n[i](o,e)}function fi(e,t,i){if(s(e)&&(t=e,e=void 0),e=e||"",null!=t)return pi(e,t,i,"month");var r,n=[];for(r=0;r<12;r++)n[r]=pi(e,r,i,"month");return n}function mi(e,t,i,r){"boolean"==typeof e?(s(t)&&(i=t,t=void 0),t=t||""):(i=t=e,e=!1,s(t)&&(i=t,t=void 0),t=t||"");var n,o=ct(),a=e?o._week.dow:0;if(null!=i)return pi(t,(i+a)%7,r,"day");var l=[];for(n=0;n<7;n++)l[n]=pi(t,(n+a)%7,r,"day");return l}di.calendar=function(e,t,i){var r=this._calendar[e]||this._calendar.sameElse;return N(r)?r.call(t,i):r},di.longDateFormat=function(e){var t=this._longDateFormat[e],i=this._longDateFormat[e.toUpperCase()];return t||!i?t:(this._longDateFormat[e]=i.replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e])},di.invalidDate=function(){return this._invalidDate},di.ordinal=function(e){return this._ordinal.replace("%d",e)},di.preparse=ci,di.postformat=ci,di.relativeTime=function(e,t,i,r){var n=this._relativeTime[i];return N(n)?n(e,t,i,r):n.replace(/%d/i,e)},di.pastFuture=function(e,t){var i=this._relativeTime[e>0?"future":"past"];return N(i)?i(t):i.replace(/%s/i,t)},di.set=function(e){var t,i;for(i in e)N(t=e[i])?this[i]=t:this["_"+i]=t;this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},di.months=function(e,t){return e?n(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||De).test(t)?"format":"standalone"][e.month()]:n(this._months)?this._months:this._months.standalone},di.monthsShort=function(e,t){return e?n(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[De.test(t)?"format":"standalone"][e.month()]:n(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},di.monthsParse=function(e,t,i){var r,n,o;if(this._monthsParseExact)return function(e,t,i){var r,n,o,a=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],r=0;r<12;++r)o=d([2e3,r]),this._shortMonthsParse[r]=this.monthsShort(o,"").toLocaleLowerCase(),this._longMonthsParse[r]=this.months(o,"").toLocaleLowerCase();return i?"MMM"===t?-1!==(n=Ce.call(this._shortMonthsParse,a))?n:null:-1!==(n=Ce.call(this._longMonthsParse,a))?n:null:"MMM"===t?-1!==(n=Ce.call(this._shortMonthsParse,a))?n:-1!==(n=Ce.call(this._longMonthsParse,a))?n:null:-1!==(n=Ce.call(this._longMonthsParse,a))?n:-1!==(n=Ce.call(this._shortMonthsParse,a))?n:null}.call(this,e,t,i);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),r=0;r<12;r++){if(n=d([2e3,r]),i&&!this._longMonthsParse[r]&&(this._longMonthsParse[r]=new RegExp("^"+this.months(n,"").replace(".","")+"$","i"),this._shortMonthsParse[r]=new RegExp("^"+this.monthsShort(n,"").replace(".","")+"$","i")),i||this._monthsParse[r]||(o="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[r]=new RegExp(o.replace(".",""),"i")),i&&"MMMM"===t&&this._longMonthsParse[r].test(e))return r;if(i&&"MMM"===t&&this._shortMonthsParse[r].test(e))return r;if(!i&&this._monthsParse[r].test(e))return r}},di.monthsRegex=function(e){return this._monthsParseExact?(h(this,"_monthsRegex")||Ve.call(this),e?this._monthsStrictRegex:this._monthsRegex):(h(this,"_monthsRegex")||(this._monthsRegex=Ue),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},di.monthsShortRegex=function(e){return this._monthsParseExact?(h(this,"_monthsRegex")||Ve.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(h(this,"_monthsShortRegex")||(this._monthsShortRegex=Be),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},di.week=function(e){return We(e,this._week.dow,this._week.doy).week},di.firstDayOfYear=function(){return this._week.doy},di.firstDayOfWeek=function(){return this._week.dow},di.weekdays=function(e,t){return e?n(this._weekdays)?this._weekdays[e.day()]:this._weekdays[this._weekdays.isFormat.test(t)?"format":"standalone"][e.day()]:n(this._weekdays)?this._weekdays:this._weekdays.standalone},di.weekdaysMin=function(e){return e?this._weekdaysMin[e.day()]:this._weekdaysMin},di.weekdaysShort=function(e){return e?this._weekdaysShort[e.day()]:this._weekdaysShort},di.weekdaysParse=function(e,t,i){var r,n,o;if(this._weekdaysParseExact)return function(e,t,i){var r,n,o,a=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],r=0;r<7;++r)o=d([2e3,1]).day(r),this._minWeekdaysParse[r]=this.weekdaysMin(o,"").toLocaleLowerCase(),this._shortWeekdaysParse[r]=this.weekdaysShort(o,"").toLocaleLowerCase(),this._weekdaysParse[r]=this.weekdays(o,"").toLocaleLowerCase();return i?"dddd"===t?-1!==(n=Ce.call(this._weekdaysParse,a))?n:null:"ddd"===t?-1!==(n=Ce.call(this._shortWeekdaysParse,a))?n:null:-1!==(n=Ce.call(this._minWeekdaysParse,a))?n:null:"dddd"===t?-1!==(n=Ce.call(this._weekdaysParse,a))?n:-1!==(n=Ce.call(this._shortWeekdaysParse,a))?n:-1!==(n=Ce.call(this._minWeekdaysParse,a))?n:null:"ddd"===t?-1!==(n=Ce.call(this._shortWeekdaysParse,a))?n:-1!==(n=Ce.call(this._weekdaysParse,a))?n:-1!==(n=Ce.call(this._minWeekdaysParse,a))?n:null:-1!==(n=Ce.call(this._minWeekdaysParse,a))?n:-1!==(n=Ce.call(this._weekdaysParse,a))?n:-1!==(n=Ce.call(this._shortWeekdaysParse,a))?n:null}.call(this,e,t,i);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),r=0;r<7;r++){if(n=d([2e3,1]).day(r),i&&!this._fullWeekdaysParse[r]&&(this._fullWeekdaysParse[r]=new RegExp("^"+this.weekdays(n,"").replace(".",".?")+"$","i"),this._shortWeekdaysParse[r]=new RegExp("^"+this.weekdaysShort(n,"").replace(".",".?")+"$","i"),this._minWeekdaysParse[r]=new RegExp("^"+this.weekdaysMin(n,"").replace(".",".?")+"$","i")),this._weekdaysParse[r]||(o="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[r]=new RegExp(o.replace(".",""),"i")),i&&"dddd"===t&&this._fullWeekdaysParse[r].test(e))return r;if(i&&"ddd"===t&&this._shortWeekdaysParse[r].test(e))return r;if(i&&"dd"===t&&this._minWeekdaysParse[r].test(e))return r;if(!i&&this._weekdaysParse[r].test(e))return r}},di.weekdaysRegex=function(e){return this._weekdaysParseExact?(h(this,"_weekdaysRegex")||Je.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(h(this,"_weekdaysRegex")||(this._weekdaysRegex=Ke),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},di.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(h(this,"_weekdaysRegex")||Je.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(h(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=Qe),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},di.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(h(this,"_weekdaysRegex")||Je.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(h(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Ze),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},di.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},di.meridiem=function(e,t,i){return e>11?i?"pm":"PM":i?"am":"AM"},ut("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,i=1===w(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+i}}),r.lang=T("moment.lang is deprecated. Use moment.locale instead.",ut),r.langData=T("moment.langData is deprecated. Use moment.localeData instead.",ct);var vi=Math.abs;function gi(e,t,i,r){var n=Ht(t,i);return e._milliseconds+=r*n._milliseconds,e._days+=r*n._days,e._months+=r*n._months,e._bubble()}function yi(e){return e<0?Math.floor(e):Math.ceil(e)}function _i(e){return 4800*e/146097}function bi(e){return 146097*e/4800}function xi(e){return function(){return this.as(e)}}var wi=xi("ms"),Si=xi("s"),Mi=xi("m"),Ti=xi("h"),Ai=xi("d"),Ci=xi("w"),Li=xi("M"),Ni=xi("y");function Pi(e){return function(){return this.isValid()?this._data[e]:NaN}}var ki=Pi("milliseconds"),Ei=Pi("seconds"),Di=Pi("minutes"),Oi=Pi("hours"),Ri=Pi("days"),Fi=Pi("months"),Ii=Pi("years"),Bi=Math.round,Ui={ss:44,s:45,m:45,h:22,d:26,M:11},Vi=Math.abs;function zi(e){return(e>0)-(e<0)||+e}function Gi(){if(!this.isValid())return this.localeData().invalidDate();var e,t,i=Vi(this._milliseconds)/1e3,r=Vi(this._days),n=Vi(this._months);e=x(i/60),t=x(e/60),i%=60,e%=60;var o=x(n/12),a=n%=12,s=r,l=t,u=e,h=i?i.toFixed(3).replace(/\.?0+$/,""):"",c=this.asSeconds();if(!c)return"P0D";var d=c<0?"-":"",p=zi(this._months)!==zi(c)?"-":"",f=zi(this._days)!==zi(c)?"-":"",m=zi(this._milliseconds)!==zi(c)?"-":"";return d+"P"+(o?p+o+"Y":"")+(a?p+a+"M":"")+(s?f+s+"D":"")+(l||u||h?"T":"")+(l?m+l+"H":"")+(u?m+u+"M":"")+(h?m+h+"S":"")}var ji=Ot.prototype;return ji.isValid=function(){return this._isValid},ji.abs=function(){var e=this._data;return this._milliseconds=vi(this._milliseconds),this._days=vi(this._days),this._months=vi(this._months),e.milliseconds=vi(e.milliseconds),e.seconds=vi(e.seconds),e.minutes=vi(e.minutes),e.hours=vi(e.hours),e.months=vi(e.months),e.years=vi(e.years),this},ji.add=function(e,t){return gi(this,e,t,1)},ji.subtract=function(e,t){return gi(this,e,t,-1)},ji.as=function(e){if(!this.isValid())return NaN;var t,i,r=this._milliseconds;if("month"===(e=O(e))||"year"===e)return t=this._days+r/864e5,i=this._months+_i(t),"month"===e?i:i/12;switch(t=this._days+Math.round(bi(this._months)),e){case"week":return t/7+r/6048e5;case"day":return t+r/864e5;case"hour":return 24*t+r/36e5;case"minute":return 1440*t+r/6e4;case"second":return 86400*t+r/1e3;case"millisecond":return Math.floor(864e5*t)+r;default:throw new Error("Unknown unit "+e)}},ji.asMilliseconds=wi,ji.asSeconds=Si,ji.asMinutes=Mi,ji.asHours=Ti,ji.asDays=Ai,ji.asWeeks=Ci,ji.asMonths=Li,ji.asYears=Ni,ji.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*w(this._months/12):NaN},ji._bubble=function(){var e,t,i,r,n,o=this._milliseconds,a=this._days,s=this._months,l=this._data;return o>=0&&a>=0&&s>=0||o<=0&&a<=0&&s<=0||(o+=864e5*yi(bi(s)+a),a=0,s=0),l.milliseconds=o%1e3,e=x(o/1e3),l.seconds=e%60,t=x(e/60),l.minutes=t%60,i=x(t/60),l.hours=i%24,a+=x(i/24),n=x(_i(a)),s+=n,a-=yi(bi(n)),r=x(s/12),s%=12,l.days=a,l.months=s,l.years=r,this},ji.clone=function(){return Ht(this)},ji.get=function(e){return e=O(e),this.isValid()?this[e+"s"]():NaN},ji.milliseconds=ki,ji.seconds=Ei,ji.minutes=Di,ji.hours=Oi,ji.days=Ri,ji.weeks=function(){return x(this.days()/7)},ji.months=Fi,ji.years=Ii,ji.humanize=function(e){if(!this.isValid())return this.localeData().invalidDate();var t=this.localeData(),i=function(e,t,i){var r=Ht(e).abs(),n=Bi(r.as("s")),o=Bi(r.as("m")),a=Bi(r.as("h")),s=Bi(r.as("d")),l=Bi(r.as("M")),u=Bi(r.as("y")),h=n<=Ui.ss&&["s",n]||n<Ui.s&&["ss",n]||o<=1&&["m"]||o<Ui.m&&["mm",o]||a<=1&&["h"]||a<Ui.h&&["hh",a]||s<=1&&["d"]||s<Ui.d&&["dd",s]||l<=1&&["M"]||l<Ui.M&&["MM",l]||u<=1&&["y"]||["yy",u];return h[2]=t,h[3]=+e>0,h[4]=i,function(e,t,i,r,n){return n.relativeTime(t||1,!!i,e,r)}.apply(null,h)}(this,!e,t);return e&&(i=t.pastFuture(+this,i)),t.postformat(i)},ji.toISOString=Gi,ji.toString=Gi,ji.toJSON=Gi,ji.locale=$t,ji.localeData=ti,ji.toIsoString=T("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Gi),ji.lang=ei,j("X",0,0,"unix"),j("x",0,0,"valueOf"),ue("x",ne),ue("X",/[+-]?\d+(\.\d{1,3})?/),pe("X",function(e,t,i){i._d=new Date(1e3*parseFloat(e,10))}),pe("x",function(e,t,i){i._d=new Date(w(e))}),r.version="2.19.1",t=Nt,r.fn=hi,r.min=function(){return Et("isBefore",[].slice.call(arguments,0))},r.max=function(){return Et("isAfter",[].slice.call(arguments,0))},r.now=function(){return Date.now?Date.now():+new Date},r.utc=d,r.unix=function(e){return Nt(1e3*e)},r.months=function(e,t){return fi(e,t,"months")},r.isDate=l,r.locale=ut,r.invalid=m,r.duration=Ht,r.isMoment=b,r.weekdays=function(e,t,i){return mi(e,t,i,"weekdays")},r.parseZone=function(){return Nt.apply(null,arguments).parseZone()},r.localeData=ct,r.isDuration=Rt,r.monthsShort=function(e,t){return fi(e,t,"monthsShort")},r.weekdaysMin=function(e,t,i){return mi(e,t,i,"weekdaysMin")},r.defineLocale=ht,r.updateLocale=function(e,t){if(null!=t){var i,r=nt;null!=ot[e]&&(r=ot[e]._config),t=P(r,t),(i=new k(t)).parentLocale=ot[e],ot[e]=i,ut(e)}else null!=ot[e]&&(null!=ot[e].parentLocale?ot[e]=ot[e].parentLocale:null!=ot[e]&&delete ot[e]);return ot[e]},r.locales=function(){return A(ot)},r.weekdaysShort=function(e,t,i){return mi(e,t,i,"weekdaysShort")},r.normalizeUnits=O,r.relativeTimeRounding=function(e){return void 0===e?Bi:"function"==typeof e&&(Bi=e,!0)},r.relativeTimeThreshold=function(e,t){return void 0!==Ui[e]&&(void 0===t?Ui[e]:(Ui[e]=t,"s"===e&&(Ui.ss=t-1),!0))},r.calendarFormat=function(e,t){var i=e.diff(t,"days",!0);return i<-6?"sameElse":i<-1?"lastWeek":i<0?"lastDay":i<1?"sameDay":i<2?"nextDay":i<7?"nextWeek":"sameElse"},r.prototype=hi,r}()}).call(t,i(155)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){function i(e){throw new Error("Cannot find module '"+e+"'.")}i.keys=function(){return[]},i.resolve=i,e.exports=i,i.id=156},function(e,t,i){(function(t){var i,r="undefined"!=typeof window?window:void 0!==t?t:null;if(r&&r.crypto&&crypto.getRandomValues){var n=new Uint8Array(16);i=function(){return crypto.getRandomValues(n),n}}if(!i){var o=new Array(16);i=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}for(var a=[],s={},l=0;l<256;l++)a[l]=(l+256).toString(16).substr(1),s[a[l]]=l;function u(e,t){var i=t||0,r=a;return r[e[i++]]+r[e[i++]]+r[e[i++]]+r[e[i++]]+"-"+r[e[i++]]+r[e[i++]]+"-"+r[e[i++]]+r[e[i++]]+"-"+r[e[i++]]+r[e[i++]]+"-"+r[e[i++]]+r[e[i++]]+r[e[i++]]+r[e[i++]]+r[e[i++]]+r[e[i++]]}var h=i(),c=[1|h[0],h[1],h[2],h[3],h[4],h[5]],d=16383&(h[6]<<8|h[7]),p=0,f=0;function m(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||i)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var a=0;a<16;a++)t[n+a]=o[a];return t||u(o)}var v=m;v.v1=function(e,t,i){var r=t&&i||0,n=t||[],o=void 0!==(e=e||{}).clockseq?e.clockseq:d,a=void 0!==e.msecs?e.msecs:(new Date).getTime(),s=void 0!==e.nsecs?e.nsecs:f+1,l=a-p+(s-f)/1e4;if(l<0&&void 0===e.clockseq&&(o=o+1&16383),(l<0||a>p)&&void 0===e.nsecs&&(s=0),s>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=a,f=s,d=o;var h=(1e4*(268435455&(a+=122192928e5))+s)%4294967296;n[r++]=h>>>24&255,n[r++]=h>>>16&255,n[r++]=h>>>8&255,n[r++]=255&h;var m=a/4294967296*1e4&268435455;n[r++]=m>>>8&255,n[r++]=255&m,n[r++]=m>>>24&15|16,n[r++]=m>>>16&255,n[r++]=o>>>8|128,n[r++]=255&o;for(var v=e.node||c,g=0;g<6;g++)n[r+g]=v[g];return t||u(n)},v.v4=m,v.parse=function(e,t,i){var r=t&&i||0,n=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){n<16&&(t[r+n++]=s[e])});n<16;)t[r+n++]=0;return t},v.unparse=u,e.exports=v}).call(t,i(158))},function(e,t){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){t.util=i(2),t.DOMutil=i(14),t.DataSet=i(11),t.DataView=i(12),t.Queue=i(43),t.Graph3d=i(161),t.graph3d={Camera:i(95),Filter:i(96),Point2d:i(91),Point3d:i(34),Slider:i(92),StepNumber:i(93)},t.moment=i(9),t.Hammer=i(10),t.keycharm=i(35)},function(e,t,i){var r=i(7),n=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return n.stringify.apply(n,arguments)}},function(e,t,i){var r,n=i(90),o=(r=n)&&r.__esModule?r:{default:r};var a=i(44),s=i(2),l=i(34),u=i(91),h=i(92),c=i(93),d=i(94),p=i(15).default,f=i(15).printStyle,m=i(172).allOptions,v=i(173);g.STYLE=d.STYLE;function g(e,t,i){if(!(this instanceof g))throw new SyntaxError("Constructor must be called with the new operator");this.containerElement=e,this.dataGroup=new v,this.dataPoints=null,this.create(),d.setDefaults(g.DEFAULTS,this),this.colX=void 0,this.colY=void 0,this.colZ=void 0,this.colValue=void 0,this.setOptions(i),this.setData(t)}function y(e){return"clientX"in e?e.clientX:e.targetTouches[0]&&e.targetTouches[0].clientX||0}function _(e){return"clientY"in e?e.clientY:e.targetTouches[0]&&e.targetTouches[0].clientY||0}g.DEFAULTS={width:"400px",height:"400px",filterLabel:"time",legendLabel:"value",xLabel:"x",yLabel:"y",zLabel:"z",xValueLabel:function(e){return e},yValueLabel:function(e){return e},zValueLabel:function(e){return e},showXAxis:!0,showYAxis:!0,showZAxis:!0,showGrid:!0,showPerspective:!0,showShadow:!1,keepAspectRatio:!0,verticalRatio:.5,dotSizeRatio:.02,dotSizeMinFraction:.5,dotSizeMaxFraction:2.5,showAnimationControls:void 0,animationInterval:1e3,animationPreload:!1,animationAutoStart:void 0,axisColor:"#4D4D4D",gridColor:"#D3D3D3",xCenter:"55%",yCenter:"50%",style:g.STYLE.DOT,tooltip:!1,tooltipStyle:{content:{padding:"10px",border:"1px solid #4d4d4d",color:"#1a1a1a",background:"rgba(255,255,255,0.7)",borderRadius:"2px",boxShadow:"5px 5px 10px rgba(128,128,128,0.5)"},line:{height:"40px",width:"0",borderLeft:"1px solid #4d4d4d"},dot:{height:"0",width:"0",border:"5px solid #4d4d4d",borderRadius:"5px"}},dataColor:{fill:"#7DC1FF",stroke:"#3267D2",strokeWidth:1},cameraPosition:{horizontal:1,vertical:.5,distance:1.7},showLegend:void 0,backgroundColor:void 0,xBarWidth:void 0,yBarWidth:void 0,valueMin:void 0,valueMax:void 0,xMin:void 0,xMax:void 0,xStep:void 0,yMin:void 0,yMax:void 0,yStep:void 0,zMin:void 0,zMax:void 0,zStep:void 0},a(g.prototype),g.prototype._setScale=function(){this.scale=new l(1/this.xRange.range(),1/this.yRange.range(),1/this.zRange.range()),this.keepAspectRatio&&(this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y),this.scale.z*=this.verticalRatio,void 0!==this.valueRange&&(this.scale.value=1/this.valueRange.range());var e=this.xRange.center()*this.scale.x,t=this.yRange.center()*this.scale.y,i=this.zRange.center()*this.scale.z;this.camera.setArmLocation(e,t,i)},g.prototype._convert3Dto2D=function(e){var t=this._convertPointToTranslation(e);return this._convertTranslationToScreen(t)},g.prototype._convertPointToTranslation=function(e){var t=this.camera.getCameraLocation(),i=this.camera.getCameraRotation(),r=e.x*this.scale.x,n=e.y*this.scale.y,o=e.z*this.scale.z,a=t.x,s=t.y,u=t.z,h=Math.sin(i.x),c=Math.cos(i.x),d=Math.sin(i.y),p=Math.cos(i.y),f=Math.sin(i.z),m=Math.cos(i.z);return new l(p*(f*(n-s)+m*(r-a))-d*(o-u),h*(p*(o-u)+d*(f*(n-s)+m*(r-a)))+c*(m*(n-s)-f*(r-a)),c*(p*(o-u)+d*(f*(n-s)+m*(r-a)))-h*(m*(n-s)-f*(r-a)))},g.prototype._convertTranslationToScreen=function(e){var t,i,r=this.eye.x,n=this.eye.y,o=this.eye.z,a=e.x,s=e.y,l=e.z;return this.showPerspective?(t=o/l*(a-r),i=o/l*(s-n)):(t=a*(-o/this.camera.getArmLength()),i=s*(-o/this.camera.getArmLength())),new u(this.currentXCenter+t*this.frame.canvas.clientWidth,this.currentYCenter-i*this.frame.canvas.clientWidth)},g.prototype._calcTranslations=function(e){for(var t=0;t<e.length;t++){var i=e[t];i.trans=this._convertPointToTranslation(i.point),i.screen=this._convertTranslationToScreen(i.trans);var r=this._convertPointToTranslation(i.bottom);i.dist=this.showPerspective?r.length():-r.z}e.sort(function(e,t){return t.dist-e.dist})},g.prototype._initializeRanges=function(){var e=this.dataGroup;this.xRange=e.xRange,this.yRange=e.yRange,this.zRange=e.zRange,this.valueRange=e.valueRange,this.xStep=e.xStep,this.yStep=e.yStep,this.zStep=e.zStep,this.xBarWidth=e.xBarWidth,this.yBarWidth=e.yBarWidth,this.colX=e.colX,this.colY=e.colY,this.colZ=e.colZ,this.colValue=e.colValue,this._setScale()},g.prototype.getDataPoints=function(e){for(var t=[],i=0;i<e.length;i++){var r=new l;r.x=e[i][this.colX]||0,r.y=e[i][this.colY]||0,r.z=e[i][this.colZ]||0,r.data=e[i],void 0!==this.colValue&&(r.value=e[i][this.colValue]||0);var n={};n.point=r,n.bottom=new l(r.x,r.y,this.zRange.min),n.trans=void 0,n.screen=void 0,t.push(n)}return t},g.prototype._getDataPoints=function(e){var t,i,r,n,o=[];if(this.style===g.STYLE.GRID||this.style===g.STYLE.SURFACE){var a=this.dataGroup.getDistinctValues(this.colX,e),s=this.dataGroup.getDistinctValues(this.colY,e);o=this.getDataPoints(e);var l=[];for(r=0;r<o.length;r++){n=o[r];var u=a.indexOf(n.point.x),h=s.indexOf(n.point.y);void 0===l[u]&&(l[u]=[]),l[u][h]=n}for(t=0;t<l.length;t++)for(i=0;i<l[t].length;i++)l[t][i]&&(l[t][i].pointRight=t<l.length-1?l[t+1][i]:void 0,l[t][i].pointTop=i<l[t].length-1?l[t][i+1]:void 0,l[t][i].pointCross=t<l.length-1&&i<l[t].length-1?l[t+1][i+1]:void 0)}else if(this._checkValueField(e),o=this.getDataPoints(e),this.style===g.STYLE.LINE)for(r=0;r<o.length;r++)r>0&&(o[r-1].pointNext=o[r]);return o},g.prototype.create=function(){for(;this.containerElement.hasChildNodes();)this.containerElement.removeChild(this.containerElement.firstChild);this.frame=document.createElement("div"),this.frame.style.position="relative",this.frame.style.overflow="hidden",this.frame.canvas=document.createElement("canvas"),this.frame.canvas.style.position="relative",this.frame.appendChild(this.frame.canvas);var e=document.createElement("DIV");e.style.color="red",e.style.fontWeight="bold",e.style.padding="10px",e.innerHTML="Error: your browser does not support HTML canvas",this.frame.canvas.appendChild(e),this.frame.filter=document.createElement("div"),this.frame.filter.style.position="absolute",this.frame.filter.style.bottom="0px",this.frame.filter.style.left="0px",this.frame.filter.style.width="100%",this.frame.appendChild(this.frame.filter);var t=this;s.addEventListener(this.frame.canvas,"mousedown",function(e){t._onMouseDown(e)}),s.addEventListener(this.frame.canvas,"touchstart",function(e){t._onTouchStart(e)}),s.addEventListener(this.frame.canvas,"mousewheel",function(e){t._onWheel(e)}),s.addEventListener(this.frame.canvas,"mousemove",function(e){t._onTooltip(e)}),s.addEventListener(this.frame.canvas,"click",function(e){t._onClick(e)}),this.containerElement.appendChild(this.frame)},g.prototype._setSize=function(e,t){this.frame.style.width=e,this.frame.style.height=t,this._resizeCanvas()},g.prototype._resizeCanvas=function(){this.frame.canvas.style.width="100%",this.frame.canvas.style.height="100%",this.frame.canvas.width=this.frame.canvas.clientWidth,this.frame.canvas.height=this.frame.canvas.clientHeight,this.frame.filter.style.width=this.frame.canvas.clientWidth-20+"px"},g.prototype.animationStart=function(){if(this.animationAutoStart&&this.dataGroup.dataFilter){if(!this.frame.filter||!this.frame.filter.slider)throw new Error("No animation available");this.frame.filter.slider.play()}},g.prototype.animationStop=function(){this.frame.filter&&this.frame.filter.slider&&this.frame.filter.slider.stop()},g.prototype._resizeCenter=function(){"%"===this.xCenter.charAt(this.xCenter.length-1)?this.currentXCenter=parseFloat(this.xCenter)/100*this.frame.canvas.clientWidth:this.currentXCenter=parseFloat(this.xCenter),"%"===this.yCenter.charAt(this.yCenter.length-1)?this.currentYCenter=parseFloat(this.yCenter)/100*(this.frame.canvas.clientHeight-this.frame.filter.clientHeight):this.currentYCenter=parseFloat(this.yCenter)},g.prototype.getCameraPosition=function(){var e=this.camera.getArmRotation();return e.distance=this.camera.getArmLength(),e},g.prototype._readData=function(e){this.dataPoints=this.dataGroup.initializeData(this,e,this.style),this._initializeRanges(),this._redrawFilter()},g.prototype.setData=function(e){null!=e&&(this._readData(e),this.redraw(),this.animationStart())},g.prototype.setOptions=function(e){void 0!==e&&(!0===p.validate(e,m)&&console.log("%cErrors have been found in the supplied options object.",f),this.animationStop(),d.setOptions(e,this),this.setPointDrawingMethod(),this._setSize(this.width,this.height),this.setData(this.dataGroup.getDataTable()),this.animationStart())},g.prototype.setPointDrawingMethod=function(){var e=void 0;switch(this.style){case g.STYLE.BAR:e=g.prototype._redrawBarGraphPoint;break;case g.STYLE.BARCOLOR:e=g.prototype._redrawBarColorGraphPoint;break;case g.STYLE.BARSIZE:e=g.prototype._redrawBarSizeGraphPoint;break;case g.STYLE.DOT:e=g.prototype._redrawDotGraphPoint;break;case g.STYLE.DOTLINE:e=g.prototype._redrawDotLineGraphPoint;break;case g.STYLE.DOTCOLOR:e=g.prototype._redrawDotColorGraphPoint;break;case g.STYLE.DOTSIZE:e=g.prototype._redrawDotSizeGraphPoint;break;case g.STYLE.SURFACE:e=g.prototype._redrawSurfaceGraphPoint;break;case g.STYLE.GRID:e=g.prototype._redrawGridGraphPoint;break;case g.STYLE.LINE:e=g.prototype._redrawLineGraphPoint;break;default:throw new Error("Can not determine point drawing method for graph style '"+this.style+"'")}this._pointDrawingMethod=e},g.prototype.redraw=function(){if(void 0===this.dataPoints)throw new Error("Graph data not initialized");this._resizeCanvas(),this._resizeCenter(),this._redrawSlider(),this._redrawClear(),this._redrawAxis(),this._redrawDataGraph(),this._redrawInfo(),this._redrawLegend()},g.prototype._getContext=function(){var e=this.frame.canvas.getContext("2d");return e.lineJoin="round",e.lineCap="round",e},g.prototype._redrawClear=function(){var e=this.frame.canvas;e.getContext("2d").clearRect(0,0,e.width,e.height)},g.prototype._dotSize=function(){return this.frame.clientWidth*this.dotSizeRatio},g.prototype._getLegendWidth=function(){var e;this.style===g.STYLE.DOTSIZE?e=this._dotSize()*this.dotSizeMaxFraction:e=this.style===g.STYLE.BARSIZE?this.xBarWidth:20;return e},g.prototype._redrawLegend=function(){if(!0===this.showLegend&&this.style!==g.STYLE.LINE&&this.style!==g.STYLE.BARSIZE){var e=this.style===g.STYLE.BARSIZE||this.style===g.STYLE.DOTSIZE,t=this.style===g.STYLE.DOTSIZE||this.style===g.STYLE.DOTCOLOR||this.style===g.STYLE.BARCOLOR,i=Math.max(.25*this.frame.clientHeight,100),r=this.margin,n=this._getLegendWidth(),o=this.frame.clientWidth-this.margin,a=o-n,s=r+i,l=this._getContext();if(l.lineWidth=1,l.font="14px arial",!1===e){var h,d=i;for(h=0;h<d;h++){var p=240*((h-0)/(d-0)),f=this._hsv2rgb(p,1,1);l.strokeStyle=f,l.beginPath(),l.moveTo(a,r+h),l.lineTo(o,r+h),l.stroke()}l.strokeStyle=this.axisColor,l.strokeRect(a,r,n,i)}else{var m;this.style===g.STYLE.DOTSIZE?m=n*(this.dotSizeMinFraction/this.dotSizeMaxFraction):(this.style,g.STYLE.BARSIZE),l.strokeStyle=this.axisColor,l.fillStyle=this.dataColor.fill,l.beginPath(),l.moveTo(a,r),l.lineTo(o,r),l.lineTo(a+m,s),l.lineTo(a,s),l.closePath(),l.fill(),l.stroke()}var v,y,_=t?this.valueRange.min:this.zRange.min,b=t?this.valueRange.max:this.zRange.max,x=new c(_,b,(b-_)/5,!0);for(x.start(!0);!x.end();)h=s-(x.getCurrent()-_)/(b-_)*i,v=new u(a-5,h),y=new u(a,h),this._line(l,v,y),l.textAlign="right",l.textBaseline="middle",l.fillStyle=this.axisColor,l.fillText(x.getCurrent(),a-10,h),x.next();l.textAlign="right",l.textBaseline="top";var w=this.legendLabel;l.fillText(w,o,s+this.margin)}},g.prototype._redrawFilter=function(){var e=this.dataGroup.dataFilter,t=this.frame.filter;if(t.innerHTML="",e){var i={visible:this.showAnimationControls},r=new h(t,i);t.slider=r,t.style.padding="10px",r.setValues(e.values),r.setPlayInterval(this.animationInterval);var n=this;r.setOnChangeCallback(function(){var e=n.dataGroup.dataFilter,t=r.getIndex();e.selectValue(t),n.dataPoints=e._getDataPoints(),n.redraw()})}else t.slider=void 0},g.prototype._redrawSlider=function(){void 0!==this.frame.filter.slider&&this.frame.filter.slider.redraw()},g.prototype._redrawInfo=function(){var e=this.dataGroup.getInfo();if(void 0!==e){var t=this._getContext();t.font="14px arial",t.lineStyle="gray",t.fillStyle="gray",t.textAlign="left",t.textBaseline="top";var i=this.margin,r=this.margin;t.fillText(e,i,r)}},g.prototype._line=function(e,t,i,r){void 0!==r&&(e.strokeStyle=r),e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(i.x,i.y),e.stroke()},g.prototype.drawAxisLabelX=function(e,t,i,r,n){void 0===n&&(n=0);var o=this._convert3Dto2D(t);Math.cos(2*r)>0?(e.textAlign="center",e.textBaseline="top",o.y+=n):Math.sin(2*r)<0?(e.textAlign="right",e.textBaseline="middle"):(e.textAlign="left",e.textBaseline="middle"),e.fillStyle=this.axisColor,e.fillText(i,o.x,o.y)},g.prototype.drawAxisLabelY=function(e,t,i,r,n){void 0===n&&(n=0);var o=this._convert3Dto2D(t);Math.cos(2*r)<0?(e.textAlign="center",e.textBaseline="top",o.y+=n):Math.sin(2*r)>0?(e.textAlign="right",e.textBaseline="middle"):(e.textAlign="left",e.textBaseline="middle"),e.fillStyle=this.axisColor,e.fillText(i,o.x,o.y)},g.prototype.drawAxisLabelZ=function(e,t,i,r){void 0===r&&(r=0);var n=this._convert3Dto2D(t);e.textAlign="right",e.textBaseline="middle",e.fillStyle=this.axisColor,e.fillText(i,n.x-r,n.y)},g.prototype._line3d=function(e,t,i,r){var n=this._convert3Dto2D(t),o=this._convert3Dto2D(i);this._line(e,n,o,r)},g.prototype._redrawAxis=function(){var e,t,i,r,n,o,a,s,h,d,p=this._getContext();p.font=24/this.camera.getArmLength()+"px arial";var f,m,v,g=.025/this.scale.x,y=.025/this.scale.y,_=5/this.camera.getArmLength(),b=this.camera.getArmRotation().horizontal,x=new u(Math.cos(b),Math.sin(b)),w=this.xRange,S=this.yRange,M=this.zRange;for(p.lineWidth=1,r=void 0===this.defaultXStep,(i=new c(w.min,w.max,this.xStep,r)).start(!0);!i.end();){var T=i.getCurrent();if(this.showGrid?(e=new l(T,S.min,M.min),t=new l(T,S.max,M.min),this._line3d(p,e,t,this.gridColor)):this.showXAxis&&(e=new l(T,S.min,M.min),t=new l(T,S.min+g,M.min),this._line3d(p,e,t,this.axisColor),e=new l(T,S.max,M.min),t=new l(T,S.max-g,M.min),this._line3d(p,e,t,this.axisColor)),this.showXAxis){a=x.x>0?S.min:S.max,f=new l(T,a,M.min);var A="  "+this.xValueLabel(T)+"  ";this.drawAxisLabelX(p,f,A,b,_)}i.next()}for(p.lineWidth=1,r=void 0===this.defaultYStep,(i=new c(S.min,S.max,this.yStep,r)).start(!0);!i.end();){var C=i.getCurrent();if(this.showGrid?(e=new l(w.min,C,M.min),t=new l(w.max,C,M.min),this._line3d(p,e,t,this.gridColor)):this.showYAxis&&(e=new l(w.min,C,M.min),t=new l(w.min+y,C,M.min),this._line3d(p,e,t,this.axisColor),e=new l(w.max,C,M.min),t=new l(w.max-y,C,M.min),this._line3d(p,e,t,this.axisColor)),this.showYAxis){o=x.y>0?w.min:w.max,f=new l(o,C,M.min);var L="  "+this.yValueLabel(C)+"  ";this.drawAxisLabelY(p,f,L,b,_)}i.next()}if(this.showZAxis){for(p.lineWidth=1,r=void 0===this.defaultZStep,(i=new c(M.min,M.max,this.zStep,r)).start(!0),o=x.x>0?w.min:w.max,a=x.y<0?S.min:S.max;!i.end();){var N=i.getCurrent(),P=new l(o,a,N),k=this._convert3Dto2D(P);t=new u(k.x-_,k.y),this._line(p,k,t,this.axisColor);var E=this.zValueLabel(N)+" ";this.drawAxisLabelZ(p,P,E,5),i.next()}p.lineWidth=1,e=new l(o,a,M.min),t=new l(o,a,M.max),this._line3d(p,e,t,this.axisColor)}this.showXAxis&&(p.lineWidth=1,m=new l(w.min,S.min,M.min),v=new l(w.max,S.min,M.min),this._line3d(p,m,v,this.axisColor),m=new l(w.min,S.max,M.min),v=new l(w.max,S.max,M.min),this._line3d(p,m,v,this.axisColor));this.showYAxis&&(p.lineWidth=1,e=new l(w.min,S.min,M.min),t=new l(w.min,S.max,M.min),this._line3d(p,e,t,this.axisColor),e=new l(w.max,S.min,M.min),t=new l(w.max,S.max,M.min),this._line3d(p,e,t,this.axisColor));var D=this.xLabel;D.length>0&&this.showXAxis&&(d=.1/this.scale.y,o=(w.max+3*w.min)/4,a=x.x>0?S.min-d:S.max+d,n=new l(o,a,M.min),this.drawAxisLabelX(p,n,D,b));var O=this.yLabel;O.length>0&&this.showYAxis&&(h=.1/this.scale.x,o=x.y>0?w.min-h:w.max+h,a=(S.max+3*S.min)/4,n=new l(o,a,M.min),this.drawAxisLabelY(p,n,O,b));var R=this.zLabel;R.length>0&&this.showZAxis&&(30,o=x.x>0?w.min:w.max,a=x.y<0?S.min:S.max,s=(M.max+3*M.min)/4,n=new l(o,a,s),this.drawAxisLabelZ(p,n,R,30))},g.prototype._hsv2rgb=function(e,t,i){var r,n,o,a,s,l;switch(a=i*t,s=Math.floor(e/60),l=a*(1-Math.abs(e/60%2-1)),s){case 0:r=a,n=l,o=0;break;case 1:r=l,n=a,o=0;break;case 2:r=0,n=a,o=l;break;case 3:r=0,n=l,o=a;break;case 4:r=l,n=0,o=a;break;case 5:r=a,n=0,o=l;break;default:r=0,n=0,o=0}return"RGB("+parseInt(255*r)+","+parseInt(255*n)+","+parseInt(255*o)+")"},g.prototype._getStrokeWidth=function(e){return void 0!==e?this.showPerspective?1/-e.trans.z*this.dataColor.strokeWidth:-this.eye.z/this.camera.getArmLength()*this.dataColor.strokeWidth:this.dataColor.strokeWidth},g.prototype._redrawBar=function(e,t,i,r,n,o){var a,s=this,u=t.point,h=this.zRange.min,c=[{point:new l(u.x-i,u.y-r,u.z)},{point:new l(u.x+i,u.y-r,u.z)},{point:new l(u.x+i,u.y+r,u.z)},{point:new l(u.x-i,u.y+r,u.z)}],d=[{point:new l(u.x-i,u.y-r,h)},{point:new l(u.x+i,u.y-r,h)},{point:new l(u.x+i,u.y+r,h)},{point:new l(u.x-i,u.y+r,h)}];c.forEach(function(e){e.screen=s._convert3Dto2D(e.point)}),d.forEach(function(e){e.screen=s._convert3Dto2D(e.point)});var p=[{corners:c,center:l.avg(d[0].point,d[2].point)},{corners:[c[0],c[1],d[1],d[0]],center:l.avg(d[1].point,d[0].point)},{corners:[c[1],c[2],d[2],d[1]],center:l.avg(d[2].point,d[1].point)},{corners:[c[2],c[3],d[3],d[2]],center:l.avg(d[3].point,d[2].point)},{corners:[c[3],c[0],d[0],d[3]],center:l.avg(d[0].point,d[3].point)}];t.surfaces=p;for(var f=0;f<p.length;f++){a=p[f];var m=this._convertPointToTranslation(a.center);a.dist=this.showPerspective?m.length():-m.z}p.sort(function(e,t){var i=t.dist-e.dist;return i||(e.corners===c?1:t.corners===c?-1:0)}),e.lineWidth=this._getStrokeWidth(t),e.strokeStyle=o,e.fillStyle=n;for(var v=2;v<p.length;v++)a=p[v],this._polygon(e,a.corners)},g.prototype._polygon=function(e,t,i,r){if(!(t.length<2)){void 0!==i&&(e.fillStyle=i),void 0!==r&&(e.strokeStyle=r),e.beginPath(),e.moveTo(t[0].screen.x,t[0].screen.y);for(var n=1;n<t.length;++n){var o=t[n];e.lineTo(o.screen.x,o.screen.y)}e.closePath(),e.fill(),e.stroke()}},g.prototype._drawCircle=function(e,t,i,r,n){var o=this._calcRadius(t,n);e.lineWidth=this._getStrokeWidth(t),e.strokeStyle=r,e.fillStyle=i,e.beginPath(),e.arc(t.screen.x,t.screen.y,o,0,2*Math.PI,!0),e.fill(),e.stroke()},g.prototype._getColorsRegular=function(e){var t=240*(1-(e.point.z-this.zRange.min)*this.scale.z/this.verticalRatio);return{fill:this._hsv2rgb(t,1,1),border:this._hsv2rgb(t,1,.8)}},g.prototype._getColorsColor=function(e){var t,i;if("string"==typeof e.point.value)t=e.point.value,i=e.point.value;else{var r=240*(1-(e.point.value-this.valueRange.min)*this.scale.value);t=this._hsv2rgb(r,1,1),i=this._hsv2rgb(r,1,.8)}return{fill:t,border:i}},g.prototype._getColorsSize=function(){return{fill:this.dataColor.fill,border:this.dataColor.stroke}},g.prototype._calcRadius=function(e,t){var i;return void 0===t&&(t=this._dotSize()),(i=this.showPerspective?t/-e.trans.z:t*(-this.eye.z/this.camera.getArmLength()))<0&&(i=0),i},g.prototype._redrawBarGraphPoint=function(e,t){var i=this.xBarWidth/2,r=this.yBarWidth/2,n=this._getColorsRegular(t);this._redrawBar(e,t,i,r,n.fill,n.border)},g.prototype._redrawBarColorGraphPoint=function(e,t){var i=this.xBarWidth/2,r=this.yBarWidth/2,n=this._getColorsColor(t);this._redrawBar(e,t,i,r,n.fill,n.border)},g.prototype._redrawBarSizeGraphPoint=function(e,t){var i=(t.point.value-this.valueRange.min)/this.valueRange.range(),r=this.xBarWidth/2*(.8*i+.2),n=this.yBarWidth/2*(.8*i+.2),o=this._getColorsSize();this._redrawBar(e,t,r,n,o.fill,o.border)},g.prototype._redrawDotGraphPoint=function(e,t){var i=this._getColorsRegular(t);this._drawCircle(e,t,i.fill,i.border)},g.prototype._redrawDotLineGraphPoint=function(e,t){var i=this._convert3Dto2D(t.bottom);e.lineWidth=1,this._line(e,i,t.screen,this.gridColor),this._redrawDotGraphPoint(e,t)},g.prototype._redrawDotColorGraphPoint=function(e,t){var i=this._getColorsColor(t);this._drawCircle(e,t,i.fill,i.border)},g.prototype._redrawDotSizeGraphPoint=function(e,t){var i=this._dotSize(),r=(t.point.value-this.valueRange.min)/this.valueRange.range(),n=i*this.dotSizeMinFraction,o=n+(i*this.dotSizeMaxFraction-n)*r,a=this._getColorsSize();this._drawCircle(e,t,a.fill,a.border,o)},g.prototype._redrawSurfaceGraphPoint=function(e,t){var i=t.pointRight,r=t.pointTop,n=t.pointCross;if(void 0!==t&&void 0!==i&&void 0!==r&&void 0!==n){var o,a,s=!0;if(this.showGrayBottom||this.showShadow){var u=l.subtract(n.trans,t.trans),h=l.subtract(r.trans,i.trans),c=l.crossProduct(u,h),d=c.length();s=c.z>0}if(s){var p,f=240*(1-((t.point.z+i.point.z+r.point.z+n.point.z)/4-this.zRange.min)*this.scale.z/this.verticalRatio);this.showShadow?(p=Math.min(1+c.x/d/2,1),a=o=this._hsv2rgb(f,1,p)):(p=1,o=this._hsv2rgb(f,1,p),a=this.axisColor)}else o="gray",a=this.axisColor;e.lineWidth=this._getStrokeWidth(t);var m=[t,i,n,r];this._polygon(e,m,o,a)}},g.prototype._drawGridLine=function(e,t,i){if(void 0!==t&&void 0!==i){var r=240*(1-((t.point.z+i.point.z)/2-this.zRange.min)*this.scale.z/this.verticalRatio);e.lineWidth=2*this._getStrokeWidth(t),e.strokeStyle=this._hsv2rgb(r,1,1),this._line(e,t.screen,i.screen)}},g.prototype._redrawGridGraphPoint=function(e,t){this._drawGridLine(e,t,t.pointRight),this._drawGridLine(e,t,t.pointTop)},g.prototype._redrawLineGraphPoint=function(e,t){void 0!==t.pointNext&&(e.lineWidth=this._getStrokeWidth(t),e.strokeStyle=this.dataColor.stroke,this._line(e,t.screen,t.pointNext.screen))},g.prototype._redrawDataGraph=function(){var e,t=this._getContext();if(!(void 0===this.dataPoints||this.dataPoints.length<=0))for(this._calcTranslations(this.dataPoints),e=0;e<this.dataPoints.length;e++){var i=this.dataPoints[e];this._pointDrawingMethod.call(this,t,i)}},g.prototype._storeMousePosition=function(e){this.startMouseX=y(e),this.startMouseY=_(e),this._startCameraOffset=this.camera.getOffset()},g.prototype._onMouseDown=function(e){if(e=e||window.event,this.leftButtonDown&&this._onMouseUp(e),this.leftButtonDown=e.which?1===e.which:1===e.button,this.leftButtonDown||this.touchDown){this._storeMousePosition(e),this.startStart=new Date(this.start),this.startEnd=new Date(this.end),this.startArmRotation=this.camera.getArmRotation(),this.frame.style.cursor="move";var t=this;this.onmousemove=function(e){t._onMouseMove(e)},this.onmouseup=function(e){t._onMouseUp(e)},s.addEventListener(document,"mousemove",t.onmousemove),s.addEventListener(document,"mouseup",t.onmouseup),s.preventDefault(e)}},g.prototype._onMouseMove=function(e){this.moving=!0,e=e||window.event;var t=parseFloat(y(e))-this.startMouseX,i=parseFloat(_(e))-this.startMouseY;if(e&&!0===e.ctrlKey){var r=.5*this.frame.clientWidth,n=.5*this.frame.clientHeight,o=(this._startCameraOffset.x||0)-t/r*this.camera.armLength*.8,a=(this._startCameraOffset.y||0)+i/n*this.camera.armLength*.8;this.camera.setOffset(o,a),this._storeMousePosition(e)}else{var l=this.startArmRotation.horizontal+t/200,u=this.startArmRotation.vertical+i/200,h=Math.sin(4/360*2*Math.PI);Math.abs(Math.sin(l))<h&&(l=Math.round(l/Math.PI)*Math.PI-.001),Math.abs(Math.cos(l))<h&&(l=(Math.round(l/Math.PI-.5)+.5)*Math.PI-.001),Math.abs(Math.sin(u))<h&&(u=Math.round(u/Math.PI)*Math.PI),Math.abs(Math.cos(u))<h&&(u=(Math.round(u/Math.PI-.5)+.5)*Math.PI),this.camera.setArmRotation(l,u)}this.redraw();var c=this.getCameraPosition();this.emit("cameraPositionChange",c),s.preventDefault(e)},g.prototype._onMouseUp=function(e){this.frame.style.cursor="auto",this.leftButtonDown=!1,s.removeEventListener(document,"mousemove",this.onmousemove),s.removeEventListener(document,"mouseup",this.onmouseup),s.preventDefault(e)},g.prototype._onClick=function(e){if(this.onclick_callback){if(this.moving)this.moving=!1;else{var t=this.frame.getBoundingClientRect(),i=y(e)-t.left,r=_(e)-t.top,n=this._dataPointFromXY(i,r);n&&this.onclick_callback(n.point.data)}s.preventDefault(e)}},g.prototype._onTooltip=function(e){var t=this.frame.getBoundingClientRect(),i=y(e)-t.left,r=_(e)-t.top;if(this.showTooltip)if(this.tooltipTimeout&&clearTimeout(this.tooltipTimeout),this.leftButtonDown)this._hideTooltip();else if(this.tooltip&&this.tooltip.dataPoint){var n=this._dataPointFromXY(i,r);n!==this.tooltip.dataPoint&&(n?this._showTooltip(n):this._hideTooltip())}else{var o=this;this.tooltipTimeout=setTimeout(function(){o.tooltipTimeout=null;var e=o._dataPointFromXY(i,r);e&&o._showTooltip(e)},300)}},g.prototype._onTouchStart=function(e){this.touchDown=!0;var t=this;this.ontouchmove=function(e){t._onTouchMove(e)},this.ontouchend=function(e){t._onTouchEnd(e)},s.addEventListener(document,"touchmove",t.ontouchmove),s.addEventListener(document,"touchend",t.ontouchend),this._onMouseDown(e)},g.prototype._onTouchMove=function(e){this._onMouseMove(e)},g.prototype._onTouchEnd=function(e){this.touchDown=!1,s.removeEventListener(document,"touchmove",this.ontouchmove),s.removeEventListener(document,"touchend",this.ontouchend),this._onMouseUp(e)},g.prototype._onWheel=function(e){e||(e=window.event);var t=0;if(e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),t){var i=this.camera.getArmLength()*(1-t/10);this.camera.setArmLength(i),this.redraw(),this._hideTooltip()}var r=this.getCameraPosition();this.emit("cameraPositionChange",r),s.preventDefault(e)},g.prototype._insideTriangle=function(e,t){var i=t[0],r=t[1],n=t[2];function o(e){return e>0?1:e<0?-1:0}var a=o((r.x-i.x)*(e.y-i.y)-(r.y-i.y)*(e.x-i.x)),s=o((n.x-r.x)*(e.y-r.y)-(n.y-r.y)*(e.x-r.x)),l=o((i.x-n.x)*(e.y-n.y)-(i.y-n.y)*(e.x-n.x));return!(0!=a&&0!=s&&a!=s||0!=s&&0!=l&&s!=l||0!=a&&0!=l&&a!=l)},g.prototype._dataPointFromXY=function(e,t){var i,r=null,n=null,o=null,a=new u(e,t);if(this.style===g.STYLE.BAR||this.style===g.STYLE.BARCOLOR||this.style===g.STYLE.BARSIZE)for(i=this.dataPoints.length-1;i>=0;i--){var s=(r=this.dataPoints[i]).surfaces;if(s)for(var l=s.length-1;l>=0;l--){var h=s[l].corners,c=[h[0].screen,h[1].screen,h[2].screen],d=[h[2].screen,h[3].screen,h[0].screen];if(this._insideTriangle(a,c)||this._insideTriangle(a,d))return r}}else for(i=0;i<this.dataPoints.length;i++){var p=(r=this.dataPoints[i]).screen;if(p){var f=Math.abs(e-p.x),m=Math.abs(t-p.y),v=Math.sqrt(f*f+m*m);(null===o||v<o)&&v<100&&(o=v,n=r)}}return n},g.prototype.hasBars=function(e){return e==g.STYLE.BAR||e==g.STYLE.BARCOLOR||e==g.STYLE.BARSIZE},g.prototype._showTooltip=function(e){var t,i,r;this.tooltip?(t=this.tooltip.dom.content,i=this.tooltip.dom.line,r=this.tooltip.dom.dot):(t=document.createElement("div"),(0,o.default)(t.style,{},this.tooltipStyle.content),t.style.position="absolute",i=document.createElement("div"),(0,o.default)(i.style,{},this.tooltipStyle.line),i.style.position="absolute",r=document.createElement("div"),(0,o.default)(r.style,{},this.tooltipStyle.dot),r.style.position="absolute",this.tooltip={dataPoint:null,dom:{content:t,line:i,dot:r}}),this._hideTooltip(),this.tooltip.dataPoint=e,"function"==typeof this.showTooltip?t.innerHTML=this.showTooltip(e.point):t.innerHTML="<table><tr><td>"+this.xLabel+":</td><td>"+e.point.x+"</td></tr><tr><td>"+this.yLabel+":</td><td>"+e.point.y+"</td></tr><tr><td>"+this.zLabel+":</td><td>"+e.point.z+"</td></tr></table>",t.style.left="0",t.style.top="0",this.frame.appendChild(t),this.frame.appendChild(i),this.frame.appendChild(r);var n=t.offsetWidth,a=t.offsetHeight,s=i.offsetHeight,l=r.offsetWidth,u=r.offsetHeight,h=e.screen.x-n/2;h=Math.min(Math.max(h,10),this.frame.clientWidth-10-n),i.style.left=e.screen.x+"px",i.style.top=e.screen.y-s+"px",t.style.left=h+"px",t.style.top=e.screen.y-s-a+"px",r.style.left=e.screen.x-l/2+"px",r.style.top=e.screen.y-u/2+"px"},g.prototype._hideTooltip=function(){if(this.tooltip)for(var e in this.tooltip.dataPoint=null,this.tooltip.dom)if(this.tooltip.dom.hasOwnProperty(e)){var t=this.tooltip.dom[e];t&&t.parentNode&&t.parentNode.removeChild(t)}},g.prototype.setCameraPosition=function(e){d.setCameraPosition(e,this),this.redraw()},g.prototype.setSize=function(e,t){this._setSize(e,t),this.redraw()},e.exports=g},function(e,t,i){i(163),e.exports=i(7).Object.assign},function(e,t,i){var r=i(17);r(r.S+r.F,"Object",{assign:i(164)})},function(e,t,i){var r=i(33),n=i(63),o=i(42),a=i(41),s=i(78),l=Object.assign;e.exports=!l||i(28)(function(){var e={},t={},i=Symbol(),r="abcdefghijklmnopqrst";return e[i]=7,r.split("").forEach(function(e){t[e]=e}),7!=l({},e)[i]||Object.keys(l({},t)).join("")!=r})?function(e,t){for(var i=a(e),l=arguments.length,u=1,h=n.f,c=o.f;l>u;)for(var d,p=s(arguments[u++]),f=h?r(p).concat(h(p)):r(p),m=f.length,v=0;m>v;)c.call(p,d=f[v++])&&(i[d]=p[d]);return i}:l},function(e,t,i){e.exports={default:i(166),__esModule:!0}},function(e,t,i){i(167),e.exports=i(7).Math.sign},function(e,t,i){var r=i(17);r(r.S,"Math",{sign:i(168)})},function(e,t){e.exports=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},function(e,t,i){e.exports={default:i(170),__esModule:!0}},function(e,t,i){i(171);var r=i(7).Object;e.exports=function(e,t,i){return r.defineProperty(e,t,i)}},function(e,t,i){var r=i(17);r(r.S+r.F*!i(21),"Object",{defineProperty:i(20).f})},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r="string",n="boolean",o="number",a={fill:{string:r},stroke:{string:r},strokeWidth:{number:o},__type__:{string:r,object:"object",undefined:"undefined"}},s={animationAutoStart:{boolean:n,undefined:"undefined"},animationInterval:{number:o},animationPreload:{boolean:n},axisColor:{string:r},backgroundColor:a,xBarWidth:{number:o,undefined:"undefined"},yBarWidth:{number:o,undefined:"undefined"},cameraPosition:{distance:{number:o},horizontal:{number:o},vertical:{number:o},__type__:{object:"object"}},xCenter:{string:r},yCenter:{string:r},dataColor:a,dotSizeMinFraction:{number:o},dotSizeMaxFraction:{number:o},dotSizeRatio:{number:o},filterLabel:{string:r},gridColor:{string:r},onclick:{function:"function"},keepAspectRatio:{boolean:n},xLabel:{string:r},yLabel:{string:r},zLabel:{string:r},legendLabel:{string:r},xMin:{number:o,undefined:"undefined"},yMin:{number:o,undefined:"undefined"},zMin:{number:o,undefined:"undefined"},xMax:{number:o,undefined:"undefined"},yMax:{number:o,undefined:"undefined"},zMax:{number:o,undefined:"undefined"},showAnimationControls:{boolean:n,undefined:"undefined"},showGrid:{boolean:n},showLegend:{boolean:n,undefined:"undefined"},showPerspective:{boolean:n},showShadow:{boolean:n},showXAxis:{boolean:n},showYAxis:{boolean:n},showZAxis:{boolean:n},xStep:{number:o,undefined:"undefined"},yStep:{number:o,undefined:"undefined"},zStep:{number:o,undefined:"undefined"},style:{number:o,string:["bar","bar-color","bar-size","dot","dot-line","dot-color","dot-size","line","grid","surface"]},tooltip:{boolean:n,function:"function"},tooltipStyle:{content:{color:{string:r},background:{string:r},border:{string:r},borderRadius:{string:r},boxShadow:{string:r},padding:{string:r},__type__:{object:"object"}},line:{borderLeft:{string:r},height:{string:r},width:{string:r},__type__:{object:"object"}},dot:{border:{string:r},borderRadius:{string:r},height:{string:r},width:{string:r},__type__:{object:"object"}},__type__:{object:"object"}},xValueLabel:{function:"function"},yValueLabel:{function:"function"},zValueLabel:{function:"function"},valueMax:{number:o,undefined:"undefined"},valueMin:{number:o,undefined:"undefined"},verticalRatio:{number:o},height:{string:r},width:{string:r},__type__:{object:"object"}};t.allOptions=s},function(e,t,i){var r=i(11),n=i(12),o=i(174),a=i(96),s=i(94),l=i(34);function u(){this.dataTable=null}u.prototype.initializeData=function(e,t,i){if(void 0!==t){var o;if(Array.isArray(t)&&(t=new r(t)),!(t instanceof r||t instanceof n))throw new Error("Array, DataSet, or DataView expected");if(0!=(o=t.get()).length){this.style=i,this.dataSet&&this.dataSet.off("*",this._onChange),this.dataSet=t,this.dataTable=o;var s=this;this._onChange=function(){e.setData(s.dataSet)},this.dataSet.on("*",this._onChange),this.colX="x",this.colY="y",this.colZ="z";var l=e.hasBars(i);if(l&&(void 0!==e.defaultXBarWidth?this.xBarWidth=e.defaultXBarWidth:this.xBarWidth=this.getSmallestDifference(o,this.colX)||1,void 0!==e.defaultYBarWidth?this.yBarWidth=e.defaultYBarWidth:this.yBarWidth=this.getSmallestDifference(o,this.colY)||1),this._initializeRange(o,this.colX,e,l),this._initializeRange(o,this.colY,e,l),this._initializeRange(o,this.colZ,e,!1),o[0].hasOwnProperty("style")){this.colValue="style";var u=this.getColumnRange(o,this.colValue);this._setRangeDefaults(u,e.defaultValueMin,e.defaultValueMax),this.valueRange=u}return this.getDataTable()[0].hasOwnProperty("filter")&&void 0===this.dataFilter&&(this.dataFilter=new a(this,"filter",e),this.dataFilter.setOnLoadCallback(function(){e.redraw()})),this.dataFilter?this.dataFilter._getDataPoints():this._getDataPoints(this.getDataTable())}}},u.prototype._collectRangeSettings=function(e,t){if(-1==["x","y","z"].indexOf(e))throw new Error("Column '"+e+"' invalid");var i=e.toUpperCase();return{barWidth:this[e+"BarWidth"],min:t["default"+i+"Min"],max:t["default"+i+"Max"],step:t["default"+i+"Step"],range_label:e+"Range",step_label:e+"Step"}},u.prototype._initializeRange=function(e,t,i,r){var n=this._collectRangeSettings(t,i),o=this.getColumnRange(e,t);r&&"z"!=t&&o.expand(n.barWidth/2),this._setRangeDefaults(o,n.min,n.max),this[n.range_label]=o,this[n.step_label]=void 0!==n.step?n.step:o.range()/5},u.prototype.getDistinctValues=function(e,t){void 0===t&&(t=this.dataTable);for(var i=[],r=0;r<t.length;r++){var n=t[r][e]||0;-1===i.indexOf(n)&&i.push(n)}return i.sort(function(e,t){return e-t})},u.prototype.getSmallestDifference=function(e,t){for(var i=this.getDistinctValues(e,t),r=null,n=1;n<i.length;n++){var o=i[n]-i[n-1];(null==r||r>o)&&(r=o)}return r},u.prototype.getColumnRange=function(e,t){for(var i=new o,r=0;r<e.length;r++){var n=e[r][t];i.adjust(n)}return i},u.prototype.getNumberOfRows=function(){return this.dataTable.length},u.prototype._setRangeDefaults=function(e,t,i){void 0!==t&&(e.min=t),void 0!==i&&(e.max=i),e.max<=e.min&&(e.max=e.min+1)},u.prototype.getDataTable=function(){return this.dataTable},u.prototype.getDataSet=function(){return this.dataSet},u.prototype.getDataPoints=function(e){for(var t=[],i=0;i<e.length;i++){var r=new l;r.x=e[i][this.colX]||0,r.y=e[i][this.colY]||0,r.z=e[i][this.colZ]||0,r.data=e[i],void 0!==this.colValue&&(r.value=e[i][this.colValue]||0);var n={};n.point=r,n.bottom=new l(r.x,r.y,this.zRange.min),n.trans=void 0,n.screen=void 0,t.push(n)}return t},u.prototype.initDataAsMatrix=function(e){var t,i,r,n,o=this.getDistinctValues(this.colX,e),a=this.getDistinctValues(this.colY,e),s=this.getDataPoints(e),l=[];for(r=0;r<s.length;r++){n=s[r];var u=o.indexOf(n.point.x),h=a.indexOf(n.point.y);void 0===l[u]&&(l[u]=[]),l[u][h]=n}for(t=0;t<l.length;t++)for(i=0;i<l[t].length;i++)l[t][i]&&(l[t][i].pointRight=t<l.length-1?l[t+1][i]:void 0,l[t][i].pointTop=i<l[t].length-1?l[t][i+1]:void 0,l[t][i].pointCross=t<l.length-1&&i<l[t].length-1?l[t+1][i+1]:void 0);return s},u.prototype.getInfo=function(){var e=this.dataFilter;if(e)return e.getLabel()+": "+e.getSelectedValue()},u.prototype.reload=function(){this.dataTable&&this.setData(this.dataTable)},u.prototype._getDataPoints=function(e){var t=[];if(this.style===s.STYLE.GRID||this.style===s.STYLE.SURFACE)t=this.initDataAsMatrix(e);else if(this._checkValueField(e),t=this.getDataPoints(e),this.style===s.STYLE.LINE)for(var i=0;i<t.length;i++)i>0&&(t[i-1].pointNext=t[i]);return t},u.prototype._checkValueField=function(e){if(this.style===s.STYLE.BARCOLOR||this.style===s.STYLE.BARSIZE||this.style===s.STYLE.DOTCOLOR||this.style===s.STYLE.DOTSIZE){if(void 0===this.colValue)throw new Error("Expected data to have  field 'style'  for graph style '"+this.style+"'");if(void 0===e[0][this.colValue])throw new Error("Expected data to have  field '"+this.colValue+"'  for graph style '"+this.style+"'")}},e.exports=u},function(e,t,i){function r(){this.min=void 0,this.max=void 0}r.prototype.adjust=function(e){void 0!==e&&((void 0===this.min||this.min>e)&&(this.min=e),(void 0===this.max||this.max<e)&&(this.max=e))},r.prototype.combine=function(e){this.add(e.min),this.add(e.max)},r.prototype.expand=function(e){if(void 0!==e){var t=this.min-e,i=this.max+e;if(t>i)throw new Error("Passed expansion value makes range invalid");this.min=t,this.max=i}},r.prototype.range=function(){return this.max-this.min},r.prototype.center=function(){return(this.min+this.max)/2},e.exports=r},function(e,t,i){var r,n,o;n=[],void 0===(o="function"==typeof(r=function(){var e=null;return function t(i,r){var n=r||{preventDefault:!1};if(i.Manager){var o=i,a=function(e,i){var r=Object.create(n);return i&&o.assign(r,i),t(new o(e,r),r)};return o.assign(a,o),a.Manager=function(e,i){var r=Object.create(n);return i&&o.assign(r,i),t(new o.Manager(e,r),r)},a}var s=Object.create(i),l=i.element;function u(e){return e.match(/[^ ]+/g)}function h(t){if("hammer.input"!==t.type){if(t.srcEvent._handled||(t.srcEvent._handled={}),t.srcEvent._handled[t.type])return;t.srcEvent._handled[t.type]=!0}var i=!1;t.stopPropagation=function(){i=!0};var r=t.srcEvent.stopPropagation.bind(t.srcEvent);"function"==typeof r&&(t.srcEvent.stopPropagation=function(){r(),t.stopPropagation()}),t.firstTarget=e;for(var n=e;n&&!i;){var o=n.hammer;if(o)for(var a,s=0;s<o.length;s++)if(a=o[s]._handlers[t.type])for(var l=0;l<a.length&&!i;l++)a[l](t);n=n.parentNode}}return l.hammer||(l.hammer=[]),l.hammer.push(s),i.on("hammer.input",function(t){!0!==n.preventDefault&&n.preventDefault!==t.pointerType||t.preventDefault(),t.isFirst&&(e=t.target)}),s._handlers={},s.on=function(e,t){return u(e).forEach(function(e){var r=s._handlers[e];r||(s._handlers[e]=r=[],i.on(e,h)),r.push(t)}),s},s.off=function(e,t){return u(e).forEach(function(e){var r=s._handlers[e];r&&((r=t?r.filter(function(e){return e!==t}):[]).length>0?s._handlers[e]=r:(i.off(e,h),delete s._handlers[e]))}),s},s.emit=function(t,r){e=r.target,i.emit(t,r)},s.destroy=function(){var e=i.element.hammer,t=e.indexOf(s);-1!==t&&e.splice(t,1),e.length||delete i.element.hammer,s._handlers={},i.destroy()},s}})?r.apply(t,n):r)||(e.exports=o)},function(e,t,i){var r;
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */
!function(n,o,a,s){var l,u=["","webkit","Moz","MS","ms","o"],h=o.createElement("div"),c="function",d=Math.round,p=Math.abs,f=Date.now;function m(e,t,i){return setTimeout(w(e,i),t)}function v(e,t,i){return!!Array.isArray(e)&&(g(e,i[t],i),!0)}function g(e,t,i){var r;if(e)if(e.forEach)e.forEach(t,i);else if(e.length!==s)for(r=0;r<e.length;)t.call(i,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(i,e[r],r,e)}function y(e,t,i){var r="DEPRECATED METHOD: "+t+"\n"+i+" AT \n";return function(){var t=new Error("get-stack-trace"),i=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=n.console&&(n.console.warn||n.console.log);return o&&o.call(n.console,r,i),e.apply(this,arguments)}}l="function"!=typeof Object.assign?function(e){if(e===s||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(r!==s&&null!==r)for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])}return t}:Object.assign;var _=y(function(e,t,i){for(var r=Object.keys(t),n=0;n<r.length;)(!i||i&&e[r[n]]===s)&&(e[r[n]]=t[r[n]]),n++;return e},"extend","Use `assign`."),b=y(function(e,t){return _(e,t,!0)},"merge","Use `assign`.");function x(e,t,i){var r,n=t.prototype;(r=e.prototype=Object.create(n)).constructor=e,r._super=n,i&&l(r,i)}function w(e,t){return function(){return e.apply(t,arguments)}}function S(e,t){return typeof e==c?e.apply(t&&t[0]||s,t):e}function M(e,t){return e===s?t:e}function T(e,t,i){g(N(t),function(t){e.addEventListener(t,i,!1)})}function A(e,t,i){g(N(t),function(t){e.removeEventListener(t,i,!1)})}function C(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function L(e,t){return e.indexOf(t)>-1}function N(e){return e.trim().split(/\s+/g)}function P(e,t,i){if(e.indexOf&&!i)return e.indexOf(t);for(var r=0;r<e.length;){if(i&&e[r][i]==t||!i&&e[r]===t)return r;r++}return-1}function k(e){return Array.prototype.slice.call(e,0)}function E(e,t,i){for(var r=[],n=[],o=0;o<e.length;){var a=t?e[o][t]:e[o];P(n,a)<0&&r.push(e[o]),n[o]=a,o++}return i&&(r=t?r.sort(function(e,i){return e[t]>i[t]}):r.sort()),r}function D(e,t){for(var i,r,n=t[0].toUpperCase()+t.slice(1),o=0;o<u.length;){if((r=(i=u[o])?i+n:t)in e)return r;o++}return s}var O=1;function R(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||n}var F="ontouchstart"in n,I=D(n,"PointerEvent")!==s,B=F&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),U=25,V=1,z=2,G=4,j=8,W=1,H=2,q=4,Y=8,X=16,K=H|q,Q=Y|X,Z=K|Q,J=["x","y"],$=["clientX","clientY"];function ee(e,t){var i=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){S(e.options.enable,[e])&&i.handler(t)},this.init()}function te(e,t,i){var r=i.pointers.length,n=i.changedPointers.length,o=t&V&&r-n==0,a=t&(G|j)&&r-n==0;i.isFirst=!!o,i.isFinal=!!a,o&&(e.session={}),i.eventType=t,function(e,t){var i=e.session,r=t.pointers,n=r.length;i.firstInput||(i.firstInput=ie(t));n>1&&!i.firstMultiple?i.firstMultiple=ie(t):1===n&&(i.firstMultiple=!1);var o=i.firstInput,a=i.firstMultiple,l=a?a.center:o.center,u=t.center=re(r);t.timeStamp=f(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=se(l,u),t.distance=ae(l,u),function(e,t){var i=t.center,r=e.offsetDelta||{},n=e.prevDelta||{},o=e.prevInput||{};t.eventType!==V&&o.eventType!==G||(n=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=e.offsetDelta={x:i.x,y:i.y});t.deltaX=n.x+(i.x-r.x),t.deltaY=n.y+(i.y-r.y)}(i,t),t.offsetDirection=oe(t.deltaX,t.deltaY);var h=ne(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=h.x,t.overallVelocityY=h.y,t.overallVelocity=p(h.x)>p(h.y)?h.x:h.y,t.scale=a?(c=a.pointers,d=r,ae(d[0],d[1],$)/ae(c[0],c[1],$)):1,t.rotation=a?function(e,t){return se(t[1],t[0],$)+se(e[1],e[0],$)}(a.pointers,r):0,t.maxPointers=i.prevInput?t.pointers.length>i.prevInput.maxPointers?t.pointers.length:i.prevInput.maxPointers:t.pointers.length,function(e,t){var i,r,n,o,a=e.lastInterval||t,l=t.timeStamp-a.timeStamp;if(t.eventType!=j&&(l>U||a.velocity===s)){var u=t.deltaX-a.deltaX,h=t.deltaY-a.deltaY,c=ne(l,u,h);r=c.x,n=c.y,i=p(c.x)>p(c.y)?c.x:c.y,o=oe(u,h),e.lastInterval=t}else i=a.velocity,r=a.velocityX,n=a.velocityY,o=a.direction;t.velocity=i,t.velocityX=r,t.velocityY=n,t.direction=o}(i,t);var c,d;var m=e.element;C(t.srcEvent.target,m)&&(m=t.srcEvent.target);t.target=m}(e,i),e.emit("hammer.input",i),e.recognize(i),e.session.prevInput=i}function ie(e){for(var t=[],i=0;i<e.pointers.length;)t[i]={clientX:d(e.pointers[i].clientX),clientY:d(e.pointers[i].clientY)},i++;return{timeStamp:f(),pointers:t,center:re(t),deltaX:e.deltaX,deltaY:e.deltaY}}function re(e){var t=e.length;if(1===t)return{x:d(e[0].clientX),y:d(e[0].clientY)};for(var i=0,r=0,n=0;n<t;)i+=e[n].clientX,r+=e[n].clientY,n++;return{x:d(i/t),y:d(r/t)}}function ne(e,t,i){return{x:t/e||0,y:i/e||0}}function oe(e,t){return e===t?W:p(e)>=p(t)?e<0?H:q:t<0?Y:X}function ae(e,t,i){i||(i=J);var r=t[i[0]]-e[i[0]],n=t[i[1]]-e[i[1]];return Math.sqrt(r*r+n*n)}function se(e,t,i){i||(i=J);var r=t[i[0]]-e[i[0]],n=t[i[1]]-e[i[1]];return 180*Math.atan2(n,r)/Math.PI}ee.prototype={handler:function(){},init:function(){this.evEl&&T(this.element,this.evEl,this.domHandler),this.evTarget&&T(this.target,this.evTarget,this.domHandler),this.evWin&&T(R(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(R(this.element),this.evWin,this.domHandler)}};var le={mousedown:V,mousemove:z,mouseup:G},ue="mousedown",he="mousemove mouseup";function ce(){this.evEl=ue,this.evWin=he,this.pressed=!1,ee.apply(this,arguments)}x(ce,ee,{handler:function(e){var t=le[e.type];t&V&&0===e.button&&(this.pressed=!0),t&z&&1!==e.which&&(t=G),this.pressed&&(t&G&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var de={pointerdown:V,pointermove:z,pointerup:G,pointercancel:j,pointerout:j},pe={2:"touch",3:"pen",4:"mouse",5:"kinect"},fe="pointerdown",me="pointermove pointerup pointercancel";function ve(){this.evEl=fe,this.evWin=me,ee.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}n.MSPointerEvent&&!n.PointerEvent&&(fe="MSPointerDown",me="MSPointerMove MSPointerUp MSPointerCancel"),x(ve,ee,{handler:function(e){var t=this.store,i=!1,r=e.type.toLowerCase().replace("ms",""),n=de[r],o=pe[e.pointerType]||e.pointerType,a="touch"==o,s=P(t,e.pointerId,"pointerId");n&V&&(0===e.button||a)?s<0&&(t.push(e),s=t.length-1):n&(G|j)&&(i=!0),s<0||(t[s]=e,this.callback(this.manager,n,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),i&&t.splice(s,1))}});var ge={touchstart:V,touchmove:z,touchend:G,touchcancel:j},ye="touchstart",_e="touchstart touchmove touchend touchcancel";function be(){this.evTarget=ye,this.evWin=_e,this.started=!1,ee.apply(this,arguments)}x(be,ee,{handler:function(e){var t=ge[e.type];if(t===V&&(this.started=!0),this.started){var i=function(e,t){var i=k(e.touches),r=k(e.changedTouches);t&(G|j)&&(i=E(i.concat(r),"identifier",!0));return[i,r]}.call(this,e,t);t&(G|j)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:e})}}});var xe={touchstart:V,touchmove:z,touchend:G,touchcancel:j},we="touchstart touchmove touchend touchcancel";function Se(){this.evTarget=we,this.targetIds={},ee.apply(this,arguments)}x(Se,ee,{handler:function(e){var t=xe[e.type],i=function(e,t){var i=k(e.touches),r=this.targetIds;if(t&(V|z)&&1===i.length)return r[i[0].identifier]=!0,[i,i];var n,o,a=k(e.changedTouches),s=[],l=this.target;if(o=i.filter(function(e){return C(e.target,l)}),t===V)for(n=0;n<o.length;)r[o[n].identifier]=!0,n++;n=0;for(;n<a.length;)r[a[n].identifier]&&s.push(a[n]),t&(G|j)&&delete r[a[n].identifier],n++;if(!s.length)return;return[E(o.concat(s),"identifier",!0),s]}.call(this,e,t);i&&this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:e})}});var Me=2500,Te=25;function Ae(){ee.apply(this,arguments);var e=w(this.handler,this);this.touch=new Se(this.manager,e),this.mouse=new ce(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function Ce(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var i={x:t.clientX,y:t.clientY};this.lastTouches.push(i);var r=this.lastTouches;setTimeout(function(){var e=r.indexOf(i);e>-1&&r.splice(e,1)},Me)}}x(Ae,ee,{handler:function(e,t,i){var r="touch"==i.pointerType,n="mouse"==i.pointerType;if(!(n&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(r)(function(e,t){e&V?(this.primaryTouch=t.changedPointers[0].identifier,Ce.call(this,t)):e&(G|j)&&Ce.call(this,t)}).call(this,t,i);else if(n&&function(e){for(var t=e.srcEvent.clientX,i=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var n=this.lastTouches[r],o=Math.abs(t-n.x),a=Math.abs(i-n.y);if(o<=Te&&a<=Te)return!0}return!1}.call(this,i))return;this.callback(e,t,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Le=D(h.style,"touchAction"),Ne=Le!==s,Pe="auto",ke="manipulation",Ee="none",De="pan-x",Oe="pan-y",Re=function(){if(!Ne)return!1;var e={},t=n.CSS&&n.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(i){e[i]=!t||n.CSS.supports("touch-action",i)}),e}();function Fe(e,t){this.manager=e,this.set(t)}Fe.prototype={set:function(e){"compute"==e&&(e=this.compute()),Ne&&this.manager.element.style&&Re[e]&&(this.manager.element.style[Le]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return g(this.manager.recognizers,function(t){S(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),function(e){if(L(e,Ee))return Ee;var t=L(e,De),i=L(e,Oe);if(t&&i)return Ee;if(t||i)return t?De:Oe;if(L(e,ke))return ke;return Pe}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,i=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var r=this.actions,n=L(r,Ee)&&!Re[Ee],o=L(r,Oe)&&!Re[Oe],a=L(r,De)&&!Re[De];if(n){var s=1===e.pointers.length,l=e.distance<2,u=e.deltaTime<250;if(s&&l&&u)return}if(!a||!o)return n||o&&i&K||a&&i&Q?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var Ie=1,Be=2,Ue=4,Ve=8,ze=Ve,Ge=16;function je(e){this.options=l({},this.defaults,e||{}),this.id=O++,this.manager=null,this.options.enable=M(this.options.enable,!0),this.state=Ie,this.simultaneous={},this.requireFail=[]}function We(e){return e&Ge?"cancel":e&Ve?"end":e&Ue?"move":e&Be?"start":""}function He(e){return e==X?"down":e==Y?"up":e==H?"left":e==q?"right":""}function qe(e,t){var i=t.manager;return i?i.get(e):e}function Ye(){je.apply(this,arguments)}function Xe(){Ye.apply(this,arguments),this.pX=null,this.pY=null}function Ke(){Ye.apply(this,arguments)}function Qe(){je.apply(this,arguments),this._timer=null,this._input=null}function Ze(){Ye.apply(this,arguments)}function Je(){Ye.apply(this,arguments)}function $e(){je.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function et(e,t){return(t=t||{}).recognizers=M(t.recognizers,et.defaults.preset),new tt(e,t)}je.prototype={defaults:{},set:function(e){return l(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(v(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=qe(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return v(e,"dropRecognizeWith",this)?this:(e=qe(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(v(e,"requireFailure",this))return this;var t=this.requireFail;return-1===P(t,e=qe(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(v(e,"dropRequireFailure",this))return this;e=qe(e,this);var t=P(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,i=this.state;function r(i){t.manager.emit(i,e)}i<Ve&&r(t.options.event+We(i)),r(t.options.event),e.additionalEvent&&r(e.additionalEvent),i>=Ve&&r(t.options.event+We(i))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=32},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(32|Ie)))return!1;e++}return!0},recognize:function(e){var t=l({},e);if(!S(this.options.enable,[this,t]))return this.reset(),void(this.state=32);this.state&(ze|Ge|32)&&(this.state=Ie),this.state=this.process(t),this.state&(Be|Ue|Ve|Ge)&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},x(Ye,je,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,i=e.eventType,r=t&(Be|Ue),n=this.attrTest(e);return r&&(i&j||!n)?t|Ge:r||n?i&G?t|Ve:t&Be?t|Ue:Be:32}}),x(Xe,Ye,{defaults:{event:"pan",threshold:10,pointers:1,direction:Z},getTouchAction:function(){var e=this.options.direction,t=[];return e&K&&t.push(Oe),e&Q&&t.push(De),t},directionTest:function(e){var t=this.options,i=!0,r=e.distance,n=e.direction,o=e.deltaX,a=e.deltaY;return n&t.direction||(t.direction&K?(n=0===o?W:o<0?H:q,i=o!=this.pX,r=Math.abs(e.deltaX)):(n=0===a?W:a<0?Y:X,i=a!=this.pY,r=Math.abs(e.deltaY))),e.direction=n,i&&r>t.threshold&&n&t.direction},attrTest:function(e){return Ye.prototype.attrTest.call(this,e)&&(this.state&Be||!(this.state&Be)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=He(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),x(Ke,Ye,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ee]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&Be)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),x(Qe,je,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Pe]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,r=e.distance<t.threshold,n=e.deltaTime>t.time;if(this._input=e,!r||!i||e.eventType&(G|j)&&!n)this.reset();else if(e.eventType&V)this.reset(),this._timer=m(function(){this.state=ze,this.tryEmit()},t.time,this);else if(e.eventType&G)return ze;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===ze&&(e&&e.eventType&G?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=f(),this.manager.emit(this.options.event,this._input)))}}),x(Ze,Ye,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ee]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&Be)}}),x(Je,Ye,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:K|Q,pointers:1},getTouchAction:function(){return Xe.prototype.getTouchAction.call(this)},attrTest:function(e){var t,i=this.options.direction;return i&(K|Q)?t=e.overallVelocity:i&K?t=e.overallVelocityX:i&Q&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&i&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&p(t)>this.options.velocity&&e.eventType&G},emit:function(e){var t=He(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),x($e,je,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ke]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,r=e.distance<t.threshold,n=e.deltaTime<t.time;if(this.reset(),e.eventType&V&&0===this.count)return this.failTimeout();if(r&&n&&i){if(e.eventType!=G)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||ae(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,a&&o?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=m(function(){this.state=ze,this.tryEmit()},t.interval,this),Be):ze}return 32},failTimeout:function(){return this._timer=m(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ze&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),et.VERSION="2.0.7",et.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[Ze,{enable:!1}],[Ke,{enable:!1},["rotate"]],[Je,{direction:K}],[Xe,{direction:K},["swipe"]],[$e],[$e,{event:"doubletap",taps:2},["tap"]],[Qe]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function tt(e,t){var i;this.options=l({},et.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new((i=this).options.inputClass||(I?ve:B?Se:F?Ae:ce))(i,te),this.touchAction=new Fe(this,this.options.touchAction),it(this,!0),g(this.options.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function it(e,t){var i,r=e.element;r.style&&(g(e.options.cssProps,function(n,o){i=D(r.style,o),t?(e.oldCssProps[i]=r.style[i],r.style[i]=n):r.style[i]=e.oldCssProps[i]||""}),t||(e.oldCssProps={}))}tt.prototype={set:function(e){return l(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var i;this.touchAction.preventDefaults(e);var r=this.recognizers,n=t.curRecognizer;(!n||n&&n.state&ze)&&(n=t.curRecognizer=null);for(var o=0;o<r.length;)i=r[o],2===t.stopped||n&&i!=n&&!i.canRecognizeWith(n)?i.reset():i.recognize(e),!n&&i.state&(Be|Ue|Ve)&&(n=t.curRecognizer=i),o++}},get:function(e){if(e instanceof je)return e;for(var t=this.recognizers,i=0;i<t.length;i++)if(t[i].options.event==e)return t[i];return null},add:function(e){if(v(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(v(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,i=P(t,e);-1!==i&&(t.splice(i,1),this.touchAction.update())}return this},on:function(e,t){if(e!==s&&t!==s){var i=this.handlers;return g(N(e),function(e){i[e]=i[e]||[],i[e].push(t)}),this}},off:function(e,t){if(e!==s){var i=this.handlers;return g(N(e),function(e){t?i[e]&&i[e].splice(P(i[e],t),1):delete i[e]}),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var i=o.createEvent("Event");i.initEvent(e,!0,!0),i.gesture=t,t.target.dispatchEvent(i)}(e,t);var i=this.handlers[e]&&this.handlers[e].slice();if(i&&i.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var r=0;r<i.length;)i[r](t),r++}},destroy:function(){this.element&&it(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},l(et,{INPUT_START:V,INPUT_MOVE:z,INPUT_END:G,INPUT_CANCEL:j,STATE_POSSIBLE:Ie,STATE_BEGAN:Be,STATE_CHANGED:Ue,STATE_ENDED:Ve,STATE_RECOGNIZED:ze,STATE_CANCELLED:Ge,STATE_FAILED:32,DIRECTION_NONE:W,DIRECTION_LEFT:H,DIRECTION_RIGHT:q,DIRECTION_UP:Y,DIRECTION_DOWN:X,DIRECTION_HORIZONTAL:K,DIRECTION_VERTICAL:Q,DIRECTION_ALL:Z,Manager:tt,Input:ee,TouchAction:Fe,TouchInput:Se,MouseInput:ce,PointerEventInput:ve,TouchMouseInput:Ae,SingleTouchInput:be,Recognizer:je,AttrRecognizer:Ye,Tap:$e,Pan:Xe,Swipe:Je,Pinch:Ke,Rotate:Ze,Press:Qe,on:T,off:A,each:g,merge:b,extend:_,assign:l,inherit:x,bindFn:w,prefixed:D}),(void 0!==n?n:"undefined"!=typeof self?self:{}).Hammer=et,(r=function(){return et}.call(t,i,t,e))===s||(e.exports=r)}(window,document)},function(e,t,i){t.util=i(2),t.DOMutil=i(14),t.DataSet=i(11),t.DataView=i(12),t.Queue=i(43),t.Timeline=i(178),t.Graph2d=i(180),t.timeline={Core:i(65),DateUtil:i(36),Range:i(64),stack:i(100),TimeStep:i(66),components:{items:{Item:i(38),BackgroundItem:i(103),BoxItem:i(101),PointItem:i(102),RangeItem:i(70)},BackgroundGroup:i(69),Component:i(16),CurrentTime:i(67),CustomTime:i(46),DataAxis:i(107),DataScale:i(108),GraphGroup:i(109),Group:i(68),ItemSet:i(99),Legend:i(112),LineGraph:i(106),TimeAxis:i(45)}},t.moment=i(9),t.Hammer=i(10),t.keycharm=i(35)},function(e,t,i){var r=i(9),n=i(2),o=i(11),a=i(12),s=i(64),l=i(65),u=i(45),h=i(67),c=i(46),d=i(99),p=i(15).printStyle,f=i(105).allOptions,m=i(105).configureOptions,v=i(71).default,g=i(15).default;function y(e,t,i,l){if(!(this instanceof y))throw new SyntaxError("Constructor must be called with the new operator");if(!(Array.isArray(i)||i instanceof o||i instanceof a)&&i instanceof Object){var c=l;l=i,i=c}l&&l.throttleRedraw&&console.warn('Timeline option "throttleRedraw" is DEPRICATED and no longer supported. It will be removed in the next MAJOR release.');var p=this;if(this.defaultOptions={start:null,end:null,autoResize:!0,orientation:{axis:"bottom",item:"bottom"},moment:r,width:null,height:null,maxHeight:null,minHeight:null},this.options=n.deepExtend({},this.defaultOptions),this._create(e),!l||l&&void 0===l.rtl){this.dom.root.style.visibility="hidden";for(var f,m=this.dom.root;!f&&m;)f=window.getComputedStyle(m,null).direction,m=m.parentElement;this.options.rtl=f&&"rtl"==f.toLowerCase()}else this.options.rtl=l.rtl;this.options.rollingMode=l&&l.rollingMode,this.options.onInitialDrawComplete=l&&l.onInitialDrawComplete,this.components=[],this.body={dom:this.dom,domProps:this.props,emitter:{on:this.on.bind(this),off:this.off.bind(this),emit:this.emit.bind(this)},hiddenDates:[],util:{getScale:function(){return p.timeAxis.step.scale},getStep:function(){return p.timeAxis.step.step},toScreen:p._toScreen.bind(p),toGlobalScreen:p._toGlobalScreen.bind(p),toTime:p._toTime.bind(p),toGlobalTime:p._toGlobalTime.bind(p)}},this.range=new s(this.body,this.options),this.components.push(this.range),this.body.range=this.range,this.timeAxis=new u(this.body,this.options),this.timeAxis2=null,this.components.push(this.timeAxis),this.currentTime=new h(this.body,this.options),this.components.push(this.currentTime),this.itemSet=new d(this.body,this.options),this.components.push(this.itemSet),this.itemsData=null,this.groupsData=null,this.dom.root.onclick=function(e){p.emit("click",p.getEventProperties(e))},this.dom.root.ondblclick=function(e){p.emit("doubleClick",p.getEventProperties(e))},this.dom.root.oncontextmenu=function(e){p.emit("contextmenu",p.getEventProperties(e))},this.dom.root.onmouseover=function(e){p.emit("mouseOver",p.getEventProperties(e))},window.PointerEvent?(this.dom.root.onpointerdown=function(e){p.emit("mouseDown",p.getEventProperties(e))},this.dom.root.onpointermove=function(e){p.emit("mouseMove",p.getEventProperties(e))},this.dom.root.onpointerup=function(e){p.emit("mouseUp",p.getEventProperties(e))}):(this.dom.root.onmousemove=function(e){p.emit("mouseMove",p.getEventProperties(e))},this.dom.root.onmousedown=function(e){p.emit("mouseDown",p.getEventProperties(e))},this.dom.root.onmouseup=function(e){p.emit("mouseUp",p.getEventProperties(e))}),this.initialFitDone=!1,this.on("changed",function(){if(null!=this.itemsData&&!this.options.rollingMode){if(!p.initialFitDone)if(p.initialFitDone=!0,null!=p.options.start||null!=p.options.end){if(null==p.options.start||null==p.options.end)var e=p.getItemRange();var t=null!=p.options.start?p.options.start:e.min,i=null!=p.options.end?p.options.end:e.max;p.setWindow(t,i,{animation:!1})}else p.fit({animation:!1});!p.initialDrawDone&&p.initialRangeChangeDone&&(p.initialDrawDone=!0,p.dom.root.style.visibility="visible",p.options.onInitialDrawComplete&&setTimeout(function(){return p.options.onInitialDrawComplete()},0))}}),l&&this.setOptions(l),i&&this.setGroups(i),t&&this.setItems(t),this._redraw()}function _(e){return n.convert(e.data.start,"Date").valueOf()}function b(e){var t=null!=e.data.end?e.data.end:e.data.start;return n.convert(t,"Date").valueOf()}function x(e,t){var i=e.props.leftContainer.height,r=e.props.left.height,n=t.parent,o=n.top,a=!0,s=e.timeAxis.options.orientation.axis,l=function(){return"bottom"==s?n.height-t.top-t.height:t.top},u=-1*e._getScrollTop(),h=o+l(),c=t.height;return h<u?o+i<=o+l()+c&&(o+=l()-e.itemSet.options.margin.item.vertical):h+c>u+i?o+=l()+c-i+e.itemSet.options.margin.item.vertical:a=!1,{shouldScroll:a,scrollOffset:o=Math.min(o,r-i),itemTop:h}}y.prototype=new l,y.prototype._createConfigurator=function(){return new v(this,this.dom.container,m)},y.prototype.redraw=function(){this.itemSet&&this.itemSet.markDirty({refreshItems:!0}),this._redraw()},y.prototype.setOptions=function(e){if(!0===g.validate(e,f)&&console.log("%cErrors have been found in the supplied options object.",p),l.prototype.setOptions.call(this,e),"type"in e&&e.type!==this.options.type){this.options.type=e.type;var t=this.itemsData;if(t){var i=this.getSelection();this.setItems(null),this.setItems(t),this.setSelection(i)}}},y.prototype.setItems=function(e){var t;t=e?e instanceof o||e instanceof a?e:new o(e,{type:{start:"Date",end:"Date"}}):null,this.itemsData=t,this.itemSet&&this.itemSet.setItems(t)},y.prototype.setGroups=function(e){var t;if(e){var i=function(e){return!1!==e.visible};t=e instanceof o||e instanceof a?new a(e,{filter:i}):new o(e.filter(i))}else t=null;this.groupsData=t,this.itemSet.setGroups(t)},y.prototype.setData=function(e){e&&e.groups&&this.setGroups(e.groups),e&&e.items&&this.setItems(e.items)},y.prototype.setSelection=function(e,t){this.itemSet&&this.itemSet.setSelection(e),t&&t.focus&&this.focus(e,t)},y.prototype.getSelection=function(){return this.itemSet&&this.itemSet.getSelection()||[]},y.prototype.focus=function(e,t){if(this.itemsData&&null!=e){var i=Array.isArray(e)?e:[e],r=this.itemsData.getDataSet().get(i,{type:{start:"Date",end:"Date"}}),n=null,o=null;if(r.forEach(function(e){var t=e.start.valueOf(),i="end"in e?e.end.valueOf():e.start.valueOf();(null===n||t<n)&&(n=t),(null===o||i>o)&&(o=i)}),null!==n&&null!==o){var a=this,s=this.itemSet.items[i[0]],l=-1*this._getScrollTop(),u=null,h=function(){var e=x(a,s);e.shouldScroll&&e.itemTop!=u.itemTop&&(a._setScrollTop(-e.scrollOffset),a._redraw())},c=(n+o)/2,d=Math.max(this.range.end-this.range.start,1.1*(o-n)),p=!t||void 0===t.animation||t.animation;p||(u={shouldScroll:!1,scrollOffset:-1,itemTop:-1}),this.range.setRange(c-d/2,c+d/2,{animation:p},function(){h(),setTimeout(h,100)},function(e,t,i){var r=x(a,s);if(u||(u=r),u.itemTop!=r.itemTop||u.shouldScroll){u.itemTop!=r.itemTop&&r.shouldScroll&&(u=r,l=-1*a._getScrollTop());var n=l,o=u.scrollOffset,h=i?o:n+(o-n)*e;a._setScrollTop(-h),t||a._redraw()}})}}},y.prototype.fit=function(e,t){var i,r=!e||void 0===e.animation||e.animation,n=this.itemsData&&this.itemsData.getDataSet();1===n.length&&void 0===n.get()[0].end?(i=this.getDataRange(),this.moveTo(i.min.valueOf(),{animation:r},t)):(i=this.getItemRange(),this.range.setRange(i.min,i.max,{animation:r},t))},y.prototype.getItemRange=function(){var e=this.getDataRange(),t=null!==e.min?e.min.valueOf():null,i=null!==e.max?e.max.valueOf():null,r=null,o=null;if(null!=t&&null!=i){var a=i-t;a<=0&&(a=10);var s=a/this.props.center.width,l={},u=0;if(n.forEach(this.itemSet.items,function(e,t){if(e.groupShowing){l[t]=e.redraw(!0),u=l[t].length}}),u>0)for(var h=0;h<u;h++)n.forEach(l,function(e){e[h]()});if(n.forEach(this.itemSet.items,function(e){var n,a,l=_(e),u=b(e);this.options.rtl?(n=l-(e.getWidthRight()+10)*s,a=u+(e.getWidthLeft()+10)*s):(n=l-(e.getWidthLeft()+10)*s,a=u+(e.getWidthRight()+10)*s),n<t&&(t=n,r=e),a>i&&(i=a,o=e)}.bind(this)),r&&o){var c=r.getWidthLeft()+10,d=o.getWidthRight()+10,p=this.props.center.width-c-d;p>0&&(this.options.rtl?(t=_(r)-d*a/p,i=b(o)+c*a/p):(t=_(r)-c*a/p,i=b(o)+d*a/p))}}return{min:null!=t?new Date(t):null,max:null!=i?new Date(i):null}},y.prototype.getDataRange=function(){var e=null,t=null,i=this.itemsData&&this.itemsData.getDataSet();return i&&i.forEach(function(i){var r=n.convert(i.start,"Date").valueOf(),o=n.convert(null!=i.end?i.end:i.start,"Date").valueOf();(null===e||r<e)&&(e=r),(null===t||o>t)&&(t=o)}),{min:null!=e?new Date(e):null,max:null!=t?new Date(t):null}},y.prototype.getEventProperties=function(e){var t,i=e.center?e.center.x:e.clientX,r=e.center?e.center.y:e.clientY;t=this.options.rtl?n.getAbsoluteRight(this.dom.centerContainer)-i:i-n.getAbsoluteLeft(this.dom.centerContainer);var o=r-n.getAbsoluteTop(this.dom.centerContainer),a=this.itemSet.itemFromTarget(e),s=this.itemSet.groupFromTarget(e),l=c.customTimeFromTarget(e),u=this.itemSet.options.snap||null,h=this.body.util.getScale(),d=this.body.util.getStep(),p=this._toTime(t),f=u?u(p,h,d):p,m=n.getTarget(e),v=null;return null!=a?v="item":null!=l?v="custom-time":n.hasParent(m,this.timeAxis.dom.foreground)?v="axis":this.timeAxis2&&n.hasParent(m,this.timeAxis2.dom.foreground)?v="axis":n.hasParent(m,this.itemSet.dom.labelSet)?v="group-label":n.hasParent(m,this.currentTime.bar)?v="current-time":n.hasParent(m,this.dom.center)&&(v="background"),{event:e,item:a?a.id:null,group:s?s.groupId:null,what:v,pageX:e.srcEvent?e.srcEvent.pageX:e.pageX,pageY:e.srcEvent?e.srcEvent.pageY:e.pageY,x:t,y:o,time:p,snappedTime:f}},y.prototype.toggleRollingMode=function(){this.range.rolling?this.range.stopRolling():(null==this.options.rollingMode&&this.setOptions(this.options),this.range.startRolling())},e.exports=y},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=a(i(19)),n=a(i(0)),o=a(i(1));function a(e){return e&&e.__esModule?e:{default:e}}var s=i(10),l=i(37),u=i(2),h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;(0,n.default)(this,e),this.pixelRatio=t,this.generated=!1,this.centerCoordinates={x:144.5,y:144.5},this.r=289*.49,this.color={r:255,g:255,b:255,a:1},this.hueCircle=void 0,this.initialColor={r:255,g:255,b:255,a:1},this.previousColor=void 0,this.applied=!1,this.updateCallback=function(){},this.closeCallback=function(){},this._create()}return(0,o.default)(e,[{key:"insertTo",value:function(e){void 0!==this.hammer&&(this.hammer.destroy(),this.hammer=void 0),this.container=e,this.container.appendChild(this.frame),this._bindHammer(),this._setSize()}},{key:"setUpdateCallback",value:function(e){if("function"!=typeof e)throw new Error("Function attempted to set as colorPicker update callback is not a function.");this.updateCallback=e}},{key:"setCloseCallback",value:function(e){if("function"!=typeof e)throw new Error("Function attempted to set as colorPicker closing callback is not a function.");this.closeCallback=e}},{key:"_isColorString",value:function(e){if("string"==typeof e)return{black:"#000000",navy:"#000080",darkblue:"#00008B",mediumblue:"#0000CD",blue:"#0000FF",darkgreen:"#006400",green:"#008000",teal:"#008080",darkcyan:"#008B8B",deepskyblue:"#00BFFF",darkturquoise:"#00CED1",mediumspringgreen:"#00FA9A",lime:"#00FF00",springgreen:"#00FF7F",aqua:"#00FFFF",cyan:"#00FFFF",midnightblue:"#191970",dodgerblue:"#1E90FF",lightseagreen:"#20B2AA",forestgreen:"#228B22",seagreen:"#2E8B57",darkslategray:"#2F4F4F",limegreen:"#32CD32",mediumseagreen:"#3CB371",turquoise:"#40E0D0",royalblue:"#4169E1",steelblue:"#4682B4",darkslateblue:"#483D8B",mediumturquoise:"#48D1CC",indigo:"#4B0082",darkolivegreen:"#556B2F",cadetblue:"#5F9EA0",cornflowerblue:"#6495ED",mediumaquamarine:"#66CDAA",dimgray:"#696969",slateblue:"#6A5ACD",olivedrab:"#6B8E23",slategray:"#708090",lightslategray:"#778899",mediumslateblue:"#7B68EE",lawngreen:"#7CFC00",chartreuse:"#7FFF00",aquamarine:"#7FFFD4",maroon:"#800000",purple:"#800080",olive:"#808000",gray:"#808080",skyblue:"#87CEEB",lightskyblue:"#87CEFA",blueviolet:"#8A2BE2",darkred:"#8B0000",darkmagenta:"#8B008B",saddlebrown:"#8B4513",darkseagreen:"#8FBC8F",lightgreen:"#90EE90",mediumpurple:"#9370D8",darkviolet:"#9400D3",palegreen:"#98FB98",darkorchid:"#9932CC",yellowgreen:"#9ACD32",sienna:"#A0522D",brown:"#A52A2A",darkgray:"#A9A9A9",lightblue:"#ADD8E6",greenyellow:"#ADFF2F",paleturquoise:"#AFEEEE",lightsteelblue:"#B0C4DE",powderblue:"#B0E0E6",firebrick:"#B22222",darkgoldenrod:"#B8860B",mediumorchid:"#BA55D3",rosybrown:"#BC8F8F",darkkhaki:"#BDB76B",silver:"#C0C0C0",mediumvioletred:"#C71585",indianred:"#CD5C5C",peru:"#CD853F",chocolate:"#D2691E",tan:"#D2B48C",lightgrey:"#D3D3D3",palevioletred:"#D87093",thistle:"#D8BFD8",orchid:"#DA70D6",goldenrod:"#DAA520",crimson:"#DC143C",gainsboro:"#DCDCDC",plum:"#DDA0DD",burlywood:"#DEB887",lightcyan:"#E0FFFF",lavender:"#E6E6FA",darksalmon:"#E9967A",violet:"#EE82EE",palegoldenrod:"#EEE8AA",lightcoral:"#F08080",khaki:"#F0E68C",aliceblue:"#F0F8FF",honeydew:"#F0FFF0",azure:"#F0FFFF",sandybrown:"#F4A460",wheat:"#F5DEB3",beige:"#F5F5DC",whitesmoke:"#F5F5F5",mintcream:"#F5FFFA",ghostwhite:"#F8F8FF",salmon:"#FA8072",antiquewhite:"#FAEBD7",linen:"#FAF0E6",lightgoldenrodyellow:"#FAFAD2",oldlace:"#FDF5E6",red:"#FF0000",fuchsia:"#FF00FF",magenta:"#FF00FF",deeppink:"#FF1493",orangered:"#FF4500",tomato:"#FF6347",hotpink:"#FF69B4",coral:"#FF7F50",darkorange:"#FF8C00",lightsalmon:"#FFA07A",orange:"#FFA500",lightpink:"#FFB6C1",pink:"#FFC0CB",gold:"#FFD700",peachpuff:"#FFDAB9",navajowhite:"#FFDEAD",moccasin:"#FFE4B5",bisque:"#FFE4C4",mistyrose:"#FFE4E1",blanchedalmond:"#FFEBCD",papayawhip:"#FFEFD5",lavenderblush:"#FFF0F5",seashell:"#FFF5EE",cornsilk:"#FFF8DC",lemonchiffon:"#FFFACD",floralwhite:"#FFFAF0",snow:"#FFFAFA",yellow:"#FFFF00",lightyellow:"#FFFFE0",ivory:"#FFFFF0",white:"#FFFFFF"}[e]}},{key:"setColor",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("none"!==e){var i=void 0,n=this._isColorString(e);if(void 0!==n&&(e=n),!0===u.isString(e)){if(!0===u.isValidRGB(e)){var o=e.substr(4).substr(0,e.length-5).split(",");i={r:o[0],g:o[1],b:o[2],a:1}}else if(!0===u.isValidRGBA(e)){var a=e.substr(5).substr(0,e.length-6).split(",");i={r:a[0],g:a[1],b:a[2],a:a[3]}}else if(!0===u.isValidHex(e)){var s=u.hexToRGB(e);i={r:s.r,g:s.g,b:s.b,a:1}}}else if(e instanceof Object&&void 0!==e.r&&void 0!==e.g&&void 0!==e.b){var l=void 0!==e.a?e.a:"1.0";i={r:e.r,g:e.g,b:e.b,a:l}}if(void 0===i)throw new Error("Unknown color passed to the colorPicker. Supported are strings: rgb, hex, rgba. Object: rgb ({r:r,g:g,b:b,[a:a]}). Supplied: "+(0,r.default)(e));this._setColor(i,t)}}},{key:"show",value:function(){void 0!==this.closeCallback&&(this.closeCallback(),this.closeCallback=void 0),this.applied=!1,this.frame.style.display="block",this._generateHueCircle()}},{key:"_hide",value:function(){var e=this;!0===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(this.previousColor=u.extend({},this.color)),!0===this.applied&&this.updateCallback(this.initialColor),this.frame.style.display="none",setTimeout(function(){void 0!==e.closeCallback&&(e.closeCallback(),e.closeCallback=void 0)},0)}},{key:"_save",value:function(){this.updateCallback(this.color),this.applied=!1,this._hide()}},{key:"_apply",value:function(){this.applied=!0,this.updateCallback(this.color),this._updatePicker(this.color)}},{key:"_loadLast",value:function(){void 0!==this.previousColor?this.setColor(this.previousColor,!1):alert("There is no last color to load...")}},{key:"_setColor",value:function(e){!0===(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&(this.initialColor=u.extend({},e)),this.color=e;var t=u.RGBToHSV(e.r,e.g,e.b),i=2*Math.PI,r=this.r*t.s,n=this.centerCoordinates.x+r*Math.sin(i*t.h),o=this.centerCoordinates.y+r*Math.cos(i*t.h);this.colorPickerSelector.style.left=n-.5*this.colorPickerSelector.clientWidth+"px",this.colorPickerSelector.style.top=o-.5*this.colorPickerSelector.clientHeight+"px",this._updatePicker(e)}},{key:"_setOpacity",value:function(e){this.color.a=e/100,this._updatePicker(this.color)}},{key:"_setBrightness",value:function(e){var t=u.RGBToHSV(this.color.r,this.color.g,this.color.b);t.v=e/100;var i=u.HSVToRGB(t.h,t.s,t.v);i.a=this.color.a,this.color=i,this._updatePicker()}},{key:"_updatePicker",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.color,t=u.RGBToHSV(e.r,e.g,e.b),i=this.colorPickerCanvas.getContext("2d");void 0===this.pixelRation&&(this.pixelRatio=(window.devicePixelRatio||1)/(i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1)),i.setTransform(this.pixelRatio,0,0,this.pixelRatio,0,0);var r=this.colorPickerCanvas.clientWidth,n=this.colorPickerCanvas.clientHeight;i.clearRect(0,0,r,n),i.putImageData(this.hueCircle,0,0),i.fillStyle="rgba(0,0,0,"+(1-t.v)+")",i.circle(this.centerCoordinates.x,this.centerCoordinates.y,this.r),i.fill(),this.brightnessRange.value=100*t.v,this.opacityRange.value=100*e.a,this.initialColorDiv.style.backgroundColor="rgba("+this.initialColor.r+","+this.initialColor.g+","+this.initialColor.b+","+this.initialColor.a+")",this.newColorDiv.style.backgroundColor="rgba("+this.color.r+","+this.color.g+","+this.color.b+","+this.color.a+")"}},{key:"_setSize",value:function(){this.colorPickerCanvas.style.width="100%",this.colorPickerCanvas.style.height="100%",this.colorPickerCanvas.width=289*this.pixelRatio,this.colorPickerCanvas.height=289*this.pixelRatio}},{key:"_create",value:function(){if(this.frame=document.createElement("div"),this.frame.className="vis-color-picker",this.colorPickerDiv=document.createElement("div"),this.colorPickerSelector=document.createElement("div"),this.colorPickerSelector.className="vis-selector",this.colorPickerDiv.appendChild(this.colorPickerSelector),this.colorPickerCanvas=document.createElement("canvas"),this.colorPickerDiv.appendChild(this.colorPickerCanvas),this.colorPickerCanvas.getContext){var e=this.colorPickerCanvas.getContext("2d");this.pixelRatio=(window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1),this.colorPickerCanvas.getContext("2d").setTransform(this.pixelRatio,0,0,this.pixelRatio,0,0)}else{var t=document.createElement("DIV");t.style.color="red",t.style.fontWeight="bold",t.style.padding="10px",t.innerHTML="Error: your browser does not support HTML canvas",this.colorPickerCanvas.appendChild(t)}this.colorPickerDiv.className="vis-color",this.opacityDiv=document.createElement("div"),this.opacityDiv.className="vis-opacity",this.brightnessDiv=document.createElement("div"),this.brightnessDiv.className="vis-brightness",this.arrowDiv=document.createElement("div"),this.arrowDiv.className="vis-arrow",this.opacityRange=document.createElement("input");try{this.opacityRange.type="range",this.opacityRange.min="0",this.opacityRange.max="100"}catch(e){}this.opacityRange.value="100",this.opacityRange.className="vis-range",this.brightnessRange=document.createElement("input");try{this.brightnessRange.type="range",this.brightnessRange.min="0",this.brightnessRange.max="100"}catch(e){}this.brightnessRange.value="100",this.brightnessRange.className="vis-range",this.opacityDiv.appendChild(this.opacityRange),this.brightnessDiv.appendChild(this.brightnessRange);var i=this;this.opacityRange.onchange=function(){i._setOpacity(this.value)},this.opacityRange.oninput=function(){i._setOpacity(this.value)},this.brightnessRange.onchange=function(){i._setBrightness(this.value)},this.brightnessRange.oninput=function(){i._setBrightness(this.value)},this.brightnessLabel=document.createElement("div"),this.brightnessLabel.className="vis-label vis-brightness",this.brightnessLabel.innerHTML="brightness:",this.opacityLabel=document.createElement("div"),this.opacityLabel.className="vis-label vis-opacity",this.opacityLabel.innerHTML="opacity:",this.newColorDiv=document.createElement("div"),this.newColorDiv.className="vis-new-color",this.newColorDiv.innerHTML="new",this.initialColorDiv=document.createElement("div"),this.initialColorDiv.className="vis-initial-color",this.initialColorDiv.innerHTML="initial",this.cancelButton=document.createElement("div"),this.cancelButton.className="vis-button vis-cancel",this.cancelButton.innerHTML="cancel",this.cancelButton.onclick=this._hide.bind(this,!1),this.applyButton=document.createElement("div"),this.applyButton.className="vis-button vis-apply",this.applyButton.innerHTML="apply",this.applyButton.onclick=this._apply.bind(this),this.saveButton=document.createElement("div"),this.saveButton.className="vis-button vis-save",this.saveButton.innerHTML="save",this.saveButton.onclick=this._save.bind(this),this.loadButton=document.createElement("div"),this.loadButton.className="vis-button vis-load",this.loadButton.innerHTML="load last",this.loadButton.onclick=this._loadLast.bind(this),this.frame.appendChild(this.colorPickerDiv),this.frame.appendChild(this.arrowDiv),this.frame.appendChild(this.brightnessLabel),this.frame.appendChild(this.brightnessDiv),this.frame.appendChild(this.opacityLabel),this.frame.appendChild(this.opacityDiv),this.frame.appendChild(this.newColorDiv),this.frame.appendChild(this.initialColorDiv),this.frame.appendChild(this.cancelButton),this.frame.appendChild(this.applyButton),this.frame.appendChild(this.saveButton),this.frame.appendChild(this.loadButton)}},{key:"_bindHammer",value:function(){var e=this;this.drag={},this.pinch={},this.hammer=new s(this.colorPickerCanvas),this.hammer.get("pinch").set({enable:!0}),l.onTouch(this.hammer,function(t){e._moveSelector(t)}),this.hammer.on("tap",function(t){e._moveSelector(t)}),this.hammer.on("panstart",function(t){e._moveSelector(t)}),this.hammer.on("panmove",function(t){e._moveSelector(t)}),this.hammer.on("panend",function(t){e._moveSelector(t)})}},{key:"_generateHueCircle",value:function(){if(!1===this.generated){var e=this.colorPickerCanvas.getContext("2d");void 0===this.pixelRation&&(this.pixelRatio=(window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1)),e.setTransform(this.pixelRatio,0,0,this.pixelRatio,0,0);var t=this.colorPickerCanvas.clientWidth,i=this.colorPickerCanvas.clientHeight;e.clearRect(0,0,t,i);var r=void 0,n=void 0,o=void 0,a=void 0;this.centerCoordinates={x:.5*t,y:.5*i},this.r=.49*t;var s=2*Math.PI/360,l=1/this.r,h=void 0;for(o=0;o<360;o++)for(a=0;a<this.r;a++)r=this.centerCoordinates.x+a*Math.sin(s*o),n=this.centerCoordinates.y+a*Math.cos(s*o),h=u.HSVToRGB(o*(1/360),a*l,1),e.fillStyle="rgb("+h.r+","+h.g+","+h.b+")",e.fillRect(r-.5,n-.5,2,2);e.strokeStyle="rgba(0,0,0,1)",e.circle(this.centerCoordinates.x,this.centerCoordinates.y,this.r),e.stroke(),this.hueCircle=e.getImageData(0,0,t,i)}this.generated=!0}},{key:"_moveSelector",value:function(e){var t=this.colorPickerDiv.getBoundingClientRect(),i=e.center.x-t.left,r=e.center.y-t.top,n=.5*this.colorPickerDiv.clientHeight,o=.5*this.colorPickerDiv.clientWidth,a=i-o,s=r-n,l=Math.atan2(a,s),h=.98*Math.min(Math.sqrt(a*a+s*s),o),c=Math.cos(l)*h+n,d=Math.sin(l)*h+o;this.colorPickerSelector.style.top=c-.5*this.colorPickerSelector.clientHeight+"px",this.colorPickerSelector.style.left=d-.5*this.colorPickerSelector.clientWidth+"px";var p=l/(2*Math.PI);p=p<0?p+1:p;var f=h/this.r,m=u.RGBToHSV(this.color.r,this.color.g,this.color.b);m.h=p,m.s=f;var v=u.HSVToRGB(m.h,m.s,m.v);v.a=this.color.a,this.color=v,this.initialColorDiv.style.backgroundColor="rgba("+this.initialColor.r+","+this.initialColor.g+","+this.initialColor.b+","+this.initialColor.a+")",this.newColorDiv.style.backgroundColor="rgba("+this.color.r+","+this.color.g+","+this.color.b+","+this.color.a+")"}}]),e}();t.default=h},function(e,t,i){var r=i(9),n=i(2),o=i(11),a=i(12),s=i(64),l=i(65),u=i(45),h=i(67),c=i(46),d=i(106),p=i(15).printStyle,f=i(113).allOptions,m=i(113).configureOptions,v=i(71).default,g=i(15).default;function y(e,t,i,l){if(!(Array.isArray(i)||i instanceof o||i instanceof a)&&i instanceof Object){var c=l;l=i,i=c}l&&l.throttleRedraw&&console.warn('Graph2d option "throttleRedraw" is DEPRICATED and no longer supported. It will be removed in the next MAJOR release.');var p=this;this.defaultOptions={start:null,end:null,autoResize:!0,orientation:{axis:"bottom",item:"bottom"},moment:r,width:null,height:null,maxHeight:null,minHeight:null},this.options=n.deepExtend({},this.defaultOptions),this._create(e),this.components=[],this.body={dom:this.dom,domProps:this.props,emitter:{on:this.on.bind(this),off:this.off.bind(this),emit:this.emit.bind(this)},hiddenDates:[],util:{toScreen:p._toScreen.bind(p),toGlobalScreen:p._toGlobalScreen.bind(p),toTime:p._toTime.bind(p),toGlobalTime:p._toGlobalTime.bind(p)}},this.range=new s(this.body),this.components.push(this.range),this.body.range=this.range,this.timeAxis=new u(this.body),this.components.push(this.timeAxis),this.currentTime=new h(this.body),this.components.push(this.currentTime),this.linegraph=new d(this.body),this.components.push(this.linegraph),this.itemsData=null,this.groupsData=null,this.on("tap",function(e){p.emit("click",p.getEventProperties(e))}),this.on("doubletap",function(e){p.emit("doubleClick",p.getEventProperties(e))}),this.dom.root.oncontextmenu=function(e){p.emit("contextmenu",p.getEventProperties(e))},l&&this.setOptions(l),i&&this.setGroups(i),t&&this.setItems(t),this._redraw()}y.prototype=new l,y.prototype.setOptions=function(e){!0===g.validate(e,f)&&console.log("%cErrors have been found in the supplied options object.",p),l.prototype.setOptions.call(this,e)},y.prototype.setItems=function(e){var t,i=null==this.itemsData;if(t=e?e instanceof o||e instanceof a?e:new o(e,{type:{start:"Date",end:"Date"}}):null,this.itemsData=t,this.linegraph&&this.linegraph.setItems(t),i)if(null!=this.options.start||null!=this.options.end){var r=null!=this.options.start?this.options.start:null,n=null!=this.options.end?this.options.end:null;this.setWindow(r,n,{animation:!1})}else this.fit({animation:!1})},y.prototype.setGroups=function(e){var t;t=e?e instanceof o||e instanceof a?e:new o(e):null,this.groupsData=t,this.linegraph.setGroups(t)},y.prototype.getLegend=function(e,t,i){return void 0===t&&(t=15),void 0===i&&(i=15),void 0!==this.linegraph.groups[e]?this.linegraph.groups[e].getLegend(t,i):"cannot find group:'"+e+"'"},y.prototype.isGroupVisible=function(e){return void 0!==this.linegraph.groups[e]&&(this.linegraph.groups[e].visible&&(void 0===this.linegraph.options.groups.visibility[e]||1==this.linegraph.options.groups.visibility[e]))},y.prototype.getDataRange=function(){var e=null,t=null;for(var i in this.linegraph.groups)if(this.linegraph.groups.hasOwnProperty(i)&&1==this.linegraph.groups[i].visible)for(var r=0;r<this.linegraph.groups[i].itemsData.length;r++){var o=this.linegraph.groups[i].itemsData[r],a=n.convert(o.x,"Date").valueOf();e=null==e?a:e>a?a:e,t=null==t?a:t<a?a:t}return{min:null!=e?new Date(e):null,max:null!=t?new Date(t):null}},y.prototype.getEventProperties=function(e){var t=e.center?e.center.x:e.clientX,i=e.center?e.center.y:e.clientY,r=t-n.getAbsoluteLeft(this.dom.centerContainer),o=i-n.getAbsoluteTop(this.dom.centerContainer),a=this._toTime(r),s=c.customTimeFromTarget(e),l=n.getTarget(e),u=null;n.hasParent(l,this.timeAxis.dom.foreground)?u="axis":this.timeAxis2&&n.hasParent(l,this.timeAxis2.dom.foreground)?u="axis":n.hasParent(l,this.linegraph.yAxisLeft.dom.frame)?u="data-axis":n.hasParent(l,this.linegraph.yAxisRight.dom.frame)?u="data-axis":n.hasParent(l,this.linegraph.legendLeft.dom.frame)?u="legend":n.hasParent(l,this.linegraph.legendRight.dom.frame)?u="legend":null!=s?u="custom-time":n.hasParent(l,this.currentTime.bar)?u="current-time":n.hasParent(l,this.dom.center)&&(u="background");var h=[],d=this.linegraph.yAxisLeft,p=this.linegraph.yAxisRight;return!d.hidden&&this.itemsData.length>0&&h.push(d.screenToValue(o)),!p.hidden&&this.itemsData.length>0&&h.push(p.screenToValue(o)),{event:e,what:u,pageX:e.srcEvent?e.srcEvent.pageX:e.pageX,pageY:e.srcEvent?e.srcEvent.pageY:e.pageY,x:r,y:o,time:a,value:h}},y.prototype._createConfigurator=function(){return new v(this,this.dom.container,m)},e.exports=y},function(e,t,i){t.util=i(2),t.DOMutil=i(14),t.DataSet=i(11),t.DataView=i(12),t.Queue=i(43),t.Network=i(182),t.network={Images:i(116),dotparser:i(114),gephiParser:i(115),allOptions:i(122)},t.network.convertDot=function(e){return t.network.dotparser.DOTToGraph(e)},t.network.convertGephi=function(e,i){return t.network.gephiParser.parseGephi(e,i)},t.moment=i(9),t.Hammer=i(10),t.keycharm=i(35)},function(e,t,i){i(183);var r=i(44),n=i(2),o=i(114),a=i(115),s=i(97),l=i(184),u=i(116).default,h=i(186).default,c=i(187).default,d=i(214).default,p=i(220).default,f=i(227).default,m=i(229).default,v=i(230).default,g=i(231).default,y=i(232).default,_=i(234).default,b=i(235).default,x=i(237).default,w=i(71).default,S=i(15).default,M=i(15).printStyle,T=i(122),A=T.allOptions,C=T.configureOptions,L=i(238).default;function N(e,t,i){var r=this;if(!(this instanceof N))throw new SyntaxError("Constructor must be called with the new operator");this.options={},this.defaultOptions={locale:"en",locales:l,clickToUse:!1},n.extend(this.options,this.defaultOptions),this.body={container:e,nodes:{},nodeIndices:[],edges:{},edgeIndices:[],emitter:{on:this.on.bind(this),off:this.off.bind(this),emit:this.emit.bind(this),once:this.once.bind(this)},eventListeners:{onTap:function(){},onTouch:function(){},onDoubleTap:function(){},onHold:function(){},onDragStart:function(){},onDrag:function(){},onDragEnd:function(){},onMouseWheel:function(){},onPinch:function(){},onMouseMove:function(){},onRelease:function(){},onContext:function(){}},data:{nodes:null,edges:null},functions:{createNode:function(){},createEdge:function(){},getPointer:function(){}},modules:{},view:{scale:1,translation:{x:0,y:0}}},this.bindEventListeners(),this.images=new u(function(){return r.body.emitter.emit("_requestRedraw")}),this.groups=new h,this.canvas=new v(this.body),this.selectionHandler=new _(this.body,this.canvas),this.interactionHandler=new y(this.body,this.canvas,this.selectionHandler),this.view=new g(this.body,this.canvas),this.renderer=new m(this.body,this.canvas),this.physics=new p(this.body),this.layoutEngine=new b(this.body),this.clustering=new f(this.body),this.manipulation=new x(this.body,this.canvas,this.selectionHandler),this.nodesHandler=new c(this.body,this.images,this.groups,this.layoutEngine),this.edgesHandler=new d(this.body,this.images,this.groups),this.body.modules.kamadaKawai=new L(this.body,150,.05),this.body.modules.clustering=this.clustering,this.canvas._create(),this.setOptions(i),this.setData(t)}r(N.prototype),N.prototype.setOptions=function(e){var t=this;if(void 0!==e){!0===S.validate(e,A)&&console.log("%cErrors have been found in the supplied options object.",M);if(n.selectiveDeepExtend(["locale","locales","clickToUse"],this.options,e),e=this.layoutEngine.setOptions(e.layout,e),this.canvas.setOptions(e),this.groups.setOptions(e.groups),this.nodesHandler.setOptions(e.nodes),this.edgesHandler.setOptions(e.edges),this.physics.setOptions(e.physics),this.manipulation.setOptions(e.manipulation,e,this.options),this.interactionHandler.setOptions(e.interaction),this.renderer.setOptions(e.interaction),this.selectionHandler.setOptions(e.interaction),void 0!==e.groups&&this.body.emitter.emit("refreshNodes"),"configure"in e&&(this.configurator||(this.configurator=new w(this,this.body.container,C,this.canvas.pixelRatio)),this.configurator.setOptions(e.configure)),this.configurator&&!0===this.configurator.options.enabled){var i={nodes:{},edges:{},layout:{},interaction:{},manipulation:{},physics:{},global:{}};n.deepExtend(i.nodes,this.nodesHandler.options),n.deepExtend(i.edges,this.edgesHandler.options),n.deepExtend(i.layout,this.layoutEngine.options),n.deepExtend(i.interaction,this.selectionHandler.options),n.deepExtend(i.interaction,this.renderer.options),n.deepExtend(i.interaction,this.interactionHandler.options),n.deepExtend(i.manipulation,this.manipulation.options),n.deepExtend(i.physics,this.physics.options),n.deepExtend(i.global,this.canvas.options),n.deepExtend(i.global,this.options),this.configurator.setModuleOptions(i)}void 0!==e.clickToUse?!0===e.clickToUse?void 0===this.activator&&(this.activator=new s(this.canvas.frame),this.activator.on("change",function(){t.body.emitter.emit("activate")})):(void 0!==this.activator&&(this.activator.destroy(),delete this.activator),this.body.emitter.emit("activate")):this.body.emitter.emit("activate"),this.canvas.setSize(),this.body.emitter.emit("startSimulation")}},N.prototype._updateVisibleIndices=function(){var e=this.body.nodes,t=this.body.edges;for(var i in this.body.nodeIndices=[],this.body.edgeIndices=[],e)e.hasOwnProperty(i)&&(this.clustering._isClusteredNode(i)||!1!==e[i].options.hidden||this.body.nodeIndices.push(e[i].id));for(var r in t)if(t.hasOwnProperty(r)){var n=t[r],o=e[n.fromId],a=e[n.toId],s=void 0!==o&&void 0!==a;!this.clustering._isClusteredEdge(r)&&!1===n.options.hidden&&s&&!1===o.options.hidden&&!1===a.options.hidden&&this.body.edgeIndices.push(n.id)}},N.prototype.bindEventListeners=function(){var e=this;this.body.emitter.on("_dataChanged",function(){e.edgesHandler._updateState(),e.body.emitter.emit("_dataUpdated")}),this.body.emitter.on("_dataUpdated",function(){e.clustering._updateState(),e._updateVisibleIndices(),e._updateValueRange(e.body.nodes),e._updateValueRange(e.body.edges),e.body.emitter.emit("startSimulation"),e.body.emitter.emit("_requestRedraw")})},N.prototype.setData=function(e){if(this.body.emitter.emit("resetPhysics"),this.body.emitter.emit("_resetData"),this.selectionHandler.unselectAll(),e&&e.dot&&(e.nodes||e.edges))throw new SyntaxError('Data must contain either parameter "dot" or  parameter pair "nodes" and "edges", but not both.');if(this.setOptions(e&&e.options),e&&e.dot){console.log("The dot property has been deprecated. Please use the static convertDot method to convert DOT into vis.network format and use the normal data format with nodes and edges. This converter is used like this: var data = vis.network.convertDot(dotString);");var t=o.DOTToGraph(e.dot);this.setData(t)}else if(e&&e.gephi){console.log("The gephi property has been deprecated. Please use the static convertGephi method to convert gephi into vis.network format and use the normal data format with nodes and edges. This converter is used like this: var data = vis.network.convertGephi(gephiJson);");var i=a.parseGephi(e.gephi);this.setData(i)}else this.nodesHandler.setData(e&&e.nodes,!0),this.edgesHandler.setData(e&&e.edges,!0),this.body.emitter.emit("_dataChanged"),this.body.emitter.emit("_dataLoaded"),this.body.emitter.emit("initPhysics")},N.prototype.destroy=function(){for(var e in this.body.emitter.emit("destroy"),this.body.emitter.off(),this.off(),delete this.groups,delete this.canvas,delete this.selectionHandler,delete this.interactionHandler,delete this.view,delete this.renderer,delete this.physics,delete this.layoutEngine,delete this.clustering,delete this.manipulation,delete this.nodesHandler,delete this.edgesHandler,delete this.configurator,delete this.images,this.body.nodes)this.body.nodes.hasOwnProperty(e)&&delete this.body.nodes[e];for(var t in this.body.edges)this.body.edges.hasOwnProperty(t)&&delete this.body.edges[t];n.recursiveDOMDelete(this.body.container)},N.prototype._updateValueRange=function(e){var t,i=void 0,r=void 0,n=0;for(t in e)if(e.hasOwnProperty(t)){var o=e[t].getValue();void 0!==o&&(i=void 0===i?o:Math.min(o,i),r=void 0===r?o:Math.max(o,r),n+=o)}if(void 0!==i&&void 0!==r)for(t in e)e.hasOwnProperty(t)&&e[t].setValueRange(i,r,n)},N.prototype.isActive=function(){return!this.activator||this.activator.active},N.prototype.setSize=function(){return this.canvas.setSize.apply(this.canvas,arguments)},N.prototype.canvasToDOM=function(){return this.canvas.canvasToDOM.apply(this.canvas,arguments)},N.prototype.DOMtoCanvas=function(){return this.canvas.DOMtoCanvas.apply(this.canvas,arguments)},N.prototype.findNode=function(){return this.clustering.findNode.apply(this.clustering,arguments)},N.prototype.isCluster=function(){return this.clustering.isCluster.apply(this.clustering,arguments)},N.prototype.openCluster=function(){return this.clustering.openCluster.apply(this.clustering,arguments)},N.prototype.cluster=function(){return this.clustering.cluster.apply(this.clustering,arguments)},N.prototype.getNodesInCluster=function(){return this.clustering.getNodesInCluster.apply(this.clustering,arguments)},N.prototype.clusterByConnection=function(){return this.clustering.clusterByConnection.apply(this.clustering,arguments)},N.prototype.clusterByHubsize=function(){return this.clustering.clusterByHubsize.apply(this.clustering,arguments)},N.prototype.clusterOutliers=function(){return this.clustering.clusterOutliers.apply(this.clustering,arguments)},N.prototype.getSeed=function(){return this.layoutEngine.getSeed.apply(this.layoutEngine,arguments)},N.prototype.enableEditMode=function(){return this.manipulation.enableEditMode.apply(this.manipulation,arguments)},N.prototype.disableEditMode=function(){return this.manipulation.disableEditMode.apply(this.manipulation,arguments)},N.prototype.addNodeMode=function(){return this.manipulation.addNodeMode.apply(this.manipulation,arguments)},N.prototype.editNode=function(){return this.manipulation.editNode.apply(this.manipulation,arguments)},N.prototype.editNodeMode=function(){return console.log("Deprecated: Please use editNode instead of editNodeMode."),this.manipulation.editNode.apply(this.manipulation,arguments)},N.prototype.addEdgeMode=function(){return this.manipulation.addEdgeMode.apply(this.manipulation,arguments)},N.prototype.editEdgeMode=function(){return this.manipulation.editEdgeMode.apply(this.manipulation,arguments)},N.prototype.deleteSelected=function(){return this.manipulation.deleteSelected.apply(this.manipulation,arguments)},N.prototype.getPositions=function(){return this.nodesHandler.getPositions.apply(this.nodesHandler,arguments)},N.prototype.storePositions=function(){return this.nodesHandler.storePositions.apply(this.nodesHandler,arguments)},N.prototype.moveNode=function(){return this.nodesHandler.moveNode.apply(this.nodesHandler,arguments)},N.prototype.getBoundingBox=function(){return this.nodesHandler.getBoundingBox.apply(this.nodesHandler,arguments)},N.prototype.getConnectedNodes=function(e){return void 0!==this.body.nodes[e]?this.nodesHandler.getConnectedNodes.apply(this.nodesHandler,arguments):this.edgesHandler.getConnectedNodes.apply(this.edgesHandler,arguments)},N.prototype.getConnectedEdges=function(){return this.nodesHandler.getConnectedEdges.apply(this.nodesHandler,arguments)},N.prototype.startSimulation=function(){return this.physics.startSimulation.apply(this.physics,arguments)},N.prototype.stopSimulation=function(){return this.physics.stopSimulation.apply(this.physics,arguments)},N.prototype.stabilize=function(){return this.physics.stabilize.apply(this.physics,arguments)},N.prototype.getSelection=function(){return this.selectionHandler.getSelection.apply(this.selectionHandler,arguments)},N.prototype.setSelection=function(){return this.selectionHandler.setSelection.apply(this.selectionHandler,arguments)},N.prototype.getSelectedNodes=function(){return this.selectionHandler.getSelectedNodes.apply(this.selectionHandler,arguments)},N.prototype.getSelectedEdges=function(){return this.selectionHandler.getSelectedEdges.apply(this.selectionHandler,arguments)},N.prototype.getNodeAt=function(){var e=this.selectionHandler.getNodeAt.apply(this.selectionHandler,arguments);return void 0!==e&&void 0!==e.id?e.id:e},N.prototype.getEdgeAt=function(){var e=this.selectionHandler.getEdgeAt.apply(this.selectionHandler,arguments);return void 0!==e&&void 0!==e.id?e.id:e},N.prototype.selectNodes=function(){return this.selectionHandler.selectNodes.apply(this.selectionHandler,arguments)},N.prototype.selectEdges=function(){return this.selectionHandler.selectEdges.apply(this.selectionHandler,arguments)},N.prototype.unselectAll=function(){this.selectionHandler.unselectAll.apply(this.selectionHandler,arguments),this.redraw()},N.prototype.redraw=function(){return this.renderer.redraw.apply(this.renderer,arguments)},N.prototype.getScale=function(){return this.view.getScale.apply(this.view,arguments)},N.prototype.getViewPosition=function(){return this.view.getViewPosition.apply(this.view,arguments)},N.prototype.fit=function(){return this.view.fit.apply(this.view,arguments)},N.prototype.moveTo=function(){return this.view.moveTo.apply(this.view,arguments)},N.prototype.focus=function(){return this.view.focus.apply(this.view,arguments)},N.prototype.releaseNode=function(){return this.view.releaseNode.apply(this.view,arguments)},N.prototype.getOptionsFromConfigurator=function(){var e={};return this.configurator&&(e=this.configurator.getOptions.apply(this.configurator)),e},e.exports=N},function(e,t,i){"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.circle=function(e,t,i){this.beginPath(),this.arc(e,t,i,0,2*Math.PI,!1),this.closePath()},CanvasRenderingContext2D.prototype.square=function(e,t,i){this.beginPath(),this.rect(e-i,t-i,2*i,2*i),this.closePath()},CanvasRenderingContext2D.prototype.triangle=function(e,t,i){this.beginPath(),t+=.275*(i*=1.15);var r=2*i,n=r/2,o=Math.sqrt(3)/6*r,a=Math.sqrt(r*r-n*n);this.moveTo(e,t-(a-o)),this.lineTo(e+n,t+o),this.lineTo(e-n,t+o),this.lineTo(e,t-(a-o)),this.closePath()},CanvasRenderingContext2D.prototype.triangleDown=function(e,t,i){this.beginPath(),t-=.275*(i*=1.15);var r=2*i,n=r/2,o=Math.sqrt(3)/6*r,a=Math.sqrt(r*r-n*n);this.moveTo(e,t+(a-o)),this.lineTo(e+n,t-o),this.lineTo(e-n,t-o),this.lineTo(e,t+(a-o)),this.closePath()},CanvasRenderingContext2D.prototype.star=function(e,t,i){this.beginPath(),t+=.1*(i*=.82);for(var r=0;r<10;r++){var n=r%2==0?1.3*i:.5*i;this.lineTo(e+n*Math.sin(2*r*Math.PI/10),t-n*Math.cos(2*r*Math.PI/10))}this.closePath()},CanvasRenderingContext2D.prototype.diamond=function(e,t,i){this.beginPath(),this.lineTo(e,t+i),this.lineTo(e+i,t),this.lineTo(e,t-i),this.lineTo(e-i,t),this.closePath()},CanvasRenderingContext2D.prototype.roundRect=function(e,t,i,r,n){var o=Math.PI/180;i-2*n<0&&(n=i/2),r-2*n<0&&(n=r/2),this.beginPath(),this.moveTo(e+n,t),this.lineTo(e+i-n,t),this.arc(e+i-n,t+n,n,270*o,360*o,!1),this.lineTo(e+i,t+r-n),this.arc(e+i-n,t+r-n,n,0,90*o,!1),this.lineTo(e+n,t+r),this.arc(e+n,t+r-n,n,90*o,180*o,!1),this.lineTo(e,t+n),this.arc(e+n,t+n,n,180*o,270*o,!1),this.closePath()},CanvasRenderingContext2D.prototype.ellipse_vis=function(e,t,i,r){var n=i/2*.5522848,o=r/2*.5522848,a=e+i,s=t+r,l=e+i/2,u=t+r/2;this.beginPath(),this.moveTo(e,u),this.bezierCurveTo(e,u-o,l-n,t,l,t),this.bezierCurveTo(l+n,t,a,u-o,a,u),this.bezierCurveTo(a,u+o,l+n,s,l,s),this.bezierCurveTo(l-n,s,e,u+o,e,u),this.closePath()},CanvasRenderingContext2D.prototype.database=function(e,t,i,r){var n=r*(1/3),o=i/2*.5522848,a=n/2*.5522848,s=e+i,l=t+n,u=e+i/2,h=t+n/2,c=t+(r-n/2),d=t+r;this.beginPath(),this.moveTo(s,h),this.bezierCurveTo(s,h+a,u+o,l,u,l),this.bezierCurveTo(u-o,l,e,h+a,e,h),this.bezierCurveTo(e,h-a,u-o,t,u,t),this.bezierCurveTo(u+o,t,s,h-a,s,h),this.lineTo(s,c),this.bezierCurveTo(s,c+a,u+o,d,u,d),this.bezierCurveTo(u-o,d,e,c+a,e,c),this.lineTo(e,h)},CanvasRenderingContext2D.prototype.dashedLine=function(e,t,i,r,n){this.beginPath(),this.moveTo(e,t);for(var o=n.length,a=i-e,s=r-t,l=s/a,u=Math.sqrt(a*a+s*s),h=0,c=!0,d=0,p=n[0];u>=.1;)(p=n[h++%o])>u&&(p=u),d=Math.sqrt(p*p/(1+l*l)),e+=d=a<0?-d:d,t+=l*d,!0===c?this.lineTo(e,t):this.moveTo(e,t),u-=p,c=!c},CanvasRenderingContext2D.prototype.hexagon=function(e,t,i){this.beginPath();var r=2*Math.PI/6;this.moveTo(e+i,t);for(var n=1;n<6;n++)this.lineTo(e+i*Math.cos(r*n),t+i*Math.sin(r*n));this.closePath()})},function(e,t,i){t.en={edit:"Edit",del:"Delete selected",back:"Back",addNode:"Add Node",addEdge:"Add Edge",editNode:"Edit Node",editEdge:"Edit Edge",addDescription:"Click in an empty space to place a new node.",edgeDescription:"Click on a node and drag the edge to another node to connect them.",editEdgeDescription:"Click on the control points and drag them to a node to connect to it.",createEdgeError:"Cannot link edges to a cluster.",deleteClusterError:"Clusters cannot be deleted.",editClusterError:"Clusters cannot be edited."},t.en_EN=t.en,t.en_US=t.en,t.de={edit:"Editieren",del:"Lösche Auswahl",back:"Zurück",addNode:"Knoten hinzufügen",addEdge:"Kante hinzufügen",editNode:"Knoten editieren",editEdge:"Kante editieren",addDescription:"Klicke auf eine freie Stelle, um einen neuen Knoten zu plazieren.",edgeDescription:"Klicke auf einen Knoten und ziehe die Kante zu einem anderen Knoten, um diese zu verbinden.",editEdgeDescription:"Klicke auf die Verbindungspunkte und ziehe diese auf einen Knoten, um sie zu verbinden.",createEdgeError:"Es ist nicht möglich, Kanten mit Clustern zu verbinden.",deleteClusterError:"Cluster können nicht gelöscht werden.",editClusterError:"Cluster können nicht editiert werden."},t.de_DE=t.de,t.es={edit:"Editar",del:"Eliminar selección",back:"Átras",addNode:"Añadir nodo",addEdge:"Añadir arista",editNode:"Editar nodo",editEdge:"Editar arista",addDescription:"Haga clic en un lugar vacío para colocar un nuevo nodo.",edgeDescription:"Haga clic en un nodo y arrastre la arista hacia otro nodo para conectarlos.",editEdgeDescription:"Haga clic en un punto de control y arrastrelo a un nodo para conectarlo.",createEdgeError:"No se puede conectar una arista a un grupo.",deleteClusterError:"No es posible eliminar grupos.",editClusterError:"No es posible editar grupos."},t.es_ES=t.es,t.it={edit:"Modifica",del:"Cancella la selezione",back:"Indietro",addNode:"Aggiungi un nodo",addEdge:"Aggiungi un vertice",editNode:"Modifica il nodo",editEdge:"Modifica il vertice",addDescription:"Clicca per aggiungere un nuovo nodo",edgeDescription:"Clicca su un nodo e trascinalo ad un altro nodo per connetterli.",editEdgeDescription:"Clicca sui Punti di controllo e trascinali ad un nodo per connetterli.",createEdgeError:"Non si possono collegare vertici ad un cluster",deleteClusterError:"I cluster non possono essere cancellati",editClusterError:"I clusters non possono essere modificati."},t.it_IT=t.it,t.nl={edit:"Wijzigen",del:"Selectie verwijderen",back:"Terug",addNode:"Node toevoegen",addEdge:"Link toevoegen",editNode:"Node wijzigen",editEdge:"Link wijzigen",addDescription:"Klik op een leeg gebied om een nieuwe node te maken.",edgeDescription:"Klik op een node en sleep de link naar een andere node om ze te verbinden.",editEdgeDescription:"Klik op de verbindingspunten en sleep ze naar een node om daarmee te verbinden.",createEdgeError:"Kan geen link maken naar een cluster.",deleteClusterError:"Clusters kunnen niet worden verwijderd.",editClusterError:"Clusters kunnen niet worden aangepast."},t.nl_NL=t.nl,t.nl_BE=t.nl,t["pt-br"]={edit:"Editar",del:"Remover selecionado",back:"Voltar",addNode:"Adicionar nó",addEdge:"Adicionar aresta",editNode:"Editar nó",editEdge:"Editar aresta",addDescription:"Clique em um espaço em branco para adicionar um novo nó",edgeDescription:"Clique em um nó e arraste a aresta até outro nó para conectá-los",editEdgeDescription:"Clique nos pontos de controle e os arraste para um nó para conectá-los",createEdgeError:"Não foi possível linkar arestas a um cluster.",deleteClusterError:"Clusters não puderam ser removidos.",editClusterError:"Clusters não puderam ser editados."},t["pt-BR"]=t["pt-br"],t.pt_BR=t["pt-br"],t.pt_br=t["pt-br"],t.ru={edit:"Редактировать",del:"Удалить выбранное",back:"Назад",addNode:"Добавить узел",addEdge:"Добавить ребро",editNode:"Редактировать узел",editEdge:"Редактировать ребро",addDescription:"Кликните в свободное место, чтобы добавить новый узел.",edgeDescription:"Кликните на узел и протяните ребро к другому узлу, чтобы соединить их.",editEdgeDescription:"Кликните на контрольные точки и перетащите их в узел, чтобы подключиться к нему.",createEdgeError:"Невозможно соединить ребра в кластер.",deleteClusterError:"Кластеры не могут быть удалены",editClusterError:"Кластеры недоступны для редактирования."},t.ru_RU=t.ru,t.cn={edit:"编辑",del:"删除选定",back:"返回",addNode:"添加节点",addEdge:"添加连接线",editNode:"编辑节点",editEdge:"编辑连接线",addDescription:"单击空白处放置新节点。",edgeDescription:"单击某个节点并将该连接线拖动到另一个节点以连接它们。",editEdgeDescription:"单击控制节点并将它们拖到节点上连接。",createEdgeError:"无法将连接线连接到群集。",deleteClusterError:"无法删除群集。",editClusterError:"无法编辑群集。"},t.zh_CN=t.cn},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(){(0,r.default)(this,e),this.NUM_ITERATIONS=4,this.image=new Image,this.canvas=document.createElement("canvas")}return(0,n.default)(e,[{key:"init",value:function(){if(!this.initialized()){this.src=this.image.src;var e=this.image.width,t=this.image.height;this.width=e,this.height=t;var i=Math.floor(t/2),r=Math.floor(t/4),n=Math.floor(t/8),o=Math.floor(t/16),a=Math.floor(e/2),s=Math.floor(e/4),l=Math.floor(e/8),u=Math.floor(e/16);this.canvas.width=3*s,this.canvas.height=i,this.coordinates=[[0,0,a,i],[a,0,s,r],[a,r,l,n],[5*l,r,u,o]],this._fillMipMap()}}},{key:"initialized",value:function(){return void 0!==this.coordinates}},{key:"_fillMipMap",value:function(){var e=this.canvas.getContext("2d"),t=this.coordinates[0];e.drawImage(this.image,t[0],t[1],t[2],t[3]);for(var i=1;i<this.NUM_ITERATIONS;i++){var r=this.coordinates[i-1],n=this.coordinates[i];e.drawImage(this.canvas,r[0],r[1],r[2],r[3],n[0],n[1],n[2],n[3])}}},{key:"drawImageAtPosition",value:function(e,t,i,r,n,o){if(this.initialized())if(t>2){t*=.5;for(var a=0;t>2&&a<this.NUM_ITERATIONS;)t*=.5,a+=1;a>=this.NUM_ITERATIONS&&(a=this.NUM_ITERATIONS-1);var s=this.coordinates[a];e.drawImage(this.canvas,s[0],s[1],s[2],s[3],i,r,n,o)}else e.drawImage(this.image,i,r,n,o)}}]),e}();t.default=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=i(2),s=function(){function e(){(0,r.default)(this,e),this.clear(),this.defaultIndex=0,this.groupsArray=[],this.groupIndex=0,this.defaultGroups=[{border:"#2B7CE9",background:"#97C2FC",highlight:{border:"#2B7CE9",background:"#D2E5FF"},hover:{border:"#2B7CE9",background:"#D2E5FF"}},{border:"#FFA500",background:"#FFFF00",highlight:{border:"#FFA500",background:"#FFFFA3"},hover:{border:"#FFA500",background:"#FFFFA3"}},{border:"#FA0A10",background:"#FB7E81",highlight:{border:"#FA0A10",background:"#FFAFB1"},hover:{border:"#FA0A10",background:"#FFAFB1"}},{border:"#41A906",background:"#7BE141",highlight:{border:"#41A906",background:"#A1EC76"},hover:{border:"#41A906",background:"#A1EC76"}},{border:"#E129F0",background:"#EB7DF4",highlight:{border:"#E129F0",background:"#F0B3F5"},hover:{border:"#E129F0",background:"#F0B3F5"}},{border:"#7C29F0",background:"#AD85E4",highlight:{border:"#7C29F0",background:"#D3BDF0"},hover:{border:"#7C29F0",background:"#D3BDF0"}},{border:"#C37F00",background:"#FFA807",highlight:{border:"#C37F00",background:"#FFCA66"},hover:{border:"#C37F00",background:"#FFCA66"}},{border:"#4220FB",background:"#6E6EFD",highlight:{border:"#4220FB",background:"#9B9BFD"},hover:{border:"#4220FB",background:"#9B9BFD"}},{border:"#FD5A77",background:"#FFC0CB",highlight:{border:"#FD5A77",background:"#FFD1D9"},hover:{border:"#FD5A77",background:"#FFD1D9"}},{border:"#4AD63A",background:"#C2FABC",highlight:{border:"#4AD63A",background:"#E6FFE3"},hover:{border:"#4AD63A",background:"#E6FFE3"}},{border:"#990000",background:"#EE0000",highlight:{border:"#BB0000",background:"#FF3333"},hover:{border:"#BB0000",background:"#FF3333"}},{border:"#FF6000",background:"#FF6000",highlight:{border:"#FF6000",background:"#FF6000"},hover:{border:"#FF6000",background:"#FF6000"}},{border:"#97C2FC",background:"#2B7CE9",highlight:{border:"#D2E5FF",background:"#2B7CE9"},hover:{border:"#D2E5FF",background:"#2B7CE9"}},{border:"#399605",background:"#255C03",highlight:{border:"#399605",background:"#255C03"},hover:{border:"#399605",background:"#255C03"}},{border:"#B70054",background:"#FF007E",highlight:{border:"#B70054",background:"#FF007E"},hover:{border:"#B70054",background:"#FF007E"}},{border:"#AD85E4",background:"#7C29F0",highlight:{border:"#D3BDF0",background:"#7C29F0"},hover:{border:"#D3BDF0",background:"#7C29F0"}},{border:"#4557FA",background:"#000EA1",highlight:{border:"#6E6EFD",background:"#000EA1"},hover:{border:"#6E6EFD",background:"#000EA1"}},{border:"#FFC0CB",background:"#FD5A77",highlight:{border:"#FFD1D9",background:"#FD5A77"},hover:{border:"#FFD1D9",background:"#FD5A77"}},{border:"#C2FABC",background:"#74D66A",highlight:{border:"#E6FFE3",background:"#74D66A"},hover:{border:"#E6FFE3",background:"#74D66A"}},{border:"#EE0000",background:"#990000",highlight:{border:"#FF3333",background:"#BB0000"},hover:{border:"#FF3333",background:"#BB0000"}}],this.options={},this.defaultOptions={useDefaultGroups:!0},a.extend(this.options,this.defaultOptions)}return(0,n.default)(e,[{key:"setOptions",value:function(e){var t=["useDefaultGroups"];if(void 0!==e)for(var i in e)if(e.hasOwnProperty(i)&&-1===t.indexOf(i)){var r=e[i];this.add(i,r)}}},{key:"clear",value:function(){this.groups={},this.groupsArray=[]}},{key:"get",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.groups[e];if(void 0===i&&t)if(!1===this.options.useDefaultGroups&&this.groupsArray.length>0){var r=this.groupIndex%this.groupsArray.length;this.groupIndex++,(i={}).color=this.groups[this.groupsArray[r]],this.groups[e]=i}else{var n=this.defaultIndex%this.defaultGroups.length;this.defaultIndex++,(i={}).color=this.defaultGroups[n],this.groups[e]=i}return i}},{key:"add",value:function(e,t){return this.groups[e]=t,this.groupsArray.push(e),t}}]),e}();t.default=s},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=i(2),s=i(11),l=i(12),u=i(47).default,h=function(){function e(t,i,n,o){var s=this;if((0,r.default)(this,e),this.body=t,this.images=i,this.groups=n,this.layoutEngine=o,this.body.functions.createNode=this.create.bind(this),this.nodesListeners={add:function(e,t){s.add(t.items)},update:function(e,t){s.update(t.items,t.data,t.oldData)},remove:function(e,t){s.remove(t.items)}},this.defaultOptions={borderWidth:1,borderWidthSelected:2,brokenImage:void 0,color:{border:"#2B7CE9",background:"#97C2FC",highlight:{border:"#2B7CE9",background:"#D2E5FF"},hover:{border:"#2B7CE9",background:"#D2E5FF"}},fixed:{x:!1,y:!1},font:{color:"#343434",size:14,face:"arial",background:"none",strokeWidth:0,strokeColor:"#ffffff",align:"center",vadjust:0,multi:!1,bold:{mod:"bold"},boldital:{mod:"bold italic"},ital:{mod:"italic"},mono:{mod:"",size:15,face:"monospace",vadjust:2}},group:void 0,hidden:!1,icon:{face:"FontAwesome",code:void 0,size:50,color:"#2B7CE9"},image:void 0,label:void 0,labelHighlightBold:!0,level:void 0,margin:{top:5,right:5,bottom:5,left:5},mass:1,physics:!0,scaling:{min:10,max:30,label:{enabled:!1,min:14,max:30,maxVisible:30,drawThreshold:5},customScalingFunction:function(e,t,i,r){if(t===e)return.5;var n=1/(t-e);return Math.max(0,(r-e)*n)}},shadow:{enabled:!1,color:"rgba(0,0,0,0.5)",size:10,x:5,y:5},shape:"ellipse",shapeProperties:{borderDashes:!1,borderRadius:6,interpolation:!0,useImageSize:!1,useBorderWithImage:!1},size:25,title:void 0,value:void 0,x:void 0,y:void 0},this.defaultOptions.mass<=0)throw"Internal error: mass in defaultOptions of NodesHandler may not be zero or negative";this.options=a.bridgeObject(this.defaultOptions),this.bindEventListeners()}return(0,n.default)(e,[{key:"bindEventListeners",value:function(){var e=this;this.body.emitter.on("refreshNodes",this.refresh.bind(this)),this.body.emitter.on("refresh",this.refresh.bind(this)),this.body.emitter.on("destroy",function(){a.forEach(e.nodesListeners,function(t,i){e.body.data.nodes&&e.body.data.nodes.off(i,t)}),delete e.body.functions.createNode,delete e.nodesListeners.add,delete e.nodesListeners.update,delete e.nodesListeners.remove,delete e.nodesListeners})}},{key:"setOptions",value:function(e){if(void 0!==e){if(u.parseOptions(this.options,e),void 0!==e.shape)for(var t in this.body.nodes)this.body.nodes.hasOwnProperty(t)&&this.body.nodes[t].updateShape();if(void 0!==e.font)for(var i in this.body.nodes)this.body.nodes.hasOwnProperty(i)&&(this.body.nodes[i].updateLabelModule(),this.body.nodes[i].needsRefresh());if(void 0!==e.size)for(var r in this.body.nodes)this.body.nodes.hasOwnProperty(r)&&this.body.nodes[r].needsRefresh();void 0===e.hidden&&void 0===e.physics||this.body.emitter.emit("_dataChanged")}}},{key:"setData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.body.data.nodes;if(e instanceof s||e instanceof l)this.body.data.nodes=e;else if(Array.isArray(e))this.body.data.nodes=new s,this.body.data.nodes.add(e);else{if(e)throw new TypeError("Array or DataSet expected");this.body.data.nodes=new s}if(i&&a.forEach(this.nodesListeners,function(e,t){i.off(t,e)}),this.body.nodes={},this.body.data.nodes){var r=this;a.forEach(this.nodesListeners,function(e,t){r.body.data.nodes.on(t,e)});var n=this.body.data.nodes.getIds();this.add(n,!0)}!1===t&&this.body.emitter.emit("_dataChanged")}},{key:"add",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=void 0,r=[],n=0;n<e.length;n++){i=e[n];var o=this.body.data.nodes.get(i),a=this.create(o);r.push(a),this.body.nodes[i]=a}this.layoutEngine.positionInitially(r),!1===t&&this.body.emitter.emit("_dataChanged")}},{key:"update",value:function(e,t,i){for(var r=this.body.nodes,n=!1,o=0;o<e.length;o++){var a=e[o],s=r[a],l=t[o];void 0!==s?s.setOptions(l)&&(n=!0):(n=!0,s=this.create(l),r[a]=s)}n||void 0===i||(n=t.some(function(e,t){var r=i[t];return r&&r.level!==e.level})),!0===n?this.body.emitter.emit("_dataChanged"):this.body.emitter.emit("_dataUpdated")}},{key:"remove",value:function(e){for(var t=this.body.nodes,i=0;i<e.length;i++){delete t[e[i]]}this.body.emitter.emit("_dataChanged")}},{key:"create",value:function(e){return new(arguments.length>1&&void 0!==arguments[1]?arguments[1]:u)(e,this.body,this.images,this.groups,this.options,this.defaultOptions)}},{key:"refresh",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];a.forEach(this.body.nodes,function(i,r){var n=e.body.data.nodes.get(r);void 0!==n&&(!0===t&&i.setOptions({x:null,y:null}),i.setOptions({fixed:!1}),i.setOptions(n))})}},{key:"getPositions",value:function(e){var t={};if(void 0!==e){if(!0===Array.isArray(e)){for(var i=0;i<e.length;i++)if(void 0!==this.body.nodes[e[i]]){var r=this.body.nodes[e[i]];t[e[i]]={x:Math.round(r.x),y:Math.round(r.y)}}}else if(void 0!==this.body.nodes[e]){var n=this.body.nodes[e];t[e]={x:Math.round(n.x),y:Math.round(n.y)}}}else for(var o=0;o<this.body.nodeIndices.length;o++){var a=this.body.nodes[this.body.nodeIndices[o]];t[this.body.nodeIndices[o]]={x:Math.round(a.x),y:Math.round(a.y)}}return t}},{key:"storePositions",value:function(){var e=[],t=this.body.data.nodes.getDataSet();for(var i in t._data)if(t._data.hasOwnProperty(i)){var r=this.body.nodes[i];t._data[i].x==Math.round(r.x)&&t._data[i].y==Math.round(r.y)||e.push({id:r.id,x:Math.round(r.x),y:Math.round(r.y)})}t.update(e)}},{key:"getBoundingBox",value:function(e){if(void 0!==this.body.nodes[e])return this.body.nodes[e].shape.boundingBox}},{key:"getConnectedNodes",value:function(e,t){var i=[];if(void 0!==this.body.nodes[e])for(var r=this.body.nodes[e],n={},o=0;o<r.edges.length;o++){var a=r.edges[o];"to"!==t&&a.toId==r.id?void 0===n[a.fromId]&&(i.push(a.fromId),n[a.fromId]=!0):"from"!==t&&a.fromId==r.id&&void 0===n[a.toId]&&(i.push(a.toId),n[a.toId]=!0)}return i}},{key:"getConnectedEdges",value:function(e){var t=[];if(void 0!==this.body.nodes[e])for(var i=this.body.nodes[e],r=0;r<i.edges.length;r++)t.push(i.edges[r].id);else console.log("NodeId provided for getConnectedEdges does not exist. Provided: ",e);return t}},{key:"moveNode",value:function(e,t,i){var r=this;void 0!==this.body.nodes[e]?(this.body.nodes[e].x=Number(t),this.body.nodes[e].y=Number(i),setTimeout(function(){r.body.emitter.emit("startSimulation")},0)):console.log("Node id supplied to moveNode does not exist. Provided: ",e)}}]),e}();t.default=h},function(e,t,i){e.exports={default:i(189),__esModule:!0}},function(e,t,i){i(49),i(60),e.exports=i(190)},function(e,t,i){var r=i(86),n=i(13)("iterator"),o=i(31);e.exports=i(7).isIterable=function(e){var t=Object(e);return void 0!==t[n]||"@@iterator"in t||o.hasOwnProperty(r(t))}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=i(192).default,s=i(48).default,l=function(){function e(t,i,n,o){var s=this;(0,r.default)(this,e),this.ctx=t,this.parent=i;this.lines=new a(function(e,i){if(void 0===e)return 0;var r=s.parent.getFormattingValues(t,n,o,i),a=0;""!==e&&(a=s.ctx.measureText(e).width);return{width:a,values:r}})}return(0,n.default)(e,[{key:"process",value:function(e){if(!s.isValidLabel(e))return this.lines.finalize();var t=this.parent.fontOptions;e=(e=e.replace(/\r\n/g,"\n")).replace(/\r/g,"\n");var i=String(e).split("\n"),r=i.length;if(t.multi)for(var n=0;n<r;n++){var o=this.splitBlocks(i[n],t.multi);if(void 0!==o)if(0!==o.length){if(t.maxWdt>0)for(var a=0;a<o.length;a++){var l=o[a].mod,u=o[a].text;this.splitStringIntoLines(u,l,!0)}else for(var h=0;h<o.length;h++){var c=o[h].mod,d=o[h].text;this.lines.append(d,c)}this.lines.newLine()}else this.lines.newLine("")}else if(t.maxWdt>0)for(var p=0;p<r;p++)this.splitStringIntoLines(i[p]);else for(var f=0;f<r;f++)this.lines.newLine(i[f]);return this.lines.finalize()}},{key:"decodeMarkupSystem",value:function(e){var t="none";return"markdown"===e||"md"===e?t="markdown":!0!==e&&"html"!==e||(t="html"),t}},{key:"splitHtmlBlocks",value:function(e){for(var t=[],i={bold:!1,ital:!1,mono:!1,spacing:!1,position:0,buffer:"",modStack:[],mod:function(){return 0===this.modStack.length?"normal":this.modStack[0]},modName:function(){return 0===this.modStack.length?"normal":"mono"===this.modStack[0]?"mono":i.bold&&i.ital?"boldital":i.bold?"bold":i.ital?"ital":void 0},emitBlock:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.spacing&&(this.add(" "),this.spacing=!1),this.buffer.length>0&&(t.push({text:this.buffer,mod:this.modName()}),this.buffer="")},add:function(e){" "===e&&(i.spacing=!0),i.spacing&&(this.buffer+=" ",this.spacing=!1)," "!=e&&(this.buffer+=e)}};i.position<e.length;){var r=e.charAt(i.position);/[ \t]/.test(r)?i.mono?i.add(r):i.spacing=!0:/</.test(r)?i.mono||i.bold||!/<b>/.test(e.substr(i.position,3))?i.mono||i.ital||!/<i>/.test(e.substr(i.position,3))?!i.mono&&/<code>/.test(e.substr(i.position,6))?(i.emitBlock(),i.mono=!0,i.modStack.unshift("mono"),i.position+=5):!i.mono&&"bold"===i.mod()&&/<\/b>/.test(e.substr(i.position,4))?(i.emitBlock(),i.bold=!1,i.modStack.shift(),i.position+=3):!i.mono&&"ital"===i.mod()&&/<\/i>/.test(e.substr(i.position,4))?(i.emitBlock(),i.ital=!1,i.modStack.shift(),i.position+=3):"mono"===i.mod()&&/<\/code>/.test(e.substr(i.position,7))?(i.emitBlock(),i.mono=!1,i.modStack.shift(),i.position+=6):i.add(r):(i.emitBlock(),i.ital=!0,i.modStack.unshift("ital"),i.position+=2):(i.emitBlock(),i.bold=!0,i.modStack.unshift("bold"),i.position+=2):/&/.test(r)?/&lt;/.test(e.substr(i.position,4))?(i.add("<"),i.position+=3):/&amp;/.test(e.substr(i.position,5))?(i.add("&"),i.position+=4):i.add("&"):i.add(r),i.position++}return i.emitBlock(),t}},{key:"splitMarkdownBlocks",value:function(e){for(var t=[],i={bold:!1,ital:!1,mono:!1,beginable:!0,spacing:!1,position:0,buffer:"",modStack:[],mod:function(){return 0===this.modStack.length?"normal":this.modStack[0]},modName:function(){return 0===this.modStack.length?"normal":"mono"===this.modStack[0]?"mono":i.bold&&i.ital?"boldital":i.bold?"bold":i.ital?"ital":void 0},emitBlock:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.spacing&&(this.add(" "),this.spacing=!1),this.buffer.length>0&&(t.push({text:this.buffer,mod:this.modName()}),this.buffer="")},add:function(e){" "===e&&(i.spacing=!0),i.spacing&&(this.buffer+=" ",this.spacing=!1)," "!=e&&(this.buffer+=e)}};i.position<e.length;){var r=e.charAt(i.position);/[ \t]/.test(r)?(i.mono?i.add(r):i.spacing=!0,i.beginable=!0):/\\/.test(r)?i.position<e.length+1&&(i.position++,r=e.charAt(i.position),/ \t/.test(r)?i.spacing=!0:(i.add(r),i.beginable=!1)):i.mono||i.bold||!i.beginable&&!i.spacing||!/\*/.test(r)?i.mono||i.ital||!i.beginable&&!i.spacing||!/\_/.test(r)?!i.mono&&(i.beginable||i.spacing)&&/`/.test(r)?(i.emitBlock(),i.mono=!0,i.modStack.unshift("mono")):!i.mono&&"bold"===i.mod()&&/\*/.test(r)?i.position===e.length-1||/[.,_` \t\n]/.test(e.charAt(i.position+1))?(i.emitBlock(),i.bold=!1,i.modStack.shift()):i.add(r):!i.mono&&"ital"===i.mod()&&/\_/.test(r)?i.position===e.length-1||/[.,*` \t\n]/.test(e.charAt(i.position+1))?(i.emitBlock(),i.ital=!1,i.modStack.shift()):i.add(r):i.mono&&"mono"===i.mod()&&/`/.test(r)?i.position===e.length-1||/[.,*_ \t\n]/.test(e.charAt(i.position+1))?(i.emitBlock(),i.mono=!1,i.modStack.shift()):i.add(r):(i.add(r),i.beginable=!1):(i.emitBlock(),i.ital=!0,i.modStack.unshift("ital")):(i.emitBlock(),i.bold=!0,i.modStack.unshift("bold")),i.position++}return i.emitBlock(),t}},{key:"splitBlocks",value:function(e,t){var i=this.decodeMarkupSystem(t);return"none"===i?[{text:e,mod:"normal"}]:"markdown"===i?this.splitMarkdownBlocks(e):"html"===i?this.splitHtmlBlocks(e):void 0}},{key:"overMaxWidth",value:function(e){var t=this.ctx.measureText(e).width;return this.lines.curWidth()+t>this.parent.fontOptions.maxWdt}},{key:"getLongestFit",value:function(e){for(var t="",i=0;i<e.length;){var r=t+(""===t?"":" ")+e[i];if(this.overMaxWidth(r))break;t=r,i++}return i}},{key:"getLongestFitWord",value:function(e){for(var t=0;t<e.length&&!this.overMaxWidth(e.slice(0,t));)t++;return t}},{key:"splitStringIntoLines",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=(e=(e=e.replace(/^( +)/g,"$1\r")).replace(/([^\r][^ ]*)( +)/g,"$1\r$2\r")).split("\r");r.length>0;){var n=this.getLongestFit(r);if(0===n){var o=r[0],a=this.getLongestFitWord(o);this.lines.newLine(o.slice(0,a),t),r[0]=o.slice(a)}else{var s=n;" "===r[n-1]?n--:" "===r[s]&&s++;var l=r.slice(0,n).join("");n==r.length&&i?this.lines.append(l,t):this.lines.newLine(l,t),r=r.slice(s)}}}}]),e}();t.default=l},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=a(i(90)),n=a(i(0)),o=a(i(1));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){(0,n.default)(this,e),this.measureText=t,this.current=0,this.width=0,this.height=0,this.lines=[]}return(0,o.default)(e,[{key:"_add",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"normal";void 0===this.lines[e]&&(this.lines[e]={width:0,height:0,blocks:[]});var n=t;void 0!==t&&""!==t||(n=" ");var o=this.measureText(n,i),a=(0,r.default)({},o.values);a.text=t,a.width=o.width,a.mod=i,void 0!==t&&""!==t||(a.width=0),this.lines[e].blocks.push(a),this.lines[e].width+=a.width}},{key:"curWidth",value:function(){var e=this.lines[this.current];return void 0===e?0:e.width}},{key:"append",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal";this._add(this.current,e,t)}},{key:"newLine",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal";this._add(this.current,e,t),this.current++}},{key:"determineLineHeights",value:function(){for(var e=0;e<this.lines.length;e++){var t=this.lines[e],i=0;if(void 0!==t.blocks)for(var r=0;r<t.blocks.length;r++){var n=t.blocks[r];i<n.height&&(i=n.height)}t.height=i}}},{key:"determineLabelSize",value:function(){for(var e=0,t=0,i=0;i<this.lines.length;i++){var r=this.lines[i];r.width>e&&(e=r.width),t+=r.height}this.width=e,this.height=t}},{key:"removeEmptyBlocks",value:function(){for(var e=[],t=0;t<this.lines.length;t++){var i=this.lines[t];if(0!==i.blocks.length&&(t!==this.lines.length-1||0!==i.width)){var n={};(0,r.default)(n,i),n.blocks=[];for(var o=void 0,a=[],s=0;s<i.blocks.length;s++){var l=i.blocks[s];0!==l.width?a.push(l):void 0===o&&(o=l)}0===a.length&&void 0!==o&&a.push(o),n.blocks=a,e.push(n)}}return e}},{key:"finalize",value:function(){this.determineLineHeights(),this.determineLabelSize();var e=this.removeEmptyBlocks();return{width:this.width,height:this.height,lines:e}}}]),e}();t.default=s},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o){(0,n.default)(this,t);var s=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o));return s._setMargins(o),s}return(0,s.default)(t,e),(0,o.default)(t,[{key:"resize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selected,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.hover;if(this.needsRefresh(t,i)){var r=this.getDimensionsFromLabel(e,t,i);this.width=r.width+this.margin.right+this.margin.left,this.height=r.height+this.margin.top+this.margin.bottom,this.radius=this.width/2}}},{key:"draw",value:function(e,t,i,r,n,o){this.resize(e,r,n),this.left=t-this.width/2,this.top=i-this.height/2,this.initContextForDraw(e,o),e.roundRect(this.left,this.top,this.width,this.height,o.borderRadius),this.performFill(e,o),this.updateBoundingBox(t,i,e,r,n),this.labelModule.draw(e,this.left+this.textSize.width/2+this.margin.left,this.top+this.textSize.height/2+this.margin.top,r,n)}},{key:"updateBoundingBox",value:function(e,t,i,r,n){this._updateBoundingBox(e,t,i,r,n);var o=this.options.shapeProperties.borderRadius;this._addBoundingBoxMargin(o)}},{key:"distanceToBorder",value:function(e,t){this.resize(e);var i=this.options.borderWidth;return Math.min(Math.abs(this.width/2/Math.cos(t)),Math.abs(this.height/2/Math.sin(t)))+i}}]),t}(l(i(23)).default);t.default=u},function(e,t,i){i(195),e.exports=i(7).Object.getPrototypeOf},function(e,t,i){var r=i(41),n=i(85);i(87)("getPrototypeOf",function(){return function(e){return n(r(e))}})},function(e,t,i){e.exports={default:i(197),__esModule:!0}},function(e,t,i){i(198),e.exports=i(7).Object.setPrototypeOf},function(e,t,i){var r=i(17);r(r.S,"Object",{setPrototypeOf:i(199).set})},function(e,t,i){var r=i(32),n=i(27),o=function(e,t){if(n(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=i(80)(Function.call,i(89).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,i){return o(e,i),t?e.__proto__=i:r(e,i),e}}({},!1):void 0),check:o}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o){(0,n.default)(this,t);var s=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o));return s._setMargins(o),s}return(0,s.default)(t,e),(0,o.default)(t,[{key:"resize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selected,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.hover;if(this.needsRefresh(t,i)){var r=this.getDimensionsFromLabel(e,t,i),n=Math.max(r.width+this.margin.right+this.margin.left,r.height+this.margin.top+this.margin.bottom);this.options.size=n/2,this.width=n,this.height=n,this.radius=this.width/2}}},{key:"draw",value:function(e,t,i,r,n,o){this.resize(e,r,n),this.left=t-this.width/2,this.top=i-this.height/2,this._drawRawCircle(e,t,i,o),this.updateBoundingBox(t,i),this.labelModule.draw(e,this.left+this.textSize.width/2+this.margin.left,i,r,n)}},{key:"updateBoundingBox",value:function(e,t){this.boundingBox.top=t-this.options.size,this.boundingBox.left=e-this.options.size,this.boundingBox.right=e+this.options.size,this.boundingBox.bottom=t+this.options.size}},{key:"distanceToBorder",value:function(e,t){return this.resize(e),.5*this.width}}]),t}(l(i(73)).default);t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o,s,l){(0,n.default)(this,t);var u=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o));return u.setImages(s,l),u}return(0,s.default)(t,e),(0,o.default)(t,[{key:"resize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selected,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.hover;if(void 0===this.imageObj.src||void 0===this.imageObj.width||void 0===this.imageObj.height){var r=2*this.options.size;return this.width=r,this.height=r,void(this.radius=.5*this.width)}this.needsRefresh(t,i)&&this._resizeImage()}},{key:"draw",value:function(e,t,i,r,n,o){this.switchImages(r),this.resize(),this.left=t-this.width/2,this.top=i-this.height/2,this._drawRawCircle(e,t,i,o),e.save(),e.clip(),this._drawImageAtPosition(e,o),e.restore(),this._drawImageLabel(e,t,i,r,n),this.updateBoundingBox(t,i)}},{key:"updateBoundingBox",value:function(e,t){this.boundingBox.top=t-this.options.size,this.boundingBox.left=e-this.options.size,this.boundingBox.right=e+this.options.size,this.boundingBox.bottom=t+this.options.size,this.boundingBox.left=Math.min(this.boundingBox.left,this.labelModule.size.left),this.boundingBox.right=Math.max(this.boundingBox.right,this.labelModule.size.left+this.labelModule.size.width),this.boundingBox.bottom=Math.max(this.boundingBox.bottom,this.boundingBox.bottom+this.labelOffset)}},{key:"distanceToBorder",value:function(e,t){return this.resize(e),.5*this.width}}]),t}(l(i(73)).default);t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o){(0,n.default)(this,t);var s=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o));return s._setMargins(o),s}return(0,s.default)(t,e),(0,o.default)(t,[{key:"resize",value:function(e,t,i){if(this.needsRefresh(t,i)){var r=this.getDimensionsFromLabel(e,t,i).width+this.margin.right+this.margin.left;this.width=r,this.height=r,this.radius=this.width/2}}},{key:"draw",value:function(e,t,i,r,n,o){this.resize(e,r,n),this.left=t-this.width/2,this.top=i-this.height/2,this.initContextForDraw(e,o),e.database(t-this.width/2,i-this.height/2,this.width,this.height),this.performFill(e,o),this.updateBoundingBox(t,i,e,r,n),this.labelModule.draw(e,this.left+this.textSize.width/2+this.margin.left,this.top+this.textSize.height/2+this.margin.top,r,n)}},{key:"distanceToBorder",value:function(e,t){return this._distanceToBorder(e,t)}}]),t}(l(i(23)).default);t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o){return(0,n.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"draw",value:function(e,t,i,r,n,o){this._drawShape(e,"diamond",4,t,i,r,n,o)}},{key:"distanceToBorder",value:function(e,t){return this._distanceToBorder(e,t)}}]),t}(l(i(24)).default);t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o){return(0,n.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"draw",value:function(e,t,i,r,n,o){this._drawShape(e,"circle",2,t,i,r,n,o)}},{key:"distanceToBorder",value:function(e,t){return this.resize(e),this.options.size}}]),t}(l(i(24)).default);t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o){return(0,n.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"resize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selected,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.hover;if(this.needsRefresh(t,i)){var r=this.getDimensionsFromLabel(e,t,i);this.height=2*r.height,this.width=r.width+r.height,this.radius=.5*this.width}}},{key:"draw",value:function(e,t,i,r,n,o){this.resize(e,r,n),this.left=t-.5*this.width,this.top=i-.5*this.height,this.initContextForDraw(e,o),e.ellipse_vis(this.left,this.top,this.width,this.height),this.performFill(e,o),this.updateBoundingBox(t,i,e,r,n),this.labelModule.draw(e,t,i,r,n)}},{key:"distanceToBorder",value:function(e,t){this.resize(e);var i=.5*this.width,r=.5*this.height,n=Math.sin(t)*i,o=Math.cos(t)*r;return i*r/Math.sqrt(n*n+o*o)}}]),t}(l(i(23)).default);t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o){(0,n.default)(this,t);var s=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o));return s._setMargins(o),s}return(0,s.default)(t,e),(0,o.default)(t,[{key:"resize",value:function(e,t,i){this.needsRefresh(t,i)&&(this.iconSize={width:Number(this.options.icon.size),height:Number(this.options.icon.size)},this.width=this.iconSize.width+this.margin.right+this.margin.left,this.height=this.iconSize.height+this.margin.top+this.margin.bottom,this.radius=.5*this.width)}},{key:"draw",value:function(e,t,i,r,n,o){if(this.resize(e,r,n),this.options.icon.size=this.options.icon.size||50,this.left=t-this.width/2,this.top=i-this.height/2,this._icon(e,t,i,r,n,o),void 0!==this.options.label){this.labelModule.draw(e,this.left+this.iconSize.width/2+this.margin.left,i+this.height/2+5,r)}this.updateBoundingBox(t,i)}},{key:"updateBoundingBox",value:function(e,t){if(this.boundingBox.top=t-.5*this.options.icon.size,this.boundingBox.left=e-.5*this.options.icon.size,this.boundingBox.right=e+.5*this.options.icon.size,this.boundingBox.bottom=t+.5*this.options.icon.size,void 0!==this.options.label&&this.labelModule.size.width>0){this.boundingBox.left=Math.min(this.boundingBox.left,this.labelModule.size.left),this.boundingBox.right=Math.max(this.boundingBox.right,this.labelModule.size.left+this.labelModule.size.width),this.boundingBox.bottom=Math.max(this.boundingBox.bottom,this.boundingBox.bottom+this.labelModule.size.height+5)}}},{key:"_icon",value:function(e,t,i,r,n,o){var a=Number(this.options.icon.size);void 0!==this.options.icon.code?(e.font=(r?"bold ":"")+a+"px "+this.options.icon.face,e.fillStyle=this.options.icon.color||"black",e.textAlign="center",e.textBaseline="middle",this.enableShadow(e,o),e.fillText(this.options.icon.code,t,i),this.disableShadow(e,o)):console.error("When using the icon shape, you need to define the code in the icon options object. This can be done per node or globally.")}},{key:"distanceToBorder",value:function(e,t){return this._distanceToBorder(e,t)}}]),t}(l(i(23)).default);t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o,s,l){(0,n.default)(this,t);var u=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o));return u.setImages(s,l),u}return(0,s.default)(t,e),(0,o.default)(t,[{key:"resize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selected,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.hover;if(void 0===this.imageObj.src||void 0===this.imageObj.width||void 0===this.imageObj.height){var r=2*this.options.size;return this.width=r,void(this.height=r)}this.needsRefresh(t,i)&&this._resizeImage()}},{key:"draw",value:function(e,t,i,r,n,o){if(this.switchImages(r),this.resize(),this.left=t-this.width/2,this.top=i-this.height/2,!0===this.options.shapeProperties.useBorderWithImage){var a=this.options.borderWidth,s=this.options.borderWidthSelected||2*this.options.borderWidth,l=(r?s:a)/this.body.view.scale;e.lineWidth=Math.min(this.width,l),e.beginPath(),e.strokeStyle=r?this.options.color.highlight.border:n?this.options.color.hover.border:this.options.color.border,e.fillStyle=r?this.options.color.highlight.background:n?this.options.color.hover.background:this.options.color.background,e.rect(this.left-.5*e.lineWidth,this.top-.5*e.lineWidth,this.width+e.lineWidth,this.height+e.lineWidth),e.fill(),this.performStroke(e,o),e.closePath()}this._drawImageAtPosition(e,o),this._drawImageLabel(e,t,i,r,n),this.updateBoundingBox(t,i)}},{key:"updateBoundingBox",value:function(e,t){this.resize(),this._updateBoundingBox(e,t),void 0!==this.options.label&&this.labelModule.size.width>0&&(this.boundingBox.left=Math.min(this.boundingBox.left,this.labelModule.size.left),this.boundingBox.right=Math.max(this.boundingBox.right,this.labelModule.size.left+this.labelModule.size.width),this.boundingBox.bottom=Math.max(this.boundingBox.bottom,this.boundingBox.bottom+this.labelOffset))}},{key:"distanceToBorder",value:function(e,t){return this._distanceToBorder(e,t)}}]),t}(l(i(73)).default);t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o){return(0,n.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"draw",value:function(e,t,i,r,n,o){this._drawShape(e,"square",2,t,i,r,n,o)}},{key:"distanceToBorder",value:function(e,t){return this._distanceToBorder(e,t)}}]),t}(l(i(24)).default);t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o){return(0,n.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"draw",value:function(e,t,i,r,n,o){this._drawShape(e,"hexagon",4,t,i,r,n,o)}},{key:"distanceToBorder",value:function(e,t){return this._distanceToBorder(e,t)}}]),t}(l(i(24)).default);t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o){return(0,n.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"draw",value:function(e,t,i,r,n,o){this._drawShape(e,"star",4,t,i,r,n,o)}},{key:"distanceToBorder",value:function(e,t){return this._distanceToBorder(e,t)}}]),t}(l(i(24)).default);t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o){(0,n.default)(this,t);var s=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o));return s._setMargins(o),s}return(0,s.default)(t,e),(0,o.default)(t,[{key:"resize",value:function(e,t,i){this.needsRefresh(t,i)&&(this.textSize=this.labelModule.getTextSize(e,t,i),this.width=this.textSize.width+this.margin.right+this.margin.left,this.height=this.textSize.height+this.margin.top+this.margin.bottom,this.radius=.5*this.width)}},{key:"draw",value:function(e,t,i,r,n,o){this.resize(e,r,n),this.left=t-this.width/2,this.top=i-this.height/2,this.enableShadow(e,o),this.labelModule.draw(e,this.left+this.textSize.width/2+this.margin.left,this.top+this.textSize.height/2+this.margin.top,r,n),this.disableShadow(e,o),this.updateBoundingBox(t,i,e,r,n)}},{key:"distanceToBorder",value:function(e,t){return this._distanceToBorder(e,t)}}]),t}(l(i(23)).default);t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o){return(0,n.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"draw",value:function(e,t,i,r,n,o){this._drawShape(e,"triangle",3,t,i,r,n,o)}},{key:"distanceToBorder",value:function(e,t){return this._distanceToBorder(e,t)}}]),t}(l(i(24)).default);t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o){return(0,n.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"draw",value:function(e,t,i,r,n,o){this._drawShape(e,"triangleDown",3,t,i,r,n,o)}},{key:"distanceToBorder",value:function(e,t){return this._distanceToBorder(e,t)}}]),t}(l(i(24)).default);t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=i(2),s=i(11),l=i(12),u=i(74).default,h=function(){function e(t,i,n){var o=this;(0,r.default)(this,e),this.body=t,this.images=i,this.groups=n,this.body.functions.createEdge=this.create.bind(this),this.edgesListeners={add:function(e,t){o.add(t.items)},update:function(e,t){o.update(t.items)},remove:function(e,t){o.remove(t.items)}},this.options={},this.defaultOptions={arrows:{to:{enabled:!1,scaleFactor:1,type:"arrow"},middle:{enabled:!1,scaleFactor:1,type:"arrow"},from:{enabled:!1,scaleFactor:1,type:"arrow"}},arrowStrikethrough:!0,color:{color:"#848484",highlight:"#848484",hover:"#848484",inherit:"from",opacity:1},dashes:!1,font:{color:"#343434",size:14,face:"arial",background:"none",strokeWidth:2,strokeColor:"#ffffff",align:"horizontal",multi:!1,vadjust:0,bold:{mod:"bold"},boldital:{mod:"bold italic"},ital:{mod:"italic"},mono:{mod:"",size:15,face:"courier new",vadjust:2}},hidden:!1,hoverWidth:1.5,label:void 0,labelHighlightBold:!0,length:void 0,physics:!0,scaling:{min:1,max:15,label:{enabled:!0,min:14,max:30,maxVisible:30,drawThreshold:5},customScalingFunction:function(e,t,i,r){if(t===e)return.5;var n=1/(t-e);return Math.max(0,(r-e)*n)}},selectionWidth:1.5,selfReferenceSize:20,shadow:{enabled:!1,color:"rgba(0,0,0,0.5)",size:10,x:5,y:5},smooth:{enabled:!0,type:"dynamic",forceDirection:"none",roundness:.5},title:void 0,width:1,value:void 0},a.deepExtend(this.options,this.defaultOptions),this.bindEventListeners()}return(0,n.default)(e,[{key:"bindEventListeners",value:function(){var e=this;this.body.emitter.on("_forceDisableDynamicCurves",function(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];"dynamic"===t&&(t="continuous");var r=!1;for(var n in e.body.edges)if(e.body.edges.hasOwnProperty(n)){var o=e.body.edges[n],a=e.body.data.edges._data[n];if(void 0!==a){var s=a.smooth;void 0!==s&&!0===s.enabled&&"dynamic"===s.type&&(void 0===t?o.setOptions({smooth:!1}):o.setOptions({smooth:{type:t}}),r=!0)}}!0===i&&!0===r&&e.body.emitter.emit("_dataChanged")}),this.body.emitter.on("_dataUpdated",function(){e.reconnectEdges()}),this.body.emitter.on("refreshEdges",this.refresh.bind(this)),this.body.emitter.on("refresh",this.refresh.bind(this)),this.body.emitter.on("destroy",function(){a.forEach(e.edgesListeners,function(t,i){e.body.data.edges&&e.body.data.edges.off(i,t)}),delete e.body.functions.createEdge,delete e.edgesListeners.add,delete e.edgesListeners.update,delete e.edgesListeners.remove,delete e.edgesListeners})}},{key:"setOptions",value:function(e){if(void 0!==e){u.parseOptions(this.options,e,!0,this.defaultOptions,!0);var t=!1;if(void 0!==e.smooth)for(var i in this.body.edges)this.body.edges.hasOwnProperty(i)&&(t=this.body.edges[i].updateEdgeType()||t);if(void 0!==e.font)for(var r in this.body.edges)this.body.edges.hasOwnProperty(r)&&this.body.edges[r].updateLabelModule();void 0===e.hidden&&void 0===e.physics&&!0!==t||this.body.emitter.emit("_dataChanged")}}},{key:"setData",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.body.data.edges;if(e instanceof s||e instanceof l)this.body.data.edges=e;else if(Array.isArray(e))this.body.data.edges=new s,this.body.data.edges.add(e);else{if(e)throw new TypeError("Array or DataSet expected");this.body.data.edges=new s}if(r&&a.forEach(this.edgesListeners,function(e,t){r.off(t,e)}),this.body.edges={},this.body.data.edges){a.forEach(this.edgesListeners,function(e,i){t.body.data.edges.on(i,e)});var n=this.body.data.edges.getIds();this.add(n,!0)}this.body.emitter.emit("_adjustEdgesForHierarchicalLayout"),!1===i&&this.body.emitter.emit("_dataChanged")}},{key:"add",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.body.edges,r=this.body.data.edges,n=0;n<e.length;n++){var o=e[n],a=i[o];a&&a.disconnect();var s=r.get(o,{showInternalIds:!0});i[o]=this.create(s)}this.body.emitter.emit("_adjustEdgesForHierarchicalLayout"),!1===t&&this.body.emitter.emit("_dataChanged")}},{key:"update",value:function(e){for(var t=this.body.edges,i=this.body.data.edges,r=!1,n=0;n<e.length;n++){var o=e[n],a=i.get(o),s=t[o];void 0!==s?(s.disconnect(),r=s.setOptions(a)||r,s.connect()):(this.body.edges[o]=this.create(a),r=!0)}!0===r?(this.body.emitter.emit("_adjustEdgesForHierarchicalLayout"),this.body.emitter.emit("_dataChanged")):this.body.emitter.emit("_dataUpdated")}},{key:"remove",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0!==e.length){var i=this.body.edges;a.forEach(e,function(e){var t=i[e];void 0!==t&&t.remove()}),t&&this.body.emitter.emit("_dataChanged")}}},{key:"refresh",value:function(){var e=this;a.forEach(this.body.edges,function(t,i){var r=e.body.data.edges._data[i];void 0!==r&&t.setOptions(r)})}},{key:"create",value:function(e){return new u(e,this.body,this.options,this.defaultOptions)}},{key:"reconnectEdges",value:function(){var e,t=this.body.nodes,i=this.body.edges;for(e in t)t.hasOwnProperty(e)&&(t[e].edges=[]);for(e in i)if(i.hasOwnProperty(e)){var r=i[e];r.from=null,r.to=null,r.connect()}}},{key:"getConnectedNodes",value:function(e){var t=[];if(void 0!==this.body.edges[e]){var i=this.body.edges[e];void 0!==i.fromId&&t.push(i.fromId),void 0!==i.toId&&t.push(i.toId)}return t}},{key:"_updateState",value:function(){this._addMissingEdges(),this._removeInvalidEdges()}},{key:"_removeInvalidEdges",value:function(){var e=this,t=[];a.forEach(this.body.edges,function(i,r){var n=e.body.nodes[i.toId],o=e.body.nodes[i.fromId];void 0!==n&&!0===n.isCluster||void 0!==o&&!0===o.isCluster||void 0!==n&&void 0!==o||t.push(r)}),this.remove(t,!1)}},{key:"_addMissingEdges",value:function(){var e=this.body.edges,t=this.body.data.edges,i=[];t.forEach(function(t,r){void 0===e[r]&&i.push(r)}),this.add(i,!0)}}]),e}();t.default=h},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=u(i(30)),n=u(i(3)),o=u(i(0)),a=u(i(1)),s=u(i(4)),l=u(i(5));function u(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(e,i,r){return(0,o.default)(this,t),(0,s.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e,i,r))}return(0,l.default)(t,e),(0,a.default)(t,[{key:"_line",value:function(e,t,i){var r=i[0],n=i[1];this._bezierCurve(e,t,r,n)}},{key:"_getViaCoordinates",value:function(){var e=this.from.x-this.to.x,t=this.from.y-this.to.y,i=void 0,r=void 0,n=void 0,o=void 0,a=this.options.smooth.roundness;return(Math.abs(e)>Math.abs(t)||!0===this.options.smooth.forceDirection||"horizontal"===this.options.smooth.forceDirection)&&"vertical"!==this.options.smooth.forceDirection?(r=this.from.y,o=this.to.y,i=this.from.x-a*e,n=this.to.x+a*e):(r=this.from.y-a*t,o=this.to.y+a*t,i=this.from.x,n=this.to.x),[{x:i,y:r},{x:n,y:o}]}},{key:"getViaNode",value:function(){return this._getViaCoordinates()}},{key:"_findBorderPosition",value:function(e,t){return this._findBorderPositionBezier(e,t)}},{key:"_getDistanceToEdge",value:function(e,t,i,n,o,a){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:this._getViaCoordinates(),l=(0,r.default)(s,2),u=l[0],h=l[1];return this._getDistanceToBezierEdge(e,t,i,n,o,a,u,h)}},{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._getViaCoordinates(),i=(0,r.default)(t,2),n=i[0],o=i[1],a=e,s=[];return s[0]=Math.pow(1-a,3),s[1]=3*a*Math.pow(1-a,2),s[2]=3*Math.pow(a,2)*(1-a),s[3]=Math.pow(a,3),{x:s[0]*this.fromPoint.x+s[1]*n.x+s[2]*o.x+s[3]*this.toPoint.x,y:s[0]*this.fromPoint.y+s[1]*n.y+s[2]*o.y+s[3]*this.toPoint.y}}}]),t}(u(i(216)).default);t.default=h},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o){return(0,n.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"_getDistanceToBezierEdge",value:function(e,t,i,r,n,o,a,s){var l=1e9,u=void 0,h=void 0,c=void 0,d=void 0,p=void 0,f=e,m=t,v=[0,0,0,0];for(h=1;h<10;h++)c=.1*h,v[0]=Math.pow(1-c,3),v[1]=3*c*Math.pow(1-c,2),v[2]=3*Math.pow(c,2)*(1-c),v[3]=Math.pow(c,3),d=v[0]*e+v[1]*a.x+v[2]*s.x+v[3]*i,p=v[0]*t+v[1]*a.y+v[2]*s.y+v[3]*r,h>0&&(l=(u=this._getDistanceToLine(f,m,d,p,n,o))<l?u:l),f=d,m=p;return l}}]),t}(l(i(75)).default);t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=u(i(30)),n=u(i(3)),o=u(i(0)),a=u(i(1)),s=u(i(4)),l=u(i(5));function u(e){return e&&e.__esModule?e:{default:e}}var h=function(e){function t(e,i,r){(0,o.default)(this,t);var a=(0,s.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e,i,r));return a._boundFunction=function(){a.positionBezierNode()},a.body.emitter.on("_repositionBezierNodes",a._boundFunction),a}return(0,l.default)(t,e),(0,a.default)(t,[{key:"setOptions",value:function(e){var t=!1;this.options.physics!==e.physics&&(t=!0),this.options=e,this.id=this.options.id,this.from=this.body.nodes[this.options.from],this.to=this.body.nodes[this.options.to],this.setupSupportNode(),this.connect(),!0===t&&(this.via.setOptions({physics:this.options.physics}),this.positionBezierNode())}},{key:"connect",value:function(){this.from=this.body.nodes[this.options.from],this.to=this.body.nodes[this.options.to],void 0===this.from||void 0===this.to||!1===this.options.physics?this.via.setOptions({physics:!1}):this.from.id===this.to.id?this.via.setOptions({physics:!1}):this.via.setOptions({physics:!0})}},{key:"cleanup",value:function(){return this.body.emitter.off("_repositionBezierNodes",this._boundFunction),void 0!==this.via&&(delete this.body.nodes[this.via.id],this.via=void 0,!0)}},{key:"setupSupportNode",value:function(){if(void 0===this.via){var e="edgeId:"+this.id,t=this.body.functions.createNode({id:e,shape:"circle",physics:!0,hidden:!0});this.body.nodes[e]=t,this.via=t,this.via.parentEdgeId=this.id,this.positionBezierNode()}}},{key:"positionBezierNode",value:function(){void 0!==this.via&&void 0!==this.from&&void 0!==this.to?(this.via.x=.5*(this.from.x+this.to.x),this.via.y=.5*(this.from.y+this.to.y)):void 0!==this.via&&(this.via.x=0,this.via.y=0)}},{key:"_line",value:function(e,t,i){this._bezierCurve(e,t,i)}},{key:"getViaNode",value:function(){return this.via}},{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.via,i=e,n=void 0,o=void 0;if(this.from===this.to){var a=this._getCircleData(this.from),s=(0,r.default)(a,3),l=s[0],u=s[1],h=s[2],c=2*Math.PI*(1-i);n=l+h*Math.sin(c),o=u+h-h*(1-Math.cos(c))}else n=Math.pow(1-i,2)*this.fromPoint.x+2*i*(1-i)*t.x+Math.pow(i,2)*this.toPoint.x,o=Math.pow(1-i,2)*this.fromPoint.y+2*i*(1-i)*t.y+Math.pow(i,2)*this.toPoint.y;return{x:n,y:o}}},{key:"_findBorderPosition",value:function(e,t){return this._findBorderPositionBezier(e,t,this.via)}},{key:"_getDistanceToEdge",value:function(e,t,i,r,n,o){return this._getDistanceToBezierEdge(e,t,i,r,n,o,this.via)}}]),t}(u(i(75)).default);t.default=h},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o){return(0,n.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"_line",value:function(e,t,i){this._bezierCurve(e,t,i)}},{key:"getViaNode",value:function(){return this._getViaCoordinates()}},{key:"_getViaCoordinates",value:function(){var e=void 0,t=void 0,i=this.options.smooth.roundness,r=this.options.smooth.type,n=Math.abs(this.from.x-this.to.x),o=Math.abs(this.from.y-this.to.y);if("discrete"===r||"diagonalCross"===r){var a=void 0,s=void 0;a=s=n<=o?i*o:i*n,this.from.x>this.to.x&&(a=-a),this.from.y>=this.to.y&&(s=-s),e=this.from.x+a,t=this.from.y+s,"discrete"===r&&(n<=o?e=n<i*o?this.from.x:e:t=o<i*n?this.from.y:t)}else if("straightCross"===r){var l=(1-i)*n,u=(1-i)*o;n<=o?(l=0,this.from.y<this.to.y&&(u=-u)):(this.from.x<this.to.x&&(l=-l),u=0),e=this.to.x+l,t=this.to.y+u}else if("horizontal"===r){var h=(1-i)*n;this.from.x<this.to.x&&(h=-h),e=this.to.x+h,t=this.from.y}else if("vertical"===r){var c=(1-i)*o;this.from.y<this.to.y&&(c=-c),e=this.from.x,t=this.to.y+c}else if("curvedCW"===r){n=this.to.x-this.from.x,o=this.from.y-this.to.y;var d=Math.sqrt(n*n+o*o),p=Math.PI,f=(Math.atan2(o,n)+(.5*i+.5)*p)%(2*p);e=this.from.x+(.5*i+.5)*d*Math.sin(f),t=this.from.y+(.5*i+.5)*d*Math.cos(f)}else if("curvedCCW"===r){n=this.to.x-this.from.x,o=this.from.y-this.to.y;var m=Math.sqrt(n*n+o*o),v=Math.PI,g=(Math.atan2(o,n)+(.5*-i+.5)*v)%(2*v);e=this.from.x+(.5*i+.5)*m*Math.sin(g),t=this.from.y+(.5*i+.5)*m*Math.cos(g)}else{var y=void 0,_=void 0;y=_=n<=o?i*o:i*n,this.from.x>this.to.x&&(y=-y),this.from.y>=this.to.y&&(_=-_),e=this.from.x+y,t=this.from.y+_,n<=o?e=this.from.x<=this.to.x?this.to.x<e?this.to.x:e:this.to.x>e?this.to.x:e:t=this.from.y>=this.to.y?this.to.y>t?this.to.y:t:this.to.y<t?this.to.y:t}return{x:e,y:t}}},{key:"_findBorderPosition",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._findBorderPositionBezier(e,t,i.via)}},{key:"_getDistanceToEdge",value:function(e,t,i,r,n,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:this._getViaCoordinates();return this._getDistanceToBezierEdge(e,t,i,r,n,o,a)}},{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._getViaCoordinates(),i=e;return{x:Math.pow(1-i,2)*this.fromPoint.x+2*i*(1-i)*t.x+Math.pow(i,2)*this.toPoint.x,y:Math.pow(1-i,2)*this.fromPoint.y+2*i*(1-i)*t.y+Math.pow(i,2)*this.toPoint.y}}}]),t}(l(i(75)).default);t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o){return(0,n.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"_line",value:function(e,t){e.beginPath(),e.moveTo(this.fromPoint.x,this.fromPoint.y),e.lineTo(this.toPoint.x,this.toPoint.y),this.enableShadow(e,t),e.stroke(),this.disableShadow(e,t)}},{key:"getViaNode",value:function(){}},{key:"getPoint",value:function(e){return{x:(1-e)*this.fromPoint.x+e*this.toPoint.x,y:(1-e)*this.fromPoint.y+e*this.toPoint.y}}},{key:"_findBorderPosition",value:function(e,t){var i=this.to,r=this.from;e.id===this.from.id&&(i=this.from,r=this.to);var n=Math.atan2(i.y-r.y,i.x-r.x),o=i.x-r.x,a=i.y-r.y,s=Math.sqrt(o*o+a*a),l=(s-e.distanceToBorder(t,n))/s,u={};return u.x=(1-l)*r.x+l*i.x,u.y=(1-l)*r.y+l*i.y,u}},{key:"_getDistanceToEdge",value:function(e,t,i,r,n,o){return this._getDistanceToLine(e,t,i,r,n,o)}}]),t}(l(i(118)).default);t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=a(i(8)),n=a(i(0)),o=a(i(1));function a(e){return e&&e.__esModule?e:{default:e}}var s=i(120).default,l=i(221).default,u=i(222).default,h=i(223).default,c=i(224).default,d=i(121).default,p=i(225).default,f=i(226).default,m=i(2),v=i(119).default,g=function(){function e(t){(0,n.default)(this,e),this.body=t,this.physicsBody={physicsNodeIndices:[],physicsEdgeIndices:[],forces:{},velocities:{}},this.physicsEnabled=!0,this.simulationInterval=1e3/60,this.requiresTimeout=!0,this.previousStates={},this.referenceState={},this.freezeCache={},this.renderTimer=void 0,this.adaptiveTimestep=!1,this.adaptiveTimestepEnabled=!1,this.adaptiveCounter=0,this.adaptiveInterval=3,this.stabilized=!1,this.startedStabilization=!1,this.stabilizationIterations=0,this.ready=!1,this.options={},this.defaultOptions={enabled:!0,barnesHut:{theta:.5,gravitationalConstant:-2e3,centralGravity:.3,springLength:95,springConstant:.04,damping:.09,avoidOverlap:0},forceAtlas2Based:{theta:.5,gravitationalConstant:-50,centralGravity:.01,springConstant:.08,springLength:100,damping:.4,avoidOverlap:0},repulsion:{centralGravity:.2,springLength:200,springConstant:.05,nodeDistance:100,damping:.09,avoidOverlap:0},hierarchicalRepulsion:{centralGravity:0,springLength:100,springConstant:.01,nodeDistance:120,damping:.09},maxVelocity:50,minVelocity:.75,solver:"barnesHut",stabilization:{enabled:!0,iterations:1e3,updateInterval:50,onlyDynamicEdges:!1,fit:!0},timestep:.5,adaptiveTimestep:!0},m.extend(this.options,this.defaultOptions),this.timestep=.5,this.layoutFailed=!1,this.bindEventListeners()}return(0,o.default)(e,[{key:"bindEventListeners",value:function(){var e=this;this.body.emitter.on("initPhysics",function(){e.initPhysics()}),this.body.emitter.on("_layoutFailed",function(){e.layoutFailed=!0}),this.body.emitter.on("resetPhysics",function(){e.stopSimulation(),e.ready=!1}),this.body.emitter.on("disablePhysics",function(){e.physicsEnabled=!1,e.stopSimulation()}),this.body.emitter.on("restorePhysics",function(){e.setOptions(e.options),!0===e.ready&&e.startSimulation()}),this.body.emitter.on("startSimulation",function(){!0===e.ready&&e.startSimulation()}),this.body.emitter.on("stopSimulation",function(){e.stopSimulation()}),this.body.emitter.on("destroy",function(){e.stopSimulation(!1),e.body.emitter.off()}),this.body.emitter.on("_dataChanged",function(){e.updatePhysicsData()})}},{key:"setOptions",value:function(e){void 0!==e&&(!1===e?(this.options.enabled=!1,this.physicsEnabled=!1,this.stopSimulation()):!0===e?(this.options.enabled=!0,this.physicsEnabled=!0,this.startSimulation()):(this.physicsEnabled=!0,m.selectiveNotDeepExtend(["stabilization"],this.options,e),m.mergeOptions(this.options,e,"stabilization"),void 0===e.enabled&&(this.options.enabled=!0),!1===this.options.enabled&&(this.physicsEnabled=!1,this.stopSimulation()),this.timestep=this.options.timestep)),this.init()}},{key:"init",value:function(){var e;"forceAtlas2Based"===this.options.solver?(e=this.options.forceAtlas2Based,this.nodesSolver=new p(this.body,this.physicsBody,e),this.edgesSolver=new h(this.body,this.physicsBody,e),this.gravitySolver=new f(this.body,this.physicsBody,e)):"repulsion"===this.options.solver?(e=this.options.repulsion,this.nodesSolver=new l(this.body,this.physicsBody,e),this.edgesSolver=new h(this.body,this.physicsBody,e),this.gravitySolver=new d(this.body,this.physicsBody,e)):"hierarchicalRepulsion"===this.options.solver?(e=this.options.hierarchicalRepulsion,this.nodesSolver=new u(this.body,this.physicsBody,e),this.edgesSolver=new c(this.body,this.physicsBody,e),this.gravitySolver=new d(this.body,this.physicsBody,e)):(e=this.options.barnesHut,this.nodesSolver=new s(this.body,this.physicsBody,e),this.edgesSolver=new h(this.body,this.physicsBody,e),this.gravitySolver=new d(this.body,this.physicsBody,e)),this.modelOptions=e}},{key:"initPhysics",value:function(){!0===this.physicsEnabled&&!0===this.options.enabled?!0===this.options.stabilization.enabled?this.stabilize():(this.stabilized=!1,this.ready=!0,this.body.emitter.emit("fit",{},this.layoutFailed),this.startSimulation()):(this.ready=!0,this.body.emitter.emit("fit"))}},{key:"startSimulation",value:function(){!0===this.physicsEnabled&&!0===this.options.enabled?(this.stabilized=!1,this.adaptiveTimestep=!1,this.body.emitter.emit("_resizeNodes"),void 0===this.viewFunction&&(this.viewFunction=this.simulationStep.bind(this),this.body.emitter.on("initRedraw",this.viewFunction),this.body.emitter.emit("_startRendering"))):this.body.emitter.emit("_redraw")}},{key:"stopSimulation",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.stabilized=!0,!0===e&&this._emitStabilized(),void 0!==this.viewFunction&&(this.body.emitter.off("initRedraw",this.viewFunction),this.viewFunction=void 0,!0===e&&this.body.emitter.emit("_stopRendering"))}},{key:"simulationStep",value:function(){var e=Date.now();this.physicsTick(),(Date.now()-e<.4*this.simulationInterval||!0===this.runDoubleSpeed)&&!1===this.stabilized&&(this.physicsTick(),this.runDoubleSpeed=!0),!0===this.stabilized&&this.stopSimulation()}},{key:"_emitStabilized",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.stabilizationIterations;(this.stabilizationIterations>1||!0===this.startedStabilization)&&setTimeout(function(){e.body.emitter.emit("stabilized",{iterations:t}),e.startedStabilization=!1,e.stabilizationIterations=0},0)}},{key:"physicsStep",value:function(){this.gravitySolver.solve(),this.nodesSolver.solve(),this.edgesSolver.solve(),this.moveNodes()}},{key:"adjustTimeStep",value:function(){!0===this._evaluateStepQuality()?this.timestep=1.2*this.timestep:this.timestep/1.2<this.options.timestep?this.timestep=this.options.timestep:(this.adaptiveCounter=-1,this.timestep=Math.max(this.options.timestep,this.timestep/1.2))}},{key:"physicsTick",value:function(){if(this._startStabilizing(),!0!==this.stabilized){if(!0===this.adaptiveTimestep&&!0===this.adaptiveTimestepEnabled)this.adaptiveCounter%this.adaptiveInterval==0?(this.timestep=2*this.timestep,this.physicsStep(),this.revert(),this.timestep=.5*this.timestep,this.physicsStep(),this.physicsStep(),this.adjustTimeStep()):this.physicsStep(),this.adaptiveCounter+=1;else this.timestep=this.options.timestep,this.physicsStep();!0===this.stabilized&&this.revert(),this.stabilizationIterations++}}},{key:"updatePhysicsData",value:function(){this.physicsBody.forces={},this.physicsBody.physicsNodeIndices=[],this.physicsBody.physicsEdgeIndices=[];var e=this.body.nodes,t=this.body.edges;for(var i in e)e.hasOwnProperty(i)&&!0===e[i].options.physics&&this.physicsBody.physicsNodeIndices.push(e[i].id);for(var r in t)t.hasOwnProperty(r)&&!0===t[r].options.physics&&this.physicsBody.physicsEdgeIndices.push(t[r].id);for(var n=0;n<this.physicsBody.physicsNodeIndices.length;n++){var o=this.physicsBody.physicsNodeIndices[n];this.physicsBody.forces[o]={x:0,y:0},void 0===this.physicsBody.velocities[o]&&(this.physicsBody.velocities[o]={x:0,y:0})}for(var a in this.physicsBody.velocities)void 0===e[a]&&delete this.physicsBody.velocities[a]}},{key:"revert",value:function(){var e=(0,r.default)(this.previousStates),t=this.body.nodes,i=this.physicsBody.velocities;this.referenceState={};for(var n=0;n<e.length;n++){var o=e[n];void 0!==t[o]?!0===t[o].options.physics&&(this.referenceState[o]={positions:{x:t[o].x,y:t[o].y}},i[o].x=this.previousStates[o].vx,i[o].y=this.previousStates[o].vy,t[o].x=this.previousStates[o].x,t[o].y=this.previousStates[o].y):delete this.previousStates[o]}}},{key:"_evaluateStepQuality",value:function(){var e=void 0,t=void 0,i=this.body.nodes,r=this.referenceState;for(var n in this.referenceState)if(this.referenceState.hasOwnProperty(n)&&void 0!==i[n]&&(e=i[n].x-r[n].positions.x,t=i[n].y-r[n].positions.y,Math.sqrt(Math.pow(e,2)+Math.pow(t,2))>.3))return!1;return!0}},{key:"moveNodes",value:function(){for(var e=this.physicsBody.physicsNodeIndices,t=0,i=0,r=0;r<e.length;r++){var n=e[r],o=this._performStep(n);t=Math.max(t,o),i+=o}this.adaptiveTimestepEnabled=i/e.length<5,this.stabilized=t<this.options.minVelocity}},{key:"calculateComponentVelocity",value:function(e,t,i){e+=(t-this.modelOptions.damping*e)/i*this.timestep;var r=this.options.maxVelocity||1e9;return Math.abs(e)>r&&(e=e>0?r:-r),e}},{key:"_performStep",value:function(e){var t=this.body.nodes[e],i=this.physicsBody.forces[e],r=this.physicsBody.velocities[e];return this.previousStates[e]={x:t.x,y:t.y,vx:r.x,vy:r.y},!1===t.options.fixed.x?(r.x=this.calculateComponentVelocity(r.x,i.x,t.options.mass),t.x+=r.x*this.timestep):(i.x=0,r.x=0),!1===t.options.fixed.y?(r.y=this.calculateComponentVelocity(r.y,i.y,t.options.mass),t.y+=r.y*this.timestep):(i.y=0,r.y=0),Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2))}},{key:"_freezeNodes",value:function(){var e=this.body.nodes;for(var t in e)if(e.hasOwnProperty(t)&&e[t].x&&e[t].y){var i=e[t].options.fixed;this.freezeCache[t]={x:i.x,y:i.y},i.x=!0,i.y=!0}}},{key:"_restoreFrozenNodes",value:function(){var e=this.body.nodes;for(var t in e)e.hasOwnProperty(t)&&void 0!==this.freezeCache[t]&&(e[t].options.fixed.x=this.freezeCache[t].x,e[t].options.fixed.y=this.freezeCache[t].y);this.freezeCache={}}},{key:"stabilize",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.stabilization.iterations;"number"!=typeof t&&(t=this.options.stabilization.iterations,console.log("The stabilize method needs a numeric amount of iterations. Switching to default: ",t)),0!==this.physicsBody.physicsNodeIndices.length?(this.adaptiveTimestep=this.options.adaptiveTimestep,this.body.emitter.emit("_resizeNodes"),this.stopSimulation(),this.stabilized=!1,this.body.emitter.emit("_blockRedraw"),this.targetIterations=t,!0===this.options.stabilization.onlyDynamicEdges&&this._freezeNodes(),this.stabilizationIterations=0,setTimeout(function(){return e._stabilizationBatch()},0)):this.ready=!0}},{key:"_startStabilizing",value:function(){return!0!==this.startedStabilization&&(this.body.emitter.emit("startStabilizing"),this.startedStabilization=!0,!0)}},{key:"_stabilizationBatch",value:function(){var e=this,t=function(){return!1===e.stabilized&&e.stabilizationIterations<e.targetIterations},i=function(){e.body.emitter.emit("stabilizationProgress",{iterations:e.stabilizationIterations,total:e.targetIterations})};this._startStabilizing()&&i();for(var r=0;t()&&r<this.options.stabilization.updateInterval;)this.physicsTick(),r++;i(),t()?setTimeout(this._stabilizationBatch.bind(this),0):this._finalizeStabilization()}},{key:"_finalizeStabilization",value:function(){this.body.emitter.emit("_allowRedraw"),!0===this.options.stabilization.fit&&this.body.emitter.emit("fit"),!0===this.options.stabilization.onlyDynamicEdges&&this._restoreFrozenNodes(),this.body.emitter.emit("stabilizationIterationsDone"),this.body.emitter.emit("_requestRedraw"),!0===this.stabilized?this._emitStabilized():this.startSimulation(),this.ready=!0}},{key:"_drawForces",value:function(e){for(var t=0;t<this.physicsBody.physicsNodeIndices.length;t++){var i=this.physicsBody.physicsNodeIndices[t],r=this.body.nodes[i],n=this.physicsBody.forces[i],o=Math.sqrt(Math.pow(n.x,2)+Math.pow(n.x,2)),a=Math.min(Math.max(5,o),15),s=3*a,l=m.HSVToHex((180-180*Math.min(1,Math.max(0,.03*o)))/360,1,1),u={x:r.x+20*n.x,y:r.y+20*n.y};e.lineWidth=a,e.strokeStyle=l,e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(u.x,u.y),e.stroke();var h=Math.atan2(n.y,n.x);e.fillStyle=l,v.draw(e,{type:"arrow",point:u,angle:h,length:s}),e.fill()}}}]),e}();t.default=g},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(t,i,n){(0,r.default)(this,e),this.body=t,this.physicsBody=i,this.setOptions(n)}return(0,n.default)(e,[{key:"setOptions",value:function(e){this.options=e}},{key:"solve",value:function(){for(var e,t,i,r,n,o,a,s,l=this.body.nodes,u=this.physicsBody.physicsNodeIndices,h=this.physicsBody.forces,c=this.options.nodeDistance,d=-2/3/c,p=0;p<u.length-1;p++){a=l[u[p]];for(var f=p+1;f<u.length;f++)e=(s=l[u[f]]).x-a.x,t=s.y-a.y,0===(i=Math.sqrt(e*e+t*t))&&(e=i=.1*Math.random()),i<2*c&&(o=i<.5*c?1:d*i+4/3,r=e*(o/=i),n=t*o,h[a.id].x-=r,h[a.id].y-=n,h[s.id].x+=r,h[s.id].y+=n)}}}]),e}();t.default=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(t,i,n){(0,r.default)(this,e),this.body=t,this.physicsBody=i,this.setOptions(n)}return(0,n.default)(e,[{key:"setOptions",value:function(e){this.options=e}},{key:"solve",value:function(){var e,t,i,r,n,o,a,s,l,u,h=this.body.nodes,c=this.physicsBody.physicsNodeIndices,d=this.physicsBody.forces,p=this.options.nodeDistance;for(l=0;l<c.length-1;l++)for(a=h[c[l]],u=l+1;u<c.length;u++)if(s=h[c[u]],a.level===s.level){e=s.x-a.x,t=s.y-a.y;o=(i=Math.sqrt(e*e+t*t))<p?-Math.pow(.05*i,2)+Math.pow(.05*p,2):0,0===i?i=.01:o/=i,r=e*o,n=t*o,d[a.id].x-=r,d[a.id].y-=n,d[s.id].x+=r,d[s.id].y+=n}}}]),e}();t.default=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(t,i,n){(0,r.default)(this,e),this.body=t,this.physicsBody=i,this.setOptions(n)}return(0,n.default)(e,[{key:"setOptions",value:function(e){this.options=e}},{key:"solve",value:function(){for(var e=void 0,t=void 0,i=this.physicsBody.physicsEdgeIndices,r=this.body.edges,n=void 0,o=void 0,a=void 0,s=0;s<i.length;s++)!0===(t=r[i[s]]).connected&&t.toId!==t.fromId&&void 0!==this.body.nodes[t.toId]&&void 0!==this.body.nodes[t.fromId]&&(void 0!==t.edgeType.via?(e=void 0===t.options.length?this.options.springLength:t.options.length,n=t.to,o=t.edgeType.via,a=t.from,this._calculateSpringForce(n,o,.5*e),this._calculateSpringForce(o,a,.5*e)):(e=void 0===t.options.length?1.5*this.options.springLength:t.options.length,this._calculateSpringForce(t.from,t.to,e)))}},{key:"_calculateSpringForce",value:function(e,t,i){var r=e.x-t.x,n=e.y-t.y,o=Math.max(Math.sqrt(r*r+n*n),.01),a=this.options.springConstant*(i-o)/o,s=r*a,l=n*a;void 0!==this.physicsBody.forces[e.id]&&(this.physicsBody.forces[e.id].x+=s,this.physicsBody.forces[e.id].y+=l),void 0!==this.physicsBody.forces[t.id]&&(this.physicsBody.forces[t.id].x-=s,this.physicsBody.forces[t.id].y-=l)}}]),e}();t.default=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(t,i,n){(0,r.default)(this,e),this.body=t,this.physicsBody=i,this.setOptions(n)}return(0,n.default)(e,[{key:"setOptions",value:function(e){this.options=e}},{key:"solve",value:function(){for(var e,t,i,r,n,o,a,s,l,u,h=this.body.edges,c=this.physicsBody.physicsEdgeIndices,d=this.physicsBody.physicsNodeIndices,p=this.physicsBody.forces,f=0;f<d.length;f++){var m=d[f];p[m].springFx=0,p[m].springFy=0}for(var v=0;v<c.length;v++)!0===(t=h[c[v]]).connected&&(e=void 0===t.options.length?this.options.springLength:t.options.length,i=t.from.x-t.to.x,r=t.from.y-t.to.y,s=0===(s=Math.sqrt(i*i+r*r))?.01:s,n=i*(a=this.options.springConstant*(e-s)/s),o=r*a,t.to.level!=t.from.level?(void 0!==p[t.toId]&&(p[t.toId].springFx-=n,p[t.toId].springFy-=o),void 0!==p[t.fromId]&&(p[t.fromId].springFx+=n,p[t.fromId].springFy+=o)):(void 0!==p[t.toId]&&(p[t.toId].x-=.5*n,p[t.toId].y-=.5*o),void 0!==p[t.fromId]&&(p[t.fromId].x+=.5*n,p[t.fromId].y+=.5*o)));a=1;for(var g=0;g<d.length;g++){var y=d[g];l=Math.min(a,Math.max(-a,p[y].springFx)),u=Math.min(a,Math.max(-a,p[y].springFy)),p[y].x+=l,p[y].y+=u}for(var _=0,b=0,x=0;x<d.length;x++){var w=d[x];_+=p[w].x,b+=p[w].y}for(var S=_/d.length,M=b/d.length,T=0;T<d.length;T++){var A=d[T];p[A].x-=S,p[A].y-=M}}}]),e}();t.default=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o){return(0,n.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"_calculateForces",value:function(e,t,i,r,n){0===e&&(t=e=.1*Math.random()),this.overlapAvoidanceFactor<1&&r.shape.radius&&(e=Math.max(.1+this.overlapAvoidanceFactor*r.shape.radius,e-r.shape.radius));var o=r.edges.length+1,a=this.options.gravitationalConstant*n.mass*r.options.mass*o/Math.pow(e,2),s=t*a,l=i*a;this.physicsBody.forces[r.id].x+=s,this.physicsBody.forces[r.id].y+=l}}]),t}(l(i(120)).default);t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i,o){return(0,n.default)(this,t),(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o))}return(0,s.default)(t,e),(0,o.default)(t,[{key:"_calculateForces",value:function(e,t,i,r,n){if(e>0){var o=n.edges.length+1,a=this.options.centralGravity*o*n.options.mass;r[n.id].x=t*a,r[n.id].y=i*a}}}]),t}(l(i(121)).default);t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=s(i(8)),n=s(i(6)),o=s(i(0)),a=s(i(1));function s(e){return e&&e.__esModule?e:{default:e}}var l=i(2),u=i(76).default,h=i(228).default,c=i(74).default,d=i(47).default,p=function(){function e(t){var i=this;(0,o.default)(this,e),this.body=t,this.clusteredNodes={},this.clusteredEdges={},this.options={},this.defaultOptions={},l.extend(this.options,this.defaultOptions),this.body.emitter.on("_resetData",function(){i.clusteredNodes={},i.clusteredEdges={}})}return(0,a.default)(e,[{key:"clusterByHubsize",value:function(e,t){void 0===e?e=this._getHubSize():"object"===(void 0===e?"undefined":(0,n.default)(e))&&(t=this._checkOptions(e),e=this._getHubSize());for(var i=[],r=0;r<this.body.nodeIndices.length;r++){var o=this.body.nodes[this.body.nodeIndices[r]];o.edges.length>=e&&i.push(o.id)}for(var a=0;a<i.length;a++)this.clusterByConnection(i[a],t,!0);this.body.emitter.emit("_dataChanged")}},{key:"cluster",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===t.joinCondition)throw new Error("Cannot call clusterByNodeData without a joinCondition function in the options.");t=this._checkOptions(t);var r={},n={};l.forEach(this.body.nodes,function(i,o){var a=u.cloneOptions(i);!0===t.joinCondition(a)&&(r[o]=i,l.forEach(i.edges,function(t){void 0===e.clusteredEdges[t.id]&&(n[t.id]=t)}))}),this._cluster(r,n,t,i)}},{key:"clusterByEdgeCount",value:function(e,t){var i=this,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t=this._checkOptions(t);for(var o=[],a={},s=void 0,l=void 0,h=void 0,c=function(n){var c={},d={},m=i.body.nodeIndices[n],v=i.body.nodes[m];if(void 0===a[m]){h=0,l=[];for(var g=0;g<v.edges.length;g++)s=v.edges[g],void 0===i.clusteredEdges[s.id]&&(s.toId!==s.fromId&&h++,l.push(s));if(h===e){p=function(e){if(void 0===t.joinCondition||null===t.joinCondition)return!0;var i=u.cloneOptions(e);return t.joinCondition(i)};for(var y=!0,_=0;_<l.length;_++){s=l[_];var b=i._getConnectedId(s,m);if(!p(v)){y=!1;break}d[s.id]=s,c[m]=v,c[b]=i.body.nodes[b],a[m]=!0}if((0,r.default)(c).length>0&&(0,r.default)(d).length>0&&!0===y)if(void 0!==(f=function(){for(var e=0;e<o.length;++e)for(var t in c)if(void 0!==o[e].nodes[t])return o[e]}())){for(var x in c)void 0===f.nodes[x]&&(f.nodes[x]=c[x]);for(var w in d)void 0===f.edges[w]&&(f.edges[w]=d[w])}else o.push({nodes:c,edges:d})}}},d=0;d<this.body.nodeIndices.length;d++){var p,f;c(d)}for(d=0;d<o.length;d++)this._cluster(o[d].nodes,o[d].edges,t,!1);!0===n&&this.body.emitter.emit("_dataChanged")}},{key:"clusterOutliers",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.clusterByEdgeCount(1,e,t)}},{key:"clusterBridges",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.clusterByEdgeCount(2,e,t)}},{key:"clusterByConnection",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(void 0===e)throw new Error("No nodeId supplied to clusterByConnection!");if(void 0===this.body.nodes[e])throw new Error("The nodeId given to clusterByConnection does not exist!");var n=this.body.nodes[e];void 0===(t=this._checkOptions(t,n)).clusterNodeProperties.x&&(t.clusterNodeProperties.x=n.x),void 0===t.clusterNodeProperties.y&&(t.clusterNodeProperties.y=n.y),void 0===t.clusterNodeProperties.fixed&&(t.clusterNodeProperties.fixed={},t.clusterNodeProperties.fixed.x=n.options.fixed.x,t.clusterNodeProperties.fixed.y=n.options.fixed.y);var o={},a={},s=n.id,l=u.cloneOptions(n);o[s]=n;for(var h=0;h<n.edges.length;h++){var c=n.edges[h];if(void 0===this.clusteredEdges[c.id]){var d=this._getConnectedId(c,s);if(void 0===this.clusteredNodes[d])if(d!==s)if(void 0===t.joinCondition)a[c.id]=c,o[d]=this.body.nodes[d];else{var p=u.cloneOptions(this.body.nodes[d]);!0===t.joinCondition(l,p)&&(a[c.id]=c,o[d]=this.body.nodes[d])}else a[c.id]=c}}var f=(0,r.default)(o).map(function(e){return o[e].id});for(m in o)if(o.hasOwnProperty(m))for(var m=o[m],v=0;v<m.edges.length;v++){var g=m.edges[v];f.indexOf(this._getConnectedId(g,m.id))>-1&&(a[g.id]=g)}this._cluster(o,a,t,i)}},{key:"_createClusterEdges",value:function(e,t,i,n){for(var o=void 0,a=void 0,s=void 0,l=void 0,u=void 0,h=void 0,c=(0,r.default)(e),d=[],p=0;p<c.length;p++){s=e[a=c[p]];for(var f=0;f<s.edges.length;f++)o=s.edges[f],void 0===this.clusteredEdges[o.id]&&(o.toId==o.fromId?t[o.id]=o:o.toId==a?(l=i.id,h=u=o.fromId):(l=o.toId,u=i.id,h=l),void 0===e[h]&&d.push({edge:o,fromId:u,toId:l}))}for(var m=[],v=function(e){for(var t=0;t<m.length;t++){var i=m[t],r=e.fromId===i.fromId&&e.toId===i.toId,n=e.fromId===i.toId&&e.toId===i.fromId;if(r||n)return i}return null},g=0;g<d.length;g++){var y=d[g],_=y.edge,b=v(y);null===b?(b=this._createClusteredEdge(y.fromId,y.toId,_,n),m.push(b)):b.clusteringEdgeReplacingIds.push(_.id),this.body.edges[_.id].edgeReplacedById=b.id,this._backupEdgeOptions(_),_.setOptions({physics:!1})}}},{key:"_checkOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return void 0===e.clusterEdgeProperties&&(e.clusterEdgeProperties={}),void 0===e.clusterNodeProperties&&(e.clusterNodeProperties={}),e}},{key:"_cluster",value:function(e,t,i){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=[];for(var a in e)e.hasOwnProperty(a)&&void 0!==this.clusteredNodes[a]&&o.push(a);for(var s=0;s<o.length;++s)delete e[o[s]];if(0!=(0,r.default)(e).length&&(1!=(0,r.default)(e).length||1==i.clusterNodeProperties.allowSingleNodeCluster)){var c=l.deepExtend({},i.clusterNodeProperties);if(void 0!==i.processProperties){var d=[];for(var p in e)if(e.hasOwnProperty(p)){var f=u.cloneOptions(e[p]);d.push(f)}var m=[];for(var v in t)if(t.hasOwnProperty(v)&&"clusterEdge:"!==v.substr(0,12)){var g=u.cloneOptions(t[v],"edge");m.push(g)}if(!(c=i.processProperties(c,d,m)))throw new Error("The processProperties function does not return properties!")}void 0===c.id&&(c.id="cluster:"+l.randomUUID());var y=c.id;void 0===c.label&&(c.label="cluster");var _=void 0;void 0===c.x&&(_=this._getClusterPosition(e),c.x=_.x),void 0===c.y&&(void 0===_&&(_=this._getClusterPosition(e)),c.y=_.y),c.id=y;var b=this.body.functions.createNode(c,h);b.containedNodes=e,b.containedEdges=t,b.clusterEdgeProperties=i.clusterEdgeProperties,this.body.nodes[c.id]=b,this._clusterEdges(e,t,c,i.clusterEdgeProperties),c.id=void 0,!0===n&&this.body.emitter.emit("_dataChanged")}}},{key:"_backupEdgeOptions",value:function(e){void 0===this.clusteredEdges[e.id]&&(this.clusteredEdges[e.id]={physics:e.options.physics})}},{key:"_restoreEdge",value:function(e){var t=this.clusteredEdges[e.id];void 0!==t&&(e.setOptions({physics:t.physics}),delete this.clusteredEdges[e.id])}},{key:"isCluster",value:function(e){return void 0!==this.body.nodes[e]?!0===this.body.nodes[e].isCluster:(console.log("Node does not exist."),!1)}},{key:"_getClusterPosition",value:function(e){for(var t=(0,r.default)(e),i=e[t[0]].x,n=e[t[0]].x,o=e[t[0]].y,a=e[t[0]].y,s=void 0,l=1;l<t.length;l++)i=(s=e[t[l]]).x<i?s.x:i,n=s.x>n?s.x:n,o=s.y<o?s.y:o,a=s.y>a?s.y:a;return{x:.5*(i+n),y:.5*(o+a)}}},{key:"openCluster",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(void 0===e)throw new Error("No clusterNodeId supplied to openCluster.");var r=this.body.nodes[e];if(void 0===r)throw new Error("The clusterNodeId supplied to openCluster does not exist.");if(!0!==r.isCluster||void 0===r.containedNodes||void 0===r.containedEdges)throw new Error("The node:"+e+" is not a valid cluster.");var n=this.findNode(e),o=n.indexOf(e)-1;if(o>=0){var a=n[o];return this.body.nodes[a]._openChildCluster(e),delete this.body.nodes[e],void(!0===i&&this.body.emitter.emit("_dataChanged"))}var s=r.containedNodes,u=r.containedEdges;if(void 0!==t&&void 0!==t.releaseFunction&&"function"==typeof t.releaseFunction){var h={},c={x:r.x,y:r.y};for(var d in s)if(s.hasOwnProperty(d)){var p=this.body.nodes[d];h[d]={x:p.x,y:p.y}}var f=t.releaseFunction(c,h);for(var m in s)if(s.hasOwnProperty(m)){var v=this.body.nodes[m];void 0!==f[m]&&(v.x=void 0===f[m].x?r.x:f[m].x,v.y=void 0===f[m].y?r.y:f[m].y)}}else l.forEach(s,function(e){!1===e.options.fixed.x&&(e.x=r.x),!1===e.options.fixed.y&&(e.y=r.y)});for(var g in s)if(s.hasOwnProperty(g)){var y=this.body.nodes[g];y.vx=r.vx,y.vy=r.vy,y.setOptions({physics:!0}),delete this.clusteredNodes[g]}for(var _=[],b=0;b<r.edges.length;b++)_.push(r.edges[b]);for(var x=0;x<_.length;x++){for(var w=_[x],S=this._getConnectedId(w,e),M=this.clusteredNodes[S],T=0;T<w.clusteringEdgeReplacingIds.length;T++){var A=w.clusteringEdgeReplacingIds[T],C=this.body.edges[A];if(void 0!==C)if(void 0!==M){var L=this.body.nodes[M.clusterId];L.containedEdges[C.id]=C,delete u[C.id];var N=C.fromId,P=C.toId;C.toId==S?P=M.clusterId:N=M.clusterId,this._createClusteredEdge(N,P,C,L.clusterEdgeProperties,{hidden:!1,physics:!0})}else this._restoreEdge(C)}w.remove()}for(var k in u)u.hasOwnProperty(k)&&this._restoreEdge(u[k]);delete this.body.nodes[e],!0===i&&this.body.emitter.emit("_dataChanged")}},{key:"getNodesInCluster",value:function(e){var t=[];if(!0===this.isCluster(e)){var i=this.body.nodes[e].containedNodes;for(var r in i)i.hasOwnProperty(r)&&t.push(this.body.nodes[r].id)}return t}},{key:"findNode",value:function(e){for(var t=[],i=0,r=void 0;void 0!==this.clusteredNodes[e]&&i<100;){if(void 0===(r=this.body.nodes[e]))return[];t.push(r.id),e=this.clusteredNodes[e].clusterId,i++}return void 0===(r=this.body.nodes[e])?[]:(t.push(r.id),t.reverse(),t)}},{key:"updateClusteredNode",value:function(e,t){if(void 0===e)throw new Error("No clusteredNodeId supplied to updateClusteredNode.");if(void 0===t)throw new Error("No newOptions supplied to updateClusteredNode.");if(void 0===this.body.nodes[e])throw new Error("The clusteredNodeId supplied to updateClusteredNode does not exist.");this.body.nodes[e].setOptions(t),this.body.emitter.emit("_dataChanged")}},{key:"updateEdge",value:function(e,t){if(void 0===e)throw new Error("No startEdgeId supplied to updateEdge.");if(void 0===t)throw new Error("No newOptions supplied to updateEdge.");if(void 0===this.body.edges[e])throw new Error("The startEdgeId supplied to updateEdge does not exist.");for(var i=this.getClusteredEdges(e),r=0;r<i.length;r++){this.body.edges[i[r]].setOptions(t)}this.body.emitter.emit("_dataChanged")}},{key:"getClusteredEdges",value:function(e){for(var t=[],i=0;void 0!==e&&void 0!==this.body.edges[e]&&i<100;)t.push(this.body.edges[e].id),e=this.body.edges[e].edgeReplacedById,i++;return t.reverse(),t}},{key:"getBaseEdge",value:function(e){return this.getBaseEdges(e)[0]}},{key:"getBaseEdges",value:function(e){for(var t=[e],i=[],r=[],n=0;t.length>0&&n<100;){var o=t.pop();if(void 0!==o){var a=this.body.edges[o];if(void 0!==a){n++;var s=a.clusteringEdgeReplacingIds;if(void 0===s)r.push(o);else for(var l=0;l<s.length;++l){var u=s[l];-1===t.indexOf(s)&&-1===i.indexOf(s)&&t.push(u)}i.push(o)}}}return r}},{key:"_getConnectedId",value:function(e,t){return e.toId!=t?e.toId:(e.fromId,e.fromId)}},{key:"_getHubSize",value:function(){for(var e=0,t=0,i=0,r=0,n=0;n<this.body.nodeIndices.length;n++){var o=this.body.nodes[this.body.nodeIndices[n]];o.edges.length>r&&(r=o.edges.length),e+=o.edges.length,t+=Math.pow(o.edges.length,2),i+=1}e/=i;var a=(t/=i)-Math.pow(e,2),s=Math.sqrt(a),l=Math.floor(e+2*s);return l>r&&(l=r),l}},{key:"_createClusteredEdge",value:function(e,t,i,r,n){var o=u.cloneOptions(i,"edge");l.deepExtend(o,r),o.from=e,o.to=t,o.id="clusterEdge:"+l.randomUUID(),void 0!==n&&l.deepExtend(o,n);var a=this.body.functions.createEdge(o);return a.clusteringEdgeReplacingIds=[i.id],a.connect(),this.body.edges[a.id]=a,a}},{key:"_clusterEdges",value:function(e,t,i,r){if(t instanceof c){var n=t,o={};o[n.id]=n,t=o}if(e instanceof d){var a=e,s={};s[a.id]=a,e=s}if(null==i)throw new Error("_clusterEdges: parameter clusterNode required");for(var l in void 0===r&&(r=i.clusterEdgeProperties),this._createClusterEdges(e,t,i,r),t)if(t.hasOwnProperty(l)&&void 0!==this.body.edges[l]){var u=this.body.edges[l];this._backupEdgeOptions(u),u.setOptions({physics:!1})}for(var h in e)e.hasOwnProperty(h)&&(this.clusteredNodes[h]={clusterId:i.id,node:this.body.nodes[h]},this.body.nodes[h].setOptions({physics:!1}))}},{key:"_getClusterNodeForNode",value:function(e){if(void 0!==e){var t=this.clusteredNodes[e];if(void 0!==t){var i=t.clusterId;if(void 0!==i)return this.body.nodes[i]}}}},{key:"_filter",value:function(e,t){var i=[];return l.forEach(e,function(e){t(e)&&i.push(e)}),i}},{key:"_updateState",value:function(){var e=this,t=void 0,i=[],n=[],o=function(t){l.forEach(e.body.nodes,function(e){!0===e.isCluster&&t(e)})};for(t in this.clusteredNodes){if(this.clusteredNodes.hasOwnProperty(t))void 0===this.body.nodes[t]&&i.push(t)}o(function(e){for(var t=0;t<i.length;t++)delete e.containedNodes[i[t]]});for(var a=0;a<i.length;a++)delete this.clusteredNodes[i[a]];l.forEach(this.clusteredEdges,function(t){var i=e.body.edges[t];void 0!==i&&i.endPointsValid()||n.push(t)}),o(function(e){l.forEach(e.containedEdges,function(e,t){e.endPointsValid()||-1!==n.indexOf(t)||n.push(t)})}),l.forEach(this.body.edges,function(t,i){var r=!0,o=t.clusteringEdgeReplacingIds;if(void 0!==o){var a=0;l.forEach(o,function(t){var i=e.body.edges[t];void 0!==i&&i.endPointsValid()&&(a+=1)}),r=a>0}t.endPointsValid()&&r||n.push(i)}),o(function(t){l.forEach(n,function(i){delete t.containedEdges[i],l.forEach(t.edges,function(r,o){r.id!==i?r.clusteringEdgeReplacingIds=e._filter(r.clusteringEdgeReplacingIds,function(e){return-1===n.indexOf(e)}):t.edges[o]=null}),t.edges=e._filter(t.edges,function(e){return null!==e})})}),l.forEach(n,function(t){delete e.clusteredEdges[t]}),l.forEach(n,function(t){delete e.body.edges[t]});var s=(0,r.default)(this.body.edges);l.forEach(s,function(t){var i=e.body.edges[t],r=e._isClusteredNode(i.fromId)||e._isClusteredNode(i.toId);if(r!==e._isClusteredEdge(i.id)){if(!r)throw new Error("remove edge from clustering not implemented!");var n=e._getClusterNodeForNode(i.fromId);void 0!==n&&e._clusterEdges(e.body.nodes[i.fromId],i,n);var o=e._getClusterNodeForNode(i.toId);void 0!==o&&e._clusterEdges(e.body.nodes[i.toId],i,o)}});for(var u=!1,h=!0,c=function(){var t=[];o(function(e){var i=(0,r.default)(e.containedNodes).length,n=!0===e.options.allowSingleNodeCluster;(n&&i<1||!n&&i<2)&&t.push(e.id)});for(var i=0;i<t.length;++i)e.openCluster(t[i],{},!1);h=t.length>0,u=u||h};h;)c();u&&this._updateState()}},{key:"_isClusteredNode",value:function(e){return void 0!==this.clusteredNodes[e]}},{key:"_isClusteredEdge",value:function(e){return void 0!==this.clusteredEdges[e]}}]),e}();t.default=p},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(3)),n=l(i(0)),o=l(i(1)),a=l(i(4)),s=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=i(2),h=function(e){function t(e,i,o,s,l,u){(0,n.default)(this,t);var h=(0,a.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e,i,o,s,l,u));return h.isCluster=!0,h.containedNodes={},h.containedEdges={},h}return(0,s.default)(t,e),(0,o.default)(t,[{key:"_openChildCluster",value:function(e){var t=this,i=this.body.nodes[e];if(void 0===this.containedNodes[e])throw new Error("node with id: "+e+" not in current cluster");if(!i.isCluster)throw new Error("node with id: "+e+" is not a cluster");delete this.containedNodes[e],u.forEach(i.edges,function(e){delete t.containedEdges[e.id]}),u.forEach(i.containedNodes,function(e,i){t.containedNodes[i]=e}),i.containedNodes={},u.forEach(i.containedEdges,function(e,i){t.containedEdges[i]=e}),i.containedEdges={},u.forEach(i.edges,function(e){u.forEach(t.edges,function(i){var r=i.clusteringEdgeReplacingIds.indexOf(e.id);-1!==r&&(u.forEach(e.clusteringEdgeReplacingIds,function(e){i.clusteringEdgeReplacingIds.push(e),t.body.edges[e].edgeReplacedById=i.id}),i.clusteringEdgeReplacingIds.splice(r,1))})}),i.edges=[]}}]),t}(i(47).default);t.default=h},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=i(2),s=function(){function e(t,i){var n;(0,r.default)(this,e),void 0!==window&&(n=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame),window.requestAnimationFrame=void 0===n?function(e){e()}:n,this.body=t,this.canvas=i,this.redrawRequested=!1,this.renderTimer=void 0,this.requiresTimeout=!0,this.renderingActive=!1,this.renderRequests=0,this.allowRedraw=!0,this.dragging=!1,this.options={},this.defaultOptions={hideEdgesOnDrag:!1,hideNodesOnDrag:!1},a.extend(this.options,this.defaultOptions),this._determineBrowserMethod(),this.bindEventListeners()}return(0,n.default)(e,[{key:"bindEventListeners",value:function(){var e=this;this.body.emitter.on("dragStart",function(){e.dragging=!0}),this.body.emitter.on("dragEnd",function(){e.dragging=!1}),this.body.emitter.on("_resizeNodes",function(){e._resizeNodes()}),this.body.emitter.on("_redraw",function(){!1===e.renderingActive&&e._redraw()}),this.body.emitter.on("_blockRedraw",function(){e.allowRedraw=!1}),this.body.emitter.on("_allowRedraw",function(){e.allowRedraw=!0,e.redrawRequested=!1}),this.body.emitter.on("_requestRedraw",this._requestRedraw.bind(this)),this.body.emitter.on("_startRendering",function(){e.renderRequests+=1,e.renderingActive=!0,e._startRendering()}),this.body.emitter.on("_stopRendering",function(){e.renderRequests-=1,e.renderingActive=e.renderRequests>0,e.renderTimer=void 0}),this.body.emitter.on("destroy",function(){e.renderRequests=0,e.allowRedraw=!1,e.renderingActive=!1,!0===e.requiresTimeout?clearTimeout(e.renderTimer):window.cancelAnimationFrame(e.renderTimer),e.body.emitter.off()})}},{key:"setOptions",value:function(e){if(void 0!==e){a.selectiveDeepExtend(["hideEdgesOnDrag","hideNodesOnDrag"],this.options,e)}}},{key:"_requestNextFrame",value:function(e,t){if("undefined"!=typeof window){var i=void 0,r=window;return!0===this.requiresTimeout?i=r.setTimeout(e,t):r.requestAnimationFrame&&(i=r.requestAnimationFrame(e)),i}}},{key:"_startRendering",value:function(){!0===this.renderingActive&&void 0===this.renderTimer&&(this.renderTimer=this._requestNextFrame(this._renderStep.bind(this),this.simulationInterval))}},{key:"_renderStep",value:function(){!0===this.renderingActive&&(this.renderTimer=void 0,!0===this.requiresTimeout&&this._startRendering(),this._redraw(),!1===this.requiresTimeout&&this._startRendering())}},{key:"redraw",value:function(){this.body.emitter.emit("setSize"),this._redraw()}},{key:"_requestRedraw",value:function(){var e=this;!0!==this.redrawRequested&&!1===this.renderingActive&&!0===this.allowRedraw&&(this.redrawRequested=!0,this._requestNextFrame(function(){e._redraw(!1)},0))}},{key:"_redraw",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!0===this.allowRedraw){this.body.emitter.emit("initRedraw"),this.redrawRequested=!1,0!==this.canvas.frame.canvas.width&&0!==this.canvas.frame.canvas.height||this.canvas.setSize(),this.canvas.setTransform();var t=this.canvas.getContext(),i=this.canvas.frame.canvas.clientWidth,r=this.canvas.frame.canvas.clientHeight;if(t.clearRect(0,0,i,r),0===this.canvas.frame.clientWidth)return;t.save(),t.translate(this.body.view.translation.x,this.body.view.translation.y),t.scale(this.body.view.scale,this.body.view.scale),t.beginPath(),this.body.emitter.emit("beforeDrawing",t),t.closePath(),!1===e&&(!1===this.dragging||!0===this.dragging&&!1===this.options.hideEdgesOnDrag)&&this._drawEdges(t),(!1===this.dragging||!0===this.dragging&&!1===this.options.hideNodesOnDrag)&&this._drawNodes(t,e),t.beginPath(),this.body.emitter.emit("afterDrawing",t),t.closePath(),t.restore(),!0===e&&t.clearRect(0,0,i,r)}}},{key:"_resizeNodes",value:function(){this.canvas.setTransform();var e=this.canvas.getContext();e.save(),e.translate(this.body.view.translation.x,this.body.view.translation.y),e.scale(this.body.view.scale,this.body.view.scale);var t=this.body.nodes,i=void 0;for(var r in t)t.hasOwnProperty(r)&&((i=t[r]).resize(e),i.updateBoundingBox(e,i.selected));e.restore()}},{key:"_drawNodes",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.body.nodes,r=this.body.nodeIndices,n=void 0,o=[],a=this.canvas.DOMtoCanvas({x:-20,y:-20}),s=this.canvas.DOMtoCanvas({x:this.canvas.frame.canvas.clientWidth+20,y:this.canvas.frame.canvas.clientHeight+20}),l={top:a.y,left:a.x,bottom:s.y,right:s.x},u=0;u<r.length;u++)(n=i[r[u]]).isSelected()?o.push(r[u]):!0===t?n.draw(e):!0===n.isBoundingBoxOverlappingWith(l)?n.draw(e):n.updateBoundingBox(e,n.selected);for(var h=0;h<o.length;h++)(n=i[o[h]]).draw(e)}},{key:"_drawEdges",value:function(e){for(var t=this.body.edges,i=this.body.edgeIndices,r=void 0,n=0;n<i.length;n++)!0===(r=t[i[n]]).connected&&r.draw(e)}},{key:"_determineBrowserMethod",value:function(){if("undefined"!=typeof window){var e=navigator.userAgent.toLowerCase();this.requiresTimeout=!1,-1!=e.indexOf("msie 9.0")?this.requiresTimeout=!0:-1!=e.indexOf("safari")&&e.indexOf("chrome")<=-1&&(this.requiresTimeout=!0)}else this.requiresTimeout=!0}}]),e}();t.default=s},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=i(10),s=i(37),l=i(2),u=function(){function e(t){(0,r.default)(this,e),this.body=t,this.pixelRatio=1,this.resizeTimer=void 0,this.resizeFunction=this._onResize.bind(this),this.cameraState={},this.initialized=!1,this.canvasViewCenter={},this.options={},this.defaultOptions={autoResize:!0,height:"100%",width:"100%"},l.extend(this.options,this.defaultOptions),this.bindEventListeners()}return(0,n.default)(e,[{key:"bindEventListeners",value:function(){var e=this;this.body.emitter.once("resize",function(t){0!==t.width&&(e.body.view.translation.x=.5*t.width),0!==t.height&&(e.body.view.translation.y=.5*t.height)}),this.body.emitter.on("setSize",this.setSize.bind(this)),this.body.emitter.on("destroy",function(){e.hammerFrame.destroy(),e.hammer.destroy(),e._cleanUp()})}},{key:"setOptions",value:function(e){var t=this;if(void 0!==e){l.selectiveDeepExtend(["width","height","autoResize"],this.options,e)}!0===this.options.autoResize&&(this._cleanUp(),this.resizeTimer=setInterval(function(){!0===t.setSize()&&t.body.emitter.emit("_requestRedraw")},1e3),this.resizeFunction=this._onResize.bind(this),l.addEventListener(window,"resize",this.resizeFunction))}},{key:"_cleanUp",value:function(){void 0!==this.resizeTimer&&clearInterval(this.resizeTimer),l.removeEventListener(window,"resize",this.resizeFunction),this.resizeFunction=void 0}},{key:"_onResize",value:function(){this.setSize(),this.body.emitter.emit("_redraw")}},{key:"_getCameraState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.pixelRatio;!0===this.initialized&&(this.cameraState.previousWidth=this.frame.canvas.width/e,this.cameraState.previousHeight=this.frame.canvas.height/e,this.cameraState.scale=this.body.view.scale,this.cameraState.position=this.DOMtoCanvas({x:.5*this.frame.canvas.width/e,y:.5*this.frame.canvas.height/e}))}},{key:"_setCameraState",value:function(){if(void 0!==this.cameraState.scale&&0!==this.frame.canvas.clientWidth&&0!==this.frame.canvas.clientHeight&&0!==this.pixelRatio&&this.cameraState.previousWidth>0){var e=this.frame.canvas.width/this.pixelRatio/this.cameraState.previousWidth,t=this.frame.canvas.height/this.pixelRatio/this.cameraState.previousHeight,i=this.cameraState.scale;1!=e&&1!=t?i=.5*this.cameraState.scale*(e+t):1!=e?i=this.cameraState.scale*e:1!=t&&(i=this.cameraState.scale*t),this.body.view.scale=i;var r=this.DOMtoCanvas({x:.5*this.frame.canvas.clientWidth,y:.5*this.frame.canvas.clientHeight}),n={x:r.x-this.cameraState.position.x,y:r.y-this.cameraState.position.y};this.body.view.translation.x+=n.x*this.body.view.scale,this.body.view.translation.y+=n.y*this.body.view.scale}}},{key:"_prepareValue",value:function(e){if("number"==typeof e)return e+"px";if("string"==typeof e){if(-1!==e.indexOf("%")||-1!==e.indexOf("px"))return e;if(-1===e.indexOf("%"))return e+"px"}throw new Error("Could not use the value supplied for width or height:"+e)}},{key:"_create",value:function(){for(;this.body.container.hasChildNodes();)this.body.container.removeChild(this.body.container.firstChild);if(this.frame=document.createElement("div"),this.frame.className="vis-network",this.frame.style.position="relative",this.frame.style.overflow="hidden",this.frame.tabIndex=900,this.frame.canvas=document.createElement("canvas"),this.frame.canvas.style.position="relative",this.frame.appendChild(this.frame.canvas),this.frame.canvas.getContext)this._setPixelRatio(),this.setTransform();else{var e=document.createElement("DIV");e.style.color="red",e.style.fontWeight="bold",e.style.padding="10px",e.innerHTML="Error: your browser does not support HTML canvas",this.frame.canvas.appendChild(e)}this.body.container.appendChild(this.frame),this.body.view.scale=1,this.body.view.translation={x:.5*this.frame.canvas.clientWidth,y:.5*this.frame.canvas.clientHeight},this._bindHammer()}},{key:"_bindHammer",value:function(){var e=this;void 0!==this.hammer&&this.hammer.destroy(),this.drag={},this.pinch={},this.hammer=new a(this.frame.canvas),this.hammer.get("pinch").set({enable:!0}),this.hammer.get("pan").set({threshold:5,direction:a.DIRECTION_ALL}),s.onTouch(this.hammer,function(t){e.body.eventListeners.onTouch(t)}),this.hammer.on("tap",function(t){e.body.eventListeners.onTap(t)}),this.hammer.on("doubletap",function(t){e.body.eventListeners.onDoubleTap(t)}),this.hammer.on("press",function(t){e.body.eventListeners.onHold(t)}),this.hammer.on("panstart",function(t){e.body.eventListeners.onDragStart(t)}),this.hammer.on("panmove",function(t){e.body.eventListeners.onDrag(t)}),this.hammer.on("panend",function(t){e.body.eventListeners.onDragEnd(t)}),this.hammer.on("pinch",function(t){e.body.eventListeners.onPinch(t)}),this.frame.canvas.addEventListener("mousewheel",function(t){e.body.eventListeners.onMouseWheel(t)}),this.frame.canvas.addEventListener("DOMMouseScroll",function(t){e.body.eventListeners.onMouseWheel(t)}),this.frame.canvas.addEventListener("mousemove",function(t){e.body.eventListeners.onMouseMove(t)}),this.frame.canvas.addEventListener("contextmenu",function(t){e.body.eventListeners.onContext(t)}),this.hammerFrame=new a(this.frame),s.onRelease(this.hammerFrame,function(t){e.body.eventListeners.onRelease(t)})}},{key:"setSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.width,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.height;e=this._prepareValue(e),t=this._prepareValue(t);var i=!1,r=this.frame.canvas.width,n=this.frame.canvas.height,o=this.pixelRatio;if(this._setPixelRatio(),e!=this.options.width||t!=this.options.height||this.frame.style.width!=e||this.frame.style.height!=t)this._getCameraState(o),this.frame.style.width=e,this.frame.style.height=t,this.frame.canvas.style.width="100%",this.frame.canvas.style.height="100%",this.frame.canvas.width=Math.round(this.frame.canvas.clientWidth*this.pixelRatio),this.frame.canvas.height=Math.round(this.frame.canvas.clientHeight*this.pixelRatio),this.options.width=e,this.options.height=t,this.canvasViewCenter={x:.5*this.frame.clientWidth,y:.5*this.frame.clientHeight},i=!0;else{var a=Math.round(this.frame.canvas.clientWidth*this.pixelRatio),s=Math.round(this.frame.canvas.clientHeight*this.pixelRatio);this.frame.canvas.width===a&&this.frame.canvas.height===s||this._getCameraState(o),this.frame.canvas.width!==a&&(this.frame.canvas.width=a,i=!0),this.frame.canvas.height!==s&&(this.frame.canvas.height=s,i=!0)}return!0===i&&(this.body.emitter.emit("resize",{width:Math.round(this.frame.canvas.width/this.pixelRatio),height:Math.round(this.frame.canvas.height/this.pixelRatio),oldWidth:Math.round(r/this.pixelRatio),oldHeight:Math.round(n/this.pixelRatio)}),this._setCameraState()),this.initialized=!0,i}},{key:"getContext",value:function(){return this.frame.canvas.getContext("2d")}},{key:"_determinePixelRatio",value:function(){var e=this.getContext();if(void 0===e)throw new Error("Could not get canvax context");var t=1;return"undefined"!=typeof window&&(t=window.devicePixelRatio||1),t/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1)}},{key:"_setPixelRatio",value:function(){this.pixelRatio=this._determinePixelRatio()}},{key:"setTransform",value:function(){var e=this.getContext();if(void 0===e)throw new Error("Could not get canvax context");e.setTransform(this.pixelRatio,0,0,this.pixelRatio,0,0)}},{key:"_XconvertDOMtoCanvas",value:function(e){return(e-this.body.view.translation.x)/this.body.view.scale}},{key:"_XconvertCanvasToDOM",value:function(e){return e*this.body.view.scale+this.body.view.translation.x}},{key:"_YconvertDOMtoCanvas",value:function(e){return(e-this.body.view.translation.y)/this.body.view.scale}},{key:"_YconvertCanvasToDOM",value:function(e){return e*this.body.view.scale+this.body.view.translation.y}},{key:"canvasToDOM",value:function(e){return{x:this._XconvertCanvasToDOM(e.x),y:this._YconvertCanvasToDOM(e.y)}}},{key:"DOMtoCanvas",value:function(e){return{x:this._XconvertDOMtoCanvas(e.x),y:this._YconvertDOMtoCanvas(e.y)}}}]),e}();t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=i(2),s=i(76).default,l=function(){function e(t,i){var n=this;(0,r.default)(this,e),this.body=t,this.canvas=i,this.animationSpeed=1/this.renderRefreshRate,this.animationEasingFunction="easeInOutQuint",this.easingTime=0,this.sourceScale=0,this.targetScale=0,this.sourceTranslation=0,this.targetTranslation=0,this.lockedOnNodeId=void 0,this.lockedOnNodeOffset=void 0,this.touchTime=0,this.viewFunction=void 0,this.body.emitter.on("fit",this.fit.bind(this)),this.body.emitter.on("animationFinished",function(){n.body.emitter.emit("_stopRendering")}),this.body.emitter.on("unlockNode",this.releaseNode.bind(this))}return(0,n.default)(e,[{key:"setOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e}},{key:"fit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{nodes:[]},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=void 0,r=void 0;if(void 0!==e.nodes&&0!==e.nodes.length||(e.nodes=this.body.nodeIndices),!0===t){var n=0;for(var o in this.body.nodes){if(this.body.nodes.hasOwnProperty(o))!0===this.body.nodes[o].predefinedPosition&&(n+=1)}if(n>.5*this.body.nodeIndices.length)return void this.fit(e,!1);i=s.getRange(this.body.nodes,e.nodes),r=12.662/(this.body.nodeIndices.length+7.4147)+.0964822,r*=Math.min(this.canvas.frame.canvas.clientWidth/600,this.canvas.frame.canvas.clientHeight/600)}else{this.body.emitter.emit("_resizeNodes"),i=s.getRange(this.body.nodes,e.nodes);var a=1.1*Math.abs(i.maxX-i.minX),l=1.1*Math.abs(i.maxY-i.minY),u=this.canvas.frame.canvas.clientWidth/a,h=this.canvas.frame.canvas.clientHeight/l;r=u<=h?u:h}r>1?r=1:0===r&&(r=1);var c={position:s.findCenter(i),scale:r,animation:e.animation};this.moveTo(c)}},{key:"focus",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(void 0!==this.body.nodes[e]){var i={x:this.body.nodes[e].x,y:this.body.nodes[e].y};t.position=i,t.lockedOnNode=e,this.moveTo(t)}else console.log("Node: "+e+" cannot be found.")}},{key:"moveTo",value:function(e){void 0!==e?(void 0===e.offset&&(e.offset={x:0,y:0}),void 0===e.offset.x&&(e.offset.x=0),void 0===e.offset.y&&(e.offset.y=0),void 0===e.scale&&(e.scale=this.body.view.scale),void 0===e.position&&(e.position=this.getViewPosition()),void 0===e.animation&&(e.animation={duration:0}),!1===e.animation&&(e.animation={duration:0}),!0===e.animation&&(e.animation={}),void 0===e.animation.duration&&(e.animation.duration=1e3),void 0===e.animation.easingFunction&&(e.animation.easingFunction="easeInOutQuad"),this.animateView(e)):e={}}},{key:"animateView",value:function(e){if(void 0!==e){this.animationEasingFunction=e.animation.easingFunction,this.releaseNode(),!0===e.locked&&(this.lockedOnNodeId=e.lockedOnNode,this.lockedOnNodeOffset=e.offset),0!=this.easingTime&&this._transitionRedraw(!0),this.sourceScale=this.body.view.scale,this.sourceTranslation=this.body.view.translation,this.targetScale=e.scale,this.body.view.scale=this.targetScale;var t=this.canvas.DOMtoCanvas({x:.5*this.canvas.frame.canvas.clientWidth,y:.5*this.canvas.frame.canvas.clientHeight}),i=t.x-e.position.x,r=t.y-e.position.y;this.targetTranslation={x:this.sourceTranslation.x+i*this.targetScale+e.offset.x,y:this.sourceTranslation.y+r*this.targetScale+e.offset.y},0===e.animation.duration?null!=this.lockedOnNodeId?(this.viewFunction=this._lockedRedraw.bind(this),this.body.emitter.on("initRedraw",this.viewFunction)):(this.body.view.scale=this.targetScale,this.body.view.translation=this.targetTranslation,this.body.emitter.emit("_requestRedraw")):(this.animationSpeed=1/(60*e.animation.duration*.001)||1/60,this.animationEasingFunction=e.animation.easingFunction,this.viewFunction=this._transitionRedraw.bind(this),this.body.emitter.on("initRedraw",this.viewFunction),this.body.emitter.emit("_startRendering"))}}},{key:"_lockedRedraw",value:function(){var e=this.body.nodes[this.lockedOnNodeId].x,t=this.body.nodes[this.lockedOnNodeId].y,i=this.canvas.DOMtoCanvas({x:.5*this.canvas.frame.canvas.clientWidth,y:.5*this.canvas.frame.canvas.clientHeight}),r=i.x-e,n=i.y-t,o=this.body.view.translation,a={x:o.x+r*this.body.view.scale+this.lockedOnNodeOffset.x,y:o.y+n*this.body.view.scale+this.lockedOnNodeOffset.y};this.body.view.translation=a}},{key:"releaseNode",value:function(){void 0!==this.lockedOnNodeId&&void 0!==this.viewFunction&&(this.body.emitter.off("initRedraw",this.viewFunction),this.lockedOnNodeId=void 0,this.lockedOnNodeOffset=void 0)}},{key:"_transitionRedraw",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.easingTime+=this.animationSpeed,this.easingTime=!0===e?1:this.easingTime;var t=a.easingFunctions[this.animationEasingFunction](this.easingTime);this.body.view.scale=this.sourceScale+(this.targetScale-this.sourceScale)*t,this.body.view.translation={x:this.sourceTranslation.x+(this.targetTranslation.x-this.sourceTranslation.x)*t,y:this.sourceTranslation.y+(this.targetTranslation.y-this.sourceTranslation.y)*t},this.easingTime>=1&&(this.body.emitter.off("initRedraw",this.viewFunction),this.easingTime=0,null!=this.lockedOnNodeId&&(this.viewFunction=this._lockedRedraw.bind(this),this.body.emitter.on("initRedraw",this.viewFunction)),this.body.emitter.emit("animationFinished"))}},{key:"getScale",value:function(){return this.body.view.scale}},{key:"getViewPosition",value:function(){return this.canvas.DOMtoCanvas({x:.5*this.canvas.frame.canvas.clientWidth,y:.5*this.canvas.frame.canvas.clientHeight})}}]),e}();t.default=l},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=i(2),s=i(233).default,l=i(104).default,u=function(){function e(t,i,n){(0,r.default)(this,e),this.body=t,this.canvas=i,this.selectionHandler=n,this.navigationHandler=new s(t,i),this.body.eventListeners.onTap=this.onTap.bind(this),this.body.eventListeners.onTouch=this.onTouch.bind(this),this.body.eventListeners.onDoubleTap=this.onDoubleTap.bind(this),this.body.eventListeners.onHold=this.onHold.bind(this),this.body.eventListeners.onDragStart=this.onDragStart.bind(this),this.body.eventListeners.onDrag=this.onDrag.bind(this),this.body.eventListeners.onDragEnd=this.onDragEnd.bind(this),this.body.eventListeners.onMouseWheel=this.onMouseWheel.bind(this),this.body.eventListeners.onPinch=this.onPinch.bind(this),this.body.eventListeners.onMouseMove=this.onMouseMove.bind(this),this.body.eventListeners.onRelease=this.onRelease.bind(this),this.body.eventListeners.onContext=this.onContext.bind(this),this.touchTime=0,this.drag={},this.pinch={},this.popup=void 0,this.popupObj=void 0,this.popupTimer=void 0,this.body.functions.getPointer=this.getPointer.bind(this),this.options={},this.defaultOptions={dragNodes:!0,dragView:!0,hover:!1,keyboard:{enabled:!1,speed:{x:10,y:10,zoom:.02},bindToWindow:!0},navigationButtons:!1,tooltipDelay:300,zoomView:!0},a.extend(this.options,this.defaultOptions),this.bindEventListeners()}return(0,n.default)(e,[{key:"bindEventListeners",value:function(){var e=this;this.body.emitter.on("destroy",function(){clearTimeout(e.popupTimer),delete e.body.functions.getPointer})}},{key:"setOptions",value:function(e){if(void 0!==e){a.selectiveNotDeepExtend(["hideEdgesOnDrag","hideNodesOnDrag","keyboard","multiselect","selectable","selectConnectedEdges"],this.options,e),a.mergeOptions(this.options,e,"keyboard"),e.tooltip&&(a.extend(this.options.tooltip,e.tooltip),e.tooltip.color&&(this.options.tooltip.color=a.parseColor(e.tooltip.color)))}this.navigationHandler.setOptions(this.options)}},{key:"getPointer",value:function(e){return{x:e.x-a.getAbsoluteLeft(this.canvas.frame.canvas),y:e.y-a.getAbsoluteTop(this.canvas.frame.canvas)}}},{key:"onTouch",value:function(e){(new Date).valueOf()-this.touchTime>50&&(this.drag.pointer=this.getPointer(e.center),this.drag.pinched=!1,this.pinch.scale=this.body.view.scale,this.touchTime=(new Date).valueOf())}},{key:"onTap",value:function(e){var t=this.getPointer(e.center),i=this.selectionHandler.options.multiselect&&(e.changedPointers[0].ctrlKey||e.changedPointers[0].metaKey);this.checkSelectionChanges(t,e,i),this.selectionHandler._generateClickEvent("click",e,t)}},{key:"onDoubleTap",value:function(e){var t=this.getPointer(e.center);this.selectionHandler._generateClickEvent("doubleClick",e,t)}},{key:"onHold",value:function(e){var t=this.getPointer(e.center),i=this.selectionHandler.options.multiselect;this.checkSelectionChanges(t,e,i),this.selectionHandler._generateClickEvent("click",e,t),this.selectionHandler._generateClickEvent("hold",e,t)}},{key:"onRelease",value:function(e){if((new Date).valueOf()-this.touchTime>10){var t=this.getPointer(e.center);this.selectionHandler._generateClickEvent("release",e,t),this.touchTime=(new Date).valueOf()}}},{key:"onContext",value:function(e){var t=this.getPointer({x:e.clientX,y:e.clientY});this.selectionHandler._generateClickEvent("oncontext",e,t)}},{key:"checkSelectionChanges",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.selectionHandler.getSelection(),n=!1;n=!0===i?this.selectionHandler.selectAdditionalOnPoint(e):this.selectionHandler.selectOnPoint(e);var o=this.selectionHandler.getSelection(),a=this._determineDifference(r,o),s=this._determineDifference(o,r);a.edges.length>0&&(this.selectionHandler._generateClickEvent("deselectEdge",t,e,r),n=!0),a.nodes.length>0&&(this.selectionHandler._generateClickEvent("deselectNode",t,e,r),n=!0),s.nodes.length>0&&(this.selectionHandler._generateClickEvent("selectNode",t,e),n=!0),s.edges.length>0&&(this.selectionHandler._generateClickEvent("selectEdge",t,e),n=!0),!0===n&&this.selectionHandler._generateClickEvent("select",t,e)}},{key:"_determineDifference",value:function(e,t){var i=function(e,t){for(var i=[],r=0;r<e.length;r++){var n=e[r];-1===t.indexOf(n)&&i.push(n)}return i};return{nodes:i(e.nodes,t.nodes),edges:i(e.edges,t.edges)}}},{key:"onDragStart",value:function(e){void 0===this.drag.pointer&&this.onTouch(e);var t=this.selectionHandler.getNodeAt(this.drag.pointer);if(this.drag.dragging=!0,this.drag.selection=[],this.drag.translation=a.extend({},this.body.view.translation),this.drag.nodeId=void 0,void 0!==t&&!0===this.options.dragNodes){this.drag.nodeId=t.id,!1===t.isSelected()&&(this.selectionHandler.unselectAll(),this.selectionHandler.selectObject(t)),this.selectionHandler._generateClickEvent("dragStart",e,this.drag.pointer);var i=this.selectionHandler.selectionObj.nodes;for(var r in i)if(i.hasOwnProperty(r)){var n=i[r],o={id:n.id,node:n,x:n.x,y:n.y,xFixed:n.options.fixed.x,yFixed:n.options.fixed.y};n.options.fixed.x=!0,n.options.fixed.y=!0,this.drag.selection.push(o)}}else this.selectionHandler._generateClickEvent("dragStart",e,this.drag.pointer,void 0,!0)}},{key:"onDrag",value:function(e){var t=this;if(!0!==this.drag.pinched){this.body.emitter.emit("unlockNode");var i=this.getPointer(e.center),r=this.drag.selection;if(r&&r.length&&!0===this.options.dragNodes){this.selectionHandler._generateClickEvent("dragging",e,i);var n=i.x-this.drag.pointer.x,o=i.y-this.drag.pointer.y;r.forEach(function(e){var i=e.node;!1===e.xFixed&&(i.x=t.canvas._XconvertDOMtoCanvas(t.canvas._XconvertCanvasToDOM(e.x)+n)),!1===e.yFixed&&(i.y=t.canvas._YconvertDOMtoCanvas(t.canvas._YconvertCanvasToDOM(e.y)+o))}),this.body.emitter.emit("startSimulation")}else if(!0===this.options.dragView){if(this.selectionHandler._generateClickEvent("dragging",e,i,void 0,!0),void 0===this.drag.pointer)return void this.onDragStart(e);var a=i.x-this.drag.pointer.x,s=i.y-this.drag.pointer.y;this.body.view.translation={x:this.drag.translation.x+a,y:this.drag.translation.y+s},this.body.emitter.emit("_requestRedraw")}}}},{key:"onDragEnd",value:function(e){this.drag.dragging=!1;var t=this.drag.selection;t&&t.length?(t.forEach(function(e){e.node.options.fixed.x=e.xFixed,e.node.options.fixed.y=e.yFixed}),this.selectionHandler._generateClickEvent("dragEnd",e,this.getPointer(e.center)),this.body.emitter.emit("startSimulation")):(this.selectionHandler._generateClickEvent("dragEnd",e,this.getPointer(e.center),void 0,!0),this.body.emitter.emit("_requestRedraw"))}},{key:"onPinch",value:function(e){var t=this.getPointer(e.center);this.drag.pinched=!0,void 0===this.pinch.scale&&(this.pinch.scale=1);var i=this.pinch.scale*e.scale;this.zoom(i,t)}},{key:"zoom",value:function(e,t){if(!0===this.options.zoomView){var i=this.body.view.scale;e<1e-5&&(e=1e-5),e>10&&(e=10);var r=void 0;void 0!==this.drag&&!0===this.drag.dragging&&(r=this.canvas.DOMtoCanvas(this.drag.pointer));var n=this.body.view.translation,o=e/i,a=(1-o)*t.x+n.x*o,s=(1-o)*t.y+n.y*o;if(this.body.view.scale=e,this.body.view.translation={x:a,y:s},null!=r){var l=this.canvas.canvasToDOM(r);this.drag.pointer.x=l.x,this.drag.pointer.y=l.y}this.body.emitter.emit("_requestRedraw"),i<e?this.body.emitter.emit("zoom",{direction:"+",scale:this.body.view.scale,pointer:t}):this.body.emitter.emit("zoom",{direction:"-",scale:this.body.view.scale,pointer:t})}}},{key:"onMouseWheel",value:function(e){if(!0===this.options.zoomView){var t=0;if(e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),0!==t){var i=this.body.view.scale,r=t/10;t<0&&(r/=1-r),i*=1+r;var n=this.getPointer({x:e.clientX,y:e.clientY});this.zoom(i,n)}e.preventDefault()}}},{key:"onMouseMove",value:function(e){var t=this,i=this.getPointer({x:e.clientX,y:e.clientY}),r=!1;void 0!==this.popup&&(!1===this.popup.hidden&&this._checkHidePopup(i),!1===this.popup.hidden&&(r=!0,this.popup.setPosition(i.x+3,i.y-5),this.popup.show())),!1===this.options.keyboard.bindToWindow&&!0===this.options.keyboard.enabled&&this.canvas.frame.focus(),!1===r&&(void 0!==this.popupTimer&&(clearInterval(this.popupTimer),this.popupTimer=void 0),this.drag.dragging||(this.popupTimer=setTimeout(function(){return t._checkShowPopup(i)},this.options.tooltipDelay))),!0===this.options.hover&&this.selectionHandler.hoverObject(e,i)}},{key:"_checkShowPopup",value:function(e){var t=this.canvas._XconvertDOMtoCanvas(e.x),i=this.canvas._YconvertDOMtoCanvas(e.y),r={left:t,top:i,right:t,bottom:i},n=void 0===this.popupObj?void 0:this.popupObj.id,o=!1,a="node";if(void 0===this.popupObj){for(var s=this.body.nodeIndices,u=this.body.nodes,h=void 0,c=[],d=0;d<s.length;d++)!0===(h=u[s[d]]).isOverlappingWith(r)&&void 0!==h.getTitle()&&c.push(s[d]);c.length>0&&(this.popupObj=u[c[c.length-1]],o=!0)}if(void 0===this.popupObj&&!1===o){for(var p=this.body.edgeIndices,f=this.body.edges,m=void 0,v=[],g=0;g<p.length;g++)!0===(m=f[p[g]]).isOverlappingWith(r)&&!0===m.connected&&void 0!==m.getTitle()&&v.push(p[g]);v.length>0&&(this.popupObj=f[v[v.length-1]],a="edge")}void 0!==this.popupObj?this.popupObj.id!==n&&(void 0===this.popup&&(this.popup=new l(this.canvas.frame)),this.popup.popupTargetType=a,this.popup.popupTargetId=this.popupObj.id,this.popup.setPosition(e.x+3,e.y-5),this.popup.setText(this.popupObj.getTitle()),this.popup.show(),this.body.emitter.emit("showPopup",this.popupObj.id)):void 0!==this.popup&&(this.popup.hide(),this.body.emitter.emit("hidePopup"))}},{key:"_checkHidePopup",value:function(e){var t=this.selectionHandler._pointerToPositionObject(e),i=!1;if("node"===this.popup.popupTargetType){if(void 0!==this.body.nodes[this.popup.popupTargetId]&&!0===(i=this.body.nodes[this.popup.popupTargetId].isOverlappingWith(t))){var r=this.selectionHandler.getNodeAt(e);i=void 0!==r&&r.id===this.popup.popupTargetId}}else void 0===this.selectionHandler.getNodeAt(e)&&void 0!==this.body.edges[this.popup.popupTargetId]&&(i=this.body.edges[this.popup.popupTargetId].isOverlappingWith(t));!1===i&&(this.popupObj=void 0,this.popup.hide(),this.body.emitter.emit("hidePopup"))}}]),e}();t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=i(10),s=i(37),l=i(35),u=function(){function e(t,i){var n=this;(0,r.default)(this,e),this.body=t,this.canvas=i,this.iconsCreated=!1,this.navigationHammers=[],this.boundFunctions={},this.touchTime=0,this.activated=!1,this.body.emitter.on("activate",function(){n.activated=!0,n.configureKeyboardBindings()}),this.body.emitter.on("deactivate",function(){n.activated=!1,n.configureKeyboardBindings()}),this.body.emitter.on("destroy",function(){void 0!==n.keycharm&&n.keycharm.destroy()}),this.options={}}return(0,n.default)(e,[{key:"setOptions",value:function(e){void 0!==e&&(this.options=e,this.create())}},{key:"create",value:function(){!0===this.options.navigationButtons?!1===this.iconsCreated&&this.loadNavigationElements():!0===this.iconsCreated&&this.cleanNavigation(),this.configureKeyboardBindings()}},{key:"cleanNavigation",value:function(){if(0!=this.navigationHammers.length){for(var e=0;e<this.navigationHammers.length;e++)this.navigationHammers[e].destroy();this.navigationHammers=[]}this.navigationDOM&&this.navigationDOM.wrapper&&this.navigationDOM.wrapper.parentNode&&this.navigationDOM.wrapper.parentNode.removeChild(this.navigationDOM.wrapper),this.iconsCreated=!1}},{key:"loadNavigationElements",value:function(){var e=this;this.cleanNavigation(),this.navigationDOM={};var t=["up","down","left","right","zoomIn","zoomOut","zoomExtends"],i=["_moveUp","_moveDown","_moveLeft","_moveRight","_zoomIn","_zoomOut","_fit"];this.navigationDOM.wrapper=document.createElement("div"),this.navigationDOM.wrapper.className="vis-navigation",this.canvas.frame.appendChild(this.navigationDOM.wrapper);for(var r=0;r<t.length;r++){this.navigationDOM[t[r]]=document.createElement("div"),this.navigationDOM[t[r]].className="vis-button vis-"+t[r],this.navigationDOM.wrapper.appendChild(this.navigationDOM[t[r]]);var n=new a(this.navigationDOM[t[r]]);"_fit"===i[r]?s.onTouch(n,this._fit.bind(this)):s.onTouch(n,this.bindToRedraw.bind(this,i[r])),this.navigationHammers.push(n)}var o=new a(this.canvas.frame);s.onRelease(o,function(){e._stopMovement()}),this.navigationHammers.push(o),this.iconsCreated=!0}},{key:"bindToRedraw",value:function(e){void 0===this.boundFunctions[e]&&(this.boundFunctions[e]=this[e].bind(this),this.body.emitter.on("initRedraw",this.boundFunctions[e]),this.body.emitter.emit("_startRendering"))}},{key:"unbindFromRedraw",value:function(e){void 0!==this.boundFunctions[e]&&(this.body.emitter.off("initRedraw",this.boundFunctions[e]),this.body.emitter.emit("_stopRendering"),delete this.boundFunctions[e])}},{key:"_fit",value:function(){(new Date).valueOf()-this.touchTime>700&&(this.body.emitter.emit("fit",{duration:700}),this.touchTime=(new Date).valueOf())}},{key:"_stopMovement",value:function(){for(var e in this.boundFunctions)this.boundFunctions.hasOwnProperty(e)&&(this.body.emitter.off("initRedraw",this.boundFunctions[e]),this.body.emitter.emit("_stopRendering"));this.boundFunctions={}}},{key:"_moveUp",value:function(){this.body.view.translation.y+=this.options.keyboard.speed.y}},{key:"_moveDown",value:function(){this.body.view.translation.y-=this.options.keyboard.speed.y}},{key:"_moveLeft",value:function(){this.body.view.translation.x+=this.options.keyboard.speed.x}},{key:"_moveRight",value:function(){this.body.view.translation.x-=this.options.keyboard.speed.x}},{key:"_zoomIn",value:function(){var e=this.body.view.scale,t=this.body.view.scale*(1+this.options.keyboard.speed.zoom),i=this.body.view.translation,r=t/e,n=(1-r)*this.canvas.canvasViewCenter.x+i.x*r,o=(1-r)*this.canvas.canvasViewCenter.y+i.y*r;this.body.view.scale=t,this.body.view.translation={x:n,y:o},this.body.emitter.emit("zoom",{direction:"+",scale:this.body.view.scale,pointer:null})}},{key:"_zoomOut",value:function(){var e=this.body.view.scale,t=this.body.view.scale/(1+this.options.keyboard.speed.zoom),i=this.body.view.translation,r=t/e,n=(1-r)*this.canvas.canvasViewCenter.x+i.x*r,o=(1-r)*this.canvas.canvasViewCenter.y+i.y*r;this.body.view.scale=t,this.body.view.translation={x:n,y:o},this.body.emitter.emit("zoom",{direction:"-",scale:this.body.view.scale,pointer:null})}},{key:"configureKeyboardBindings",value:function(){var e=this;void 0!==this.keycharm&&this.keycharm.destroy(),!0===this.options.keyboard.enabled&&(!0===this.options.keyboard.bindToWindow?this.keycharm=l({container:window,preventDefault:!0}):this.keycharm=l({container:this.canvas.frame,preventDefault:!0}),this.keycharm.reset(),!0===this.activated&&(this.keycharm.bind("up",function(){e.bindToRedraw("_moveUp")},"keydown"),this.keycharm.bind("down",function(){e.bindToRedraw("_moveDown")},"keydown"),this.keycharm.bind("left",function(){e.bindToRedraw("_moveLeft")},"keydown"),this.keycharm.bind("right",function(){e.bindToRedraw("_moveRight")},"keydown"),this.keycharm.bind("=",function(){e.bindToRedraw("_zoomIn")},"keydown"),this.keycharm.bind("num+",function(){e.bindToRedraw("_zoomIn")},"keydown"),this.keycharm.bind("num-",function(){e.bindToRedraw("_zoomOut")},"keydown"),this.keycharm.bind("-",function(){e.bindToRedraw("_zoomOut")},"keydown"),this.keycharm.bind("[",function(){e.bindToRedraw("_zoomOut")},"keydown"),this.keycharm.bind("]",function(){e.bindToRedraw("_zoomIn")},"keydown"),this.keycharm.bind("pageup",function(){e.bindToRedraw("_zoomIn")},"keydown"),this.keycharm.bind("pagedown",function(){e.bindToRedraw("_zoomOut")},"keydown"),this.keycharm.bind("up",function(){e.unbindFromRedraw("_moveUp")},"keyup"),this.keycharm.bind("down",function(){e.unbindFromRedraw("_moveDown")},"keyup"),this.keycharm.bind("left",function(){e.unbindFromRedraw("_moveLeft")},"keyup"),this.keycharm.bind("right",function(){e.unbindFromRedraw("_moveRight")},"keyup"),this.keycharm.bind("=",function(){e.unbindFromRedraw("_zoomIn")},"keyup"),this.keycharm.bind("num+",function(){e.unbindFromRedraw("_zoomIn")},"keyup"),this.keycharm.bind("num-",function(){e.unbindFromRedraw("_zoomOut")},"keyup"),this.keycharm.bind("-",function(){e.unbindFromRedraw("_zoomOut")},"keyup"),this.keycharm.bind("[",function(){e.unbindFromRedraw("_zoomOut")},"keyup"),this.keycharm.bind("]",function(){e.unbindFromRedraw("_zoomIn")},"keyup"),this.keycharm.bind("pageup",function(){e.unbindFromRedraw("_zoomIn")},"keyup"),this.keycharm.bind("pagedown",function(){e.unbindFromRedraw("_zoomOut")},"keyup")))}}]),e}();t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=i(47).default,s=i(74).default,l=i(2),u=function(){function e(t,i){var n=this;(0,r.default)(this,e),this.body=t,this.canvas=i,this.selectionObj={nodes:[],edges:[]},this.hoverObj={nodes:{},edges:{}},this.options={},this.defaultOptions={multiselect:!1,selectable:!0,selectConnectedEdges:!0,hoverConnectedEdges:!0},l.extend(this.options,this.defaultOptions),this.body.emitter.on("_dataChanged",function(){n.updateSelection()})}return(0,n.default)(e,[{key:"setOptions",value:function(e){if(void 0!==e){l.selectiveDeepExtend(["multiselect","hoverConnectedEdges","selectable","selectConnectedEdges"],this.options,e)}}},{key:"selectOnPoint",value:function(e){var t=!1;if(!0===this.options.selectable){var i=this.getNodeAt(e)||this.getEdgeAt(e);this.unselectAll(),void 0!==i&&(t=this.selectObject(i)),this.body.emitter.emit("_requestRedraw")}return t}},{key:"selectAdditionalOnPoint",value:function(e){var t=!1;if(!0===this.options.selectable){var i=this.getNodeAt(e)||this.getEdgeAt(e);void 0!==i&&(t=!0,!0===i.isSelected()?this.deselectObject(i):this.selectObject(i),this.body.emitter.emit("_requestRedraw"))}return t}},{key:"_initBaseEvent",value:function(e,t){var i={};return i.pointer={DOM:{x:t.x,y:t.y},canvas:this.canvas.DOMtoCanvas(t)},i.event=e,i}},{key:"_generateClickEvent",value:function(e,t,i,r){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=this._initBaseEvent(t,i);if(!0===n)o.nodes=[],o.edges=[];else{var a=this.getSelection();o.nodes=a.nodes,o.edges=a.edges}void 0!==r&&(o.previousSelection=r),"click"==e&&(o.items=this.getClickedItems(i)),this.body.emitter.emit(e,o)}},{key:"selectObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.selectConnectedEdges;return void 0!==e&&(e instanceof a&&!0===t&&this._selectConnectedEdges(e),e.select(),this._addToSelection(e),!0)}},{key:"deselectObject",value:function(e){!0===e.isSelected()&&(e.selected=!1,this._removeFromSelection(e))}},{key:"_getAllNodesOverlappingWith",value:function(e){for(var t=[],i=this.body.nodes,r=0;r<this.body.nodeIndices.length;r++){var n=this.body.nodeIndices[r];i[n].isOverlappingWith(e)&&t.push(n)}return t}},{key:"_pointerToPositionObject",value:function(e){var t=this.canvas.DOMtoCanvas(e);return{left:t.x-1,top:t.y+1,right:t.x+1,bottom:t.y-1}}},{key:"getNodeAt",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this._pointerToPositionObject(e),r=this._getAllNodesOverlappingWith(i);return r.length>0?!0===t?this.body.nodes[r[r.length-1]]:r[r.length-1]:void 0}},{key:"_getEdgesOverlappingWith",value:function(e,t){for(var i=this.body.edges,r=0;r<this.body.edgeIndices.length;r++){var n=this.body.edgeIndices[r];i[n].isOverlappingWith(e)&&t.push(n)}}},{key:"_getAllEdgesOverlappingWith",value:function(e){var t=[];return this._getEdgesOverlappingWith(e,t),t}},{key:"getEdgeAt",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.canvas.DOMtoCanvas(e),r=10,n=null,o=this.body.edges,a=0;a<this.body.edgeIndices.length;a++){var s=this.body.edgeIndices[a],l=o[s];if(l.connected){var u=l.from.x,h=l.from.y,c=l.to.x,d=l.to.y,p=l.edgeType.getDistanceToEdge(u,h,c,d,i.x,i.y);p<r&&(n=s,r=p)}}return null!==n?!0===t?this.body.edges[n]:n:void 0}},{key:"_addToSelection",value:function(e){e instanceof a?this.selectionObj.nodes[e.id]=e:this.selectionObj.edges[e.id]=e}},{key:"_addToHover",value:function(e){e instanceof a?this.hoverObj.nodes[e.id]=e:this.hoverObj.edges[e.id]=e}},{key:"_removeFromSelection",value:function(e){e instanceof a?(delete this.selectionObj.nodes[e.id],this._unselectConnectedEdges(e)):delete this.selectionObj.edges[e.id]}},{key:"unselectAll",value:function(){for(var e in this.selectionObj.nodes)this.selectionObj.nodes.hasOwnProperty(e)&&this.selectionObj.nodes[e].unselect();for(var t in this.selectionObj.edges)this.selectionObj.edges.hasOwnProperty(t)&&this.selectionObj.edges[t].unselect();this.selectionObj={nodes:{},edges:{}}}},{key:"_getSelectedNodeCount",value:function(){var e=0;for(var t in this.selectionObj.nodes)this.selectionObj.nodes.hasOwnProperty(t)&&(e+=1);return e}},{key:"_getSelectedNode",value:function(){for(var e in this.selectionObj.nodes)if(this.selectionObj.nodes.hasOwnProperty(e))return this.selectionObj.nodes[e]}},{key:"_getSelectedEdge",value:function(){for(var e in this.selectionObj.edges)if(this.selectionObj.edges.hasOwnProperty(e))return this.selectionObj.edges[e]}},{key:"_getSelectedEdgeCount",value:function(){var e=0;for(var t in this.selectionObj.edges)this.selectionObj.edges.hasOwnProperty(t)&&(e+=1);return e}},{key:"_getSelectedObjectCount",value:function(){var e=0;for(var t in this.selectionObj.nodes)this.selectionObj.nodes.hasOwnProperty(t)&&(e+=1);for(var i in this.selectionObj.edges)this.selectionObj.edges.hasOwnProperty(i)&&(e+=1);return e}},{key:"_selectionIsEmpty",value:function(){for(var e in this.selectionObj.nodes)if(this.selectionObj.nodes.hasOwnProperty(e))return!1;for(var t in this.selectionObj.edges)if(this.selectionObj.edges.hasOwnProperty(t))return!1;return!0}},{key:"_clusterInSelection",value:function(){for(var e in this.selectionObj.nodes)if(this.selectionObj.nodes.hasOwnProperty(e)&&this.selectionObj.nodes[e].clusterSize>1)return!0;return!1}},{key:"_selectConnectedEdges",value:function(e){for(var t=0;t<e.edges.length;t++){var i=e.edges[t];i.select(),this._addToSelection(i)}}},{key:"_hoverConnectedEdges",value:function(e){for(var t=0;t<e.edges.length;t++){var i=e.edges[t];i.hover=!0,this._addToHover(i)}}},{key:"_unselectConnectedEdges",value:function(e){for(var t=0;t<e.edges.length;t++){var i=e.edges[t];i.unselect(),this._removeFromSelection(i)}}},{key:"emitBlurEvent",value:function(e,t,i){var r=this._initBaseEvent(e,t);!0===i.hover&&(i.hover=!1,i instanceof a?(r.node=i.id,this.body.emitter.emit("blurNode",r)):(r.edge=i.id,this.body.emitter.emit("blurEdge",r)))}},{key:"emitHoverEvent",value:function(e,t,i){var r=this._initBaseEvent(e,t),n=!1;return!1===i.hover&&(i.hover=!0,this._addToHover(i),n=!0,i instanceof a?(r.node=i.id,this.body.emitter.emit("hoverNode",r)):(r.edge=i.id,this.body.emitter.emit("hoverEdge",r))),n}},{key:"hoverObject",value:function(e,t){var i=this.getNodeAt(t);void 0===i&&(i=this.getEdgeAt(t));var r=!1;for(var n in this.hoverObj.nodes)this.hoverObj.nodes.hasOwnProperty(n)&&(void 0===i||i instanceof a&&i.id!=n||i instanceof s)&&(this.emitBlurEvent(e,t,this.hoverObj.nodes[n]),delete this.hoverObj.nodes[n],r=!0);for(var o in this.hoverObj.edges)this.hoverObj.edges.hasOwnProperty(o)&&(!0===r?(this.hoverObj.edges[o].hover=!1,delete this.hoverObj.edges[o]):(void 0===i||i instanceof s&&i.id!=o||i instanceof a&&!i.hover)&&(this.emitBlurEvent(e,t,this.hoverObj.edges[o]),delete this.hoverObj.edges[o],r=!0));void 0!==i&&(r=r||this.emitHoverEvent(e,t,i),i instanceof a&&!0===this.options.hoverConnectedEdges&&this._hoverConnectedEdges(i)),!0===r&&this.body.emitter.emit("_requestRedraw")}},{key:"getSelection",value:function(){return{nodes:this.getSelectedNodes(),edges:this.getSelectedEdges()}}},{key:"getSelectedNodes",value:function(){var e=[];if(!0===this.options.selectable)for(var t in this.selectionObj.nodes)this.selectionObj.nodes.hasOwnProperty(t)&&e.push(this.selectionObj.nodes[t].id);return e}},{key:"getSelectedEdges",value:function(){var e=[];if(!0===this.options.selectable)for(var t in this.selectionObj.edges)this.selectionObj.edges.hasOwnProperty(t)&&e.push(this.selectionObj.edges[t].id);return e}},{key:"setSelection",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=void 0,r=void 0;if(!e||!e.nodes&&!e.edges)throw"Selection must be an object with nodes and/or edges properties";if((t.unselectAll||void 0===t.unselectAll)&&this.unselectAll(),e.nodes)for(i=0;i<e.nodes.length;i++){r=e.nodes[i];var n=this.body.nodes[r];if(!n)throw new RangeError('Node with id "'+r+'" not found');this.selectObject(n,t.highlightEdges)}if(e.edges)for(i=0;i<e.edges.length;i++){r=e.edges[i];var o=this.body.edges[r];if(!o)throw new RangeError('Edge with id "'+r+'" not found');this.selectObject(o)}this.body.emitter.emit("_requestRedraw")}},{key:"selectNodes",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e||void 0===e.length)throw"Selection must be an array with ids";this.setSelection({nodes:e},{highlightEdges:t})}},{key:"selectEdges",value:function(e){if(!e||void 0===e.length)throw"Selection must be an array with ids";this.setSelection({edges:e})}},{key:"updateSelection",value:function(){for(var e in this.selectionObj.nodes)this.selectionObj.nodes.hasOwnProperty(e)&&(this.body.nodes.hasOwnProperty(e)||delete this.selectionObj.nodes[e]);for(var t in this.selectionObj.edges)this.selectionObj.edges.hasOwnProperty(t)&&(this.body.edges.hasOwnProperty(t)||delete this.selectionObj.edges[t])}},{key:"getClickedItems",value:function(e){for(var t=this.canvas.DOMtoCanvas(e),i=[],r=this.body.nodeIndices,n=this.body.nodes,o=r.length-1;o>=0;o--){var a=n[r[o]].getItemsOnPoint(t);i.push.apply(i,a)}for(var s=this.body.edgeIndices,l=this.body.edges,u=s.length-1;u>=0;u--){var h=l[s[u]].getItemsOnPoint(t);i.push.apply(i,h)}return i}}]),e}();t.default=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(30)),n=l(i(6)),o=l(i(8)),a=l(i(0)),s=l(i(1));function l(e){return e&&e.__esModule?e:{default:e}}var u=i(2),h=i(76).default,c=i(236),d=c.HorizontalStrategy,p=c.VerticalStrategy,f=function(){function e(){(0,a.default)(this,e),this.childrenReference={},this.parentReference={},this.trees={},this.distributionOrdering={},this.levels={},this.distributionIndex={},this.isTree=!1,this.treeIndex=-1}return(0,s.default)(e,[{key:"addRelation",value:function(e,t){void 0===this.childrenReference[e]&&(this.childrenReference[e]=[]),this.childrenReference[e].push(t),void 0===this.parentReference[t]&&(this.parentReference[t]=[]),this.parentReference[t].push(e)}},{key:"checkIfTree",value:function(){for(var e in this.parentReference)if(this.parentReference[e].length>1)return void(this.isTree=!1);this.isTree=!0}},{key:"numTrees",value:function(){return this.treeIndex+1}},{key:"setTreeIndex",value:function(e,t){void 0!==t&&void 0===this.trees[e.id]&&(this.trees[e.id]=t,this.treeIndex=Math.max(t,this.treeIndex))}},{key:"ensureLevel",value:function(e){void 0===this.levels[e]&&(this.levels[e]=0)}},{key:"getMaxLevel",value:function(e){var t=this,i={};return function e(r){if(void 0!==i[r])return i[r];var n=t.levels[r];if(t.childrenReference[r]){var o=t.childrenReference[r];if(o.length>0)for(var a=0;a<o.length;a++)n=Math.max(n,e(o[a]))}return i[r]=n,n}(e)}},{key:"levelDownstream",value:function(e,t){void 0===this.levels[t.id]&&(void 0===this.levels[e.id]&&(this.levels[e.id]=0),this.levels[t.id]=this.levels[e.id]+1)}},{key:"setMinLevelToZero",value:function(e){var t=1e9;for(var i in e)e.hasOwnProperty(i)&&void 0!==this.levels[i]&&(t=Math.min(this.levels[i],t));for(var r in e)e.hasOwnProperty(r)&&void 0!==this.levels[r]&&(this.levels[r]-=t)}},{key:"getTreeSize",value:function(e,t){var i=1e9,r=-1e9,n=1e9,o=-1e9;for(var a in this.trees)if(this.trees.hasOwnProperty(a)&&this.trees[a]===t){var s=e[a];i=Math.min(s.x,i),r=Math.max(s.x,r),n=Math.min(s.y,n),o=Math.max(s.y,o)}return{min_x:i,max_x:r,min_y:n,max_y:o}}},{key:"hasSameParent",value:function(e,t){var i=this.parentReference[e.id],r=this.parentReference[t.id];if(void 0===i||void 0===r)return!1;for(var n=0;n<i.length;n++)for(var o=0;o<r.length;o++)if(i[n]==r[o])return!0;return!1}},{key:"inSameSubNetwork",value:function(e,t){return this.trees[e.id]===this.trees[t.id]}},{key:"getLevels",value:function(){return(0,o.default)(this.distributionOrdering)}},{key:"addToOrdering",value:function(e,t){void 0===this.distributionOrdering[t]&&(this.distributionOrdering[t]=[]);var i=!1,r=this.distributionOrdering[t];for(var n in r)if(r[n]===e){i=!0;break}i||(this.distributionOrdering[t].push(e),this.distributionIndex[e.id]=this.distributionOrdering[t].length-1)}}]),e}(),m=function(){function e(t){(0,a.default)(this,e),this.body=t,this.initialRandomSeed=Math.round(1e6*Math.random()),this.randomSeed=this.initialRandomSeed,this.setPhysics=!1,this.options={},this.optionsBackup={physics:{}},this.defaultOptions={randomSeed:void 0,improvedLayout:!0,hierarchical:{enabled:!1,levelSeparation:150,nodeSpacing:100,treeSpacing:200,blockShifting:!0,edgeMinimization:!0,parentCentralization:!0,direction:"UD",sortMethod:"hubsize"}},u.extend(this.options,this.defaultOptions),this.bindEventListeners()}return(0,s.default)(e,[{key:"bindEventListeners",value:function(){var e=this;this.body.emitter.on("_dataChanged",function(){e.setupHierarchicalLayout()}),this.body.emitter.on("_dataLoaded",function(){e.layoutNetwork()}),this.body.emitter.on("_resetHierarchicalLayout",function(){e.setupHierarchicalLayout()}),this.body.emitter.on("_adjustEdgesForHierarchicalLayout",function(){if(!0===e.options.hierarchical.enabled){var t=e.direction.curveType();e.body.emitter.emit("_forceDisableDynamicCurves",t,!1)}})}},{key:"setOptions",value:function(e,t){if(void 0!==e){var i=this.options.hierarchical,r=i.enabled;if(u.selectiveDeepExtend(["randomSeed","improvedLayout"],this.options,e),u.mergeOptions(this.options,e,"hierarchical"),void 0!==e.randomSeed&&(this.initialRandomSeed=e.randomSeed),!0===i.enabled)return!0===r&&this.body.emitter.emit("refresh",!0),"RL"===i.direction||"DU"===i.direction?i.levelSeparation>0&&(i.levelSeparation*=-1):i.levelSeparation<0&&(i.levelSeparation*=-1),this.setDirectionStrategy(),this.body.emitter.emit("_resetHierarchicalLayout"),this.adaptAllOptionsForHierarchicalLayout(t);if(!0===r)return this.body.emitter.emit("refresh"),u.deepExtend(t,this.optionsBackup)}return t}},{key:"adaptAllOptionsForHierarchicalLayout",value:function(e){if(!0===this.options.hierarchical.enabled){var t=this.optionsBackup.physics;void 0===e.physics||!0===e.physics?(e.physics={enabled:void 0===t.enabled||t.enabled,solver:"hierarchicalRepulsion"},t.enabled=void 0===t.enabled||t.enabled,t.solver=t.solver||"barnesHut"):"object"===(0,n.default)(e.physics)?(t.enabled=void 0===e.physics.enabled||e.physics.enabled,t.solver=e.physics.solver||"barnesHut",e.physics.solver="hierarchicalRepulsion"):!1!==e.physics&&(t.solver="barnesHut",e.physics={solver:"hierarchicalRepulsion"});var i=this.direction.curveType();if(void 0===e.edges)this.optionsBackup.edges={smooth:{enabled:!0,type:"dynamic"}},e.edges={smooth:!1};else if(void 0===e.edges.smooth)this.optionsBackup.edges={smooth:{enabled:!0,type:"dynamic"}},e.edges.smooth=!1;else if("boolean"==typeof e.edges.smooth)this.optionsBackup.edges={smooth:e.edges.smooth},e.edges.smooth={enabled:e.edges.smooth,type:i};else{var r=e.edges.smooth;void 0!==r.type&&"dynamic"!==r.type&&(i=r.type),this.optionsBackup.edges={smooth:void 0===r.enabled||r.enabled,type:void 0===r.type?"dynamic":r.type,roundness:void 0===r.roundness?.5:r.roundness,forceDirection:void 0!==r.forceDirection&&r.forceDirection},e.edges.smooth={enabled:void 0===r.enabled||r.enabled,type:i,roundness:void 0===r.roundness?.5:r.roundness,forceDirection:void 0!==r.forceDirection&&r.forceDirection}}this.body.emitter.emit("_forceDisableDynamicCurves",i)}return e}},{key:"seededRandom",value:function(){var e=1e4*Math.sin(this.randomSeed++);return e-Math.floor(e)}},{key:"positionInitially",value:function(e){if(!0!==this.options.hierarchical.enabled){this.randomSeed=this.initialRandomSeed;for(var t=e.length+50,i=0;i<e.length;i++){var r=e[i],n=2*Math.PI*this.seededRandom();void 0===r.x&&(r.x=t*Math.cos(n)),void 0===r.y&&(r.y=t*Math.sin(n))}}}},{key:"layoutNetwork",value:function(){if(!0!==this.options.hierarchical.enabled&&!0===this.options.improvedLayout){for(var e=this.body.nodeIndices,t=0,i=0;i<e.length;i++){!0===this.body.nodes[e[i]].predefinedPosition&&(t+=1)}if(t<.5*e.length){var r=0,n={clusterNodeProperties:{shape:"ellipse",label:"",group:"",font:{multi:!1}},clusterEdgeProperties:{label:"",font:{multi:!1},smooth:{enabled:!1}}};if(e.length>150){for(var o=e.length;e.length>150&&r<=10;){r+=1;var a=e.length;if(r%3==0?this.body.modules.clustering.clusterBridges(n):this.body.modules.clustering.clusterOutliers(n),a==e.length&&r%3!=0)return this._declusterAll(),this.body.emitter.emit("_layoutFailed"),void console.info("This network could not be positioned by this version of the improved layout algorithm. Please disable improvedLayout for better performance.")}this.body.modules.kamadaKawai.setOptions({springLength:Math.max(150,2*o)})}r>10&&console.info("The clustering didn't succeed within the amount of interations allowed, progressing with partial result."),this.body.modules.kamadaKawai.solve(e,this.body.edgeIndices,!0),this._shiftToCenter();for(var s=0;s<e.length;s++){var l=this.body.nodes[e[s]];!1===l.predefinedPosition&&(l.x+=70*(.5-this.seededRandom()),l.y+=70*(.5-this.seededRandom()))}this._declusterAll(),this.body.emitter.emit("_repositionBezierNodes")}}}},{key:"_shiftToCenter",value:function(){for(var e=h.getRangeCore(this.body.nodes,this.body.nodeIndices),t=h.findCenter(e),i=0;i<this.body.nodeIndices.length;i++){var r=this.body.nodes[this.body.nodeIndices[i]];r.x-=t.x,r.y-=t.y}}},{key:"_declusterAll",value:function(){for(var e=!0;!0===e;){e=!1;for(var t=0;t<this.body.nodeIndices.length;t++)!0===this.body.nodes[this.body.nodeIndices[t]].isCluster&&(e=!0,this.body.modules.clustering.openCluster(this.body.nodeIndices[t],{},!1));!0===e&&this.body.emitter.emit("_dataChanged")}}},{key:"getSeed",value:function(){return this.initialRandomSeed}},{key:"setupHierarchicalLayout",value:function(){if(!0===this.options.hierarchical.enabled&&this.body.nodeIndices.length>0){var e=void 0,t=void 0,i=!1,r=!1;for(t in this.lastNodeOnLevel={},this.hierarchical=new f,this.body.nodes)this.body.nodes.hasOwnProperty(t)&&(void 0!==(e=this.body.nodes[t]).options.level?(i=!0,this.hierarchical.levels[t]=e.options.level):r=!0);if(!0===r&&!0===i)throw new Error("To use the hierarchical layout, nodes require either no predefined levels or levels have to be defined for all nodes.");if(!0===r){var n=this.options.hierarchical.sortMethod;"hubsize"===n?this._determineLevelsByHubsize():"directed"===n?this._determineLevelsDirected():"custom"===n&&this._determineLevelsCustomCallback()}for(var o in this.body.nodes)this.body.nodes.hasOwnProperty(o)&&this.hierarchical.ensureLevel(o);var a=this._getDistribution();this._generateMap(),this._placeNodesByHierarchy(a),this._condenseHierarchy(),this._shiftToCenter()}}},{key:"_condenseHierarchy",value:function(){var e=this,t=!1,i={},n=function(t,i){var r=e.hierarchical.trees;for(var n in r)r.hasOwnProperty(n)&&r[n]===t&&e.direction.shift(n,i)},o=function(){for(var t=[],i=0;i<e.hierarchical.numTrees();i++)t.push(e.direction.getTreeSize(i));return t},a=function t(i,r){if(!r[i.id]&&(r[i.id]=!0,e.hierarchical.childrenReference[i.id])){var n=e.hierarchical.childrenReference[i.id];if(n.length>0)for(var o=0;o<n.length;o++)t(e.body.nodes[n[o]],r)}},s=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e9,n=1e9,o=1e9,a=1e9,s=-1e9;for(var l in t)if(t.hasOwnProperty(l)){var u=e.body.nodes[l],h=e.hierarchical.levels[u.id],c=e.direction.getPosition(u),d=e._getSpaceAroundNode(u,t),p=(0,r.default)(d,2),f=p[0],m=p[1];n=Math.min(f,n),o=Math.min(m,o),h<=i&&(a=Math.min(c,a),s=Math.max(c,s))}return[a,s,n,o]},l=function(t,i,r){for(var n=e.hierarchical,o=0;o<i.length;o++){var a=i[o],s=n.distributionOrdering[a];if(s.length>1)for(var l=0;l<s.length-1;l++){var u=s[l],h=s[l+1];n.hasSameParent(u,h)&&n.inSameSubNetwork(u,h)&&t(u,h,r)}}},u=function(i,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=e.direction.getPosition(i),l=e.direction.getPosition(r),u=Math.abs(l-o),h=e.options.hierarchical.nodeSpacing;if(u>h){var c={},d={};a(i,c),a(r,d);var p=function(t,i){var r=e.hierarchical.getMaxLevel(t.id),n=e.hierarchical.getMaxLevel(i.id);return Math.min(r,n)}(i,r),f=s(c,p),m=s(d,p),v=f[1],g=m[0],y=m[2];if(Math.abs(v-g)>h){var _=v-g+h;_<-y+h&&(_=-y+h),_<0&&(e._shiftBlock(r.id,_),t=!0,!0===n&&e._centerParent(r))}}},h=function(n,o){for(var l=o.id,u=o.edges,h=e.hierarchical.levels[o.id],c=e.options.hierarchical.levelSeparation*e.options.hierarchical.levelSeparation,d={},p=[],f=0;f<u.length;f++){var m=u[f];if(m.toId!=m.fromId){var v=m.toId==l?m.from:m.to;d[u[f].id]=v,e.hierarchical.levels[v.id]<h&&p.push(m)}}var g=function(t,i){for(var r=0,n=0;n<i.length;n++)if(void 0!==d[i[n].id]){var o=e.direction.getPosition(d[i[n].id])-t;r+=o/Math.sqrt(o*o+c)}return r},y=function(t,i){for(var r=0,n=0;n<i.length;n++)if(void 0!==d[i[n].id]){var o=e.direction.getPosition(d[i[n].id])-t;r-=c*Math.pow(o*o+c,-1.5)}return r},_=function(t,i){for(var r=e.direction.getPosition(o),n={},a=0;a<t;a++){var s=g(r,i),l=y(r,i);if(void 0!==n[r-=Math.max(-40,Math.min(40,Math.round(s/l)))])break;n[r]=a}return r},b=_(n,p);!function(r){var n=e.direction.getPosition(o);if(void 0===i[o.id]){var l={};a(o,l),i[o.id]=l}var u=s(i[o.id]),h=u[2],c=u[3],d=r-n,p=0;d>0?p=Math.min(d,c-e.options.hierarchical.nodeSpacing):d<0&&(p=-Math.min(-d,h-e.options.hierarchical.nodeSpacing)),0!=p&&(e._shiftBlock(o.id,p),t=!0)}(b),function(i){var n=e.direction.getPosition(o),a=e._getSpaceAroundNode(o),s=(0,r.default)(a,2),l=s[0],u=s[1],h=i-n,c=n;h>0?c=Math.min(n+(u-e.options.hierarchical.nodeSpacing),i):h<0&&(c=Math.max(n-(l-e.options.hierarchical.nodeSpacing),i)),c!==n&&(e.direction.setPosition(o,c),t=!0)}(b=_(n,u))};!0===this.options.hierarchical.blockShifting&&(function(i){var r=e.hierarchical.getLevels();r=r.reverse();for(var n=0;n<i&&(t=!1,l(u,r,!0),!0===t);n++);}(5),function(){for(var t in e.body.nodes)e.body.nodes.hasOwnProperty(t)&&e._centerParent(e.body.nodes[t])}()),!0===this.options.hierarchical.edgeMinimization&&function(i){var r=e.hierarchical.getLevels();r=r.reverse();for(var n=0;n<i;n++){t=!1;for(var o=0;o<r.length;o++)for(var a=r[o],s=e.hierarchical.distributionOrdering[a],l=0;l<s.length;l++)h(1e3,s[l]);if(!0!==t)break}}(20),!0===this.options.hierarchical.parentCentralization&&function(){var t=e.hierarchical.getLevels();t=t.reverse();for(var i=0;i<t.length;i++)for(var r=t[i],n=e.hierarchical.distributionOrdering[r],o=0;o<n.length;o++)e._centerParent(n[o])}(),function(){for(var t=o(),i=0,r=0;r<t.length-1;r++)i+=t[r].max-t[r+1].min+e.options.hierarchical.treeSpacing,n(r+1,i)}()}},{key:"_getSpaceAroundNode",value:function(e,t){var i=!0;void 0===t&&(i=!1);var r=this.hierarchical.levels[e.id];if(void 0!==r){var n=this.hierarchical.distributionIndex[e.id],o=this.direction.getPosition(e),a=this.hierarchical.distributionOrdering[r],s=1e9,l=1e9;if(0!==n){var u=a[n-1];if(!0===i&&void 0===t[u.id]||!1===i)s=o-this.direction.getPosition(u)}if(n!=a.length-1){var h=a[n+1];if(!0===i&&void 0===t[h.id]||!1===i){var c=this.direction.getPosition(h);l=Math.min(l,c-o)}}return[s,l]}return[0,0]}},{key:"_centerParent",value:function(e){if(this.hierarchical.parentReference[e.id])for(var t=this.hierarchical.parentReference[e.id],i=0;i<t.length;i++){var n=t[i],o=this.body.nodes[n],a=this.hierarchical.childrenReference[n];if(void 0!==a){var s=this._getCenterPosition(a),l=this.direction.getPosition(o),u=this._getSpaceAroundNode(o),h=(0,r.default)(u,2),c=h[0],d=h[1],p=l-s;(p<0&&Math.abs(p)<d-this.options.hierarchical.nodeSpacing||p>0&&Math.abs(p)<c-this.options.hierarchical.nodeSpacing)&&this.direction.setPosition(o,s)}}}},{key:"_placeNodesByHierarchy",value:function(e){for(var t in this.positionedNodes={},e)if(e.hasOwnProperty(t)){var i=(0,o.default)(e[t]);i=this._indexArrayToNodes(i),this.direction.sort(i);for(var r=0,n=0;n<i.length;n++){var a=i[n];if(void 0===this.positionedNodes[a.id]){var s=this.options.hierarchical.nodeSpacing,l=s*r;r>0&&(l=this.direction.getPosition(i[n-1])+s),this.direction.setPosition(a,l,t),this._validatePositionAndContinue(a,t,l),r++}}}}},{key:"_placeBranchNodes",value:function(e,t){var i=this.hierarchical.childrenReference[e];if(void 0!==i){for(var r=[],n=0;n<i.length;n++)r.push(this.body.nodes[i[n]]);this.direction.sort(r);for(var o=0;o<r.length;o++){var a=r[o],s=this.hierarchical.levels[a.id];if(!(s>t&&void 0===this.positionedNodes[a.id]))return;var l=this.options.hierarchical.nodeSpacing,u=void 0;u=0===o?this.direction.getPosition(this.body.nodes[e]):this.direction.getPosition(r[o-1])+l,this.direction.setPosition(a,u,s),this._validatePositionAndContinue(a,s,u)}var h=this._getCenterPosition(r);this.direction.setPosition(this.body.nodes[e],h,t)}}},{key:"_validatePositionAndContinue",value:function(e,t,i){if(this.hierarchical.isTree){if(void 0!==this.lastNodeOnLevel[t]){var r=this.direction.getPosition(this.body.nodes[this.lastNodeOnLevel[t]]);if(i-r<this.options.hierarchical.nodeSpacing){var n=r+this.options.hierarchical.nodeSpacing-i,o=this._findCommonParent(this.lastNodeOnLevel[t],e.id);this._shiftBlock(o.withChild,n)}}this.lastNodeOnLevel[t]=e.id,this.positionedNodes[e.id]=!0,this._placeBranchNodes(e.id,t)}}},{key:"_indexArrayToNodes",value:function(e){for(var t=[],i=0;i<e.length;i++)t.push(this.body.nodes[e[i]]);return t}},{key:"_getDistribution",value:function(){var e={},t=void 0,i=void 0;for(t in this.body.nodes)if(this.body.nodes.hasOwnProperty(t)){i=this.body.nodes[t];var r=void 0===this.hierarchical.levels[t]?0:this.hierarchical.levels[t];this.direction.fix(i,r),void 0===e[r]&&(e[r]={}),e[r][t]=i}return e}},{key:"_getActiveEdges",value:function(e){var t=this,i=[];return u.forEach(e.edges,function(e){-1!==t.body.edgeIndices.indexOf(e.id)&&i.push(e)}),i}},{key:"_getHubSizes",value:function(){var e=this,t={},i=this.body.nodeIndices;u.forEach(i,function(i){var r=e.body.nodes[i],n=e._getActiveEdges(r).length;t[n]=!0});var r=[];return u.forEach(t,function(e){r.push(Number(e))}),r.sort(function(e,t){return t-e}),r}},{key:"_determineLevelsByHubsize",value:function(){for(var e=this,t=function(t,i){e.hierarchical.levelDownstream(t,i)},i=this._getHubSizes(),r=function(r){var n=i[r];if(0===n)return"break";u.forEach(e.body.nodeIndices,function(i){var r=e.body.nodes[i];n===e._getActiveEdges(r).length&&e._crawlNetwork(t,i)})},n=0;n<i.length;++n){if("break"===r(n))break}}},{key:"_determineLevelsCustomCallback",value:function(){var e=this;this._crawlNetwork(function(t,i,r){var n=e.hierarchical.levels[t.id];void 0===n&&(n=e.hierarchical.levels[t.id]=1e5);var o=(h.cloneOptions(t,"node"),h.cloneOptions(i,"node"),void h.cloneOptions(r,"edge"));e.hierarchical.levels[i.id]=n+o}),this.hierarchical.setMinLevelToZero(this.body.nodes)}},{key:"_determineLevelsDirected",value:function(){var e=this;this._crawlNetwork(function(t,i,r){var n=e.hierarchical.levels[t.id],o=e.hierarchical.levels[i.id];(function(t){return u.forEach(e.body.edges,function(e){if(e.toId===t.fromId&&e.fromId===t.toId)return!0}),!1})(r)&&void 0!==n&&void 0!==o||(void 0===n&&(n=e.hierarchical.levels[t.id]=1e4),r.toId==i.id?e.hierarchical.levels[i.id]=n+1:e.hierarchical.levels[i.id]=n-1)}),this.hierarchical.setMinLevelToZero(this.body.nodes)}},{key:"_generateMap",value:function(){var e=this;this._crawlNetwork(function(t,i){e.hierarchical.levels[i.id]>e.hierarchical.levels[t.id]&&e.hierarchical.addRelation(t.id,i.id)}),this.hierarchical.checkIfTree()}},{key:"_crawlNetwork",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},i=arguments[1],r={},n=function i(n,o){if(void 0===r[n.id]){e.hierarchical.setTreeIndex(n,o),r[n.id]=!0;for(var a=void 0,s=e._getActiveEdges(n),l=0;l<s.length;l++){var u=s[l];!0===u.connected&&(a=u.toId==n.id?u.from:u.to,n.id!=a.id&&(t(n,a,u),i(a,o)))}}};if(void 0===i)for(var o=0,a=0;a<this.body.nodeIndices.length;a++){var s=this.body.nodeIndices[a];if(void 0===r[s])n(this.body.nodes[s],o),o+=1}else{var l=this.body.nodes[i];if(void 0===l)return void console.error("Node not found:",i);n(l)}}},{key:"_shiftBlock",value:function(e,t){var i=this,r={};!function e(n){if(!r[n]){r[n]=!0,i.direction.shift(n,t);var o=i.hierarchical.childrenReference[n];if(void 0!==o)for(var a=0;a<o.length;a++)e(o[a])}}(e)}},{key:"_findCommonParent",value:function(e,t){var i=this,r={};return function e(t,r){var n=i.hierarchical.parentReference[r];if(void 0!==n)for(var o=0;o<n.length;o++){var a=n[o];t[a]=!0,e(t,a)}}(r,e),function e(t,r){var n=i.hierarchical.parentReference[r];if(void 0!==n)for(var o=0;o<n.length;o++){var a=n[o];if(void 0!==t[a])return{foundParent:a,withChild:r};var s=e(t,a);if(null!==s.foundParent)return s}return{foundParent:null,withChild:r}}(r,t)}},{key:"setDirectionStrategy",value:function(){var e="UD"===this.options.hierarchical.direction||"DU"===this.options.hierarchical.direction;this.direction=e?new p(this):new d(this)}},{key:"_getCenterPosition",value:function(e){for(var t=1e9,i=-1e9,r=0;r<e.length;r++){var n=void 0;if(void 0!==e[r].id)n=e[r];else{var o=e[r];n=this.body.nodes[o]}var a=this.direction.getPosition(n);t=Math.min(t,a),i=Math.max(i,a)}return.5*(t+i)}}]),e}();t.default=m},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.VerticalStrategy=t.HorizontalStrategy=void 0;var r=l(i(3)),n=l(i(4)),o=l(i(5)),a=l(i(0)),s=l(i(1));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"abstract",value:function(){throw new Error("Can't instantiate abstract class!")}},{key:"fake_use",value:function(){}},{key:"curveType",value:function(){return this.abstract()}},{key:"getPosition",value:function(e){return this.fake_use(e),this.abstract()}},{key:"setPosition",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this.fake_use(e,t,i),this.abstract()}},{key:"getTreeSize",value:function(e){return this.fake_use(e),this.abstract()}},{key:"sort",value:function(e){this.fake_use(e),this.abstract()}},{key:"fix",value:function(e,t){this.fake_use(e,t),this.abstract()}},{key:"shift",value:function(e,t){this.fake_use(e,t),this.abstract()}}]),e}(),h=function(e){function t(e){(0,a.default)(this,t);var i=(0,n.default)(this,(t.__proto__||(0,r.default)(t)).call(this));return i.layout=e,i}return(0,o.default)(t,e),(0,s.default)(t,[{key:"curveType",value:function(){return"horizontal"}},{key:"getPosition",value:function(e){return e.x}},{key:"setPosition",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;void 0!==i&&this.layout.hierarchical.addToOrdering(e,i),e.x=t}},{key:"getTreeSize",value:function(e){var t=this.layout.hierarchical.getTreeSize(this.layout.body.nodes,e);return{min:t.min_x,max:t.max_x}}},{key:"sort",value:function(e){e.sort(function(e,t){return void 0===e.x||void 0===t.x?0:e.x-t.x})}},{key:"fix",value:function(e,t){e.y=this.layout.options.hierarchical.levelSeparation*t,e.options.fixed.y=!0}},{key:"shift",value:function(e,t){this.layout.body.nodes[e].x+=t}}]),t}(u),c=function(e){function t(e){(0,a.default)(this,t);var i=(0,n.default)(this,(t.__proto__||(0,r.default)(t)).call(this));return i.layout=e,i}return(0,o.default)(t,e),(0,s.default)(t,[{key:"curveType",value:function(){return"vertical"}},{key:"getPosition",value:function(e){return e.y}},{key:"setPosition",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;void 0!==i&&this.layout.hierarchical.addToOrdering(e,i),e.y=t}},{key:"getTreeSize",value:function(e){var t=this.layout.hierarchical.getTreeSize(this.layout.body.nodes,e);return{min:t.min_y,max:t.max_y}}},{key:"sort",value:function(e){e.sort(function(e,t){return void 0===e.y||void 0===t.y?0:e.y-t.y})}},{key:"fix",value:function(e,t){e.x=this.layout.options.hierarchical.levelSeparation*t,e.options.fixed.x=!0}},{key:"shift",value:function(e,t){this.layout.body.nodes[e].y+=t}}]),t}(u);t.HorizontalStrategy=c,t.VerticalStrategy=h},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=l(i(8)),n=l(i(19)),o=l(i(6)),a=l(i(0)),s=l(i(1));function l(e){return e&&e.__esModule?e:{default:e}}var u=i(2),h=i(10),c=i(37),d=function(){function e(t,i,r){var n=this;(0,a.default)(this,e),this.body=t,this.canvas=i,this.selectionHandler=r,this.editMode=!1,this.manipulationDiv=void 0,this.editModeDiv=void 0,this.closeDiv=void 0,this.manipulationHammers=[],this.temporaryUIFunctions={},this.temporaryEventFunctions=[],this.touchTime=0,this.temporaryIds={nodes:[],edges:[]},this.guiEnabled=!1,this.inMode=!1,this.selectedControlNode=void 0,this.options={},this.defaultOptions={enabled:!1,initiallyActive:!1,addNode:!0,addEdge:!0,editNode:void 0,editEdge:!0,deleteNode:!0,deleteEdge:!0,controlNodeStyle:{shape:"dot",size:6,color:{background:"#ff0000",border:"#3c3c3c",highlight:{background:"#07f968",border:"#3c3c3c"}},borderWidth:2,borderWidthSelected:2}},u.extend(this.options,this.defaultOptions),this.body.emitter.on("destroy",function(){n._clean()}),this.body.emitter.on("_dataChanged",this._restore.bind(this)),this.body.emitter.on("_resetData",this._restore.bind(this))}return(0,s.default)(e,[{key:"_restore",value:function(){!1!==this.inMode&&(!0===this.options.initiallyActive?this.enableEditMode():this.disableEditMode())}},{key:"setOptions",value:function(e,t,i){void 0!==t&&(void 0!==t.locale?this.options.locale=t.locale:this.options.locale=i.locale,void 0!==t.locales?this.options.locales=t.locales:this.options.locales=i.locales),void 0!==e&&("boolean"==typeof e?this.options.enabled=e:(this.options.enabled=!0,u.deepExtend(this.options,e)),!0===this.options.initiallyActive&&(this.editMode=!0),this._setup())}},{key:"toggleEditMode",value:function(){!0===this.editMode?this.disableEditMode():this.enableEditMode()}},{key:"enableEditMode",value:function(){this.editMode=!0,this._clean(),!0===this.guiEnabled&&(this.manipulationDiv.style.display="block",this.closeDiv.style.display="block",this.editModeDiv.style.display="none",this.showManipulatorToolbar())}},{key:"disableEditMode",value:function(){this.editMode=!1,this._clean(),!0===this.guiEnabled&&(this.manipulationDiv.style.display="none",this.closeDiv.style.display="none",this.editModeDiv.style.display="block",this._createEditButton())}},{key:"showManipulatorToolbar",value:function(){if(this._clean(),this.manipulationDOM={},!0===this.guiEnabled){this.editMode=!0,this.manipulationDiv.style.display="block",this.closeDiv.style.display="block";var e=this.selectionHandler._getSelectedNodeCount(),t=this.selectionHandler._getSelectedEdgeCount(),i=e+t,r=this.options.locales[this.options.locale],n=!1;!1!==this.options.addNode&&(this._createAddNodeButton(r),n=!0),!1!==this.options.addEdge&&(!0===n?this._createSeperator(1):n=!0,this._createAddEdgeButton(r)),1===e&&"function"==typeof this.options.editNode?(!0===n?this._createSeperator(2):n=!0,this._createEditNodeButton(r)):1===t&&0===e&&!1!==this.options.editEdge&&(!0===n?this._createSeperator(3):n=!0,this._createEditEdgeButton(r)),0!==i&&(e>0&&!1!==this.options.deleteNode?(!0===n&&this._createSeperator(4),this._createDeleteButton(r)):0===e&&!1!==this.options.deleteEdge&&(!0===n&&this._createSeperator(4),this._createDeleteButton(r))),this._bindHammerToDiv(this.closeDiv,this.toggleEditMode.bind(this)),this._temporaryBindEvent("select",this.showManipulatorToolbar.bind(this))}this.body.emitter.emit("_redraw")}},{key:"addNodeMode",value:function(){if(!0!==this.editMode&&this.enableEditMode(),this._clean(),this.inMode="addNode",!0===this.guiEnabled){var e=this.options.locales[this.options.locale];this.manipulationDOM={},this._createBackButton(e),this._createSeperator(),this._createDescription(e.addDescription||this.options.locales.en.addDescription),this._bindHammerToDiv(this.closeDiv,this.toggleEditMode.bind(this))}this._temporaryBindEvent("click",this._performAddNode.bind(this))}},{key:"editNode",value:function(){var e=this;!0!==this.editMode&&this.enableEditMode(),this._clean();var t=this.selectionHandler._getSelectedNode();if(void 0!==t){if(this.inMode="editNode","function"!=typeof this.options.editNode)throw new Error("No function has been configured to handle the editing of nodes.");if(!0!==t.isCluster){var i=u.deepExtend({},t.options,!1);if(i.x=t.x,i.y=t.y,2!==this.options.editNode.length)throw new Error("The function for edit does not support two arguments (data, callback)");this.options.editNode(i,function(t){null!=t&&"editNode"===e.inMode&&e.body.data.nodes.getDataSet().update(t),e.showManipulatorToolbar()})}else alert(this.options.locales[this.options.locale].editClusterError||this.options.locales.en.editClusterError)}else this.showManipulatorToolbar()}},{key:"addEdgeMode",value:function(){if(!0!==this.editMode&&this.enableEditMode(),this._clean(),this.inMode="addEdge",!0===this.guiEnabled){var e=this.options.locales[this.options.locale];this.manipulationDOM={},this._createBackButton(e),this._createSeperator(),this._createDescription(e.edgeDescription||this.options.locales.en.edgeDescription),this._bindHammerToDiv(this.closeDiv,this.toggleEditMode.bind(this))}this._temporaryBindUI("onTouch",this._handleConnect.bind(this)),this._temporaryBindUI("onDragEnd",this._finishConnect.bind(this)),this._temporaryBindUI("onDrag",this._dragControlNode.bind(this)),this._temporaryBindUI("onRelease",this._finishConnect.bind(this)),this._temporaryBindUI("onDragStart",this._dragStartEdge.bind(this)),this._temporaryBindUI("onHold",function(){})}},{key:"editEdgeMode",value:function(){if(!0!==this.editMode&&this.enableEditMode(),this._clean(),this.inMode="editEdge","object"!==(0,o.default)(this.options.editEdge)||"function"!=typeof this.options.editEdge.editWithoutDrag||(this.edgeBeingEditedId=this.selectionHandler.getSelectedEdges()[0],void 0===this.edgeBeingEditedId)){if(!0===this.guiEnabled){var e=this.options.locales[this.options.locale];this.manipulationDOM={},this._createBackButton(e),this._createSeperator(),this._createDescription(e.editEdgeDescription||this.options.locales.en.editEdgeDescription),this._bindHammerToDiv(this.closeDiv,this.toggleEditMode.bind(this))}if(this.edgeBeingEditedId=this.selectionHandler.getSelectedEdges()[0],void 0!==this.edgeBeingEditedId){var t=this.body.edges[this.edgeBeingEditedId],i=this._getNewTargetNode(t.from.x,t.from.y),r=this._getNewTargetNode(t.to.x,t.to.y);this.temporaryIds.nodes.push(i.id),this.temporaryIds.nodes.push(r.id),this.body.nodes[i.id]=i,this.body.nodeIndices.push(i.id),this.body.nodes[r.id]=r,this.body.nodeIndices.push(r.id),this._temporaryBindUI("onTouch",this._controlNodeTouch.bind(this)),this._temporaryBindUI("onTap",function(){}),this._temporaryBindUI("onHold",function(){}),this._temporaryBindUI("onDragStart",this._controlNodeDragStart.bind(this)),this._temporaryBindUI("onDrag",this._controlNodeDrag.bind(this)),this._temporaryBindUI("onDragEnd",this._controlNodeDragEnd.bind(this)),this._temporaryBindUI("onMouseMove",function(){}),this._temporaryBindEvent("beforeDrawing",function(e){var n=t.edgeType.findBorderPositions(e);!1===i.selected&&(i.x=n.from.x,i.y=n.from.y),!1===r.selected&&(r.x=n.to.x,r.y=n.to.y)}),this.body.emitter.emit("_redraw")}else this.showManipulatorToolbar()}else{var n=this.body.edges[this.edgeBeingEditedId];this._performEditEdge(n.from,n.to)}}},{key:"deleteSelected",value:function(){var e=this;!0!==this.editMode&&this.enableEditMode(),this._clean(),this.inMode="delete";var t=this.selectionHandler.getSelectedNodes(),i=this.selectionHandler.getSelectedEdges(),r=void 0;if(t.length>0){for(var n=0;n<t.length;n++)if(!0===this.body.nodes[t[n]].isCluster)return void alert(this.options.locales[this.options.locale].deleteClusterError||this.options.locales.en.deleteClusterError);"function"==typeof this.options.deleteNode&&(r=this.options.deleteNode)}else i.length>0&&"function"==typeof this.options.deleteEdge&&(r=this.options.deleteEdge);if("function"==typeof r){var o={nodes:t,edges:i};if(2!==r.length)throw new Error("The function for delete does not support two arguments (data, callback)");r(o,function(t){null!=t&&"delete"===e.inMode?(e.body.data.edges.getDataSet().remove(t.edges),e.body.data.nodes.getDataSet().remove(t.nodes),e.body.emitter.emit("startSimulation"),e.showManipulatorToolbar()):(e.body.emitter.emit("startSimulation"),e.showManipulatorToolbar())})}else this.body.data.edges.getDataSet().remove(i),this.body.data.nodes.getDataSet().remove(t),this.body.emitter.emit("startSimulation"),this.showManipulatorToolbar()}},{key:"_setup",value:function(){!0===this.options.enabled?(this.guiEnabled=!0,this._createWrappers(),!1===this.editMode?this._createEditButton():this.showManipulatorToolbar()):(this._removeManipulationDOM(),this.guiEnabled=!1)}},{key:"_createWrappers",value:function(){void 0===this.manipulationDiv&&(this.manipulationDiv=document.createElement("div"),this.manipulationDiv.className="vis-manipulation",!0===this.editMode?this.manipulationDiv.style.display="block":this.manipulationDiv.style.display="none",this.canvas.frame.appendChild(this.manipulationDiv)),void 0===this.editModeDiv&&(this.editModeDiv=document.createElement("div"),this.editModeDiv.className="vis-edit-mode",!0===this.editMode?this.editModeDiv.style.display="none":this.editModeDiv.style.display="block",this.canvas.frame.appendChild(this.editModeDiv)),void 0===this.closeDiv&&(this.closeDiv=document.createElement("div"),this.closeDiv.className="vis-close",this.closeDiv.style.display=this.manipulationDiv.style.display,this.canvas.frame.appendChild(this.closeDiv))}},{key:"_getNewTargetNode",value:function(e,t){var i=u.deepExtend({},this.options.controlNodeStyle);i.id="targetNode"+u.randomUUID(),i.hidden=!1,i.physics=!1,i.x=e,i.y=t;var r=this.body.functions.createNode(i);return r.shape.boundingBox={left:e,right:e,top:t,bottom:t},r}},{key:"_createEditButton",value:function(){this._clean(),this.manipulationDOM={},u.recursiveDOMDelete(this.editModeDiv);var e=this.options.locales[this.options.locale],t=this._createButton("editMode","vis-button vis-edit vis-edit-mode",e.edit||this.options.locales.en.edit);this.editModeDiv.appendChild(t),this._bindHammerToDiv(t,this.toggleEditMode.bind(this))}},{key:"_clean",value:function(){this.inMode=!1,!0===this.guiEnabled&&(u.recursiveDOMDelete(this.editModeDiv),u.recursiveDOMDelete(this.manipulationDiv),this._cleanManipulatorHammers()),this._cleanupTemporaryNodesAndEdges(),this._unbindTemporaryUIs(),this._unbindTemporaryEvents(),this.body.emitter.emit("restorePhysics")}},{key:"_cleanManipulatorHammers",value:function(){if(0!=this.manipulationHammers.length){for(var e=0;e<this.manipulationHammers.length;e++)this.manipulationHammers[e].destroy();this.manipulationHammers=[]}}},{key:"_removeManipulationDOM",value:function(){this._clean(),u.recursiveDOMDelete(this.manipulationDiv),u.recursiveDOMDelete(this.editModeDiv),u.recursiveDOMDelete(this.closeDiv),this.manipulationDiv&&this.canvas.frame.removeChild(this.manipulationDiv),this.editModeDiv&&this.canvas.frame.removeChild(this.editModeDiv),this.closeDiv&&this.canvas.frame.removeChild(this.closeDiv),this.manipulationDiv=void 0,this.editModeDiv=void 0,this.closeDiv=void 0}},{key:"_createSeperator",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.manipulationDOM["seperatorLineDiv"+e]=document.createElement("div"),this.manipulationDOM["seperatorLineDiv"+e].className="vis-separator-line",this.manipulationDiv.appendChild(this.manipulationDOM["seperatorLineDiv"+e])}},{key:"_createAddNodeButton",value:function(e){var t=this._createButton("addNode","vis-button vis-add",e.addNode||this.options.locales.en.addNode);this.manipulationDiv.appendChild(t),this._bindHammerToDiv(t,this.addNodeMode.bind(this))}},{key:"_createAddEdgeButton",value:function(e){var t=this._createButton("addEdge","vis-button vis-connect",e.addEdge||this.options.locales.en.addEdge);this.manipulationDiv.appendChild(t),this._bindHammerToDiv(t,this.addEdgeMode.bind(this))}},{key:"_createEditNodeButton",value:function(e){var t=this._createButton("editNode","vis-button vis-edit",e.editNode||this.options.locales.en.editNode);this.manipulationDiv.appendChild(t),this._bindHammerToDiv(t,this.editNode.bind(this))}},{key:"_createEditEdgeButton",value:function(e){var t=this._createButton("editEdge","vis-button vis-edit",e.editEdge||this.options.locales.en.editEdge);this.manipulationDiv.appendChild(t),this._bindHammerToDiv(t,this.editEdgeMode.bind(this))}},{key:"_createDeleteButton",value:function(e){var t;t=this.options.rtl?"vis-button vis-delete-rtl":"vis-button vis-delete";var i=this._createButton("delete",t,e.del||this.options.locales.en.del);this.manipulationDiv.appendChild(i),this._bindHammerToDiv(i,this.deleteSelected.bind(this))}},{key:"_createBackButton",value:function(e){var t=this._createButton("back","vis-button vis-back",e.back||this.options.locales.en.back);this.manipulationDiv.appendChild(t),this._bindHammerToDiv(t,this.showManipulatorToolbar.bind(this))}},{key:"_createButton",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vis-label";return this.manipulationDOM[e+"Div"]=document.createElement("div"),this.manipulationDOM[e+"Div"].className=t,this.manipulationDOM[e+"Label"]=document.createElement("div"),this.manipulationDOM[e+"Label"].className=r,this.manipulationDOM[e+"Label"].innerHTML=i,this.manipulationDOM[e+"Div"].appendChild(this.manipulationDOM[e+"Label"]),this.manipulationDOM[e+"Div"]}},{key:"_createDescription",value:function(e){this.manipulationDiv.appendChild(this._createButton("description","vis-button vis-none",e))}},{key:"_temporaryBindEvent",value:function(e,t){this.temporaryEventFunctions.push({event:e,boundFunction:t}),this.body.emitter.on(e,t)}},{key:"_temporaryBindUI",value:function(e,t){if(void 0===this.body.eventListeners[e])throw new Error("This UI function does not exist. Typo? You tried: "+e+" possible are: "+(0,n.default)((0,r.default)(this.body.eventListeners)));this.temporaryUIFunctions[e]=this.body.eventListeners[e],this.body.eventListeners[e]=t}},{key:"_unbindTemporaryUIs",value:function(){for(var e in this.temporaryUIFunctions)this.temporaryUIFunctions.hasOwnProperty(e)&&(this.body.eventListeners[e]=this.temporaryUIFunctions[e],delete this.temporaryUIFunctions[e]);this.temporaryUIFunctions={}}},{key:"_unbindTemporaryEvents",value:function(){for(var e=0;e<this.temporaryEventFunctions.length;e++){var t=this.temporaryEventFunctions[e].event,i=this.temporaryEventFunctions[e].boundFunction;this.body.emitter.off(t,i)}this.temporaryEventFunctions=[]}},{key:"_bindHammerToDiv",value:function(e,t){var i=new h(e,{});c.onTouch(i,t),this.manipulationHammers.push(i)}},{key:"_cleanupTemporaryNodesAndEdges",value:function(){for(var e=0;e<this.temporaryIds.edges.length;e++){this.body.edges[this.temporaryIds.edges[e]].disconnect(),delete this.body.edges[this.temporaryIds.edges[e]];var t=this.body.edgeIndices.indexOf(this.temporaryIds.edges[e]);-1!==t&&this.body.edgeIndices.splice(t,1)}for(var i=0;i<this.temporaryIds.nodes.length;i++){delete this.body.nodes[this.temporaryIds.nodes[i]];var r=this.body.nodeIndices.indexOf(this.temporaryIds.nodes[i]);-1!==r&&this.body.nodeIndices.splice(r,1)}this.temporaryIds={nodes:[],edges:[]}}},{key:"_controlNodeTouch",value:function(e){this.selectionHandler.unselectAll(),this.lastTouch=this.body.functions.getPointer(e.center),this.lastTouch.translation=u.extend({},this.body.view.translation)}},{key:"_controlNodeDragStart",value:function(e){var t=this.lastTouch,i=this.selectionHandler._pointerToPositionObject(t),r=this.body.nodes[this.temporaryIds.nodes[0]],n=this.body.nodes[this.temporaryIds.nodes[1]],o=this.body.edges[this.edgeBeingEditedId];this.selectedControlNode=void 0;var a=r.isOverlappingWith(i),s=n.isOverlappingWith(i);!0===a?(this.selectedControlNode=r,o.edgeType.from=r):!0===s&&(this.selectedControlNode=n,o.edgeType.to=n),void 0!==this.selectedControlNode&&this.selectionHandler.selectObject(this.selectedControlNode),this.body.emitter.emit("_redraw")}},{key:"_controlNodeDrag",value:function(e){this.body.emitter.emit("disablePhysics");var t=this.body.functions.getPointer(e.center),i=this.canvas.DOMtoCanvas(t);if(void 0!==this.selectedControlNode)this.selectedControlNode.x=i.x,this.selectedControlNode.y=i.y;else{var r=t.x-this.lastTouch.x,n=t.y-this.lastTouch.y;this.body.view.translation={x:this.lastTouch.translation.x+r,y:this.lastTouch.translation.y+n}}this.body.emitter.emit("_redraw")}},{key:"_controlNodeDragEnd",value:function(e){var t=this.body.functions.getPointer(e.center),i=this.selectionHandler._pointerToPositionObject(t),r=this.body.edges[this.edgeBeingEditedId];if(void 0!==this.selectedControlNode){this.selectionHandler.unselectAll();for(var n=this.selectionHandler._getAllNodesOverlappingWith(i),o=void 0,a=n.length-1;a>=0;a--)if(n[a]!==this.selectedControlNode.id){o=this.body.nodes[n[a]];break}if(void 0!==o&&void 0!==this.selectedControlNode)if(!0===o.isCluster)alert(this.options.locales[this.options.locale].createEdgeError||this.options.locales.en.createEdgeError);else{var s=this.body.nodes[this.temporaryIds.nodes[0]];this.selectedControlNode.id===s.id?this._performEditEdge(o.id,r.to.id):this._performEditEdge(r.from.id,o.id)}else r.updateEdgeType(),this.body.emitter.emit("restorePhysics");this.body.emitter.emit("_redraw")}}},{key:"_handleConnect",value:function(e){if((new Date).valueOf()-this.touchTime>100){this.lastTouch=this.body.functions.getPointer(e.center),this.lastTouch.translation=u.extend({},this.body.view.translation);var t=this.lastTouch,i=this.selectionHandler.getNodeAt(t);if(void 0!==i)if(!0===i.isCluster)alert(this.options.locales[this.options.locale].createEdgeError||this.options.locales.en.createEdgeError);else{var r=this._getNewTargetNode(i.x,i.y);this.body.nodes[r.id]=r,this.body.nodeIndices.push(r.id);var n=this.body.functions.createEdge({id:"connectionEdge"+u.randomUUID(),from:i.id,to:r.id,physics:!1,smooth:{enabled:!0,type:"continuous",roundness:.5}});this.body.edges[n.id]=n,this.body.edgeIndices.push(n.id),this.temporaryIds.nodes.push(r.id),this.temporaryIds.edges.push(n.id)}this.touchTime=(new Date).valueOf()}}},{key:"_dragControlNode",value:function(e){var t=this.body.functions.getPointer(e.center);if(void 0!==this.temporaryIds.nodes[0]){var i=this.body.nodes[this.temporaryIds.nodes[0]];i.x=this.canvas._XconvertDOMtoCanvas(t.x),i.y=this.canvas._YconvertDOMtoCanvas(t.y),this.body.emitter.emit("_redraw")}else{var r=t.x-this.lastTouch.x,n=t.y-this.lastTouch.y;this.body.view.translation={x:this.lastTouch.translation.x+r,y:this.lastTouch.translation.y+n}}}},{key:"_finishConnect",value:function(e){var t=this.body.functions.getPointer(e.center),i=this.selectionHandler._pointerToPositionObject(t),r=void 0;void 0!==this.temporaryIds.edges[0]&&(r=this.body.edges[this.temporaryIds.edges[0]].fromId);for(var n=this.selectionHandler._getAllNodesOverlappingWith(i),o=void 0,a=n.length-1;a>=0;a--)if(-1===this.temporaryIds.nodes.indexOf(n[a])){o=this.body.nodes[n[a]];break}this._cleanupTemporaryNodesAndEdges(),void 0!==o&&(!0===o.isCluster?alert(this.options.locales[this.options.locale].createEdgeError||this.options.locales.en.createEdgeError):void 0!==this.body.nodes[r]&&void 0!==this.body.nodes[o.id]&&this._performAddEdge(r,o.id)),this.body.emitter.emit("_redraw")}},{key:"_dragStartEdge",value:function(e){var t=this.lastTouch;this.selectionHandler._generateClickEvent("dragStart",e,t,void 0,!0)}},{key:"_performAddNode",value:function(e){var t=this,i={id:u.randomUUID(),x:e.pointer.canvas.x,y:e.pointer.canvas.y,label:"new"};if("function"==typeof this.options.addNode){if(2!==this.options.addNode.length)throw this.showManipulatorToolbar(),new Error("The function for add does not support two arguments (data,callback)");this.options.addNode(i,function(e){null!=e&&"addNode"===t.inMode&&(t.body.data.nodes.getDataSet().add(e),t.showManipulatorToolbar())})}else this.body.data.nodes.getDataSet().add(i),this.showManipulatorToolbar()}},{key:"_performAddEdge",value:function(e,t){var i=this,r={from:e,to:t};if("function"==typeof this.options.addEdge){if(2!==this.options.addEdge.length)throw new Error("The function for connect does not support two arguments (data,callback)");this.options.addEdge(r,function(e){null!=e&&"addEdge"===i.inMode&&(i.body.data.edges.getDataSet().add(e),i.selectionHandler.unselectAll(),i.showManipulatorToolbar())})}else this.body.data.edges.getDataSet().add(r),this.selectionHandler.unselectAll(),this.showManipulatorToolbar()}},{key:"_performEditEdge",value:function(e,t){var i=this,r={id:this.edgeBeingEditedId,from:e,to:t,label:this.body.data.edges._data[this.edgeBeingEditedId].label},n=this.options.editEdge;if("object"===(void 0===n?"undefined":(0,o.default)(n))&&(n=n.editWithoutDrag),"function"==typeof n){if(2!==n.length)throw new Error("The function for edit does not support two arguments (data, callback)");n(r,function(e){null==e||"editEdge"!==i.inMode?(i.body.edges[r.id].updateEdgeType(),i.body.emitter.emit("_redraw"),i.showManipulatorToolbar()):(i.body.data.edges.getDataSet().update(e),i.selectionHandler.unselectAll(),i.showManipulatorToolbar())})}else this.body.data.edges.getDataSet().update(r),this.selectionHandler.unselectAll(),this.showManipulatorToolbar()}}]),e}();t.default=d},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=s(i(30)),n=s(i(0)),o=s(i(1)),a=s(i(239));function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(t,i,r){(0,n.default)(this,e),this.body=t,this.springLength=i,this.springConstant=r,this.distanceSolver=new a.default}return(0,o.default)(e,[{key:"setOptions",value:function(e){e&&(e.springLength&&(this.springLength=e.springLength),e.springConstant&&(this.springConstant=e.springConstant))}},{key:"solve",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.distanceSolver.getDistances(this.body,e,t);this._createL_matrix(n),this._createK_matrix(n),this._createE_matrix();for(var o=0,a=Math.max(1e3,Math.min(10*this.body.nodeIndices.length,6e3)),s=1e9,l=0,u=0,h=0,c=0,d=0;s>.01&&o<a;){o+=1;var p=this._getHighestEnergyNode(i),f=(0,r.default)(p,4);for(l=f[0],s=f[1],u=f[2],h=f[3],c=s,d=0;c>1&&d<5;){d+=1,this._moveNode(l,u,h);var m=this._getEnergy(l),v=(0,r.default)(m,3);c=v[0],u=v[1],h=v[2]}}}},{key:"_getHighestEnergyNode",value:function(e){for(var t=this.body.nodeIndices,i=this.body.nodes,n=0,o=t[0],a=0,s=0,l=0;l<t.length;l++){var u=t[l];if(!1===i[u].predefinedPosition||!0===i[u].isCluster&&!0===e||!0===i[u].options.fixed.x||!0===i[u].options.fixed.y){var h=this._getEnergy(u),c=(0,r.default)(h,3),d=c[0],p=c[1],f=c[2];n<d&&(n=d,o=u,a=p,s=f)}}return[o,n,a,s]}},{key:"_getEnergy",value:function(e){var t=(0,r.default)(this.E_sums[e],2),i=t[0],n=t[1];return[Math.sqrt(Math.pow(i,2)+Math.pow(n,2)),i,n]}},{key:"_moveNode",value:function(e,t,i){for(var r=this.body.nodeIndices,n=this.body.nodes,o=0,a=0,s=0,l=n[e].x,u=n[e].y,h=this.K_matrix[e],c=this.L_matrix[e],d=0;d<r.length;d++){var p=r[d];if(p!==e){var f=n[p].x,m=n[p].y,v=h[p],g=c[p],y=1/Math.pow(Math.pow(l-f,2)+Math.pow(u-m,2),1.5);o+=v*(1-g*Math.pow(u-m,2)*y),a+=v*(g*(l-f)*(u-m)*y),s+=v*(1-g*Math.pow(l-f,2)*y)}}var _=(t/o+i/a)/(a/o-s/a),b=-(a*_+t)/o;n[e].x+=b,n[e].y+=_,this._updateE_matrix(e)}},{key:"_createL_matrix",value:function(e){var t=this.body.nodeIndices,i=this.springLength;this.L_matrix=[];for(var r=0;r<t.length;r++){this.L_matrix[t[r]]={};for(var n=0;n<t.length;n++)this.L_matrix[t[r]][t[n]]=i*e[t[r]][t[n]]}}},{key:"_createK_matrix",value:function(e){var t=this.body.nodeIndices,i=this.springConstant;this.K_matrix=[];for(var r=0;r<t.length;r++){this.K_matrix[t[r]]={};for(var n=0;n<t.length;n++)this.K_matrix[t[r]][t[n]]=i*Math.pow(e[t[r]][t[n]],-2)}}},{key:"_createE_matrix",value:function(){var e=this.body.nodeIndices,t=this.body.nodes;this.E_matrix={},this.E_sums={};for(var i=0;i<e.length;i++)this.E_matrix[e[i]]=[];for(var r=0;r<e.length;r++){for(var n=e[r],o=t[n].x,a=t[n].y,s=0,l=0,u=r;u<e.length;u++){var h=e[u];if(h!==n){var c=t[h].x,d=t[h].y,p=1/Math.sqrt(Math.pow(o-c,2)+Math.pow(a-d,2));this.E_matrix[n][u]=[this.K_matrix[n][h]*(o-c-this.L_matrix[n][h]*(o-c)*p),this.K_matrix[n][h]*(a-d-this.L_matrix[n][h]*(a-d)*p)],this.E_matrix[h][r]=this.E_matrix[n][u],s+=this.E_matrix[n][u][0],l+=this.E_matrix[n][u][1]}}this.E_sums[n]=[s,l]}}},{key:"_updateE_matrix",value:function(e){for(var t=this.body.nodeIndices,i=this.body.nodes,r=this.E_matrix[e],n=this.K_matrix[e],o=this.L_matrix[e],a=i[e].x,s=i[e].y,l=0,u=0,h=0;h<t.length;h++){var c=t[h];if(c!==e){var d=r[h],p=d[0],f=d[1],m=i[c].x,v=i[c].y,g=1/Math.sqrt(Math.pow(a-m,2)+Math.pow(s-v,2)),y=n[c]*(a-m-o[c]*(a-m)*g),_=n[c]*(s-v-o[c]*(s-v)*g);r[h]=[y,_],l+=y,u+=_;var b=this.E_sums[c];b[0]+=y-p,b[1]+=_-f}}this.E_sums[e]=[l,u]}}]),e}();t.default=l},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var r=o(i(0)),n=o(i(1));function o(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(){(0,r.default)(this,e)}return(0,n.default)(e,[{key:"getDistances",value:function(e,t,i){for(var r={},n=e.edges,o=0;o<t.length;o++){var a={};r[t[o]]=a;for(var s=0;s<t.length;s++)a[t[s]]=o==s?0:1e9}for(var l=0;l<i.length;l++){var u=n[i[l]];!0===u.connected&&void 0!==r[u.fromId]&&void 0!==r[u.toId]&&(r[u.fromId][u.toId]=1,r[u.toId][u.fromId]=1)}for(var h=t.length,c=0;c<h;c++)for(var d=t[c],p=r[d],f=0;f<h-1;f++)for(var m=t[f],v=r[m],g=f+1;g<h;g++){var y=t[g],_=r[y],b=Math.min(v[y],v[d]+p[y]);v[y]=b,_[m]=b}return r}}]),e}();t.default=a}])},e.exports=r()},function(e,t,i){for(var r=i(239),n=[],o={},a=0;a<256;a++)n[a]=(a+256).toString(16).substr(1),o[n[a]]=a;function s(e,t){var i=t||0,r=n;return r[e[i++]]+r[e[i++]]+r[e[i++]]+r[e[i++]]+"-"+r[e[i++]]+r[e[i++]]+"-"+r[e[i++]]+r[e[i++]]+"-"+r[e[i++]]+r[e[i++]]+"-"+r[e[i++]]+r[e[i++]]+r[e[i++]]+r[e[i++]]+r[e[i++]]+r[e[i++]]}var l=r(),u=[1|l[0],l[1],l[2],l[3],l[4],l[5]],h=16383&(l[6]<<8|l[7]),c=0,d=0;function p(e,t,i){var n=t&&i||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||r)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var a=0;a<16;a++)t[n+a]=o[a];return t||s(o)}var f=p;f.v1=function(e,t,i){var r=t&&i||0,n=t||[],o=void 0!==(e=e||{}).clockseq?e.clockseq:h,a=void 0!==e.msecs?e.msecs:(new Date).getTime(),l=void 0!==e.nsecs?e.nsecs:d+1,p=a-c+(l-d)/1e4;if(p<0&&void 0===e.clockseq&&(o=o+1&16383),(p<0||a>c)&&void 0===e.nsecs&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");c=a,d=l,h=o;var f=(1e4*(268435455&(a+=122192928e5))+l)%4294967296;n[r++]=f>>>24&255,n[r++]=f>>>16&255,n[r++]=f>>>8&255,n[r++]=255&f;var m=a/4294967296*1e4&268435455;n[r++]=m>>>8&255,n[r++]=255&m,n[r++]=m>>>24&15|16,n[r++]=m>>>16&255,n[r++]=o>>>8|128,n[r++]=255&o;for(var v=e.node||u,g=0;g<6;g++)n[r+g]=v[g];return t||s(n)},f.v4=p,f.parse=function(e,t,i){var r=t&&i||0,n=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){n<16&&(t[r+n++]=o[e])});n<16;)t[r+n++]=0;return t},f.unparse=s,e.exports=f},function(e,t,i){(function(t){var i,r=t.crypto||t.msCrypto;if(r&&r.getRandomValues){var n=new Uint8Array(16);i=function(){return r.getRandomValues(n),n}}if(!i){var o=new Array(16);i=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}e.exports=i}).call(this,i(59))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=i(30),o=l(n),a=l(i(31)),s=l(i(241));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.Component),r(t,[{key:"componentDidMount",value:function(){this.scene=new s.default(this.props.data,this.mount,this.props.settings),this.scene.toggleVisibility(this.props.toggleVisibility)}},{key:"componentWillUpdate",value:function(e,t){e.downloadRequest!==this.props.downloadRequest&&this.scene.download(e.downloadRequest.filename,e.downloadRequest.filetype),e.data!==this.props.data&&(this.scene.addToScene(e.data),this.scene.toggleVisibility(this.props.toggleVisibility)),e.toggleVisibility!==this.props.toggleVisibility&&this.scene.toggleVisibility(e.toggleVisibility)}},{key:"componentWillUnmount",value:function(){this.scene.stop(),this.mount.removeChild(this.scene.renderer.domElement)}},{key:"render",value:function(){var e=this,t=this.props.id;return o.default.createElement("div",{id:t,style:{width:"100%",height:"100%"},ref:function(t){e.mount=t}})}}]),t}();t.default=u,u.propTypes={id:a.default.string,data:a.default.object,settings:a.default.object,toggleVisibility:a.default.object,downloadRequest:a.default.object,setProps:a.default.func}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(242));function o(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var a=function(){function e(t,i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.animate=this.animate.bind(this);this.settings=Object.assign({shadows:!0,antialias:!0,transparent_background:!0,sphereSegments:32,cylinderSegments:8,staticScene:!0,sphereScale:1,cylinderScale:1,defaultSurfaceOpacity:.5,lights:[{type:"HemisphereLight",args:["#ffffff","#202020",1]}],material:{type:"MeshStandardMaterial",parameters:{roughness:.2,metalness:0}}},r);var o=i.clientWidth,a=i.clientHeight,s=new n.WebGLRenderer({antialias:this.settings.antialias,alpha:this.settings.transparent_background,gammaInput:!0,gammaOutput:!0,gammaFactor:2.2,shadowMapEnabled:this.settings.shadows,shadowMapType:n.PCFSoftShadowMap});this.renderer=s,s.setPixelRatio(window.devicePixelRatio),s.setClearColor(16777215,0),s.setSize(o,a),i.appendChild(s.domElement);var l=new n.Scene;this.scene=l;var u=new n.OrthographicCamera(o/-2,o/2,a/2,a/-2,-2e3,2e3);u.position.z=2,this.camera=u,l.add(u),this.addToScene(t);var h=this.makeLights(this.settings.lights);u.add(h);var c=new n.OrbitControls(this.camera,this.renderer.domElement);function d(){s.render(l,u)}c.enableKeys=!1,c.minZoom=2,c.maxZoom=100,c.enablePan=!1,d(),this.settings.staticScene?c.addEventListener("change",d):this.start(),window.addEventListener("resize",function(){var e=s.domElement,t=0|e.parentElement.clientWidth,i=0|e.parentElement.clientHeight;e.width===t&&e.height===i||s.setSize(t,i,!0),s.render(l,u)},!1)}return r(e,[{key:"download",value:function(e,t){switch(t){case"png":this.downloadScreenshot(e);break;default:throw new Error("Unknown filetype.")}}},{key:"downloadScreenshot",value:function(e){var t=document.createElement("a");t.style.display="none",document.body.appendChild(t),this.renderScene(),t.href=this.renderer.domElement.toDataURL("image/png"),t.download=e||"screenshot.png",t.click()}},{key:"addToScene",value:function(t){e.removeObjectByName(this.scene,t.name);var i=new n.Object3D;i.name=t.name,function e(t,i,r){t.contents.forEach(function(t){if(t.hasOwnProperty("type"))i.add(r.makeObject(t));else{var o=new n.Object3D;o.name=t.name,i.add(o),e(t,o,r)}})}(t,i,this),this.scene.add(i);var r=new n.Box3;r.setFromObject(i);var o=this.renderer.domElement.clientWidth,a=this.renderer.domElement.clientHeight;this.camera.zoom=.8*Math.min(o/(r.max.x-r.min.x),a/(r.max.y-r.min.y)),this.camera.updateProjectionMatrix(),this.camera.updateMatrix(),this.renderScene()}},{key:"makeLights",value:function(e){var t=new n.Object3D;return t.name="lights",e.forEach(function(e){switch(e.type){case"DirectionalLight":var i=new(Function.prototype.bind.apply(n.DirectionalLight,[null].concat(o(e.args))));if(e.helper){var r=new n.DirectionalLightHelper(i,5,"#444444");i.add(r)}break;case"AmbientLight":i=new(Function.prototype.bind.apply(n.AmbientLight,[null].concat(o(e.args))));break;case"HemisphereLight":i=new(Function.prototype.bind.apply(n.HemisphereLight,[null].concat(o(e.args))));break;default:throw new Error("Unknown light.")}var a;e.hasOwnProperty("position")&&(a=i.position).set.apply(a,o(e.position));t.add(i)}),t}},{key:"makeObject",value:function(e){var t=new n.Object3D;switch(t.name=e.name,e.visible&&(t.visible=e.visible),e.type){case"spheres":var i=new n.SphereBufferGeometry(e.radius*this.settings.sphereScale,this.settings.sphereSegments,this.settings.sphereSegments,e.phiStart||0,e.phiEnd||2*Math.PI),r=this.makeMaterial(e.color),a=[];if(e.positions.forEach(function(e){var t,s=new n.Mesh(i,r);(t=s.position).set.apply(t,o(e)),a.push(s)}),e.ellipsoids){var s=new n.Vector3(0,0,1),l=new n.Quaternion;e.ellipsoids.rotations.forEach(function(e,t){var i=new(Function.prototype.bind.apply(n.Vector3,[null].concat(o(e))));l.setFromUnitVectors(s,i.normalize()),a[t].setRotationFromQuaternion(l)}),e.ellipsoids.scales.forEach(function(e,t){var i;(i=a[t].scale).set.apply(i,o(e))})}return a.forEach(function(e){t.add(e)}),t;case"cylinders":var u=e.radius||1,h=new n.CylinderBufferGeometry(u*this.settings.cylinderScale,u*this.settings.cylinderScale,1,this.settings.cylinderSegments),c=this.makeMaterial(e.color),d=new n.Vector3(0,1,0),p=new n.Quaternion;return e.positionPairs.forEach(function(e){var i=new n.Mesh(h,c),r=new(Function.prototype.bind.apply(n.Vector3,[null].concat(o(e[0])))),a=(new(Function.prototype.bind.apply(n.Vector3,[null].concat(o(e[1]))))).sub(r);i.scale.y=a.length();var s=r.add(a.clone().multiplyScalar(.5));i.position.set(s.x,s.y,s.z),p.setFromUnitVectors(d,a.normalize()),i.setRotationFromQuaternion(p),t.add(i)}),t;case"cubes":var f=new n.BoxBufferGeometry(e.width*this.settings.sphereScale,e.width*this.settings.sphereScale,e.width*this.settings.sphereScale),m=this.makeMaterial(e.color);return e.positions.forEach(function(e){var i,r=new n.Mesh(f,m);(i=r.position).set.apply(i,o(e)),t.add(r)}),t;case"lines":var v=new n.Float32BufferAttribute([].concat.apply([],e.positions),3),g=new n.BufferGeometry;g.addAttribute("position",v);var y=void 0;y=e.dashSize||e.scale||e.gapSize?new n.LineDashedMaterial({color:e.color||"#000000",linewidth:e.line_width||1,scale:e.scale||1,dashSize:e.dashSize||3,gapSize:e.gapSize||1}):new n.LineBasicMaterial({color:e.color||"#2c3c54",linewidth:e.line_width||1});var _=new n.LineSegments(g,y);return(e.dashSize||e.scale||e.gapSize)&&_.computeLineDistances(),t.add(_),t;case"surface":var b=new n.Float32BufferAttribute([].concat.apply([],e.positions),3),x=new n.BufferGeometry;x.addAttribute("position",b);var w=e.opacity||this.settings.defaultSurfaceOpacity,S=this.makeMaterial(e.color,w);if(e.normals){var M=new n.Float32BufferAttribute([].concat.apply([],e.normals),3);x.addAttribute("normal",M)}else x.computeFaceNormals(),S.side=n.DoubleSide;w&&(S.transparent=!0,S.depthWrite=!1);var T=new n.Mesh(x,S);return t.add(T),t;case"convex":var A=e.positions.map(function(e){return new(Function.prototype.bind.apply(n.Vector3,[null].concat(o(e))))}),C=new n.ConvexBufferGeometry(A),L=e.opacity||this.settings.defaultSurfaceOpacity,N=this.makeMaterial(e.color,L);L&&(N.transparent=!0,N.depthWrite=!1);var P=new n.Mesh(C,N);t.add(P);var k=new n.EdgesGeometry(C),E=new n.LineSegments(k,new n.LineBasicMaterial({color:e.color}));return t.add(E),t;case"arrows":var D=e.radius||1,O=e.headLength||2,R=e.headWidth||2,F=new n.CylinderBufferGeometry(D*this.settings.cylinderScale,D*this.settings.cylinderScale,1,this.settings.cylinderSegments),I=new n.ConeBufferGeometry(R*this.settings.cylinderScale,O*this.settings.cylinderScale,this.settings.cylinderSegments),B=this.makeMaterial(e.color),U=new n.Vector3(0,1,0),V=(new n.Vector3(0,0,1),new n.Quaternion),z=new n.Quaternion;return e.positionPairs.forEach(function(e){var i=new n.Mesh(F,B),r=new(Function.prototype.bind.apply(n.Vector3,[null].concat(o(e[0])))),a=new(Function.prototype.bind.apply(n.Vector3,[null].concat(o(e[1])))),s=new(Function.prototype.bind.apply(n.Vector3,[null].concat(o(e[1])))),l=a.sub(r);i.scale.y=l.length();var u=r.add(l.clone().multiplyScalar(.5));i.position.set(u.x,u.y,u.z),V.setFromUnitVectors(U,l.normalize()),i.setRotationFromQuaternion(V),t.add(i);var h=new n.Mesh(I,B);h.position.set(s.x,s.y,s.z),z.setFromUnitVectors(U,l.normalize()),h.setRotationFromQuaternion(z),t.add(h)}),t;case"labels":default:return t}}},{key:"makeMaterial",value:function(e,t){var i=Object.assign(this.settings.material.parameters,{color:e||"#52afb0",opacity:t||1});switch(this.settings.material.type){case"MeshStandardMaterial":return new n.MeshStandardMaterial(i);default:throw new Error("Unknown material.")}}},{key:"start",value:function(){this.frameId||(this.frameId=requestAnimationFrame(this.animate))}},{key:"stop",value:function(){cancelAnimationFrame(this.frameId)}},{key:"animate",value:function(){this.renderScene(),this.frameId=window.requestAnimationFrame(this.animate)}},{key:"renderScene",value:function(){this.renderer.render(this.scene,this.camera)}},{key:"toggleVisibility",value:function(e){if(void 0!==e)for(var t in e)if(e.hasOwnProperty(t)){var i=this.scene.getObjectByName(t);void 0!==i&&(i.visible=Boolean(e[t]))}this.renderScene()}}],[{key:"removeObjectByName",value:function(e,t){var i=e.getObjectByName(t);void 0!==i&&e.remove(i)}}]),e}();t.default=a},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"CCDIKSolver",function(){return CCDIKSolver}),__webpack_require__.d(__webpack_exports__,"MMDAnimationHelper",function(){return MMDAnimationHelper}),__webpack_require__.d(__webpack_exports__,"MMDPhysics",function(){return MMDPhysics}),__webpack_require__.d(__webpack_exports__,"AnimationClipCreator",function(){return AnimationClipCreator}),__webpack_require__.d(__webpack_exports__,"CinematicCamera",function(){return CinematicCamera}),__webpack_require__.d(__webpack_exports__,"Car",function(){return Car}),__webpack_require__.d(__webpack_exports__,"DeviceOrientationControls",function(){return DeviceOrientationControls}),__webpack_require__.d(__webpack_exports__,"DragControls",function(){return DragControls}),__webpack_require__.d(__webpack_exports__,"EditorControls",function(){return EditorControls}),__webpack_require__.d(__webpack_exports__,"FirstPersonControls",function(){return FirstPersonControls}),__webpack_require__.d(__webpack_exports__,"FlyControls",function(){return FlyControls}),__webpack_require__.d(__webpack_exports__,"MapControls",function(){return MapControls}),__webpack_require__.d(__webpack_exports__,"OrbitControls",function(){return OrbitControls}),__webpack_require__.d(__webpack_exports__,"OrthographicTrackballControls",function(){return OrthographicTrackballControls}),__webpack_require__.d(__webpack_exports__,"PointerLockControls",function(){return PointerLockControls}),__webpack_require__.d(__webpack_exports__,"TrackballControls",function(){return TrackballControls}),__webpack_require__.d(__webpack_exports__,"TransformControls",function(){return TransformControls}),__webpack_require__.d(__webpack_exports__,"TransformControlsGizmo",function(){return TransformControlsGizmo}),__webpack_require__.d(__webpack_exports__,"TransformControlsPlane",function(){return TransformControlsPlane}),__webpack_require__.d(__webpack_exports__,"ConvexObjectBreaker",function(){return ConvexObjectBreaker}),__webpack_require__.d(__webpack_exports__,"GrannyKnot",function(){return GrannyKnot}),__webpack_require__.d(__webpack_exports__,"HeartCurve",function(){return HeartCurve}),__webpack_require__.d(__webpack_exports__,"VivianiCurve",function(){return VivianiCurve}),__webpack_require__.d(__webpack_exports__,"KnotCurve",function(){return KnotCurve}),__webpack_require__.d(__webpack_exports__,"HelixCurve",function(){return HelixCurve}),__webpack_require__.d(__webpack_exports__,"TrefoilKnot",function(){return TrefoilKnot}),__webpack_require__.d(__webpack_exports__,"TorusKnot",function(){return TorusKnot}),__webpack_require__.d(__webpack_exports__,"CinquefoilKnot",function(){return CinquefoilKnot}),__webpack_require__.d(__webpack_exports__,"TrefoilPolynomialKnot",function(){return TrefoilPolynomialKnot}),__webpack_require__.d(__webpack_exports__,"FigureEightPolynomialKnot",function(){return FigureEightPolynomialKnot}),__webpack_require__.d(__webpack_exports__,"DecoratedTorusKnot4a",function(){return DecoratedTorusKnot4a}),__webpack_require__.d(__webpack_exports__,"DecoratedTorusKnot4b",function(){return DecoratedTorusKnot4b}),__webpack_require__.d(__webpack_exports__,"DecoratedTorusKnot5a",function(){return DecoratedTorusKnot5a}),__webpack_require__.d(__webpack_exports__,"DecoratedTorusKnot5c",function(){return DecoratedTorusKnot5c}),__webpack_require__.d(__webpack_exports__,"NURBSCurve",function(){return NURBSCurve}),__webpack_require__.d(__webpack_exports__,"NURBSSurface",function(){return NURBSSurface}),__webpack_require__.d(__webpack_exports__,"NURBSUtils",function(){return NURBSUtils}),__webpack_require__.d(__webpack_exports__,"AnaglyphEffect",function(){return AnaglyphEffect}),__webpack_require__.d(__webpack_exports__,"AsciiEffect",function(){return AsciiEffect}),__webpack_require__.d(__webpack_exports__,"OutlineEffect",function(){return OutlineEffect}),__webpack_require__.d(__webpack_exports__,"ParallaxBarrierEffect",function(){return ParallaxBarrierEffect}),__webpack_require__.d(__webpack_exports__,"PeppersGhostEffect",function(){return PeppersGhostEffect}),__webpack_require__.d(__webpack_exports__,"StereoEffect",function(){return StereoEffect}),__webpack_require__.d(__webpack_exports__,"ColladaExporter",function(){return ColladaExporter}),__webpack_require__.d(__webpack_exports__,"GLTFExporter",function(){return GLTFExporter}),__webpack_require__.d(__webpack_exports__,"MMDExporter",function(){return MMDExporter}),__webpack_require__.d(__webpack_exports__,"OBJExporter",function(){return OBJExporter}),__webpack_require__.d(__webpack_exports__,"PLYExporter",function(){return PLYExporter}),__webpack_require__.d(__webpack_exports__,"STLExporter",function(){return STLExporter}),__webpack_require__.d(__webpack_exports__,"TypedGeometryExporter",function(){return TypedGeometryExporter}),__webpack_require__.d(__webpack_exports__,"BoxLineGeometry",function(){return BoxLineGeometry}),__webpack_require__.d(__webpack_exports__,"ConvexGeometry",function(){return ConvexGeometry}),__webpack_require__.d(__webpack_exports__,"ConvexBufferGeometry",function(){return ConvexBufferGeometry}),__webpack_require__.d(__webpack_exports__,"DecalGeometry",function(){return DecalGeometry}),__webpack_require__.d(__webpack_exports__,"hilbert2D",function(){return hilbert2D}),__webpack_require__.d(__webpack_exports__,"hilbert3D",function(){return hilbert3D}),__webpack_require__.d(__webpack_exports__,"LightningStrike",function(){return LightningStrike}),__webpack_require__.d(__webpack_exports__,"TeapotBufferGeometry",function(){return TeapotBufferGeometry}),__webpack_require__.d(__webpack_exports__,"GPUComputationRenderer",function(){return GPUComputationRenderer}),__webpack_require__.d(__webpack_exports__,"GPUParticleSystem",function(){return GPUParticleSystem}),__webpack_require__.d(__webpack_exports__,"GPUParticleContainer",function(){return GPUParticleContainer}),__webpack_require__.d(__webpack_exports__,"Gyroscope",function(){return Gyroscope}),__webpack_require__.d(__webpack_exports__,"ImprovedNoise",function(){return ImprovedNoise}),__webpack_require__.d(__webpack_exports__,"SelectionBox",function(){return SelectionBox}),__webpack_require__.d(__webpack_exports__,"SelectionHelper",function(){return SelectionHelper}),__webpack_require__.d(__webpack_exports__,"Line2",function(){return Line2}),__webpack_require__.d(__webpack_exports__,"LineGeometry",function(){return LineGeometry}),__webpack_require__.d(__webpack_exports__,"LineMaterial",function(){return LineMaterial}),__webpack_require__.d(__webpack_exports__,"LineSegments2",function(){return LineSegments2}),__webpack_require__.d(__webpack_exports__,"LineSegmentsGeometry",function(){return LineSegmentsGeometry}),__webpack_require__.d(__webpack_exports__,"Wireframe",function(){return Wireframe}),__webpack_require__.d(__webpack_exports__,"WireframeGeometry2",function(){return WireframeGeometry2}),__webpack_require__.d(__webpack_exports__,"ThreeMFLoader",function(){return ThreeMFLoader}),__webpack_require__.d(__webpack_exports__,"AMFLoader",function(){return AMFLoader}),__webpack_require__.d(__webpack_exports__,"AssimpJSONLoader",function(){return AssimpJSONLoader}),__webpack_require__.d(__webpack_exports__,"AssimpLoader",function(){return AssimpLoader}),__webpack_require__.d(__webpack_exports__,"AWDLoader",function(){return AWDLoader}),__webpack_require__.d(__webpack_exports__,"BabylonLoader",function(){return BabylonLoader}),__webpack_require__.d(__webpack_exports__,"BVHLoader",function(){return BVHLoader}),__webpack_require__.d(__webpack_exports__,"ColladaLoader",function(){return ColladaLoader}),__webpack_require__.d(__webpack_exports__,"DDSLoader",function(){return DDSLoader}),__webpack_require__.d(__webpack_exports__,"LegacyGLTFLoader",function(){return LegacyGLTFLoader}),__webpack_require__.d(__webpack_exports__,"LegacyJSONLoader",function(){return LegacyJSONLoader}),__webpack_require__.d(__webpack_exports__,"DRACOLoader",function(){return DRACOLoader$1}),__webpack_require__.d(__webpack_exports__,"CubemapGenerator",function(){return CubemapGenerator}),__webpack_require__.d(__webpack_exports__,"EXRLoader",function(){return EXRLoader}),__webpack_require__.d(__webpack_exports__,"FBXLoader",function(){return FBXLoader}),__webpack_require__.d(__webpack_exports__,"GCodeLoader",function(){return GCodeLoader}),__webpack_require__.d(__webpack_exports__,"GLTFLoader",function(){return GLTFLoader}),__webpack_require__.d(__webpack_exports__,"HDRCubeTextureLoader",function(){return HDRCubeTextureLoader}),__webpack_require__.d(__webpack_exports__,"KMZLoader",function(){return KMZLoader}),__webpack_require__.d(__webpack_exports__,"KTXLoader",function(){return KTXLoader}),__webpack_require__.d(__webpack_exports__,"LDrawLoader",function(){return LDrawLoader}),__webpack_require__.d(__webpack_exports__,"LoaderSupport",function(){return LoaderSupport}),__webpack_require__.d(__webpack_exports__,"MD2Loader",function(){return MD2Loader}),__webpack_require__.d(__webpack_exports__,"MMDLoader",function(){return MMDLoader}),__webpack_require__.d(__webpack_exports__,"MTLLoader",function(){return MTLLoader}),__webpack_require__.d(__webpack_exports__,"NodeMaterialLoader",function(){return NodeMaterialLoader}),__webpack_require__.d(__webpack_exports__,"OBJLoader",function(){return OBJLoader}),__webpack_require__.d(__webpack_exports__,"OBJLoader2",function(){return OBJLoader2}),__webpack_require__.d(__webpack_exports__,"PCDLoader",function(){return PCDLoader}),__webpack_require__.d(__webpack_exports__,"PDBLoader",function(){return PDBLoader}),__webpack_require__.d(__webpack_exports__,"PlayCanvasLoader",function(){return PlayCanvasLoader}),__webpack_require__.d(__webpack_exports__,"PLYLoader",function(){return PLYLoader}),__webpack_require__.d(__webpack_exports__,"PRWMLoader",function(){return PRWMLoader}),__webpack_require__.d(__webpack_exports__,"PVRLoader",function(){return PVRLoader}),__webpack_require__.d(__webpack_exports__,"HDRLoader",function(){return HDRLoader}),__webpack_require__.d(__webpack_exports__,"RGBELoader",function(){return RGBELoader}),__webpack_require__.d(__webpack_exports__,"STLLoader",function(){return STLLoader}),__webpack_require__.d(__webpack_exports__,"SVGLoader",function(){return SVGLoader}),__webpack_require__.d(__webpack_exports__,"TDSLoader",function(){return TDSLoader}),__webpack_require__.d(__webpack_exports__,"TGALoader",function(){return TGALoader}),__webpack_require__.d(__webpack_exports__,"TTFLoader",function(){return TTFLoader}),__webpack_require__.d(__webpack_exports__,"VRMLLoader",function(){return VRMLLoader}),__webpack_require__.d(__webpack_exports__,"VRMLoader",function(){return VRMLoader}),__webpack_require__.d(__webpack_exports__,"VTKLoader",function(){return VTKLoader}),__webpack_require__.d(__webpack_exports__,"MarchingCubes",function(){return MarchingCubes}),__webpack_require__.d(__webpack_exports__,"ColorConverter",function(){return ColorConverter}),__webpack_require__.d(__webpack_exports__,"Lut",function(){return Lut}),__webpack_require__.d(__webpack_exports__,"MD2Character",function(){return MD2Character}),__webpack_require__.d(__webpack_exports__,"MD2CharacterComplex",function(){return MD2CharacterComplex}),__webpack_require__.d(__webpack_exports__,"ExplodeModifier",function(){return ExplodeModifier}),__webpack_require__.d(__webpack_exports__,"SimplifyModifier",function(){return SimplifyModifier}),__webpack_require__.d(__webpack_exports__,"SubdivisionModifier",function(){return SubdivisionModifier}),__webpack_require__.d(__webpack_exports__,"TessellateModifier",function(){return TessellateModifier}),__webpack_require__.d(__webpack_exports__,"MorphAnimMesh",function(){return MorphAnimMesh}),__webpack_require__.d(__webpack_exports__,"MorphBlendMesh",function(){return MorphBlendMesh}),__webpack_require__.d(__webpack_exports__,"CameraNode",function(){return CameraNode}),__webpack_require__.d(__webpack_exports__,"ColorsNode",function(){return ColorsNode}),__webpack_require__.d(__webpack_exports__,"LightNode",function(){return LightNode}),__webpack_require__.d(__webpack_exports__,"NormalNode",function(){return NormalNode$1}),__webpack_require__.d(__webpack_exports__,"PositionNode",function(){return PositionNode}),__webpack_require__.d(__webpack_exports__,"ReflectNode",function(){return ReflectNode}),__webpack_require__.d(__webpack_exports__,"ResolutionNode",function(){return ResolutionNode}),__webpack_require__.d(__webpack_exports__,"ScreenUVNode",function(){return ScreenUVNode}),__webpack_require__.d(__webpack_exports__,"UVNode",function(){return UVNode}),__webpack_require__.d(__webpack_exports__,"BlinnExponentToRoughnessNode",function(){return BlinnExponentToRoughnessNode}),__webpack_require__.d(__webpack_exports__,"BlinnShininessExponentNode",function(){return BlinnShininessExponentNode}),__webpack_require__.d(__webpack_exports__,"RoughnessToBlinnExponentNode",function(){return RoughnessToBlinnExponentNode}),__webpack_require__.d(__webpack_exports__,"AttributeNode",function(){return AttributeNode}),__webpack_require__.d(__webpack_exports__,"ConstNode",function(){return ConstNode}),__webpack_require__.d(__webpack_exports__,"ExpressionNode",function(){return ExpressionNode}),__webpack_require__.d(__webpack_exports__,"FunctionCallNode",function(){return FunctionCallNode}),__webpack_require__.d(__webpack_exports__,"FunctionNode",function(){return FunctionNode}),__webpack_require__.d(__webpack_exports__,"InputNode",function(){return InputNode}),__webpack_require__.d(__webpack_exports__,"Node",function(){return Node$1}),__webpack_require__.d(__webpack_exports__,"NodeBuilder",function(){return NodeBuilder}),__webpack_require__.d(__webpack_exports__,"NodeFrame",function(){return NodeFrame}),__webpack_require__.d(__webpack_exports__,"NodeLib",function(){return NodeLib}),__webpack_require__.d(__webpack_exports__,"NodeUniform",function(){return NodeUniform}),__webpack_require__.d(__webpack_exports__,"NodeUtils",function(){return NodeUtils}),__webpack_require__.d(__webpack_exports__,"StructNode",function(){return StructNode}),__webpack_require__.d(__webpack_exports__,"TempNode",function(){return TempNode}),__webpack_require__.d(__webpack_exports__,"VarNode",function(){return VarNode}),__webpack_require__.d(__webpack_exports__,"BlurNode",function(){return BlurNode}),__webpack_require__.d(__webpack_exports__,"ColorAdjustmentNode",function(){return ColorAdjustmentNode}),__webpack_require__.d(__webpack_exports__,"LuminanceNode",function(){return LuminanceNode}),__webpack_require__.d(__webpack_exports__,"BoolNode",function(){return BoolNode}),__webpack_require__.d(__webpack_exports__,"ColorNode",function(){return ColorNode}),__webpack_require__.d(__webpack_exports__,"CubeTextureNode",function(){return CubeTextureNode}),__webpack_require__.d(__webpack_exports__,"FloatNode",function(){return FloatNode}),__webpack_require__.d(__webpack_exports__,"IntNode",function(){return IntNode}),__webpack_require__.d(__webpack_exports__,"Matrix3Node",function(){return Matrix3Node}),__webpack_require__.d(__webpack_exports__,"Matrix4Node",function(){return Matrix4Node}),__webpack_require__.d(__webpack_exports__,"PropertyNode",function(){return PropertyNode}),__webpack_require__.d(__webpack_exports__,"ReflectorNode",function(){return ReflectorNode}),__webpack_require__.d(__webpack_exports__,"RTTNode",function(){return RTTNode}),__webpack_require__.d(__webpack_exports__,"ScreenNode",function(){return ScreenNode}),__webpack_require__.d(__webpack_exports__,"TextureNode",function(){return TextureNode}),__webpack_require__.d(__webpack_exports__,"Vector2Node",function(){return Vector2Node}),__webpack_require__.d(__webpack_exports__,"Vector3Node",function(){return Vector3Node}),__webpack_require__.d(__webpack_exports__,"Vector4Node",function(){return Vector4Node}),__webpack_require__.d(__webpack_exports__,"MeshStandardNodeMaterial",function(){return MeshStandardNodeMaterial}),__webpack_require__.d(__webpack_exports__,"NodeMaterial",function(){return NodeMaterial}),__webpack_require__.d(__webpack_exports__,"MeshStandardNode",function(){return MeshStandardNode}),__webpack_require__.d(__webpack_exports__,"PhongNode",function(){return PhongNode}),__webpack_require__.d(__webpack_exports__,"RawNode",function(){return RawNode}),__webpack_require__.d(__webpack_exports__,"SpriteNode",function(){return SpriteNode}),__webpack_require__.d(__webpack_exports__,"StandardNode",function(){return StandardNode}),__webpack_require__.d(__webpack_exports__,"PhongNodeMaterial",function(){return PhongNodeMaterial}),__webpack_require__.d(__webpack_exports__,"SpriteNodeMaterial",function(){return SpriteNodeMaterial}),__webpack_require__.d(__webpack_exports__,"StandardNodeMaterial",function(){return StandardNodeMaterial}),__webpack_require__.d(__webpack_exports__,"CondNode",function(){return CondNode}),__webpack_require__.d(__webpack_exports__,"Math1Node",function(){return Math1Node}),__webpack_require__.d(__webpack_exports__,"Math2Node",function(){return Math2Node}),__webpack_require__.d(__webpack_exports__,"Math3Node",function(){return Math3Node}),__webpack_require__.d(__webpack_exports__,"OperatorNode",function(){return OperatorNode}),__webpack_require__.d(__webpack_exports__,"BumpMapNode",function(){return BumpMapNode}),__webpack_require__.d(__webpack_exports__,"NormalMapNode",function(){return NormalMapNode}),__webpack_require__.d(__webpack_exports__,"TextureCubeNode",function(){return TextureCubeNode}),__webpack_require__.d(__webpack_exports__,"TextureCubeUVNode",function(){return TextureCubeUVNode}),__webpack_require__.d(__webpack_exports__,"NodePass",function(){return NodePass}),__webpack_require__.d(__webpack_exports__,"NodePostProcessing",function(){return NodePostProcessing}),__webpack_require__.d(__webpack_exports__,"CheckerNode",function(){return CheckerNode}),__webpack_require__.d(__webpack_exports__,"NoiseNode",function(){return NoiseNode}),__webpack_require__.d(__webpack_exports__,"BypassNode",function(){return BypassNode}),__webpack_require__.d(__webpack_exports__,"ColorSpaceNode",function(){return ColorSpaceNode}),__webpack_require__.d(__webpack_exports__,"JoinNode",function(){return JoinNode}),__webpack_require__.d(__webpack_exports__,"MaxMIPLevelNode",function(){return MaxMIPLevelNode}),__webpack_require__.d(__webpack_exports__,"SwitchNode",function(){return SwitchNode}),__webpack_require__.d(__webpack_exports__,"TimerNode",function(){return TimerNode}),__webpack_require__.d(__webpack_exports__,"UVTransformNode",function(){return UVTransformNode}),__webpack_require__.d(__webpack_exports__,"VelocityNode",function(){return VelocityNode}),__webpack_require__.d(__webpack_exports__,"Fire",function(){return Fire}),__webpack_require__.d(__webpack_exports__,"Lensflare",function(){return Lensflare}),__webpack_require__.d(__webpack_exports__,"LensflareElement",function(){return LensflareElement}),__webpack_require__.d(__webpack_exports__,"LightningStorm",function(){return LightningStorm}),__webpack_require__.d(__webpack_exports__,"Reflector",function(){return Reflector}),__webpack_require__.d(__webpack_exports__,"ReflectorRTT",function(){return ReflectorRTT}),__webpack_require__.d(__webpack_exports__,"Refractor",function(){return Refractor}),__webpack_require__.d(__webpack_exports__,"ShadowMesh",function(){return ShadowMesh}),__webpack_require__.d(__webpack_exports__,"Sky",function(){return Sky}),__webpack_require__.d(__webpack_exports__,"Water",function(){return Water}),__webpack_require__.d(__webpack_exports__,"Water2",function(){return Water2}),__webpack_require__.d(__webpack_exports__,"Ocean",function(){return Ocean}),__webpack_require__.d(__webpack_exports__,"PMREMCubeUVPacker",function(){return PMREMCubeUVPacker}),__webpack_require__.d(__webpack_exports__,"PMREMGenerator",function(){return PMREMGenerator}),__webpack_require__.d(__webpack_exports__,"AdaptiveToneMappingPass",function(){return AdaptiveToneMappingPass}),__webpack_require__.d(__webpack_exports__,"AfterimagePass",function(){return AfterimagePass}),__webpack_require__.d(__webpack_exports__,"BloomPass",function(){return BloomPass}),__webpack_require__.d(__webpack_exports__,"BokehPass",function(){return BokehPass}),__webpack_require__.d(__webpack_exports__,"ClearPass",function(){return ClearPass}),__webpack_require__.d(__webpack_exports__,"CubeTexturePass",function(){return CubeTexturePass}),__webpack_require__.d(__webpack_exports__,"DotScreenPass",function(){return DotScreenPass}),__webpack_require__.d(__webpack_exports__,"EffectComposer",function(){return EffectComposer}),__webpack_require__.d(__webpack_exports__,"FilmPass",function(){return FilmPass}),__webpack_require__.d(__webpack_exports__,"GlitchPass",function(){return GlitchPass}),__webpack_require__.d(__webpack_exports__,"HalftonePass",function(){return HalftonePass}),__webpack_require__.d(__webpack_exports__,"MaskPass",function(){return MaskPass}),__webpack_require__.d(__webpack_exports__,"ClearMaskPass",function(){return ClearMaskPass}),__webpack_require__.d(__webpack_exports__,"OutlinePass",function(){return OutlinePass}),__webpack_require__.d(__webpack_exports__,"Pass",function(){return Pass}),__webpack_require__.d(__webpack_exports__,"RenderPass",function(){return RenderPass}),__webpack_require__.d(__webpack_exports__,"SAOPass",function(){return SAOPass}),__webpack_require__.d(__webpack_exports__,"SavePass",function(){return SavePass}),__webpack_require__.d(__webpack_exports__,"ShaderPass",function(){return ShaderPass}),__webpack_require__.d(__webpack_exports__,"SMAAPass",function(){return SMAAPass}),__webpack_require__.d(__webpack_exports__,"SSAARenderPass",function(){return SSAARenderPass}),__webpack_require__.d(__webpack_exports__,"SSAOPass",function(){return SSAOPass}),__webpack_require__.d(__webpack_exports__,"TAARenderPass",function(){return TAARenderPass}),__webpack_require__.d(__webpack_exports__,"TexturePass",function(){return TexturePass}),__webpack_require__.d(__webpack_exports__,"UnrealBloomPass",function(){return UnrealBloomPass}),__webpack_require__.d(__webpack_exports__,"PRNG",function(){return PRNG}),__webpack_require__.d(__webpack_exports__,"QuickHull",function(){return QuickHull}),__webpack_require__.d(__webpack_exports__,"CSS2DObject",function(){return CSS2DObject}),__webpack_require__.d(__webpack_exports__,"CSS2DRenderer",function(){return CSS2DRenderer}),__webpack_require__.d(__webpack_exports__,"CSS3DObject",function(){return CSS3DObject}),__webpack_require__.d(__webpack_exports__,"CSS3DSprite",function(){return CSS3DSprite}),__webpack_require__.d(__webpack_exports__,"CSS3DRenderer",function(){return CSS3DRenderer}),__webpack_require__.d(__webpack_exports__,"RenderableObject",function(){return RenderableObject}),__webpack_require__.d(__webpack_exports__,"RenderableFace",function(){return RenderableFace}),__webpack_require__.d(__webpack_exports__,"RenderableVertex",function(){return RenderableVertex}),__webpack_require__.d(__webpack_exports__,"RenderableLine",function(){return RenderableLine}),__webpack_require__.d(__webpack_exports__,"RenderableSprite",function(){return RenderableSprite}),__webpack_require__.d(__webpack_exports__,"Projector",function(){return Projector}),__webpack_require__.d(__webpack_exports__,"RaytracingRenderer",function(){return RaytracingRenderer}),__webpack_require__.d(__webpack_exports__,"SoftwareRenderer",function(){return SoftwareRenderer}),__webpack_require__.d(__webpack_exports__,"SVGObject",function(){return SVGObject}),__webpack_require__.d(__webpack_exports__,"SVGRenderer",function(){return SVGRenderer}),__webpack_require__.d(__webpack_exports__,"WebGLDeferredRenderer",function(){return WebGLDeferredRenderer}),__webpack_require__.d(__webpack_exports__,"RollerCoasterGeometry",function(){return RollerCoasterGeometry}),__webpack_require__.d(__webpack_exports__,"RollerCoasterLiftersGeometry",function(){return RollerCoasterLiftersGeometry}),__webpack_require__.d(__webpack_exports__,"RollerCoasterShadowGeometry",function(){return RollerCoasterShadowGeometry}),__webpack_require__.d(__webpack_exports__,"SkyGeometry",function(){return SkyGeometry}),__webpack_require__.d(__webpack_exports__,"TreesGeometry",function(){return TreesGeometry}),__webpack_require__.d(__webpack_exports__,"ShaderGodRays",function(){return ShaderGodRays}),__webpack_require__.d(__webpack_exports__,"AfterimageShader",function(){return AfterimageShader}),__webpack_require__.d(__webpack_exports__,"BasicShader",function(){return BasicShader}),__webpack_require__.d(__webpack_exports__,"BleachBypassShader",function(){return BleachBypassShader}),__webpack_require__.d(__webpack_exports__,"BlendShader",function(){return BlendShader}),__webpack_require__.d(__webpack_exports__,"BokehShader",function(){return BokehShader}),__webpack_require__.d(__webpack_exports__,"BokehShader2",function(){return BokehShader2}),__webpack_require__.d(__webpack_exports__,"BokehDepthShader",function(){return BokehDepthShader}),__webpack_require__.d(__webpack_exports__,"BrightnessContrastShader",function(){return BrightnessContrastShader}),__webpack_require__.d(__webpack_exports__,"ColorCorrectionShader",function(){return ColorCorrectionShader}),__webpack_require__.d(__webpack_exports__,"ColorifyShader",function(){return ColorifyShader}),__webpack_require__.d(__webpack_exports__,"ConvolutionShader",function(){return ConvolutionShader}),__webpack_require__.d(__webpack_exports__,"CopyShader",function(){return CopyShader}),__webpack_require__.d(__webpack_exports__,"DepthLimitedBlurShader",function(){return DepthLimitedBlurShader}),__webpack_require__.d(__webpack_exports__,"BlurShaderUtils",function(){return BlurShaderUtils}),__webpack_require__.d(__webpack_exports__,"DigitalGlitch",function(){return DigitalGlitch}),__webpack_require__.d(__webpack_exports__,"DOFMipMapShader",function(){return DOFMipMapShader}),__webpack_require__.d(__webpack_exports__,"DotScreenShader",function(){return DotScreenShader}),__webpack_require__.d(__webpack_exports__,"FilmShader",function(){return FilmShader}),__webpack_require__.d(__webpack_exports__,"FocusShader",function(){return FocusShader}),__webpack_require__.d(__webpack_exports__,"FreiChenShader",function(){return FreiChenShader}),__webpack_require__.d(__webpack_exports__,"FresnelShader",function(){return FresnelShader}),__webpack_require__.d(__webpack_exports__,"FXAAShader",function(){return FXAAShader}),__webpack_require__.d(__webpack_exports__,"GammaCorrectionShader",function(){return GammaCorrectionShader}),__webpack_require__.d(__webpack_exports__,"HalftoneShader",function(){return HalftoneShader}),__webpack_require__.d(__webpack_exports__,"HorizontalBlurShader",function(){return HorizontalBlurShader}),__webpack_require__.d(__webpack_exports__,"HorizontalTiltShiftShader",function(){return HorizontalTiltShiftShader}),__webpack_require__.d(__webpack_exports__,"HueSaturationShader",function(){return HueSaturationShader}),__webpack_require__.d(__webpack_exports__,"KaleidoShader",function(){return KaleidoShader}),__webpack_require__.d(__webpack_exports__,"LuminosityHighPassShader",function(){return LuminosityHighPassShader}),__webpack_require__.d(__webpack_exports__,"LuminosityShader",function(){return LuminosityShader}),__webpack_require__.d(__webpack_exports__,"MirrorShader",function(){return MirrorShader}),__webpack_require__.d(__webpack_exports__,"NormalMapShader",function(){return NormalMapShader}),__webpack_require__.d(__webpack_exports__,"ParallaxShader",function(){return ParallaxShader}),__webpack_require__.d(__webpack_exports__,"PixelShader",function(){return PixelShader}),__webpack_require__.d(__webpack_exports__,"RGBShiftShader",function(){return RGBShiftShader}),__webpack_require__.d(__webpack_exports__,"SAOShader",function(){return SAOShader}),__webpack_require__.d(__webpack_exports__,"SepiaShader",function(){return SepiaShader}),__webpack_require__.d(__webpack_exports__,"SMAAShader",function(){return SMAAShader}),__webpack_require__.d(__webpack_exports__,"SobelOperatorShader",function(){return SobelOperatorShader}),__webpack_require__.d(__webpack_exports__,"SSAOShader",function(){return SSAOShader}),__webpack_require__.d(__webpack_exports__,"SSAODepthShader",function(){return SSAODepthShader}),__webpack_require__.d(__webpack_exports__,"SSAOBlurShader",function(){return SSAOBlurShader}),__webpack_require__.d(__webpack_exports__,"TechnicolorShader",function(){return TechnicolorShader}),__webpack_require__.d(__webpack_exports__,"ToneMapShader",function(){return ToneMapShader}),__webpack_require__.d(__webpack_exports__,"TriangleBlurShader",function(){return TriangleBlurShader}),__webpack_require__.d(__webpack_exports__,"UnpackDepthRGBAShader",function(){return UnpackDepthRGBAShader}),__webpack_require__.d(__webpack_exports__,"VerticalBlurShader",function(){return VerticalBlurShader}),__webpack_require__.d(__webpack_exports__,"VerticalTiltShiftShader",function(){return VerticalTiltShiftShader}),__webpack_require__.d(__webpack_exports__,"VignetteShader",function(){return VignetteShader}),__webpack_require__.d(__webpack_exports__,"VolumeRenderShader1",function(){return VolumeRenderShader1}),__webpack_require__.d(__webpack_exports__,"WaterRefractionShader",function(){return WaterRefractionShader}),__webpack_require__.d(__webpack_exports__,"ShaderSkin",function(){return ShaderSkin}),__webpack_require__.d(__webpack_exports__,"ShaderTerrain",function(){return ShaderTerrain}),__webpack_require__.d(__webpack_exports__,"ShaderToon",function(){return ShaderToon}),__webpack_require__.d(__webpack_exports__,"TranslucentShader",function(){return TranslucentShader}),__webpack_require__.d(__webpack_exports__,"SimplexNoise",function(){return SimplexNoise}),__webpack_require__.d(__webpack_exports__,"TimelinerController",function(){return TimelinerController}),__webpack_require__.d(__webpack_exports__,"TypedArrayUtils",function(){return TypedArrayUtils}),__webpack_require__.d(__webpack_exports__,"BufferGeometryUtils",function(){return BufferGeometryUtils}),__webpack_require__.d(__webpack_exports__,"GeometryUtils",function(){return GeometryUtils}),__webpack_require__.d(__webpack_exports__,"MathUtils",function(){return MathUtils}),__webpack_require__.d(__webpack_exports__,"SceneUtils",function(){return SceneUtils}),__webpack_require__.d(__webpack_exports__,"ShadowMapViewer",function(){return ShadowMapViewer}),__webpack_require__.d(__webpack_exports__,"SkeletonUtils",function(){return SkeletonUtils}),__webpack_require__.d(__webpack_exports__,"UVsDebug",function(){return UVsDebug}),__webpack_require__.d(__webpack_exports__,"VolumeSlice",function(){return VolumeSlice}),__webpack_require__.d(__webpack_exports__,"DaydreamController",function(){return DaydreamController}),__webpack_require__.d(__webpack_exports__,"GearVRController",function(){return GearVRController}),__webpack_require__.d(__webpack_exports__,"PaintViveController",function(){return PaintViveController}),__webpack_require__.d(__webpack_exports__,"ViveController",function(){return ViveController}),__webpack_require__.d(__webpack_exports__,"WebVR",function(){return WebVR}),__webpack_require__.d(__webpack_exports__,"WebGL",function(){return WebGL}),__webpack_require__.d(__webpack_exports__,"AnimationAction",function(){return AnimationAction}),__webpack_require__.d(__webpack_exports__,"AnimationClip",function(){return AnimationClip}),__webpack_require__.d(__webpack_exports__,"AnimationMixer",function(){return AnimationMixer}),__webpack_require__.d(__webpack_exports__,"AnimationObjectGroup",function(){return AnimationObjectGroup}),__webpack_require__.d(__webpack_exports__,"AnimationUtils",function(){return AnimationUtils}),__webpack_require__.d(__webpack_exports__,"KeyframeTrack",function(){return KeyframeTrack}),__webpack_require__.d(__webpack_exports__,"PropertyBinding",function(){return PropertyBinding}),__webpack_require__.d(__webpack_exports__,"PropertyMixer",function(){return PropertyMixer}),__webpack_require__.d(__webpack_exports__,"BooleanKeyframeTrack",function(){return BooleanKeyframeTrack}),__webpack_require__.d(__webpack_exports__,"ColorKeyframeTrack",function(){return ColorKeyframeTrack}),__webpack_require__.d(__webpack_exports__,"NumberKeyframeTrack",function(){return NumberKeyframeTrack}),__webpack_require__.d(__webpack_exports__,"QuaternionKeyframeTrack",function(){return QuaternionKeyframeTrack}),__webpack_require__.d(__webpack_exports__,"StringKeyframeTrack",function(){return StringKeyframeTrack}),__webpack_require__.d(__webpack_exports__,"VectorKeyframeTrack",function(){return VectorKeyframeTrack}),__webpack_require__.d(__webpack_exports__,"Audio",function(){return Audio}),__webpack_require__.d(__webpack_exports__,"AudioAnalyser",function(){return AudioAnalyser}),__webpack_require__.d(__webpack_exports__,"AudioContext",function(){return AudioContext}),__webpack_require__.d(__webpack_exports__,"AudioListener",function(){return AudioListener}),__webpack_require__.d(__webpack_exports__,"PositionalAudio",function(){return PositionalAudio}),__webpack_require__.d(__webpack_exports__,"ArrayCamera",function(){return ArrayCamera}),__webpack_require__.d(__webpack_exports__,"Camera",function(){return Camera}),__webpack_require__.d(__webpack_exports__,"CubeCamera",function(){return CubeCamera}),__webpack_require__.d(__webpack_exports__,"OrthographicCamera",function(){return OrthographicCamera}),__webpack_require__.d(__webpack_exports__,"PerspectiveCamera",function(){return PerspectiveCamera}),__webpack_require__.d(__webpack_exports__,"StereoCamera",function(){return StereoCamera}),__webpack_require__.d(__webpack_exports__,"REVISION",function(){return REVISION}),__webpack_require__.d(__webpack_exports__,"MOUSE",function(){return MOUSE}),__webpack_require__.d(__webpack_exports__,"CullFaceNone",function(){return CullFaceNone}),__webpack_require__.d(__webpack_exports__,"CullFaceBack",function(){return CullFaceBack}),__webpack_require__.d(__webpack_exports__,"CullFaceFront",function(){return CullFaceFront}),__webpack_require__.d(__webpack_exports__,"CullFaceFrontBack",function(){return CullFaceFrontBack}),__webpack_require__.d(__webpack_exports__,"FrontFaceDirectionCW",function(){return FrontFaceDirectionCW}),__webpack_require__.d(__webpack_exports__,"FrontFaceDirectionCCW",function(){return FrontFaceDirectionCCW}),__webpack_require__.d(__webpack_exports__,"BasicShadowMap",function(){return BasicShadowMap}),__webpack_require__.d(__webpack_exports__,"PCFShadowMap",function(){return PCFShadowMap}),__webpack_require__.d(__webpack_exports__,"PCFSoftShadowMap",function(){return PCFSoftShadowMap}),__webpack_require__.d(__webpack_exports__,"FrontSide",function(){return FrontSide}),__webpack_require__.d(__webpack_exports__,"BackSide",function(){return BackSide}),__webpack_require__.d(__webpack_exports__,"DoubleSide",function(){return DoubleSide}),__webpack_require__.d(__webpack_exports__,"FlatShading",function(){return FlatShading}),__webpack_require__.d(__webpack_exports__,"SmoothShading",function(){return SmoothShading}),__webpack_require__.d(__webpack_exports__,"NoColors",function(){return NoColors}),__webpack_require__.d(__webpack_exports__,"FaceColors",function(){return FaceColors}),__webpack_require__.d(__webpack_exports__,"VertexColors",function(){return VertexColors}),__webpack_require__.d(__webpack_exports__,"NoBlending",function(){return NoBlending}),__webpack_require__.d(__webpack_exports__,"NormalBlending",function(){return NormalBlending}),__webpack_require__.d(__webpack_exports__,"AdditiveBlending",function(){return AdditiveBlending}),__webpack_require__.d(__webpack_exports__,"SubtractiveBlending",function(){return SubtractiveBlending}),__webpack_require__.d(__webpack_exports__,"MultiplyBlending",function(){return MultiplyBlending}),__webpack_require__.d(__webpack_exports__,"CustomBlending",function(){return CustomBlending}),__webpack_require__.d(__webpack_exports__,"AddEquation",function(){return AddEquation}),__webpack_require__.d(__webpack_exports__,"SubtractEquation",function(){return SubtractEquation}),__webpack_require__.d(__webpack_exports__,"ReverseSubtractEquation",function(){return ReverseSubtractEquation}),__webpack_require__.d(__webpack_exports__,"MinEquation",function(){return MinEquation}),__webpack_require__.d(__webpack_exports__,"MaxEquation",function(){return MaxEquation}),__webpack_require__.d(__webpack_exports__,"ZeroFactor",function(){return ZeroFactor}),__webpack_require__.d(__webpack_exports__,"OneFactor",function(){return OneFactor}),__webpack_require__.d(__webpack_exports__,"SrcColorFactor",function(){return SrcColorFactor}),__webpack_require__.d(__webpack_exports__,"OneMinusSrcColorFactor",function(){return OneMinusSrcColorFactor}),__webpack_require__.d(__webpack_exports__,"SrcAlphaFactor",function(){return SrcAlphaFactor}),__webpack_require__.d(__webpack_exports__,"OneMinusSrcAlphaFactor",function(){return OneMinusSrcAlphaFactor}),__webpack_require__.d(__webpack_exports__,"DstAlphaFactor",function(){return DstAlphaFactor}),__webpack_require__.d(__webpack_exports__,"OneMinusDstAlphaFactor",function(){return OneMinusDstAlphaFactor}),__webpack_require__.d(__webpack_exports__,"DstColorFactor",function(){return DstColorFactor}),__webpack_require__.d(__webpack_exports__,"OneMinusDstColorFactor",function(){return OneMinusDstColorFactor}),__webpack_require__.d(__webpack_exports__,"SrcAlphaSaturateFactor",function(){return SrcAlphaSaturateFactor}),__webpack_require__.d(__webpack_exports__,"NeverDepth",function(){return NeverDepth}),__webpack_require__.d(__webpack_exports__,"AlwaysDepth",function(){return AlwaysDepth}),__webpack_require__.d(__webpack_exports__,"LessDepth",function(){return LessDepth}),__webpack_require__.d(__webpack_exports__,"LessEqualDepth",function(){return LessEqualDepth}),__webpack_require__.d(__webpack_exports__,"EqualDepth",function(){return EqualDepth}),__webpack_require__.d(__webpack_exports__,"GreaterEqualDepth",function(){return GreaterEqualDepth}),__webpack_require__.d(__webpack_exports__,"GreaterDepth",function(){return GreaterDepth}),__webpack_require__.d(__webpack_exports__,"NotEqualDepth",function(){return NotEqualDepth}),__webpack_require__.d(__webpack_exports__,"MultiplyOperation",function(){return MultiplyOperation}),__webpack_require__.d(__webpack_exports__,"MixOperation",function(){return MixOperation}),__webpack_require__.d(__webpack_exports__,"AddOperation",function(){return AddOperation}),__webpack_require__.d(__webpack_exports__,"NoToneMapping",function(){return NoToneMapping}),__webpack_require__.d(__webpack_exports__,"LinearToneMapping",function(){return LinearToneMapping}),__webpack_require__.d(__webpack_exports__,"ReinhardToneMapping",function(){return ReinhardToneMapping}),__webpack_require__.d(__webpack_exports__,"Uncharted2ToneMapping",function(){return Uncharted2ToneMapping}),__webpack_require__.d(__webpack_exports__,"CineonToneMapping",function(){return CineonToneMapping}),__webpack_require__.d(__webpack_exports__,"ACESFilmicToneMapping",function(){return ACESFilmicToneMapping}),__webpack_require__.d(__webpack_exports__,"UVMapping",function(){return UVMapping}),__webpack_require__.d(__webpack_exports__,"CubeReflectionMapping",function(){return CubeReflectionMapping}),__webpack_require__.d(__webpack_exports__,"CubeRefractionMapping",function(){return CubeRefractionMapping}),__webpack_require__.d(__webpack_exports__,"EquirectangularReflectionMapping",function(){return EquirectangularReflectionMapping}),__webpack_require__.d(__webpack_exports__,"EquirectangularRefractionMapping",function(){return EquirectangularRefractionMapping}),__webpack_require__.d(__webpack_exports__,"SphericalReflectionMapping",function(){return SphericalReflectionMapping}),__webpack_require__.d(__webpack_exports__,"CubeUVReflectionMapping",function(){return CubeUVReflectionMapping}),__webpack_require__.d(__webpack_exports__,"CubeUVRefractionMapping",function(){return CubeUVRefractionMapping}),__webpack_require__.d(__webpack_exports__,"RepeatWrapping",function(){return RepeatWrapping}),__webpack_require__.d(__webpack_exports__,"ClampToEdgeWrapping",function(){return ClampToEdgeWrapping}),__webpack_require__.d(__webpack_exports__,"MirroredRepeatWrapping",function(){return MirroredRepeatWrapping}),__webpack_require__.d(__webpack_exports__,"NearestFilter",function(){return NearestFilter}),__webpack_require__.d(__webpack_exports__,"NearestMipMapNearestFilter",function(){return NearestMipMapNearestFilter}),__webpack_require__.d(__webpack_exports__,"NearestMipMapLinearFilter",function(){return NearestMipMapLinearFilter}),__webpack_require__.d(__webpack_exports__,"LinearFilter",function(){return LinearFilter}),__webpack_require__.d(__webpack_exports__,"LinearMipMapNearestFilter",function(){return LinearMipMapNearestFilter}),__webpack_require__.d(__webpack_exports__,"LinearMipMapLinearFilter",function(){return LinearMipMapLinearFilter}),__webpack_require__.d(__webpack_exports__,"UnsignedByteType",function(){return UnsignedByteType}),__webpack_require__.d(__webpack_exports__,"ByteType",function(){return ByteType}),__webpack_require__.d(__webpack_exports__,"ShortType",function(){return ShortType}),__webpack_require__.d(__webpack_exports__,"UnsignedShortType",function(){return UnsignedShortType}),__webpack_require__.d(__webpack_exports__,"IntType",function(){return IntType}),__webpack_require__.d(__webpack_exports__,"UnsignedIntType",function(){return UnsignedIntType}),__webpack_require__.d(__webpack_exports__,"FloatType",function(){return FloatType}),__webpack_require__.d(__webpack_exports__,"HalfFloatType",function(){return HalfFloatType}),__webpack_require__.d(__webpack_exports__,"UnsignedShort4444Type",function(){return UnsignedShort4444Type}),__webpack_require__.d(__webpack_exports__,"UnsignedShort5551Type",function(){return UnsignedShort5551Type}),__webpack_require__.d(__webpack_exports__,"UnsignedShort565Type",function(){return UnsignedShort565Type}),__webpack_require__.d(__webpack_exports__,"UnsignedInt248Type",function(){return UnsignedInt248Type}),__webpack_require__.d(__webpack_exports__,"AlphaFormat",function(){return AlphaFormat}),__webpack_require__.d(__webpack_exports__,"RGBFormat",function(){return RGBFormat}),__webpack_require__.d(__webpack_exports__,"RGBAFormat",function(){return RGBAFormat}),__webpack_require__.d(__webpack_exports__,"LuminanceFormat",function(){return LuminanceFormat}),__webpack_require__.d(__webpack_exports__,"LuminanceAlphaFormat",function(){return LuminanceAlphaFormat}),__webpack_require__.d(__webpack_exports__,"RGBEFormat",function(){return RGBEFormat}),__webpack_require__.d(__webpack_exports__,"DepthFormat",function(){return DepthFormat}),__webpack_require__.d(__webpack_exports__,"DepthStencilFormat",function(){return DepthStencilFormat}),__webpack_require__.d(__webpack_exports__,"RedFormat",function(){return RedFormat}),__webpack_require__.d(__webpack_exports__,"RGB_S3TC_DXT1_Format",function(){return RGB_S3TC_DXT1_Format}),__webpack_require__.d(__webpack_exports__,"RGBA_S3TC_DXT1_Format",function(){return RGBA_S3TC_DXT1_Format}),__webpack_require__.d(__webpack_exports__,"RGBA_S3TC_DXT3_Format",function(){return RGBA_S3TC_DXT3_Format}),__webpack_require__.d(__webpack_exports__,"RGBA_S3TC_DXT5_Format",function(){return RGBA_S3TC_DXT5_Format}),__webpack_require__.d(__webpack_exports__,"RGB_PVRTC_4BPPV1_Format",function(){return RGB_PVRTC_4BPPV1_Format}),__webpack_require__.d(__webpack_exports__,"RGB_PVRTC_2BPPV1_Format",function(){return RGB_PVRTC_2BPPV1_Format}),__webpack_require__.d(__webpack_exports__,"RGBA_PVRTC_4BPPV1_Format",function(){return RGBA_PVRTC_4BPPV1_Format}),__webpack_require__.d(__webpack_exports__,"RGBA_PVRTC_2BPPV1_Format",function(){return RGBA_PVRTC_2BPPV1_Format}),__webpack_require__.d(__webpack_exports__,"RGB_ETC1_Format",function(){return RGB_ETC1_Format}),__webpack_require__.d(__webpack_exports__,"RGBA_ASTC_4x4_Format",function(){return RGBA_ASTC_4x4_Format}),__webpack_require__.d(__webpack_exports__,"RGBA_ASTC_5x4_Format",function(){return RGBA_ASTC_5x4_Format}),__webpack_require__.d(__webpack_exports__,"RGBA_ASTC_5x5_Format",function(){return RGBA_ASTC_5x5_Format}),__webpack_require__.d(__webpack_exports__,"RGBA_ASTC_6x5_Format",function(){return RGBA_ASTC_6x5_Format}),__webpack_require__.d(__webpack_exports__,"RGBA_ASTC_6x6_Format",function(){return RGBA_ASTC_6x6_Format}),__webpack_require__.d(__webpack_exports__,"RGBA_ASTC_8x5_Format",function(){return RGBA_ASTC_8x5_Format}),__webpack_require__.d(__webpack_exports__,"RGBA_ASTC_8x6_Format",function(){return RGBA_ASTC_8x6_Format}),__webpack_require__.d(__webpack_exports__,"RGBA_ASTC_8x8_Format",function(){return RGBA_ASTC_8x8_Format}),__webpack_require__.d(__webpack_exports__,"RGBA_ASTC_10x5_Format",function(){return RGBA_ASTC_10x5_Format}),__webpack_require__.d(__webpack_exports__,"RGBA_ASTC_10x6_Format",function(){return RGBA_ASTC_10x6_Format}),__webpack_require__.d(__webpack_exports__,"RGBA_ASTC_10x8_Format",function(){return RGBA_ASTC_10x8_Format}),__webpack_require__.d(__webpack_exports__,"RGBA_ASTC_10x10_Format",function(){return RGBA_ASTC_10x10_Format}),__webpack_require__.d(__webpack_exports__,"RGBA_ASTC_12x10_Format",function(){return RGBA_ASTC_12x10_Format}),__webpack_require__.d(__webpack_exports__,"RGBA_ASTC_12x12_Format",function(){return RGBA_ASTC_12x12_Format}),__webpack_require__.d(__webpack_exports__,"LoopOnce",function(){return LoopOnce}),__webpack_require__.d(__webpack_exports__,"LoopRepeat",function(){return LoopRepeat}),__webpack_require__.d(__webpack_exports__,"LoopPingPong",function(){return LoopPingPong}),__webpack_require__.d(__webpack_exports__,"InterpolateDiscrete",function(){return InterpolateDiscrete}),__webpack_require__.d(__webpack_exports__,"InterpolateLinear",function(){return InterpolateLinear}),__webpack_require__.d(__webpack_exports__,"InterpolateSmooth",function(){return InterpolateSmooth}),__webpack_require__.d(__webpack_exports__,"ZeroCurvatureEnding",function(){return ZeroCurvatureEnding}),__webpack_require__.d(__webpack_exports__,"ZeroSlopeEnding",function(){return ZeroSlopeEnding}),__webpack_require__.d(__webpack_exports__,"WrapAroundEnding",function(){return WrapAroundEnding}),__webpack_require__.d(__webpack_exports__,"TrianglesDrawMode",function(){return TrianglesDrawMode}),__webpack_require__.d(__webpack_exports__,"TriangleStripDrawMode",function(){return TriangleStripDrawMode}),__webpack_require__.d(__webpack_exports__,"TriangleFanDrawMode",function(){return TriangleFanDrawMode}),__webpack_require__.d(__webpack_exports__,"LinearEncoding",function(){return LinearEncoding}),__webpack_require__.d(__webpack_exports__,"sRGBEncoding",function(){return sRGBEncoding}),__webpack_require__.d(__webpack_exports__,"GammaEncoding",function(){return GammaEncoding}),__webpack_require__.d(__webpack_exports__,"RGBEEncoding",function(){return RGBEEncoding}),__webpack_require__.d(__webpack_exports__,"LogLuvEncoding",function(){return LogLuvEncoding}),__webpack_require__.d(__webpack_exports__,"RGBM7Encoding",function(){return RGBM7Encoding}),__webpack_require__.d(__webpack_exports__,"RGBM16Encoding",function(){return RGBM16Encoding}),__webpack_require__.d(__webpack_exports__,"RGBDEncoding",function(){return RGBDEncoding}),__webpack_require__.d(__webpack_exports__,"BasicDepthPacking",function(){return BasicDepthPacking}),__webpack_require__.d(__webpack_exports__,"RGBADepthPacking",function(){return RGBADepthPacking}),__webpack_require__.d(__webpack_exports__,"TangentSpaceNormalMap",function(){return TangentSpaceNormalMap}),__webpack_require__.d(__webpack_exports__,"ObjectSpaceNormalMap",function(){return ObjectSpaceNormalMap}),__webpack_require__.d(__webpack_exports__,"Float64BufferAttribute",function(){return Float64BufferAttribute}),__webpack_require__.d(__webpack_exports__,"Float32BufferAttribute",function(){return Float32BufferAttribute}),__webpack_require__.d(__webpack_exports__,"Uint32BufferAttribute",function(){return Uint32BufferAttribute}),__webpack_require__.d(__webpack_exports__,"Int32BufferAttribute",function(){return Int32BufferAttribute}),__webpack_require__.d(__webpack_exports__,"Uint16BufferAttribute",function(){return Uint16BufferAttribute}),__webpack_require__.d(__webpack_exports__,"Int16BufferAttribute",function(){return Int16BufferAttribute}),__webpack_require__.d(__webpack_exports__,"Uint8ClampedBufferAttribute",function(){return Uint8ClampedBufferAttribute}),__webpack_require__.d(__webpack_exports__,"Uint8BufferAttribute",function(){return Uint8BufferAttribute}),__webpack_require__.d(__webpack_exports__,"Int8BufferAttribute",function(){return Int8BufferAttribute}),__webpack_require__.d(__webpack_exports__,"BufferAttribute",function(){return BufferAttribute}),__webpack_require__.d(__webpack_exports__,"BufferGeometry",function(){return BufferGeometry}),__webpack_require__.d(__webpack_exports__,"Clock",function(){return Clock}),__webpack_require__.d(__webpack_exports__,"DirectGeometry",function(){return DirectGeometry}),__webpack_require__.d(__webpack_exports__,"EventDispatcher",function(){return EventDispatcher}),__webpack_require__.d(__webpack_exports__,"Face3",function(){return Face3}),__webpack_require__.d(__webpack_exports__,"Geometry",function(){return Geometry}),__webpack_require__.d(__webpack_exports__,"InstancedBufferAttribute",function(){return InstancedBufferAttribute}),__webpack_require__.d(__webpack_exports__,"InstancedBufferGeometry",function(){return InstancedBufferGeometry}),__webpack_require__.d(__webpack_exports__,"InstancedInterleavedBuffer",function(){return InstancedInterleavedBuffer}),__webpack_require__.d(__webpack_exports__,"InterleavedBuffer",function(){return InterleavedBuffer}),__webpack_require__.d(__webpack_exports__,"InterleavedBufferAttribute",function(){return InterleavedBufferAttribute}),__webpack_require__.d(__webpack_exports__,"Layers",function(){return Layers}),__webpack_require__.d(__webpack_exports__,"Object3D",function(){return Object3D}),__webpack_require__.d(__webpack_exports__,"Raycaster",function(){return Raycaster}),__webpack_require__.d(__webpack_exports__,"Uniform",function(){return Uniform}),__webpack_require__.d(__webpack_exports__,"Curve",function(){return Curve}),__webpack_require__.d(__webpack_exports__,"CurvePath",function(){return CurvePath}),__webpack_require__.d(__webpack_exports__,"Font",function(){return Font}),__webpack_require__.d(__webpack_exports__,"CatmullRom",function(){return CatmullRom}),__webpack_require__.d(__webpack_exports__,"QuadraticBezier",function(){return QuadraticBezier}),__webpack_require__.d(__webpack_exports__,"CubicBezier",function(){return CubicBezier}),__webpack_require__.d(__webpack_exports__,"Path",function(){return Path}),__webpack_require__.d(__webpack_exports__,"Shape",function(){return Shape}),__webpack_require__.d(__webpack_exports__,"ShapePath",function(){return ShapePath}),__webpack_require__.d(__webpack_exports__,"ArcCurve",function(){return ArcCurve}),__webpack_require__.d(__webpack_exports__,"CatmullRomCurve3",function(){return CatmullRomCurve3}),__webpack_require__.d(__webpack_exports__,"CubicBezierCurve",function(){return CubicBezierCurve}),__webpack_require__.d(__webpack_exports__,"CubicBezierCurve3",function(){return CubicBezierCurve3}),__webpack_require__.d(__webpack_exports__,"EllipseCurve",function(){return EllipseCurve}),__webpack_require__.d(__webpack_exports__,"LineCurve",function(){return LineCurve}),__webpack_require__.d(__webpack_exports__,"LineCurve3",function(){return LineCurve3}),__webpack_require__.d(__webpack_exports__,"QuadraticBezierCurve",function(){return QuadraticBezierCurve}),__webpack_require__.d(__webpack_exports__,"QuadraticBezierCurve3",function(){return QuadraticBezierCurve3}),__webpack_require__.d(__webpack_exports__,"SplineCurve",function(){return SplineCurve}),__webpack_require__.d(__webpack_exports__,"Earcut",function(){return Earcut}),__webpack_require__.d(__webpack_exports__,"ImageUtils",function(){return ImageUtils}),__webpack_require__.d(__webpack_exports__,"ImmediateRenderObject",function(){return ImmediateRenderObject}),__webpack_require__.d(__webpack_exports__,"ShapeUtils",function(){return ShapeUtils}),__webpack_require__.d(__webpack_exports__,"BoxGeometry",function(){return BoxGeometry}),__webpack_require__.d(__webpack_exports__,"BoxBufferGeometry",function(){return BoxBufferGeometry}),__webpack_require__.d(__webpack_exports__,"CircleGeometry",function(){return CircleGeometry}),__webpack_require__.d(__webpack_exports__,"CircleBufferGeometry",function(){return CircleBufferGeometry}),__webpack_require__.d(__webpack_exports__,"ConeGeometry",function(){return ConeGeometry}),__webpack_require__.d(__webpack_exports__,"ConeBufferGeometry",function(){return ConeBufferGeometry}),__webpack_require__.d(__webpack_exports__,"CylinderGeometry",function(){return CylinderGeometry}),__webpack_require__.d(__webpack_exports__,"CylinderBufferGeometry",function(){return CylinderBufferGeometry}),__webpack_require__.d(__webpack_exports__,"DodecahedronGeometry",function(){return DodecahedronGeometry}),__webpack_require__.d(__webpack_exports__,"DodecahedronBufferGeometry",function(){return DodecahedronBufferGeometry}),__webpack_require__.d(__webpack_exports__,"EdgesGeometry",function(){return EdgesGeometry}),__webpack_require__.d(__webpack_exports__,"ExtrudeGeometry",function(){return ExtrudeGeometry}),__webpack_require__.d(__webpack_exports__,"ExtrudeBufferGeometry",function(){return ExtrudeBufferGeometry}),__webpack_require__.d(__webpack_exports__,"IcosahedronGeometry",function(){return IcosahedronGeometry}),__webpack_require__.d(__webpack_exports__,"IcosahedronBufferGeometry",function(){return IcosahedronBufferGeometry}),__webpack_require__.d(__webpack_exports__,"LatheGeometry",function(){return LatheGeometry}),__webpack_require__.d(__webpack_exports__,"LatheBufferGeometry",function(){return LatheBufferGeometry}),__webpack_require__.d(__webpack_exports__,"OctahedronGeometry",function(){return OctahedronGeometry}),__webpack_require__.d(__webpack_exports__,"OctahedronBufferGeometry",function(){return OctahedronBufferGeometry}),__webpack_require__.d(__webpack_exports__,"ParametricGeometry",function(){return ParametricGeometry}),__webpack_require__.d(__webpack_exports__,"ParametricBufferGeometry",function(){return ParametricBufferGeometry}),__webpack_require__.d(__webpack_exports__,"PlaneGeometry",function(){return PlaneGeometry}),__webpack_require__.d(__webpack_exports__,"PlaneBufferGeometry",function(){return PlaneBufferGeometry}),__webpack_require__.d(__webpack_exports__,"PolyhedronGeometry",function(){return PolyhedronGeometry}),__webpack_require__.d(__webpack_exports__,"PolyhedronBufferGeometry",function(){return PolyhedronBufferGeometry}),__webpack_require__.d(__webpack_exports__,"RingGeometry",function(){return RingGeometry}),__webpack_require__.d(__webpack_exports__,"RingBufferGeometry",function(){return RingBufferGeometry}),__webpack_require__.d(__webpack_exports__,"ShapeGeometry",function(){return ShapeGeometry}),__webpack_require__.d(__webpack_exports__,"ShapeBufferGeometry",function(){return ShapeBufferGeometry}),__webpack_require__.d(__webpack_exports__,"SphereGeometry",function(){return SphereGeometry}),__webpack_require__.d(__webpack_exports__,"SphereBufferGeometry",function(){return SphereBufferGeometry}),__webpack_require__.d(__webpack_exports__,"TetrahedronGeometry",function(){return TetrahedronGeometry}),__webpack_require__.d(__webpack_exports__,"TetrahedronBufferGeometry",function(){return TetrahedronBufferGeometry}),__webpack_require__.d(__webpack_exports__,"TextGeometry",function(){return TextGeometry}),__webpack_require__.d(__webpack_exports__,"TextBufferGeometry",function(){return TextBufferGeometry}),__webpack_require__.d(__webpack_exports__,"TorusGeometry",function(){return TorusGeometry}),__webpack_require__.d(__webpack_exports__,"TorusBufferGeometry",function(){return TorusBufferGeometry}),__webpack_require__.d(__webpack_exports__,"TorusKnotGeometry",function(){return TorusKnotGeometry}),__webpack_require__.d(__webpack_exports__,"TorusKnotBufferGeometry",function(){return TorusKnotBufferGeometry}),__webpack_require__.d(__webpack_exports__,"TubeGeometry",function(){return TubeGeometry}),__webpack_require__.d(__webpack_exports__,"TubeBufferGeometry",function(){return TubeBufferGeometry}),__webpack_require__.d(__webpack_exports__,"WireframeGeometry",function(){return WireframeGeometry}),__webpack_require__.d(__webpack_exports__,"ArrowHelper",function(){return ArrowHelper}),__webpack_require__.d(__webpack_exports__,"AxesHelper",function(){return AxesHelper}),__webpack_require__.d(__webpack_exports__,"Box3Helper",function(){return Box3Helper}),__webpack_require__.d(__webpack_exports__,"BoxHelper",function(){return BoxHelper}),__webpack_require__.d(__webpack_exports__,"CameraHelper",function(){return CameraHelper}),__webpack_require__.d(__webpack_exports__,"DirectionalLightHelper",function(){return DirectionalLightHelper}),__webpack_require__.d(__webpack_exports__,"FaceNormalsHelper",function(){return FaceNormalsHelper}),__webpack_require__.d(__webpack_exports__,"GridHelper",function(){return GridHelper}),__webpack_require__.d(__webpack_exports__,"HemisphereLightHelper",function(){return HemisphereLightHelper}),__webpack_require__.d(__webpack_exports__,"PlaneHelper",function(){return PlaneHelper}),__webpack_require__.d(__webpack_exports__,"PointLightHelper",function(){return PointLightHelper}),__webpack_require__.d(__webpack_exports__,"PolarGridHelper",function(){return PolarGridHelper}),__webpack_require__.d(__webpack_exports__,"PositionalAudioHelper",function(){return PositionalAudioHelper}),__webpack_require__.d(__webpack_exports__,"RectAreaLightHelper",function(){return RectAreaLightHelper}),__webpack_require__.d(__webpack_exports__,"SkeletonHelper",function(){return SkeletonHelper}),__webpack_require__.d(__webpack_exports__,"SpotLightHelper",function(){return SpotLightHelper}),__webpack_require__.d(__webpack_exports__,"VertexNormalsHelper",function(){return VertexNormalsHelper}),__webpack_require__.d(__webpack_exports__,"AmbientLight",function(){return AmbientLight}),__webpack_require__.d(__webpack_exports__,"DirectionalLight",function(){return DirectionalLight}),__webpack_require__.d(__webpack_exports__,"DirectionalLightShadow",function(){return DirectionalLightShadow}),__webpack_require__.d(__webpack_exports__,"HemisphereLight",function(){return HemisphereLight}),__webpack_require__.d(__webpack_exports__,"Light",function(){return Light}),__webpack_require__.d(__webpack_exports__,"LightShadow",function(){return LightShadow}),__webpack_require__.d(__webpack_exports__,"PointLight",function(){return PointLight}),__webpack_require__.d(__webpack_exports__,"RectAreaLight",function(){return RectAreaLight}),__webpack_require__.d(__webpack_exports__,"SpotLight",function(){return SpotLight}),__webpack_require__.d(__webpack_exports__,"SpotLightShadow",function(){return SpotLightShadow}),__webpack_require__.d(__webpack_exports__,"AnimationLoader",function(){return AnimationLoader}),__webpack_require__.d(__webpack_exports__,"AudioLoader",function(){return AudioLoader}),__webpack_require__.d(__webpack_exports__,"BufferGeometryLoader",function(){return BufferGeometryLoader}),__webpack_require__.d(__webpack_exports__,"Cache",function(){return Cache}),__webpack_require__.d(__webpack_exports__,"CompressedTextureLoader",function(){return CompressedTextureLoader}),__webpack_require__.d(__webpack_exports__,"CubeTextureLoader",function(){return CubeTextureLoader}),__webpack_require__.d(__webpack_exports__,"DataTextureLoader",function(){return DataTextureLoader}),__webpack_require__.d(__webpack_exports__,"FileLoader",function(){return FileLoader}),__webpack_require__.d(__webpack_exports__,"FontLoader",function(){return FontLoader}),__webpack_require__.d(__webpack_exports__,"ImageBitmapLoader",function(){return ImageBitmapLoader}),__webpack_require__.d(__webpack_exports__,"ImageLoader",function(){return ImageLoader}),__webpack_require__.d(__webpack_exports__,"Loader",function(){return Loader$1}),__webpack_require__.d(__webpack_exports__,"LoaderUtils",function(){return LoaderUtils}),__webpack_require__.d(__webpack_exports__,"DefaultLoadingManager",function(){return DefaultLoadingManager}),__webpack_require__.d(__webpack_exports__,"LoadingManager",function(){return LoadingManager}),__webpack_require__.d(__webpack_exports__,"MaterialLoader",function(){return MaterialLoader}),__webpack_require__.d(__webpack_exports__,"ObjectLoader",function(){return ObjectLoader}),__webpack_require__.d(__webpack_exports__,"TextureLoader",function(){return TextureLoader}),__webpack_require__.d(__webpack_exports__,"LineBasicMaterial",function(){return LineBasicMaterial}),__webpack_require__.d(__webpack_exports__,"LineDashedMaterial",function(){return LineDashedMaterial}),__webpack_require__.d(__webpack_exports__,"Material",function(){return Material$1}),__webpack_require__.d(__webpack_exports__,"MeshBasicMaterial",function(){return MeshBasicMaterial}),__webpack_require__.d(__webpack_exports__,"MeshDepthMaterial",function(){return MeshDepthMaterial}),__webpack_require__.d(__webpack_exports__,"MeshDistanceMaterial",function(){return MeshDistanceMaterial}),__webpack_require__.d(__webpack_exports__,"MeshLambertMaterial",function(){return MeshLambertMaterial}),__webpack_require__.d(__webpack_exports__,"MeshMatcapMaterial",function(){return MeshMatcapMaterial}),__webpack_require__.d(__webpack_exports__,"MeshNormalMaterial",function(){return MeshNormalMaterial}),__webpack_require__.d(__webpack_exports__,"MeshPhongMaterial",function(){return MeshPhongMaterial}),__webpack_require__.d(__webpack_exports__,"MeshPhysicalMaterial",function(){return MeshPhysicalMaterial}),__webpack_require__.d(__webpack_exports__,"MeshStandardMaterial",function(){return MeshStandardMaterial}),__webpack_require__.d(__webpack_exports__,"MeshToonMaterial",function(){return MeshToonMaterial}),__webpack_require__.d(__webpack_exports__,"PointsMaterial",function(){return PointsMaterial}),__webpack_require__.d(__webpack_exports__,"RawShaderMaterial",function(){return RawShaderMaterial}),__webpack_require__.d(__webpack_exports__,"ShaderMaterial",function(){return ShaderMaterial}),__webpack_require__.d(__webpack_exports__,"ShadowMaterial",function(){return ShadowMaterial}),__webpack_require__.d(__webpack_exports__,"SpriteMaterial",function(){return SpriteMaterial}),__webpack_require__.d(__webpack_exports__,"Box2",function(){return Box2}),__webpack_require__.d(__webpack_exports__,"Box3",function(){return Box3}),__webpack_require__.d(__webpack_exports__,"Color",function(){return Color}),__webpack_require__.d(__webpack_exports__,"Cylindrical",function(){return Cylindrical}),__webpack_require__.d(__webpack_exports__,"Euler",function(){return Euler}),__webpack_require__.d(__webpack_exports__,"Frustum",function(){return Frustum}),__webpack_require__.d(__webpack_exports__,"Interpolant",function(){return Interpolant}),__webpack_require__.d(__webpack_exports__,"CubicInterpolant",function(){return CubicInterpolant}),__webpack_require__.d(__webpack_exports__,"DiscreteInterpolant",function(){return DiscreteInterpolant}),__webpack_require__.d(__webpack_exports__,"LinearInterpolant",function(){return LinearInterpolant}),__webpack_require__.d(__webpack_exports__,"QuaternionLinearInterpolant",function(){return QuaternionLinearInterpolant}),__webpack_require__.d(__webpack_exports__,"Line3",function(){return Line3}),__webpack_require__.d(__webpack_exports__,"_Math",function(){return _Math}),__webpack_require__.d(__webpack_exports__,"Matrix3",function(){return Matrix3}),__webpack_require__.d(__webpack_exports__,"Matrix4",function(){return Matrix4}),__webpack_require__.d(__webpack_exports__,"Plane",function(){return Plane}),__webpack_require__.d(__webpack_exports__,"Quaternion",function(){return Quaternion}),__webpack_require__.d(__webpack_exports__,"Ray",function(){return Ray}),__webpack_require__.d(__webpack_exports__,"Sphere",function(){return Sphere}),__webpack_require__.d(__webpack_exports__,"Spherical",function(){return Spherical}),__webpack_require__.d(__webpack_exports__,"Triangle",function(){return Triangle}),__webpack_require__.d(__webpack_exports__,"Vector2",function(){return Vector2}),__webpack_require__.d(__webpack_exports__,"Vector3",function(){return Vector3}),__webpack_require__.d(__webpack_exports__,"Vector4",function(){return Vector4}),__webpack_require__.d(__webpack_exports__,"Bone",function(){return Bone}),__webpack_require__.d(__webpack_exports__,"Group",function(){return Group}),__webpack_require__.d(__webpack_exports__,"Line",function(){return Line}),__webpack_require__.d(__webpack_exports__,"LineLoop",function(){return LineLoop}),__webpack_require__.d(__webpack_exports__,"LineSegments",function(){return LineSegments}),__webpack_require__.d(__webpack_exports__,"LOD",function(){return LOD}),__webpack_require__.d(__webpack_exports__,"Mesh",function(){return Mesh}),__webpack_require__.d(__webpack_exports__,"Points",function(){return Points}),__webpack_require__.d(__webpack_exports__,"Skeleton",function(){return Skeleton}),__webpack_require__.d(__webpack_exports__,"SkinnedMesh",function(){return SkinnedMesh}),__webpack_require__.d(__webpack_exports__,"Sprite",function(){return Sprite}),__webpack_require__.d(__webpack_exports__,"ShaderChunk",function(){return ShaderChunk}),__webpack_require__.d(__webpack_exports__,"ShaderLib",function(){return ShaderLib}),__webpack_require__.d(__webpack_exports__,"UniformsLib",function(){return UniformsLib}),__webpack_require__.d(__webpack_exports__,"UniformsUtils",function(){return UniformsUtils}),__webpack_require__.d(__webpack_exports__,"WebGLAnimation",function(){return WebGLAnimation}),__webpack_require__.d(__webpack_exports__,"WebGLAttributes",function(){return WebGLAttributes}),__webpack_require__.d(__webpack_exports__,"WebGLBackground",function(){return WebGLBackground}),__webpack_require__.d(__webpack_exports__,"WebGLBufferRenderer",function(){return WebGLBufferRenderer}),__webpack_require__.d(__webpack_exports__,"WebGLCapabilities",function(){return WebGLCapabilities}),__webpack_require__.d(__webpack_exports__,"WebGLClipping",function(){return WebGLClipping}),__webpack_require__.d(__webpack_exports__,"WebGLExtensions",function(){return WebGLExtensions}),__webpack_require__.d(__webpack_exports__,"WebGLGeometries",function(){return WebGLGeometries}),__webpack_require__.d(__webpack_exports__,"WebGLIndexedBufferRenderer",function(){return WebGLIndexedBufferRenderer}),__webpack_require__.d(__webpack_exports__,"WebGLInfo",function(){return WebGLInfo}),__webpack_require__.d(__webpack_exports__,"WebGLLights",function(){return WebGLLights}),__webpack_require__.d(__webpack_exports__,"WebGLMorphtargets",function(){return WebGLMorphtargets}),__webpack_require__.d(__webpack_exports__,"WebGLObjects",function(){return WebGLObjects}),__webpack_require__.d(__webpack_exports__,"WebGLProgram",function(){return WebGLProgram}),__webpack_require__.d(__webpack_exports__,"WebGLPrograms",function(){return WebGLPrograms}),__webpack_require__.d(__webpack_exports__,"WebGLProperties",function(){return WebGLProperties}),__webpack_require__.d(__webpack_exports__,"WebGLRenderLists",function(){return WebGLRenderLists}),__webpack_require__.d(__webpack_exports__,"WebGLRenderStates",function(){return WebGLRenderStates}),__webpack_require__.d(__webpack_exports__,"WebGLShader",function(){return WebGLShader}),__webpack_require__.d(__webpack_exports__,"WebGLShadowMap",function(){return WebGLShadowMap}),__webpack_require__.d(__webpack_exports__,"WebGLState",function(){return WebGLState}),__webpack_require__.d(__webpack_exports__,"WebGLTextures",function(){return WebGLTextures}),__webpack_require__.d(__webpack_exports__,"WebGLUniforms",function(){return WebGLUniforms}),__webpack_require__.d(__webpack_exports__,"WebGLUtils",function(){return WebGLUtils}),__webpack_require__.d(__webpack_exports__,"WebGL2Renderer",function(){return WebGL2Renderer}),__webpack_require__.d(__webpack_exports__,"WebGLMultisampleRenderTarget",function(){return WebGLMultisampleRenderTarget}),__webpack_require__.d(__webpack_exports__,"WebGLRenderer",function(){return WebGLRenderer}),__webpack_require__.d(__webpack_exports__,"WebGLRenderTarget",function(){return WebGLRenderTarget}),__webpack_require__.d(__webpack_exports__,"WebGLRenderTargetCube",function(){return WebGLRenderTargetCube}),__webpack_require__.d(__webpack_exports__,"WebVRManager",function(){return WebVRManager}),__webpack_require__.d(__webpack_exports__,"setProjectionFromUnion",function(){return setProjectionFromUnion}),__webpack_require__.d(__webpack_exports__,"WebXRManager",function(){return WebXRManager}),__webpack_require__.d(__webpack_exports__,"Fog",function(){return Fog}),__webpack_require__.d(__webpack_exports__,"FogExp2",function(){return FogExp2}),__webpack_require__.d(__webpack_exports__,"Scene",function(){return Scene}),__webpack_require__.d(__webpack_exports__,"CanvasTexture",function(){return CanvasTexture}),__webpack_require__.d(__webpack_exports__,"CompressedTexture",function(){return CompressedTexture}),__webpack_require__.d(__webpack_exports__,"CubeTexture",function(){return CubeTexture}),__webpack_require__.d(__webpack_exports__,"DataTexture",function(){return DataTexture}),__webpack_require__.d(__webpack_exports__,"DataTexture3D",function(){return DataTexture3D}),__webpack_require__.d(__webpack_exports__,"DepthTexture",function(){return DepthTexture}),__webpack_require__.d(__webpack_exports__,"Texture",function(){return Texture}),__webpack_require__.d(__webpack_exports__,"VideoTexture",function(){return VideoTexture}),__webpack_require__.d(__webpack_exports__,"arrayMin",function(){return arrayMin}),__webpack_require__.d(__webpack_exports__,"arrayMax",function(){return arrayMax}),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){var t=arguments;if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),r=1;r<arguments.length;r++){var n=t[r];if(null!=n)for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(i[o]=n[o])}return i});var _Math={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&i]+e[i>>8&255]+"-"+e[i>>16&15|64]+e[i>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255]).toUpperCase()}}(),clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*_Math.DEG2RAD},radToDeg:function(e){return e*_Math.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}},vector,matrix,x,y,z,zero,one,v1,min,max,quaternion,q;function Matrix4(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("Matrix4: the constructor no longer reads arguments. use .set() instead.")}function Vector3(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0}function Quaternion(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==r?r:1}function EventDispatcher(){}function Euler(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._order=r||Euler.DefaultOrder}function Layers(){this.mask=1}function Matrix3(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Matrix4.prototype,{isMatrix4:!0,set:function(e,t,i,r,n,o,a,s,l,u,h,c,d,p,f,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=i,v[12]=r,v[1]=n,v[5]=o,v[9]=a,v[13]=s,v[2]=l,v[6]=u,v[10]=h,v[14]=c,v[3]=d,v[7]=p,v[11]=f,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Matrix4).fromArray(this.elements)},copy:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractBasis:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:(v1=new Vector3,function(e){var t=this.elements,i=e.elements,r=1/v1.setFromMatrixColumn(e,0).length(),n=1/v1.setFromMatrixColumn(e,1).length(),o=1/v1.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,r=e.y,n=e.z,o=Math.cos(i),a=Math.sin(i),s=Math.cos(r),l=Math.sin(r),u=Math.cos(n),h=Math.sin(n);if("XYZ"===e.order){var c=o*u,d=o*h,p=a*u,f=a*h;t[0]=s*u,t[4]=-s*h,t[8]=l,t[1]=d+p*l,t[5]=c-f*l,t[9]=-a*s,t[2]=f-c*l,t[6]=p+d*l,t[10]=o*s}else if("YXZ"===e.order){var m=s*u,v=s*h,g=l*u,y=l*h;t[0]=m+y*a,t[4]=g*a-v,t[8]=o*l,t[1]=o*h,t[5]=o*u,t[9]=-a,t[2]=v*a-g,t[6]=y+m*a,t[10]=o*s}else if("ZXY"===e.order){m=s*u,v=s*h,g=l*u,y=l*h;t[0]=m-y*a,t[4]=-o*h,t[8]=g+v*a,t[1]=v+g*a,t[5]=o*u,t[9]=y-m*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){c=o*u,d=o*h,p=a*u,f=a*h;t[0]=s*u,t[4]=p*l-d,t[8]=c*l+f,t[1]=s*h,t[5]=f*l+c,t[9]=d*l-p,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var _=o*s,b=o*l,x=a*s,w=a*l;t[0]=s*u,t[4]=w-_*h,t[8]=x*h+b,t[1]=h,t[5]=o*u,t[9]=-a*u,t[2]=-l*u,t[6]=b*h+x,t[10]=_-w*h}else if("XZY"===e.order){_=o*s,b=o*l,x=a*s,w=a*l;t[0]=s*u,t[4]=-h,t[8]=l*u,t[1]=_*h+w,t[5]=o*u,t[9]=b*h-x,t[2]=x*h-b,t[6]=a*u,t[10]=w*h+_}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:(zero=new Vector3(0,0,0),one=new Vector3(1,1,1),function(e){return this.compose(zero,e,one)}),lookAt:(x=new Vector3,y=new Vector3,z=new Vector3,function(e,t,i){var r=this.elements;return z.subVectors(e,t),0===z.lengthSq()&&(z.z=1),z.normalize(),x.crossVectors(i,z),0===x.lengthSq()&&(1===Math.abs(i.z)?z.x+=1e-4:z.z+=1e-4,z.normalize(),x.crossVectors(i,z)),x.normalize(),y.crossVectors(z,x),r[0]=x.x,r[4]=y.x,r[8]=z.x,r[1]=x.y,r[5]=y.y,r[9]=z.y,r[2]=x.z,r[6]=y.z,r[10]=z.z,this}),multiply:function(e,t){return void 0!==t?(console.warn("Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],a=i[4],s=i[8],l=i[12],u=i[1],h=i[5],c=i[9],d=i[13],p=i[2],f=i[6],m=i[10],v=i[14],g=i[3],y=i[7],_=i[11],b=i[15],x=r[0],w=r[4],S=r[8],M=r[12],T=r[1],A=r[5],C=r[9],L=r[13],N=r[2],P=r[6],k=r[10],E=r[14],D=r[3],O=r[7],R=r[11],F=r[15];return n[0]=o*x+a*T+s*N+l*D,n[4]=o*w+a*A+s*P+l*O,n[8]=o*S+a*C+s*k+l*R,n[12]=o*M+a*L+s*E+l*F,n[1]=u*x+h*T+c*N+d*D,n[5]=u*w+h*A+c*P+d*O,n[9]=u*S+h*C+c*k+d*R,n[13]=u*M+h*L+c*E+d*F,n[2]=p*x+f*T+m*N+v*D,n[6]=p*w+f*A+m*P+v*O,n[10]=p*S+f*C+m*k+v*R,n[14]=p*M+f*L+m*E+v*F,n[3]=g*x+y*T+_*N+b*D,n[7]=g*w+y*A+_*P+b*O,n[11]=g*S+y*C+_*k+b*R,n[15]=g*M+y*L+_*E+b*F,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new Vector3;return function(t){for(var i=0,r=t.count;i<r;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.applyMatrix4(this),t.setXYZ(i,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],o=e[1],a=e[5],s=e[9],l=e[13],u=e[2],h=e[6],c=e[10],d=e[14];return e[3]*(+n*s*h-r*l*h-n*a*c+i*l*c+r*a*d-i*s*d)+e[7]*(+t*s*d-t*l*c+n*o*c-r*o*d+r*l*u-n*s*u)+e[11]*(+t*l*h-t*a*d-n*o*h+i*o*d+n*a*u-i*l*u)+e[15]*(-r*a*u-t*s*h+t*a*c+r*o*h-i*o*c+i*s*u)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,r=e.elements,n=r[0],o=r[1],a=r[2],s=r[3],l=r[4],u=r[5],h=r[6],c=r[7],d=r[8],p=r[9],f=r[10],m=r[11],v=r[12],g=r[13],y=r[14],_=r[15],b=p*y*c-g*f*c+g*h*m-u*y*m-p*h*_+u*f*_,x=v*f*c-d*y*c-v*h*m+l*y*m+d*h*_-l*f*_,w=d*g*c-v*p*c+v*u*m-l*g*m-d*u*_+l*p*_,S=v*p*h-d*g*h-v*u*f+l*g*f+d*u*y-l*p*y,M=n*b+o*x+a*w+s*S;if(0===M){var T="Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(T);return console.warn(T),this.identity()}var A=1/M;return i[0]=b*A,i[1]=(g*f*s-p*y*s-g*a*m+o*y*m+p*a*_-o*f*_)*A,i[2]=(u*y*s-g*h*s+g*a*c-o*y*c-u*a*_+o*h*_)*A,i[3]=(p*h*s-u*f*s-p*a*c+o*f*c+u*a*m-o*h*m)*A,i[4]=x*A,i[5]=(d*y*s-v*f*s+v*a*m-n*y*m-d*a*_+n*f*_)*A,i[6]=(v*h*s-l*y*s-v*a*c+n*y*c+l*a*_-n*h*_)*A,i[7]=(l*f*s-d*h*s+d*a*c-n*f*c-l*a*m+n*h*m)*A,i[8]=w*A,i[9]=(v*p*s-d*g*s-v*o*m+n*g*m+d*o*_-n*p*_)*A,i[10]=(l*g*s-v*u*s+v*o*c-n*g*c-l*o*_+n*u*_)*A,i[11]=(d*u*s-l*p*s-d*o*c+n*p*c+l*o*m-n*u*m)*A,i[12]=S*A,i[13]=(d*g*a-v*p*a+v*o*f-n*g*f-d*o*y+n*p*y)*A,i[14]=(v*u*a-l*g*a-v*o*h+n*g*h+l*o*y-n*u*y)*A,i[15]=(l*p*a-d*u*a+d*o*h-n*p*h-l*o*f+n*u*f)*A,this},scale:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,a=e.y,s=e.z,l=n*o,u=n*a;return this.set(l*o+i,l*a-r*s,l*s+r*a,0,l*a+r*s,u*a+i,u*s-r*o,0,l*s-r*a,u*s+r*o,n*s*s+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,i){var r=this.elements,n=t._x,o=t._y,a=t._z,s=t._w,l=n+n,u=o+o,h=a+a,c=n*l,d=n*u,p=n*h,f=o*u,m=o*h,v=a*h,g=s*l,y=s*u,_=s*h,b=i.x,x=i.y,w=i.z;return r[0]=(1-(f+v))*b,r[1]=(d+_)*b,r[2]=(p-y)*b,r[3]=0,r[4]=(d-_)*x,r[5]=(1-(c+v))*x,r[6]=(m+g)*x,r[7]=0,r[8]=(p+y)*w,r[9]=(m-g)*w,r[10]=(1-(c+f))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this},decompose:(vector=new Vector3,matrix=new Matrix4,function(e,t,i){var r=this.elements,n=vector.set(r[0],r[1],r[2]).length(),o=vector.set(r[4],r[5],r[6]).length(),a=vector.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),e.x=r[12],e.y=r[13],e.z=r[14],matrix.copy(this);var s=1/n,l=1/o,u=1/a;return matrix.elements[0]*=s,matrix.elements[1]*=s,matrix.elements[2]*=s,matrix.elements[4]*=l,matrix.elements[5]*=l,matrix.elements[6]*=l,matrix.elements[8]*=u,matrix.elements[9]*=u,matrix.elements[10]*=u,t.setFromRotationMatrix(matrix),i.x=n,i.y=o,i.z=a,this}),makePerspective:function(e,t,i,r,n,o){void 0===o&&console.warn("Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*n/(t-e),l=2*n/(i-r),u=(t+e)/(t-e),h=(i+r)/(i-r),c=-(o+n)/(o-n),d=-2*o*n/(o-n);return a[0]=s,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=l,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=c,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(e,t,i,r,n,o){var a=this.elements,s=1/(t-e),l=1/(i-r),u=1/(o-n),h=(t+e)*s,c=(i+r)*l,d=(o+n)*u;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-c,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){for(var t=this.elements,i=e.elements,r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<16;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}),Object.assign(Vector3.prototype,{isVector3:!0,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:(quaternion=new Quaternion,function(e){return e&&e.isEuler||console.error("Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(quaternion.setFromEuler(e))}),applyAxisAngle:function(){var e=new Quaternion;return function(t,i){return this.applyQuaternion(e.setFromAxisAngle(t,i))}}(),applyMatrix3:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements,o=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*o,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*o,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*o,this},applyQuaternion:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*r-a*i,u=s*i+a*t-n*r,h=s*r+n*i-o*t,c=-n*t-o*i-a*r;return this.x=l*s+c*-n+u*-a-h*-o,this.y=u*s+c*-o+h*-n-l*-a,this.z=h*s+c*-a+l*-o-u*-n,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(){var e=new Matrix4;return function(t){return this.applyMatrix4(e.getInverse(t.projectionMatrix)).applyMatrix4(t.matrixWorld)}}(),transformDirection:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:(min=new Vector3,max=new Vector3,function(e,t){return min.set(e,e,e),max.set(t,t,t),this.clamp(min,max)}),clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},cross:function(e,t){return void 0!==t?(console.warn("Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var i=e.x,r=e.y,n=e.z,o=t.x,a=t.y,s=t.z;return this.x=r*s-n*a,this.y=n*o-i*s,this.z=i*a-r*o,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new Vector3;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new Vector3;return function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(_Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,i){var r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(Quaternion,{slerp:function(e,t,i,r){return i.copy(e).slerp(t,r)},slerpFlat:function(e,t,i,r,n,o,a){var s=i[r+0],l=i[r+1],u=i[r+2],h=i[r+3],c=n[o+0],d=n[o+1],p=n[o+2],f=n[o+3];if(h!==f||s!==c||l!==d||u!==p){var m=1-a,v=s*c+l*d+u*p+h*f,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var _=Math.sqrt(y),b=Math.atan2(_,v*g);m=Math.sin(m*b)/_,a=Math.sin(a*b)/_}var x=a*g;if(s=s*m+c*x,l=l*m+d*x,u=u*m+p*x,h=h*m+f*x,m===1-a){var w=1/Math.sqrt(s*s+l*l+u*u+h*h);s*=w,l*=w,u*=w,h*=w}}e[t]=s,e[t+1]=l,e[t+2]=u,e[t+3]=h}}),Object.defineProperties(Quaternion.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(Quaternion.prototype,{isQuaternion:!0,set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=e._x,r=e._y,n=e._z,o=e.order,a=Math.cos,s=Math.sin,l=a(i/2),u=a(r/2),h=a(n/2),c=s(i/2),d=s(r/2),p=s(n/2);return"XYZ"===o?(this._x=c*u*h+l*d*p,this._y=l*d*h-c*u*p,this._z=l*u*p+c*d*h,this._w=l*u*h-c*d*p):"YXZ"===o?(this._x=c*u*h+l*d*p,this._y=l*d*h-c*u*p,this._z=l*u*p-c*d*h,this._w=l*u*h+c*d*p):"ZXY"===o?(this._x=c*u*h-l*d*p,this._y=l*d*h+c*u*p,this._z=l*u*p+c*d*h,this._w=l*u*h-c*d*p):"ZYX"===o?(this._x=c*u*h-l*d*p,this._y=l*d*h+c*u*p,this._z=l*u*p-c*d*h,this._w=l*u*h+c*d*p):"YZX"===o?(this._x=c*u*h+l*d*p,this._y=l*d*h+c*u*p,this._z=l*u*p-c*d*h,this._w=l*u*h-c*d*p):"XZY"===o&&(this._x=c*u*h-l*d*p,this._y=l*d*h-c*u*p,this._z=l*u*p+c*d*h,this._w=l*u*h+c*d*p),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,i=e.elements,r=i[0],n=i[4],o=i[8],a=i[1],s=i[5],l=i[9],u=i[2],h=i[6],c=i[10],d=r+s+c;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(h-l)*t,this._y=(o-u)*t,this._z=(a-n)*t):r>s&&r>c?(t=2*Math.sqrt(1+r-s-c),this._w=(h-l)/t,this._x=.25*t,this._y=(n+a)/t,this._z=(o+u)/t):s>c?(t=2*Math.sqrt(1+s-r-c),this._w=(o-u)/t,this._x=(n+a)/t,this._y=.25*t,this._z=(l+h)/t):(t=2*Math.sqrt(1+c-r-s),this._w=(a-n)/t,this._x=(o+u)/t,this._y=(l+h)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t=new Vector3;return function(i,r){return void 0===t&&(t=new Vector3),(e=i.dot(r)+1)<1e-6?(e=0,Math.abs(i.x)>Math.abs(i.z)?t.set(-i.y,i.x,0):t.set(0,-i.z,i.y)):t.crossVectors(i,r),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),angleTo:function(e){return 2*Math.acos(Math.abs(_Math.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var i=this.angleTo(e);if(0===i)return this;var r=Math.min(1,t/i);return this.slerp(e,r),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var i=e._x,r=e._y,n=e._z,o=e._w,a=t._x,s=t._y,l=t._z,u=t._w;return this._x=i*u+o*a+r*l-n*s,this._y=r*u+o*s+n*a-i*l,this._z=n*u+o*l+i*s-r*a,this._w=o*u-i*a-r*s-n*l,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,r=this._y,n=this._z,o=this._w,a=o*e._w+i*e._x+r*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=n,this;var s=1-a*a;if(s<=Number.EPSILON){var l=1-t;return this._w=l*o+t*this._w,this._x=l*i+t*this._x,this._y=l*r+t*this._y,this._z=l*n+t*this._z,this.normalize()}var u=Math.sqrt(s),h=Math.atan2(u,a),c=Math.sin((1-t)*h)/u,d=Math.sin(t*h)/u;return this._w=o*c+this._w*d,this._x=i*c+this._x*d,this._y=r*c+this._y*d,this._z=n*c+this._z*d,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(EventDispatcher.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners[e];if(void 0!==i){var r=i.indexOf(t);-1!==r&&i.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var i=t.slice(0),r=0,n=i.length;r<n;r++)i[r].call(this,e)}}}}),Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Euler.DefaultOrder="XYZ",Object.defineProperties(Euler.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),Object.assign(Euler.prototype,{isEuler:!0,set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._order=r||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,i){var r=_Math.clamp,n=e.elements,o=n[0],a=n[4],s=n[8],l=n[1],u=n[5],h=n[9],c=n[2],d=n[6],p=n[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(r(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(d,u),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(h,-1,1)),Math.abs(h)<.99999?(this._y=Math.atan2(s,p),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-c,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-c,p),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===t?(this._y=Math.asin(-r(c,-1,1)),Math.abs(c)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,u))):"YZX"===t?(this._z=Math.asin(r(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-h,u),this._y=Math.atan2(-c,o)):(this._x=0,this._y=Math.atan2(s,p))):"XZY"===t?(this._z=Math.asin(-r(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(d,u),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-h,p),this._y=0)):console.warn("Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==i&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new Matrix4;return function(t,i,r){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,i,r)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:(q=new Quaternion,function(e){return q.setFromEuler(this),this.setFromQuaternion(q,e)}),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(Layers.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!=(this.mask&e.mask)}}),Object.assign(Matrix3.prototype,{isMatrix3:!0,set:function(e,t,i,r,n,o,a,s,l){var u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=n,u[5]=s,u[6]=i,u[7]=o,u[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(){var e=new Vector3;return function(t){for(var i=0,r=t.count;i<r;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.applyMatrix3(this),t.setXYZ(i,e.x,e.y,e.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],a=i[3],s=i[6],l=i[1],u=i[4],h=i[7],c=i[2],d=i[5],p=i[8],f=r[0],m=r[3],v=r[6],g=r[1],y=r[4],_=r[7],b=r[2],x=r[5],w=r[8];return n[0]=o*f+a*g+s*b,n[3]=o*m+a*y+s*x,n[6]=o*v+a*_+s*w,n[1]=l*f+u*g+h*b,n[4]=l*m+u*y+h*x,n[7]=l*v+u*_+h*w,n[2]=c*f+d*g+p*b,n[5]=c*m+d*y+p*x,n[8]=c*v+d*_+p*w,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],a=e[5],s=e[6],l=e[7],u=e[8];return t*o*u-t*a*l-i*n*u+i*a*s+r*n*l-r*o*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("Matrix3: .getInverse() no longer takes a Matrix4 argument.");var i=e.elements,r=this.elements,n=i[0],o=i[1],a=i[2],s=i[3],l=i[4],u=i[5],h=i[6],c=i[7],d=i[8],p=d*l-u*c,f=u*h-d*s,m=c*s-l*h,v=n*p+o*f+a*m;if(0===v){var g="Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return r[0]=p*y,r[1]=(a*c-d*o)*y,r[2]=(u*o-a*l)*y,r[3]=f*y,r[4]=(d*n-a*h)*y,r[5]=(a*s-u*n)*y,r[6]=m*y,r[7]=(o*h-c*n)*y,r[8]=(l*n-o*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,i,r,n,o,a){var s=Math.cos(n),l=Math.sin(n);this.set(i*s,i*l,-i*(s*o+l*a)+o+e,-r*l,r*s,-r*(-l*o+s*a)+a+t,0,0,1)},scale:function(e,t){var i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this},rotate:function(e){var t=Math.cos(e),i=Math.sin(e),r=this.elements,n=r[0],o=r[3],a=r[6],s=r[1],l=r[4],u=r[7];return r[0]=t*n+i*s,r[3]=t*o+i*l,r[6]=t*a+i*u,r[1]=-i*n+t*s,r[4]=-i*o+t*l,r[7]=-i*a+t*u,this},translate:function(e,t){var i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this},equals:function(e){for(var t=this.elements,i=e.elements,r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<9;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}});var REVISION="102",MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,CullFaceFrontBack=3,FrontFaceDirectionCW=0,FrontFaceDirectionCCW=1,BasicShadowMap=0,PCFShadowMap=1,PCFSoftShadowMap=2,FrontSide=0,BackSide=1,DoubleSide=2,FlatShading=1,SmoothShading=2,NoColors=0,FaceColors=1,VertexColors=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,Uncharted2ToneMapping=3,CineonToneMapping=4,ACESFilmicToneMapping=5,UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,SphericalReflectionMapping=305,CubeUVReflectionMapping=306,CubeUVRefractionMapping=307,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipMapNearestFilter=1004,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipMapNearestFilter=1007,LinearMipMapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedShort565Type=1019,UnsignedInt248Type=1020,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,RGBEFormat=RGBAFormat,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,LinearEncoding=3e3,sRGBEncoding=3001,GammaEncoding=3007,RGBEEncoding=3002,LogLuvEncoding=3003,RGBM7Encoding=3004,RGBM16Encoding=3005,RGBDEncoding=3006,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,object3DId=0,position,scale,m1,q1;function Object3D(){Object.defineProperty(this,"id",{value:object3DId++}),this.uuid=_Math.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();var e=new Vector3,t=new Euler,i=new Quaternion,r=new Vector3(1,1,1);t.onChange(function(){i.setFromEuler(t,!1)}),i.onChange(function(){t.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}Object3D.DefaultUp=new Vector3(0,1,0),Object3D.DefaultMatrixAutoUpdate=!0,Object3D.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Object3D,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:(q1=new Quaternion,function(e,t){return q1.setFromAxisAngle(e,t),this.quaternion.multiply(q1),this}),rotateOnWorldAxis:function(){var e=new Quaternion;return function(t,i){return e.setFromAxisAngle(t,i),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new Vector3;return function(t,i){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(i)),this}}(),translateX:function(){var e=new Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:(m1=new Matrix4,function(e){return e.applyMatrix4(m1.getInverse(this.matrixWorld))}),lookAt:function(){var e=new Quaternion,t=new Matrix4,i=new Vector3,r=new Vector3;return function(n,o,a){n.isVector3?i.copy(n):i.set(n,o,a);var s=this.parent;this.updateWorldMatrix(!0,!1),r.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?t.lookAt(r,i,this.up):t.lookAt(i,r,this.up),this.quaternion.setFromRotationMatrix(t),s&&(t.extractRotation(s.matrixWorld),e.setFromRotationMatrix(t),this.quaternion.premultiply(e.inverse()))}}(),add:function(e){var t=arguments;if(arguments.length>1){for(var i=0;i<arguments.length;i++)this.add(t[i]);return this}return e===this?(console.error("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("Object3D.add: object not an instance of Object3D.",e),this)},remove:function(e){var t=arguments;if(arguments.length>1){for(var i=0;i<arguments.length;i++)this.remove(t[i]);return this}var r=this.children.indexOf(e);return-1!==r&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(r,1)),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}},getWorldPosition:function(e){return void 0===e&&(console.warn("Object3D: .getWorldPosition() target is now required"),e=new Vector3),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(position=new Vector3,scale=new Vector3,function(e){return void 0===e&&(console.warn("Object3D: .getWorldQuaternion() target is now required"),e=new Quaternion),this.updateMatrixWorld(!0),this.matrixWorld.decompose(position,e,scale),e}),getWorldScale:function(){var e=new Vector3,t=new Quaternion;return function(i){return void 0===i&&(console.warn("Object3D: .getWorldScale() target is now required"),i=new Vector3),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,i),i}}(),getWorldDirection:function(e){void 0===e&&(console.warn("Object3D: .getWorldDirection() target is now required"),e=new Vector3),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,n=0,o=r.length;n<o;n++)r[n].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function n(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isMesh&&this.drawMode!==TrianglesDrawMode&&(r.drawMode=this.drawMode),this.isMesh||this.isLine||this.isPoints){r.geometry=n(e.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,l=a.length;s<l;s++){var u=a[s];n(e.shapes,u)}else n(e.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var h=[];for(s=0,l=this.material.length;s<l;s++)h.push(n(e.materials,this.material[s]));r.material=h}else r.material=n(e.materials,this.material);if(this.children.length>0){r.children=[];for(s=0;s<this.children.length;s++)r.children.push(this.children[s].toJSON(e).object)}if(t){var c=m(e.geometries),d=m(e.materials),p=m(e.textures),f=m(e.images);a=m(e.shapes);c.length>0&&(i.geometries=c),d.length>0&&(i.materials=d),p.length>0&&(i.textures=p),f.length>0&&(i.images=f),a.length>0&&(i.shapes=a)}return i.object=r,i;function m(e){var t=[];for(var i in e){var r=e[i];delete r.metadata,t.push(r)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var i=0;i<e.children.length;i++){var r=e.children[i];this.add(r.clone())}return this}});var ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},hslA,hslB,hsl,points,closestPoint,box;function Color(e,t,i){return void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}function Face3(e,t,i,r,n,o){this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new Vector3,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new Color,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0!==o?o:0}function Box3(e,t){this.min=void 0!==e?e:new Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new Vector3(-1/0,-1/0,-1/0)}function Sphere(e,t){this.center=void 0!==e?e:new Vector3,this.radius=void 0!==t?t:0}function Vector2(e,t){this.x=e||0,this.y=t||0}Object.assign(Color.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(){function e(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}return function(t,i,r){if(t=_Math.euclideanModulo(t,1),i=_Math.clamp(i,0,1),r=_Math.clamp(r,0,1),0===i)this.r=this.g=this.b=r;else{var n=r<=.5?r*(1+i):r+i-r*i,o=2*r-n;this.r=e(o,n,t+1/3),this.g=e(o,n,t),this.b=e(o,n,t-1/3)}return this}}(),setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("Color: Alpha component of "+e+" will be ignored.")}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var r,n=i[1],o=i[2];switch(n){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(r[1])/360,s=parseInt(r[2],10)/100,l=parseInt(r[3],10)/100;return t(r[5]),this.setHSL(a,s,l)}}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(e)){var u,h=(u=i[1]).length;if(3===h)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===h)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}e&&e.length>0&&(void 0!==(u=ColorKeywords[e])?this.setHex(u):console.warn("Color: Unknown color "+e));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(){function e(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}return function(t){return this.r=e(t.r),this.g=e(t.g),this.b=e(t.b),this}}(),copyLinearToSRGB:function(){function e(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}return function(t){return this.r=e(t.r),this.g=e(t.g),this.b=e(t.b),this}}(),convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,i,r=this.r,n=this.g,o=this.b,a=Math.max(r,n,o),s=Math.min(r,n,o),l=(s+a)/2;if(s===a)t=0,i=0;else{var u=a-s;switch(i=l<=.5?u/(a+s):u/(2-a-s),a){case r:t=(n-o)/u+(n<o?6:0);break;case n:t=(o-r)/u+2;break;case o:t=(r-n)/u+4}t/=6}return e.h=t,e.s=i,e.l=l,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:(hsl={},function(e,t,i){return this.getHSL(hsl),hsl.h+=e,hsl.s+=t,hsl.l+=i,this.setHSL(hsl.h,hsl.s,hsl.l),this}),add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:(hslA={h:0,s:0,l:0},hslB={h:0,s:0,l:0},function(e,t){this.getHSL(hslA),e.getHSL(hslB);var i=_Math.lerp(hslA.h,hslB.h,t),r=_Math.lerp(hslA.s,hslB.s,t),n=_Math.lerp(hslA.l,hslB.l,t);return this.setHSL(i,r,n),this}),equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),Object.assign(Face3.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}),Object.assign(Box3.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,a=-1/0,s=0,l=e.length;s<l;s+=3){var u=e[s],h=e[s+1],c=e[s+2];u<t&&(t=u),h<i&&(i=h),c<r&&(r=c),u>n&&(n=u),h>o&&(o=h),c>a&&(a=c)}return this.min.set(t,i,r),this.max.set(n,o,a),this},setFromBufferAttribute:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,a=-1/0,s=0,l=e.count;s<l;s++){var u=e.getX(s),h=e.getY(s),c=e.getZ(s);u<t&&(t=u),h<i&&(i=h),c<r&&(r=c),u>n&&(n=u),h>o&&(o=h),c>a&&(a=c)}return this.min.set(t,i,r),this.max.set(n,o,a),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Vector3;return function(t,i){var r=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("Box3: .getCenter() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("Box3: .getSize() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){var e,t,i,r=new Vector3;function n(n){var o=n.geometry;if(void 0!==o)if(o.isGeometry){var a=o.vertices;for(t=0,i=a.length;t<i;t++)r.copy(a[t]),r.applyMatrix4(n.matrixWorld),e.expandByPoint(r)}else if(o.isBufferGeometry){var s=o.attributes.position;if(void 0!==s)for(t=0,i=s.count;t<i;t++)r.fromBufferAttribute(s,t).applyMatrix4(n.matrixWorld),e.expandByPoint(r)}}return function(t){return e=this,t.updateMatrixWorld(!0),t.traverse(n),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("Box3: .getParameter() target is now required"),t=new Vector3),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:(closestPoint=new Vector3,function(e){return this.clampPoint(e.center,closestPoint),closestPoint.distanceToSquared(e.center)<=e.radius*e.radius}),intersectsPlane:function(e){var t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant},intersectsTriangle:function(){var e=new Vector3,t=new Vector3,i=new Vector3,r=new Vector3,n=new Vector3,o=new Vector3,a=new Vector3,s=new Vector3,l=new Vector3,u=new Vector3;function h(r){var n,o;for(n=0,o=r.length-3;n<=o;n+=3){a.fromArray(r,n);var s=l.x*Math.abs(a.x)+l.y*Math.abs(a.y)+l.z*Math.abs(a.z),u=e.dot(a),h=t.dot(a),c=i.dot(a);if(Math.max(-Math.max(u,h,c),Math.min(u,h,c))>s)return!1}return!0}return function(a){if(this.isEmpty())return!1;this.getCenter(s),l.subVectors(this.max,s),e.subVectors(a.a,s),t.subVectors(a.b,s),i.subVectors(a.c,s),r.subVectors(t,e),n.subVectors(i,t),o.subVectors(e,i);var c=[0,-r.z,r.y,0,-n.z,n.y,0,-o.z,o.y,r.z,0,-r.x,n.z,0,-n.x,o.z,0,-o.x,-r.y,r.x,0,-n.y,n.x,0,-o.y,o.x,0];return!!h(c)&&(!!h(c=[1,0,0,0,1,0,0,0,1])&&(u.crossVectors(r,n),h(c=[u.x,u.y,u.z])))}}(),clampPoint:function(e,t){return void 0===t&&(console.warn("Box3: .clampPoint() target is now required"),t=new Vector3),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Vector3;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new Vector3;return function(t){return void 0===t&&(console.warn("Box3: .getBoundingSphere() target is now required"),t=new Sphere),this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],function(e){return this.isEmpty()?this:(points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(points),this)}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(Sphere.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:(box=new Box3,function(e,t){var i=this.center;void 0!==t?i.copy(t):box.setFromPoints(e).getCenter(i);for(var r=0,n=0,o=e.length;n<o;n++)r=Math.max(r,i.distanceToSquared(e[n]));return this.radius=Math.sqrt(r),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var i=this.center.distanceToSquared(e);return void 0===t&&(console.warn("Sphere: .clampPoint() target is now required"),t=new Vector3),t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("Sphere: .getBoundingBox() target is now required"),e=new Box3),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.defineProperties(Vector2.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Vector2.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(){var e=new Vector2,t=new Vector2;return function(i,r){return e.set(i,i),t.set(r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*i-o*r+e.x,this.y=n*r+o*i+e.y,this}});var geometryId=0,offset,obj;function Geometry(){Object.defineProperty(this,"id",{value:geometryId+=2}),this.uuid=_Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function Vector4(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==r?r:1}function BufferAttribute(e,t,i){if(Array.isArray(e))throw new TypeError("BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Int8BufferAttribute(e,t,i){BufferAttribute.call(this,new Int8Array(e),t,i)}function Uint8BufferAttribute(e,t,i){BufferAttribute.call(this,new Uint8Array(e),t,i)}function Uint8ClampedBufferAttribute(e,t,i){BufferAttribute.call(this,new Uint8ClampedArray(e),t,i)}function Int16BufferAttribute(e,t,i){BufferAttribute.call(this,new Int16Array(e),t,i)}function Uint16BufferAttribute(e,t,i){BufferAttribute.call(this,new Uint16Array(e),t,i)}function Int32BufferAttribute(e,t,i){BufferAttribute.call(this,new Int32Array(e),t,i)}function Uint32BufferAttribute(e,t,i){BufferAttribute.call(this,new Uint32Array(e),t,i)}function Float32BufferAttribute(e,t,i){BufferAttribute.call(this,new Float32Array(e),t,i)}function Float64BufferAttribute(e,t,i){BufferAttribute.call(this,new Float64Array(e),t,i)}function DirectGeometry(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function arrayMin(e){if(0===e.length)return 1/0;for(var t=e[0],i=1,r=e.length;i<r;++i)e[i]<t&&(t=e[i]);return t}function arrayMax(e){if(0===e.length)return-1/0;for(var t=e[0],i=1,r=e.length;i<r;++i)e[i]>t&&(t=e[i]);return t}Geometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Geometry,isGeometry:!0,applyMatrix:function(e){for(var t=(new Matrix3).getNormalMatrix(e),i=0,r=this.vertices.length;i<r;i++){this.vertices[i].applyMatrix4(e)}for(i=0,r=this.faces.length;i<r;i++){var n=this.faces[i];n.normal.applyMatrix3(t).normalize();for(var o=0,a=n.vertexNormals.length;o<a;o++)n.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e=new Matrix4;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new Matrix4;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new Matrix4;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new Matrix4;return function(t,i,r){return e.makeTranslation(t,i,r),this.applyMatrix(e),this}}(),scale:function(){var e=new Matrix4;return function(t,i,r){return e.makeScale(t,i,r),this.applyMatrix(e),this}}(),lookAt:(obj=new Object3D,function(e){obj.lookAt(e),obj.updateMatrix(),this.applyMatrix(obj.matrix)}),fromBufferGeometry:function(e){var t=this,i=null!==e.index?e.index.array:void 0,r=e.attributes,n=r.position.array,o=void 0!==r.normal?r.normal.array:void 0,a=void 0!==r.color?r.color.array:void 0,s=void 0!==r.uv?r.uv.array:void 0,l=void 0!==r.uv2?r.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var u=0,h=0;u<n.length;u+=3,h+=2)t.vertices.push((new Vector3).fromArray(n,u)),void 0!==a&&t.colors.push((new Color).fromArray(a,u));function c(e,i,r,n){var u=void 0===a?[]:[t.colors[e].clone(),t.colors[i].clone(),t.colors[r].clone()],h=new Face3(e,i,r,void 0===o?[]:[(new Vector3).fromArray(o,3*e),(new Vector3).fromArray(o,3*i),(new Vector3).fromArray(o,3*r)],u,n);t.faces.push(h),void 0!==s&&t.faceVertexUvs[0].push([(new Vector2).fromArray(s,2*e),(new Vector2).fromArray(s,2*i),(new Vector2).fromArray(s,2*r)]),void 0!==l&&t.faceVertexUvs[1].push([(new Vector2).fromArray(l,2*e),(new Vector2).fromArray(l,2*i),(new Vector2).fromArray(l,2*r)])}var d=e.groups;if(d.length>0)for(u=0;u<d.length;u++)for(var p=d[u],f=p.start,m=(h=f,f+p.count);h<m;h+=3)void 0!==i?c(i[h],i[h+1],i[h+2],p.materialIndex):c(h,h+1,h+2,p.materialIndex);else if(void 0!==i)for(u=0;u<i.length;u+=3)c(i[u],i[u+1],i[u+2]);else for(u=0;u<n.length/3;u+=3)c(u,u+1,u+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:(offset=new Vector3,function(){return this.computeBoundingBox(),this.boundingBox.getCenter(offset).negate(),this.translate(offset.x,offset.y,offset.z),this}),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,i=0===t?1:1/t,r=new Matrix4;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var e=new Vector3,t=new Vector3,i=0,r=this.faces.length;i<r;i++){var n=this.faces[i],o=this.vertices[n.a],a=this.vertices[n.b],s=this.vertices[n.c];e.subVectors(s,a),t.subVectors(o,a),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e){var t,i,r,n,o,a;for(void 0===e&&(e=!0),a=new Array(this.vertices.length),t=0,i=this.vertices.length;t<i;t++)a[t]=new Vector3;if(e){var s,l,u,h=new Vector3,c=new Vector3;for(r=0,n=this.faces.length;r<n;r++)o=this.faces[r],s=this.vertices[o.a],l=this.vertices[o.b],u=this.vertices[o.c],h.subVectors(u,l),c.subVectors(s,l),h.cross(c),a[o.a].add(h),a[o.b].add(h),a[o.c].add(h)}else for(this.computeFaceNormals(),r=0,n=this.faces.length;r<n;r++)a[(o=this.faces[r]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(t=0,i=this.vertices.length;t<i;t++)a[t].normalize();for(r=0,n=this.faces.length;r<n;r++){var d=(o=this.faces[r]).vertexNormals;3===d.length?(d[0].copy(a[o.a]),d[1].copy(a[o.b]),d[2].copy(a[o.c])):(d[0]=a[o.a].clone(),d[1]=a[o.b].clone(),d[2]=a[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,i;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var r=(i=this.faces[e]).vertexNormals;3===r.length?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,i,r,n;for(i=0,r=this.faces.length;i<r;i++)for((n=this.faces[i]).__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),e=0,t=n.vertexNormals.length;e<t;e++)n.__originalVertexNormals[e]?n.__originalVertexNormals[e].copy(n.vertexNormals[e]):n.__originalVertexNormals[e]=n.vertexNormals[e].clone();var o=new Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(i=0,r=this.faces.length;i<r;i++)l=new Vector3,u={a:new Vector3,b:new Vector3,c:new Vector3},a.push(l),s.push(u)}var l,u,h=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),i=0,r=this.faces.length;i<r;i++)n=this.faces[i],l=h.faceNormals[i],u=h.vertexNormals[i],l.copy(n.normal),u.a.copy(n.vertexNormals[0]),u.b.copy(n.vertexNormals[1]),u.c.copy(n.vertexNormals[2])}for(i=0,r=this.faces.length;i<r;i++)(n=this.faces[i]).normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i){if(e&&e.isGeometry){var r,n=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,l=e.faces,u=this.faceVertexUvs[0],h=e.faceVertexUvs[0],c=this.colors,d=e.colors;void 0===i&&(i=0),void 0!==t&&(r=(new Matrix3).getNormalMatrix(t));for(var p=0,f=a.length;p<f;p++){var m=a[p].clone();void 0!==t&&m.applyMatrix4(t),o.push(m)}for(p=0,f=d.length;p<f;p++)c.push(d[p].clone());for(p=0,f=l.length;p<f;p++){var v,g,y,_=l[p],b=_.vertexNormals,x=_.vertexColors;(v=new Face3(_.a+n,_.b+n,_.c+n)).normal.copy(_.normal),void 0!==r&&v.normal.applyMatrix3(r).normalize();for(var w=0,S=b.length;w<S;w++)g=b[w].clone(),void 0!==r&&g.applyMatrix3(r).normalize(),v.vertexNormals.push(g);v.color.copy(_.color);for(w=0,S=x.length;w<S;w++)y=x[w],v.vertexColors.push(y.clone());v.materialIndex=_.materialIndex+i,s.push(v)}for(p=0,f=h.length;p<f;p++){var M=h[p],T=[];if(void 0!==M){for(w=0,S=M.length;w<S;w++)T.push(M[w].clone());u.push(T)}}}else console.error("Geometry.merge(): geometry not an instance of Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("Geometry.mergeMesh(): mesh not an instance of Mesh.",e)},mergeVertices:function(){var e,t,i,r,n,o,a,s,l={},u=[],h=[],c=Math.pow(10,4);for(i=0,r=this.vertices.length;i<r;i++)e=this.vertices[i],void 0===l[t=Math.round(e.x*c)+"_"+Math.round(e.y*c)+"_"+Math.round(e.z*c)]?(l[t]=i,u.push(this.vertices[i]),h[i]=u.length-1):h[i]=h[l[t]];var d=[];for(i=0,r=this.faces.length;i<r;i++){(n=this.faces[i]).a=h[n.a],n.b=h[n.b],n.c=h[n.c],o=[n.a,n.b,n.c];for(var p=0;p<3;p++)if(o[p]===o[(p+1)%3]){d.push(i);break}}for(i=d.length-1;i>=0;i--){var f=d[i];for(this.faces.splice(f,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(f,1)}var m=this.vertices.length-u.length;return this.vertices=u,m},setFromPoints:function(e){this.vertices=[];for(var t=0,i=e.length;t<i;t++){var r=e[t];this.vertices.push(new Vector3(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,i=0;i<t;i++)e[i]._id=i;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var r,n,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];o&&o.length===t&&(r=[]),a&&a.length===t&&(n=[]);for(i=0;i<t;i++){var s=e[i]._id;r&&r.push(o[s]),n&&n.push(a[s])}r&&(this.faceVertexUvs[0]=r),n&&(this.faceVertexUvs[1]=n)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}for(var r=[],n=0;n<this.vertices.length;n++){var o=this.vertices[n];r.push(o.x,o.y,o.z)}var a=[],s=[],l={},u=[],h={},c=[],d={};for(n=0;n<this.faces.length;n++){var p=this.faces[n],f=void 0!==this.faceVertexUvs[0][n],m=p.normal.length()>0,v=p.vertexNormals.length>0,g=1!==p.color.r||1!==p.color.g||1!==p.color.b,y=p.vertexColors.length>0,_=0;if(_=S(_,0,0),_=S(_,1,!0),_=S(_,2,!1),_=S(_,3,f),_=S(_,4,m),_=S(_,5,v),_=S(_,6,g),_=S(_,7,y),a.push(_),a.push(p.a,p.b,p.c),a.push(p.materialIndex),f){var b=this.faceVertexUvs[0][n];a.push(A(b[0]),A(b[1]),A(b[2]))}if(m&&a.push(M(p.normal)),v){var x=p.vertexNormals;a.push(M(x[0]),M(x[1]),M(x[2]))}if(g&&a.push(T(p.color)),y){var w=p.vertexColors;a.push(T(w[0]),T(w[1]),T(w[2]))}}function S(e,t,i){return i?e|1<<t:e&~(1<<t)}function M(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]?l[t]:(l[t]=s.length/3,s.push(e.x,e.y,e.z),l[t])}function T(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==h[t]?h[t]:(h[t]=u.length,u.push(e.getHex()),h[t])}function A(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]?d[t]:(d[t]=c.length/2,c.push(e.x,e.y),d[t])}return e.data={},e.data.vertices=r,e.data.normals=s,u.length>0&&(e.data.colors=u),c.length>0&&(e.data.uvs=[c]),e.data.faces=a,e},clone:function(){return(new Geometry).copy(this)},copy:function(e){var t,i,r,n,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,i=s.length;t<i;t++)this.vertices.push(s[t].clone());var l=e.colors;for(t=0,i=l.length;t<i;t++)this.colors.push(l[t].clone());var u=e.faces;for(t=0,i=u.length;t<i;t++)this.faces.push(u[t].clone());for(t=0,i=e.faceVertexUvs.length;t<i;t++){var h=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),r=0,n=h.length;r<n;r++){var c=h[r],d=[];for(o=0,a=c.length;o<a;o++){var p=c[o];d.push(p.clone())}this.faceVertexUvs[t].push(d)}}var f=e.morphTargets;for(t=0,i=f.length;t<i;t++){var m={};if(m.name=f[t].name,void 0!==f[t].vertices)for(m.vertices=[],r=0,n=f[t].vertices.length;r<n;r++)m.vertices.push(f[t].vertices[r].clone());if(void 0!==f[t].normals)for(m.normals=[],r=0,n=f[t].normals.length;r<n;r++)m.normals.push(f[t].normals[r].clone());this.morphTargets.push(m)}var v=e.morphNormals;for(t=0,i=v.length;t<i;t++){var g={};if(void 0!==v[t].vertexNormals)for(g.vertexNormals=[],r=0,n=v[t].vertexNormals.length;r<n;r++){var y=v[t].vertexNormals[r],_={};_.a=y.a.clone(),_.b=y.b.clone(),_.c=y.c.clone(),g.vertexNormals.push(_)}if(void 0!==v[t].faceNormals)for(g.faceNormals=[],r=0,n=v[t].faceNormals.length;r<n;r++)g.faceNormals.push(v[t].faceNormals[r].clone());this.morphNormals.push(g)}var b=e.skinWeights;for(t=0,i=b.length;t<i;t++)this.skinWeights.push(b[t].clone());var x=e.skinIndices;for(t=0,i=x.length;t<i;t++)this.skinIndices.push(x[t].clone());var w=e.lineDistances;for(t=0,i=w.length;t<i;t++)this.lineDistances.push(w[t]);var S=e.boundingBox;null!==S&&(this.boundingBox=S.clone());var M=e.boundingSphere;return null!==M&&(this.boundingSphere=M.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.assign(Vector4.prototype,{isVector4:!0,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*n,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*n,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*n,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*n,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,r,n,o=e.elements,a=o[0],s=o[4],l=o[8],u=o[1],h=o[5],c=o[9],d=o[2],p=o[6],f=o[10];if(Math.abs(s-u)<.01&&Math.abs(l-d)<.01&&Math.abs(c-p)<.01){if(Math.abs(s+u)<.1&&Math.abs(l+d)<.1&&Math.abs(c+p)<.1&&Math.abs(a+h+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,v=(h+1)/2,g=(f+1)/2,y=(s+u)/4,_=(l+d)/4,b=(c+p)/4;return m>v&&m>g?m<.01?(i=0,r=.707106781,n=.707106781):(r=y/(i=Math.sqrt(m)),n=_/i):v>g?v<.01?(i=.707106781,r=0,n=.707106781):(i=y/(r=Math.sqrt(v)),n=b/r):g<.01?(i=.707106781,r=.707106781,n=0):(i=_/(n=Math.sqrt(g)),r=b/n),this.set(i,r,n,t),this}var x=Math.sqrt((p-c)*(p-c)+(l-d)*(l-d)+(u-s)*(u-s));return Math.abs(x)<.001&&(x=1),this.x=(p-c)/x,this.y=(l-d)/x,this.z=(u-s)/x,this.w=Math.acos((a+h+f-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(i,r){return void 0===e&&(e=new Vector4,t=new Vector4),e.set(i,i,i,i),t.set(r,r,r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),Object.defineProperty(BufferAttribute.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(BufferAttribute.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.itemSize:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(var r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("BufferAttribute.copyColorsArray(): color is undefined",r),o=new Color),t[i++]=o.r,t[i++]=o.g,t[i++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new Vector2),t[i++]=o.x,t[i++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new Vector3),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new Vector4),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z,t[i++]=o.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this},setXYZW:function(e,t,i,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),Int8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int8BufferAttribute.prototype.constructor=Int8BufferAttribute,Uint8BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8BufferAttribute.prototype.constructor=Uint8BufferAttribute,Uint8ClampedBufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint8ClampedBufferAttribute.prototype.constructor=Uint8ClampedBufferAttribute,Int16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int16BufferAttribute.prototype.constructor=Int16BufferAttribute,Uint16BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint16BufferAttribute.prototype.constructor=Uint16BufferAttribute,Int32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Int32BufferAttribute.prototype.constructor=Int32BufferAttribute,Uint32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Uint32BufferAttribute.prototype.constructor=Uint32BufferAttribute,Float32BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float32BufferAttribute.prototype.constructor=Float32BufferAttribute,Float64BufferAttribute.prototype=Object.create(BufferAttribute.prototype),Float64BufferAttribute.prototype.constructor=Float64BufferAttribute,Object.assign(DirectGeometry.prototype,{computeGroups:function(e){for(var t,i=[],r=void 0,n=e.faces,o=0;o<n.length;o++){var a=n[o];a.materialIndex!==r&&(r=a.materialIndex,void 0!==t&&(t.count=3*o-t.start,i.push(t)),t={start:3*o,materialIndex:r})}void 0!==t&&(t.count=3*o-t.start,i.push(t)),this.groups=i},fromGeometry:function(e){var t,i=e.faces,r=e.vertices,n=e.faceVertexUvs,o=n[0]&&n[0].length>0,a=n[1]&&n[1].length>0,s=e.morphTargets,l=s.length;if(l>0){t=[];for(var u=0;u<l;u++)t[u]={name:s[u].name,data:[]};this.morphTargets.position=t}var h,c=e.morphNormals,d=c.length;if(d>0){h=[];for(u=0;u<d;u++)h[u]={name:c[u].name,data:[]};this.morphTargets.normal=h}var p=e.skinIndices,f=e.skinWeights,m=p.length===r.length,v=f.length===r.length;r.length>0&&0===i.length&&console.error("DirectGeometry: Faceless geometries are not supported.");for(u=0;u<i.length;u++){var g=i[u];this.vertices.push(r[g.a],r[g.b],r[g.c]);var y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var _=g.normal;this.normals.push(_,_,_)}var b,x=g.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{var w=g.color;this.colors.push(w,w,w)}if(!0===o)void 0!==(b=n[0][u])?this.uvs.push(b[0],b[1],b[2]):(console.warn("DirectGeometry.fromGeometry(): Undefined vertexUv ",u),this.uvs.push(new Vector2,new Vector2,new Vector2));if(!0===a)void 0!==(b=n[1][u])?this.uvs2.push(b[0],b[1],b[2]):(console.warn("DirectGeometry.fromGeometry(): Undefined vertexUv2 ",u),this.uvs2.push(new Vector2,new Vector2,new Vector2));for(var S=0;S<l;S++){var M=s[S].vertices;t[S].data.push(M[g.a],M[g.b],M[g.c])}for(S=0;S<d;S++){var T=c[S].vertexNormals[u];h[S].data.push(T.a,T.b,T.c)}m&&this.skinIndices.push(p[g.a],p[g.b],p[g.c]),v&&this.skinWeights.push(f[g.a],f[g.b],f[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}});var bufferGeometryId=1;function BufferGeometry(){Object.defineProperty(this,"id",{value:bufferGeometryId+=2}),this.uuid=_Math.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}function SphereGeometry(e,t,i,r,n,o,a){Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new SphereBufferGeometry(e,t,i,r,n,o,a)),this.mergeVertices()}function SphereBufferGeometry(e,t,i,r,n,o,a){BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:o,thetaLength:a},e=e||1,t=Math.max(3,Math.floor(t)||8),i=Math.max(2,Math.floor(i)||6),r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var s,l,u=(o=void 0!==o?o:0)+(a=void 0!==a?a:Math.PI),h=0,c=[],d=new Vector3,p=new Vector3,f=[],m=[],v=[],g=[];for(l=0;l<=i;l++){var y=[],_=l/i;for(s=0;s<=t;s++){var b=s/t;d.x=-e*Math.cos(r+b*n)*Math.sin(o+_*a),d.y=e*Math.cos(o+_*a),d.z=e*Math.sin(r+b*n)*Math.sin(o+_*a),m.push(d.x,d.y,d.z),p.set(d.x,d.y,d.z).normalize(),v.push(p.x,p.y,p.z),g.push(b,1-_),y.push(h++)}c.push(y)}for(l=0;l<i;l++)for(s=0;s<t;s++){var x=c[l][s+1],w=c[l][s],S=c[l+1][s],M=c[l+1][s+1];(0!==l||o>0)&&f.push(x,w,M),(l!==i-1||u<Math.PI)&&f.push(w,S,M)}this.setIndex(f),this.addAttribute("position",new Float32BufferAttribute(m,3)),this.addAttribute("normal",new Float32BufferAttribute(v,3)),this.addAttribute("uv",new Float32BufferAttribute(g,2))}BufferGeometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:BufferGeometry,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(arrayMax(e)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(e,1):this.index=e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):(this.attributes[e]=t,this):(console.warn("BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new BufferAttribute(arguments[1],arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,i){this.groups.push({start:e,count:t,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var i=this.attributes.normal;void 0!==i&&((new Matrix3).getNormalMatrix(e).applyToBufferAttribute(i),i.needsUpdate=!0);var r=this.attributes.tangent;void 0!==r&&((new Matrix3).getNormalMatrix(e).applyToBufferAttribute(r),r.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new Matrix4;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new Matrix4;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new Matrix4;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new Matrix4;return function(t,i,r){return e.makeTranslation(t,i,r),this.applyMatrix(e),this}}(),scale:function(){var e=new Matrix4;return function(t,i,r){return e.makeScale(t,i,r),this.applyMatrix(e),this}}(),lookAt:function(){var e=new Object3D;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){var e=new Vector3;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var i=new Float32BufferAttribute(3*t.vertices.length,3),r=new Float32BufferAttribute(3*t.colors.length,3);if(this.addAttribute("position",i.copyVector3sArray(t.vertices)),this.addAttribute("color",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var n=new Float32BufferAttribute(t.lineDistances.length,1);this.addAttribute("lineDistance",n.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i];t.push(n.x,n.y,n.z||0)}return this.addAttribute("position",new Float32BufferAttribute(t,3)),this},updateFromObject:function(e){var t,i=e.geometry;if(e.isMesh){var r=i.__directGeometry;if(!0===i.elementsNeedUpdate&&(r=void 0,i.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(i);r.verticesNeedUpdate=i.verticesNeedUpdate,r.normalsNeedUpdate=i.normalsNeedUpdate,r.colorsNeedUpdate=i.colorsNeedUpdate,r.uvsNeedUpdate=i.uvsNeedUpdate,r.groupsNeedUpdate=i.groupsNeedUpdate,i.verticesNeedUpdate=!1,i.normalsNeedUpdate=!1,i.colorsNeedUpdate=!1,i.uvsNeedUpdate=!1,i.groupsNeedUpdate=!1,i=r}return!0===i.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(i.vertices),t.needsUpdate=!0),i.verticesNeedUpdate=!1),!0===i.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(i.normals),t.needsUpdate=!0),i.normalsNeedUpdate=!1),!0===i.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(i.colors),t.needsUpdate=!0),i.colorsNeedUpdate=!1),i.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(i.uvs),t.needsUpdate=!0),i.uvsNeedUpdate=!1),i.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(i.lineDistances),t.needsUpdate=!0),i.lineDistancesNeedUpdate=!1),i.groupsNeedUpdate&&(i.computeGroups(e.geometry),this.groups=i.groups,i.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new DirectGeometry).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new BufferAttribute(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var i=new Float32Array(3*e.normals.length);this.addAttribute("normal",new BufferAttribute(i,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var r=new Float32Array(3*e.colors.length);this.addAttribute("color",new BufferAttribute(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var n=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new BufferAttribute(n,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new BufferAttribute(o,2).copyVector2sArray(e.uvs2))}for(var a in this.groups=e.groups,e.morphTargets){for(var s=[],l=e.morphTargets[a],u=0,h=l.length;u<h;u++){var c=l[u],d=new Float32BufferAttribute(3*c.data.length,3);d.name=c.name,s.push(d.copyVector3sArray(c.data))}this.morphAttributes[a]=s}if(e.skinIndices.length>0){var p=new Float32BufferAttribute(4*e.skinIndices.length,4);this.addAttribute("skinIndex",p.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var f=new Float32BufferAttribute(4*e.skinWeights.length,4);this.addAttribute("skinWeight",f.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3);var e=this.attributes.position;void 0!==e?this.boundingBox.setFromBufferAttribute(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new Box3,t=new Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);var i=this.attributes.position;if(i){var r=this.boundingSphere.center;e.setFromBufferAttribute(i),e.getCenter(r);for(var n=0,o=0,a=i.count;o<a;o++)t.x=i.getX(o),t.y=i.getY(o),t.z=i.getZ(o),n=Math.max(n,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var i=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new BufferAttribute(new Float32Array(i.length),3));else for(var r=t.normal.array,n=0,o=r.length;n<o;n++)r[n]=0;var a,s,l,u=t.normal.array,h=new Vector3,c=new Vector3,d=new Vector3,p=new Vector3,f=new Vector3;if(e){var m=e.array;for(n=0,o=e.count;n<o;n+=3)a=3*m[n+0],s=3*m[n+1],l=3*m[n+2],h.fromArray(i,a),c.fromArray(i,s),d.fromArray(i,l),p.subVectors(d,c),f.subVectors(h,c),p.cross(f),u[a]+=p.x,u[a+1]+=p.y,u[a+2]+=p.z,u[s]+=p.x,u[s+1]+=p.y,u[s+2]+=p.z,u[l]+=p.x,u[l+1]+=p.y,u[l+2]+=p.z}else for(n=0,o=i.length;n<o;n+=9)h.fromArray(i,n),c.fromArray(i,n+3),d.fromArray(i,n+6),p.subVectors(d,c),f.subVectors(h,c),p.cross(f),u[n]=p.x,u[n+1]=p.y,u[n+2]=p.z,u[n+3]=p.x,u[n+4]=p.y,u[n+5]=p.z,u[n+6]=p.x,u[n+7]=p.y,u[n+8]=p.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var i=this.attributes;for(var r in i)if(void 0!==e.attributes[r])for(var n=i[r].array,o=e.attributes[r],a=o.array,s=0,l=o.itemSize*t;s<a.length;s++,l++)n[l]=a[s];return this}console.error("BufferGeometry.merge(): geometry not an instance of BufferGeometry.",e)},normalizeNormals:function(){var e=new Vector3;return function(){for(var t=this.attributes.normal,i=0,r=t.count;i<r;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.normalize(),t.setXYZ(i,e.x,e.y,e.z)}}(),toNonIndexed:function(){function e(e,t){for(var i=e.array,r=e.itemSize,n=new i.constructor(t.length*r),o=0,a=0,s=0,l=t.length;s<l;s++){o=t[s]*r;for(var u=0;u<r;u++)n[a++]=i[o++]}return new BufferAttribute(n,r)}if(null===this.index)return console.warn("BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new BufferGeometry,i=this.index.array,r=this.attributes;for(var n in r){var o=e(r[n],i);t.addAttribute(n,o)}var a=this.morphAttributes;for(n in a){for(var s=[],l=a[n],u=0,h=l.length;u<h;u++){o=e(l[u],i);s.push(o)}t.morphAttributes[n]=s}for(var c=this.groups,d=(u=0,c.length);u<d;u++){var p=c[u];t.addGroup(p.start,p.count,p.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};var r=this.index;null!==r&&(e.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var n=this.attributes;for(var i in n){var o={itemSize:(d=n[i]).itemSize,type:d.array.constructor.name,array:Array.prototype.slice.call(d.array),normalized:d.normalized};""!==d.name&&(o.name=d.name),e.data.attributes[i]=o}var a={},s=!1;for(var i in this.morphAttributes){for(var l=this.morphAttributes[i],u=[],h=0,c=l.length;h<c;h++){var d;o={itemSize:(d=l[h]).itemSize,type:d.array.constructor.name,array:Array.prototype.slice.call(d.array),normalized:d.normalized};""!==d.name&&(o.name=d.name),u.push(o)}u.length>0&&(a[i]=u,s=!0)}s&&(e.data.morphAttributes=a);var p=this.groups;p.length>0&&(e.data.groups=JSON.parse(JSON.stringify(p)));var f=this.boundingSphere;return null!==f&&(e.data.boundingSphere={center:f.center.toArray(),radius:f.radius}),e},clone:function(){return(new BufferGeometry).copy(this)},copy:function(e){var t,i,r;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone());var o=e.attributes;for(t in o){var a=o[t];this.addAttribute(t,a.clone())}var s=e.morphAttributes;for(t in s){var l=[],u=s[t];for(i=0,r=u.length;i<r;i++)l.push(u[i].clone());this.morphAttributes[t]=l}var h=e.groups;for(i=0,r=h.length;i<r;i++){var c=h[i];this.addGroup(c.start,c.count,c.materialIndex)}var d=e.boundingBox;null!==d&&(this.boundingBox=d.clone());var p=e.boundingSphere;return null!==p&&(this.boundingSphere=p.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),SphereGeometry.prototype=Object.create(Geometry.prototype),SphereGeometry.prototype.constructor=SphereGeometry,SphereBufferGeometry.prototype=Object.create(BufferGeometry.prototype),SphereBufferGeometry.prototype.constructor=SphereBufferGeometry;var materialId=0,v,segCenter,segDir,diff,barycoord,v0,vab,vac,vbc,vap,vbp,vcp,inverseMatrix,ray,sphere,start,end;function Material$1(){Object.defineProperty(this,"id",{value:materialId++}),this.uuid=_Math.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=NormalBlending,this.side=FrontSide,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=NoColors,this.opacity=1,this.transparent=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.userData={},this.needsUpdate=!0}function MeshBasicMaterial(e){Material$1.call(this),this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function LineBasicMaterial(e){Material$1.call(this),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}function Ray(e,t){this.origin=void 0!==e?e:new Vector3,this.direction=void 0!==t?t:new Vector3}function Triangle(e,t,i){this.a=void 0!==e?e:new Vector3,this.b=void 0!==t?t:new Vector3,this.c=void 0!==i?i:new Vector3}function Mesh(e,t){Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new BufferGeometry,this.material=void 0!==t?t:new MeshBasicMaterial({color:16777215*Math.random()}),this.drawMode=TrianglesDrawMode,this.updateMorphTargets()}function Line(e,t,i){1===i&&console.error("Line: parameter LinePieces no longer supported. Use LineSegments instead."),Object3D.call(this),this.type="Line",this.geometry=void 0!==e?e:new BufferGeometry,this.material=void 0!==t?t:new LineBasicMaterial({color:16777215*Math.random()})}Material$1.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Material$1,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0!==i)if("shading"!==t){var r=this[t];void 0!==r?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i:console.warn(this.type+": '"+t+"' is not a property of this material.")}else console.warn(this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===FlatShading;else console.warn("Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var i in e){var r=e[i];delete r.metadata,t.push(r)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearCoat&&(i.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(i.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,i.reflectivity=this.reflectivity,void 0!==this.combine&&(i.combine=this.combine),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(i.blending=this.blending),!0===this.flatShading&&(i.flatShading=this.flatShading),this.side!==FrontSide&&(i.side=this.side),this.vertexColors!==NoColors&&(i.vertexColors=this.vertexColors),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.skinning&&(i.skinning=!0),!1===this.visible&&(i.visible=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){var n=r(e.textures),o=r(e.images);n.length>0&&(i.textures=n),o.length>0&&(i.images=o)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,i=null;if(null!==t){var r=t.length;i=new Array(r);for(var n=0;n!==r;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),MeshBasicMaterial.prototype=Object.create(Material$1.prototype),MeshBasicMaterial.prototype.constructor=MeshBasicMaterial,MeshBasicMaterial.prototype.isMeshBasicMaterial=!0,MeshBasicMaterial.prototype.copy=function(e){return Material$1.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},LineBasicMaterial.prototype=Object.create(Material$1.prototype),LineBasicMaterial.prototype.constructor=LineBasicMaterial,LineBasicMaterial.prototype.isLineBasicMaterial=!0,LineBasicMaterial.prototype.copy=function(e){return Material$1.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},Object.assign(Ray.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("Ray: .at() target is now required"),t=new Vector3),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){void 0===t&&(console.warn("Ray: .closestPointToPoint() target is now required"),t=new Vector3),t.subVectors(e,this.origin);var i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new Vector3;return function(t){var i=e.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(i).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:(segCenter=new Vector3,segDir=new Vector3,diff=new Vector3,function(e,t,i,r){segCenter.copy(e).add(t).multiplyScalar(.5),segDir.copy(t).sub(e).normalize(),diff.copy(this.origin).sub(segCenter);var n,o,a,s,l=.5*e.distanceTo(t),u=-this.direction.dot(segDir),h=diff.dot(this.direction),c=-diff.dot(segDir),d=diff.lengthSq(),p=Math.abs(1-u*u);if(p>0)if(o=u*h-c,s=l*p,(n=u*c-h)>=0)if(o>=-s)if(o<=s){var f=1/p;a=(n*=f)*(n+u*(o*=f)+2*h)+o*(u*n+o+2*c)+d}else o=l,a=-(n=Math.max(0,-(u*o+h)))*n+o*(o+2*c)+d;else o=-l,a=-(n=Math.max(0,-(u*o+h)))*n+o*(o+2*c)+d;else o<=-s?a=-(n=Math.max(0,-(-u*l+h)))*n+(o=n>0?-l:Math.min(Math.max(-l,-c),l))*(o+2*c)+d:o<=s?(n=0,a=(o=Math.min(Math.max(-l,-c),l))*(o+2*c)+d):a=-(n=Math.max(0,-(u*l+h)))*n+(o=n>0?l:Math.min(Math.max(-l,-c),l))*(o+2*c)+d;else o=u>0?-l:l,a=-(n=Math.max(0,-(u*o+h)))*n+o*(o+2*c)+d;return i&&i.copy(this.direction).multiplyScalar(n).add(this.origin),r&&r.copy(segDir).multiplyScalar(o).add(segCenter),a}),intersectSphere:function(){var e=new Vector3;return function(t,i){e.subVectors(t.center,this.origin);var r=e.dot(this.direction),n=e.dot(e)-r*r,o=t.radius*t.radius;if(n>o)return null;var a=Math.sqrt(o-n),s=r-a,l=r+a;return s<0&&l<0?null:s<0?this.at(l,i):this.at(s,i)}}(),intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null},intersectPlane:function(e,t){var i=this.distanceToPlane(e);return null===i?null:this.at(i,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var i,r,n,o,a,s,l=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,c=this.origin;return l>=0?(i=(e.min.x-c.x)*l,r=(e.max.x-c.x)*l):(i=(e.max.x-c.x)*l,r=(e.min.x-c.x)*l),u>=0?(n=(e.min.y-c.y)*u,o=(e.max.y-c.y)*u):(n=(e.max.y-c.y)*u,o=(e.min.y-c.y)*u),i>o||n>r?null:((n>i||i!=i)&&(i=n),(o<r||r!=r)&&(r=o),h>=0?(a=(e.min.z-c.z)*h,s=(e.max.z-c.z)*h):(a=(e.max.z-c.z)*h,s=(e.min.z-c.z)*h),i>s||a>r?null:((a>i||i!=i)&&(i=a),(s<r||r!=r)&&(r=s),r<0?null:this.at(i>=0?i:r,t)))},intersectsBox:(v=new Vector3,function(e){return null!==this.intersectBox(e,v)}),intersectTriangle:function(){var e=new Vector3,t=new Vector3,i=new Vector3,r=new Vector3;return function(n,o,a,s,l){t.subVectors(o,n),i.subVectors(a,n),r.crossVectors(t,i);var u,h=this.direction.dot(r);if(h>0){if(s)return null;u=1}else{if(!(h<0))return null;u=-1,h=-h}e.subVectors(this.origin,n);var c=u*this.direction.dot(i.crossVectors(e,i));if(c<0)return null;var d=u*this.direction.dot(t.cross(e));if(d<0)return null;if(c+d>h)return null;var p=-u*e.dot(r);return p<0?null:this.at(p/h,l)}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(Triangle,{getNormal:(v0=new Vector3,function(e,t,i,r){void 0===r&&(console.warn("Triangle: .getNormal() target is now required"),r=new Vector3),r.subVectors(i,t),v0.subVectors(e,t),r.cross(v0);var n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)}),getBarycoord:function(){var e=new Vector3,t=new Vector3,i=new Vector3;return function(r,n,o,a,s){e.subVectors(a,n),t.subVectors(o,n),i.subVectors(r,n);var l=e.dot(e),u=e.dot(t),h=e.dot(i),c=t.dot(t),d=t.dot(i),p=l*c-u*u;if(void 0===s&&(console.warn("Triangle: .getBarycoord() target is now required"),s=new Vector3),0===p)return s.set(-2,-1,-1);var f=1/p,m=(c*h-u*d)*f,v=(l*d-u*h)*f;return s.set(1-m-v,v,m)}}(),containsPoint:function(){var e=new Vector3;return function(t,i,r,n){return Triangle.getBarycoord(t,i,r,n,e),e.x>=0&&e.y>=0&&e.x+e.y<=1}}(),getUV:(barycoord=new Vector3,function(e,t,i,r,n,o,a,s){return this.getBarycoord(e,t,i,r,barycoord),s.set(0,0),s.addScaledVector(n,barycoord.x),s.addScaledVector(o,barycoord.y),s.addScaledVector(a,barycoord.z),s})}),Object.assign(Triangle.prototype,{set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new Vector3,t=new Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),getMidpoint:function(e){return void 0===e&&(console.warn("Triangle: .getMidpoint() target is now required"),e=new Vector3),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return Triangle.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("Triangle: .getPlane() target is now required"),e=new Vector3),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return Triangle.getBarycoord(e,this.a,this.b,this.c,t)},containsPoint:function(e){return Triangle.containsPoint(e,this.a,this.b,this.c)},getUV:function(e,t,i,r,n){return Triangle.getUV(e,this.a,this.b,this.c,t,i,r,n)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:(vab=new Vector3,vac=new Vector3,vbc=new Vector3,vap=new Vector3,vbp=new Vector3,vcp=new Vector3,function(e,t){void 0===t&&(console.warn("Triangle: .closestPointToPoint() target is now required"),t=new Vector3);var i,r,n=this.a,o=this.b,a=this.c;vab.subVectors(o,n),vac.subVectors(a,n),vap.subVectors(e,n);var s=vab.dot(vap),l=vac.dot(vap);if(s<=0&&l<=0)return t.copy(n);vbp.subVectors(e,o);var u=vab.dot(vbp),h=vac.dot(vbp);if(u>=0&&h<=u)return t.copy(o);var c=s*h-u*l;if(c<=0&&s>=0&&u<=0)return i=s/(s-u),t.copy(n).addScaledVector(vab,i);vcp.subVectors(e,a);var d=vab.dot(vcp),p=vac.dot(vcp);if(p>=0&&d<=p)return t.copy(a);var f=d*l-s*p;if(f<=0&&l>=0&&p<=0)return r=l/(l-p),t.copy(n).addScaledVector(vac,r);var m=u*p-d*h;if(m<=0&&h-u>=0&&d-p>=0)return vbc.subVectors(a,o),r=(h-u)/(h-u+(d-p)),t.copy(o).addScaledVector(vbc,r);var v=1/(m+f+c);return i=f*v,r=c*v,t.copy(n).addScaledVector(vab,i).addScaledVector(vac,r)}),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),Mesh.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Mesh,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return Object3D.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,i,r=this.geometry;if(r.isBufferGeometry){var n=r.morphAttributes,o=Object.keys(n);if(o.length>0){var a=n[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)i=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}else{var s=r.morphTargets;void 0!==s&&s.length>0&&console.error("Mesh.updateMorphTargets() no longer supports Geometry. Use BufferGeometry instead.")}},raycast:function(){var e=new Matrix4,t=new Ray,i=new Sphere,r=new Vector3,n=new Vector3,o=new Vector3,a=new Vector3,s=new Vector3,l=new Vector3,u=new Vector2,h=new Vector2,c=new Vector2,d=new Vector3,p=new Vector3;function f(e,t,i,r,n,o,a,s){if(null===(t.side===BackSide?r.intersectTriangle(a,o,n,!0,s):r.intersectTriangle(n,o,a,t.side!==DoubleSide,s)))return null;p.copy(s),p.applyMatrix4(e.matrixWorld);var l=i.ray.origin.distanceTo(p);return l<i.near||l>i.far?null:{distance:l,point:p.clone(),object:e}}function m(e,t,i,a,s,l,p,m,v){r.fromBufferAttribute(s,p),n.fromBufferAttribute(s,m),o.fromBufferAttribute(s,v);var g=f(e,t,i,a,r,n,o,d);if(g){l&&(u.fromBufferAttribute(l,p),h.fromBufferAttribute(l,m),c.fromBufferAttribute(l,v),g.uv=Triangle.getUV(d,r,n,o,u,h,c,new Vector2));var y=new Face3(p,m,v);Triangle.getNormal(r,n,o,y.normal),g.face=y}return g}return function(p,v){var g,y=this.geometry,_=this.material,b=this.matrixWorld;if(void 0!==_&&(null===y.boundingSphere&&y.computeBoundingSphere(),i.copy(y.boundingSphere),i.applyMatrix4(b),!1!==p.ray.intersectsSphere(i)&&(e.getInverse(b),t.copy(p.ray).applyMatrix4(e),null===y.boundingBox||!1!==t.intersectsBox(y.boundingBox))))if(y.isBufferGeometry){var x,w,S,M,T,A,C,L,N,P=y.index,k=y.attributes.position,E=y.attributes.uv,D=y.groups,O=y.drawRange;if(null!==P)if(Array.isArray(_))for(M=0,A=D.length;M<A;M++)for(N=_[(L=D[M]).materialIndex],T=Math.max(L.start,O.start),C=Math.min(L.start+L.count,O.start+O.count);T<C;T+=3)x=P.getX(T),w=P.getX(T+1),S=P.getX(T+2),(g=m(this,N,p,t,k,E,x,w,S))&&(g.faceIndex=Math.floor(T/3),g.face.materialIndex=L.materialIndex,v.push(g));else for(M=Math.max(0,O.start),A=Math.min(P.count,O.start+O.count);M<A;M+=3)x=P.getX(M),w=P.getX(M+1),S=P.getX(M+2),(g=m(this,_,p,t,k,E,x,w,S))&&(g.faceIndex=Math.floor(M/3),v.push(g));else if(void 0!==k)if(Array.isArray(_))for(M=0,A=D.length;M<A;M++)for(N=_[(L=D[M]).materialIndex],T=Math.max(L.start,O.start),C=Math.min(L.start+L.count,O.start+O.count);T<C;T+=3)(g=m(this,N,p,t,k,E,x=T,w=T+1,S=T+2))&&(g.faceIndex=Math.floor(T/3),g.face.materialIndex=L.materialIndex,v.push(g));else for(M=Math.max(0,O.start),A=Math.min(k.count,O.start+O.count);M<A;M+=3)(g=m(this,_,p,t,k,E,x=M,w=M+1,S=M+2))&&(g.faceIndex=Math.floor(M/3),v.push(g))}else if(y.isGeometry){var R,F,I,B,U=Array.isArray(_),V=y.vertices,z=y.faces,G=y.faceVertexUvs[0];G.length>0&&(B=G);for(var j=0,W=z.length;j<W;j++){var H=z[j],q=U?_[H.materialIndex]:_;if(void 0!==q){if(R=V[H.a],F=V[H.b],I=V[H.c],!0===q.morphTargets){var Y=y.morphTargets,X=this.morphTargetInfluences;r.set(0,0,0),n.set(0,0,0),o.set(0,0,0);for(var K=0,Q=Y.length;K<Q;K++){var Z=X[K];if(0!==Z){var J=Y[K].vertices;r.addScaledVector(a.subVectors(J[H.a],R),Z),n.addScaledVector(s.subVectors(J[H.b],F),Z),o.addScaledVector(l.subVectors(J[H.c],I),Z)}}r.add(R),n.add(F),o.add(I),R=r,F=n,I=o}if(g=f(this,q,p,t,R,F,I,d)){if(B&&B[j]){var $=B[j];u.copy($[0]),h.copy($[1]),c.copy($[2]),g.uv=Triangle.getUV(d,R,F,I,u,h,c,new Vector2)}g.face=H,g.faceIndex=j,v.push(g)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Line.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Line,isLine:!0,computeLineDistances:(start=new Vector3,end=new Vector3,function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,i=[0],r=1,n=t.count;r<n;r++)start.fromBufferAttribute(t,r-1),end.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=start.distanceTo(end);e.addAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var o=e.vertices;for((i=e.lineDistances)[0]=0,r=1,n=o.length;r<n;r++)i[r]=i[r-1],i[r]+=o[r-1].distanceTo(o[r])}return this}),raycast:(inverseMatrix=new Matrix4,ray=new Ray,sphere=new Sphere,function(e,t){var i=e.linePrecision,r=this.geometry,n=this.matrixWorld;if(null===r.boundingSphere&&r.computeBoundingSphere(),sphere.copy(r.boundingSphere),sphere.applyMatrix4(n),sphere.radius+=i,!1!==e.ray.intersectsSphere(sphere)){inverseMatrix.getInverse(n),ray.copy(e.ray).applyMatrix4(inverseMatrix);var o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,s=new Vector3,l=new Vector3,u=new Vector3,h=new Vector3,c=this&&this.isLineSegments?2:1;if(r.isBufferGeometry){var d=r.index,p=r.attributes.position.array;if(null!==d)for(var f=d.array,m=0,v=f.length-1;m<v;m+=c){var g=f[m],y=f[m+1];s.fromArray(p,3*g),l.fromArray(p,3*y),ray.distanceSqToSegment(s,l,h,u)>a||(h.applyMatrix4(this.matrixWorld),(x=e.ray.origin.distanceTo(h))<e.near||x>e.far||t.push({distance:x,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this}))}else for(m=0,v=p.length/3-1;m<v;m+=c)s.fromArray(p,3*m),l.fromArray(p,3*m+3),ray.distanceSqToSegment(s,l,h,u)>a||(h.applyMatrix4(this.matrixWorld),(x=e.ray.origin.distanceTo(h))<e.near||x>e.far||t.push({distance:x,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this}))}else if(r.isGeometry){var _=r.vertices,b=_.length;for(m=0;m<b-1;m+=c){var x;ray.distanceSqToSegment(_[m],_[m+1],h,u)>a||(h.applyMatrix4(this.matrixWorld),(x=e.ray.origin.distanceTo(h))<e.near||x>e.far||t.push({distance:x,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this}))}}}}),copy:function(e){return Object3D.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}});var CCDIKSolver=function(){function e(e,t){this.mesh=e,this.iks=t||[],this._valid()}var t,i,r,n,o,a,s,l,u,h;function c(e,t){Object3D.call(this),this.root=e,this.iks=t||[],this.matrix.copy(e.matrixWorld),this.matrixAutoUpdate=!1,this.sphereGeometry=new SphereBufferGeometry(.25,16,8),this.targetSphereMaterial=new MeshBasicMaterial({color:new Color(16746632),depthTest:!1,depthWrite:!1,transparent:!0}),this.effectorSphereMaterial=new MeshBasicMaterial({color:new Color(8978312),depthTest:!1,depthWrite:!1,transparent:!0}),this.linkSphereMaterial=new MeshBasicMaterial({color:new Color(8947967),depthTest:!1,depthWrite:!1,transparent:!0}),this.lineMaterial=new LineBasicMaterial({color:new Color(16711680),depthTest:!1,depthWrite:!1,transparent:!0}),this._init()}return e.prototype={constructor:e,update:(t=new Quaternion,i=new Vector3,r=new Vector3,n=new Vector3,o=new Vector3,a=new Vector3,s=new Quaternion,l=new Vector3,u=new Vector3,h=new Vector3,function(){for(var e=this.mesh.skeleton.bones,c=this.iks,d=Math,p=0,f=c.length;p<f;p++){var m=c[p],v=e[m.effector],g=e[m.target];i.setFromMatrixPosition(g.matrixWorld);for(var y=m.links,_=void 0!==m.iteration?m.iteration:1,b=0;b<_;b++){for(var x=!1,w=0,S=y.length;w<S;w++){var M=e[y[w].index];if(!1===y[w].enabled)break;var T=y[w].limitation,A=y[w].rotationMin,C=y[w].rotationMax;M.matrixWorld.decompose(a,s,l),s.inverse(),n.setFromMatrixPosition(v.matrixWorld),o.subVectors(n,a),o.applyQuaternion(s),o.normalize(),r.subVectors(i,a),r.applyQuaternion(s),r.normalize();var L=r.dot(o);if(L>1?L=1:L<-1&&(L=-1),!((L=d.acos(L))<1e-5)){if(void 0!==m.minAngle&&L<m.minAngle&&(L=m.minAngle),void 0!==m.maxAngle&&L>m.maxAngle&&(L=m.maxAngle),u.crossVectors(o,r),u.normalize(),t.setFromAxisAngle(u,L),M.quaternion.multiply(t),void 0!==T){var N=M.quaternion.w;N>1&&(N=1);var P=d.sqrt(1-N*N);M.quaternion.set(T.x*P,T.y*P,T.z*P,N)}void 0!==A&&M.rotation.setFromVector3(M.rotation.toVector3(h).max(A)),void 0!==C&&M.rotation.setFromVector3(M.rotation.toVector3(h).min(C)),M.updateMatrixWorld(!0),x=!0}}if(!x)break}}return this}),createHelper:function(){return new c(this.mesh,this.mesh.geometry.userData.MMD.iks)},_valid:function(){for(var e=this.iks,t=this.mesh.skeleton.bones,i=0,r=e.length;i<r;i++){var n,o,a=e[i],s=t[a.effector],l=a.links;n=s;for(var u=0,h=l.length;u<h;u++)o=t[l[u].index],n.parent!==o&&console.warn("CCDIKSolver: bone "+n.name+" is not the child of bone "+o.name),n=o}}},c.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:c,updateMatrixWorld:function(){var e=new Matrix4,t=new Vector3;function i(e,i){return t.setFromMatrixPosition(e.matrixWorld).applyMatrix4(i)}function r(e,t,r,n){var o=i(r,n);e[3*t+0]=o.x,e[3*t+1]=o.y,e[3*t+2]=o.z}return function(t){var n=this.root;if(this.visible){var o=0,a=this.iks,s=n.skeleton.bones;e.getInverse(n.matrixWorld);for(var l=0,u=a.length;l<u;l++){var h=a[l],c=s[h.target],d=s[h.effector],p=this.children[o++],f=this.children[o++];p.position.copy(i(c,e)),f.position.copy(i(d,e));for(var m=0,v=h.links.length;m<v;m++){var g=s[h.links[m].index];this.children[o++].position.copy(i(g,e))}var y=this.children[o++],_=y.geometry.attributes.position.array;r(_,0,c,e),r(_,1,d,e);for(m=0,v=h.links.length;m<v;m++){r(_,m+2,g=s[h.links[m].index],e)}y.geometry.attributes.position.needsUpdate=!0}}this.matrix.copy(n.matrixWorld),Object3D.prototype.updateMatrixWorld.call(this,t)}}(),_init:function(){var e=this,t=this.iks;function i(t){return new Line(function(e){var t=new BufferGeometry,i=new Float32Array(3*(2+e.links.length));return t.addAttribute("position",new BufferAttribute(i,3)),t}(t),e.lineMaterial)}for(var r=0,n=t.length;r<n;r++){var o=t[r];this.add(new Mesh(e.sphereGeometry,e.targetSphereMaterial)),this.add(new Mesh(e.sphereGeometry,e.effectorSphereMaterial));for(var a=0,s=o.links.length;a<s;a++)this.add(new Mesh(e.sphereGeometry,e.linkSphereMaterial));this.add(i(o))}}}),e}();function AnimationAction(e,t,i){this._mixer=e,this._clip=t,this._localRoot=i||null;for(var r=t.tracks,n=r.length,o=new Array(n),a={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding},s=0;s!==n;++s){var l=r[s].createInterpolant(null);o[s]=l,l.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(n),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Interpolant(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i}function LinearInterpolant(e,t,i,r){Interpolant.call(this,e,t,i,r)}Object.assign(AnimationAction.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){var r=this._clip.duration,n=e._clip.duration,o=n/r,a=r/n;e.warp(1,o,t),this.warp(a,1,t)}return this},crossFadeTo:function(e,t,i){return e.crossFadeFrom(this,t,i)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,i){var r=this._mixer,n=r.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,l=o.sampleValues;return s[0]=n,s[1]=n+i,l[0]=e/a,l[1]=t/a,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,i,r){if(this.enabled){var n=this._startTime;if(null!==n){var o=(e-n)*i;if(o<0||0===i)return;this._startTime=null,t=i*o}t*=this._updateTimeScale(e);var a=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var l=this._interpolants,u=this._propertyBindings,h=0,c=l.length;h!==c;++h)l[h].evaluate(a),u[h].accumulate(r,s)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var i=this._weightInterpolant;if(null!==i){var r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var i=this._timeScaleInterpolant;if(null!==i)t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,i=this._clip.duration,r=this.loop,n=this._loopCount,o=r===LoopPingPong;if(0===e)return-1===n?t:o&&1==(1&n)?i-t:t;if(r===LoopOnce){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=i)t=i;else{if(!(t<0))break e;t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===n&&(e>=0?(n=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),t>=i||t<0){var a=Math.floor(t/i);t-=i*a,n+=Math.abs(a);var s=this.repetitions-n;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?i:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}if(o&&1==(1&n))return this.time=t,i-t}return this.time=t,t},_setEndings:function(e,t,i){var r=this._interpolantSettings;i?(r.endingStart=ZeroSlopeEnding,r.endingEnd=ZeroSlopeEnding):(r.endingStart=e?this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding,r.endingEnd=t?this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding)},_scheduleFading:function(e,t,i){var r=this._mixer,n=r.time,o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=n,s[0]=t,a[1]=n+e,s[1]=i,this}}),Object.assign(Interpolant.prototype,{evaluate:function(e){var t=this.parameterPositions,i=this._cachedIndex,r=t[i],n=t[i-1];e:{t:{var o;i:{r:if(!(e<r)){for(var a=i+2;;){if(void 0===r){if(e<n)break r;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,n)}if(i===a)break;if(n=r,e<(r=t[++i]))break t}o=t.length;break i}if(e>=n)break e;var s=t[1];e<s&&(i=2,n=s);for(a=i-2;;){if(void 0===n)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(i===a)break;if(r=n,e>=(n=t[--i-1]))break t}o=i,i=0}for(;i<o;){var l=i+o>>>1;e<t[l]?o=l:i=l+1}if(r=t[i],void 0===(n=t[i-1]))return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,n,e)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r,o=0;o!==r;++o)t[o]=i[n+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(Interpolant.prototype,{beforeStart_:Interpolant.prototype.copySampleValue_,afterEnd_:Interpolant.prototype.copySampleValue_}),LinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:LinearInterpolant,interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,u=(i-t)/(r-t),h=1-u,c=0;c!==a;++c)n[c]=o[l+c]*h+o[s+c]*u;return n}});var RESERVED_CHARS_RE="\\[\\]\\.:\\/",wordChar,wordCharOrDot,directoryRe,nodeRe,objectRe,propertyRe,trackRe,supportedObjectNames,reservedRe;function Composite(e,t,i){var r=i||PropertyBinding.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function PropertyBinding(e,t,i){this.path=t,this.parsedPath=i||PropertyBinding.parseTrackName(t),this.node=PropertyBinding.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function PropertyMixer(e,t,i){this.binding=e,this.valueSize=i;var r,n=Float64Array;switch(t){case"quaternion":r=this._slerp;break;case"string":case"bool":n=Array,r=this._select;break;default:r=this._lerp}this.buffer=new n(4*i),this._mixBufferRegion=r,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Object.assign(Composite.prototype,{getValue:function(e,t){this.bind();var i=this._targetGroup.nCachedObjects_,r=this._bindings[i];void 0!==r&&r.getValue(e,t)},setValue:function(e,t){for(var i=this._bindings,r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}),Object.assign(PropertyBinding,{Composite:Composite,create:function(e,t,i){return e&&e.isAnimationObjectGroup?new PropertyBinding.Composite(e,t,i):new PropertyBinding(e,t,i)},sanitizeNodeName:(reservedRe=new RegExp("["+RESERVED_CHARS_RE+"]","g"),function(e){return e.replace(/\s/g,"_").replace(reservedRe,"")}),parseTrackName:(wordChar="[^"+RESERVED_CHARS_RE+"]",wordCharOrDot="[^"+RESERVED_CHARS_RE.replace("\\.","")+"]",directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",wordChar),nodeRe=/(WCOD+)?/.source.replace("WCOD",wordCharOrDot),objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",wordChar),propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",wordChar),trackRe=new RegExp("^"+directoryRe+nodeRe+objectRe+propertyRe+"$"),supportedObjectNames=["material","materials","bones"],function(e){var t=trackRe.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var n=i.nodeName.substring(r+1);-1!==supportedObjectNames.indexOf(n)&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=n)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}),findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){var r=function(e){for(var i=0;i<e.length;i++){var n=e[i];if(n.name===t||n.uuid===t)return n;var o=r(n.children);if(o)return o}return null},n=r(e.children);if(n)return n}return null}}),Object.assign(PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)e[t++]=i[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++]},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,i=t.objectName,r=t.propertyName,n=t.propertyIndex;if(e||(e=PropertyBinding.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(i){var o=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var a=0;a<e.length;a++)if(e[a].name===o){o=a;break}break;default:if(void 0===e[i])return void console.error("PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==o){if(void 0===e[o])return void console.error("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}var s=e[r];if(void 0!==s){var l=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var u=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(a=0;a<this.node.geometry.morphAttributes.position.length;a++)if(e.geometry.morphAttributes.position[a].name===n){n=a;break}}else{if(!e.geometry.morphTargets)return void console.error("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(a=0;a<this.node.geometry.morphTargets.length;a++)if(e.geometry.morphTargets[a].name===n){n=a;break}}}u=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else void 0!==s.fromArray&&void 0!==s.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(u=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][l]}else{var h=t.nodeName;console.error("PropertyBinding: Trying to update property for track: "+h+"."+r+" but it wasn't found.",e)}}else console.error("PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(PropertyBinding.prototype,{_getValue_unbound:PropertyBinding.prototype.getValue,_setValue_unbound:PropertyBinding.prototype.setValue}),Object.assign(PropertyMixer.prototype,{accumulate:function(e,t){var i=this.buffer,r=this.valueSize,n=e*r+r,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==r;++a)i[n+a]=i[a];o=t}else{var s=t/(o+=t);this._mixBufferRegion(i,n,0,s,r)}this.cumulativeWeight=o},apply:function(e){var t=this.valueSize,i=this.buffer,r=e*t+t,n=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,n<1){var a=3*t;this._mixBufferRegion(i,r,a,1-n,t)}for(var s=t,l=t+t;s!==l;++s)if(i[s]!==i[s+t]){o.setValue(i,r);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,i=this.valueSize,r=3*i;e.getValue(t,r);for(var n=i,o=r;n!==o;++n)t[n]=t[r+n%i];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,i,r,n){if(r>=.5)for(var o=0;o!==n;++o)e[t+o]=e[i+o]},_slerp:function(e,t,i,r){Quaternion.slerpFlat(e,t,e,t,e,i,r)},_lerp:function(e,t,i,r,n){for(var o=1-r,a=0;a!==n;++a){var s=t+a;e[s]=e[s]*o+e[i+a]*r}}});var AnimationUtils={arraySlice:function(e,t,i){return AnimationUtils.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,i=new Array(t),r=0;r!==t;++r)i[r]=r;return i.sort(function(t,i){return e[t]-e[i]}),i},sortedArray:function(e,t,i){for(var r=e.length,n=new e.constructor(r),o=0,a=0;a!==r;++o)for(var s=i[o]*t,l=0;l!==t;++l)n[a++]=e[s+l];return n},flattenJSON:function(e,t,i,r){for(var n=1,o=e[0];void 0!==o&&void 0===o[r];)o=e[n++];if(void 0!==o){var a=o[r];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[r])&&(t.push(o.time),i.push.apply(i,a)),o=e[n++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[r])&&(t.push(o.time),a.toArray(i,i.length)),o=e[n++]}while(void 0!==o);else do{void 0!==(a=o[r])&&(t.push(o.time),i.push(a)),o=e[n++]}while(void 0!==o)}}};function CubicInterpolant(e,t,i,r){Interpolant.call(this,e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function DiscreteInterpolant(e,t,i,r){Interpolant.call(this,e,t,i,r)}function KeyframeTrack(e,t,i,r){if(void 0===e)throw new Error("KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=AnimationUtils.convertArray(t,this.TimeBufferType),this.values=AnimationUtils.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function BooleanKeyframeTrack(e,t,i){KeyframeTrack.call(this,e,t,i)}function ColorKeyframeTrack(e,t,i,r){KeyframeTrack.call(this,e,t,i,r)}function NumberKeyframeTrack(e,t,i,r){KeyframeTrack.call(this,e,t,i,r)}function QuaternionLinearInterpolant(e,t,i,r){Interpolant.call(this,e,t,i,r)}function QuaternionKeyframeTrack(e,t,i,r){KeyframeTrack.call(this,e,t,i,r)}function StringKeyframeTrack(e,t,i,r){KeyframeTrack.call(this,e,t,i,r)}function VectorKeyframeTrack(e,t,i,r){KeyframeTrack.call(this,e,t,i,r)}function AnimationClip(e,t,i){this.name=e,this.tracks=i,this.duration=void 0!==t?t:-1,this.uuid=_Math.generateUUID(),this.duration<0&&this.resetDuration()}function getTrackTypeForValueTypeName(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("KeyframeTrack: Unsupported typeName: "+e)}function parseKeyframeTrack(e){if(void 0===e.type)throw new Error("KeyframeTrack: track type undefined, can not parse");var t=getTrackTypeForValueTypeName(e.type);if(void 0===e.times){var i=[],r=[];AnimationUtils.flattenJSON(e.keys,i,r,"value"),e.times=i,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}function AnimationMixer(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Bone(){Object3D.call(this),this.type="Bone"}function BoxGeometry(e,t,i,r,n,o){Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:o},this.fromBufferGeometry(new BoxBufferGeometry(e,t,i,r,n,o)),this.mergeVertices()}function BoxBufferGeometry(e,t,i,r,n,o){BufferGeometry.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:o};var a=this;e=e||1,t=t||1,i=i||1,r=Math.floor(r)||1,n=Math.floor(n)||1,o=Math.floor(o)||1;var s=[],l=[],u=[],h=[],c=0,d=0;function p(e,t,i,r,n,o,p,f,m,v,g){var y,_,b=o/m,x=p/v,w=o/2,S=p/2,M=f/2,T=m+1,A=v+1,C=0,L=0,N=new Vector3;for(_=0;_<A;_++){var P=_*x-S;for(y=0;y<T;y++){var k=y*b-w;N[e]=k*r,N[t]=P*n,N[i]=M,l.push(N.x,N.y,N.z),N[e]=0,N[t]=0,N[i]=f>0?1:-1,u.push(N.x,N.y,N.z),h.push(y/m),h.push(1-_/v),C+=1}}for(_=0;_<v;_++)for(y=0;y<m;y++){var E=c+y+T*_,D=c+y+T*(_+1),O=c+(y+1)+T*(_+1),R=c+(y+1)+T*_;s.push(E,D,R),s.push(D,O,R),L+=6}a.addGroup(d,L,g),d+=L,c+=C}p("z","y","x",-1,-1,i,t,e,o,n,0),p("z","y","x",1,-1,i,t,-e,o,n,1),p("x","z","y",1,1,e,i,t,r,o,2),p("x","z","y",1,-1,e,i,-t,r,o,3),p("x","y","z",1,-1,e,t,i,r,n,4),p("x","y","z",-1,-1,e,t,-i,r,n,5),this.setIndex(s),this.addAttribute("position",new Float32BufferAttribute(l,3)),this.addAttribute("normal",new Float32BufferAttribute(u,3)),this.addAttribute("uv",new Float32BufferAttribute(h,2))}function CylinderGeometry(e,t,i,r,n,o,a,s){Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new CylinderBufferGeometry(e,t,i,r,n,o,a,s)),this.mergeVertices()}function CylinderBufferGeometry(e,t,i,r,n,o,a,s){BufferGeometry.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:o,thetaStart:a,thetaLength:s};var l=this;e=void 0!==e?e:1,t=void 0!==t?t:1,i=i||1,r=Math.floor(r)||8,n=Math.floor(n)||1,o=void 0!==o&&o,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;var u=[],h=[],c=[],d=[],p=0,f=[],m=i/2,v=0;function g(i){var n,o,f,g=new Vector2,y=new Vector3,_=0,b=!0===i?e:t,x=!0===i?1:-1;for(o=p,n=1;n<=r;n++)h.push(0,m*x,0),c.push(0,x,0),d.push(.5,.5),p++;for(f=p,n=0;n<=r;n++){var w=n/r*s+a,S=Math.cos(w),M=Math.sin(w);y.x=b*M,y.y=m*x,y.z=b*S,h.push(y.x,y.y,y.z),c.push(0,x,0),g.x=.5*S+.5,g.y=.5*M*x+.5,d.push(g.x,g.y),p++}for(n=0;n<r;n++){var T=o+n,A=f+n;!0===i?u.push(A,A+1,T):u.push(A+1,A,T),_+=3}l.addGroup(v,_,!0===i?1:2),v+=_}!function(){var o,g,y=new Vector3,_=new Vector3,b=0,x=(t-e)/i;for(g=0;g<=n;g++){var w=[],S=g/n,M=S*(t-e)+e;for(o=0;o<=r;o++){var T=o/r,A=T*s+a,C=Math.sin(A),L=Math.cos(A);_.x=M*C,_.y=-S*i+m,_.z=M*L,h.push(_.x,_.y,_.z),y.set(C,x,L).normalize(),c.push(y.x,y.y,y.z),d.push(T,1-S),w.push(p++)}f.push(w)}for(o=0;o<r;o++)for(g=0;g<n;g++){var N=f[g][o],P=f[g+1][o],k=f[g+1][o+1],E=f[g][o+1];u.push(N,P,E),u.push(P,k,E),b+=6}l.addGroup(v,b,0),v+=b}(),!1===o&&(e>0&&g(!0),t>0&&g(!1)),this.setIndex(u),this.addAttribute("position",new Float32BufferAttribute(h,3)),this.addAttribute("normal",new Float32BufferAttribute(c,3)),this.addAttribute("uv",new Float32BufferAttribute(d,2))}CubicInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:CubicInterpolant,DefaultSettings_:{endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding},intervalChanged_:function(e,t,i){var r=this.parameterPositions,n=e-2,o=e+1,a=r[n],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:n=e,a=2*t-i;break;case WrapAroundEnding:a=t+r[n=r.length-2]-r[n+1];break;default:n=e,a=i}if(void 0===s)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:o=e,s=2*i-t;break;case WrapAroundEnding:o=1,s=i+r[1]-r[0];break;default:o=e-1,s=t}var l=.5*(i-t),u=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(s-i),this._offsetPrev=n*u,this._offsetNext=o*u},interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,u=this._offsetPrev,h=this._offsetNext,c=this._weightPrev,d=this._weightNext,p=(i-t)/(r-t),f=p*p,m=f*p,v=-c*m+2*c*f-c*p,g=(1+c)*m+(-1.5-2*c)*f+(-.5+c)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,_=d*m-d*f,b=0;b!==a;++b)n[b]=v*o[u+b]+g*o[l+b]+y*o[s+b]+_*o[h+b];return n}}),DiscreteInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:DiscreteInterpolant,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(KeyframeTrack,{toJSON:function(e){var t,i=e.constructor;if(void 0!==i.toJSON)t=i.toJSON(e);else{t={name:e.name,times:AnimationUtils.convertArray(e.times,Array),values:AnimationUtils.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}}),Object.assign(KeyframeTrack.prototype,{constructor:KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:InterpolateLinear,InterpolantFactoryMethodDiscrete:function(e){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new LinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new CubicInterpolant(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case InterpolateDiscrete:t=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:t=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("KeyframeTrack:",i),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,i=0,r=t.length;i!==r;++i)t[i]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,i=0,r=t.length;i!==r;++i)t[i]*=e;return this},trim:function(e,t){for(var i=this.times,r=i.length,n=0,o=r-1;n!==r&&i[n]<e;)++n;for(;-1!==o&&i[o]>t;)--o;if(++o,0!==n||o!==r){n>=o&&(n=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=AnimationUtils.arraySlice(i,n,o),this.values=AnimationUtils.arraySlice(this.values,n*a,o*a)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("KeyframeTrack: Invalid value size in track.",this),e=!1);var i=this.times,r=this.values,n=i.length;0===n&&(console.error("KeyframeTrack: Track is empty.",this),e=!1);for(var o=null,a=0;a!==n;a++){var s=i[a];if("number"==typeof s&&isNaN(s)){console.error("KeyframeTrack: Time is not a valid number.",this,a,s),e=!1;break}if(null!==o&&o>s){console.error("KeyframeTrack: Out of order keys.",this,a,s,o),e=!1;break}o=s}if(void 0!==r&&AnimationUtils.isTypedArray(r)){a=0;for(var l=r.length;a!==l;++a){var u=r[a];if(isNaN(u)){console.error("KeyframeTrack: Value is not a valid number.",this,a,u),e=!1;break}}}return e},optimize:function(){for(var e=this.times,t=this.values,i=this.getValueSize(),r=this.getInterpolation()===InterpolateSmooth,n=1,o=e.length-1,a=1;a<o;++a){var s=!1,l=e[a];if(l!==e[a+1]&&(1!==a||l!==l[0]))if(r)s=!0;else for(var u=a*i,h=u-i,c=u+i,d=0;d!==i;++d){var p=t[u+d];if(p!==t[h+d]||p!==t[c+d]){s=!0;break}}if(s){if(a!==n){e[n]=e[a];var f=a*i,m=n*i;for(d=0;d!==i;++d)t[m+d]=t[f+d]}++n}}if(o>0){e[n]=e[o];for(f=o*i,m=n*i,d=0;d!==i;++d)t[m+d]=t[f+d];++n}return n!==e.length&&(this.times=AnimationUtils.arraySlice(e,0,n),this.values=AnimationUtils.arraySlice(t,0,n*i)),this},clone:function(){var e=AnimationUtils.arraySlice(this.times,0),t=AnimationUtils.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}),BooleanKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ColorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:ColorKeyframeTrack,ValueTypeName:"color"}),NumberKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:NumberKeyframeTrack,ValueTypeName:"number"}),QuaternionLinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:QuaternionLinearInterpolant,interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=(i-t)/(r-t),u=s+a;s!==u;s+=4)Quaternion.slerpFlat(n,0,o,s-a,o,s,l);return n}}),QuaternionKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:InterpolateLinear,InterpolantFactoryMethodLinear:function(e){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),StringKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),VectorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:VectorKeyframeTrack,ValueTypeName:"vector"}),Object.assign(AnimationClip,{parse:function(e){for(var t=[],i=e.tracks,r=1/(e.fps||1),n=0,o=i.length;n!==o;++n)t.push(parseKeyframeTrack(i[n]).scale(r));return new AnimationClip(e.name,e.duration,t)},toJSON:function(e){for(var t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},n=0,o=i.length;n!==o;++n)t.push(KeyframeTrack.toJSON(i[n]));return r},CreateFromMorphTargetSequence:function(e,t,i,r){for(var n=t.length,o=[],a=0;a<n;a++){var s=[],l=[];s.push((a+n-1)%n,a,(a+1)%n),l.push(0,1,0);var u=AnimationUtils.getKeyframeOrder(s);s=AnimationUtils.sortedArray(s,1,u),l=AnimationUtils.sortedArray(l,1,u),r||0!==s[0]||(s.push(n),l.push(l[0])),o.push(new NumberKeyframeTrack(".morphTargetInfluences["+t[a].name+"]",s,l).scale(1/i))}return new AnimationClip(e,-1,o)},findByName:function(e,t){var i=e;if(!Array.isArray(e)){var r=e;i=r.geometry&&r.geometry.animations||r.animations}for(var n=0;n<i.length;n++)if(i[n].name===t)return i[n];return null},CreateClipsFromMorphTargetSequences:function(e,t,i){for(var r={},n=/^([\w-]*?)([\d]+)$/,o=0,a=e.length;o<a;o++){var s=e[o],l=s.name.match(n);if(l&&l.length>1){var u=r[c=l[1]];u||(r[c]=u=[]),u.push(s)}}var h=[];for(var c in r)h.push(AnimationClip.CreateFromMorphTargetSequence(c,r[c],t,i));return h},parseAnimation:function(e,t){if(!e)return console.error("AnimationClip: No animation in JSONLoader data."),null;for(var i=function(e,t,i,r,n){if(0!==i.length){var o=[],a=[];AnimationUtils.flattenJSON(i,o,a,r),0!==o.length&&n.push(new e(t,o,a))}},r=[],n=e.name||"default",o=e.length||-1,a=e.fps||30,s=e.hierarchy||[],l=0;l<s.length;l++){var u=s[l].keys;if(u&&0!==u.length)if(u[0].morphTargets){for(var h={},c=0;c<u.length;c++)if(u[c].morphTargets)for(var d=0;d<u[c].morphTargets.length;d++)h[u[c].morphTargets[d]]=-1;for(var p in h){var f=[],m=[];for(d=0;d!==u[c].morphTargets.length;++d){var v=u[c];f.push(v.time),m.push(v.morphTarget===p?1:0)}r.push(new NumberKeyframeTrack(".morphTargetInfluence["+p+"]",f,m))}o=h.length*(a||1)}else{var g=".bones["+t[l].name+"]";i(VectorKeyframeTrack,g+".position",u,"pos",r),i(QuaternionKeyframeTrack,g+".quaternion",u,"rot",r),i(VectorKeyframeTrack,g+".scale",u,"scl",r)}}return 0===r.length?null:new AnimationClip(n,o,r)}}),Object.assign(AnimationClip.prototype,{resetDuration:function(){for(var e=0,t=0,i=this.tracks.length;t!==i;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new AnimationClip(this.name,this.duration,e)}}),AnimationMixer.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:AnimationMixer,_bindAction:function(e,t){var i=e._localRoot||this._root,r=e._clip.tracks,n=r.length,o=e._propertyBindings,a=e._interpolants,s=i.uuid,l=this._bindingsByRootAndName,u=l[s];void 0===u&&(u={},l[s]=u);for(var h=0;h!==n;++h){var c=r[h],d=c.name,p=u[d];if(void 0!==p)o[h]=p;else{if(void 0!==(p=o[h])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,d));continue}var f=t&&t._propertyBindings[h].binding.parsedPath;++(p=new PropertyMixer(PropertyBinding.create(i,d,f),c.ValueTypeName,c.getValueSize())).referenceCount,this._addInactiveBinding(p,s,d),o[h]=p}a[h].resultBuffer=p.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,t)}for(var n=e._propertyBindings,o=0,a=n.length;o!==a;++o){var s=n[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,i=0,r=t.length;i!==r;++i){var n=t[i];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,i){var r=this._actions,n=this._actionsByClip,o=n[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=o;else{var a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[i]=e},_removeInactiveAction:function(e){var t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;var n=e._clip.uuid,o=this._actionsByClip,a=o[n],s=a.knownActions,l=s[s.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,s[u]=l,s.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[n],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,i=0,r=t.length;i!==r;++i){var n=t[i];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(e){var t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_takeBackAction:function(e){var t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_addInactiveBinding:function(e,t,i){var r=this._bindingsByRootAndName,n=r[t],o=this._bindings;void 0===n&&(n={},r[t]=n),n[i]=e,e._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,i=e.binding,r=i.rootNode.uuid,n=i.path,o=this._bindingsByRootAndName,a=o[r],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete a[n];e:{for(var u in a)break e;delete o[r]}},_lendBinding:function(e){var t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_takeBackBinding:function(e){var t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return void 0===i&&((i=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=i),i},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,n=t[r];e.__cacheIndex=r,t[r]=e,n.__cacheIndex=i,t[i]=n},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var i=t||this._root,r=i.uuid,n="string"==typeof e?AnimationClip.findByName(i,e):e,o=null!==n?n.uuid:e,a=this._actionsByClip[o],s=null;if(void 0!==a){var l=a.actionByRoot[r];if(void 0!==l)return l;s=a.knownActions[0],null===n&&(n=s._clip)}if(null===n)return null;var u=new AnimationAction(this,n,t);return this._bindAction(u,s),this._addInactiveAction(u,o,r),u},existingAction:function(e,t){var i=t||this._root,r=i.uuid,n="string"==typeof e?AnimationClip.findByName(i,e):e,o=n?n.uuid:e,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[r]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,i=this._bindings,r=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var n=0;n!==t;++n)e[n].reset();for(n=0;n!==r;++n)i[n].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,i=this._nActiveActions,r=this.time+=e,n=Math.sign(e),o=this._accuIndex^=1,a=0;a!==i;++a){t[a]._update(r,e,n,o)}var s=this._bindings,l=this._nActiveBindings;for(a=0;a!==l;++a)s[a].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,i=e.uuid,r=this._actionsByClip,n=r[i];if(void 0!==n){for(var o=n.knownActions,a=0,s=o.length;a!==s;++a){var l=o[a];this._deactivateAction(l);var u=l._cacheIndex,h=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,h._cacheIndex=u,t[u]=h,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[i]}},uncacheRoot:function(e){var t=e.uuid,i=this._actionsByClip;for(var r in i){var n=i[r].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}var o=this._bindingsByRootAndName[t];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}),Bone.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Bone,isBone:!0}),BoxGeometry.prototype=Object.create(Geometry.prototype),BoxGeometry.prototype.constructor=BoxGeometry,BoxBufferGeometry.prototype=Object.create(BufferGeometry.prototype),BoxBufferGeometry.prototype.constructor=BoxBufferGeometry,CylinderGeometry.prototype=Object.create(Geometry.prototype),CylinderGeometry.prototype.constructor=CylinderGeometry,CylinderBufferGeometry.prototype=Object.create(BufferGeometry.prototype),CylinderBufferGeometry.prototype.constructor=CylinderBufferGeometry;var MMDPhysics=function(){function e(e,i,r,n){if("undefined"==typeof Ammo)throw new Error("MMDPhysics: Import ammo.js https://github.com/kripken/ammo.js");r=r||[],n=n||{},this.manager=new t,this.mesh=e,this.unitStep=void 0!==n.unitStep?n.unitStep:1/65,this.maxStepNum=void 0!==n.maxStepNum?n.maxStepNum:3,this.gravity=new Vector3(0,-98,0),void 0!==n.gravity&&this.gravity.copy(n.gravity),this.world=void 0!==n.world?n.world:null,this.bodies=[],this.constraints=[],this._init(e,i,r)}function t(){this.threeVector3s=[],this.threeMatrix4s=[],this.threeQuaternions=[],this.threeEulers=[],this.transforms=[],this.quaternions=[],this.vector3s=[]}function i(e,t,i,r){this.mesh=e,this.world=t,this.params=i,this.manager=r,this.body=null,this.bone=null,this.boneOffsetForm=null,this.boneOffsetFormInverse=null,this._init()}function r(e,t,i,r,n,o){this.mesh=e,this.world=t,this.bodyA=i,this.bodyB=r,this.params=n,this.manager=o,this.constraint=null,this._init()}function n(e,t){Object3D.call(this),this.root=e,this.physics=t,this.matrix.copy(e.matrixWorld),this.matrixAutoUpdate=!1,this.materials=[],this.materials.push(new MeshBasicMaterial({color:new Color(16746632),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new MeshBasicMaterial({color:new Color(8978312),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new MeshBasicMaterial({color:new Color(8947967),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this._init()}var o,a,s,l;return e.prototype={constructor:e,update:function(e){var t,i=this.manager,r=this.mesh,n=!1,o=i.allocThreeVector3(),a=i.allocThreeQuaternion(),s=i.allocThreeVector3();return r.matrixWorld.decompose(o,a,s),1===s.x&&1===s.y&&1===s.z||(n=!0),n&&(null!==(t=r.parent)&&(r.parent=null),s.copy(this.mesh.scale),r.scale.set(1,1,1),r.updateMatrixWorld(!0)),this._updateRigidBodies(),this._stepSimulation(e),this._updateBones(),n&&(null!==t&&(r.parent=t),r.scale.copy(s)),i.freeThreeVector3(s),i.freeThreeQuaternion(a),i.freeThreeVector3(o),this},reset:function(){for(var e=0,t=this.bodies.length;e<t;e++)this.bodies[e].reset();return this},warmup:function(e){for(var t=0;t<e;t++)this.update(1/60);return this},setGravity:function(e){return this.world.setGravity(new Ammo.btVector3(e.x,e.y,e.z)),this.gravity.copy(e),this},createHelper:function(){return new n(this.mesh,this)},_init:function(e,t,i){var r=this.manager,n=e.parent;null!==n&&(n=null);var o=r.allocThreeVector3(),a=r.allocThreeQuaternion(),s=r.allocThreeVector3();o.copy(e.position),a.copy(e.quaternion),s.copy(e.scale),e.position.set(0,0,0),e.quaternion.set(0,0,0,1),e.scale.set(1,1,1),e.updateMatrixWorld(!0),null===this.world&&(this.world=this._createWorld(),this.setGravity(this.gravity)),this._initRigidBodies(t),this._initConstraints(i),null!==n&&(e.parent=n),e.position.copy(o),e.quaternion.copy(a),e.scale.copy(s),e.updateMatrixWorld(!0),this.reset(),r.freeThreeVector3(o),r.freeThreeQuaternion(a),r.freeThreeVector3(s)},_createWorld:function(){var e=new Ammo.btDefaultCollisionConfiguration,t=new Ammo.btCollisionDispatcher(e),i=new Ammo.btDbvtBroadphase,r=new Ammo.btSequentialImpulseConstraintSolver;return new Ammo.btDiscreteDynamicsWorld(t,i,r,e)},_initRigidBodies:function(e){for(var t=0,r=e.length;t<r;t++)this.bodies.push(new i(this.mesh,this.world,e[t],this.manager))},_initConstraints:function(e){for(var t=0,i=e.length;t<i;t++){var n=e[t],o=this.bodies[n.rigidBodyIndex1],a=this.bodies[n.rigidBodyIndex2];this.constraints.push(new r(this.mesh,this.world,o,a,n,this.manager))}},_stepSimulation:function(e){var t=this.unitStep,i=e,r=1+(e/t|0);i<t&&(i=t,r=1),r>this.maxStepNum&&(r=this.maxStepNum),this.world.stepSimulation(i,r,t)},_updateRigidBodies:function(){for(var e=0,t=this.bodies.length;e<t;e++)this.bodies[e].updateFromBone()},_updateBones:function(){for(var e=0,t=this.bodies.length;e<t;e++)this.bodies[e].updateBone()}},t.prototype={constructor:t,allocThreeVector3:function(){return this.threeVector3s.length>0?this.threeVector3s.pop():new Vector3},freeThreeVector3:function(e){this.threeVector3s.push(e)},allocThreeMatrix4:function(){return this.threeMatrix4s.length>0?this.threeMatrix4s.pop():new Matrix4},freeThreeMatrix4:function(e){this.threeMatrix4s.push(e)},allocThreeQuaternion:function(){return this.threeQuaternions.length>0?this.threeQuaternions.pop():new Quaternion},freeThreeQuaternion:function(e){this.threeQuaternions.push(e)},allocThreeEuler:function(){return this.threeEulers.length>0?this.threeEulers.pop():new Euler},freeThreeEuler:function(e){this.threeEulers.push(e)},allocTransform:function(){return this.transforms.length>0?this.transforms.pop():new Ammo.btTransform},freeTransform:function(e){this.transforms.push(e)},allocQuaternion:function(){return this.quaternions.length>0?this.quaternions.pop():new Ammo.btQuaternion},freeQuaternion:function(e){this.quaternions.push(e)},allocVector3:function(){return this.vector3s.length>0?this.vector3s.pop():new Ammo.btVector3},freeVector3:function(e){this.vector3s.push(e)},setIdentity:function(e){e.setIdentity()},getBasis:function(e){var t=this.allocQuaternion();return e.getBasis().getRotation(t),t},getBasisAsMatrix3:function(e){var t=this.getBasis(e),i=this.quaternionToMatrix3(t);return this.freeQuaternion(t),i},getOrigin:function(e){return e.getOrigin()},setOrigin:function(e,t){e.getOrigin().setValue(t.x(),t.y(),t.z())},copyOrigin:function(e,t){var i=t.getOrigin();this.setOrigin(e,i)},setBasis:function(e,t){e.setRotation(t)},setBasisFromMatrix3:function(e,t){var i=this.matrix3ToQuaternion(t);this.setBasis(e,i),this.freeQuaternion(i)},setOriginFromArray3:function(e,t){e.getOrigin().setValue(t[0],t[1],t[2])},setOriginFromThreeVector3:function(e,t){e.getOrigin().setValue(t.x,t.y,t.z)},setBasisFromArray3:function(e,t){var i=this.allocThreeQuaternion(),r=this.allocThreeEuler();r.set(t[0],t[1],t[2]),this.setBasisFromThreeQuaternion(e,i.setFromEuler(r)),this.freeThreeEuler(r),this.freeThreeQuaternion(i)},setBasisFromThreeQuaternion:function(e,t){var i=this.allocQuaternion();i.setX(t.x),i.setY(t.y),i.setZ(t.z),i.setW(t.w),this.setBasis(e,i),this.freeQuaternion(i)},multiplyTransforms:function(e,t){var i=this.allocTransform();this.setIdentity(i);var r=this.getBasisAsMatrix3(e),n=this.getBasisAsMatrix3(t),o=this.getOrigin(e),a=this.getOrigin(t),s=this.multiplyMatrix3ByVector3(r,a),l=this.addVector3(s,o);this.setOrigin(i,l);var u=this.multiplyMatrices3(r,n);return this.setBasisFromMatrix3(i,u),this.freeVector3(s),this.freeVector3(l),i},inverseTransform:function(e){var t=this.allocTransform(),i=this.getBasisAsMatrix3(e),r=this.getOrigin(e),n=this.transposeMatrix3(i),o=this.negativeVector3(r),a=this.multiplyMatrix3ByVector3(n,o);return this.setOrigin(t,a),this.setBasisFromMatrix3(t,n),this.freeVector3(o),this.freeVector3(a),t},multiplyMatrices3:function(e,t){var i=[],r=this.rowOfMatrix3(e,0),n=this.rowOfMatrix3(e,1),o=this.rowOfMatrix3(e,2),a=this.columnOfMatrix3(t,0),s=this.columnOfMatrix3(t,1),l=this.columnOfMatrix3(t,2);return i[0]=this.dotVectors3(r,a),i[1]=this.dotVectors3(r,s),i[2]=this.dotVectors3(r,l),i[3]=this.dotVectors3(n,a),i[4]=this.dotVectors3(n,s),i[5]=this.dotVectors3(n,l),i[6]=this.dotVectors3(o,a),i[7]=this.dotVectors3(o,s),i[8]=this.dotVectors3(o,l),this.freeVector3(r),this.freeVector3(n),this.freeVector3(o),this.freeVector3(a),this.freeVector3(s),this.freeVector3(l),i},addVector3:function(e,t){var i=this.allocVector3();return i.setValue(e.x()+t.x(),e.y()+t.y(),e.z()+t.z()),i},dotVectors3:function(e,t){return e.x()*t.x()+e.y()*t.y()+e.z()*t.z()},rowOfMatrix3:function(e,t){var i=this.allocVector3();return i.setValue(e[3*t+0],e[3*t+1],e[3*t+2]),i},columnOfMatrix3:function(e,t){var i=this.allocVector3();return i.setValue(e[t+0],e[t+3],e[t+6]),i},negativeVector3:function(e){var t=this.allocVector3();return t.setValue(-e.x(),-e.y(),-e.z()),t},multiplyMatrix3ByVector3:function(e,t){var i=this.allocVector3(),r=this.rowOfMatrix3(e,0),n=this.rowOfMatrix3(e,1),o=this.rowOfMatrix3(e,2),a=this.dotVectors3(r,t),s=this.dotVectors3(n,t),l=this.dotVectors3(o,t);return i.setValue(a,s,l),this.freeVector3(r),this.freeVector3(n),this.freeVector3(o),i},transposeMatrix3:function(e){var t=[];return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t},quaternionToMatrix3:function(e){var t=[],i=e.x(),r=e.y(),n=e.z(),o=e.w(),a=i*i,s=r*r,l=n*n,u=i*r,h=r*n,c=n*i,d=i*o,p=r*o,f=n*o;return t[0]=1-2*(s+l),t[1]=2*(u-f),t[2]=2*(c+p),t[3]=2*(u+f),t[4]=1-2*(l+a),t[5]=2*(h-d),t[6]=2*(c-p),t[7]=2*(h+d),t[8]=1-2*(a+s),t},matrix3ToQuaternion:function(e){var t,i,r,n,o,a=e[0]+e[4]+e[8];a>0?(o=.25*(t=2*Math.sqrt(a+1)),i=(e[7]-e[5])/t,r=(e[2]-e[6])/t,n=(e[3]-e[1])/t):e[0]>e[4]&&e[0]>e[8]?(t=2*Math.sqrt(1+e[0]-e[4]-e[8]),o=(e[7]-e[5])/t,i=.25*t,r=(e[1]+e[3])/t,n=(e[2]+e[6])/t):e[4]>e[8]?(t=2*Math.sqrt(1+e[4]-e[0]-e[8]),o=(e[2]-e[6])/t,i=(e[1]+e[3])/t,r=.25*t,n=(e[5]+e[7])/t):(t=2*Math.sqrt(1+e[8]-e[0]-e[4]),o=(e[3]-e[1])/t,i=(e[2]+e[6])/t,r=(e[5]+e[7])/t,n=.25*t);var s=this.allocQuaternion();return s.setX(i),s.setY(r),s.setZ(n),s.setW(o),s}},i.prototype={constructor:e.RigidBody,reset:function(){return this._setTransformFromBone(),this},updateFromBone:function(){return-1!==this.params.boneIndex&&0===this.params.type&&this._setTransformFromBone(),this},updateBone:function(){return 0===this.params.type||-1===this.params.boneIndex?this:(this._updateBoneRotation(),1===this.params.type&&this._updateBonePosition(),this.bone.updateMatrixWorld(!0),2===this.params.type&&this._setPositionFromBone(),this)},_init:function(){var e=this.manager,t=this.params,i=this.mesh.skeleton.bones,r=-1===t.boneIndex?new Bone:i[t.boneIndex],n=function(e){switch(e.shapeType){case 0:return new Ammo.btSphereShape(e.width);case 1:return new Ammo.btBoxShape(new Ammo.btVector3(e.width,e.height,e.depth));case 2:return new Ammo.btCapsuleShape(e.width,e.height);default:throw"unknown shape type "+e.shapeType}}(t),o=0===t.type?0:t.weight,a=e.allocVector3();a.setValue(0,0,0),0!==o&&n.calculateLocalInertia(o,a);var s=e.allocTransform();e.setIdentity(s),e.setOriginFromArray3(s,t.position),e.setBasisFromArray3(s,t.rotation);var l=e.allocThreeVector3(),u=e.allocTransform();e.setIdentity(u),e.setOriginFromThreeVector3(u,r.getWorldPosition(l));var h=e.multiplyTransforms(u,s),c=new Ammo.btDefaultMotionState(h),d=new Ammo.btRigidBodyConstructionInfo(o,c,n,a);d.set_m_friction(t.friction),d.set_m_restitution(t.restitution);var p=new Ammo.btRigidBody(d);0===t.type&&(p.setCollisionFlags(2|p.getCollisionFlags()),p.setActivationState(4)),p.setDamping(t.positionDamping,t.rotationDamping),p.setSleepingThresholds(0,0),this.world.addRigidBody(p,1<<t.groupIndex,t.groupTarget),this.body=p,this.bone=r,this.boneOffsetForm=s,this.boneOffsetFormInverse=e.inverseTransform(s),e.freeVector3(a),e.freeTransform(h),e.freeTransform(u),e.freeThreeVector3(l)},_getBoneTransform:function(){var e=this.manager,t=e.allocThreeVector3(),i=e.allocThreeQuaternion(),r=e.allocThreeVector3();this.bone.matrixWorld.decompose(t,i,r);var n=e.allocTransform();e.setOriginFromThreeVector3(n,t),e.setBasisFromThreeQuaternion(n,i);var o=e.multiplyTransforms(n,this.boneOffsetForm);return e.freeTransform(n),e.freeThreeVector3(r),e.freeThreeQuaternion(i),e.freeThreeVector3(t),o},_getWorldTransformForBone:function(){var e=this.manager,t=e.allocTransform();this.body.getMotionState().getWorldTransform(t);var i=e.multiplyTransforms(t,this.boneOffsetFormInverse);return e.freeTransform(t),i},_setTransformFromBone:function(){var e=this.manager,t=this._getBoneTransform();this.body.setCenterOfMassTransform(t),this.body.getMotionState().setWorldTransform(t),e.freeTransform(t)},_setPositionFromBone:function(){var e=this.manager,t=this._getBoneTransform(),i=e.allocTransform();this.body.getMotionState().getWorldTransform(i),e.copyOrigin(i,t),this.body.setCenterOfMassTransform(i),this.body.getMotionState().setWorldTransform(i),e.freeTransform(i),e.freeTransform(t)},_updateBoneRotation:function(){var e=this.manager,t=this._getWorldTransformForBone(),i=e.getBasis(t),r=e.allocThreeQuaternion(),n=e.allocThreeQuaternion(),o=e.allocThreeQuaternion();r.set(i.x(),i.y(),i.z(),i.w()),n.setFromRotationMatrix(this.bone.matrixWorld),n.conjugate(),n.multiply(r),o.setFromRotationMatrix(this.bone.matrix),this.bone.quaternion.copy(n.multiply(o)),e.freeThreeQuaternion(r),e.freeThreeQuaternion(n),e.freeThreeQuaternion(o),e.freeQuaternion(i),e.freeTransform(t)},_updateBonePosition:function(){var e=this.manager,t=this.body.getCenterOfMassTransform().getOrigin(),i=e.allocThreeMatrix4();i.copy(this.bone.parent.matrixWorld).getInverse(i);var r=e.allocThreeVector3();r.set(t.x(),t.y(),t.z()).applyMatrix4(i),this.bone.position.copy(r),e.freeThreeVector3(r),e.freeThreeMatrix4(i)}},r.prototype={constructor:r,_init:function(){var e=this.manager,t=this.params,i=this.bodyA,r=this.bodyB,n=e.allocTransform();e.setIdentity(n),e.setOriginFromArray3(n,t.position),e.setBasisFromArray3(n,t.rotation);var o=e.allocTransform(),a=e.allocTransform();i.body.getMotionState().getWorldTransform(o),r.body.getMotionState().getWorldTransform(a);var s=e.inverseTransform(o),l=e.inverseTransform(a),u=e.multiplyTransforms(s,n),h=e.multiplyTransforms(l,n),c=new Ammo.btGeneric6DofSpringConstraint(i.body,r.body,u,h,!0),d=e.allocVector3(),p=e.allocVector3(),f=e.allocVector3(),m=e.allocVector3();d.setValue(t.translationLimitation1[0],t.translationLimitation1[1],t.translationLimitation1[2]),p.setValue(t.translationLimitation2[0],t.translationLimitation2[1],t.translationLimitation2[2]),f.setValue(t.rotationLimitation1[0],t.rotationLimitation1[1],t.rotationLimitation1[2]),m.setValue(t.rotationLimitation2[0],t.rotationLimitation2[1],t.rotationLimitation2[2]),c.setLinearLowerLimit(d),c.setLinearUpperLimit(p),c.setAngularLowerLimit(f),c.setAngularUpperLimit(m);for(var v=0;v<3;v++)0!==t.springPosition[v]&&(c.enableSpring(v,!0),c.setStiffness(v,t.springPosition[v]));for(v=0;v<3;v++)0!==t.springRotation[v]&&(c.enableSpring(v+3,!0),c.setStiffness(v+3,t.springRotation[v]));if(void 0!==c.setParam)for(v=0;v<6;v++)c.setParam(2,.475,v);this.world.addConstraint(c,!0),this.constraint=c,e.freeTransform(n),e.freeTransform(o),e.freeTransform(a),e.freeTransform(s),e.freeTransform(l),e.freeTransform(u),e.freeTransform(h),e.freeVector3(d),e.freeVector3(p),e.freeVector3(f),e.freeVector3(m)}},n.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:n,updateMatrixWorld:(o=new Vector3,a=new Quaternion,s=new Vector3,l=new Matrix4,function(e){var t=this.root;if(this.visible){var i=this.physics.bodies;l.copy(t.matrixWorld).decompose(o,a,s).compose(o,a,s.set(1,1,1)).getInverse(l);for(var r=0,n=i.length;r<n;r++){var u=i[r].body,h=this.children[r],c=u.getCenterOfMassTransform(),d=c.getOrigin(),p=c.getRotation();h.position.set(d.x(),d.y(),d.z()).applyMatrix4(l),h.quaternion.setFromRotationMatrix(l).multiply(a.set(p.x(),p.y(),p.z(),p.w()))}}this.matrix.copy(t.matrixWorld).decompose(o,a,s).compose(o,a,s.set(1,1,1)),Object3D.prototype.updateMatrixWorld.call(this,e)}),_init:function(){var e=this.physics.bodies;function t(e){switch(e.shapeType){case 0:return new SphereBufferGeometry(e.width,16,8);case 1:return new BoxBufferGeometry(2*e.width,2*e.height,2*e.depth,8,8,8);case 2:return new i(e.width,e.height,16,8);default:return null}}function i(e,t,i,r){var n=new CylinderBufferGeometry(e,e,t,i,r,!0),o=new Mesh(new SphereBufferGeometry(e,i,r,0,2*Math.PI,0,Math.PI/2)),a=new Mesh(new SphereBufferGeometry(e,i,r,0,2*Math.PI,Math.PI/2,Math.PI/2));return o.position.set(0,t/2,0),a.position.set(0,-t/2,0),o.updateMatrix(),a.updateMatrix(),n.merge(o.geometry,o.matrix),n.merge(a.geometry,a.matrix),n}for(var r=0,n=e.length;r<n;r++){var o=e[r].params;this.add(new Mesh(t(o),this.materials[o.type]))}}}),e}(),MMDAnimationHelper=function(){function e(e){e=e||{},this.meshes=[],this.camera=null,this.cameraTarget=new Object3D,this.cameraTarget.name="target",this.audio=null,this.audioManager=null,this.objects=new WeakMap,this.configuration={sync:void 0===e.sync||e.sync,afterglow:void 0!==e.afterglow?e.afterglow:0,resetPhysicsOnLoop:void 0===e.resetPhysicsOnLoop||e.resetPhysicsOnLoop},this.enabled={animation:!0,ik:!0,grant:!0,physics:!0,cameraAnimation:!0},this.onBeforePhysics=function(e){},this.sharedPhysics=!1,this.masterPhysics=null}function t(e,t){t=t||{},this.audio=e,this.elapsedTime=0,this.currentTime=0,this.delayTime=void 0!==t.delayTime?t.delayTime:0,this.audioDuration=this.audio.buffer.duration,this.duration=this.audioDuration+this.delayTime}function i(e,t){this.mesh=e,this.grants=t||[]}var r;return e.prototype={constructor:e,add:function(e,t){if(t=t||{},e.isSkinnedMesh)this._addMesh(e,t);else if(e.isCamera)this._setupCamera(e,t);else{if("Audio"!==e.type)throw new Error("MMDAnimationHelper.add: accepts only SkinnedMesh or Camera or Audio instance.");this._setupAudio(e,t)}return this.configuration.sync&&this._syncDuration(),this},remove:function(e){if(e.isSkinnedMesh)this._removeMesh(e);else if(e.isCamera)this._clearCamera(e);else{if("Audio"!==e.type)throw new Error("MMDAnimationHelper.remove: accepts only SkinnedMesh or Camera or Audio instance.");this._clearAudio(e)}return this.configuration.sync&&this._syncDuration(),this},update:function(e){null!==this.audioManager&&this.audioManager.control(e);for(var t=0;t<this.meshes.length;t++)this._animateMesh(this.meshes[t],e);return this.sharedPhysics&&this._updateSharedPhysics(e),null!==this.camera&&this._animateCamera(this.camera,e),this},pose:function(e,t,i){!1!==(i=i||{}).resetPose&&e.pose();for(var r=e.skeleton.bones,n=t.bones,o={},a=0,s=r.length;a<s;a++)o[r[a].name]=a;var l=new Vector3,u=new Quaternion;for(a=0,s=n.length;a<s;a++){var h=n[a],c=o[h.name];if(void 0!==c){var d=r[c];d.position.add(l.fromArray(h.translation)),d.quaternion.multiply(u.fromArray(h.quaternion))}}return e.updateMatrixWorld(!0),!1!==i.ik&&this._createCCDIKSolver(e).update(i.saveOriginalBonesBeforeIK),!1!==i.grant&&this.createGrantSolver(e).update(),this},enable:function(e,t){if(void 0===this.enabled[e])throw new Error("MMDAnimationHelper.enable: unknown key "+e);if(this.enabled[e]=t,"physics"===e)for(var i=0,r=this.meshes.length;i<r;i++)this._optimizeIK(this.meshes[i],t);return this},createGrantSolver:function(e){return new i(e,e.geometry.userData.MMD.grants)},_addMesh:function(e,t){if(this.meshes.indexOf(e)>=0)throw new Error("MMDAnimationHelper._addMesh: SkinnedMesh '"+e.name+"' has already been added.");return this.meshes.push(e),this.objects.set(e,{looped:!1}),this._setupMeshAnimation(e,t.animation),!1!==t.physics&&this._setupMeshPhysics(e,t),this},_setupCamera:function(e,t){if(this.camera===e)throw new Error("MMDAnimationHelper._setupCamera: Camera '"+e.name+"' has already been set.");return this.camera&&this.clearCamera(this.camera),this.camera=e,e.add(this.cameraTarget),this.objects.set(e,{}),void 0!==t.animation&&this._setupCameraAnimation(e,t.animation),this},_setupAudio:function(e,i){if(this.audio===e)throw new Error("MMDAnimationHelper._setupAudio: Audio '"+e.name+"' has already been set.");return this.audio&&this.clearAudio(this.audio),this.audio=e,this.audioManager=new t(e,i),this.objects.set(this.audioManager,{duration:this.audioManager.duration}),this},_removeMesh:function(e){for(var t=!1,i=0,r=0,n=this.meshes.length;r<n;r++)this.meshes[r]!==e?this.meshes[i++]=this.meshes[r]:(this.objects.delete(e),t=!0);if(!t)throw new Error("MMDAnimationHelper._removeMesh: SkinnedMesh '"+e.name+"' has not been added yet.");return this.meshes.length=i,this},_clearCamera:function(e){if(e!==this.camera)throw new Error("MMDAnimationHelper._clearCamera: Camera '"+e.name+"' has not been set yet.");return this.camera.remove(this.cameraTarget),this.objects.delete(this.camera),this.camera=null,this},_clearAudio:function(e){if(e!==this.audio)throw new Error("MMDAnimationHelper._clearAudio: Audio '"+e.name+"' has not been set yet.");return this.objects.delete(this.audioManager),this.audio=null,this.audioManager=null,this},_setupMeshAnimation:function(e,t){var i=this.objects.get(e);if(void 0!==t){var r=Array.isArray(t)?t:[t];i.mixer=new AnimationMixer(e);for(var n=0,o=r.length;n<o;n++)i.mixer.clipAction(r[n]).play();i.mixer.addEventListener("loop",function(e){var t=e.action._clip.tracks;t.length>0&&".bones"!==t[0].name.slice(0,6)||(i.looped=!0)})}return i.ikSolver=this._createCCDIKSolver(e),i.grantSolver=this.createGrantSolver(e),this},_setupCameraAnimation:function(e,t){var i=Array.isArray(t)?t:[t],r=this.objects.get(e);r.mixer=new AnimationMixer(e);for(var n=0,o=i.length;n<o;n++)r.mixer.clipAction(i[n]).play()},_setupMeshPhysics:function(e,t){var i=this.objects.get(e);if(void 0===t.world&&this.sharedPhysics){var r=this._getMasterPhysics();null!==r&&(world=r.world)}i.physics=this._createMMDPhysics(e,t),i.mixer&&!1!==t.animationWarmup&&(this._animateMesh(e,0),i.physics.reset()),i.physics.warmup(void 0!==t.warmup?t.warmup:60),this._optimizeIK(e,!0)},_animateMesh:function(e,t){var i=this.objects.get(e),r=i.mixer,n=i.ikSolver,o=i.grantSolver,a=i.physics,s=i.looped;r&&this.enabled.animation&&(this._restoreBones(e),r.update(t),this._saveBones(e),n&&this.enabled.ik&&(e.updateMatrixWorld(!0),n.update()),o&&this.enabled.grant&&o.update()),!0===s&&this.enabled.physics&&(a&&this.configuration.resetPhysicsOnLoop&&a.reset(),i.looped=!1),a&&this.enabled.physics&&!this.sharedPhysics&&(this.onBeforePhysics(e),a.update(t))},_animateCamera:function(e,t){var i=this.objects.get(e).mixer;i&&this.enabled.cameraAnimation&&(i.update(t),e.updateProjectionMatrix(),e.up.set(0,1,0),e.up.applyQuaternion(e.quaternion),e.lookAt(this.cameraTarget.position))},_optimizeIK:function(e,t){for(var i=e.geometry.userData.MMD.iks,r=e.geometry.userData.MMD.bones,n=0,o=i.length;n<o;n++)for(var a=i[n].links,s=0,l=a.length;s<l;s++){var u=a[s];u.enabled=!0!==t||!(r[u.index].rigidBodyType>0)}},_createCCDIKSolver:function(e){if(void 0===CCDIKSolver)throw new Error("MMDAnimationHelper: Import CCDIKSolver.");return new CCDIKSolver(e,e.geometry.userData.MMD.iks)},_createMMDPhysics:function(e,t){if(void 0===MMDPhysics)throw new Error("MMDPhysics: Import MMDPhysics.");return new MMDPhysics(e,e.geometry.userData.MMD.rigidBodies,e.geometry.userData.MMD.constraints,t)},_syncDuration:function(){for(var e=0,t=this.objects,i=this.meshes,r=this.camera,n=this.audioManager,o=0,a=i.length;o<a;o++){if(void 0!==(u=this.objects.get(i[o]).mixer))for(var s=0;s<u._actions.length;s++){var l=u._actions[s]._clip;t.has(l)||t.set(l,{duration:l.duration}),e=Math.max(e,t.get(l).duration)}}if(null!==r&&void 0!==(u=this.objects.get(r).mixer))for(o=0,a=u._actions.length;o<a;o++){l=u._actions[o]._clip;t.has(l)||t.set(l,{duration:l.duration}),e=Math.max(e,t.get(l).duration)}null!==n&&(e=Math.max(e,t.get(n).duration)),e+=this.configuration.afterglow;for(o=0,a=this.meshes.length;o<a;o++){var u;if(void 0!==(u=this.objects.get(this.meshes[o]).mixer)){s=0;for(var h=u._actions.length;s<h;s++)u._actions[s]._clip.duration=e}}if(null!==r&&void 0!==(u=this.objects.get(r).mixer))for(o=0,a=u._actions.length;o<a;o++)u._actions[o]._clip.duration=e;null!==n&&(n.duration=e)},_updatePropertyMixersBuffer:function(e){for(var t=this.objects.get(e).mixer,i=t._bindings,r=t._accuIndex,n=0,o=i.length;n<o;n++){var a=i[n],s=a.buffer,l=(r+1)*a.valueSize;a.binding.getValue(s,l)}},_saveBones:function(e){var t=this.objects.get(e),i=e.skeleton.bones,r=t.backupBones;void 0===r&&(r=new Float32Array(7*i.length),t.backupBones=r);for(var n=0,o=i.length;n<o;n++){var a=i[n];a.position.toArray(r,7*n),a.quaternion.toArray(r,7*n+3)}},_restoreBones:function(e){var t=this.objects.get(e).backupBones;if(void 0!==t)for(var i=e.skeleton.bones,r=0,n=i.length;r<n;r++){var o=i[r];o.position.fromArray(t,7*r),o.quaternion.fromArray(t,7*r+3)}},_getMasterPhysics:function(){if(null!==this.masterPhysics)return this.masterPhysics;for(var e=0,t=this.meshes.length;e<t;e++){var i=this.meshes[e].physics;if(null!=i)return this.masterPhysics=i,this.masterPhysics}return null},_updateSharedPhysics:function(e){if(0!==this.meshes.length&&this.enabled.physics&&this.sharedPhysics){var t=this._getMasterPhysics();if(null!==t){for(var i=0,r=this.meshes.length;i<r;i++){null!=(n=this.meshes[i].physics)&&n.updateRigidBodies()}t.stepSimulation(e);for(i=0,r=this.meshes.length;i<r;i++){var n;null!=(n=this.meshes[i].physics)&&n.updateBones()}}}}},t.prototype={constructor:t,control:function(e){return this.elapsed+=e,this.currentTime+=e,this._shouldStopAudio()&&this.audio.stop(),this._shouldStartAudio()&&this.audio.play(),this},_shouldStartAudio:function(){if(this.audio.isPlaying)return!1;for(;this.currentTime>=this.duration;)this.currentTime-=this.duration;return!(this.currentTime<this.delayTime)&&(!(this.currentTime-this.delayTime>this.audioDuration)&&(this.audio.startTime=this.currentTime-this.delayTime,!0))},_shouldStopAudio:function(){return this.audio.isPlaying&&this.currentTime>=this.duration}},i.prototype={constructor:i,update:(r=new Quaternion,function(){for(var e=this.mesh.skeleton.bones,t=this.grants,i=0,n=t.length;i<n;i++){var o=t[i],a=e[o.index],s=e[o.parentIndex];o.isLocal?(o.affectPosition,o.affectRotation):(o.affectPosition,o.affectRotation&&(r.set(0,0,0,1),r.slerp(s.quaternion,o.ratio),a.quaternion.multiply(r)))}return this})},e}(),AnimationClipCreator=function(){};function Camera(){Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}function PerspectiveCamera(e,t,i,r){Camera.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function cloneUniforms(e){var t={};for(var i in e)for(var r in t[i]={},e[i]){var n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture)?t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}return t}function mergeUniforms(e){for(var t={},i=0;i<e.length;i++){var r=cloneUniforms(e[i]);for(var n in r)t[n]=r[n]}return t}AnimationClipCreator.CreateRotationAnimation=function(e,t){return new AnimationClip(null,e,[new NumberKeyframeTrack(".rotation["+(t=t||"x")+"]",[0,e],[0,360])])},AnimationClipCreator.CreateScaleAxisAnimation=function(e,t){return new AnimationClip(null,e,[new NumberKeyframeTrack(".scale["+(t=t||"x")+"]",[0,e],[0,1])])},AnimationClipCreator.CreateShakeAnimation=function(e,t){for(var i=[],r=[],n=new Vector3,o=0;o<10*e;o++)i.push(o/10),n.set(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1).multiply(t).toArray(r,r.length);return new AnimationClip(null,e,[new VectorKeyframeTrack(".position",i,r)])},AnimationClipCreator.CreatePulsationAnimation=function(e,t){for(var i=[],r=[],n=new Vector3,o=0;o<10*e;o++){i.push(o/10);var a=Math.random()*t;n.set(a,a,a).toArray(r,r.length)}return new AnimationClip(null,e,[new VectorKeyframeTrack(".scale",i,r)])},AnimationClipCreator.CreateVisibilityAnimation=function(e){return new AnimationClip(null,e,[new BooleanKeyframeTrack(".visible",[0,e/2,e],[!0,!1,!0])])},AnimationClipCreator.CreateMaterialColorAnimation=function(e,t){for(var i=[],r=[],n=e/t.length,o=0;o<=t.length;o++)i.push(o*n),r.push(t[o%t.length]);return new AnimationClip(null,e,[new ColorKeyframeTrack(".material[0].color",i,r)])},Camera.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Camera,isCamera:!0,copy:function(e,t){return Object3D.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("Camera: .getWorldDirection() target is now required"),e=new Vector3),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){Object3D.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),PerspectiveCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:PerspectiveCamera,isPerspectiveCamera:!0,copy:function(e,t){return Camera.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*_Math.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*_Math.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*_Math.RAD2DEG*Math.atan(Math.tan(.5*_Math.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,i,r,n,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*_Math.DEG2RAD*this.fov)/this.zoom,i=2*t,r=this.aspect*i,n=-.5*r,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;n+=o.offsetX*r/a,t-=o.offsetY*i/s,r*=o.width/a,i*=o.height/s}var l=this.filmOffset;0!==l&&(n+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,t,t-i,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});var UniformsUtils={clone:cloneUniforms,merge:mergeUniforms},default_vertex="\nvoid main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",default_fragment="\nvoid main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}\n",_canvas;function ShaderMaterial(e){Material$1.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("ShaderMaterial: attributes should now be defined in BufferGeometry instead."),this.setValues(e))}function Scene(){Object3D.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function OrthographicCamera(e,t,i,r,n,o){Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==i?i:1,this.bottom=void 0!==r?r:-1,this.near=void 0!==n?n:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}ShaderMaterial.prototype=Object.create(Material$1.prototype),ShaderMaterial.prototype.constructor=ShaderMaterial,ShaderMaterial.prototype.isShaderMaterial=!0,ShaderMaterial.prototype.copy=function(e){return Material$1.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=cloneUniforms(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},ShaderMaterial.prototype.toJSON=function(e){var t=Material$1.prototype.toJSON.call(this,e);for(var i in t.uniforms={},this.uniforms){var r=this.uniforms[i].value;r&&r.isTexture?t.uniforms[i]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[i]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[i]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[i]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[i]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[i]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[i]={type:"m4",value:r.toArray()}:t.uniforms[i]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var n={};for(var o in this.extensions)!0===this.extensions[o]&&(n[o]=!0);return Object.keys(n).length>0&&(t.extensions=n),t},Scene.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Scene,isScene:!0,copy:function(e,t){return Object3D.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}}),OrthographicCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:OrthographicCamera,isOrthographicCamera:!0,copy:function(e,t){return Camera.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,i,r,n,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-e,o=i+e,a=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),u=this.zoom/(this.view.height/this.view.fullHeight),h=(this.right-this.left)/this.view.width,c=(this.top-this.bottom)/this.view.height;o=(n+=h*(this.view.offsetX/l))+h*(this.view.width/l),s=(a-=c*(this.view.offsetY/u))-c*(this.view.height/u)}this.projectionMatrix.makeOrthographic(n,o,a,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}});var ImageUtils={getDataURL:function(e){var t;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===_canvas&&(_canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),_canvas.width=e.width,_canvas.height=e.height;var i=_canvas.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=_canvas}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},textureId=0;function Texture(e,t,i,r,n,o,a,s,l,u){Object.defineProperty(this,"id",{value:textureId++}),this.uuid=_Math.generateUUID(),this.name="",this.image=void 0!==e?e:Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Texture.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:ClampToEdgeWrapping,this.wrapT=void 0!==r?r:ClampToEdgeWrapping,this.magFilter=void 0!==n?n:LinearFilter,this.minFilter=void 0!==o?o:LinearMipMapLinearFilter,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:RGBAFormat,this.type=void 0!==s?s:UnsignedByteType,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==u?u:LinearEncoding,this.version=0,this.onUpdate=null}function WebGLRenderTarget(e,t,i){this.width=e,this.height=t,this.scissor=new Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new Vector4(0,0,e,t),i=i||{},this.texture=new Texture(void 0,void 0,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:LinearFilter,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function PlaneGeometry(e,t,i,r){Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r},this.fromBufferGeometry(new PlaneBufferGeometry(e,t,i,r)),this.mergeVertices()}function PlaneBufferGeometry(e,t,i,r){BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};var n,o,a=(e=e||1)/2,s=(t=t||1)/2,l=Math.floor(i)||1,u=Math.floor(r)||1,h=l+1,c=u+1,d=e/l,p=t/u,f=[],m=[],v=[],g=[];for(o=0;o<c;o++){var y=o*p-s;for(n=0;n<h;n++){var _=n*d-a;m.push(_,-y,0),v.push(0,0,1),g.push(n/l),g.push(1-o/u)}}for(o=0;o<u;o++)for(n=0;n<l;n++){var b=n+h*o,x=n+h*(o+1),w=n+1+h*(o+1),S=n+1+h*o;f.push(b,x,S),f.push(x,w,S)}this.setIndex(f),this.addAttribute("position",new Float32BufferAttribute(m,3)),this.addAttribute("normal",new Float32BufferAttribute(v,3)),this.addAttribute("uv",new Float32BufferAttribute(g,2))}Texture.DEFAULT_IMAGE=void 0,Texture.DEFAULT_MAPPING=UVMapping,Texture.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Texture,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=_Math.generateUUID()),!t&&void 0===e.images[r.uuid]){var n;if(Array.isArray(r)){n=[];for(var o=0,a=r.length;o<a;o++)n.push(ImageUtils.getDataURL(r[o]))}else n=ImageUtils.getDataURL(r);e.images[r.uuid]={uuid:r.uuid,url:n}}i.image=r.uuid}return t||(e.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==UVMapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case MirroredRepeatWrapping:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case MirroredRepeatWrapping:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Texture.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),WebGLRenderTarget.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:WebGLRenderTarget,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),PlaneGeometry.prototype=Object.create(Geometry.prototype),PlaneGeometry.prototype.constructor=PlaneGeometry,PlaneBufferGeometry.prototype=Object.create(BufferGeometry.prototype),PlaneBufferGeometry.prototype.constructor=PlaneBufferGeometry;var BokehShader={defines:{DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},aspect:{value:1},aperture:{value:.025},maxblur:{value:1},nearClip:{value:1},farClip:{value:1e3}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float maxblur;","uniform float aperture;","uniform float nearClip;","uniform float farClip;","uniform float focus;","uniform float aspect;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, nearClip, farClip );","\t#else","\treturn orthographicDepthToViewZ( depth, nearClip, farClip );","\t#endif","}","void main() {","vec2 aspectcorrect = vec2( 1.0, aspect );","float viewZ = getViewZ( getDepth( vUv ) );","float factor = ( focus + viewZ );","vec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );","vec2 dofblur9 = dofblur * 0.9;","vec2 dofblur7 = dofblur * 0.7;","vec2 dofblur4 = dofblur * 0.4;","vec4 col = vec4( 0.0 );","col += texture2D( tColor, vUv.xy );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );","gl_FragColor = col / 41.0;","gl_FragColor.a = 1.0;","}"].join("\n")},BokehShader2={uniforms:{textureWidth:{value:1},textureHeight:{value:1},focalDepth:{value:1},focalLength:{value:24},fstop:{value:.9},tColor:{value:null},tDepth:{value:null},maxblur:{value:1},showFocus:{value:0},manualdof:{value:0},vignetting:{value:0},depthblur:{value:0},threshold:{value:.5},gain:{value:2},bias:{value:.5},fringe:{value:.7},znear:{value:.1},zfar:{value:100},noise:{value:1},dithering:{value:1e-4},pentagon:{value:0},shaderFocus:{value:1},focusCoords:{value:new Vector2}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float textureWidth;","uniform float textureHeight;","uniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below","uniform float focalLength; //focal length in mm","uniform float fstop; //f-stop value","uniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)","","uniform float znear; // camera clipping start","uniform float zfar; // camera clipping end","//------------------------------------------","//user variables","const int samples = SAMPLES; //samples on the first ring","const int rings = RINGS; //ring count","const int maxringsamples = rings * samples;","uniform bool manualdof; // manual dof calculation","float ndofstart = 1.0; // near dof blur start","float ndofdist = 2.0; // near dof blur falloff distance","float fdofstart = 1.0; // far dof blur start","float fdofdist = 3.0; // far dof blur falloff distance","float CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)","uniform bool vignetting; // use optical lens vignetting","float vignout = 1.3; // vignetting outer border","float vignin = 0.0; // vignetting inner border","float vignfade = 22.0; // f-stops till vignete fades","uniform bool shaderFocus;","// disable if you use external focalDepth value","uniform vec2 focusCoords;","// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)","// if center of screen use vec2(0.5, 0.5);","uniform float maxblur;","//clamp value of max blur (0.0 = no blur, 1.0 default)","uniform float threshold; // highlight threshold;","uniform float gain; // highlight gain;","uniform float bias; // bokeh edge bias","uniform float fringe; // bokeh chromatic aberration / fringing","uniform bool noise; //use noise instead of pattern for sample dithering","uniform float dithering;","uniform bool depthblur; // blur the depth buffer","float dbsize = 1.25; // depth blur size","","uniform bool pentagon; //use pentagon as bokeh shape?","float feather = 0.4; //pentagon shape feather","//------------------------------------------","float penta(vec2 coords) {","//pentagonal shape","float scale = float(rings) - 1.3;","vec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);","vec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);","vec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);","vec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);","vec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);","vec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);","vec4  one = vec4( 1.0 );","vec4 P = vec4((coords),vec2(scale, scale));","vec4 dist = vec4(0.0);","float inorout = -4.0;","dist.x = dot( P, HS0 );","dist.y = dot( P, HS1 );","dist.z = dot( P, HS2 );","dist.w = dot( P, HS3 );","dist = smoothstep( -feather, feather, dist );","inorout += dot( dist, one );","dist.x = dot( P, HS4 );","dist.y = HS5.w - abs( P.z );","dist = smoothstep( -feather, feather, dist );","inorout += dist.x;","return clamp( inorout, 0.0, 1.0 );","}","float bdepth(vec2 coords) {","// Depth buffer blur","float d = 0.0;","float kernel[9];","vec2 offset[9];","vec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;","offset[0] = vec2(-wh.x,-wh.y);","offset[1] = vec2( 0.0, -wh.y);","offset[2] = vec2( wh.x -wh.y);","offset[3] = vec2(-wh.x,  0.0);","offset[4] = vec2( 0.0,   0.0);","offset[5] = vec2( wh.x,  0.0);","offset[6] = vec2(-wh.x, wh.y);","offset[7] = vec2( 0.0,  wh.y);","offset[8] = vec2( wh.x, wh.y);","kernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;","kernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;","kernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;","for( int i=0; i<9; i++ ) {","float tmp = texture2D(tDepth, coords + offset[i]).r;","d += tmp * kernel[i];","}","return d;","}","vec3 color(vec2 coords,float blur) {","//processing the sample","vec3 col = vec3(0.0);","vec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);","col.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;","col.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;","col.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;","vec3 lumcoeff = vec3(0.299,0.587,0.114);","float lum = dot(col.rgb, lumcoeff);","float thresh = max((lum-threshold)*gain, 0.0);","return col+mix(vec3(0.0),col,thresh*blur);","}","vec3 debugFocus(vec3 col, float blur, float depth) {","float edge = 0.002*depth; //distance based edge smoothing","float m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);","float e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);","col = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);","col = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);","return col;","}","float linearize(float depth) {","return -zfar * znear / (depth * (zfar - znear) - zfar);","}","float vignette() {","float dist = distance(vUv.xy, vec2(0.5,0.5));","dist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);","return clamp(dist,0.0,1.0);","}","float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {","float rings2 = float(rings);","float step = PI*2.0 / float(ringsamples);","float pw = cos(j*step)*i;","float ph = sin(j*step)*i;","float p = 1.0;","if (pentagon) {","p = penta(vec2(pw,ph));","}","col += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;","return 1.0 * mix(1.0, i /rings2, bias) * p;","}","void main() {","//scene depth calculation","float depth = linearize(texture2D(tDepth,vUv.xy).x);","// Blur depth?","if ( depthblur ) {","depth = linearize(bdepth(vUv.xy));","}","//focal plane calculation","float fDepth = focalDepth;","if (shaderFocus) {","fDepth = linearize(texture2D(tDepth,focusCoords).x);","}","// dof blur factor calculation","float blur = 0.0;","if (manualdof) {","float a = depth-fDepth; // Focal plane","float b = (a-fdofstart)/fdofdist; // Far DoF","float c = (-a-ndofstart)/ndofdist; // Near Dof","blur = (a>0.0) ? b : c;","} else {","float f = focalLength; // focal length in mm","float d = fDepth*1000.0; // focal plane in mm","float o = depth*1000.0; // depth in mm","float a = (o*f)/(o-f);","float b = (d*f)/(d-f);","float c = (d-f)/(d*fstop*CoC);","blur = abs(a-b)*c;","}","blur = clamp(blur,0.0,1.0);","// calculation of pattern for dithering","vec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;","// getting blur x and y step factor","float w = (1.0/textureWidth)*blur*maxblur+noise.x;","float h = (1.0/textureHeight)*blur*maxblur+noise.y;","// calculation of final color","vec3 col = vec3(0.0);","if(blur < 0.05) {","//some optimization thingy","col = texture2D(tColor, vUv.xy).rgb;","} else {","col = texture2D(tColor, vUv.xy).rgb;","float s = 1.0;","int ringsamples;","for (int i = 1; i <= rings; i++) {","","ringsamples = i * samples;","for (int j = 0 ; j < maxringsamples ; j++) {","if (j >= ringsamples) break;","s += gather(float(i), float(j), ringsamples, col, w, h, blur);","}","","}","col /= s; //divide by sample count","}","if (showFocus) {","col = debugFocus(col, blur, depth);","}","if (vignetting) {","col *= vignette();","}","gl_FragColor.rgb = col;","gl_FragColor.a = 1.0;","} "].join("\n")},BokehDepthShader={uniforms:{mNear:{value:1},mFar:{value:1e3}},vertexShader:["varying float vViewZDepth;","void main() {","\t#include <begin_vertex>","\t#include <project_vertex>","\tvViewZDepth = - mvPosition.z;","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","varying float vViewZDepth;","void main() {","\tfloat color = 1.0 - smoothstep( mNear, mFar, vViewZDepth );","\tgl_FragColor = vec4( vec3( color ), 1.0 );","} "].join("\n")},CinematicCamera=function(e,t,i,r){PerspectiveCamera.call(this,e,t,i,r),this.type="CinematicCamera",this.postprocessing={enabled:!0},this.shaderSettings={rings:3,samples:4};var n=BokehDepthShader;this.materialDepth=new ShaderMaterial({uniforms:n.uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}),this.materialDepth.uniforms.mNear.value=i,this.materialDepth.uniforms.mFar.value=r,this.setLens(),this.initPostProcessing()};function Group(){Object3D.call(this),this.type="Group"}CinematicCamera.prototype=Object.create(PerspectiveCamera.prototype),CinematicCamera.prototype.constructor=CinematicCamera,CinematicCamera.prototype.setLens=function(e,t,i,r){void 0===e&&(e=35),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e),void 0===i&&(i=8),void 0===r&&(r=.019),this.fNumber=i,this.coc=r,this.aperture=e/this.fNumber,this.hyperFocal=e*e/(this.aperture*this.coc)},CinematicCamera.prototype.linearize=function(e){var t=this.far,i=this.near;return-t*i/(e*(t-i)-t)},CinematicCamera.prototype.smoothstep=function(e,t,i){var r=this.saturate((i-e)/(t-e));return r*r*(3-2*r)},CinematicCamera.prototype.saturate=function(e){return Math.max(0,Math.min(1,e))},CinematicCamera.prototype.focusAt=function(e){void 0===e&&(e=20);var t=this.getFocalLength();this.focus=e,this.nearPoint=this.hyperFocal*this.focus/(this.hyperFocal+(this.focus-t)),this.farPoint=this.hyperFocal*this.focus/(this.hyperFocal-(this.focus-t)),this.depthOfField=this.farPoint-this.nearPoint,this.depthOfField<0&&(this.depthOfField=0),this.sdistance=this.smoothstep(this.near,this.far,this.focus),this.ldistance=this.linearize(1-this.sdistance),this.postprocessing.bokeh_uniforms.focalDepth.value=this.ldistance},CinematicCamera.prototype.initPostProcessing=function(){if(this.postprocessing.enabled){this.postprocessing.scene=new Scene,this.postprocessing.camera=new OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1e4,1e4),this.postprocessing.scene.add(this.postprocessing.camera);var e={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat};this.postprocessing.rtTextureDepth=new WebGLRenderTarget(window.innerWidth,window.innerHeight,e),this.postprocessing.rtTextureColor=new WebGLRenderTarget(window.innerWidth,window.innerHeight,e);var t=BokehShader;this.postprocessing.bokeh_uniforms=UniformsUtils.clone(t.uniforms),this.postprocessing.bokeh_uniforms.tColor.value=this.postprocessing.rtTextureColor.texture,this.postprocessing.bokeh_uniforms.tDepth.value=this.postprocessing.rtTextureDepth.texture,this.postprocessing.bokeh_uniforms.manualdof.value=0,this.postprocessing.bokeh_uniforms.shaderFocus.value=0,this.postprocessing.bokeh_uniforms.fstop.value=2.8,this.postprocessing.bokeh_uniforms.showFocus.value=1,this.postprocessing.bokeh_uniforms.focalDepth.value=.1,this.postprocessing.bokeh_uniforms.znear.value=this.near,this.postprocessing.bokeh_uniforms.zfar.value=this.near,this.postprocessing.bokeh_uniforms.textureWidth.value=window.innerWidth,this.postprocessing.bokeh_uniforms.textureHeight.value=window.innerHeight,this.postprocessing.materialBokeh=new ShaderMaterial({uniforms:this.postprocessing.bokeh_uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,defines:{RINGS:this.shaderSettings.rings,SAMPLES:this.shaderSettings.samples,DEPTH_PACKING:1}}),this.postprocessing.quad=new Mesh(new PlaneBufferGeometry(window.innerWidth,window.innerHeight),this.postprocessing.materialBokeh),this.postprocessing.quad.position.z=-500,this.postprocessing.scene.add(this.postprocessing.quad)}},CinematicCamera.prototype.renderCinematic=function(e,t){if(this.postprocessing.enabled){var i=t.getRenderTarget();t.clear(),e.overrideMaterial=null,t.setRenderTarget(this.postprocessing.rtTextureColor),t.clear(),t.render(e,camera),e.overrideMaterial=this.materialDepth,t.setRenderTarget(this.postprocessing.rtTextureDepth),t.clear(),t.render(e,camera),t.setRenderTarget(null),t.render(this.postprocessing.scene,this.postprocessing.camera),t.setRenderTarget(i)}},Group.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Group,isGroup:!0});var Car=function(){var e,t,i,r=0,n={LEFT:37,UP:38,RIGHT:39,DOWN:40,BRAKE:32},o=0,a=0,s=null,l=null,u=null,h=new Group,c=new Group,d=null,p=null,f=null,m=1,v=1,g=!1,y={brake:!1,moveForward:!1,moveBackward:!1,moveLeft:!1,moveRight:!1};function _(r,o,a,s,l){this.enabled=!0,this.elemNames={flWheel:"wheel_fl",frWheel:"wheel_fr",rlWheel:"wheel_rl",rrWheel:"wheel_rr",steeringWheel:"steering_wheel"},this.maxSpeed=r||180,e=.25*-this.maxSpeed,this.acceleration=o||10,t=.5*this.acceleration,this.turningRadius=s||6,i=2*this.acceleration,this.brakePower=a||10,this.speed=0,n=l||n,this.wheelRotationAxis="x",this.wheelTurnAxis="z",this.steeringWheelTurnAxis="y",document.addEventListener("keydown",this.onKeyDown,!1),document.addEventListener("keyup",this.onKeyUp,!1)}function b(e){return 1===e?1:1-Math.pow(2,-10*e)}return _.prototype={constructor:_,onKeyDown:function(e){switch(e.keyCode){case n.BRAKE:y.brake=!0,y.moveForward=!1,y.moveBackward=!1;break;case n.UP:y.moveForward=!0;break;case n.DOWN:y.moveBackward=!0;break;case n.LEFT:y.moveLeft=!0;break;case n.RIGHT:y.moveRight=!0}},onKeyUp:function(e){switch(e.keyCode){case n.BRAKE:y.brake=!1;break;case n.UP:y.moveForward=!1;break;case n.DOWN:y.moveBackward=!1;break;case n.LEFT:y.moveLeft=!1;break;case n.RIGHT:y.moveRight=!1}},dispose:function(){document.removeEventListener("keydown",this.onKeyDown,!1),document.removeEventListener("keyup",this.onKeyUp,!1)},update:function(n){if(g&&this.enabled){var _=1;if(y.brake&&(_=this.brakePower),y.moveForward&&(this.speed=_Math.clamp(this.speed+n*this.acceleration,e,this.maxSpeed),r=_Math.clamp(r+n,-1,1)),y.moveBackward&&(this.speed=_Math.clamp(this.speed-n*t,e,this.maxSpeed),r=_Math.clamp(r-n,-1,1)),y.moveLeft&&(o=_Math.clamp(o+1.5*n,-.6,.6)),y.moveRight&&(o=_Math.clamp(o-1.5*n,-.6,.6)),!y.moveForward&&!y.moveBackward)if(this.speed>0){var x=b(this.speed/this.maxSpeed);this.speed=_Math.clamp(this.speed-x*n*i*_,0,this.maxSpeed),r=_Math.clamp(r-x*n,0,1)}else{x=b(this.speed/e);this.speed=_Math.clamp(this.speed+x*n*t*_,e,0),r=_Math.clamp(r+x*n,-1,0)}y.moveLeft||y.moveRight||(o=o>0?_Math.clamp(o-1.5*n,0,.6):_Math.clamp(o+1.5*n,-.6,0));var w=-this.speed*n;a-=w*this.turningRadius*.02*o,s.position.x+=Math.sin(a)*w*v,s.position.z+=Math.cos(a)*w*v,s.rotation.y=a;var S=w*(-2/m)*v;h.rotation[this.wheelRotationAxis]-=S,c.rotation[this.wheelRotationAxis]-=S,d.rotation[this.wheelRotationAxis]-=S,p.rotation[this.wheelRotationAxis]-=S,l.rotation[this.wheelTurnAxis]=o,u.rotation[this.wheelTurnAxis]=o,f.rotation[this.steeringWheelTurnAxis]=6*-o}},setModel:function(e,t){t&&(this.elemNames=t),s=e,this.setupWheels(),this.computeDimensions(),g=!0},setupWheels:function(){for(l=s.getObjectByName(this.elemNames.flWheel),u=s.getObjectByName(this.elemNames.frWheel),d=s.getObjectByName(this.elemNames.rlWheel),p=s.getObjectByName(this.elemNames.rrWheel),null!==this.elemNames.steeringWheel&&(f=s.getObjectByName(this.elemNames.steeringWheel));l.children.length>0;)h.add(l.children[0]);for(;u.children.length>0;)c.add(u.children[0]);l.add(h),u.add(c)},computeDimensions:function(){var e=(new Box3).setFromObject(l),t=new Vector3;e.getSize(t),m=Math.max(t.x,t.y,t.z),e.setFromObject(s),t=e.getSize(t),v=Math.max(t.x,t.y,t.z)}},_}(),DeviceOrientationControls=function(e){var t=this;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var i,r,n,o,a=function(e){t.deviceOrientation=e},s=function(){t.screenOrientation=window.orientation||0},l=(i=new Vector3(0,0,1),r=new Euler,n=new Quaternion,o=new Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(e,t,a,s,l){r.set(a,t,-s,"YXZ"),e.setFromEuler(r),e.multiply(o),e.multiply(n.setFromAxisAngle(i,-l))});this.connect=function(){s(),window.addEventListener("orientationchange",s,!1),window.addEventListener("deviceorientation",a,!1),t.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",s,!1),window.removeEventListener("deviceorientation",a,!1),t.enabled=!1},this.update=function(){if(!1!==t.enabled){var e=t.deviceOrientation;if(e){var i=e.alpha?_Math.degToRad(e.alpha)+t.alphaOffset:0,r=e.beta?_Math.degToRad(e.beta):0,n=e.gamma?_Math.degToRad(e.gamma):0,o=t.screenOrientation?_Math.degToRad(t.screenOrientation):0;l(t.object.quaternion,i,r,n,o)}}},this.dispose=function(){t.disconnect()},this.connect()};function Plane(e,t){this.normal=void 0!==e?e:new Vector3(1,0,0),this.constant=void 0!==t?t:0}function Raycaster(e,t,i,r){this.ray=new Ray(e,t),this.near=i||0,this.far=r||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ascSort(e,t){return e.distance-t.distance}function intersectObject(e,t,i,r){if(!1!==e.visible&&(e.raycast(t,i),!0===r))for(var n=e.children,o=0,a=n.length;o<a;o++)intersectObject(n[o],t,i,!0)}Object.assign(Plane.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new Vector3,t=new Vector3;return function(i,r,n){var o=e.subVectors(n,r).cross(t.subVectors(i,r)).normalize();return this.setFromNormalAndCoplanarPoint(o,i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("Plane: .projectPoint() target is now required"),t=new Vector3),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new Vector3;return function(t,i){void 0===i&&(console.warn("Plane: .intersectLine() target is now required"),i=new Vector3);var r=t.delta(e),n=this.normal.dot(r);if(0===n)return 0===this.distanceToPoint(t.start)?i.copy(t.start):void 0;var o=-(t.start.dot(this.normal)+this.constant)/n;return o<0||o>1?void 0:i.copy(r).multiplyScalar(o).add(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("Plane: .coplanarPoint() target is now required"),e=new Vector3),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new Vector3,t=new Matrix3;return function(i,r){var n=r||t.getNormalMatrix(i),o=this.coplanarPoint(e).applyMatrix4(i),a=this.normal.applyMatrix3(n).normalize();return this.constant=-o.dot(a),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(Raycaster.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("Raycaster: Unsupported camera type.")},intersectObject:function(e,t,i){var r=i||[];return intersectObject(e,this,r,t),r.sort(ascSort),r},intersectObjects:function(e,t,i){var r=i||[];if(!1===Array.isArray(e))return console.warn("Raycaster.intersectObjects: objects is not an Array."),r;for(var n=0,o=e.length;n<o;n++)intersectObject(e[n],this,r,t);return r.sort(ascSort),r}});var DragControls=function(e,t,i){if(e instanceof Camera){console.warn("DragControls: Constructor now expects ( objects, camera, domElement )");var r=e;e=t,t=r}var n=new Plane,o=new Raycaster,a=new Vector2,s=new Vector3,l=new Vector3,u=new Vector3,h=new Matrix4,c=null,d=null,p=this;function f(){i.addEventListener("mousemove",v,!1),i.addEventListener("mousedown",g,!1),i.addEventListener("mouseup",y,!1),i.addEventListener("mouseleave",y,!1),i.addEventListener("touchmove",_,!1),i.addEventListener("touchstart",b,!1),i.addEventListener("touchend",x,!1)}function m(){i.removeEventListener("mousemove",v,!1),i.removeEventListener("mousedown",g,!1),i.removeEventListener("mouseup",y,!1),i.removeEventListener("mouseleave",y,!1),i.removeEventListener("touchmove",_,!1),i.removeEventListener("touchstart",b,!1),i.removeEventListener("touchend",x,!1)}function v(r){r.preventDefault();var f=i.getBoundingClientRect();if(a.x=(r.clientX-f.left)/f.width*2-1,a.y=-(r.clientY-f.top)/f.height*2+1,o.setFromCamera(a,t),c&&p.enabled)return o.ray.intersectPlane(n,l)&&c.position.copy(l.sub(s).applyMatrix4(h)),void p.dispatchEvent({type:"drag",object:c});o.setFromCamera(a,t);var m=o.intersectObjects(e);if(m.length>0){var v=m[0].object;n.setFromNormalAndCoplanarPoint(t.getWorldDirection(n.normal),u.setFromMatrixPosition(v.matrixWorld)),d!==v&&(p.dispatchEvent({type:"hoveron",object:v}),i.style.cursor="pointer",d=v)}else null!==d&&(p.dispatchEvent({type:"hoveroff",object:d}),i.style.cursor="auto",d=null)}function g(r){r.preventDefault(),o.setFromCamera(a,t);var d=o.intersectObjects(e);d.length>0&&(c=d[0].object,o.ray.intersectPlane(n,l)&&(h.getInverse(c.parent.matrixWorld),s.copy(l).sub(u.setFromMatrixPosition(c.matrixWorld))),i.style.cursor="move",p.dispatchEvent({type:"dragstart",object:c}))}function y(e){e.preventDefault(),c&&(p.dispatchEvent({type:"dragend",object:c}),c=null),i.style.cursor=d?"pointer":"auto"}function _(e){e.preventDefault(),e=e.changedTouches[0];var r=i.getBoundingClientRect();if(a.x=(e.clientX-r.left)/r.width*2-1,a.y=-(e.clientY-r.top)/r.height*2+1,o.setFromCamera(a,t),c&&p.enabled)return o.ray.intersectPlane(n,l)&&c.position.copy(l.sub(s).applyMatrix4(h)),void p.dispatchEvent({type:"drag",object:c})}function b(r){r.preventDefault(),r=r.changedTouches[0];var d=i.getBoundingClientRect();a.x=(r.clientX-d.left)/d.width*2-1,a.y=-(r.clientY-d.top)/d.height*2+1,o.setFromCamera(a,t);var f=o.intersectObjects(e);f.length>0&&(c=f[0].object,n.setFromNormalAndCoplanarPoint(t.getWorldDirection(n.normal),u.setFromMatrixPosition(c.matrixWorld)),o.ray.intersectPlane(n,l)&&(h.getInverse(c.parent.matrixWorld),s.copy(l).sub(u.setFromMatrixPosition(c.matrixWorld))),i.style.cursor="move",p.dispatchEvent({type:"dragstart",object:c}))}function x(e){e.preventDefault(),c&&(p.dispatchEvent({type:"dragend",object:c}),c=null),i.style.cursor="auto"}f(),this.enabled=!0,this.activate=f,this.deactivate=m,this.dispose=function(){m()},this.setObjects=function(){console.error("DragControls: setObjects() has been removed.")},this.on=function(e,t){console.warn("DragControls: on() has been deprecated. Use addEventListener() instead."),p.addEventListener(e,t)},this.off=function(e,t){console.warn("DragControls: off() has been deprecated. Use removeEventListener() instead."),p.removeEventListener(e,t)},this.notify=function(e){console.error("DragControls: notify() has been deprecated. Use dispatchEvent() instead."),p.dispatchEvent({type:e})}};function Spherical(e,t,i){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==i?i:0,this}DragControls.prototype=Object.create(EventDispatcher.prototype),DragControls.prototype.constructor=DragControls,Object.assign(Spherical.prototype,{set:function(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(_Math.clamp(t/this.radius,-1,1))),this}});var EditorControls=function(e,t){t=void 0!==t?t:document,this.enabled=!0,this.center=new Vector3,this.panSpeed=.001,this.zoomSpeed=.1,this.rotationSpeed=.005;var i=this,r=new Vector3,n=new Vector3,o=new Box3,a={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},s=a.NONE,l=this.center,u=new Matrix3,h=new Vector2,c=new Vector2,d=new Spherical,p=new Sphere,f={type:"change"};function m(e){!1!==i.enabled&&(0===e.button?s=a.ROTATE:1===e.button?s=a.ZOOM:2===e.button&&(s=a.PAN),c.set(e.clientX,e.clientY),t.addEventListener("mousemove",v,!1),t.addEventListener("mouseup",g,!1),t.addEventListener("mouseout",g,!1),t.addEventListener("dblclick",g,!1))}function v(e){if(!1!==i.enabled){h.set(e.clientX,e.clientY);var t=h.x-c.x,r=h.y-c.y;s===a.ROTATE?i.rotate(n.set(-t*i.rotationSpeed,-r*i.rotationSpeed,0)):s===a.ZOOM?i.zoom(n.set(0,0,r)):s===a.PAN&&i.pan(n.set(-t,r,0)),c.set(e.clientX,e.clientY)}}function g(e){t.removeEventListener("mousemove",v,!1),t.removeEventListener("mouseup",g,!1),t.removeEventListener("mouseout",g,!1),t.removeEventListener("dblclick",g,!1),s=a.NONE}function y(e){e.preventDefault(),i.zoom(n.set(0,0,e.deltaY>0?1:-1))}function _(e){e.preventDefault()}this.focus=function(t){var r;o.setFromObject(t),!1===o.isEmpty()?(o.getCenter(l),r=o.getBoundingSphere(p).radius):(l.setFromMatrixPosition(t.matrixWorld),r=.1),n.set(0,0,1),n.applyQuaternion(e.quaternion),n.multiplyScalar(4*r),e.position.copy(l).add(n),i.dispatchEvent(f)},this.pan=function(t){var r=e.position.distanceTo(l);t.multiplyScalar(r*i.panSpeed),t.applyMatrix3(u.getNormalMatrix(e.matrix)),e.position.add(t),l.add(t),i.dispatchEvent(f)},this.zoom=function(t){var r=e.position.distanceTo(l);t.multiplyScalar(r*i.zoomSpeed),t.length()>r||(t.applyMatrix3(u.getNormalMatrix(e.matrix)),e.position.add(t),i.dispatchEvent(f))},this.rotate=function(t){r.copy(e.position).sub(l),d.setFromVector3(r),d.theta+=t.x,d.phi+=t.y,d.makeSafe(),r.setFromSpherical(d),e.position.copy(l).add(r),e.lookAt(l),i.dispatchEvent(f)},this.dispose=function(){t.removeEventListener("contextmenu",_,!1),t.removeEventListener("mousedown",m,!1),t.removeEventListener("wheel",y,!1),t.removeEventListener("mousemove",v,!1),t.removeEventListener("mouseup",g,!1),t.removeEventListener("mouseout",g,!1),t.removeEventListener("dblclick",g,!1),t.removeEventListener("touchstart",S,!1),t.removeEventListener("touchmove",M,!1)},t.addEventListener("contextmenu",_,!1),t.addEventListener("mousedown",m,!1),t.addEventListener("wheel",y,!1);var b=[new Vector3,new Vector3,new Vector3],x=[new Vector3,new Vector3,new Vector3],w=null;function S(e){if(!1!==i.enabled){switch(e.touches.length){case 1:b[0].set(e.touches[0].pageX,e.touches[0].pageY,0),b[1].set(e.touches[0].pageX,e.touches[0].pageY,0);break;case 2:b[0].set(e.touches[0].pageX,e.touches[0].pageY,0),b[1].set(e.touches[1].pageX,e.touches[1].pageY,0),w=b[0].distanceTo(b[1])}x[0].copy(b[0]),x[1].copy(b[1])}}function M(e){if(!1!==i.enabled){switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:b[0].set(e.touches[0].pageX,e.touches[0].pageY,0),b[1].set(e.touches[0].pageX,e.touches[0].pageY,0),i.rotate(b[0].sub(a(b[0],x)).multiplyScalar(-i.rotationSpeed));break;case 2:b[0].set(e.touches[0].pageX,e.touches[0].pageY,0),b[1].set(e.touches[1].pageX,e.touches[1].pageY,0);var t=b[0].distanceTo(b[1]);i.zoom(n.set(0,0,w-t)),w=t;var r=b[0].clone().sub(a(b[0],x)),o=b[1].clone().sub(a(b[1],x));r.x=-r.x,o.x=-o.x,i.pan(r.add(o).multiplyScalar(.5))}x[0].copy(b[0]),x[1].copy(b[1])}function a(e,t){var i=t[0];for(var r in t)i.distanceTo(e)>t[r].distanceTo(e)&&(i=t[r]);return i}}t.addEventListener("touchstart",S,!1),t.addEventListener("touchmove",M,!1)};EditorControls.prototype=Object.create(EventDispatcher.prototype),EditorControls.prototype.constructor=EditorControls;var FirstPersonControls=function(e,t){this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0;var i,r=0,n=0,o=new Vector3,a=new Spherical,s=new Vector3;function l(e){e.preventDefault()}this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.lookAt=function(e,t,i){return e.isVector3?s.copy(e):s.set(e,t,i),this.object.lookAt(s),m(this),this},this.update=(i=new Vector3,function(e){if(!1!==this.enabled){if(this.heightSpeed){var t=_Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(t*this.heightCoef)}else this.autoSpeedFactor=0;var o=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(o+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(o),this.moveLeft&&this.object.translateX(-o),this.moveRight&&this.object.translateX(o),this.moveUp&&this.object.translateY(o),this.moveDown&&this.object.translateY(-o);var a=e*this.lookSpeed;this.activeLook||(a=0);var s=1;this.constrainVertical&&(s=Math.PI/(this.verticalMax-this.verticalMin)),n-=this.mouseX*a,this.lookVertical&&(r-=this.mouseY*a*s),r=Math.max(-85,Math.min(85,r));var l=_Math.degToRad(90-r),u=_Math.degToRad(n);this.constrainVertical&&(l=_Math.mapLinear(l,0,Math.PI,this.verticalMin,this.verticalMax));var h=this.object.position;i.setFromSphericalCoords(1,l,u).add(h),this.object.lookAt(i)}}),this.dispose=function(){this.domElement.removeEventListener("contextmenu",l,!1),this.domElement.removeEventListener("mousedown",h,!1),this.domElement.removeEventListener("mousemove",u,!1),this.domElement.removeEventListener("mouseup",c,!1),window.removeEventListener("keydown",d,!1),window.removeEventListener("keyup",p,!1)};var u=f(this,this.onMouseMove),h=f(this,this.onMouseDown),c=f(this,this.onMouseUp),d=f(this,this.onKeyDown),p=f(this,this.onKeyUp);function f(e,t){return function(){t.apply(e,arguments)}}function m(e){var t=e.object.quaternion;o.set(0,0,-1).applyQuaternion(t),a.setFromVector3(o),r=90-_Math.radToDeg(a.phi),n=_Math.radToDeg(a.theta)}this.domElement.addEventListener("contextmenu",l,!1),this.domElement.addEventListener("mousemove",u,!1),this.domElement.addEventListener("mousedown",h,!1),this.domElement.addEventListener("mouseup",c,!1),window.addEventListener("keydown",d,!1),window.addEventListener("keyup",p,!1),this.handleResize(),m(this)},FlyControls=function(e,t){function i(e,t){return function(){t.apply(e,arguments)}}function r(e){e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,t&&this.domElement.setAttribute("tabindex",-1),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this.tmpQuaternion=new Quaternion,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new Vector3(0,0,0),this.rotationVector=new Vector3(0,0,0),this.keydown=function(e){if(!e.altKey){switch(e.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.dragToLook)this.mouseStatus++;else{switch(e.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1}this.updateMovementVector()}},this.mousemove=function(e){if(!this.dragToLook||this.mouseStatus>0){var t=this.getContainerDimensions(),i=t.size[0]/2,r=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-i)/i,this.moveState.pitchDown=(e.pageY-t.offset[1]-r)/r,this.updateRotationVector()}},this.mouseup=function(e){if(e.preventDefault(),e.stopPropagation(),this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(e.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0}this.updateMovementVector()}this.updateRotationVector()},this.update=function(e){var t=e*this.movementSpeed,i=e*this.rollSpeed;this.object.translateX(this.moveVector.x*t),this.object.translateY(this.moveVector.y*t),this.object.translateZ(this.moveVector.z*t),this.tmpQuaternion.set(this.rotationVector.x*i,this.rotationVector.y*i,this.rotationVector.z*i,1).normalize(),this.object.quaternion.multiply(this.tmpQuaternion),this.object.rotation.setFromQuaternion(this.object.quaternion,this.object.rotation.order)},this.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",r,!1),this.domElement.removeEventListener("mousedown",o,!1),this.domElement.removeEventListener("mousemove",n,!1),this.domElement.removeEventListener("mouseup",a,!1),window.removeEventListener("keydown",s,!1),window.removeEventListener("keyup",l,!1)};var n=i(this,this.mousemove),o=i(this,this.mousedown),a=i(this,this.mouseup),s=i(this,this.keydown),l=i(this,this.keyup);this.domElement.addEventListener("contextmenu",r,!1),this.domElement.addEventListener("mousemove",n,!1),this.domElement.addEventListener("mousedown",o,!1),this.domElement.addEventListener("mouseup",a,!1),window.addEventListener("keydown",s,!1),window.addEventListener("keyup",l,!1),this.updateMovementVector(),this.updateRotationVector()},MapControls=function(e,t){var i,r,n,o,a;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:MOUSE.LEFT,MIDDLE:MOUSE.MIDDLE,RIGHT:MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(l),s.update(),d=c.NONE},this.update=(i=new Vector3,r=(new Quaternion).setFromUnitVectors(e.up,new Vector3(0,1,0)),n=r.clone().inverse(),o=new Vector3,a=new Quaternion,function(){var e=s.object.position;return i.copy(e).sub(s.target),i.applyQuaternion(r),f.setFromVector3(i),s.autoRotate&&d===c.NONE&&O(2*Math.PI/60/60*s.autoRotateSpeed),f.theta+=m.theta,f.phi+=m.phi,f.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,f.theta)),f.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=v,f.radius=Math.max(s.minDistance,Math.min(s.maxDistance,f.radius)),s.target.add(g),i.setFromSpherical(f),i.applyQuaternion(n),e.copy(s.target).add(i),s.object.lookAt(s.target),!0===s.enableDamping?(m.theta*=1-s.dampingFactor,m.phi*=1-s.dampingFactor,g.multiplyScalar(1-s.dampingFactor)):(m.set(0,0,0),g.set(0,0,0)),v=1,!!(y||o.distanceToSquared(s.object.position)>p||8*(1-a.dot(s.object.quaternion))>p)&&(s.dispatchEvent(l),o.copy(s.object.position),a.copy(s.object.quaternion),y=!1,!0)}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",te,!1),s.domElement.removeEventListener("mousedown",Y,!1),s.domElement.removeEventListener("wheel",Q,!1),s.domElement.removeEventListener("touchstart",J,!1),s.domElement.removeEventListener("touchend",ee,!1),s.domElement.removeEventListener("touchmove",$,!1),document.removeEventListener("mousemove",X,!1),document.removeEventListener("mouseup",K,!1),window.removeEventListener("keydown",Z,!1)};var s=this,l={type:"change"},u={type:"start"},h={type:"end"},c={NONE:0,ROTATE_UP:1,ROTATE_LEFT:2,ROTATE:3,DOLLY:4,DOLLY_ROTATE:7,PAN:8,DOLLY_PAN:12},d=c.NONE,p=1e-6,f=new Spherical,m=new Spherical,v=1,g=new Vector3,y=!1,_=new Vector2,b=new Vector2,x=new Vector2,w=new Vector2,S=new Vector2,M=new Vector2,T=new Vector2,A=new Vector2,C=new Vector2,L=new Vector2,N=new Vector2,P=new Vector2,k=new Vector2,E=new Vector2;function D(){return Math.pow(.95,s.zoomSpeed)}function O(e){m.theta-=e}function R(e){m.phi-=e}var F,I=(F=new Vector3,function(e,t){F.setFromMatrixColumn(t,0),F.multiplyScalar(-e),g.add(F)}),B=function(){var e=new Vector3;return function(t,i){!0===s.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(s.object.up,e)),e.multiplyScalar(t),g.add(e)}}(),U=function(){var e=new Vector3;return function(t,i){var r=s.domElement===document?s.domElement.body:s.domElement;if(s.object.isPerspectiveCamera){var n=s.object.position;e.copy(n).sub(s.target);var o=e.length();o*=Math.tan(s.object.fov/2*Math.PI/180),I(2*t*o/r.clientHeight,s.object.matrix),B(2*i*o/r.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(I(t*(s.object.right-s.object.left)/s.object.zoom/r.clientWidth,s.object.matrix),B(i*(s.object.top-s.object.bottom)/s.object.zoom/r.clientHeight,s.object.matrix)):(console.warn("WARNING: MapControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function V(e){s.object.isPerspectiveCamera?v/=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: MapControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function z(e){s.object.isPerspectiveCamera?v*=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: MapControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function G(e){_.set(e.clientX,e.clientY)}function j(e){if(!1!==s.enableRotate&&0!=(d&c.ROTATE)){if(x.set(e.touches[0].pageX,e.touches[0].pageY),w.set(e.touches[1].pageX,e.touches[1].pageY),S.subVectors(x,_),M.subVectors(w,b),T.subVectors(b,_),A.subVectors(w,x),function(){if(!H(T))return!1;if(!H(A))return!1;if(!q(S))return!1;if(!q(M))return!1;return S.dot(M)>0}()){var t=s.domElement===document?s.domElement.body:s.domElement;R(2*Math.PI*S.y/t.clientHeight),d=c.ROTATE_UP}else 0!=(d&c.ROTATE_LEFT)&&O((T.angle()-A.angle())*s.rotateSpeed);_.copy(x),b.copy(w)}}var W,H=(W=Math.sin(Math.PI/6),function(e){return Math.abs(Math.sin(e.angle()))<W}),q=function(){var e=Math.cos(Math.PI/2-Math.PI/6);return function(t){return Math.abs(Math.cos(t.angle()))<e}}();function Y(e){if(!1!==s.enabled){switch(e.preventDefault(),e.button){case s.mouseButtons.LEFT:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enableRotate)return;G(e),d=c.ROTATE}else{if(!1===s.enablePan)return;!function(e){C.set(e.clientX,e.clientY)}(e),d=c.PAN}break;case s.mouseButtons.MIDDLE:if(!1===s.enableZoom)return;!function(e){P.set(e.clientX,e.clientY)}(e),d=c.DOLLY;break;case s.mouseButtons.RIGHT:if(!1===s.enableRotate)return;G(e),d=c.ROTATE}d!==c.NONE&&(document.addEventListener("mousemove",X,!1),document.addEventListener("mouseup",K,!1),s.dispatchEvent(u))}}function X(e){if(!1!==s.enabled)switch(e.preventDefault(),d){case c.ROTATE:if(!1===s.enableRotate)return;!function(e){x.set(e.clientX,e.clientY),S.subVectors(x,_).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;O(2*Math.PI*S.x/t.clientHeight),R(2*Math.PI*S.y/t.clientHeight),_.copy(x),s.update()}(e);break;case c.DOLLY:if(!1===s.enableZoom)return;!function(e){k.set(e.clientX,e.clientY),E.subVectors(k,P),E.y>0?V(D()):E.y<0&&z(D()),P.copy(k),s.update()}(e);break;case c.PAN:if(!1===s.enablePan)return;!function(e){L.set(e.clientX,e.clientY),N.subVectors(L,C).multiplyScalar(s.panSpeed),U(N.x,N.y),C.copy(L),s.update()}(e)}}function K(e){!1!==s.enabled&&(document.removeEventListener("mousemove",X,!1),document.removeEventListener("mouseup",K,!1),s.dispatchEvent(h),d=c.NONE)}function Q(e){!1===s.enabled||!1===s.enableZoom||d!==c.NONE&&d!==c.ROTATE||(e.preventDefault(),e.stopPropagation(),s.dispatchEvent(u),function(e){e.deltaY<0?z(D()):e.deltaY>0&&V(D()),s.update()}(e),s.dispatchEvent(h))}function Z(e){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(e){switch(e.keyCode){case s.keys.UP:U(0,s.keyPanSpeed),s.update();break;case s.keys.BOTTOM:U(0,-s.keyPanSpeed),s.update();break;case s.keys.LEFT:U(s.keyPanSpeed,0),s.update();break;case s.keys.RIGHT:U(-s.keyPanSpeed,0),s.update()}}(e)}function J(e){if(!1!==s.enabled){switch(e.preventDefault(),e.touches.length){case 1:if(!1===s.enablePan)return;!function(e){s.enablePan&&C.set(e.touches[0].pageX,e.touches[0].pageY)}(e),d=c.PAN;break;case 2:if(!1===s.enableZoom&&!1===s.enableRotate)return;!function(e){_.set(e.touches[0].pageX,e.touches[0].pageY),b.set(e.touches[1].pageX,e.touches[1].pageY)}(e),function(e){if(s.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+i*i);P.set(0,r)}}(e),d=c.DOLLY_ROTATE;break;default:d=c.NONE}d!==c.NONE&&s.dispatchEvent(u)}}function $(e){if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===s.enablePan)return;if(d!==c.PAN)return;!function(e){!1!==s.enablePan&&0!=(d&c.PAN)&&(L.set(e.touches[0].pageX,e.touches[0].pageY),N.subVectors(L,C).multiplyScalar(s.panSpeed),U(N.x,N.y),C.copy(L))}(e),s.update();break;case 2:if(!1===s.enableZoom&&!1===s.enableRotate)return;if(0==(d&c.DOLLY_ROTATE))return;j(e),function(e){if(!1!==s.enableZoom&&0!=(d&c.DOLLY)){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+i*i);k.set(0,r),E.set(0,Math.pow(k.y/P.y,s.zoomSpeed)),V(E.y),P.copy(k)}}(e),s.update();break;default:d=c.NONE}}function ee(e){!1!==s.enabled&&(s.dispatchEvent(h),d=c.NONE)}function te(e){!1!==s.enabled&&e.preventDefault()}s.domElement.addEventListener("contextmenu",te,!1),s.domElement.addEventListener("mousedown",Y,!1),s.domElement.addEventListener("wheel",Q,!1),s.domElement.addEventListener("touchstart",J,!1),s.domElement.addEventListener("touchend",ee,!1),s.domElement.addEventListener("touchmove",$,!1),window.addEventListener("keydown",Z,!1),this.update()};MapControls.prototype=Object.create(EventDispatcher.prototype),MapControls.prototype.constructor=MapControls,Object.defineProperties(MapControls.prototype,{center:{get:function(){return console.warn("MapControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("MapControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("MapControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("MapControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("MapControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("MapControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("MapControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("MapControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("MapControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("MapControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("MapControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("MapControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("MapControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}});var OrbitControls=function(e,t){var i,r,n,o,a;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:MOUSE.LEFT,MIDDLE:MOUSE.MIDDLE,RIGHT:MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(l),s.update(),d=c.NONE},this.update=(i=new Vector3,r=(new Quaternion).setFromUnitVectors(e.up,new Vector3(0,1,0)),n=r.clone().inverse(),o=new Vector3,a=new Quaternion,function(){var e=s.object.position;return i.copy(e).sub(s.target),i.applyQuaternion(r),f.setFromVector3(i),s.autoRotate&&d===c.NONE&&N(2*Math.PI/60/60*s.autoRotateSpeed),f.theta+=m.theta,f.phi+=m.phi,f.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,f.theta)),f.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=v,f.radius=Math.max(s.minDistance,Math.min(s.maxDistance,f.radius)),s.target.add(g),i.setFromSpherical(f),i.applyQuaternion(n),e.copy(s.target).add(i),s.object.lookAt(s.target),!0===s.enableDamping?(m.theta*=1-s.dampingFactor,m.phi*=1-s.dampingFactor,g.multiplyScalar(1-s.dampingFactor)):(m.set(0,0,0),g.set(0,0,0)),v=1,!!(y||o.distanceToSquared(s.object.position)>p||8*(1-a.dot(s.object.quaternion))>p)&&(s.dispatchEvent(l),o.copy(s.object.position),a.copy(s.object.quaternion),y=!1,!0)}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",q,!1),s.domElement.removeEventListener("mousedown",B,!1),s.domElement.removeEventListener("wheel",z,!1),s.domElement.removeEventListener("touchstart",j,!1),s.domElement.removeEventListener("touchend",H,!1),s.domElement.removeEventListener("touchmove",W,!1),document.removeEventListener("mousemove",U,!1),document.removeEventListener("mouseup",V,!1),window.removeEventListener("keydown",G,!1)};var s=this,l={type:"change"},u={type:"start"},h={type:"end"},c={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},d=c.NONE,p=1e-6,f=new Spherical,m=new Spherical,v=1,g=new Vector3,y=!1,_=new Vector2,b=new Vector2,x=new Vector2,w=new Vector2,S=new Vector2,M=new Vector2,T=new Vector2,A=new Vector2,C=new Vector2;function L(){return Math.pow(.95,s.zoomSpeed)}function N(e){m.theta-=e}function P(e){m.phi-=e}var k,E=(k=new Vector3,function(e,t){k.setFromMatrixColumn(t,0),k.multiplyScalar(-e),g.add(k)}),D=function(){var e=new Vector3;return function(t,i){!0===s.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(s.object.up,e)),e.multiplyScalar(t),g.add(e)}}(),O=function(){var e=new Vector3;return function(t,i){var r=s.domElement===document?s.domElement.body:s.domElement;if(s.object.isPerspectiveCamera){var n=s.object.position;e.copy(n).sub(s.target);var o=e.length();o*=Math.tan(s.object.fov/2*Math.PI/180),E(2*t*o/r.clientHeight,s.object.matrix),D(2*i*o/r.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(E(t*(s.object.right-s.object.left)/s.object.zoom/r.clientWidth,s.object.matrix),D(i*(s.object.top-s.object.bottom)/s.object.zoom/r.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function R(e){s.object.isPerspectiveCamera?v/=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function F(e){s.object.isPerspectiveCamera?v*=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function I(e){w.set(e.clientX,e.clientY)}function B(e){if(!1!==s.enabled){switch(e.preventDefault(),s.domElement.focus?s.domElement.focus():window.focus(),e.button){case s.mouseButtons.LEFT:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enablePan)return;I(e),d=c.PAN}else{if(!1===s.enableRotate)return;!function(e){_.set(e.clientX,e.clientY)}(e),d=c.ROTATE}break;case s.mouseButtons.MIDDLE:if(!1===s.enableZoom)return;!function(e){T.set(e.clientX,e.clientY)}(e),d=c.DOLLY;break;case s.mouseButtons.RIGHT:if(!1===s.enablePan)return;I(e),d=c.PAN}d!==c.NONE&&(document.addEventListener("mousemove",U,!1),document.addEventListener("mouseup",V,!1),s.dispatchEvent(u))}}function U(e){if(!1!==s.enabled)switch(e.preventDefault(),d){case c.ROTATE:if(!1===s.enableRotate)return;!function(e){b.set(e.clientX,e.clientY),x.subVectors(b,_).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;N(2*Math.PI*x.x/t.clientHeight),P(2*Math.PI*x.y/t.clientHeight),_.copy(b),s.update()}(e);break;case c.DOLLY:if(!1===s.enableZoom)return;!function(e){A.set(e.clientX,e.clientY),C.subVectors(A,T),C.y>0?R(L()):C.y<0&&F(L()),T.copy(A),s.update()}(e);break;case c.PAN:if(!1===s.enablePan)return;!function(e){S.set(e.clientX,e.clientY),M.subVectors(S,w).multiplyScalar(s.panSpeed),O(M.x,M.y),w.copy(S),s.update()}(e)}}function V(e){!1!==s.enabled&&(document.removeEventListener("mousemove",U,!1),document.removeEventListener("mouseup",V,!1),s.dispatchEvent(h),d=c.NONE)}function z(e){!1===s.enabled||!1===s.enableZoom||d!==c.NONE&&d!==c.ROTATE||(e.preventDefault(),e.stopPropagation(),s.dispatchEvent(u),function(e){e.deltaY<0?F(L()):e.deltaY>0&&R(L()),s.update()}(e),s.dispatchEvent(h))}function G(e){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(e){var t=!1;switch(e.keyCode){case s.keys.UP:O(0,s.keyPanSpeed),t=!0;break;case s.keys.BOTTOM:O(0,-s.keyPanSpeed),t=!0;break;case s.keys.LEFT:O(s.keyPanSpeed,0),t=!0;break;case s.keys.RIGHT:O(-s.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),s.update())}(e)}function j(e){if(!1!==s.enabled){switch(e.preventDefault(),e.touches.length){case 1:if(!1===s.enableRotate)return;!function(e){_.set(e.touches[0].pageX,e.touches[0].pageY)}(e),d=c.TOUCH_ROTATE;break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(e){if(s.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+i*i);T.set(0,r)}if(s.enablePan){var n=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(n,o)}}(e),d=c.TOUCH_DOLLY_PAN;break;default:d=c.NONE}d!==c.NONE&&s.dispatchEvent(u)}}function W(e){if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===s.enableRotate)return;if(d!==c.TOUCH_ROTATE)return;!function(e){b.set(e.touches[0].pageX,e.touches[0].pageY),x.subVectors(b,_).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;N(2*Math.PI*x.x/t.clientHeight),P(2*Math.PI*x.y/t.clientHeight),_.copy(b),s.update()}(e);break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;if(d!==c.TOUCH_DOLLY_PAN)return;!function(e){if(s.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+i*i);A.set(0,r),C.set(0,Math.pow(A.y/T.y,s.zoomSpeed)),R(C.y),T.copy(A)}if(s.enablePan){var n=.5*(e.touches[0].pageX+e.touches[1].pageX),o=.5*(e.touches[0].pageY+e.touches[1].pageY);S.set(n,o),M.subVectors(S,w).multiplyScalar(s.panSpeed),O(M.x,M.y),w.copy(S)}s.update()}(e);break;default:d=c.NONE}}function H(e){!1!==s.enabled&&(s.dispatchEvent(h),d=c.NONE)}function q(e){!1!==s.enabled&&e.preventDefault()}s.domElement.addEventListener("contextmenu",q,!1),s.domElement.addEventListener("mousedown",B,!1),s.domElement.addEventListener("wheel",z,!1),s.domElement.addEventListener("touchstart",j,!1),s.domElement.addEventListener("touchend",H,!1),s.domElement.addEventListener("touchmove",W,!1),window.addEventListener("keydown",G,!1),this.update()};OrbitControls.prototype=Object.create(EventDispatcher.prototype),OrbitControls.prototype.constructor=OrbitControls,Object.defineProperties(OrbitControls.prototype,{center:{get:function(){return console.warn("OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}});var OrthographicTrackballControls=function(e,t){var i=this,r={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.radius=0,this.rotateSpeed=1,this.zoomSpeed=1.2,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.keys=[65,83,68],this.target=new Vector3;var n=!0,o=r.NONE,a=r.NONE,s=new Vector3,l=new Vector3,u=new Vector3,h=new Vector2,c=new Vector2,d=0,p=0,f=new Vector2,m=new Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom;var v={type:"change"},g={type:"start"},y={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}this.radius=.5*Math.min(this.screen.width,this.screen.height),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom};var _,b,x,w,S,M,T=(_=new Vector2,function(e,t){return _.set((e-i.screen.left)/i.screen.width,(t-i.screen.top)/i.screen.height),_}),A=function(){var e=new Vector3,t=new Vector3,r=new Vector3;return function(n,o){r.set((n-.5*i.screen.width-i.screen.left)/i.radius,(.5*i.screen.height+i.screen.top-o)/i.radius,0);var a=r.length();return i.noRoll?a<Math.SQRT1_2?r.z=Math.sqrt(1-a*a):r.z=.5/a:a>1?r.normalize():r.z=Math.sqrt(1-a*a),s.copy(i.object.position).sub(i.target),e.copy(i.object.up).setLength(r.y),e.add(t.copy(i.object.up).cross(s).setLength(r.x)),e.add(s.setLength(r.z)),e}}();function C(e){!1!==i.enabled&&(window.removeEventListener("keydown",C),a=o,o===r.NONE&&(e.keyCode!==i.keys[r.ROTATE]||i.noRotate?e.keyCode!==i.keys[r.ZOOM]||i.noZoom?e.keyCode!==i.keys[r.PAN]||i.noPan||(o=r.PAN):o=r.ZOOM:o=r.ROTATE))}function L(e){!1!==i.enabled&&(o=a,window.addEventListener("keydown",C,!1))}function N(e){!1!==i.enabled&&(e.preventDefault(),e.stopPropagation(),o===r.NONE&&(o=e.button),o!==r.ROTATE||i.noRotate?o!==r.ZOOM||i.noZoom?o!==r.PAN||i.noPan||(f.copy(T(e.pageX,e.pageY)),m.copy(f)):(h.copy(T(e.pageX,e.pageY)),c.copy(h)):(l.copy(A(e.pageX,e.pageY)),u.copy(l)),document.addEventListener("mousemove",P,!1),document.addEventListener("mouseup",k,!1),i.dispatchEvent(g))}function P(e){!1!==i.enabled&&(e.preventDefault(),e.stopPropagation(),o!==r.ROTATE||i.noRotate?o!==r.ZOOM||i.noZoom?o!==r.PAN||i.noPan||m.copy(T(e.pageX,e.pageY)):c.copy(T(e.pageX,e.pageY)):u.copy(A(e.pageX,e.pageY)))}function k(e){!1!==i.enabled&&(e.preventDefault(),e.stopPropagation(),o=r.NONE,document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",k),i.dispatchEvent(y))}function E(e){!1!==i.enabled&&(e.preventDefault(),e.stopPropagation(),h.y+=.01*e.deltaY,i.dispatchEvent(g),i.dispatchEvent(y))}function D(e){if(!1!==i.enabled){switch(e.touches.length){case 1:o=r.TOUCH_ROTATE,l.copy(A(e.touches[0].pageX,e.touches[0].pageY)),u.copy(l);break;case 2:o=r.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;p=d=Math.sqrt(t*t+n*n);var a=(e.touches[0].pageX+e.touches[1].pageX)/2,s=(e.touches[0].pageY+e.touches[1].pageY)/2;f.copy(T(a,s)),m.copy(f);break;default:o=r.NONE}i.dispatchEvent(g)}}function O(e){if(!1!==i.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:u.copy(A(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;p=Math.sqrt(t*t+n*n);var a=(e.touches[0].pageX+e.touches[1].pageX)/2,s=(e.touches[0].pageY+e.touches[1].pageY)/2;m.copy(T(a,s));break;default:o=r.NONE}}function R(e){if(!1!==i.enabled){switch(e.touches.length){case 1:u.copy(A(e.touches[0].pageX,e.touches[0].pageY)),l.copy(u);break;case 2:d=p=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;m.copy(T(t,n)),f.copy(m)}o=r.NONE,i.dispatchEvent(y)}}function F(e){e.preventDefault()}this.rotateCamera=(b=new Vector3,x=new Quaternion,function(){var e=Math.acos(l.dot(u)/l.length()/u.length());e&&(b.crossVectors(l,u).normalize(),e*=i.rotateSpeed,x.setFromAxisAngle(b,-e),s.applyQuaternion(x),i.object.up.applyQuaternion(x),u.applyQuaternion(x),i.staticMoving?l.copy(u):(x.setFromAxisAngle(b,e*(i.dynamicDampingFactor-1)),l.applyQuaternion(x)),n=!0)}),this.zoomCamera=function(){if(o===r.TOUCH_ZOOM_PAN){var e=p/d;d=p,i.object.zoom*=e,n=!0}else{e=1+(c.y-h.y)*i.zoomSpeed;Math.abs(e-1)>1e-6&&e>0&&(i.object.zoom/=e,i.staticMoving?h.copy(c):h.y+=(c.y-h.y)*this.dynamicDampingFactor,n=!0)}},this.panCamera=(w=new Vector2,S=new Vector3,M=new Vector3,function(){if(w.copy(m).sub(f),w.lengthSq()){var e=(i.object.right-i.object.left)/i.object.zoom,t=(i.object.top-i.object.bottom)/i.object.zoom;w.x*=e,w.y*=t,M.copy(s).cross(i.object.up).setLength(w.x),M.add(S.copy(i.object.up).setLength(w.y)),i.object.position.add(M),i.target.add(M),i.staticMoving?f.copy(m):f.add(w.subVectors(m,f).multiplyScalar(i.dynamicDampingFactor)),n=!0}}),this.update=function(){s.subVectors(i.object.position,i.target),i.noRotate||i.rotateCamera(),i.noZoom||(i.zoomCamera(),n&&i.object.updateProjectionMatrix()),i.noPan||i.panCamera(),i.object.position.addVectors(i.target,s),i.object.lookAt(i.target),n&&(i.dispatchEvent(v),n=!1)},this.reset=function(){o=r.NONE,a=r.NONE,i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.up.copy(i.up0),s.subVectors(i.object.position,i.target),i.object.left=i.left0,i.object.right=i.right0,i.object.top=i.top0,i.object.bottom=i.bottom0,i.object.lookAt(i.target),i.dispatchEvent(v),n=!1},this.dispose=function(){this.domElement.removeEventListener("contextmenu",F,!1),this.domElement.removeEventListener("mousedown",N,!1),this.domElement.removeEventListener("wheel",E,!1),this.domElement.removeEventListener("touchstart",D,!1),this.domElement.removeEventListener("touchend",R,!1),this.domElement.removeEventListener("touchmove",O,!1),document.removeEventListener("mousemove",P,!1),document.removeEventListener("mouseup",k,!1),window.removeEventListener("keydown",C,!1),window.removeEventListener("keyup",L,!1)},this.domElement.addEventListener("contextmenu",F,!1),this.domElement.addEventListener("mousedown",N,!1),this.domElement.addEventListener("wheel",E,!1),this.domElement.addEventListener("touchstart",D,!1),this.domElement.addEventListener("touchend",R,!1),this.domElement.addEventListener("touchmove",O,!1),window.addEventListener("keydown",C,!1),window.addEventListener("keyup",L,!1),this.handleResize(),this.update()};OrthographicTrackballControls.prototype=Object.create(EventDispatcher.prototype),OrthographicTrackballControls.prototype.constructor=OrthographicTrackballControls;var PointerLockControls=function(e,t){var i=this;this.domElement=t||document.body,this.isLocked=!1,e.rotation.set(0,0,0);var r=new Object3D;r.add(e);var n=new Object3D;n.position.y=10,n.add(r);var o,a,s=Math.PI/2;function l(e){if(!1!==i.isLocked){var t=e.movementX||e.mozMovementX||e.webkitMovementX||0,o=e.movementY||e.mozMovementY||e.webkitMovementY||0;n.rotation.y-=.002*t,r.rotation.x-=.002*o,r.rotation.x=Math.max(-s,Math.min(s,r.rotation.x))}}function u(){document.pointerLockElement===i.domElement?(i.dispatchEvent({type:"lock"}),i.isLocked=!0):(i.dispatchEvent({type:"unlock"}),i.isLocked=!1)}function h(){console.error("PointerLockControls: Unable to use Pointer Lock API")}this.connect=function(){document.addEventListener("mousemove",l,!1),document.addEventListener("pointerlockchange",u,!1),document.addEventListener("pointerlockerror",h,!1)},this.disconnect=function(){document.removeEventListener("mousemove",l,!1),document.removeEventListener("pointerlockchange",u,!1),document.removeEventListener("pointerlockerror",h,!1)},this.dispose=function(){this.disconnect()},this.getObject=function(){return n},this.getDirection=(o=new Vector3(0,0,-1),a=new Euler(0,0,0,"YXZ"),function(e){return a.set(r.rotation.x,n.rotation.y,0),e.copy(o).applyEuler(a),e}),this.lock=function(){this.domElement.requestPointerLock()},this.unlock=function(){document.exitPointerLock()},this.connect()};PointerLockControls.prototype=Object.create(EventDispatcher.prototype),PointerLockControls.prototype.constructor=PointerLockControls;var TrackballControls=function(e,t){var i=this,r={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new Vector3;var n=new Vector3,o=r.NONE,a=r.NONE,s=new Vector3,l=new Vector2,u=new Vector2,h=new Vector3,c=0,d=new Vector2,p=new Vector2,f=0,m=0,v=new Vector2,g=new Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var y={type:"change"},_={type:"start"},b={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}};var x,w,S,M,T,A,C,L,N,P,k,E=(x=new Vector2,function(e,t){return x.set((e-i.screen.left)/i.screen.width,(t-i.screen.top)/i.screen.height),x}),D=function(){var e=new Vector2;return function(t,r){return e.set((t-.5*i.screen.width-i.screen.left)/(.5*i.screen.width),(i.screen.height+2*(i.screen.top-r))/i.screen.width),e}}();function O(e){!1!==i.enabled&&(window.removeEventListener("keydown",O),a=o,o===r.NONE&&(e.keyCode!==i.keys[r.ROTATE]||i.noRotate?e.keyCode!==i.keys[r.ZOOM]||i.noZoom?e.keyCode!==i.keys[r.PAN]||i.noPan||(o=r.PAN):o=r.ZOOM:o=r.ROTATE))}function R(e){!1!==i.enabled&&(o=a,window.addEventListener("keydown",O,!1))}function F(e){!1!==i.enabled&&(e.preventDefault(),e.stopPropagation(),o===r.NONE&&(o=e.button),o!==r.ROTATE||i.noRotate?o!==r.ZOOM||i.noZoom?o!==r.PAN||i.noPan||(v.copy(E(e.pageX,e.pageY)),g.copy(v)):(d.copy(E(e.pageX,e.pageY)),p.copy(d)):(u.copy(D(e.pageX,e.pageY)),l.copy(u)),document.addEventListener("mousemove",I,!1),document.addEventListener("mouseup",B,!1),i.dispatchEvent(_))}function I(e){!1!==i.enabled&&(e.preventDefault(),e.stopPropagation(),o!==r.ROTATE||i.noRotate?o!==r.ZOOM||i.noZoom?o!==r.PAN||i.noPan||g.copy(E(e.pageX,e.pageY)):p.copy(E(e.pageX,e.pageY)):(l.copy(u),u.copy(D(e.pageX,e.pageY))))}function B(e){!1!==i.enabled&&(e.preventDefault(),e.stopPropagation(),o=r.NONE,document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",B),i.dispatchEvent(b))}function U(e){if(!1!==i.enabled&&!0!==i.noZoom){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:d.y-=.025*e.deltaY;break;case 1:d.y-=.01*e.deltaY;break;default:d.y-=25e-5*e.deltaY}i.dispatchEvent(_),i.dispatchEvent(b)}}function V(e){if(!1!==i.enabled){switch(e.preventDefault(),e.touches.length){case 1:o=r.TOUCH_ROTATE,u.copy(D(e.touches[0].pageX,e.touches[0].pageY)),l.copy(u);break;default:o=r.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;m=f=Math.sqrt(t*t+n*n);var a=(e.touches[0].pageX+e.touches[1].pageX)/2,s=(e.touches[0].pageY+e.touches[1].pageY)/2;v.copy(E(a,s)),g.copy(v)}i.dispatchEvent(_)}}function z(e){if(!1!==i.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:l.copy(u),u.copy(D(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;m=Math.sqrt(t*t+r*r);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;g.copy(E(n,o))}}function G(e){if(!1!==i.enabled){switch(e.touches.length){case 0:o=r.NONE;break;case 1:o=r.TOUCH_ROTATE,u.copy(D(e.touches[0].pageX,e.touches[0].pageY)),l.copy(u)}i.dispatchEvent(b)}}function j(e){!1!==i.enabled&&e.preventDefault()}this.rotateCamera=(S=new Vector3,M=new Quaternion,T=new Vector3,A=new Vector3,C=new Vector3,L=new Vector3,function(){L.set(u.x-l.x,u.y-l.y,0),(w=L.length())?(s.copy(i.object.position).sub(i.target),T.copy(s).normalize(),A.copy(i.object.up).normalize(),C.crossVectors(A,T).normalize(),A.setLength(u.y-l.y),C.setLength(u.x-l.x),L.copy(A.add(C)),S.crossVectors(L,s).normalize(),w*=i.rotateSpeed,M.setFromAxisAngle(S,w),s.applyQuaternion(M),i.object.up.applyQuaternion(M),h.copy(S),c=w):!i.staticMoving&&c&&(c*=Math.sqrt(1-i.dynamicDampingFactor),s.copy(i.object.position).sub(i.target),M.setFromAxisAngle(h,c),s.applyQuaternion(M),i.object.up.applyQuaternion(M)),l.copy(u)}),this.zoomCamera=function(){var e;o===r.TOUCH_ZOOM_PAN?(e=f/m,f=m,s.multiplyScalar(e)):(1!==(e=1+(p.y-d.y)*i.zoomSpeed)&&e>0&&s.multiplyScalar(e),i.staticMoving?d.copy(p):d.y+=(p.y-d.y)*this.dynamicDampingFactor)},this.panCamera=(N=new Vector2,P=new Vector3,k=new Vector3,function(){N.copy(g).sub(v),N.lengthSq()&&(N.multiplyScalar(s.length()*i.panSpeed),k.copy(s).cross(i.object.up).setLength(N.x),k.add(P.copy(i.object.up).setLength(N.y)),i.object.position.add(k),i.target.add(k),i.staticMoving?v.copy(g):v.add(N.subVectors(g,v).multiplyScalar(i.dynamicDampingFactor)))}),this.checkDistances=function(){i.noZoom&&i.noPan||(s.lengthSq()>i.maxDistance*i.maxDistance&&(i.object.position.addVectors(i.target,s.setLength(i.maxDistance)),d.copy(p)),s.lengthSq()<i.minDistance*i.minDistance&&(i.object.position.addVectors(i.target,s.setLength(i.minDistance)),d.copy(p)))},this.update=function(){s.subVectors(i.object.position,i.target),i.noRotate||i.rotateCamera(),i.noZoom||i.zoomCamera(),i.noPan||i.panCamera(),i.object.position.addVectors(i.target,s),i.checkDistances(),i.object.lookAt(i.target),n.distanceToSquared(i.object.position)>1e-6&&(i.dispatchEvent(y),n.copy(i.object.position))},this.reset=function(){o=r.NONE,a=r.NONE,i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.up.copy(i.up0),s.subVectors(i.object.position,i.target),i.object.lookAt(i.target),i.dispatchEvent(y),n.copy(i.object.position)},this.dispose=function(){this.domElement.removeEventListener("contextmenu",j,!1),this.domElement.removeEventListener("mousedown",F,!1),this.domElement.removeEventListener("wheel",U,!1),this.domElement.removeEventListener("touchstart",V,!1),this.domElement.removeEventListener("touchend",G,!1),this.domElement.removeEventListener("touchmove",z,!1),document.removeEventListener("mousemove",I,!1),document.removeEventListener("mouseup",B,!1),window.removeEventListener("keydown",O,!1),window.removeEventListener("keyup",R,!1)},this.domElement.addEventListener("contextmenu",j,!1),this.domElement.addEventListener("mousedown",F,!1),this.domElement.addEventListener("wheel",U,!1),this.domElement.addEventListener("touchstart",V,!1),this.domElement.addEventListener("touchend",G,!1),this.domElement.addEventListener("touchmove",z,!1),window.addEventListener("keydown",O,!1),window.addEventListener("keyup",R,!1),this.handleResize(),this.update()};function PolyhedronGeometry(e,t,i,r){Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r},this.fromBufferGeometry(new PolyhedronBufferGeometry(e,t,i,r)),this.mergeVertices()}function PolyhedronBufferGeometry(e,t,i,r){BufferGeometry.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r},i=i||1;var n=[],o=[];function a(e,t,i,r){var n,o,a=Math.pow(2,r),l=[];for(n=0;n<=a;n++){l[n]=[];var u=e.clone().lerp(i,n/a),h=t.clone().lerp(i,n/a),c=a-n;for(o=0;o<=c;o++)l[n][o]=0===o&&n===a?u:u.clone().lerp(h,o/c)}for(n=0;n<a;n++)for(o=0;o<2*(a-n)-1;o++){var d=Math.floor(o/2);o%2==0?(s(l[n][d+1]),s(l[n+1][d]),s(l[n][d])):(s(l[n][d+1]),s(l[n+1][d+1]),s(l[n+1][d]))}}function s(e){n.push(e.x,e.y,e.z)}function l(t,i){var r=3*t;i.x=e[r+0],i.y=e[r+1],i.z=e[r+2]}function u(e,t,i,r){r<0&&1===e.x&&(o[t]=e.x-1),0===i.x&&0===i.z&&(o[t]=r/2/Math.PI+.5)}function h(e){return Math.atan2(e.z,-e.x)}!function(e){for(var i=new Vector3,r=new Vector3,n=new Vector3,o=0;o<t.length;o+=3)l(t[o+0],i),l(t[o+1],r),l(t[o+2],n),a(i,r,n,e)}(r=r||0),function(e){for(var t=new Vector3,i=0;i<n.length;i+=3)t.x=n[i+0],t.y=n[i+1],t.z=n[i+2],t.normalize().multiplyScalar(e),n[i+0]=t.x,n[i+1]=t.y,n[i+2]=t.z}(i),function(){for(var e=new Vector3,t=0;t<n.length;t+=3){e.x=n[t+0],e.y=n[t+1],e.z=n[t+2];var i=h(e)/2/Math.PI+.5,r=(a=e,Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5);o.push(i,1-r)}var a;(function(){for(var e=new Vector3,t=new Vector3,i=new Vector3,r=new Vector3,a=new Vector2,s=new Vector2,l=new Vector2,c=0,d=0;c<n.length;c+=9,d+=6){e.set(n[c+0],n[c+1],n[c+2]),t.set(n[c+3],n[c+4],n[c+5]),i.set(n[c+6],n[c+7],n[c+8]),a.set(o[d+0],o[d+1]),s.set(o[d+2],o[d+3]),l.set(o[d+4],o[d+5]),r.copy(e).add(t).add(i).divideScalar(3);var p=h(r);u(a,d+0,e,p),u(s,d+2,t,p),u(l,d+4,i,p)}})(),function(){for(var e=0;e<o.length;e+=6){var t=o[e+0],i=o[e+2],r=o[e+4],n=Math.max(t,i,r),a=Math.min(t,i,r);n>.9&&a<.1&&(t<.2&&(o[e+0]+=1),i<.2&&(o[e+2]+=1),r<.2&&(o[e+4]+=1))}}()}(),this.addAttribute("position",new Float32BufferAttribute(n,3)),this.addAttribute("normal",new Float32BufferAttribute(n.slice(),3)),this.addAttribute("uv",new Float32BufferAttribute(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}function OctahedronGeometry(e,t){Geometry.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new OctahedronBufferGeometry(e,t)),this.mergeVertices()}function OctahedronBufferGeometry(e,t){PolyhedronBufferGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function TorusGeometry(e,t,i,r,n){Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},this.fromBufferGeometry(new TorusBufferGeometry(e,t,i,r,n)),this.mergeVertices()}function TorusBufferGeometry(e,t,i,r,n){BufferGeometry.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},e=e||1,t=t||.4,i=Math.floor(i)||8,r=Math.floor(r)||6,n=n||2*Math.PI;var o,a,s=[],l=[],u=[],h=[],c=new Vector3,d=new Vector3,p=new Vector3;for(o=0;o<=i;o++)for(a=0;a<=r;a++){var f=a/r*n,m=o/i*Math.PI*2;d.x=(e+t*Math.cos(m))*Math.cos(f),d.y=(e+t*Math.cos(m))*Math.sin(f),d.z=t*Math.sin(m),l.push(d.x,d.y,d.z),c.x=e*Math.cos(f),c.y=e*Math.sin(f),p.subVectors(d,c).normalize(),u.push(p.x,p.y,p.z),h.push(a/r),h.push(o/i)}for(o=1;o<=i;o++)for(a=1;a<=r;a++){var v=(r+1)*o+a-1,g=(r+1)*(o-1)+a-1,y=(r+1)*(o-1)+a,_=(r+1)*o+a;s.push(v,g,_),s.push(g,y,_)}this.setIndex(s),this.addAttribute("position",new Float32BufferAttribute(l,3)),this.addAttribute("normal",new Float32BufferAttribute(u,3)),this.addAttribute("uv",new Float32BufferAttribute(h,2))}TrackballControls.prototype=Object.create(EventDispatcher.prototype),TrackballControls.prototype.constructor=TrackballControls,PolyhedronGeometry.prototype=Object.create(Geometry.prototype),PolyhedronGeometry.prototype.constructor=PolyhedronGeometry,PolyhedronBufferGeometry.prototype=Object.create(BufferGeometry.prototype),PolyhedronBufferGeometry.prototype.constructor=PolyhedronBufferGeometry,OctahedronGeometry.prototype=Object.create(Geometry.prototype),OctahedronGeometry.prototype.constructor=OctahedronGeometry,OctahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),OctahedronBufferGeometry.prototype.constructor=OctahedronBufferGeometry,TorusGeometry.prototype=Object.create(Geometry.prototype),TorusGeometry.prototype.constructor=TorusGeometry,TorusBufferGeometry.prototype=Object.create(BufferGeometry.prototype),TorusBufferGeometry.prototype.constructor=TorusBufferGeometry;var TransformControls=function(e,t){Object3D.call(this),t=void 0!==t?t:document,this.visible=!1;var i=new TransformControlsGizmo;this.add(i);var r=new TransformControlsPlane;this.add(r);var n=this;B("camera",e),B("object",void 0),B("enabled",!0),B("axis",null),B("mode","translate"),B("translationSnap",null),B("rotationSnap",null),B("space","world"),B("size",1),B("dragging",!1),B("showX",!0),B("showY",!0),B("showZ",!0);var o={type:"change"},a={type:"mouseDown"},s={type:"mouseUp",mode:n.mode},l={type:"objectChange"},u=new Raycaster,h=new Vector3,c=new Quaternion,d={X:new Vector3(1,0,0),Y:new Vector3(0,1,0),Z:new Vector3(0,0,1)},p=new Vector3,f=new Vector3,m=new Vector3,v=new Vector3,g=new Vector3,y=new Vector3,_=0,b=new Vector3,x=new Quaternion,w=new Vector3,S=new Vector3,M=new Quaternion,T=new Quaternion,A=new Vector3,C=new Vector3,L=new Quaternion,N=new Vector3,P=new Vector3,k=new Quaternion,E=new Quaternion,D=new Vector3,O=new Vector3,R=new Vector3,F=new Quaternion,I=new Vector3;function B(e,t){var a=t;Object.defineProperty(n,e,{get:function(){return void 0!==a?a:t},set:function(t){a!==t&&(a=t,r[e]=t,i[e]=t,n.dispatchEvent({type:e+"-changed",value:t}),n.dispatchEvent(o))}}),n[e]=t,r[e]=t,i[e]=t}function U(e){var i=e.changedTouches?e.changedTouches[0]:e,r=t.getBoundingClientRect();return{x:(i.clientX-r.left)/r.width*2-1,y:-(i.clientY-r.top)/r.height*2+1,button:e.button}}function V(e){n.enabled&&n.pointerHover(U(e))}function z(e){n.enabled&&(document.addEventListener("mousemove",G,!1),n.pointerHover(U(e)),n.pointerDown(U(e)))}function G(e){n.enabled&&n.pointerMove(U(e))}function j(e){n.enabled&&(document.removeEventListener("mousemove",G,!1),n.pointerUp(U(e)))}B("worldPosition",P),B("worldPositionStart",C),B("worldQuaternion",k),B("worldQuaternionStart",L),B("cameraPosition",b),B("cameraQuaternion",x),B("pointStart",p),B("pointEnd",f),B("rotationAxis",v),B("rotationAngle",_),B("eye",O),t.addEventListener("mousedown",z,!1),t.addEventListener("touchstart",z,!1),t.addEventListener("mousemove",V,!1),t.addEventListener("touchmove",V,!1),t.addEventListener("touchmove",G,!1),document.addEventListener("mouseup",j,!1),t.addEventListener("touchend",j,!1),t.addEventListener("touchcancel",j,!1),t.addEventListener("touchleave",j,!1),this.dispose=function(){t.removeEventListener("mousedown",z),t.removeEventListener("touchstart",z),t.removeEventListener("mousemove",V),t.removeEventListener("touchmove",V),t.removeEventListener("touchmove",G),document.removeEventListener("mouseup",j),t.removeEventListener("touchend",j),t.removeEventListener("touchcancel",j),t.removeEventListener("touchleave",j)},this.attach=function(e){this.object=e,this.visible=!0},this.detach=function(){this.object=void 0,this.visible=!1,this.axis=null},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),this.object.parent.matrixWorld.decompose(S,M,A),this.object.matrixWorld.decompose(P,k,D),T.copy(M).inverse(),E.copy(k).inverse()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(b,x,w),this.camera instanceof PerspectiveCamera?O.copy(b).sub(P).normalize():this.camera instanceof OrthographicCamera&&O.copy(b).normalize(),Object3D.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){u.setFromCamera(e,this.camera);var t=u.intersectObjects(i.picker[this.mode].children,!0)[0]||!1;this.axis=t?t.object.name:null}},this.pointerDown=function(e){if(!(void 0===this.object||!0===this.dragging||void 0!==e.button&&0!==e.button||0!==e.button&&void 0!==e.button||null===this.axis)){u.setFromCamera(e,this.camera);var t=u.intersectObjects([r],!0)[0]||!1;if(t){var i=this.space;if("scale"===this.mode?i="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(i="world"),"local"===i&&"rotate"===this.mode){var n=this.rotationSnap;"X"===this.axis&&n&&(this.object.rotation.x=Math.round(this.object.rotation.x/n)*n),"Y"===this.axis&&n&&(this.object.rotation.y=Math.round(this.object.rotation.y/n)*n),"Z"===this.axis&&n&&(this.object.rotation.z=Math.round(this.object.rotation.z/n)*n)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),R.copy(this.object.position),F.copy(this.object.quaternion),I.copy(this.object.scale),this.object.matrixWorld.decompose(C,L,N),p.copy(t.point).sub(C)}this.dragging=!0,a.mode=this.mode,this.dispatchEvent(a)}},this.pointerMove=function(e){var t=this.axis,i=this.mode,n=this.object,a=this.space;if("scale"===i?a="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(a="world"),void 0!==n&&null!==t&&!1!==this.dragging&&(void 0===e.button||0===e.button)){u.setFromCamera(e,this.camera);var s=u.intersectObjects([r],!0)[0]||!1;if(!1!==s){if(f.copy(s.point).sub(C),"translate"===i)m.copy(f).sub(p),"local"===a&&"XYZ"!==t&&m.applyQuaternion(E),-1===t.indexOf("X")&&(m.x=0),-1===t.indexOf("Y")&&(m.y=0),-1===t.indexOf("Z")&&(m.z=0),"local"===a&&"XYZ"!==t?m.applyQuaternion(F).divide(A):m.applyQuaternion(T).divide(A),n.position.copy(m).add(R),this.translationSnap&&("local"===a&&(n.position.applyQuaternion(c.copy(F).inverse()),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(F)),"world"===a&&(n.parent&&n.position.add(h.setFromMatrixPosition(n.parent.matrixWorld)),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(h.setFromMatrixPosition(n.parent.matrixWorld))));else if("scale"===i){if(-1!==t.search("XYZ")){var b=f.length()/p.length();f.dot(p)<0&&(b*=-1),h.set(b,b,b)}else h.copy(f).divide(p),-1===t.search("X")&&(h.x=1),-1===t.search("Y")&&(h.y=1),-1===t.search("Z")&&(h.z=1);n.scale.copy(I).multiply(h)}else if("rotate"===i){m.copy(f).sub(p);var x=20/P.distanceTo(h.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(v.copy(O),_=f.angleTo(p),g.copy(p).normalize(),y.copy(f).normalize(),_*=y.cross(g).dot(O)<0?1:-1):"XYZE"===t?(v.copy(m).cross(O).normalize(),_=m.dot(h.copy(v).cross(this.eye))*x):"X"!==t&&"Y"!==t&&"Z"!==t||(v.copy(d[t]),h.copy(d[t]),"local"===a&&h.applyQuaternion(k),_=m.dot(h.cross(O).normalize())*x),this.rotationSnap&&(_=Math.round(_/this.rotationSnap)*this.rotationSnap),this.rotationAngle=_,"local"===a&&"E"!==t&&"XYZE"!==t?(n.quaternion.copy(F),n.quaternion.multiply(c.setFromAxisAngle(v,_)).normalize()):(v.applyQuaternion(T),n.quaternion.copy(c.setFromAxisAngle(v,_)),n.quaternion.multiply(F).normalize())}this.dispatchEvent(o),this.dispatchEvent(l)}}},this.pointerUp=function(e){void 0!==e.button&&0!==e.button||(this.dragging&&null!==this.axis&&(s.mode=this.mode,this.dispatchEvent(s)),this.dragging=!1,void 0===e.button&&(this.axis=null))},this.getMode=function(){return n.mode},this.setMode=function(e){n.mode=e},this.setTranslationSnap=function(e){n.translationSnap=e},this.setRotationSnap=function(e){n.rotationSnap=e},this.setSize=function(e){n.size=e},this.setSpace=function(e){n.space=e},this.update=function(){console.warn("TransformControls: update function has been depricated.")}};TransformControls.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:TransformControls,isTransformControls:!0});var TransformControlsGizmo=function(){Object3D.call(this),this.type="TransformControlsGizmo";var e=new MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:DoubleSide,fog:!1}),t=new LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),i=e.clone();i.opacity=.15;var r=e.clone();r.opacity=.33;var n=e.clone();n.color.set(16711680);var o=e.clone();o.color.set(65280);var a=e.clone();a.color.set(255);var s=e.clone();s.opacity=.25;var l=s.clone();l.color.set(16776960);var u=s.clone();u.color.set(65535);var h=s.clone();h.color.set(16711935),e.clone().color.set(16776960);var c=t.clone();c.color.set(16711680);var d=t.clone();d.color.set(65280);var p=t.clone();p.color.set(255);var f=t.clone();f.color.set(65535);var m=t.clone();m.color.set(16711935);var v=t.clone();v.color.set(16776960);var g=t.clone();g.color.set(7895160);var y=v.clone();y.opacity=.25;var _=new CylinderBufferGeometry(0,.05,.2,12,1,!1),b=new BoxBufferGeometry(.125,.125,.125),x=new BufferGeometry;x.addAttribute("position",new Float32BufferAttribute([0,0,0,1,0,0],3));var w,S=function(e,t){for(var i=new BufferGeometry,r=[],n=0;n<=64*t;++n)r.push(0,Math.cos(n/32*Math.PI)*e,Math.sin(n/32*Math.PI)*e);return i.addAttribute("position",new Float32BufferAttribute(r,3)),i},M={X:[[new Mesh(_,n),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new Mesh(_,n),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new Line(x,c)]],Y:[[new Mesh(_,o),[0,1,0],null,null,"fwd"],[new Mesh(_,o),[0,1,0],[Math.PI,0,0],null,"bwd"],[new Line(x,d),null,[0,0,Math.PI/2]]],Z:[[new Mesh(_,a),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new Mesh(_,a),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new Line(x,p),null,[0,-Math.PI/2,0]]],XYZ:[[new Mesh(new OctahedronBufferGeometry(.1,0),s),[0,0,0],[0,0,0]]],XY:[[new Mesh(new PlaneBufferGeometry(.295,.295),l),[.15,.15,0]],[new Line(x,v),[.18,.3,0],null,[.125,1,1]],[new Line(x,v),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new Mesh(new PlaneBufferGeometry(.295,.295),u),[0,.15,.15],[0,Math.PI/2,0]],[new Line(x,f),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new Line(x,f),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new Mesh(new PlaneBufferGeometry(.295,.295),h),[.15,0,.15],[-Math.PI/2,0,0]],[new Line(x,m),[.18,0,.3],null,[.125,1,1]],[new Line(x,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},T={X:[[new Mesh(new CylinderBufferGeometry(.2,0,1,4,1,!1),i),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new Mesh(new CylinderBufferGeometry(.2,0,1,4,1,!1),i),[0,.6,0]]],Z:[[new Mesh(new CylinderBufferGeometry(.2,0,1,4,1,!1),i),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new Mesh(new OctahedronBufferGeometry(.2,0),i)]],XY:[[new Mesh(new PlaneBufferGeometry(.4,.4),i),[.2,.2,0]]],YZ:[[new Mesh(new PlaneBufferGeometry(.4,.4),i),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new Mesh(new PlaneBufferGeometry(.4,.4),i),[.2,0,.2],[-Math.PI/2,0,0]]]},A={START:[[new Mesh(new OctahedronBufferGeometry(.01,2),r),null,null,null,"helper"]],END:[[new Mesh(new OctahedronBufferGeometry(.01,2),r),null,null,null,"helper"]],DELTA:[[new Line((w=new BufferGeometry,w.addAttribute("position",new Float32BufferAttribute([0,0,0,1,1,1],3)),w),r),null,null,null,"helper"]],X:[[new Line(x,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Line(x,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Line(x,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},C={X:[[new Line(S(1,.5),c)],[new Mesh(new OctahedronBufferGeometry(.04,0),n),[0,0,.99],null,[1,3,1]]],Y:[[new Line(S(1,.5),d),null,[0,0,-Math.PI/2]],[new Mesh(new OctahedronBufferGeometry(.04,0),o),[0,0,.99],null,[3,1,1]]],Z:[[new Line(S(1,.5),p),null,[0,Math.PI/2,0]],[new Mesh(new OctahedronBufferGeometry(.04,0),a),[.99,0,0],null,[1,3,1]]],E:[[new Line(S(1.25,1),y),null,[0,Math.PI/2,0]],[new Mesh(new CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new Mesh(new CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new Mesh(new CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new Mesh(new CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new Line(S(1,1),g),null,[0,Math.PI/2,0]]]},L={AXIS:[[new Line(x,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},N={X:[[new Mesh(new TorusBufferGeometry(1,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Mesh(new TorusBufferGeometry(1,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Mesh(new TorusBufferGeometry(1,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Mesh(new TorusBufferGeometry(1.25,.1,2,24),i)]],XYZE:[[new Mesh(new SphereBufferGeometry(.7,10,8),i)]]},P={X:[[new Mesh(b,n),[.8,0,0],[0,0,-Math.PI/2]],[new Line(x,c),null,null,[.8,1,1]]],Y:[[new Mesh(b,o),[0,.8,0]],[new Line(x,d),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new Mesh(b,a),[0,0,.8],[Math.PI/2,0,0]],[new Line(x,p),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new Mesh(b,l),[.85,.85,0],null,[2,2,.2]],[new Line(x,v),[.855,.98,0],null,[.125,1,1]],[new Line(x,v),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new Mesh(b,u),[0,.85,.85],null,[.2,2,2]],[new Line(x,f),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new Line(x,f),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new Mesh(b,h),[.85,0,.85],null,[2,.2,2]],[new Line(x,m),[.855,0,.98],null,[.125,1,1]],[new Line(x,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new Mesh(new BoxBufferGeometry(.125,.125,.125),s),[1.1,0,0]]],XYZY:[[new Mesh(new BoxBufferGeometry(.125,.125,.125),s),[0,1.1,0]]],XYZZ:[[new Mesh(new BoxBufferGeometry(.125,.125,.125),s),[0,0,1.1]]]},k={X:[[new Mesh(new CylinderBufferGeometry(.2,0,.8,4,1,!1),i),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new Mesh(new CylinderBufferGeometry(.2,0,.8,4,1,!1),i),[0,.5,0]]],Z:[[new Mesh(new CylinderBufferGeometry(.2,0,.8,4,1,!1),i),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new Mesh(b,i),[.85,.85,0],null,[3,3,.2]]],YZ:[[new Mesh(b,i),[0,.85,.85],null,[.2,3,3]]],XZ:[[new Mesh(b,i),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new Mesh(new BoxBufferGeometry(.2,.2,.2),i),[1.1,0,0]]],XYZY:[[new Mesh(new BoxBufferGeometry(.2,.2,.2),i),[0,1.1,0]]],XYZZ:[[new Mesh(new BoxBufferGeometry(.2,.2,.2),i),[0,0,1.1]]]},E={X:[[new Line(x,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Line(x,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Line(x,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},D=function(e){var t=new Object3D;for(var i in e)for(var r=e[i].length;r--;){var n=e[i][r][0].clone(),o=e[i][r][1],a=e[i][r][2],s=e[i][r][3],l=e[i][r][4];n.name=i,n.tag=l,o&&n.position.set(o[0],o[1],o[2]),a&&n.rotation.set(a[0],a[1],a[2]),s&&n.scale.set(s[0],s[1],s[2]),n.updateMatrix();var u=n.geometry.clone();u.applyMatrix(n.matrix),n.geometry=u,n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),t.add(n)}return t},O=new Vector3(0,0,0),R=new Euler,F=new Vector3(0,1,0),I=new Vector3(0,0,0),B=new Matrix4,U=new Quaternion,V=new Quaternion,z=new Quaternion,G=new Vector3(1,0,0),j=new Vector3(0,1,0),W=new Vector3(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=D(M)),this.add(this.gizmo.rotate=D(C)),this.add(this.gizmo.scale=D(P)),this.add(this.picker.translate=D(T)),this.add(this.picker.rotate=D(N)),this.add(this.picker.scale=D(k)),this.add(this.helper.translate=D(A)),this.add(this.helper.rotate=D(L)),this.add(this.helper.scale=D(E)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var e=this.space;"scale"===this.mode&&(e="local");var t="local"===e?this.worldQuaternion:z;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var i=[];i=(i=(i=i.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var r=0;r<i.length;r++){var n=i[r];n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition);var o=this.worldPosition.distanceTo(this.cameraPosition);if(n.scale.set(1,1,1).multiplyScalar(o*this.size/7),"helper"!==n.tag){if(n.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){"X"!==n.name&&"XYZX"!==n.name||Math.abs(F.copy(G).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Y"!==n.name&&"XYZY"!==n.name||Math.abs(F.copy(j).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Z"!==n.name&&"XYZZ"!==n.name||Math.abs(F.copy(W).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&Math.abs(F.copy(W).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&Math.abs(F.copy(G).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&Math.abs(F.copy(j).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),-1!==n.name.search("X")&&(F.copy(G).applyQuaternion(t).dot(this.eye)<-.4?"fwd"===n.tag?n.visible=!1:n.scale.x*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Y")&&(F.copy(j).applyQuaternion(t).dot(this.eye)<-.4?"fwd"===n.tag?n.visible=!1:n.scale.y*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Z")&&(F.copy(W).applyQuaternion(t).dot(this.eye)<-.4?"fwd"===n.tag?n.visible=!1:n.scale.z*=-1:"bwd"===n.tag&&(n.visible=!1))}else"rotate"===this.mode&&(V.copy(t),F.copy(this.eye).applyQuaternion(U.copy(t).inverse()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(B.lookAt(this.eye,I,j)),"X"===n.name&&(U.setFromAxisAngle(G,Math.atan2(-F.y,F.z)),U.multiplyQuaternions(V,U),n.quaternion.copy(U)),"Y"===n.name&&(U.setFromAxisAngle(j,Math.atan2(F.x,F.z)),U.multiplyQuaternions(V,U),n.quaternion.copy(U)),"Z"===n.name&&(U.setFromAxisAngle(W,Math.atan2(F.y,F.x)),U.multiplyQuaternions(V,U),n.quaternion.copy(U)));n.visible=n.visible&&(-1===n.name.indexOf("X")||this.showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||this.showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||this.showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||this.showX&&this.showY&&this.showZ),n.material._opacity=n.material._opacity||n.material.opacity,n.material._color=n.material._color||n.material.color.clone(),n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled?this.axis&&(n.name===this.axis?(n.material.opacity=1,n.material.color.lerp(new Color(1,1,1),.5)):this.axis.split("").some(function(e){return n.name===e})?(n.material.opacity=1,n.material.color.lerp(new Color(1,1,1),.5)):(n.material.opacity*=.25,n.material.color.lerp(new Color(1,1,1),.5))):(n.material.opacity*=.5,n.material.color.lerp(new Color(1,1,1),.5))}else n.visible=!1,"AXIS"===n.name?(n.position.copy(this.worldPositionStart),n.visible=!!this.axis,"X"===this.axis&&(U.setFromEuler(R.set(0,0,0)),n.quaternion.copy(t).multiply(U),Math.abs(F.copy(G).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Y"===this.axis&&(U.setFromEuler(R.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(U),Math.abs(F.copy(j).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Z"===this.axis&&(U.setFromEuler(R.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(U),Math.abs(F.copy(W).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"XYZE"===this.axis&&(U.setFromEuler(R.set(0,Math.PI/2,0)),F.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(B.lookAt(I,F,j)),n.quaternion.multiply(U),n.visible=this.dragging),"E"===this.axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):"END"===n.name?(n.position.copy(this.worldPosition),n.visible=this.dragging):"DELTA"===n.name?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),O.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),O.applyQuaternion(this.worldQuaternionStart.clone().inverse()),n.scale.copy(O),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=-1!==this.axis.search(n.name)))}Object3D.prototype.updateMatrixWorld.call(this)}};TransformControlsGizmo.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:TransformControlsGizmo,isTransformControlsGizmo:!0});var TransformControlsPlane=function(){Mesh.call(this,new PlaneBufferGeometry(1e5,1e5,2,2),new MeshBasicMaterial({visible:!1,wireframe:!0,side:DoubleSide,transparent:!0,opacity:.1})),this.type="TransformControlsPlane";var e=new Vector3(1,0,0),t=new Vector3(0,1,0),i=new Vector3(0,0,1),r=new Vector3,n=new Vector3,o=new Vector3,a=new Matrix4,s=new Quaternion;this.updateMatrixWorld=function(){var l=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(l="local"),e.set(1,0,0).applyQuaternion("local"===l?this.worldQuaternion:s),t.set(0,1,0).applyQuaternion("local"===l?this.worldQuaternion:s),i.set(0,0,1).applyQuaternion("local"===l?this.worldQuaternion:s),o.copy(t),this.mode){case"translate":case"scale":switch(this.axis){case"X":o.copy(this.eye).cross(e),n.copy(e).cross(o);break;case"Y":o.copy(this.eye).cross(t),n.copy(t).cross(o);break;case"Z":o.copy(this.eye).cross(i),n.copy(i).cross(o);break;case"XY":n.copy(i);break;case"YZ":n.copy(e);break;case"XZ":o.copy(i),n.copy(t);break;case"XYZ":case"E":n.set(0,0,0)}break;case"rotate":default:n.set(0,0,0)}0===n.length()?this.quaternion.copy(this.cameraQuaternion):(a.lookAt(r.set(0,0,0),n,o),this.quaternion.setFromRotationMatrix(a)),Object3D.prototype.updateMatrixWorld.call(this)}},startP,startEnd;function Line3(e,t){this.start=void 0!==e?e:new Vector3,this.end=void 0!==t?t:new Vector3}TransformControlsPlane.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:TransformControlsPlane,isTransformControlsPlane:!0}),Object.assign(Line3.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("Line3: .getCenter() target is now required"),e=new Vector3),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("Line3: .delta() target is now required"),e=new Vector3),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("Line3: .at() target is now required"),t=new Vector3),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:(startP=new Vector3,startEnd=new Vector3,function(e,t){startP.subVectors(e,this.start),startEnd.subVectors(this.end,this.start);var i=startEnd.dot(startEnd),r=startEnd.dot(startP)/i;return t&&(r=_Math.clamp(r,0,1)),r}),closestPointToPoint:function(e,t,i){var r=this.closestPointToPointParameter(e,t);return void 0===i&&(console.warn("Line3: .closestPointToPoint() target is now required"),i=new Vector3),this.delta(i).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}});var Visible=0,Deleted=1,triangle;function QuickHull(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new VertexList,this.unassigned=new VertexList,this.vertices=[]}function Face(){this.normal=new Vector3,this.midpoint=new Vector3,this.area=0,this.constant=0,this.outside=null,this.mark=Visible,this.edge=null}function HalfEdge(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}function VertexNode(e){this.point=e,this.prev=null,this.next=null,this.face=null}function VertexList(){this.head=null,this.tail=null}function ConvexGeometry(e){Geometry.call(this),this.fromBufferGeometry(new ConvexBufferGeometry(e)),this.mergeVertices()}function ConvexBufferGeometry(e){BufferGeometry.call(this);var t=[],i=[];void 0===QuickHull&&console.error("ConvexBufferGeometry: ConvexBufferGeometry relies on QuickHull");for(var r=(new QuickHull).setFromPoints(e).faces,n=0;n<r.length;n++){var o=r[n],a=o.edge;do{var s=a.head().point;t.push(s.x,s.y,s.z),i.push(o.normal.x,o.normal.y,o.normal.z),a=a.next}while(a!==o.edge)}this.addAttribute("position",new Float32BufferAttribute(t,3)),this.addAttribute("normal",new Float32BufferAttribute(i,3))}Object.assign(QuickHull.prototype,{setFromPoints:function(e){!0!==Array.isArray(e)&&console.error("QuickHull: Points parameter is not an array."),e.length<4&&console.error("QuickHull: The algorithm needs at least four points."),this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.vertices.push(new VertexNode(e[t]));return this.compute(),this},setFromObject:function(e){var t=[];return e.updateMatrixWorld(!0),e.traverse(function(e){var i,r,n,o=e.geometry;if(void 0!==o)if(o.isGeometry){var a=o.vertices;for(i=0,r=a.length;i<r;i++)(n=a[i].clone()).applyMatrix4(e.matrixWorld),t.push(n)}else if(o.isBufferGeometry){var s=o.attributes.position;if(void 0!==s)for(i=0,r=s.count;i<r;i++)(n=new Vector3).fromBufferAttribute(s,i).applyMatrix4(e.matrixWorld),t.push(n)}}),this.setFromPoints(t)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(e,t){return e.face=t,null===t.outside?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this},removeVertexFromFace:function(e,t){return e===t.outside&&(null!==e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this},removeAllVerticesFromFace:function(e){if(null!==e.outside){for(var t=e.outside,i=e.outside;null!==i.next&&i.next.face===e;)i=i.next;return this.assigned.removeSubList(t,i),t.prev=i.next=null,e.outside=null,t}},deleteFaceVertices:function(e,t){var i=this.removeAllVerticesFromFace(e);if(void 0!==i)if(void 0===t)this.unassigned.appendChain(i);else{var r=i;do{var n=r.next;t.distanceToPoint(r.point)>this.tolerance?this.addVertexToFace(r,t):this.unassigned.append(r),r=n}while(null!==r)}return this},resolveUnassignedPoints:function(e){if(!1===this.unassigned.isEmpty()){var t=this.unassigned.first();do{for(var i=t.next,r=this.tolerance,n=null,o=0;o<e.length;o++){var a=e[o];if(a.mark===Visible){var s=a.distanceToPoint(t.point);if(s>r&&(r=s,n=a),r>1e3*this.tolerance)break}}null!==n&&this.addVertexToFace(t,n),t=i}while(null!==t)}return this},computeExtremes:function(){var e,t,i,r=new Vector3,n=new Vector3,o=[],a=[];for(e=0;e<3;e++)o[e]=a[e]=this.vertices[0];for(r.copy(this.vertices[0].point),n.copy(this.vertices[0].point),e=0,t=this.vertices.length;e<t;e++){var s=this.vertices[e],l=s.point;for(i=0;i<3;i++)l.getComponent(i)<r.getComponent(i)&&(r.setComponent(i,l.getComponent(i)),o[i]=s);for(i=0;i<3;i++)l.getComponent(i)>n.getComponent(i)&&(n.setComponent(i,l.getComponent(i)),a[i]=s)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(r.x),Math.abs(n.x))+Math.max(Math.abs(r.y),Math.abs(n.y))+Math.max(Math.abs(r.z),Math.abs(n.z))),{min:o,max:a}},computeInitialHull:function(){var e,t,i;return function(){void 0===e&&(e=new Line3,t=new Plane,i=new Vector3);var r,n,o,a,s,l,u,h,c,d=this.vertices,p=this.computeExtremes(),f=p.min,m=p.max,v=0,g=0;for(l=0;l<3;l++)(c=m[l].point.getComponent(l)-f[l].point.getComponent(l))>v&&(v=c,g=l);for(n=f[g],o=m[g],v=0,e.set(n.point,o.point),l=0,u=this.vertices.length;l<u;l++)(r=d[l])!==n&&r!==o&&(e.closestPointToPoint(r.point,!0,i),(c=i.distanceToSquared(r.point))>v&&(v=c,a=r));for(v=-1,t.setFromCoplanarPoints(n.point,o.point,a.point),l=0,u=this.vertices.length;l<u;l++)(r=d[l])!==n&&r!==o&&r!==a&&(c=Math.abs(t.distanceToPoint(r.point)))>v&&(v=c,s=r);var y=[];if(t.distanceToPoint(s.point)<0)for(y.push(Face.create(n,o,a),Face.create(s,o,n),Face.create(s,a,o),Face.create(s,n,a)),l=0;l<3;l++)h=(l+1)%3,y[l+1].getEdge(2).setTwin(y[0].getEdge(h)),y[l+1].getEdge(1).setTwin(y[h+1].getEdge(0));else for(y.push(Face.create(n,a,o),Face.create(s,n,o),Face.create(s,o,a),Face.create(s,a,n)),l=0;l<3;l++)h=(l+1)%3,y[l+1].getEdge(2).setTwin(y[0].getEdge((3-l)%3)),y[l+1].getEdge(0).setTwin(y[h+1].getEdge(1));for(l=0;l<4;l++)this.faces.push(y[l]);for(l=0,u=d.length;l<u;l++)if((r=d[l])!==n&&r!==o&&r!==a&&r!==s){v=this.tolerance;var _=null;for(h=0;h<4;h++)(c=this.faces[h].distanceToPoint(r.point))>v&&(v=c,_=this.faces[h]);null!==_&&this.addVertexToFace(r,_)}return this}}(),reindexFaces:function(){for(var e=[],t=0;t<this.faces.length;t++){var i=this.faces[t];i.mark===Visible&&e.push(i)}return this.faces=e,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var e,t=0,i=this.assigned.first().face,r=i.outside;do{var n=i.distanceToPoint(r.point);n>t&&(t=n,e=r),r=r.next}while(null!==r&&r.face===i);return e}},computeHorizon:function(e,t,i,r){var n;this.deleteFaceVertices(i),i.mark=Deleted,n=null===t?t=i.getEdge(0):t.next;do{var o=n.twin,a=o.face;a.mark===Visible&&(a.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,o,a,r):r.push(n)),n=n.next}while(n!==t);return this},addAdjoiningFace:function(e,t){var i=Face.create(e,t.tail(),t.head());return this.faces.push(i),i.getEdge(-1).setTwin(t.twin),i.getEdge(0)},addNewFaces:function(e,t){this.newFaces=[];for(var i=null,r=null,n=0;n<t.length;n++){var o=t[n],a=this.addAdjoiningFace(e,o);null===i?i=a:a.next.setTwin(r),this.newFaces.push(a.face),r=a}return i.next.setTwin(r),this},addVertexToHull:function(e){var t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var e;for(this.computeInitialHull();void 0!==(e=this.nextVertexToAdd());)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(Face,{create:function(e,t,i){var r=new Face,n=new HalfEdge(e,r),o=new HalfEdge(t,r),a=new HalfEdge(i,r);return n.next=a.prev=o,o.next=n.prev=a,a.next=o.prev=n,r.edge=n,r.compute()}}),Object.assign(Face.prototype,{getEdge:function(e){for(var t=this.edge;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t},compute:function(){void 0===triangle&&(triangle=new Triangle);var e=this.edge.tail(),t=this.edge.head(),i=this.edge.next.head();return triangle.set(e.point,t.point,i.point),triangle.getNormal(this.normal),triangle.getMidpoint(this.midpoint),this.area=triangle.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(e){return this.normal.dot(e)-this.constant}}),Object.assign(HalfEdge.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceTo(e.point):-1},lengthSquared:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceToSquared(e.point):-1},setTwin:function(e){return this.twin=e,e.twin=this,this}}),Object.assign(VertexList.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(e,t){return t.prev=e.prev,t.next=e,null===t.prev?this.head=t:t.prev.next=t,e.prev=t,this},insertAfter:function(e,t){return t.prev=e,t.next=e.next,null===t.next?this.tail=t:t.next.prev=t,e.next=t,this},append:function(e){return null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this},appendChain:function(e){for(null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail;null!==e.next;)e=e.next;return this.tail=e,this},remove:function(e){return null===e.prev?this.head=e.next:e.prev.next=e.next,null===e.next?this.tail=e.prev:e.next.prev=e.prev,this},removeSubList:function(e,t){return null===e.prev?this.head=t.next:e.prev.next=t.next,null===t.next?this.tail=e.prev:t.next.prev=e.prev,this},isEmpty:function(){return null===this.head}}),ConvexGeometry.prototype=Object.create(Geometry.prototype),ConvexGeometry.prototype.constructor=ConvexGeometry,ConvexBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ConvexBufferGeometry.prototype.constructor=ConvexBufferGeometry;var ConvexObjectBreaker=function(e,t){this.minSizeForBreak=e||1.4,this.smallDelta=t||1e-4,this.tempLine1=new Line3,this.tempPlane1=new Plane,this.tempPlane2=new Plane,this.tempPlane_Cut=new Plane,this.tempCM1=new Vector3,this.tempCM2=new Vector3,this.tempVector3=new Vector3,this.tempVector3_2=new Vector3,this.tempVector3_3=new Vector3,this.tempVector3_P0=new Vector3,this.tempVector3_P1=new Vector3,this.tempVector3_P2=new Vector3,this.tempVector3_N0=new Vector3,this.tempVector3_N1=new Vector3,this.tempVector3_AB=new Vector3,this.tempVector3_CB=new Vector3,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(var i=0;i<900;i++)this.segments[i]=!1};function Curve(){this.type="Curve",this.arcLengthDivisions=200}function GrannyKnot(){Curve.call(this)}function HeartCurve(e){Curve.call(this),this.scale=void 0===e?5:e}function VivianiCurve(e){Curve.call(this),this.scale=void 0===e?70:e}function KnotCurve(){Curve.call(this)}function HelixCurve(){Curve.call(this)}function TrefoilKnot(e){Curve.call(this),this.scale=void 0===e?10:e}function TorusKnot(e){Curve.call(this),this.scale=void 0===e?10:e}function CinquefoilKnot(e){Curve.call(this),this.scale=void 0===e?10:e}function TrefoilPolynomialKnot(e){Curve.call(this),this.scale=void 0===e?10:e}ConvexObjectBreaker.prototype={constructor:ConvexObjectBreaker,prepareBreakableObject:function(e,t,i,r,n){e.geometry.isBufferGeometry||console.error("ConvexObjectBreaker.prepareBreakableObject(): Parameter object must have a BufferGeometry.");var o=e.userData;o.mass=t,o.velocity=i.clone(),o.angularVelocity=r.clone(),o.breakable=n},subdivideByImpact:function(e,t,i,r,n){var o=[],a=this.tempPlane1,s=this.tempPlane2;this.tempVector3.addVectors(t,i),a.setFromCoplanarPoints(t,e.position,this.tempVector3);var l=n+r,u=this;return function n(h,c,d,p){if(Math.random()<.05*p||p>l)o.push(h);else{var f=Math.PI;0===p?(s.normal.copy(a.normal),s.constant=a.constant):p<=r?(f=(d-c)*(.2+.6*Math.random())+c,u.tempVector3_2.copy(e.position).sub(t).applyAxisAngle(i,f).add(t),s.setFromCoplanarPoints(t,u.tempVector3,u.tempVector3_2)):(f=(.5*(1&p)+.2*(2-Math.random()))*Math.PI,u.tempVector3_2.copy(t).sub(h.position).applyAxisAngle(i,f).add(h.position),u.tempVector3_3.copy(i).add(h.position),s.setFromCoplanarPoints(h.position,u.tempVector3_3,u.tempVector3_2)),u.cutByPlane(h,s,u.tempResultObjects);var m=u.tempResultObjects.object1,v=u.tempResultObjects.object2;m&&n(m,c,f,p+1),v&&n(v,f,d,p+1)}}(e,0,2*Math.PI,0),o},cutByPlane:function(e,t,i){var r=e.geometry,n=r.attributes.position.array,o=r.attributes.normal.array,a=n.length/3,s=a/3,l=r.getIndex();function u(e,t){var i=3*e+t;return l?l[i]:i}l&&(s=(l=l.array).length/3);for(var h=[],c=[],d=this.smallDelta,p=a*a,f=0;f<p;f++)this.segments[f]=!1;var m=this.tempVector3_P0,v=this.tempVector3_P1,g=this.tempVector3_N0,y=this.tempVector3_N1;for(f=0;f<s-1;f++){var _=u(f,0),b=u(f,1),x=u(f,2);g.set(o[_],o[_]+1,o[_]+2);for(var w=f+1;w<s;w++){var S=u(w,0),M=u(w,1),T=u(w,2);y.set(o[S],o[S]+1,o[S]+2),1-g.dot(y)<d&&(_===S||_===M||_===T?b===S||b===M||b===T?(this.segments[_*a+b]=!0,this.segments[b*a+_]=!0):(this.segments[x*a+_]=!0,this.segments[_*a+x]=!0):b!==S&&b!==M&&b!==T||(this.segments[x*a+b]=!0,this.segments[b*a+x]=!0))}}var A=this.tempPlane_Cut;e.updateMatrix(),ConvexObjectBreaker.transformPlaneToLocalSpace(t,e.matrix,A);for(f=0;f<s;f++)for(var C=u(f,0),L=u(f,1),N=u(f,2),P=0;P<3;P++){var k=0===P?C:1===P?L:N,E=0===P?L:1===P?N:C;if(!this.segments[k*a+E]){this.segments[k*a+E]=!0,this.segments[E*a+k]=!0,m.set(n[3*k],n[3*k+1],n[3*k+2]),v.set(n[3*E],n[3*E+1],n[3*E+2]);var D=0;(O=A.distanceToPoint(m))>d?(D=2,c.push(m.clone())):O<-d?(D=1,h.push(m.clone())):(D=3,h.push(m.clone()),c.push(m.clone()));var O,R=0;if((O=A.distanceToPoint(v))>d?(R=2,c.push(v.clone())):O<-d?(R=1,h.push(v.clone())):(R=3,h.push(v.clone()),c.push(v.clone())),1===D&&2===R||2===D&&1===R){this.tempLine1.start.copy(m),this.tempLine1.end.copy(v);var F=new Vector3;if(void 0===(F=A.intersectLine(this.tempLine1,F)))return console.error("Internal error: segment does not intersect plane."),i.segmentedObject1=null,i.segmentedObject2=null,0;h.push(F),c.push(F.clone())}}}var I=.5*e.userData.mass;this.tempCM1.set(0,0,0);var B=0,U=h.length;if(U>0){for(f=0;f<U;f++)this.tempCM1.add(h[f]);this.tempCM1.divideScalar(U);for(f=0;f<U;f++){(G=h[f]).sub(this.tempCM1),B=Math.max(B,G.x,G.y,G.z)}this.tempCM1.add(e.position)}this.tempCM2.set(0,0,0);var V=0,z=c.length;if(z>0){for(f=0;f<z;f++)this.tempCM2.add(c[f]);this.tempCM2.divideScalar(z);for(f=0;f<z;f++){var G;(G=c[f]).sub(this.tempCM2),V=Math.max(V,G.x,G.y,G.z)}this.tempCM2.add(e.position)}var j=null,W=null,H=0;return U>4&&((j=new Mesh(new ConvexBufferGeometry(h),e.material)).position.copy(this.tempCM1),j.quaternion.copy(e.quaternion),this.prepareBreakableObject(j,I,e.userData.velocity,e.userData.angularVelocity,2*B>this.minSizeForBreak),H++),z>4&&((W=new Mesh(new ConvexBufferGeometry(c),e.material)).position.copy(this.tempCM2),W.quaternion.copy(e.quaternion),this.prepareBreakableObject(W,I,e.userData.velocity,e.userData.angularVelocity,2*V>this.minSizeForBreak),H++),i.object1=j,i.object2=W,H}},ConvexObjectBreaker.transformFreeVector=function(e,t){var i=e.x,r=e.y,n=e.z,o=t.elements;return e.x=o[0]*i+o[4]*r+o[8]*n,e.y=o[1]*i+o[5]*r+o[9]*n,e.z=o[2]*i+o[6]*r+o[10]*n,e},ConvexObjectBreaker.transformFreeVectorInverse=function(e,t){var i=e.x,r=e.y,n=e.z,o=t.elements;return e.x=o[0]*i+o[1]*r+o[2]*n,e.y=o[4]*i+o[5]*r+o[6]*n,e.z=o[8]*i+o[9]*r+o[10]*n,e},ConvexObjectBreaker.transformTiedVectorInverse=function(e,t){var i=e.x,r=e.y,n=e.z,o=t.elements;return e.x=o[0]*i+o[1]*r+o[2]*n-o[12],e.y=o[4]*i+o[5]*r+o[6]*n-o[13],e.z=o[8]*i+o[9]*r+o[10]*n-o[14],e},ConvexObjectBreaker.transformPlaneToLocalSpace=function(){var e=new Vector3;return function(t,i,r){r.normal.copy(t.normal),r.constant=t.constant;var n=ConvexObjectBreaker.transformTiedVectorInverse(t.coplanarPoint(e),i);ConvexObjectBreaker.transformFreeVectorInverse(r.normal,i),r.constant=-n.dot(r.normal)}}(),Object.assign(Curve.prototype,{getPoint:function(){return console.warn("Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var i=this.getUtoTmapping(e);return this.getPoint(i,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,r=[],n=this.getPoint(0),o=0;for(r.push(0),i=1;i<=e;i++)o+=(t=this.getPoint(i/e)).distanceTo(n),r.push(o),n=t;return this.cacheArcLengths=r,r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var i,r=this.getLengths(),n=0,o=r.length;i=t||e*r[o-1];for(var a,s=0,l=o-1;s<=l;)if((a=r[n=Math.floor(s+(l-s)/2)]-i)<0)s=n+1;else{if(!(a>0)){l=n;break}l=n-1}if(r[n=l]===i)return n/(o-1);var u=r[n];return(n+(i-u)/(r[n+1]-u))/(o-1)},getTangent:function(e){var t=e-1e-4,i=e+1e-4;t<0&&(t=0),i>1&&(i=1);var r=this.getPoint(t);return this.getPoint(i).clone().sub(r).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var i,r,n,o=new Vector3,a=[],s=[],l=[],u=new Vector3,h=new Matrix4;for(i=0;i<=e;i++)r=i/e,a[i]=this.getTangentAt(r),a[i].normalize();s[0]=new Vector3,l[0]=new Vector3;var c=Number.MAX_VALUE,d=Math.abs(a[0].x),p=Math.abs(a[0].y),f=Math.abs(a[0].z);for(d<=c&&(c=d,o.set(1,0,0)),p<=c&&(c=p,o.set(0,1,0)),f<=c&&o.set(0,0,1),u.crossVectors(a[0],o).normalize(),s[0].crossVectors(a[0],u),l[0].crossVectors(a[0],s[0]),i=1;i<=e;i++)s[i]=s[i-1].clone(),l[i]=l[i-1].clone(),u.crossVectors(a[i-1],a[i]),u.length()>Number.EPSILON&&(u.normalize(),n=Math.acos(_Math.clamp(a[i-1].dot(a[i]),-1,1)),s[i].applyMatrix4(h.makeRotationAxis(u,n))),l[i].crossVectors(a[i],s[i]);if(!0===t)for(n=Math.acos(_Math.clamp(s[0].dot(s[e]),-1,1)),n/=e,a[0].dot(u.crossVectors(s[0],s[e]))>0&&(n=-n),i=1;i<=e;i++)s[i].applyMatrix4(h.makeRotationAxis(a[i],n*i)),l[i].crossVectors(a[i],s[i]);return{tangents:a,normals:s,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),GrannyKnot.prototype=Object.create(Curve.prototype),GrannyKnot.prototype.constructor=GrannyKnot,GrannyKnot.prototype.getPoint=function(e,t){var i=t||new Vector3;e=2*Math.PI*e;var r=-.22*Math.cos(e)-1.28*Math.sin(e)-.44*Math.cos(3*e)-.78*Math.sin(3*e),n=-.1*Math.cos(2*e)-.27*Math.sin(2*e)+.38*Math.cos(4*e)+.46*Math.sin(4*e),o=.7*Math.cos(3*e)-.4*Math.sin(3*e);return i.set(r,n,o).multiplyScalar(20)},HeartCurve.prototype=Object.create(Curve.prototype),HeartCurve.prototype.constructor=HeartCurve,HeartCurve.prototype.getPoint=function(e,t){var i=t||new Vector3;e*=2*Math.PI;var r=16*Math.pow(Math.sin(e),3),n=13*Math.cos(e)-5*Math.cos(2*e)-2*Math.cos(3*e)-Math.cos(4*e);return i.set(r,n,0).multiplyScalar(this.scale)},VivianiCurve.prototype=Object.create(Curve.prototype),VivianiCurve.prototype.constructor=VivianiCurve,VivianiCurve.prototype.getPoint=function(e,t){var i=t||new Vector3;e=4*e*Math.PI;var r=this.scale/2,n=r*(1+Math.cos(e)),o=r*Math.sin(e),a=2*r*Math.sin(e/2);return i.set(n,o,a)},KnotCurve.prototype=Object.create(Curve.prototype),KnotCurve.prototype.constructor=KnotCurve,KnotCurve.prototype.getPoint=function(e,t){var i=t||new Vector3;e*=2*Math.PI;var r=50*Math.sin(e),n=Math.cos(e)*(10+50*Math.cos(e)),o=Math.sin(e)*(10+50*Math.cos(e));return i.set(r,n,o)},HelixCurve.prototype=Object.create(Curve.prototype),HelixCurve.prototype.constructor=HelixCurve,HelixCurve.prototype.getPoint=function(e,t){var i=t||new Vector3,r=2*Math.PI*e*150/30,n=30*Math.cos(r),o=30*Math.sin(r),a=150*e;return i.set(n,o,a)},TrefoilKnot.prototype=Object.create(Curve.prototype),TrefoilKnot.prototype.constructor=TrefoilKnot,TrefoilKnot.prototype.getPoint=function(e,t){var i=t||new Vector3;e*=2*Math.PI;var r=(2+Math.cos(3*e))*Math.cos(2*e),n=(2+Math.cos(3*e))*Math.sin(2*e),o=Math.sin(3*e);return i.set(r,n,o).multiplyScalar(this.scale)},TorusKnot.prototype=Object.create(Curve.prototype),TorusKnot.prototype.constructor=TorusKnot,TorusKnot.prototype.getPoint=function(e,t){var i=t||new Vector3;e*=2*Math.PI;var r=(2+Math.cos(4*e))*Math.cos(3*e),n=(2+Math.cos(4*e))*Math.sin(3*e),o=Math.sin(4*e);return i.set(r,n,o).multiplyScalar(this.scale)},CinquefoilKnot.prototype=Object.create(Curve.prototype),CinquefoilKnot.prototype.constructor=CinquefoilKnot,CinquefoilKnot.prototype.getPoint=function(e,t){var i=t||new Vector3;e*=2*Math.PI;var r=(2+Math.cos(5*e))*Math.cos(2*e),n=(2+Math.cos(5*e))*Math.sin(2*e),o=Math.sin(5*e);return i.set(r,n,o).multiplyScalar(this.scale)},TrefoilPolynomialKnot.prototype=Object.create(Curve.prototype),TrefoilPolynomialKnot.prototype.constructor=TrefoilPolynomialKnot,TrefoilPolynomialKnot.prototype.getPoint=function(e,t){var i=t||new Vector3;e=4*e-2;var r=Math.pow(e,3)-3*e,n=Math.pow(e,4)-4*e*e,o=.2*Math.pow(e,5)-2*e;return i.set(r,n,o).multiplyScalar(this.scale)};var scaleTo=function(e,t,i){return i*(t-e)+e};function FigureEightPolynomialKnot(e){Curve.call(this),this.scale=void 0===e?1:e}function DecoratedTorusKnot4a(e){Curve.call(this),this.scale=void 0===e?40:e}function DecoratedTorusKnot4b(e){Curve.call(this),this.scale=void 0===e?40:e}function DecoratedTorusKnot5a(e){Curve.call(this),this.scale=void 0===e?40:e}function DecoratedTorusKnot5c(e){Curve.call(this),this.scale=void 0===e?40:e}FigureEightPolynomialKnot.prototype=Object.create(Curve.prototype),FigureEightPolynomialKnot.prototype.constructor=FigureEightPolynomialKnot,FigureEightPolynomialKnot.prototype.getPoint=function(e,t){var i=t||new Vector3,r=.4*(e=scaleTo(-4,4,e))*(e*e-7)*(e*e-10),n=Math.pow(e,4)-13*e*e,o=.1*e*(e*e-4)*(e*e-9)*(e*e-12);return i.set(r,n,o).multiplyScalar(this.scale)},DecoratedTorusKnot4a.prototype=Object.create(Curve.prototype),DecoratedTorusKnot4a.prototype.constructor=DecoratedTorusKnot4a,DecoratedTorusKnot4a.prototype.getPoint=function(e,t){var i=t||new Vector3;e*=2*Math.PI;var r=Math.cos(2*e)*(1+.6*(Math.cos(5*e)+.75*Math.cos(10*e))),n=Math.sin(2*e)*(1+.6*(Math.cos(5*e)+.75*Math.cos(10*e))),o=.35*Math.sin(5*e);return i.set(r,n,o).multiplyScalar(this.scale)},DecoratedTorusKnot4b.prototype=Object.create(Curve.prototype),DecoratedTorusKnot4b.prototype.constructor=DecoratedTorusKnot4b,DecoratedTorusKnot4b.prototype.getPoint=function(e,t){var i=t||new Vector3,r=e*Math.PI*2,n=Math.cos(2*r)*(1+.45*Math.cos(3*r)+.4*Math.cos(9*r)),o=Math.sin(2*r)*(1+.45*Math.cos(3*r)+.4*Math.cos(9*r)),a=.2*Math.sin(9*r);return i.set(n,o,a).multiplyScalar(this.scale)},DecoratedTorusKnot5a.prototype=Object.create(Curve.prototype),DecoratedTorusKnot5a.prototype.constructor=DecoratedTorusKnot5a,DecoratedTorusKnot5a.prototype.getPoint=function(e,t){var i=t||new Vector3,r=e*Math.PI*2,n=Math.cos(3*r)*(1+.3*Math.cos(5*r)+.5*Math.cos(10*r)),o=Math.sin(3*r)*(1+.3*Math.cos(5*r)+.5*Math.cos(10*r)),a=.2*Math.sin(20*r);return i.set(n,o,a).multiplyScalar(this.scale)},DecoratedTorusKnot5c.prototype=Object.create(Curve.prototype),DecoratedTorusKnot5c.prototype.constructor=DecoratedTorusKnot5c,DecoratedTorusKnot5c.prototype.getPoint=function(e,t){var i=t||new Vector3,r=e*Math.PI*2,n=Math.cos(4*r)*(1+.5*(Math.cos(5*r)+.4*Math.cos(20*r))),o=Math.sin(4*r)*(1+.5*(Math.cos(5*r)+.4*Math.cos(20*r))),a=.35*Math.sin(15*r);return i.set(n,o,a).multiplyScalar(this.scale)};var NURBSUtils={findSpan:function(e,t,i){var r=i.length-e-1;if(t>=i[r])return r-1;if(t<=i[e])return e;for(var n=e,o=r,a=Math.floor((n+o)/2);t<i[a]||t>=i[a+1];)t<i[a]?o=a:n=a,a=Math.floor((n+o)/2);return a},calcBasisFunctions:function(e,t,i,r){var n=[],o=[],a=[];n[0]=1;for(var s=1;s<=i;++s){o[s]=t-r[e+1-s],a[s]=r[e+s]-t;for(var l=0,u=0;u<s;++u){var h=a[u+1],c=o[s-u],d=n[u]/(h+c);n[u]=l+h*d,l=c*d}n[s]=l}return n},calcBSplinePoint:function(e,t,i,r){for(var n=this.findSpan(e,r,t),o=this.calcBasisFunctions(n,r,e,t),a=new Vector4(0,0,0,0),s=0;s<=e;++s){var l=i[n-e+s],u=o[s],h=l.w*u;a.x+=l.x*h,a.y+=l.y*h,a.z+=l.z*h,a.w+=l.w*u}return a},calcBasisFunctionDerivatives:function(e,t,i,r,n){for(var o=[],a=0;a<=i;++a)o[a]=0;var s=[];for(a=0;a<=r;++a)s[a]=o.slice(0);var l=[];for(a=0;a<=i;++a)l[a]=o.slice(0);l[0][0]=1;for(var u=o.slice(0),h=o.slice(0),c=1;c<=i;++c){u[c]=t-n[e+1-c],h[c]=n[e+c]-t;for(var d=0,p=0;p<c;++p){var f=h[p+1],m=u[c-p];l[c][p]=f+m;var v=l[p][c-1]/l[c][p];l[p][c]=d+f*v,d=m*v}l[c][c]=d}for(c=0;c<=i;++c)s[0][c]=l[c][i];for(p=0;p<=i;++p){var g=0,y=1,_=[];for(a=0;a<=i;++a)_[a]=o.slice(0);_[0][0]=1;for(var b=1;b<=r;++b){var x=0,w=p-b,S=i-b;p>=b&&(_[y][0]=_[g][0]/l[S+1][w],x=_[y][0]*l[w][S]);var M=p-1<=S?b-1:i-p;for(c=w>=-1?1:-w;c<=M;++c)_[y][c]=(_[g][c]-_[g][c-1])/l[S+1][w+c],x+=_[y][c]*l[w+c][S];p<=S&&(_[y][b]=-_[g][b-1]/l[S+1][p],x+=_[y][b]*l[p][S]),s[b][p]=x;c=g;g=y,y=c}}for(p=i,b=1;b<=r;++b){for(c=0;c<=i;++c)s[b][c]*=p;p*=i-b}return s},calcBSplineDerivatives:function(e,t,i,r,n){for(var o=n<e?n:e,a=[],s=this.findSpan(e,r,t),l=this.calcBasisFunctionDerivatives(s,r,e,o,t),u=[],h=0;h<i.length;++h){var c=(p=i[h].clone()).w;p.x*=c,p.y*=c,p.z*=c,u[h]=p}for(var d=0;d<=o;++d){for(var p=u[s-e].clone().multiplyScalar(l[d][0]),f=1;f<=e;++f)p.add(u[s-e+f].clone().multiplyScalar(l[d][f]));a[d]=p}for(d=o+1;d<=n+1;++d)a[d]=new Vector4(0,0,0);return a},calcKoverI:function(e,t){for(var i=1,r=2;r<=e;++r)i*=r;var n=1;for(r=2;r<=t;++r)n*=r;for(r=2;r<=e-t;++r)n*=r;return i/n},calcRationalCurveDerivatives:function(e){for(var t=e.length,i=[],r=[],n=0;n<t;++n){var o=e[n];i[n]=new Vector3(o.x,o.y,o.z),r[n]=o.w}for(var a=[],s=0;s<t;++s){var l=i[s].clone();for(n=1;n<=s;++n)l.sub(a[s-n].clone().multiplyScalar(this.calcKoverI(s,n)*r[n]));a[s]=l.divideScalar(r[0])}return a},calcNURBSDerivatives:function(e,t,i,r,n){var o=this.calcBSplineDerivatives(e,t,i,r,n);return this.calcRationalCurveDerivatives(o)},calcSurfacePoint:function(e,t,i,r,n,o,a,s){for(var l=this.findSpan(e,o,i),u=this.findSpan(t,a,r),h=this.calcBasisFunctions(l,o,e,i),c=this.calcBasisFunctions(u,a,t,r),d=[],p=0;p<=t;++p){d[p]=new Vector4(0,0,0,0);for(var f=0;f<=e;++f){var m=n[l-e+f][u-t+p].clone(),v=m.w;m.x*=v,m.y*=v,m.z*=v,d[p].add(m.multiplyScalar(h[f]))}}var g=new Vector4(0,0,0,0);for(p=0;p<=t;++p)g.add(d[p].multiplyScalar(c[p]));g.divideScalar(g.w),s.set(g.x,g.y,g.z)}},NURBSCurve=function(e,t,i,r,n){Curve.call(this),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=n||this.knots.length-1;for(var o=0;o<i.length;++o){var a=i[o];this.controlPoints[o]=new Vector4(a.x,a.y,a.z,a.w)}};NURBSCurve.prototype=Object.create(Curve.prototype),NURBSCurve.prototype.constructor=NURBSCurve,NURBSCurve.prototype.getPoint=function(e){var t=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),i=NURBSUtils.calcBSplinePoint(this.degree,this.knots,this.controlPoints,t);return 1!=i.w&&i.divideScalar(i.w),new Vector3(i.x,i.y,i.z)},NURBSCurve.prototype.getTangent=function(e){var t=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),i=NURBSUtils.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,t,1)[1].clone();return i.normalize(),i};var NURBSSurface=function(e,t,i,r,n){this.degree1=e,this.degree2=t,this.knots1=i,this.knots2=r,this.controlPoints=[];for(var o=i.length-e-1,a=r.length-t-1,s=0;s<o;++s){this.controlPoints[s]=[];for(var l=0;l<a;++l){var u=n[s][l];this.controlPoints[s][l]=new Vector4(u.x,u.y,u.z,u.w)}}},instance,focus,fov,aspect,near,far,zoom,eyeSep,eyeRight,eyeLeft;function StereoCamera(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}NURBSSurface.prototype={constructor:NURBSSurface,getPoint:function(e,t,i){var r=this.knots1[0]+e*(this.knots1[this.knots1.length-1]-this.knots1[0]),n=this.knots2[0]+t*(this.knots2[this.knots2.length-1]-this.knots2[0]);NURBSUtils.calcSurfacePoint(this.degree1,this.degree2,this.knots1,this.knots2,this.controlPoints,r,n,i)}},Object.assign(StereoCamera.prototype,{update:(eyeRight=new Matrix4,eyeLeft=new Matrix4,function(e){if(instance!==this||focus!==e.focus||fov!==e.fov||aspect!==e.aspect*this.aspect||near!==e.near||far!==e.far||zoom!==e.zoom||eyeSep!==this.eyeSep){instance=this,focus=e.focus,fov=e.fov,aspect=e.aspect*this.aspect,near=e.near,far=e.far,zoom=e.zoom;var t,i,r=e.projectionMatrix.clone(),n=(eyeSep=this.eyeSep/2)*near/focus,o=near*Math.tan(_Math.DEG2RAD*fov*.5)/zoom;eyeLeft.elements[12]=-eyeSep,eyeRight.elements[12]=eyeSep,t=-o*aspect+n,i=o*aspect+n,r.elements[0]=2*near/(i-t),r.elements[8]=(i+t)/(i-t),this.cameraL.projectionMatrix.copy(r),t=-o*aspect-n,i=o*aspect-n,r.elements[0]=2*near/(i-t),r.elements[8]=(i+t)/(i-t),this.cameraR.projectionMatrix.copy(r)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(eyeLeft),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(eyeRight)})});var AnaglyphEffect=function(e,t,i){this.colorMatrixLeft=(new Matrix3).fromArray([1.0671679973602295,-.0016435992438346148,.0001777536963345483,-.028107794001698494,-.00019593400065787137,-.0002875397040043026,-.04279090091586113,15809757314855233e-21,-.00024287120322696865]),this.colorMatrixRight=(new Matrix3).fromArray([-.0355340838432312,-.06440307199954987,.018319187685847282,-.10269022732973099,.8079727292060852,-.04835830628871918,.0001224992738571018,-.009558862075209618,.567823588848114]);var r=new OrthographicCamera(-1,1,1,-1,0,1),n=new Scene,o=new StereoCamera,a={minFilter:LinearFilter,magFilter:NearestFilter,format:RGBAFormat};void 0===t&&(t=512),void 0===i&&(i=512);var s=new WebGLRenderTarget(t,i,a),l=new WebGLRenderTarget(t,i,a),u=new ShaderMaterial({uniforms:{mapLeft:{value:s.texture},mapRight:{value:l.texture},colorMatrixLeft:{value:this.colorMatrixLeft},colorMatrixRight:{value:this.colorMatrixRight}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","uniform mat3 colorMatrixLeft;","uniform mat3 colorMatrixRight;","float lin( float c ) {","\treturn c <= 0.04045 ? c * 0.0773993808 :","\t\t\tpow( c * 0.9478672986 + 0.0521327014, 2.4 );","}","vec4 lin( vec4 c ) {","\treturn vec4( lin( c.r ), lin( c.g ), lin( c.b ), c.a );","}","float dev( float c ) {","\treturn c <= 0.0031308 ? c * 12.92","\t\t\t: pow( c, 0.41666 ) * 1.055 - 0.055;","}","void main() {","\tvec2 uv = vUv;","\tvec4 colorL = lin( texture2D( mapLeft, uv ) );","\tvec4 colorR = lin( texture2D( mapRight, uv ) );","\tvec3 color = clamp(","\t\t\tcolorMatrixLeft * colorL.rgb +","\t\t\tcolorMatrixRight * colorR.rgb, 0., 1. );","\tgl_FragColor = vec4(","\t\t\tdev( color.r ), dev( color.g ), dev( color.b ),","\t\t\tmax( colorL.a, colorR.a ) );","}"].join("\n")}),h=new Mesh(new PlaneBufferGeometry(2,2),u);n.add(h),this.setSize=function(t,i){e.setSize(t,i);var r=e.getPixelRatio();s.setSize(t*r,i*r),l.setSize(t*r,i*r)},this.render=function(t,i){var a=e.getRenderTarget();t.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld(),o.update(i),e.setRenderTarget(s),e.clear(),e.render(t,o.cameraL),e.setRenderTarget(l),e.clear(),e.render(t,o.cameraR),e.setRenderTarget(null),e.render(n,r),e.setRenderTarget(a)},this.dispose=function(){s&&s.dispose(),l&&l.dispose(),h&&h.geometry.dispose(),u&&u.dispose()}},AsciiEffect=function(e,t,i){t=void 0===t?" .:-=+*#%@":t,i||(i={});var r,n,o=i.resolution?i.resolution:.15,a=i.scale?i.scale:1,s=!!i.color&&i.color,l=!!i.alpha&&i.alpha,u=!!i.block&&i.block,h=!!i.invert&&i.invert,c=document.createElement("div");c.style.cursor="default";var d,p,f,m=document.createElement("table");c.appendChild(m),this.setSize=function(t,i){r=t,n=i,e.setSize(t,i),function(){d=Math.round(r*S),p=Math.round(n*S),b.width=d,b.height=p,(f=e.domElement).style.backgroundColor&&(m.rows[0].cells[0].style.backgroundColor=f.style.backgroundColor,m.rows[0].cells[0].style.color=f.style.color);m.cellSpacing=0,m.cellPadding=0;var t=m.style;t.display="inline",t.width=Math.round(d/S*a)+"px",t.height=Math.round(p/S*a)+"px",t.whiteSpace="pre",t.margin="0px",t.padding="0px",t.letterSpacing=A+"px",t.fontFamily=y,t.fontSize=M+"px",t.lineHeight=T+"px",t.textAlign="left",t.textDecoration="none"}()},this.render=function(t,i){e.render(t,i),function(e,t){x.clearRect(0,0,d,p),x.drawImage(_,0,0,d,p);for(var i=x.getImageData(0,0,d,p).data,r="",n=0;n<p;n+=2){for(var o=0;o<d;o++){var a,c,f=4*(n*d+o),m=i[f],v=i[f+1],g=i[f+2],y=i[f+3];c=(.3*m+.59*v+.11*g)/255,0==y&&(c=1),a=Math.floor((1-c)*(w.length-1)),h&&(a=w.length-a-1);var b=w[a];void 0!==b&&" "!=b||(b="&nbsp;"),r+=s?"<span style='color:rgb("+m+","+v+","+g+");"+(u?"background-color:rgb("+m+","+v+","+g+");":"")+(l?"opacity:"+y/255+";":"")+"'>"+b+"</span>":b}r+="<br/>"}t.innerHTML="<tr><td>"+r+"</td></tr>"}(0,m)},this.domElement=c;var v=" .,:;i1tfLCG08@".split(""),g=" CGO08@".split(""),y="courier new, monospace",_=e.domElement,b=document.createElement("canvas");if(b.getContext){var x=b.getContext("2d");if(x.getImageData){var w=s?g:v;t&&(w=t);var S=.5;S=.25,o&&(S=o);var M=2/S*a,T=2/S*a,A=0;switch(a){case 1:A=-1;break;case 2:case 3:A=-2.1;break;case 4:A=-3.1;break;case 5:A=-4.15}}}},alphamap_fragment="\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",alphamap_pars_fragment="\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",alphatest_fragment="\n#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",aomap_fragment="\n#ifdef USE_AOMAP\n\n\t// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\n\t#endif\n\n#endif\n",aomap_pars_fragment="\n#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\n#endif\n",begin_vertex="\nvec3 transformed = vec3( position );\n",beginnormal_vertex="\nvec3 objectNormal = vec3( normal );\n\n#ifdef USE_TANGENT\n\n\tvec3 objectTangent = vec3( tangent.xyz );\n\n#endif\n",bsdfs='\n\n// Analytical approximation of the DFG LUT, one half of the\n// split-sum approximation used in indirect specular lighting.\n// via \'environmentBRDF\' from "Physically Based Shading on Mobile"\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\n\tvec4 r = roughness * c0 + c1;\n\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n\n}\n\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\n\t// based upon Frostbite 3 Moving to Physically-based Rendering\n\t// page 32, equation 26: E[window1]\n\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\n\t// this is intended to be used on spot and point lights who are represented as luminous intensity\n\t// but who must be converted to luminous irradiance for surface lighting calculation\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\n\tif( cutoffDistance > 0.0 ) {\n\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\n\t}\n\n\treturn distanceFalloff;\n\n#else\n\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n\t}\n\n\treturn 1.0;\n\n#endif\n\n}\n\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\n\treturn RECIPROCAL_PI * diffuseColor;\n\n} // validated\n\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\n\t// Original approximation by Christophe Schlick \'94\n\t// float fresnel = pow( 1.0 - dotLH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH \'13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n\n} // validated\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (34)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disney’s reparameterization\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\t// geometry term (normalized) = G(l)⋅G(v) / 4(n⋅l)(n⋅v)\n\t// also see #12151\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\n\treturn 1.0 / ( gl * gv );\n\n} // validated\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\tfloat a2 = pow2( alpha );\n\n\t// dotNL and dotNV are explicitly swapped. This is not a mistake.\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\n\treturn 0.5 / max( gv + gl, EPSILON );\n\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disney’s reparameterization\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1\n\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n\n}\n\n// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat alpha = pow2( roughness ); // UE4\'s roughness\n\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\tfloat D = D_GGX( alpha, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// Rect Area Light\n\n// Real-Time Polygonal-Light Shading with Linearly Transformed Cosines\n// by Eric Heitz, Jonathan Dupuy, Stephen Hill and David Neubelt\n// code: https://github.com/selfshadow/ltc_code/\n\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\n\tfloat dotNV = saturate( dot( N, V ) );\n\n\t// texture parameterized by sqrt( GGX alpha ) and sqrt( 1 - cos( theta ) )\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\treturn uv;\n\n}\n\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\n\t// Real-Time Area Lighting: a Journey from Research to Production (p.102)\n\t// An approximation of the form factor of a horizon-clipped rectangle.\n\n\tfloat l = length( f );\n\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n\n}\n\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\n\tfloat x = dot( v1, v2 );\n\n\tfloat y = abs( x );\n\n\t// rational polynomial approximation to theta / sin( theta ) / 2PI\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\n\treturn cross( v1, v2 ) * theta_sintheta;\n\n}\n\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\n\t// bail if point is on back side of plane of light\n\t// assumes ccw winding order of light vertices\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\n\t// construct orthonormal basis around N\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 ); // negated from paper; possibly due to a different handedness of world coordinate system\n\n\t// compute transform\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\n\t// transform rect\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\n\t// project rect onto sphere\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\n\t// calculate vector form factor\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\n\t// adjust for horizon clipping\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n\n}\n\n// End Rect Area Light\n\n// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\n\treturn specularColor * brdf.x + brdf.y;\n\n} // validated\n\n// Fdez-Agüera\'s "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"\n// Approximates multiscattering in order to preserve energy.\n// http://www.jcgt.org/published/0008/01/03/\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotNV );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\n\t// Paper incorrect indicates coefficient is PI/21, and will\n\t// be corrected to 1/21 in future updates.\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619; // 1/21\n\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n\n}\n\nfloat G_BlinnPhong_Implicit(  ) {\n\n\t// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\n\treturn 0.25;\n\n}\n\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\n\t//float dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\t//float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_BlinnPhong_Implicit(  );\n\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// source: http://simonstechblog.blogspot.ca/2011/12/microfacet-brdf.html\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\n\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n',bumpmap_pars_fragment="\n#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n\t// http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",clipping_planes_fragment="\n#if NUM_CLIPPING_PLANES > 0\n\n\tvec4 plane;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\n\t}\n\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\n\t\tbool clipped = true;\n\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\n\t\t}\n\n\t\tif ( clipped ) discard;\n\n\t#endif\n\n#endif\n",clipping_planes_pars_fragment="\n#if NUM_CLIPPING_PLANES > 0\n\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n\n#endif\n",clipping_planes_pars_vertex="\n#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex="\n#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment="\n#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif\n",color_pars_fragment="\n#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",color_pars_vertex="\n#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",color_vertex="\n#ifdef USE_COLOR\n\n\tvColor.xyz = color.xyz;\n\n#endif\n",common="\n#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\n\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\n\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n}\n\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\n\treturn - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nmat3 transposeMat3( const in mat3 m ) {\n\n\tmat3 tmp;\n\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\n\treturn tmp;\n\n}\n\n// https://en.wikipedia.org/wiki/Relative_luminance\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\n\treturn dot( weights, color.rgb );\n\n}\n",cube_uv_reflection_fragment="\n#ifdef ENVMAP_TYPE_CUBE_UV\n\n#define cubeUV_textureSize (1024.0)\n\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\n\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\t// Clamp the value to the max mip level counts. hard coded to 6 mips\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\n\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\t// float powScale = exp2(roughnessLevel + mipLevel);\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\t// float scale =  1.0 / exp2(roughnessLevel + 2.0 + mipLevel);\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\t// float mipOffset = 0.75*(1.0 - 1.0/exp2(mipLevel))/exp2(roughnessLevel);\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\n\tfloat rcpPowScale = 1.0 / powScale;\n\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\n\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\n\t// round to nearest mipmap if we are not interpolating.\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\n\t// Tri linear interpolation.\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\n\tvec4 result = mix(color10, color20, t);\n\n\treturn vec4(result.rgb, 1.0);\n}\n\n#endif\n",defaultnormal_vertex="\nvec3 transformedNormal = normalMatrix * objectNormal;\n\n#ifdef FLIP_SIDED\n\n\ttransformedNormal = - transformedNormal;\n\n#endif\n\n#ifdef USE_TANGENT\n\n\tvec3 transformedTangent = normalMatrix * objectTangent;\n\n\t#ifdef FLIP_SIDED\n\n\t\ttransformedTangent = - transformedTangent;\n\n\t#endif\n\n#endif\n",displacementmap_pars_vertex="\n#ifdef USE_DISPLACEMENTMAP\n\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n\n#endif\n",displacementmap_vertex="\n#ifdef USE_DISPLACEMENTMAP\n\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n\n#endif\n",emissivemap_fragment="\n#ifdef USE_EMISSIVEMAP\n\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n\n#endif\n",emissivemap_pars_fragment="\n#ifdef USE_EMISSIVEMAP\n\n\tuniform sampler2D emissiveMap;\n\n#endif\n",encodings_fragment="\ngl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment="\n// For a discussion of what this is, please read this: http://lousodrome.net/blog/light/2013/05/26/gamma-correct-and-hdr-rendering-in-a-32-bits-buffer/\n\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\n\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\n\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\n\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\n\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\n\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\n\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n//  return vec4( value.brg, ( 3.0 + 128.0 ) / 256.0 );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\n\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\n\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\n\n// LogLuv reference: http://graphicrants.blogspot.ca/2009/04/rgbm-color-encoding.html\n\n// M matrix, for encoding\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\n\n// Inverse M matrix, for decoding\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}\n",envmap_fragment="\n#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\n\t\tvec2 sampleUV;\n\n\t\treflectVec = normalize( reflectVec );\n\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\n\t\treflectVec = normalize( reflectVec );\n\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\n\t#else\n\n\t\tvec4 envColor = vec4( 0.0 );\n\n\t#endif\n\n\tenvColor = envMapTexelToLinear( envColor );\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",envmap_pars_fragment="\n#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n\n#ifdef USE_ENVMAP\n\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n\n#endif\n",envmap_pars_vertex="\n#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\n\t#endif\n\n#endif\n",envmap_vertex="\n#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvWorldPosition = worldPosition.xyz;\n\n\t#else\n\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n",fog_vertex="\n#ifdef USE_FOG\n\n\tfogDepth = -mvPosition.z;\n\n#endif\n",fog_pars_vertex="\n#ifdef USE_FOG\n\n\tvarying float fogDepth;\n\n#endif\n",fog_fragment="\n#ifdef USE_FOG\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\n\t#endif\n\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\n#endif\n",fog_pars_fragment="\n#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\n\t#endif\n\n#endif\n",gradientmap_pars_fragment="\n#ifdef TOON\n\n\tuniform sampler2D gradientMap;\n\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\n\t\t// dotNL will be from -1.0 to 1.0\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\n\t\t#ifdef USE_GRADIENTMAP\n\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\n\t\t#else\n\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\n\t\t#endif\n\t}\n\n#endif\n",lightmap_fragment="\n#ifdef USE_LIGHTMAP\n\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity; // factor of PI should not be present; included here to prevent breakage\n\n#endif\n",lightmap_pars_fragment="\n#ifdef USE_LIGHTMAP\n\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n\n#endif\n",lights_lambert_vertex="\nvec3 diffuse = vec3( 1.0 );\n\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\n\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\n\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\n\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n\n#if NUM_POINT_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if NUM_SPOT_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\t}\n\n#endif\n#if NUM_DIR_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if NUM_HEMI_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\n\t\t#endif\n\n\t}\n\n#endif\n",lights_pars_begin="\nuniform vec3 ambientLightColor;\n\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\n\tvec3 irradiance = ambientLightColor;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI;\n\n\t#endif\n\n\treturn irradiance;\n\n}\n\n#if NUM_DIR_LIGHTS > 0\n\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\n\t}\n\n#endif\n#if NUM_POINT_LIGHTS > 0\n\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\n\t}\n\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\n\t\tif ( angleCos > spotLight.coneCos ) {\n\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\n\t\t} else {\n\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\n\t\t}\n\t}\n\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\n\t// Pre-computed values of LinearTransformedCosine approximation of BRDF\n\t// BRDF approximation Texture is 64x64\n\tuniform sampler2D ltc_1; // RGBA Float\n\tuniform sampler2D ltc_2; // RGBA Float\n\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tirradiance *= PI;\n\n\t\t#endif\n\n\t\treturn irradiance;\n\n\t}\n\n#endif\n",envmap_physical_pars_fragment="\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\n\tvec3 getLightProbeIndirectIrradiance(  const in GeometricContext geometry, const in int maxMIPLevel ) {\n\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\n\t\t\t// TODO: replace with properly filtered cubemaps and access the irradiance LOD level, be it the last LOD level\n\t\t\t// of a specular cubemap, or just the default level of a specially created irradiance cubemap.\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#else\n\n\t\t\t\t// force the bias high to get the last LOD level as it is the most blurred.\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\n\t\t#else\n\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\n\t\t#endif\n\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\n\t}\n\n\t// taken from here: http://casual-effects.blogspot.ca/2011/08/plausible-environment-lighting-in-two.html\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\n\t\t//float envMapWidth = pow( 2.0, maxMIPLevelScalar );\n\t\t//float desiredMIPLevel = log2( envMapWidth * sqrt( 3.0 ) ) - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\n\t\t// clamp to allowable LOD ranges.\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\n\t}\n\n\tvec3 getLightProbeIndirectRadiance(  const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\n\t\t#endif\n\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#endif\n\n\t\treturn envMapColor.rgb * envMapIntensity;\n\n\t}\n\n#endif\n",lights_phong_fragment="\nBlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment="\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\nstruct BlinnPhongMaterial {\n\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n\n};\n\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\t#ifdef TOON\n\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\n\t#else\n\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\n\t#endif\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n\n}\n\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment="\nPhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat ); // Burley clearcoat model\n\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment="\nstruct PhysicalMaterial {\n\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n\n};\n\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\n\n// Clear coat directional hemishperical reflectance (this approximation should be improved)\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n\n}\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight; // counterclockwise; light shines in local neg z direction\n\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\n\t\t// LTC Fresnel Approximation by Stephen Hill\n\t\t// http://blog.selfshadow.com/publications/s2016-advances/s2016_ltc_fresnel.pdf\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\n\t}\n\n#endif\n\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n\t#ifndef STANDARD\n\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\n\t#endif\n\n}\n\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\t// Defer to the IndirectSpecular function to compute\n\t// the indirectDiffuse if energy preservation is enabled.\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\n\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n\t#endif\n\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\n\tfloat clearCoatInv = 1.0 - clearCoatDHR;\n\n\t// Both indirect specular and diffuse light accumulate here\n\t// if energy preservation enabled, and PMREM provided.\n\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tvec3 singleScattering = vec3( 0.0 );\n\t\tvec3 multiScattering = vec3( 0.0 );\n\t\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\n\t\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\n\t\t// The multiscattering paper uses the below formula for calculating diffuse \n\t\t// for dielectrics, but this is already handled when initially computing the \n\t\t// specular and diffuse color, so we can just use the diffuseColor directly.\n\t\t//vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\t\tvec3 diffuse = material.diffuseColor;\n\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * singleScattering;\n\t\treflectedLight.indirectDiffuse += multiScattering * cosineWeightedIrradiance;\n\t\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\n\t#else\n\n\t\treflectedLight.indirectSpecular += clearCoatInv * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\n\t#endif\n\n\t#ifndef STANDARD\n\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\n\t#endif\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\n\n// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n\n}\n",lights_fragment_begin="\nGeometricContext geometry;\n\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tPointLight pointLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tSpotLight spotLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tDirectionalLight directionalLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n\tRectAreaLight rectAreaLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n\t}\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t}\n\n\t#endif\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n\n#endif\n",lights_fragment_maps="\n#if defined( RE_IndirectDiffuse )\n\n\t#ifdef USE_LIGHTMAP\n\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tlightMapIrradiance *= PI; // factor of PI should not be present; included here to prevent breakage\n\n\t\t#endif\n\n\t\tirradiance += lightMapIrradiance;\n\n\t#endif\n\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tirradiance += getLightProbeIndirectIrradiance(  geometry, maxMipLevel );\n\n\t#endif\n\n#endif\n\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\n\tradiance += getLightProbeIndirectRadiance(  geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance(  geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n\n#endif\n",lights_fragment_end="\n#if defined( RE_IndirectDiffuse )\n\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tRE_IndirectSpecular( radiance, irradiance, clearCoatRadiance, geometry, material, reflectedLight );\n\n#endif\n",logdepthbuf_fragment="\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n\n#endif\n",logdepthbuf_pars_fragment="\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\n#endif\n",logdepthbuf_pars_vertex="\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#else\n\n\t\tuniform float logDepthBufFC;\n\n\t#endif\n\n#endif\n",logdepthbuf_vertex="\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n\t#else\n\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\n\t\tgl_Position.z *= gl_Position.w;\n\n\t#endif\n\n#endif\n",map_fragment="\n#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n\n#endif\n",map_pars_fragment="\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n",map_particle_fragment="\n#ifdef USE_MAP\n\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n\n#endif\n",map_particle_pars_fragment="\n#ifdef USE_MAP\n\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n\n#endif\n",metalnessmap_fragment="\nfloat metalnessFactor = metalness;\n\n#ifdef USE_METALNESSMAP\n\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\n\t// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tmetalnessFactor *= texelMetalness.b;\n\n#endif\n",metalnessmap_pars_fragment="\n#ifdef USE_METALNESSMAP\n\n\tuniform sampler2D metalnessMap;\n\n#endif\n",morphnormal_vertex="\n#ifdef USE_MORPHNORMALS\n\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n#endif\n",morphtarget_pars_vertex="\n#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif\n",morphtarget_vertex="\n#ifdef USE_MORPHTARGETS\n\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n#endif\n",normal_fragment_begin="\n#ifdef FLAT_SHADED\n\n\t// Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...\n\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#else\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t#endif\n\n\t#ifdef USE_TANGENT\n\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n",normal_fragment_maps="\n#ifdef USE_NORMALMAP\n\n\t#ifdef OBJECTSPACE_NORMALMAP\n\n\t\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n\t\t#ifdef FLIP_SIDED\n\n\t\t\tnormal = - normal;\n\n\t\t#endif\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t#endif\n\n\t\tnormal = normalize( normalMatrix * normal );\n\n\t#else // tangent-space normal map\n\n\t\t#ifdef USE_TANGENT\n\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy = normalScale * mapN.xy;\n\t\t\tnormal = normalize( vTBN * mapN );\n\n\t\t#else\n\n\t\t\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\n\t\t#endif\n\n\t#endif\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n",normalmap_pars_fragment="\n#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t#ifdef OBJECTSPACE_NORMALMAP\n\n\t\tuniform mat3 normalMatrix;\n\n\t#else\n\n\t\t// Per-Pixel Tangent Space Normal Mapping\n\t\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n\t\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( vUv.st );\n\t\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n\t\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = normalize( surf_norm );\n\t\t\tmat3 tsn = mat3( S, T, N );\n\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\n\t\t\tmapN.xy *= normalScale;\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\t\t\treturn normalize( tsn * mapN );\n\n\t\t}\n\n\t#endif\n\n#endif\n",packing="\nvec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\n\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\n\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8; // tidy overflow\n\treturn r * PackUpscale;\n}\n\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\n\n// NOTE: viewZ/eyeZ is < 0 when in front of the camera per OpenGL conventions\n\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\n\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment="\n#ifdef PREMULTIPLIED_ALPHA\n\n\t// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.\n\tgl_FragColor.rgb *= gl_FragColor.a;\n\n#endif\n",project_vertex="\nvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment="\n#if defined( DITHERING )\n\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n\n#endif\n",dithering_pars_fragment="\n#if defined( DITHERING )\n\n\t// based on https://www.shadertoy.com/view/MslGR8\n\tvec3 dithering( vec3 color ) {\n\t\t//Calculate grid position\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\n\t\t//Shift the individual colors differently, thus making it even harder to see the dithering pattern\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\n\t\t//modify shift acording to grid position.\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\n\t\t//shift the color by dither_shift\n\t\treturn color + dither_shift_RGB;\n\t}\n\n#endif\n",roughnessmap_fragment="\nfloat roughnessFactor = roughness;\n\n#ifdef USE_ROUGHNESSMAP\n\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\n\t// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\troughnessFactor *= texelRoughness.g;\n\n#endif\n",roughnessmap_pars_fragment="\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform sampler2D roughnessMap;\n\n#endif\n",shadowmap_pars_fragment="\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHTS > 0\n\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHTS > 0\n\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHTS > 0\n\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n\t}\n\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\n\t\tvec2 f = fract( uv * size + 0.5 );\n\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\n\t\treturn c;\n\n\t}\n\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n\t\tfloat shadow = 1.0;\n\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\n\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#else // no percentage-closer filtering:\n\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#endif\n\n\t\t}\n\n\t\treturn shadow;\n\n\t}\n\n\t// cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n\t// vector suitable for 2D texture mapping. This code uses the following layout for the\n\t// 2D texture:\n\t//\n\t// xzXZ\n\t//  y Y\n\t//\n\t// Y - Positive y direction\n\t// y - Negative y direction\n\t// X - Positive x direction\n\t// x - Negative x direction\n\t// Z - Positive z direction\n\t// z - Negative z direction\n\t//\n\t// Source and test bed:\n\t// https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n\t\t// Number of texels to avoid at the edge of each square\n\n\t\tvec3 absV = abs( v );\n\n\t\t// Intersect unit cube\n\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\n\t\t// Apply scale to avoid seams\n\n\t\t// two texels less per square (one texel will do for NEAREST)\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n\t\t// Unwrap\n\n\t\t// space: -1 ... 1 range for each square\n\t\t//\n\t\t// #X##\t\tdim    := ( 4 , 2 )\n\t\t//  # #\t\tcenter := ( 1 , 1 )\n\n\t\tvec2 planar = v.xy;\n\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\n\t\tif ( absV.z >= almostOne ) {\n\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\n\t\t} else if ( absV.x >= almostOne ) {\n\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\n\t\t} else if ( absV.y >= almostOne ) {\n\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\n\t\t}\n\n\t\t// Transform to UV space\n\n\t\t// scale := 0.5 / dim\n\t\t// translate := ( center + 0.5 ) / dim\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n\t}\n\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n\t\t// for point lights, the uniform @vShadowCoord is re-purposed to hold\n\t\t// the vector from the light to the world-space position of the fragment.\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\n\t\t// dp = normalized distance from light to fragment position\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n\t\tdp += shadowBias;\n\n\t\t// bd3D = base direction 3D\n\t\tvec3 bd3D = normalize( lightToPosition );\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#else // no percentage-closer filtering\n\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\n\t\t#endif\n\n\t}\n\n#endif\n",shadowmap_pars_vertex="\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHTS > 0\n\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHTS > 0\n\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHTS > 0\n\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\n\t#endif\n#endif\n",shadowmap_vertex="\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\n\t}\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\n\t}\n\n\t#endif\n\n\t#if NUM_POINT_LIGHTS > 0\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\n\t}\n\n\t#endif\n#endif\n",shadowmask_pars_fragment="\nfloat getShadowMask() {\n\n\tfloat shadow = 1.0;\n\n\t#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHTS > 0\n\n\tDirectionalLight directionalLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n\t}\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHTS > 0\n\n\tSpotLight spotLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\n\t}\n\n\t#endif\n\n\t#if NUM_POINT_LIGHTS > 0\n\n\tPointLight pointLight;\n\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\n\t}\n\n\t#endif\n\t#endif\n\n\treturn shadow;\n\n}\n",skinbase_vertex="\n#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif\n",skinning_pars_vertex="\n#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",skinning_vertex="\n#ifdef USE_SKINNING\n\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n\n#endif\n",skinnormal_vertex="\n#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n\t#ifdef USE_TANGENT\n\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#endif\n\n#endif\n",specularmap_fragment="\nfloat specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif\n",specularmap_pars_fragment="\n#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif\n",tonemapping_fragment="\n#if defined( TONE_MAPPING )\n\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n\n#endif\n",tonemapping_pars_fragment="\n#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\n\n// exposure only\nvec3 LinearToneMapping( vec3 color ) {\n\n\treturn toneMappingExposure * color;\n\n}\n\n// source: https://www.cs.utah.edu/~reinhard/cdrom/\nvec3 ReinhardToneMapping( vec3 color ) {\n\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n\n}\n\n// source: http://filmicgames.com/archives/75\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\n\t// John Hable's filmic operator from Uncharted 2 video game\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n\n}\n\n// source: http://filmicgames.com/archives/75\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\n\t// optimized filmic operator by Jim Hejl and Richard Burgess-Dawson\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n\n}\n\n// source: https://knarkowicz.wordpress.com/2016/01/06/aces-filmic-tone-mapping-curve/\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n\n}\n",uv_pars_fragment="\n#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\n\tvarying vec2 vUv;\n\n#endif\n",uv_pars_vertex="\n#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n\n#endif\n",uv_vertex="\n#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n#endif\n",uv2_pars_fragment="\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvarying vec2 vUv2;\n\n#endif\n",uv2_pars_vertex="\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\n#endif\n",uv2_vertex="\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvUv2 = uv2;\n\n#endif\n",worldpos_vertex="\n#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\n#endif\n",background_frag="\nuniform sampler2D t2D;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n\tvec4 texColor = texture2D( t2D, vUv );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",background_vert="\nvarying vec2 vUv;\nuniform mat3 uvTransform;\n\nvoid main() {\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n\n}\n",cube_frag="\nuniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\n\nvarying vec3 vWorldDirection;\n\nvoid main() {\n\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",cube_vert="\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n\tgl_Position.z = gl_Position.w; // set z to camera.far\n\n}\n",depth_frag="\n#if DEPTH_PACKING == 3200\n\n\tuniform float opacity;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tdiffuseColor.a = opacity;\n\n\t#endif\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\t#include <logdepthbuf_fragment>\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\n\t#elif DEPTH_PACKING == 3201\n\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\n\t#endif\n\n}\n",depth_vert="\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n}\n",distanceRGBA_frag="\n#define DISTANCE\n\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main () {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist ); // clamp to [ 0, 1 ]\n\n\tgl_FragColor = packDepthToRGBA( dist );\n\n}\n",distanceRGBA_vert="\n#define DISTANCE\n\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvWorldPosition = worldPosition.xyz;\n\n}\n",equirect_frag="\nuniform sampler2D tEquirect;\n\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvec3 direction = normalize( vWorldDirection );\n\n\tvec2 sampleUV;\n\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",equirect_vert="\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n}\n",linedashed_frag="\nuniform vec3 diffuse;\nuniform float opacity;\n\nuniform float dashSize;\nuniform float totalSize;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\n\t\tdiscard;\n\n\t}\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\n\toutgoingLight = diffuseColor.rgb; // simple shader\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",linedashed_vert="\nuniform float scale;\nattribute float lineDistance;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <color_vertex>\n\n\tvLineDistance = scale * lineDistance;\n\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n",meshbasic_frag="\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\n\t// accumulation (baked indirect lighting only)\n\t#ifdef USE_LIGHTMAP\n\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\n\t#endif\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",meshbasic_vert="\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_ENVMAP\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshlambert_frag="\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\n\t#endif\n\n\t#include <lightmap_fragment>\n\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\n\t#else\n\n\t\treflectedLight.directDiffuse = vLightFront;\n\n\t#endif\n\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert="\n#define LAMBERT\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshmatcap_frag="\n#define MATCAP\n\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\n\t#ifdef USE_MATCAP\n\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\n\t#else\n\n\t\tvec4 matcapColor = vec4( 1.0 );\n\n\t#endif\n\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",meshmatcap_vert="\n#define MATCAP\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\t\tvNormal = normalize( transformedNormal );\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n}\n",meshphong_frag="\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphong_vert="\n#define PHONG\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphysical_frag="\n#define PHYSICAL\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphysical_vert="\n#define PHYSICAL\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",normal_frag="\n#define NORMAL\n\nuniform float opacity;\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n\nvoid main() {\n\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\n}\n",normal_vert="\n#define NORMAL\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\n\tvViewPosition = - mvPosition.xyz;\n\n#endif\n\n}\n",points_frag="\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",points_vert="\nuniform float size;\nuniform float scale;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\n\tgl_PointSize = size;\n\n\t#ifdef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\n\t#endif\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n\n}\n",shadow_frag="\nuniform vec3 color;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n\nvoid main() {\n\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\n\t#include <fog_fragment>\n\n}\n",shadow_vert="\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n\nvoid main() {\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",sprite_frag="\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",sprite_vert="\nuniform float rotation;\nuniform vec2 center;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n\t#ifndef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\n\t#endif\n\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\n\tmvPosition.xy += rotatedPosition;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n",ShaderChunk={alphamap_fragment:alphamap_fragment,alphamap_pars_fragment:alphamap_pars_fragment,alphatest_fragment:alphatest_fragment,aomap_fragment:aomap_fragment,aomap_pars_fragment:aomap_pars_fragment,begin_vertex:begin_vertex,beginnormal_vertex:beginnormal_vertex,bsdfs:bsdfs,bumpmap_pars_fragment:bumpmap_pars_fragment,clipping_planes_fragment:clipping_planes_fragment,clipping_planes_pars_fragment:clipping_planes_pars_fragment,clipping_planes_pars_vertex:clipping_planes_pars_vertex,clipping_planes_vertex:clipping_planes_vertex,color_fragment:color_fragment,color_pars_fragment:color_pars_fragment,color_pars_vertex:color_pars_vertex,color_vertex:color_vertex,common:common,cube_uv_reflection_fragment:cube_uv_reflection_fragment,defaultnormal_vertex:defaultnormal_vertex,displacementmap_pars_vertex:displacementmap_pars_vertex,displacementmap_vertex:displacementmap_vertex,emissivemap_fragment:emissivemap_fragment,emissivemap_pars_fragment:emissivemap_pars_fragment,encodings_fragment:encodings_fragment,encodings_pars_fragment:encodings_pars_fragment,envmap_fragment:envmap_fragment,envmap_pars_fragment:envmap_pars_fragment,envmap_pars_vertex:envmap_pars_vertex,envmap_physical_pars_fragment:envmap_physical_pars_fragment,envmap_vertex:envmap_vertex,fog_vertex:fog_vertex,fog_pars_vertex:fog_pars_vertex,fog_fragment:fog_fragment,fog_pars_fragment:fog_pars_fragment,gradientmap_pars_fragment:gradientmap_pars_fragment,lightmap_fragment:lightmap_fragment,lightmap_pars_fragment:lightmap_pars_fragment,lights_lambert_vertex:lights_lambert_vertex,lights_pars_begin:lights_pars_begin,lights_phong_fragment:lights_phong_fragment,lights_phong_pars_fragment:lights_phong_pars_fragment,lights_physical_fragment:lights_physical_fragment,lights_physical_pars_fragment:lights_physical_pars_fragment,lights_fragment_begin:lights_fragment_begin,lights_fragment_maps:lights_fragment_maps,lights_fragment_end:lights_fragment_end,logdepthbuf_fragment:logdepthbuf_fragment,logdepthbuf_pars_fragment:logdepthbuf_pars_fragment,logdepthbuf_pars_vertex:logdepthbuf_pars_vertex,logdepthbuf_vertex:logdepthbuf_vertex,map_fragment:map_fragment,map_pars_fragment:map_pars_fragment,map_particle_fragment:map_particle_fragment,map_particle_pars_fragment:map_particle_pars_fragment,metalnessmap_fragment:metalnessmap_fragment,metalnessmap_pars_fragment:metalnessmap_pars_fragment,morphnormal_vertex:morphnormal_vertex,morphtarget_pars_vertex:morphtarget_pars_vertex,morphtarget_vertex:morphtarget_vertex,normal_fragment_begin:normal_fragment_begin,normal_fragment_maps:normal_fragment_maps,normalmap_pars_fragment:normalmap_pars_fragment,packing:packing,premultiplied_alpha_fragment:premultiplied_alpha_fragment,project_vertex:project_vertex,dithering_fragment:dithering_fragment,dithering_pars_fragment:dithering_pars_fragment,roughnessmap_fragment:roughnessmap_fragment,roughnessmap_pars_fragment:roughnessmap_pars_fragment,shadowmap_pars_fragment:shadowmap_pars_fragment,shadowmap_pars_vertex:shadowmap_pars_vertex,shadowmap_vertex:shadowmap_vertex,shadowmask_pars_fragment:shadowmask_pars_fragment,skinbase_vertex:skinbase_vertex,skinning_pars_vertex:skinning_pars_vertex,skinning_vertex:skinning_vertex,skinnormal_vertex:skinnormal_vertex,specularmap_fragment:specularmap_fragment,specularmap_pars_fragment:specularmap_pars_fragment,tonemapping_fragment:tonemapping_fragment,tonemapping_pars_fragment:tonemapping_pars_fragment,uv_pars_fragment:uv_pars_fragment,uv_pars_vertex:uv_pars_vertex,uv_vertex:uv_vertex,uv2_pars_fragment:uv2_pars_fragment,uv2_pars_vertex:uv2_pars_vertex,uv2_vertex:uv2_vertex,worldpos_vertex:worldpos_vertex,background_frag:background_frag,background_vert:background_vert,cube_frag:cube_frag,cube_vert:cube_vert,depth_frag:depth_frag,depth_vert:depth_vert,distanceRGBA_frag:distanceRGBA_frag,distanceRGBA_vert:distanceRGBA_vert,equirect_frag:equirect_frag,equirect_vert:equirect_vert,linedashed_frag:linedashed_frag,linedashed_vert:linedashed_vert,meshbasic_frag:meshbasic_frag,meshbasic_vert:meshbasic_vert,meshlambert_frag:meshlambert_frag,meshlambert_vert:meshlambert_vert,meshmatcap_frag:meshmatcap_frag,meshmatcap_vert:meshmatcap_vert,meshphong_frag:meshphong_frag,meshphong_vert:meshphong_vert,meshphysical_frag:meshphysical_frag,meshphysical_vert:meshphysical_vert,normal_frag:normal_frag,normal_vert:normal_vert,points_frag:points_frag,points_vert:points_vert,shadow_frag:shadow_frag,shadow_vert:shadow_vert,sprite_frag:sprite_frag,sprite_vert:sprite_vert},UniformsLib={common:{diffuse:{value:new Color(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(15658734)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new Matrix3}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.normal_vert,fragmentShader:ShaderChunk.normal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};var OutlineEffect=function(e,t){t=t||{},this.enabled=!0;var i=void 0!==t.defaultThickness?t.defaultThickness:.003,r=(new Color).fromArray(void 0!==t.defaultColor?t.defaultColor:[0,0,0]),n=void 0!==t.defaultAlpha?t.defaultAlpha:1,o=void 0!==t.defaultKeepAlive&&t.defaultKeepAlive,a={},s=60,l={},u={},h={MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical"},c={outlineThickness:{type:"f",value:i},outlineColor:{type:"c",value:r},outlineAlpha:{type:"f",value:n}},d=["#include <fog_pars_vertex>","uniform float outlineThickness;","vec4 calculateOutline( vec4 pos, vec3 objectNormal, vec4 skinned ) {","\tfloat thickness = outlineThickness;","\tconst float ratio = 1.0;","\tvec4 pos2 = projectionMatrix * modelViewMatrix * vec4( skinned.xyz + objectNormal, 1.0 );","\tvec4 norm = normalize( pos - pos2 );","\treturn pos + norm * thickness * pos.w * ratio;","}"].join("\n"),p=["#if ! defined( LAMBERT ) && ! defined( PHONG ) && ! defined( TOON ) && ! defined( PHYSICAL )","\t#ifndef USE_ENVMAP","\t\tvec3 objectNormal = normalize( normal );","\t#endif","#endif","#ifdef FLIP_SIDED","\tobjectNormal = -objectNormal;","#endif","#ifdef DECLARE_TRANSFORMED","\tvec3 transformed = vec3( position );","#endif","gl_Position = calculateOutline( gl_Position, objectNormal, vec4( transformed, 1.0 ) );","#include <fog_vertex>"].join("\n"),f=["#include <common>","#include <fog_pars_fragment>","uniform vec3 outlineColor;","uniform float outlineAlpha;","void main() {","\tgl_FragColor = vec4( outlineColor, outlineAlpha );","\t#include <fog_fragment>","}"].join("\n");function m(){return new ShaderMaterial({name:"invisible",visible:!1})}function v(e){var t,i,r=h[e.type];e.userData.outlineParameters;if(void 0!==r){var n=ShaderLib[r];t=n.uniforms,i=n.vertexShader}else if(!0===e.isRawShaderMaterial){if(t=e.uniforms,i=e.vertexShader,!/attribute\s+vec3\s+position\s*;/.test(i)||!/attribute\s+vec3\s+normal\s*;/.test(i))return console.warn("OutlineEffect requires both vec3 position and normal attributes in vertex shader, does not draw outline for "+e.name+"(uuid:"+e.uuid+") material."),m()}else{if(!0!==e.isShaderMaterial)return m();t=e.uniforms,i=e.vertexShader}var o=Object.assign({},t,c),a=i.replace(/void\s+main\s*\(\s*\)/,d+"\nvoid main()").replace(/\}\s*$/,p+"\n}").replace(/#include\s+<[\w_]*light[\w_]*>/g,""),s={};return/vec3\s+transformed\s*=/.test(i)||/#include\s+<begin_vertex>/.test(i)||(s.DECLARE_TRANSFORMED=!0),new ShaderMaterial({defines:s,uniforms:o,vertexShader:a,fragmentShader:f,side:BackSide,skinning:!1,morphTargets:!1,morphNormals:!1,fog:!1})}function g(e){var t=function(e){var t=a[e.uuid];return void 0===t&&(t={material:v(e),used:!0,keepAlive:o,count:0},a[e.uuid]=t),t.used=!0,t.material}(e);return l[t.uuid]=e,function(e,t){if("invisible"===e.name)return;var i=t.userData.outlineParameters;e.skinning=t.skinning,e.morphTargets=t.morphTargets,e.morphNormals=t.morphNormals,e.fog=t.fog,void 0!==i?(!1===t.visible?e.visible=!1:e.visible=void 0===i.visible||i.visible,e.transparent=void 0!==i.alpha&&i.alpha<1||t.transparent,void 0!==i.keepAlive&&(a[t.uuid].keepAlive=i.keepAlive)):(e.transparent=t.transparent,e.visible=t.visible);!0!==t.wireframe&&!1!==t.depthTest||(e.visible=!1)}(t,e),t}function y(e){if(void 0!==e.material){if(Array.isArray(e.material))for(var t=0,i=e.material.length;t<i;t++)e.material[t]=g(e.material[t]);else e.material=g(e.material);u[e.uuid]=e.onBeforeRender,e.onBeforeRender=b}}function _(e){if(void 0!==e.material){if(Array.isArray(e.material))for(var t=0,i=e.material.length;t<i;t++)e.material[t]=l[e.material[t].uuid];else e.material=l[e.material.uuid];e.onBeforeRender=u[e.uuid]}}function b(e,t,i,r,n,o){var a=l[n.uuid];void 0!==a&&function(e,t){var i=t.userData.outlineParameters;e.uniforms.outlineAlpha.value=t.opacity,void 0!==i&&(void 0!==i.thickness&&(e.uniforms.outlineThickness.value=i.thickness),void 0!==i.color&&e.uniforms.outlineColor.value.fromArray(i.color),void 0!==i.alpha&&(e.uniforms.outlineAlpha.value=i.alpha))}(n,a)}this.render=function(t,i){var r=null,n=!1;if(void 0!==arguments[2]&&(console.warn("OutlineEffect.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),r=arguments[2]),void 0!==arguments[3]&&(console.warn("OutlineEffect.render(): the forceClear argument has been removed. Use .clear() instead."),n=arguments[3]),e.setRenderTarget(r),n&&e.clear(),!1!==this.enabled){var o=e.autoClear;e.autoClear=this.autoClear,e.render(t,i);var h=t.autoUpdate,c=t.background,d=e.shadowMap.enabled;t.autoUpdate=!1,t.background=null,e.autoClear=!1,e.shadowMap.enabled=!1,t.traverse(y),e.render(t,i),t.traverse(_),function(){for(var e,t=0,i=(e=Object.keys(l)).length;t<i;t++)l[e[t]]=void 0;for(t=0,i=(e=Object.keys(u)).length;t<i;t++)u[e[t]]=void 0;for(t=0,i=(e=Object.keys(a)).length;t<i;t++){var r=e[t];!1===a[r].used?(a[r].count++,!1===a[r].keepAlive&&a[r].count>s&&delete a[r]):(a[r].used=!1,a[r].count=0)}}(),t.autoUpdate=h,t.background=c,e.autoClear=o,e.shadowMap.enabled=d}else e.render(t,i)},this.autoClear=e.autoClear,this.domElement=e.domElement,this.shadowMap=e.shadowMap,this.clear=function(t,i,r){e.clear(t,i,r)},this.getPixelRatio=function(){return e.getPixelRatio()},this.setPixelRatio=function(t){e.setPixelRatio(t)},this.getSize=function(t){return e.getSize(t)},this.setSize=function(t,i,r){e.setSize(t,i,r)},this.setViewport=function(t,i,r,n){e.setViewport(t,i,r,n)},this.setScissor=function(t,i,r,n){e.setScissor(t,i,r,n)},this.setScissorTest=function(t){e.setScissorTest(t)},this.setRenderTarget=function(t){e.setRenderTarget(t)}},ParallaxBarrierEffect=function(e){var t=new OrthographicCamera(-1,1,1,-1,0,1),i=new Scene,r=new StereoCamera,n={minFilter:LinearFilter,magFilter:NearestFilter,format:RGBAFormat},o=new WebGLRenderTarget(512,512,n),a=new WebGLRenderTarget(512,512,n),s=new ShaderMaterial({uniforms:{mapLeft:{value:o.texture},mapRight:{value:a.texture}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = vec2( uv.x, uv.y );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","void main() {","\tvec2 uv = vUv;","\tif ( ( mod( gl_FragCoord.y, 2.0 ) ) > 1.00 ) {","\t\tgl_FragColor = texture2D( mapLeft, uv );","\t} else {","\t\tgl_FragColor = texture2D( mapRight, uv );","\t}","}"].join("\n")}),l=new Mesh(new PlaneBufferGeometry(2,2),s);i.add(l),this.setSize=function(t,i){e.setSize(t,i);var r=e.getPixelRatio();o.setSize(t*r,i*r),a.setSize(t*r,i*r)},this.render=function(n,s){n.updateMatrixWorld(),null===s.parent&&s.updateMatrixWorld(),r.update(s),e.setRenderTarget(o),e.clear(),e.render(n,r.cameraL),e.setRenderTarget(a),e.clear(),e.render(n,r.cameraR),e.setRenderTarget(null),e.render(i,t)}},PeppersGhostEffect=function(e){var t,i,r,n=this;n.cameraDistance=15,n.reflectFromAbove=!1;var o=new PerspectiveCamera,a=new PerspectiveCamera,s=new PerspectiveCamera,l=new PerspectiveCamera,u=new Vector3,h=new Quaternion,c=new Vector3;e.autoClear=!1,this.setSize=function(n,o){t=n/2,n<o?(i=n/3,r=n/3):(i=o/3,r=o/3),e.setSize(n,o)},this.render=function(d,p){d.updateMatrixWorld(),null===p.parent&&p.updateMatrixWorld(),p.matrixWorld.decompose(u,h,c),o.position.copy(u),o.quaternion.copy(h),o.translateZ(n.cameraDistance),o.lookAt(d.position),a.position.copy(u),a.quaternion.copy(h),a.translateZ(-n.cameraDistance),a.lookAt(d.position),a.rotation.z+=Math.PI/180*180,s.position.copy(u),s.quaternion.copy(h),s.translateX(-n.cameraDistance),s.lookAt(d.position),s.rotation.x+=Math.PI/180*90,l.position.copy(u),l.quaternion.copy(h),l.translateX(n.cameraDistance),l.lookAt(d.position),l.rotation.x+=Math.PI/180*90,e.clear(),e.setScissorTest(!0),e.setScissor(t-i/2,2*r,i,r),e.setViewport(t-i/2,2*r,i,r),n.reflectFromAbove?e.render(d,a):e.render(d,o),e.setScissor(t-i/2,0,i,r),e.setViewport(t-i/2,0,i,r),n.reflectFromAbove?e.render(d,o):e.render(d,a),e.setScissor(t-i/2-i,r,i,r),e.setViewport(t-i/2-i,r,i,r),n.reflectFromAbove?e.render(d,l):e.render(d,s),e.setScissor(t+i/2,r,i,r),e.setViewport(t+i/2,r,i,r),n.reflectFromAbove?e.render(d,s):e.render(d,l),e.setScissorTest(!1)}},StereoEffect=function(e){var t=new StereoCamera;t.aspect=.5;var i=new Vector2;this.setEyeSeparation=function(e){t.eyeSep=e},this.setSize=function(t,i){e.setSize(t,i)},this.render=function(r,n){r.updateMatrixWorld(),null===n.parent&&n.updateMatrixWorld(),t.update(n),e.getSize(i),e.autoClear&&e.clear(),e.setScissorTest(!0),e.setScissor(0,0,i.width/2,i.height),e.setViewport(0,0,i.width/2,i.height),e.render(r,t.cameraL),e.setScissor(i.width/2,0,i.width/2,i.height),e.setViewport(i.width/2,0,i.width/2,i.height),e.render(r,t.cameraR),e.setScissorTest(!1)}};function MeshLambertMaterial(e){Material$1.call(this),this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}MeshLambertMaterial.prototype=Object.create(Material$1.prototype),MeshLambertMaterial.prototype.constructor=MeshLambertMaterial,MeshLambertMaterial.prototype.isMeshLambertMaterial=!0,MeshLambertMaterial.prototype.copy=function(e){return Material$1.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};var ColladaExporter=function(){};ColladaExporter.prototype={constructor:ColladaExporter,parse:function(e,t,i){void 0===i&&(i={}),""!==(i=Object.assign({version:"1.4.1",author:null,textureDirectory:""},i)).textureDirectory&&(i.textureDirectory=(i.textureDirectory+"/").replace(/\\/g,"/").replace(/\/+/g,"/"));var r,n,o=i.version;if("1.4.1"!==o&&"1.5.0"!==o)return console.warn("ColladaExporter : Version "+o+" not supported for export. Only 1.4.1 and 1.5.0."),null;function a(e,t){return r=r||document.createElement("canvas"),n=n||r.getContext("2d"),r.width=e.naturalWidth,r.height=e.naturalHeight,n.drawImage(e,0,0),function(e){for(var t=atob(e),i=new Uint8Array(t.length),r=0,n=i.length;r<n;r++)i[r]=t.charCodeAt(r);return i}(r.toDataURL("image/"+t,1).replace(/^data:image\/(png|jpg);base64,/,""))}var s,l=["getX","getY","getZ","getW"];function u(e){if(e.isInterleavedBufferAttribute){for(var t=new e.array.constructor(e.count*e.itemSize),i=e.itemSize,r=0,n=e.count;r<n;r++)for(var o=0;o<i;o++)t[r*i+o]=e[l[o]](r);return t}return e.array}function h(e,t,i,r){var n=u(e);return'<source id="'+t+'"><float_array id="'+t+'-array" count="'+n.length+'">'+n.join(" ")+'</float_array><technique_common><accessor source="#'+t+'-array" count="'+Math.floor(n.length/e.itemSize)+'" stride="'+e.itemSize+'">'+i.map(function(e){return'<param name="'+e+'" type="'+r+'" />'}).join("")+"</accessor></technique_common></source>"}function c(e){var t=f.get(e);if(null==t){t="image-"+(v.length+1);var r=e.name||t,n='<image id="'+t+'" name="'+r+'">';n+="1.5.0"===o?"<init_from><ref>"+i.textureDirectory+r+".png</ref></init_from>":"<init_from>"+i.textureDirectory+r+".png</init_from>",n+="</image>",v.push(n),f.set(e,t),m.push({directory:i.textureDirectory,name:r,ext:"png",data:a(e.image,"png"),original:e})}return t}var d=new WeakMap,p=new WeakMap,f=new WeakMap,m=[],v=[],g=[],y=[],_=[],b=function e(t){var i='<node name="'+t.name+'">';if(i+=function(e){return e.updateMatrix(),(s=s||new Matrix4).copy(e.matrix),s.transpose(),"<matrix>"+s.toArray().join(" ")+"</matrix>"}(t),t instanceof Mesh&&null!=t.geometry){var r=function(e){var t,i,r,n=d.get(e);if(!n){var o=e;o instanceof Geometry&&(o=(new BufferGeometry).fromGeometry(o));var a="Mesh"+(g.length+1),s=o.index?o.index.count*o.index.itemSize:o.attributes.position.count,l=null!=o.groups&&0!==o.groups.length?o.groups:[{start:0,count:s,materialIndex:0}],c='<geometry id="'+a+'" name="'+e.name+'"><mesh>',p=a+"-position",f=a+"-vertices";c+=h(o.attributes.position,p,["X","Y","Z"],"float"),c+='<vertices id="'+f+'"><input semantic="POSITION" source="#'+p+'" /></vertices>';var m='<input semantic="VERTEX" source="#'+f+'" offset="0" />';if("normal"in o.attributes){var v=a+"-normal";c+=h(o.attributes.normal,v,["X","Y","Z"],"float"),m+='<input semantic="NORMAL" source="#'+v+'" offset="0" />'}if("uv"in o.attributes){var y=a+"-texcoord";c+=h(o.attributes.uv,y,["S","T"],"float"),m+='<input semantic="TEXCOORD" source="#'+y+'" offset="0" set="0" />'}if("color"in o.attributes){var _=a+"-color";c+=h(o.attributes.color,_,["X","Y","Z"],"uint8"),m+='<input semantic="COLOR" source="#'+_+'" offset="0" />'}var b=null;if(o.index)b=u(o.index);else for(var x=0,w=(b=new Array(s)).length;x<w;x++)b[x]=x;for(x=0,w=l.length;x<w;x++){var S=l[x],M=(t=b,i=S.start,r=S.count,Array.isArray(t)?t.slice(i,i+r):new t.constructor(t.buffer,i*t.BYTES_PER_ELEMENT,r)),T=M.length/3;c+='<triangles material="MESH_MATERIAL_'+S.materialIndex+'" count="'+T+'">',c+=m,c+="<p>"+M.join(" ")+"</p>",c+="</triangles>"}c+="</mesh></geometry>",g.push(c),n={meshid:a,bufferGeometry:o},d.set(e,n)}return n}(t.geometry),n=r.meshid,o=r.bufferGeometry,a=null,l=t.material||new MeshBasicMaterial,f=Array.isArray(l)?l:[l];a=(o.groups.length>f.length?new Array(o.groups.length):new Array(f.length)).fill().map(function(e,t){return function(e){var t=p.get(e);if(null==t){t="Mat"+(y.length+1);var i="phong";e instanceof MeshLambertMaterial?i="lambert":e instanceof MeshBasicMaterial&&(i="constant",null!==e.map&&console.warn("ColladaExporter: Texture maps not supported with MeshBasicMaterial."));var r=e.emissive?e.emissive:new Color(0,0,0),n=e.color?e.color:new Color(0,0,0),o=e.specular?e.specular:new Color(1,1,1),a=e.shininess||0,s=e.reflectivity||0,l="";!0===e.transparent&&(l+="<transparent>"+(e.map?'<texture texture="diffuse-sampler"></texture>':"<float>1</float>")+"</transparent>",e.opacity<1&&(l+="<transparency><float>"+e.opacity+"</float></transparency>"));var u='<technique sid="common"><'+i+"><emission>"+(e.emissiveMap?'<texture texture="emissive-sampler" texcoord="TEXCOORD" />':'<color sid="emission">'+r.r+" "+r.g+" "+r.b+" 1</color>")+"</emission>"+("constant"!==i?"<diffuse>"+(e.map?'<texture texture="diffuse-sampler" texcoord="TEXCOORD" />':'<color sid="diffuse">'+n.r+" "+n.g+" "+n.b+" 1</color>")+"</diffuse>":"")+("phong"===i?'<specular><color sid="specular">'+o.r+" "+o.g+" "+o.b+" 1</color></specular><shininess>"+(e.specularMap?'<texture texture="specular-sampler" texcoord="TEXCOORD" />':'<float sid="shininess">'+a+"</float>")+"</shininess>":"")+"<reflective><color>"+n.r+" "+n.g+" "+n.b+" 1</color></reflective><reflectivity><float>"+s+"</float></reflectivity>"+l+"</"+i+"></technique>",h='<effect id="'+t+'-effect"><profile_COMMON>'+(e.map?'<newparam sid="diffuse-surface"><surface type="2D"><init_from>'+c(e.map)+'</init_from></surface></newparam><newparam sid="diffuse-sampler"><sampler2D><source>diffuse-surface</source></sampler2D></newparam>':"")+(e.specularMap?'<newparam sid="specular-surface"><surface type="2D"><init_from>'+c(e.specularMap)+'</init_from></surface></newparam><newparam sid="specular-sampler"><sampler2D><source>specular-surface</source></sampler2D></newparam>':"")+(e.emissiveMap?'<newparam sid="emissive-surface"><surface type="2D"><init_from>'+c(e.emissiveMap)+'</init_from></surface></newparam><newparam sid="emissive-sampler"><sampler2D><source>emissive-surface</source></sampler2D></newparam>':"")+u+(e.side===DoubleSide?'<extra><technique><double_sided sid="double_sided" type="int">1</double_sided></technique></extra>':"")+"</profile_COMMON></effect>";_.push('<material id="'+t+'" name="'+e.name+'"><instance_effect url="#'+t+'-effect" /></material>'),y.push(h),p.set(e,t)}return t}(f[t%f.length])}),i+='<instance_geometry url="#'+n+'">'+(null!=a?"<bind_material><technique_common>"+a.map(function(e,t){return'<instance_material symbol="MESH_MATERIAL_'+t+'" target="#'+e+'" ><bind_vertex_input semantic="TEXCOORD" input_semantic="TEXCOORD" input_set="0" /></instance_material>'}).join("")+"</technique_common></bind_material>":"")+"</instance_geometry>"}return t.children.forEach(function(t){return i+=e(t)}),i+="</node>"}(e),x='<?xml version="1.0" encoding="UTF-8" standalone="no" ?><COLLADA xmlns="'+("1.4.1"===o?"http://www.collada.org/2005/11/COLLADASchema":"https://www.khronos.org/collada/")+'" version="'+o+'"><asset><contributor><authoring_tool>js Collada Exporter</authoring_tool>'+(null!==i.author?"<author>"+i.author+"</author>":"")+"</contributor><created>"+(new Date).toISOString()+"</created><modified>"+(new Date).toISOString()+"</modified><up_axis>Y_UP</up_axis></asset>";x+="<library_images>"+v.join("")+"</library_images>",x+="<library_effects>"+y.join("")+"</library_effects>",x+="<library_materials>"+_.join("")+"</library_materials>",x+="<library_geometries>"+g.join("")+"</library_geometries>",x+='<library_visual_scenes><visual_scene id="Scene" name="scene">'+b+"</visual_scene></library_visual_scenes>",x+='<scene><instance_visual_scene url="#Scene"/></scene>';var w,S,M,T,A,C,L={data:(w=x+="</COLLADA>",S=/^<\//,M=/(\?>$)|(\/>$)/,T=/<[^>]+>[^<]*<\/[^<]+>/,A=function(e,t){return t>0?e+A(e,t-1):""},C=0,w.match(/(<[^>]+>[^<]+<\/[^<]+>)|(<[^>]+>)/g).map(function(e){T.test(e)||M.test(e)||!S.test(e)||C--;var t=""+A("  ",C)+e;return T.test(e)||M.test(e)||S.test(e)||C++,t}).join("\n")),textures:m};return"function"==typeof t&&requestAnimationFrame(function(){return t(L)}),L}};var WEBGL_CONSTANTS={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},THREE_TO_WEBGL={};THREE_TO_WEBGL[NearestFilter]=WEBGL_CONSTANTS.NEAREST,THREE_TO_WEBGL[NearestMipMapNearestFilter]=WEBGL_CONSTANTS.NEAREST_MIPMAP_NEAREST,THREE_TO_WEBGL[NearestMipMapLinearFilter]=WEBGL_CONSTANTS.NEAREST_MIPMAP_LINEAR,THREE_TO_WEBGL[LinearFilter]=WEBGL_CONSTANTS.LINEAR,THREE_TO_WEBGL[LinearMipMapNearestFilter]=WEBGL_CONSTANTS.LINEAR_MIPMAP_NEAREST,THREE_TO_WEBGL[LinearMipMapLinearFilter]=WEBGL_CONSTANTS.LINEAR_MIPMAP_LINEAR,THREE_TO_WEBGL[ClampToEdgeWrapping]=WEBGL_CONSTANTS.CLAMP_TO_EDGE,THREE_TO_WEBGL[RepeatWrapping]=WEBGL_CONSTANTS.REPEAT,THREE_TO_WEBGL[MirroredRepeatWrapping]=WEBGL_CONSTANTS.MIRRORED_REPEAT;var PATH_PROPERTIES={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},GLTFExporter=function(){};GLTFExporter.prototype={constructor:GLTFExporter,parse:function(e,t,i){(i=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,animations:[],forceIndices:!1,forcePowerOfTwoTextures:!1},i)).animations.length>0&&(i.trs=!0);var r,n={asset:{version:"2.0",generator:"GLTFExporter"}},o=0,a=[],s=[],l=new Map,u=[],h={},c={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map};function d(e,t){return e.length===t.length&&e.every(function(e,i){return e===t[i]})}function p(e){return 4*Math.ceil(e/4)}function f(e,t){t=t||0;var i=p(e.byteLength);if(i!==e.byteLength){var r=new Uint8Array(i);if(r.set(new Uint8Array(e)),0!==t)for(var n=e.byteLength;n<i;n++)r[n]=t;return r.buffer}return e}function m(e){try{return JSON.parse(JSON.stringify(e.userData))}catch(t){return console.warn("GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message),{}}}function v(e,t){var i=!1,r={};0===t.offset.x&&0===t.offset.y||(r.offset=t.offset.toArray(),i=!0),0!==t.rotation&&(r.rotation=t.rotation,i=!0),1===t.repeat.x&&1===t.repeat.y||(r.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=r,h.KHR_texture_transform=!0)}function g(e){return n.buffers||(n.buffers=[{byteLength:0}]),a.push(e),0}function y(e,t,r,a){var s;if(e.array.constructor===Float32Array)s=WEBGL_CONSTANTS.FLOAT;else if(e.array.constructor===Uint32Array)s=WEBGL_CONSTANTS.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)s=WEBGL_CONSTANTS.UNSIGNED_SHORT;else{if(e.array.constructor!==Uint8Array)throw new Error("GLTFExporter: Unsupported bufferAttribute component type.");s=WEBGL_CONSTANTS.UNSIGNED_BYTE}if(void 0===r&&(r=0),void 0===a&&(a=e.count),i.truncateDrawRange&&void 0!==t&&null===t.index){var l=r+a,u=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count;r=Math.max(r,t.drawRange.start),(a=Math.min(l,u)-r)<0&&(a=0)}if(0===a)return null;var h,c=function(e,t,i){for(var r={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)},n=t;n<t+i;n++)for(var o=0;o<e.itemSize;o++){var a=e.array[n*e.itemSize+o];r.min[o]=Math.min(r.min[o],a),r.max[o]=Math.max(r.max[o],a)}return r}(e,r,a);void 0!==t&&(h=e===t.index?WEBGL_CONSTANTS.ELEMENT_ARRAY_BUFFER:WEBGL_CONSTANTS.ARRAY_BUFFER);var d=function(e,t,i,r,a){var s;n.bufferViews||(n.bufferViews=[]),s=t===WEBGL_CONSTANTS.UNSIGNED_BYTE?1:t===WEBGL_CONSTANTS.UNSIGNED_SHORT?2:4;for(var l=p(r*e.itemSize*s),u=new DataView(new ArrayBuffer(l)),h=0,c=i;c<i+r;c++)for(var d=0;d<e.itemSize;d++){var f=e.array[c*e.itemSize+d];t===WEBGL_CONSTANTS.FLOAT?u.setFloat32(h,f,!0):t===WEBGL_CONSTANTS.UNSIGNED_INT?u.setUint32(h,f,!0):t===WEBGL_CONSTANTS.UNSIGNED_SHORT?u.setUint16(h,f,!0):t===WEBGL_CONSTANTS.UNSIGNED_BYTE&&u.setUint8(h,f),h+=s}var m={buffer:g(u.buffer),byteOffset:o,byteLength:l};return void 0!==a&&(m.target=a),a===WEBGL_CONSTANTS.ARRAY_BUFFER&&(m.byteStride=e.itemSize*s),o+=l,n.bufferViews.push(m),{id:n.bufferViews.length-1,byteLength:0}}(e,s,r,a,h),f={bufferView:d.id,byteOffset:d.byteOffset,componentType:s,count:a,max:c.max,min:c.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return n.accessors||(n.accessors=[]),n.accessors.push(f),n.accessors.length-1}function _(e,t,a){c.images.has(e)||c.images.set(e,{});var l=c.images.get(e),u=t===RGBAFormat?"image/png":"image/jpeg",h=u+":flipY/"+a.toString();if(void 0!==l[h])return l[h];n.images||(n.images=[]);var d={mimeType:u};if(i.embedImages){var p=r=r||document.createElement("canvas");p.width=e.width,p.height=e.height,i.forcePowerOfTwoTextures&&!function(e){return _Math.isPowerOfTwo(e.width)&&_Math.isPowerOfTwo(e.height)}(e)&&(console.warn("GLTFExporter: Resized non-power-of-two image.",e),p.width=_Math.floorPowerOfTwo(p.width),p.height=_Math.floorPowerOfTwo(p.height));var m=p.getContext("2d");!0===a&&(m.translate(0,p.height),m.scale(1,-1)),m.drawImage(e,0,0,p.width,p.height),!0===i.binary?s.push(new Promise(function(e){p.toBlob(function(t){(function(e){return n.bufferViews||(n.bufferViews=[]),new Promise(function(t){var i=new window.FileReader;i.readAsArrayBuffer(e),i.onloadend=function(){var e=f(i.result),r={buffer:g(e),byteOffset:o,byteLength:e.byteLength};o+=e.byteLength,n.bufferViews.push(r),t(n.bufferViews.length-1)}})})(t).then(function(t){d.bufferView=t,e()})},u)})):d.uri=p.toDataURL(u)}else d.uri=e.src;n.images.push(d);var v=n.images.length-1;return l[h]=v,v}function b(e){n.samplers||(n.samplers=[]);var t={magFilter:THREE_TO_WEBGL[e.magFilter],minFilter:THREE_TO_WEBGL[e.minFilter],wrapS:THREE_TO_WEBGL[e.wrapS],wrapT:THREE_TO_WEBGL[e.wrapT]};return n.samplers.push(t),n.samplers.length-1}function x(e){if(c.textures.has(e))return c.textures.get(e);n.textures||(n.textures=[]);var t={sampler:b(e),source:_(e.image,e.format,e.flipY)};n.textures.push(t);var i=n.textures.length-1;return c.textures.set(e,i),i}function w(e){if(c.materials.has(e))return c.materials.get(e);if(n.materials||(n.materials=[]),e.isShaderMaterial)return console.warn("GLTFExporter: ShaderMaterial not supported."),null;var t={pbrMetallicRoughness:{}};e.isMeshBasicMaterial?(t.extensions={KHR_materials_unlit:{}},h.KHR_materials_unlit=!0):e.isMeshStandardMaterial||console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var i=e.color.toArray().concat([e.opacity]);if(d(i,[1,1,1,1])||(t.pbrMetallicRoughness.baseColorFactor=i),e.isMeshStandardMaterial?(t.pbrMetallicRoughness.metallicFactor=e.metalness,t.pbrMetallicRoughness.roughnessFactor=e.roughness):e.isMeshBasicMaterial?(t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9):(t.pbrMetallicRoughness.metallicFactor=.5,t.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap)if(e.metalnessMap===e.roughnessMap){var r={index:x(e.metalnessMap)};v(r,e.metalnessMap),t.pbrMetallicRoughness.metallicRoughnessTexture=r}else console.warn("GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.");if(e.map){var o={index:x(e.map)};v(o,e.map),t.pbrMetallicRoughness.baseColorTexture=o}if(e.isMeshBasicMaterial||e.isLineBasicMaterial||e.isPointsMaterial);else{var a=e.emissive.clone().multiplyScalar(e.emissiveIntensity).toArray();if(d(a,[0,0,0])||(t.emissiveFactor=a),e.emissiveMap){var s={index:x(e.emissiveMap)};v(s,e.emissiveMap),t.emissiveTexture=s}}if(e.normalMap){var l={index:x(e.normalMap)};-1!==e.normalScale.x&&(e.normalScale.x!==e.normalScale.y&&console.warn("GLTFExporter: Normal scale components are different, ignoring Y and exporting X."),l.scale=e.normalScale.x),v(l,e.normalMap),t.normalTexture=l}if(e.aoMap){var u={index:x(e.aoMap),texCoord:1};1!==e.aoMapIntensity&&(u.strength=e.aoMapIntensity),v(u,e.aoMap),t.occlusionTexture=u}(e.transparent||e.alphaTest>0)&&(t.alphaMode=e.opacity<1?"BLEND":"MASK",e.alphaTest>0&&.5!==e.alphaTest&&(t.alphaCutoff=e.alphaTest)),e.side===DoubleSide&&(t.doubleSided=!0),""!==e.name&&(t.name=e.name),Object.keys(e.userData).length>0&&(t.extras=m(e)),n.materials.push(t);var p=n.materials.length-1;return c.materials.set(e,p),p}function S(e){var t=e.geometry.uuid+":"+e.material.uuid;if(c.meshes.has(t))return c.meshes.get(t);var r,o=e.geometry;if(e.isLineSegments)r=WEBGL_CONSTANTS.LINES;else if(e.isLineLoop)r=WEBGL_CONSTANTS.LINE_LOOP;else if(e.isLine)r=WEBGL_CONSTANTS.LINE_STRIP;else if(e.isPoints)r=WEBGL_CONSTANTS.POINTS;else{if(!o.isBufferGeometry){console.warn("GLTFExporter: Exporting Geometry will increase file size. Use BufferGeometry instead.");var a=new BufferGeometry;a.fromGeometry(o),o=a}e.drawMode===TriangleFanDrawMode?(console.warn("GLTFExporter: TriangleFanDrawMode and wireframe incompatible."),r=WEBGL_CONSTANTS.TRIANGLE_FAN):r=e.drawMode===TriangleStripDrawMode?e.material.wireframe?WEBGL_CONSTANTS.LINE_STRIP:WEBGL_CONSTANTS.TRIANGLE_STRIP:e.material.wireframe?WEBGL_CONSTANTS.LINES:WEBGL_CONSTANTS.TRIANGLES}var s={},l={},u=[],h=[],d={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},p=o.getAttribute("normal");void 0===p||function(e){if(c.attributesNormalized.has(e))return!1;for(var t=new Vector3,i=0,r=e.count;i<r;i++)if(Math.abs(t.fromArray(e.array,3*i).length()-1)>5e-4)return!1;return!0}(p)||(console.warn("GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.addAttribute("normal",function(e){if(c.attributesNormalized.has(e))return c.attributesNormalized.get(e);for(var t=e.clone(),i=new Vector3,r=0,n=t.count;r<n;r++)i.fromArray(t.array,3*r),0===i.x&&0===i.y&&0===i.z?i.setX(1):i.normalize(),i.toArray(t.array,3*r);return c.attributesNormalized.set(e,t),t}(p)));var f=null;for(var v in o.attributes){var g=o.attributes[v];if(v=d[v]||v.toUpperCase(),c.attributes.has(g))l[v]=c.attributes.get(g);else{f=null;var _=g.array;if("JOINTS_0"!==v||_ instanceof Uint16Array||_ instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),f=new BufferAttribute(new Uint16Array(_),g.itemSize,g.normalized)),"MORPH"!==v.substr(0,5)){var b=y(f||g,o);null!==b&&(l[v]=b,c.attributes.set(g,b))}}}if(void 0!==p&&o.addAttribute("normal",p),0===Object.keys(l).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){var x=[],S=[],M={};if(void 0!==e.morphTargetDictionary)for(var T in e.morphTargetDictionary)M[e.morphTargetDictionary[T]]=T;for(var A=0;A<e.morphTargetInfluences.length;++A){var C={},L=!1;for(var v in o.morphAttributes)if("position"===v||"normal"===v){g=o.morphAttributes[v][A];var N=v.toUpperCase(),P=o.attributes[v];if(c.attributes.has(g))C[N]=c.attributes.get(g);else{for(var k=g.clone(),E=0,D=g.count;E<D;E++)k.setXYZ(E,g.getX(E)-P.getX(E),g.getY(E)-P.getY(E),g.getZ(E)-P.getZ(E));C[N]=y(k,o),c.attributes.set(P,C[N])}}else L||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),L=!0);h.push(C),x.push(e.morphTargetInfluences[A]),void 0!==e.morphTargetDictionary&&S.push(M[A])}s.weights=x,S.length>0&&(s.extras={},s.extras.targetNames=S)}var O=Object.keys(o.userData).length>0?m(o):void 0,R=i.forceIndices,F=Array.isArray(e.material);if(F&&0===o.groups.length)return null;!R&&null===o.index&&F&&(console.warn("GLTFExporter: Creating index for non-indexed multi-material mesh."),R=!0);var I=!1;if(null===o.index&&R){for(var B=[],U=(A=0,o.attributes.position.count);A<U;A++)B[A]=A;o.setIndex(B),I=!0}var V=F?e.material:[e.material],z=F?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(A=0,U=z.length;A<U;A++){var G={mode:r,attributes:l};O&&(G.extras=O),h.length>0&&(G.targets=h),null!==o.index&&(c.attributes.has(o.index)?G.indices=c.attributes.get(o.index):(G.indices=y(o.index,o,z[A].start,z[A].count),c.attributes.set(o.index,G.indices)));var j=w(V[z[A].materialIndex]);null!==j&&(G.material=j),u.push(G)}I&&o.setIndex(null),s.primitives=u,n.meshes||(n.meshes=[]),n.meshes.push(s);var W=n.meshes.length-1;return c.meshes.set(t,W),W}function M(e,t){n.animations||(n.animations=[]);for(var i=(e=GLTFExporter.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,r=[],o=[],a=0;a<i.length;++a){var s=i[a],u=PropertyBinding.parseTrackName(s.name),h=PropertyBinding.findNode(t,u.nodeName),c=PATH_PROPERTIES[u.propertyName];if("bones"===u.objectName&&(h=!0===h.isSkinnedMesh?h.skeleton.getBoneByName(u.objectIndex):void 0),!h||!c)return console.warn('GLTFExporter: Could not export animation track "%s".',s.name),null;var d,p=s.values.length/s.times.length;c===PATH_PROPERTIES.morphTargetInfluences&&(p/=h.morphTargetInfluences.length),!0===s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(d="CUBICSPLINE",p/=3):d=s.getInterpolation()===InterpolateDiscrete?"STEP":"LINEAR",o.push({input:y(new BufferAttribute(s.times,1)),output:y(new BufferAttribute(s.values,p)),interpolation:d}),r.push({sampler:o.length-1,target:{node:l.get(h),path:c}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:o,channels:r}),n.animations.length-1}function T(e){var t=n.nodes[l.get(e)],i=e.skeleton,r=e.skeleton.bones[0];if(void 0===r)return null;for(var o=[],a=new Float32Array(16*i.bones.length),s=0;s<i.bones.length;++s)o.push(l.get(i.bones[s])),i.boneInverses[s].toArray(a,16*s);return void 0===n.skins&&(n.skins=[]),n.skins.push({inverseBindMatrices:y(new BufferAttribute(a,16)),joints:o,skeleton:l.get(r)}),t.skin=n.skins.length-1}function A(e){var t={};e.name&&(t.name=e.name),t.color=e.color.toArray(),t.intensity=e.intensity,e.isDirectionalLight?t.type="directional":e.isPointLight?(t.type="point",e.distance>0&&(t.range=e.distance)):e.isSpotLight&&(t.type="spot",e.distance>0&&(t.range=e.distance),t.spot={},t.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,t.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1.");var i=n.extensions.KHR_lights_punctual.lights;return i.push(t),i.length-1}function C(e){n.nodes||(n.nodes=[]);var t={};if(i.trs){var r=e.quaternion.toArray(),o=e.position.toArray(),a=e.scale.toArray();d(r,[0,0,0,1])||(t.rotation=r),d(o,[0,0,0])||(t.translation=o),d(a,[1,1,1])||(t.scale=a)}else e.updateMatrix(),d(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])||(t.matrix=e.matrix.elements);if(""!==e.name&&(t.name=String(e.name)),e.userData&&Object.keys(e.userData).length>0&&(t.extras=m(e)),e.isMesh||e.isLine||e.isPoints){var s=S(e);null!==s&&(t.mesh=s)}else if(e.isCamera)t.camera=function(e){n.cameras||(n.cameras=[]);var t=e.isOrthographicCamera,i={type:t?"orthographic":"perspective"};return t?i.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:_Math.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(i.name=e.type),n.cameras.push(i),n.cameras.length-1}(e);else if(e.isDirectionalLight||e.isPointLight||e.isSpotLight)h.KHR_lights_punctual||(n.extensions=n.extensions||{},n.extensions.KHR_lights_punctual={lights:[]},h.KHR_lights_punctual=!0),t.extensions=t.extensions||{},t.extensions.KHR_lights_punctual={light:A(e)};else if(e.isLight)return console.warn("GLTFExporter: Only directional, point, and spot lights are supported."),null;if(e.isSkinnedMesh&&u.push(e),e.children.length>0){for(var c=[],p=0,f=e.children.length;p<f;p++){var v=e.children[p];if(v.visible||!1===i.onlyVisible){var g=C(v);null!==g&&c.push(g)}}c.length>0&&(t.children=c)}n.nodes.push(t);var y=n.nodes.length-1;return l.set(e,y),y}function L(e){n.scenes||(n.scenes=[],n.scene=0);var t={nodes:[]};""!==e.name&&(t.name=e.name),e.userData&&Object.keys(e.userData).length>0&&(t.extras=m(e)),n.scenes.push(t);for(var r=[],o=0,a=e.children.length;o<a;o++){var s=e.children[o];if(s.visible||!1===i.onlyVisible){var l=C(s);null!==l&&r.push(l)}}r.length>0&&(t.nodes=r)}!function(e){e=e instanceof Array?e:[e];for(var t=[],r=0;r<e.length;r++)e[r]instanceof Scene?L(e[r]):t.push(e[r]);for(t.length>0&&function(e){var t=new Scene;t.name="AuxScene";for(var i=0;i<e.length;i++)t.children.push(e[i]);L(t)}(t),r=0;r<u.length;++r)T(u[r]);for(r=0;r<i.animations.length;++r)M(i.animations[r],e[0])}(e),Promise.all(s).then(function(){var e=new Blob(a,{type:"application/octet-stream"}),r=Object.keys(h);if(r.length>0&&(n.extensionsUsed=r),n.buffers&&n.buffers.length>0){n.buffers[0].byteLength=e.size;var o=new window.FileReader;if(!0===i.binary){o.readAsArrayBuffer(e),o.onloadend=function(){var e=f(o.result),i=new DataView(new ArrayBuffer(8));i.setUint32(0,e.byteLength,!0),i.setUint32(4,5130562,!0);var r=f(function(e){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(e).buffer;for(var t=new Uint8Array(new ArrayBuffer(e.length)),i=0,r=e.length;i<r;i++){var n=e.charCodeAt(i);t[i]=n>255?32:n}return t.buffer}(JSON.stringify(n)),32),a=new DataView(new ArrayBuffer(8));a.setUint32(0,r.byteLength,!0),a.setUint32(4,1313821514,!0);var s=new ArrayBuffer(12),l=new DataView(s);l.setUint32(0,1179937895,!0),l.setUint32(4,2,!0);var u=12+a.byteLength+r.byteLength+i.byteLength+e.byteLength;l.setUint32(8,u,!0);var h=new Blob([s,a,r,i,e],{type:"application/octet-stream"}),c=new window.FileReader;c.readAsArrayBuffer(h),c.onloadend=function(){t(c.result)}}}else o.readAsDataURL(e),o.onloadend=function(){var e=o.result;n.buffers[0].uri=e,t(n)}}else t(n)})}},GLTFExporter.Utils={insertKeyframe:function(e,t){var i,r=e.getValueSize(),n=new e.TimeBufferType(e.times.length+1),o=new e.ValueBufferType(e.values.length+r),a=e.createInterpolant(new e.ValueBufferType(r));if(0===e.times.length){n[0]=t;for(var s=0;s<r;s++)o[s]=0;i=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<.001)return 0;n[0]=t,n.set(e.times,1),o.set(a.evaluate(t),0),o.set(e.values,r),i=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<.001)return e.times.length-1;n[n.length-1]=t,n.set(e.times,0),o.set(e.values,0),o.set(a.evaluate(t),e.values.length),i=n.length-1}else for(s=0;s<e.times.length;s++){if(Math.abs(e.times[s]-t)<.001)return s;if(e.times[s]<t&&e.times[s+1]>t){n.set(e.times.slice(0,s+1),0),n[s+1]=t,n.set(e.times.slice(s+1),s+2),o.set(e.values.slice(0,(s+1)*r),0),o.set(a.evaluate(t),(s+1)*r),o.set(e.values.slice((s+1)*r),(s+2)*r),i=s+1;break}}return e.times=n,e.values=o,i},mergeMorphTargetTracks:function(e,t){for(var i=[],r={},n=e.tracks,o=0;o<n.length;++o){var a=n[o],s=PropertyBinding.parseTrackName(a.name),l=PropertyBinding.findNode(t,s.nodeName);if("morphTargetInfluences"===s.propertyName&&void 0!==s.propertyIndex){if(a.createInterpolant!==a.InterpolantFactoryMethodDiscrete&&a.createInterpolant!==a.InterpolantFactoryMethodLinear){if(a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(a=a.clone()).setInterpolation(InterpolateLinear)}var u,h=l.morphTargetInfluences.length,c=l.morphTargetDictionary[s.propertyIndex];if(void 0===c)throw new Error("GLTFExporter: Morph target name not found: "+s.propertyIndex);if(void 0!==r[l.uuid]){var d=a.createInterpolant(new a.ValueBufferType(1));u=r[l.uuid];for(m=0;m<u.times.length;m++)u.values[m*h+c]=d.evaluate(u.times[m]);for(m=0;m<a.times.length;m++){var p=this.insertKeyframe(u,a.times[m]);u.values[p*h+c]=a.values[m]}}else{for(var f=new((u=a.clone()).ValueBufferType)(h*u.times.length),m=0;m<u.times.length;m++)f[m*h+c]=u.values[m];u.name=".morphTargetInfluences",u.values=f,r[l.uuid]=u,i.push(u)}}else i.push(a)}return e.tracks=i,e}};var MMDExporter=function(){var e;this.parseVpd=function(t,i,r){if(!0!==t.isSkinnedMesh)return console.warn("MMDExporter: parseVpd() requires SkinnedMesh instance."),null;function n(e){Math.abs(e)<1e-6&&(e=0);var t=e.toString();-1===t.indexOf(".")&&(t+=".");var i=(t+="000000").indexOf(".");return t.slice(0,i)+"."+t.slice(i+1,i+7)}function o(e){for(var t=[],i=0,r=e.length;i<r;i++)t.push(n(e[i]));return t.join(",")}t.updateMatrixWorld(!0);var a=t.skeleton.bones,s=function(e){var t=e.clone();return t.pose(),t.skeleton.bones}(t),l=new Vector3,u=new Quaternion,h=new Quaternion,c=new Matrix4,d=[];d.push("Vocaloid Pose Data file"),d.push(""),d.push((""!==t.name?t.name.replace(/\s/g,"_"):"skin")+".osm;"),d.push(a.length+";"),d.push("");for(var p=0,f=a.length;p<f;p++){var m=a[p],v=s[p];!0===r&&void 0!==m.userData.ik&&void 0!==m.userData.ik.originalMatrix?c.fromArray(m.userData.ik.originalMatrix):c.copy(m.matrix),l.setFromMatrixPosition(c),u.setFromRotationMatrix(c);var g=l.sub(v.position).toArray(),y=h.copy(v.quaternion).conjugate().multiply(u).toArray();g[2]=-g[2],y[0]=-y[0],y[1]=-y[1],d.push("Bone"+p+"{"+m.name),d.push("  "+o(g)+";"),d.push("  "+o(y)+";"),d.push("}"),d.push("")}d.push("");var _=d.join("\n");return!0===i?function(t){if(void 0===e){var i=(new MMDParser.CharsetEncoder).s2uTable;e={};for(var r=Object.keys(i),n=0,o=r.length;n<o;n++){var a=r[n],s=i[a];a=parseInt(a),e[s]=a}}var l=[];for(n=0,o=t.length;n<o;n++){var u=t.charCodeAt(n);if(void 0===(s=e[u]))throw"cannot convert charcode 0x"+u.toString(16);s>255?(l.push(s>>8&255),l.push(255&s)):l.push(255&s)}return new Uint8Array(l)}(_):_}},OBJExporter=function(){};OBJExporter.prototype={constructor:OBJExporter,parse:function(e){var t,i,r,n,o,a="",s=0,l=0,u=0,h=new Vector3,c=new Vector3,d=new Vector2,p=[];return e.traverse(function(e){e instanceof Mesh&&function(e){var r=0,f=0,m=0,v=e.geometry,g=new Matrix3;if(v instanceof Geometry&&(v=(new BufferGeometry).setFromObject(e)),v instanceof BufferGeometry){var y=v.getAttribute("position"),_=v.getAttribute("normal"),b=v.getAttribute("uv"),x=v.getIndex();if(a+="o "+e.name+"\n",e.material&&e.material.name&&(a+="usemtl "+e.material.name+"\n"),void 0!==y)for(t=0,n=y.count;t<n;t++,r++)h.x=y.getX(t),h.y=y.getY(t),h.z=y.getZ(t),h.applyMatrix4(e.matrixWorld),a+="v "+h.x+" "+h.y+" "+h.z+"\n";if(void 0!==b)for(t=0,n=b.count;t<n;t++,m++)d.x=b.getX(t),d.y=b.getY(t),a+="vt "+d.x+" "+d.y+"\n";if(void 0!==_)for(g.getNormalMatrix(e.matrixWorld),t=0,n=_.count;t<n;t++,f++)c.x=_.getX(t),c.y=_.getY(t),c.z=_.getZ(t),c.applyMatrix3(g),a+="vn "+c.x+" "+c.y+" "+c.z+"\n";if(null!==x)for(t=0,n=x.count;t<n;t+=3){for(o=0;o<3;o++)i=x.getX(t+o)+1,p[o]=s+i+(_||b?"/"+(b?l+i:"")+(_?"/"+(u+i):""):"");a+="f "+p.join(" ")+"\n"}else for(t=0,n=y.count;t<n;t+=3){for(o=0;o<3;o++)i=t+o+1,p[o]=s+i+(_||b?"/"+(b?l+i:"")+(_?"/"+(u+i):""):"");a+="f "+p.join(" ")+"\n"}}else console.warn("OBJExporter.parseMesh(): geometry type unsupported",v);s+=r,l+=m,u+=f}(e),e instanceof Line&&function(e){var o=0,l=e.geometry,u=e.type;if(l instanceof Geometry&&(l=(new BufferGeometry).setFromObject(e)),l instanceof BufferGeometry){var c=l.getAttribute("position");if(a+="o "+e.name+"\n",void 0!==c)for(t=0,n=c.count;t<n;t++,o++)h.x=c.getX(t),h.y=c.getY(t),h.z=c.getZ(t),h.applyMatrix4(e.matrixWorld),a+="v "+h.x+" "+h.y+" "+h.z+"\n";if("Line"===u){for(a+="l ",i=1,n=c.count;i<=n;i++)a+=s+i+" ";a+="\n"}if("LineSegments"===u)for(r=1+(i=1),n=c.count;i<n;r=(i+=2)+1)a+="l "+(s+i)+" "+(s+r)+"\n"}else console.warn("OBJExporter.parseLine(): geometry type unsupported",l);s+=o}(e)}),a}};var PLYExporter=function(){};PLYExporter.prototype={constructor:PLYExporter,parse:function(e,t,i){function r(t){e.traverse(function(e){if(!0===e.isMesh){var i=e,r=i.geometry;!0===r.isGeometry&&(r=o.get(r)),!0===r.isBufferGeometry&&void 0!==r.getAttribute("position")&&t(i,r)}})}t&&"object"==typeof t&&(console.warn('PLYExporter: The options parameter is now the third argument to the "parse" function. See the documentation for the new API.'),i=t,t=void 0);var n=(i=Object.assign({binary:!1,excludeAttributes:[]},i)).excludeAttributes,o=new WeakMap,a=!1,s=!1,l=!1,u=0,h=0;e.traverse(function(e){if(!0===e.isMesh){var t=e,i=t.geometry;if(!0===i.isGeometry){var r=o.get(i)||(new BufferGeometry).setFromObject(t);o.set(i,r),i=r}if(!0===i.isBufferGeometry){var n=i.getAttribute("position"),c=i.getAttribute("normal"),d=i.getAttribute("uv"),p=i.getAttribute("color"),f=i.getIndex();if(void 0===n)return;u+=n.count,h+=f?f.count/3:n.count/3,void 0!==c&&(a=!0),void 0!==d&&(l=!0),void 0!==p&&(s=!0)}}});var c=-1===n.indexOf("index");if(a=a&&-1===n.indexOf("normal"),s=s&&-1===n.indexOf("color"),l=l&&-1===n.indexOf("uv"),c&&h!==Math.floor(h))return console.error("PLYExporter: Failed to generate a valid PLY file with triangle indices because the number of indices is not divisible by 3."),null;var d=1;u>256&&(d=2),u>65536&&(d=4);var p="ply\nformat "+(i.binary?"binary_big_endian":"ascii")+" 1.0\nelement vertex "+u+"\nproperty float x\nproperty float y\nproperty float z\n";!0===a&&(p+="property float nx\nproperty float ny\nproperty float nz\n"),!0===l&&(p+="property float s\nproperty float t\n"),!0===s&&(p+="property uchar red\nproperty uchar green\nproperty uchar blue\n"),!0===c&&(p+="element face "+h+"\nproperty list uchar uint"+8*d+" vertex_index\n"),p+="end_header\n";var f=new Vector3,m=new Matrix3,v=null;if(!0===i.binary){var g=(new TextEncoder).encode(p),y=u*(12+(a?12:0)+(s?3:0)+(l?8:0)),_=c?h*(3*d+1):0,b=new DataView(new ArrayBuffer(g.length+y+_));new Uint8Array(b.buffer).set(g,0);var x=g.length,w=g.length+y,S=0;r(function(e,t){var i=t.getAttribute("position"),r=t.getAttribute("normal"),n=t.getAttribute("uv"),o=t.getAttribute("color"),u=t.getIndex();m.getNormalMatrix(e.matrixWorld);for(var h=0,p=i.count;h<p;h++)f.x=i.getX(h),f.y=i.getY(h),f.z=i.getZ(h),f.applyMatrix4(e.matrixWorld),b.setFloat32(x,f.x),x+=4,b.setFloat32(x,f.y),x+=4,b.setFloat32(x,f.z),x+=4,!0===a&&(null!=r?(f.x=r.getX(h),f.y=r.getY(h),f.z=r.getZ(h),f.applyMatrix3(m),b.setFloat32(x,f.x),x+=4,b.setFloat32(x,f.y),x+=4,b.setFloat32(x,f.z),x+=4):(b.setFloat32(x,0),x+=4,b.setFloat32(x,0),x+=4,b.setFloat32(x,0),x+=4)),!0===l&&(null!=n?(b.setFloat32(x,n.getX(h)),x+=4,b.setFloat32(x,n.getY(h)),x+=4):!1!==l&&(b.setFloat32(x,0),x+=4,b.setFloat32(x,0),x+=4)),!0===s&&(null!=o?(b.setUint8(x,Math.floor(255*o.getX(h))),x+=1,b.setUint8(x,Math.floor(255*o.getY(h))),x+=1,b.setUint8(x,Math.floor(255*o.getZ(h))),x+=1):(b.setUint8(x,255),x+=1,b.setUint8(x,255),x+=1,b.setUint8(x,255),x+=1));if(!0===c){var v="setUint"+8*d;if(null!==u)for(h=0,p=u.count;h<p;h+=3)b.setUint8(w,3),w+=1,b[v](w,u.getX(h+0)+S),w+=d,b[v](w,u.getX(h+1)+S),w+=d,b[v](w,u.getX(h+2)+S),w+=d;else for(h=0,p=i.count;h<p;h+=3)b.setUint8(w,3),w+=1,b[v](w,S+h),w+=d,b[v](w,S+h+1),w+=d,b[v](w,S+h+2),w+=d}S+=i.count}),v=b.buffer}else{S=0;var M="",T="";r(function(e,t){var i=t.getAttribute("position"),r=t.getAttribute("normal"),n=t.getAttribute("uv"),o=t.getAttribute("color"),u=t.getIndex();m.getNormalMatrix(e.matrixWorld);for(var d=0,p=i.count;d<p;d++){f.x=i.getX(d),f.y=i.getY(d),f.z=i.getZ(d),f.applyMatrix4(e.matrixWorld);var v=f.x+" "+f.y+" "+f.z;!0===a&&(null!=r?(f.x=r.getX(d),f.y=r.getY(d),f.z=r.getZ(d),f.applyMatrix3(m),v+=" "+f.x+" "+f.y+" "+f.z):v+=" 0 0 0"),!0===l&&(null!=n?v+=" "+n.getX(d)+" "+n.getY(d):!1!==l&&(v+=" 0 0")),!0===s&&(v+=null!=o?" "+Math.floor(255*o.getX(d))+" "+Math.floor(255*o.getY(d))+" "+Math.floor(255*o.getZ(d)):" 255 255 255"),M+=v+"\n"}if(!0===c){if(null!==u)for(d=0,p=u.count;d<p;d+=3)T+="3 "+(u.getX(d+0)+S),T+=" "+(u.getX(d+1)+S),T+=" "+(u.getX(d+2)+S)+"\n";else for(d=0,p=i.count;d<p;d+=3)T+="3 "+(S+d)+" "+(S+d+1)+" "+(S+d+2)+"\n";h+=u?u.count/3:i.count/3}S+=i.count}),v=""+p+M+"\n"+(c?T+"\n":"")}return"function"==typeof t&&requestAnimationFrame(function(){return t(v)}),v}};var STLExporter=function(){};STLExporter.prototype={constructor:STLExporter,parse:function(){var e=new Vector3,t=new Matrix3;return function(i,r){void 0===r&&(r={});var n=void 0!==r.binary&&r.binary,o=[],a=0;if(i.traverse(function(e){if(e.isMesh){var t=e.geometry;t.isBufferGeometry&&(t=(new Geometry).fromBufferGeometry(t)),t.isGeometry&&(a+=t.faces.length,o.push({geometry:t,matrixWorld:e.matrixWorld}))}}),n){var s=80,l=new ArrayBuffer(2*a+3*a*4*4+80+4);(_=new DataView(l)).setUint32(s,a,!0),s+=4;for(var u=0,h=o.length;u<h;u++){var c=(b=o[u]).geometry.vertices,d=b.geometry.faces,p=b.matrixWorld;t.getNormalMatrix(p);for(var f=0,m=d.length;f<m;f++){var v=d[f];e.copy(v.normal).applyMatrix3(t).normalize(),_.setFloat32(s,e.x,!0),s+=4,_.setFloat32(s,e.y,!0),s+=4,_.setFloat32(s,e.z,!0),s+=4;for(var g=[v.a,v.b,v.c],y=0;y<3;y++)e.copy(c[g[y]]).applyMatrix4(p),_.setFloat32(s,e.x,!0),s+=4,_.setFloat32(s,e.y,!0),s+=4,_.setFloat32(s,e.z,!0),s+=4;_.setUint16(s,0,!0),s+=2}}return _}var _="";_+="solid exported\n";for(u=0,h=o.length;u<h;u++){var b;c=(b=o[u]).geometry.vertices,d=b.geometry.faces,p=b.matrixWorld;t.getNormalMatrix(p);for(f=0,m=d.length;f<m;f++){v=d[f];e.copy(v.normal).applyMatrix3(t).normalize(),_+="\tfacet normal "+e.x+" "+e.y+" "+e.z+"\n",_+="\t\touter loop\n";for(g=[v.a,v.b,v.c],y=0;y<3;y++)e.copy(c[g[y]]).applyMatrix4(p),_+="\t\t\tvertex "+e.x+" "+e.y+" "+e.z+"\n";_+="\t\tendloop\n",_+="\tendfacet\n"}}return _+="endsolid exported\n"}}()};var TypedGeometryExporter=function(){};TypedGeometryExporter.prototype={constructor:TypedGeometryExporter,parse:function(e){var t={metadata:{version:4,type:"TypedGeometry",generator:"TypedGeometryExporter"}},i=["vertices","normals","uvs"];for(var r in i){for(var n=i[r],o=e[n],a=[],s=0,l=o.length;s<l;s++)a[s]=o[s];t[n]=a}var u=e.boundingSphere;return null!==u&&(t.boundingSphere={center:u.center.toArray(),radius:u.radius}),t}};var BoxLineGeometry=function(e,t,i,r,n,o){BufferGeometry.call(this);for(var a=(e=e||1)/2,s=(t=t||1)/2,l=(i=i||1)/2,u=e/(r=Math.floor(r)||1),h=t/(n=Math.floor(n)||1),c=i/(o=Math.floor(o)||1),d=[],p=-a,f=-s,m=-l,v=0;v<=r;v++)d.push(p,-s,-l,p,s,-l),d.push(p,s,-l,p,s,l),d.push(p,s,l,p,-s,l),d.push(p,-s,l,p,-s,-l),p+=u;for(v=0;v<=n;v++)d.push(-a,f,-l,a,f,-l),d.push(a,f,-l,a,f,l),d.push(a,f,l,-a,f,l),d.push(-a,f,l,-a,f,-l),f+=h;for(v=0;v<=o;v++)d.push(-a,-s,m,-a,s,m),d.push(-a,s,m,a,s,m),d.push(a,s,m,a,-s,m),d.push(a,-s,m,-a,-s,m),m+=c;this.addAttribute("position",new Float32BufferAttribute(d,3))};function DecalGeometry(e,t,i,r){BufferGeometry.call(this);var n=[],o=[],a=[],s=new Vector3,l=new Matrix4;l.makeRotationFromEuler(i),l.setPosition(t);var u=(new Matrix4).getInverse(l);function h(t,i,r){i.applyMatrix4(e.matrixWorld),i.applyMatrix4(u),t.push(new DecalVertex(i.clone(),r.clone()))}function c(e,t){for(var i=[],n=.5*Math.abs(r.dot(t)),o=0;o<e.length;o+=3){var a,s,l,u,h,c,p;switch(((a=e[o+0].position.dot(t)-n>0)?1:0)+((s=e[o+1].position.dot(t)-n>0)?1:0)+((l=e[o+2].position.dot(t)-n>0)?1:0)){case 0:i.push(e[o]),i.push(e[o+1]),i.push(e[o+2]);break;case 1:if(a&&(u=e[o+1],h=e[o+2],c=d(e[o],u,t,n),p=d(e[o],h,t,n)),s){u=e[o],h=e[o+2],c=d(e[o+1],u,t,n),p=d(e[o+1],h,t,n),i.push(c),i.push(h.clone()),i.push(u.clone()),i.push(h.clone()),i.push(c.clone()),i.push(p);break}l&&(u=e[o],h=e[o+1],c=d(e[o+2],u,t,n),p=d(e[o+2],h,t,n)),i.push(u.clone()),i.push(h.clone()),i.push(c),i.push(p),i.push(c.clone()),i.push(h.clone());break;case 2:a||(h=d(u=e[o].clone(),e[o+1],t,n),c=d(u,e[o+2],t,n),i.push(u),i.push(h),i.push(c)),s||(h=d(u=e[o+1].clone(),e[o+2],t,n),c=d(u,e[o],t,n),i.push(u),i.push(h),i.push(c)),l||(h=d(u=e[o+2].clone(),e[o],t,n),c=d(u,e[o+1],t,n),i.push(u),i.push(h),i.push(c))}}return i}function d(e,t,i,r){var n=e.position.dot(i)-r,o=n/(n-(t.position.dot(i)-r));return new DecalVertex(new Vector3(e.position.x+o*(t.position.x-e.position.x),e.position.y+o*(t.position.y-e.position.y),e.position.z+o*(t.position.z-e.position.z)),new Vector3(e.normal.x+o*(t.normal.x-e.normal.x),e.normal.y+o*(t.normal.y-e.normal.y),e.normal.z+o*(t.normal.z-e.normal.z)))}!function(){var t,i=new BufferGeometry,u=[],d=new Vector3,p=new Vector3;e.geometry.isGeometry?i.fromGeometry(e.geometry):i.copy(e.geometry);var f=i.attributes.position,m=i.attributes.normal;if(null!==i.index){var v=i.index;for(t=0;t<v.count;t++)d.fromBufferAttribute(f,v.getX(t)),p.fromBufferAttribute(m,v.getX(t)),h(u,d,p)}else for(t=0;t<f.count;t++)d.fromBufferAttribute(f,t),p.fromBufferAttribute(m,t),h(u,d,p);for(u=c(u,s.set(1,0,0)),u=c(u,s.set(-1,0,0)),u=c(u,s.set(0,1,0)),u=c(u,s.set(0,-1,0)),u=c(u,s.set(0,0,1)),u=c(u,s.set(0,0,-1)),t=0;t<u.length;t++){var g=u[t];a.push(.5+g.position.x/r.x,.5+g.position.y/r.y),g.position.applyMatrix4(l),n.push(g.position.x,g.position.y,g.position.z),o.push(g.normal.x,g.normal.y,g.normal.z)}}(),this.addAttribute("position",new Float32BufferAttribute(n,3)),this.addAttribute("normal",new Float32BufferAttribute(o,3)),this.addAttribute("uv",new Float32BufferAttribute(a,2))}function DecalVertex(e,t){this.position=e,this.normal=t}function hilbert2D(e,t,i,r,n,o,a){e=void 0!==e?e:new Vector3(0,0,0);var s=(t=void 0!==t?t:10)/2,l=(i=void 0!==i?i:1,r=void 0!==r?r:0,n=void 0!==n?n:1,o=void 0!==o?o:2,a=void 0!==a?a:3,[new Vector3(e.x-s,e.y,e.z-s),new Vector3(e.x-s,e.y,e.z+s),new Vector3(e.x+s,e.y,e.z+s),new Vector3(e.x+s,e.y,e.z-s)]),u=[l[r],l[n],l[o],l[a]];if(0<=--i){var h=[];return Array.prototype.push.apply(h,hilbert2D(u[0],s,i,r,a,o,n)),Array.prototype.push.apply(h,hilbert2D(u[1],s,i,r,n,o,a)),Array.prototype.push.apply(h,hilbert2D(u[2],s,i,r,n,o,a)),Array.prototype.push.apply(h,hilbert2D(u[3],s,i,o,n,r,a)),h}return u}function hilbert3D(e,t,i,r,n,o,a,s,l,u,h){e=void 0!==e?e:new Vector3(0,0,0);var c=(t=void 0!==t?t:10)/2,d=(i=void 0!==i?i:1,r=void 0!==r?r:0,n=void 0!==n?n:1,o=void 0!==o?o:2,a=void 0!==a?a:3,s=void 0!==s?s:4,l=void 0!==l?l:5,u=void 0!==u?u:6,h=void 0!==h?h:7,[new Vector3(e.x-c,e.y+c,e.z-c),new Vector3(e.x-c,e.y+c,e.z+c),new Vector3(e.x-c,e.y-c,e.z+c),new Vector3(e.x-c,e.y-c,e.z-c),new Vector3(e.x+c,e.y-c,e.z-c),new Vector3(e.x+c,e.y-c,e.z+c),new Vector3(e.x+c,e.y+c,e.z+c),new Vector3(e.x+c,e.y+c,e.z-c)]),p=[d[r],d[n],d[o],d[a],d[s],d[l],d[u],d[h]];if(--i>=0){var f=[];return Array.prototype.push.apply(f,hilbert3D(p[0],c,i,r,a,s,h,u,l,o,n)),Array.prototype.push.apply(f,hilbert3D(p[1],c,i,r,h,u,n,o,l,s,a)),Array.prototype.push.apply(f,hilbert3D(p[2],c,i,r,h,u,n,o,l,s,a)),Array.prototype.push.apply(f,hilbert3D(p[3],c,i,o,a,r,n,u,h,s,l)),Array.prototype.push.apply(f,hilbert3D(p[4],c,i,o,a,r,n,u,h,s,l)),Array.prototype.push.apply(f,hilbert3D(p[5],c,i,s,a,o,l,u,n,r,h)),Array.prototype.push.apply(f,hilbert3D(p[6],c,i,s,a,o,l,u,n,r,h)),Array.prototype.push.apply(f,hilbert3D(p[7],c,i,u,l,o,n,r,a,s,h)),f}return p}BoxLineGeometry.prototype=Object.create(BufferGeometry.prototype),BoxLineGeometry.prototype.constructor=BoxLineGeometry,DecalGeometry.prototype=Object.create(BufferGeometry.prototype),DecalGeometry.prototype.constructor=DecalGeometry,DecalVertex.prototype.clone=function(){return new DecalVertex(this.position.clone(),this.normal.clone())};var SimplexNoise=function(e){null==e&&(e=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(t=0;t<512;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};SimplexNoise.prototype.dot=function(e,t,i){return e[0]*t+e[1]*i},SimplexNoise.prototype.dot3=function(e,t,i,r){return e[0]*t+e[1]*i+e[2]*r},SimplexNoise.prototype.dot4=function(e,t,i,r,n){return e[0]*t+e[1]*i+e[2]*r+e[3]*n},SimplexNoise.prototype.noise=function(e,t){var i,r,n=(e+t)*(.5*(Math.sqrt(3)-1)),o=Math.floor(e+n),a=Math.floor(t+n),s=(3-Math.sqrt(3))/6,l=(o+a)*s,u=e-(o-l),h=t-(a-l);u>h?(i=1,r=0):(i=0,r=1);var c=u-i+s,d=h-r+s,p=u-1+2*s,f=h-1+2*s,m=255&o,v=255&a,g=this.perm[m+this.perm[v]]%12,y=this.perm[m+i+this.perm[v+r]]%12,_=this.perm[m+1+this.perm[v+1]]%12,b=.5-u*u-h*h,x=.5-c*c-d*d,w=.5-p*p-f*f;return 70*((b<0?0:(b*=b)*b*this.dot(this.grad3[g],u,h))+(x<0?0:(x*=x)*x*this.dot(this.grad3[y],c,d))+(w<0?0:(w*=w)*w*this.dot(this.grad3[_],p,f)))},SimplexNoise.prototype.noise3d=function(e,t,i){var r,n,o,a,s,l,u=(e+t+i)*(1/3),h=Math.floor(e+u),c=Math.floor(t+u),d=Math.floor(i+u),p=1/6,f=(h+c+d)*p,m=e-(h-f),v=t-(c-f),g=i-(d-f);m>=v?v>=g?(r=1,n=0,o=0,a=1,s=1,l=0):m>=g?(r=1,n=0,o=0,a=1,s=0,l=1):(r=0,n=0,o=1,a=1,s=0,l=1):v<g?(r=0,n=0,o=1,a=0,s=1,l=1):m<g?(r=0,n=1,o=0,a=0,s=1,l=1):(r=0,n=1,o=0,a=1,s=1,l=0);var y=m-r+p,_=v-n+p,b=g-o+p,x=m-a+2*p,w=v-s+2*p,S=g-l+2*p,M=m-1+.5,T=v-1+.5,A=g-1+.5,C=255&h,L=255&c,N=255&d,P=this.perm[C+this.perm[L+this.perm[N]]]%12,k=this.perm[C+r+this.perm[L+n+this.perm[N+o]]]%12,E=this.perm[C+a+this.perm[L+s+this.perm[N+l]]]%12,D=this.perm[C+1+this.perm[L+1+this.perm[N+1]]]%12,O=.6-m*m-v*v-g*g,R=.6-y*y-_*_-b*b,F=.6-x*x-w*w-S*S,I=.6-M*M-T*T-A*A;return 32*((O<0?0:(O*=O)*O*this.dot3(this.grad3[P],m,v,g))+(R<0?0:(R*=R)*R*this.dot3(this.grad3[k],y,_,b))+(F<0?0:(F*=F)*F*this.dot3(this.grad3[E],x,w,S))+(I<0?0:(I*=I)*I*this.dot3(this.grad3[D],M,T,A)))},SimplexNoise.prototype.noise4d=function(e,t,i,r){var n,o,a,s,l,u,h,c,d,p,f,m,v=this.grad4,g=this.simplex,y=this.perm,_=(Math.sqrt(5)-1)/4,b=(5-Math.sqrt(5))/20,x=(e+t+i+r)*_,w=Math.floor(e+x),S=Math.floor(t+x),M=Math.floor(i+x),T=Math.floor(r+x),A=(w+S+M+T)*b,C=e-(w-A),L=t-(S-A),N=i-(M-A),P=r-(T-A),k=(C>L?32:0)+(C>N?16:0)+(L>N?8:0)+(C>P?4:0)+(L>P?2:0)+(N>P?1:0),E=C-(n=g[k][0]>=3?1:0)+b,D=L-(o=g[k][1]>=3?1:0)+b,O=N-(a=g[k][2]>=3?1:0)+b,R=P-(s=g[k][3]>=3?1:0)+b,F=C-(l=g[k][0]>=2?1:0)+2*b,I=L-(u=g[k][1]>=2?1:0)+2*b,B=N-(h=g[k][2]>=2?1:0)+2*b,U=P-(c=g[k][3]>=2?1:0)+2*b,V=C-(d=g[k][0]>=1?1:0)+3*b,z=L-(p=g[k][1]>=1?1:0)+3*b,G=N-(f=g[k][2]>=1?1:0)+3*b,j=P-(m=g[k][3]>=1?1:0)+3*b,W=C-1+4*b,H=L-1+4*b,q=N-1+4*b,Y=P-1+4*b,X=255&w,K=255&S,Q=255&M,Z=255&T,J=y[X+y[K+y[Q+y[Z]]]]%32,$=y[X+n+y[K+o+y[Q+a+y[Z+s]]]]%32,ee=y[X+l+y[K+u+y[Q+h+y[Z+c]]]]%32,te=y[X+d+y[K+p+y[Q+f+y[Z+m]]]]%32,ie=y[X+1+y[K+1+y[Q+1+y[Z+1]]]]%32,re=.6-C*C-L*L-N*N-P*P,ne=.6-E*E-D*D-O*O-R*R,oe=.6-F*F-I*I-B*B-U*U,ae=.6-V*V-z*z-G*G-j*j,se=.6-W*W-H*H-q*q-Y*Y;return 27*((re<0?0:(re*=re)*re*this.dot4(v[J],C,L,N,P))+(ne<0?0:(ne*=ne)*ne*this.dot4(v[$],E,D,O,R))+(oe<0?0:(oe*=oe)*oe*this.dot4(v[ee],F,I,B,U))+(ae<0?0:(ae*=ae)*ae*this.dot4(v[te],V,z,G,j))+(se<0?0:(se*=se)*se*this.dot4(v[ie],W,H,q,Y)))};var LightningStrike=function(e){BufferGeometry.call(this),this.type="LightningStrike",e=e||{},this.init(LightningStrike.copyParameters(e,e)),this.createMesh()};LightningStrike.prototype=Object.create(BufferGeometry.prototype),LightningStrike.prototype.constructor=LightningStrike,LightningStrike.prototype.isLightningStrike=!0,LightningStrike.RAY_INITIALIZED=0,LightningStrike.RAY_UNBORN=1,LightningStrike.RAY_PROPAGATING=2,LightningStrike.RAY_STEADY=3,LightningStrike.RAY_VANISHING=4,LightningStrike.RAY_EXTINGUISHED=5,LightningStrike.COS30DEG=Math.cos(30*Math.PI/180),LightningStrike.SIN30DEG=Math.sin(30*Math.PI/180),LightningStrike.createRandomGenerator=function(){for(var e=[],t=0;t<2053;t++)e.push(Math.random());var i={currentSeed:0,random:function(){var t=e[i.currentSeed];return i.currentSeed=(i.currentSeed+1)%2053,t},getSeed:function(){return i.currentSeed/2053},setSeed:function(e){i.currentSeed=Math.floor(2053*e)%2053}};return i},LightningStrike.copyParameters=function(e,t){t=t||{};var i=function(i){return t===e?i:i.clone()};return(e=e||{}).sourceOffset=void 0!==t.sourceOffset?i(t.sourceOffset):new Vector3(0,100,0),e.destOffset=void 0!==t.destOffset?i(t.destOffset):new Vector3(0,0,0),e.timeScale=void 0!==t.timeScale?t.timeScale:1,e.roughness=void 0!==t.roughness?t.roughness:.9,e.straightness=void 0!==t.straightness?t.straightness:.7,e.up0=void 0!==t.up0?i(t.up0):new Vector3(0,0,1),e.up1=void 0!==t.up1?i(t.up1):new Vector3(0,0,1),e.radius0=void 0!==t.radius0?t.radius0:1,e.radius1=void 0!==t.radius1?t.radius1:1,e.radius0Factor=void 0!==t.radius0Factor?t.radius0Factor:.5,e.radius1Factor=void 0!==t.radius1Factor?t.radius1Factor:.2,e.minRadius=void 0!==t.minRadius?t.minRadius:.2,e.isEternal=void 0!==t.isEternal?t.isEternal:void 0===t.birthTime||void 0===t.deathTime,e.birthTime=t.birthTime,e.deathTime=t.deathTime,e.propagationTimeFactor=void 0!==t.propagationTimeFactor?t.propagationTimeFactor:.1,e.vanishingTimeFactor=void 0!==t.vanishingTimeFactor?t.vanishingTimeFactor:.9,e.subrayPeriod=void 0!==t.subrayPeriod?t.subrayPeriod:4,e.subrayDutyCycle=void 0!==t.subrayDutyCycle?t.subrayDutyCycle:.6,e.maxIterations=void 0!==t.maxIterations?t.maxIterations:9,e.isStatic=void 0!==t.isStatic&&t.isStatic,e.ramification=void 0!==t.ramification?t.ramification:5,e.maxSubrayRecursion=void 0!==t.maxSubrayRecursion?t.maxSubrayRecursion:3,e.recursionProbability=void 0!==t.recursionProbability?t.recursionProbability:.6,e.generateUVs=void 0!==t.generateUVs&&t.generateUVs,e.randomGenerator=t.randomGenerator,e.noiseSeed=t.noiseSeed,e.onDecideSubrayCreation=t.onDecideSubrayCreation,e.onSubrayCreation=t.onSubrayCreation,e},LightningStrike.prototype.update=function(e){this.isStatic||(this.rayParameters.isEternal||this.rayParameters.birthTime<=e&&e<=this.rayParameters.deathTime?(this.updateMesh(e),e<this.subrays[0].endPropagationTime?this.state=LightningStrike.RAY_PROPAGATING:e>this.subrays[0].beginVanishingTime?this.state=LightningStrike.RAY_VANISHING:this.state=LightningStrike.RAY_STEADY,this.visible=!0):(this.visible=!1,e<this.rayParameters.birthTime?this.state=LightningStrike.RAY_UNBORN:this.state=LightningStrike.RAY_EXTINGUISHED))},LightningStrike.prototype.init=function(e){this.rayParameters=e,this.maxIterations=void 0!==e.maxIterations?Math.floor(e.maxIterations):9,e.maxIterations=this.maxIterations,this.isStatic=void 0!==e.isStatic&&e.isStatic,e.isStatic=this.isStatic,this.ramification=void 0!==e.ramification?Math.floor(e.ramification):5,e.ramification=this.ramification,this.maxSubrayRecursion=void 0!==e.maxSubrayRecursion?Math.floor(e.maxSubrayRecursion):3,e.maxSubrayRecursion=this.maxSubrayRecursion,this.recursionProbability=void 0!==e.recursionProbability?e.recursionProbability:.6,e.recursionProbability=this.recursionProbability,this.generateUVs=void 0!==e.generateUVs&&e.generateUVs,e.generateUVs=this.generateUVs,void 0!==e.randomGenerator?(this.randomGenerator=e.randomGenerator,this.seedGenerator=e.randomGenerator,void 0!==e.noiseSeed&&this.seedGenerator.setSeed(e.noiseSeed)):(this.randomGenerator=LightningStrike.createRandomGenerator(),this.seedGenerator=Math),void 0!==e.onDecideSubrayCreation?this.onDecideSubrayCreation=e.onDecideSubrayCreation:(this.createDefaultSubrayCreationCallbacks(),void 0!==e.onSubrayCreation&&(this.onSubrayCreation=e.onSubrayCreation)),this.state=LightningStrike.RAY_INITIALIZED,this.maxSubrays=Math.ceil(1+Math.pow(this.ramification,Math.max(0,this.maxSubrayRecursion-1))),e.maxSubrays=this.maxSubrays,this.maxRaySegments=2*(1<<this.maxIterations),this.subrays=[];for(var t=0;t<this.maxSubrays;t++)this.subrays.push(this.createSubray());this.raySegments=[];for(t=0;t<this.maxRaySegments;t++)this.raySegments.push(this.createSegment());this.time=0,this.timeFraction=0,this.currentSegmentCallback=null,this.currentCreateTriangleVertices=this.generateUVs?this.createTriangleVerticesWithUVs:this.createTriangleVerticesWithoutUVs,this.numSubrays=0,this.currentSubray=null,this.currentSegmentIndex=0,this.isInitialSegment=!1,this.subrayProbability=0,this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.vertices=null,this.uvs=null,this.indices=null,this.positionAttribute=null,this.uvsAttribute=null,this.simplexX=new SimplexNoise(this.seedGenerator),this.simplexY=new SimplexNoise(this.seedGenerator),this.simplexZ=new SimplexNoise(this.seedGenerator),this.forwards=new Vector3,this.forwardsFill=new Vector3,this.side=new Vector3,this.down=new Vector3,this.middlePos=new Vector3,this.middleLinPos=new Vector3,this.newPos=new Vector3,this.vPos=new Vector3,this.cross1=new Vector3},LightningStrike.prototype.createMesh=function(){var e=1<<this.maxIterations,t=3*(e+1)*this.maxSubrays,i=18*e*this.maxSubrays;this.vertices=new Float32Array(3*t),this.indices=new Uint32Array(i),this.generateUVs&&(this.uvs=new Float32Array(2*t)),this.fillMesh(0),this.setIndex(new Uint32BufferAttribute(this.indices,1)),this.positionAttribute=new Float32BufferAttribute(this.vertices,3),this.addAttribute("position",this.positionAttribute),this.generateUVs&&(this.uvsAttribute=new Float32BufferAttribute(new Float32Array(this.uvs),2),this.addAttribute("uv",this.uvsAttribute)),this.isStatic||(this.index.dynamic=!0,this.positionAttribute.dynamic=!0,this.generateUVs&&(this.uvsAttribute.dynamic=!0)),this.vertices=this.positionAttribute.array,this.indices=this.index.array,this.generateUVs&&(this.uvs=this.uvsAttribute.array)},LightningStrike.prototype.updateMesh=function(e){this.fillMesh(e),this.drawRange.count=this.currentIndex,this.index.needsUpdate=!0,this.positionAttribute.needsUpdate=!0,this.generateUVs&&(this.uvsAttribute.needsUpdate=!0)},LightningStrike.prototype.fillMesh=function(e){var t=this;this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.fractalRay(e,function(i){var r=t.currentSubray;e<r.birthTime||(this.rayParameters.isEternal&&0==t.currentSubray.recursion?(t.createPrism(i),t.onDecideSubrayCreation(i,t)):e<r.endPropagationTime?t.timeFraction>=i.fraction0*r.propagationTimeFactor&&(t.createPrism(i),t.onDecideSubrayCreation(i,t)):e<r.beginVanishingTime?(t.createPrism(i),t.onDecideSubrayCreation(i,t)):(t.timeFraction<=r.vanishingTimeFactor+i.fraction1*(1-r.vanishingTimeFactor)&&t.createPrism(i),t.onDecideSubrayCreation(i,t)))})},LightningStrike.prototype.addNewSubray=function(e){return this.subrays[this.numSubrays++]},LightningStrike.prototype.initSubray=function(e,t){e.pos0.copy(t.sourceOffset),e.pos1.copy(t.destOffset),e.up0.copy(t.up0),e.up1.copy(t.up1),e.radius0=t.radius0,e.radius1=t.radius1,e.birthTime=t.birthTime,e.deathTime=t.deathTime,e.timeScale=t.timeScale,e.roughness=t.roughness,e.straightness=t.straightness,e.propagationTimeFactor=t.propagationTimeFactor,e.vanishingTimeFactor=t.vanishingTimeFactor,e.maxIterations=this.maxIterations,e.seed=void 0!==t.noiseSeed?t.noiseSeed:0,e.recursion=0},LightningStrike.prototype.fractalRay=function(e,t){this.time=e,this.currentSegmentCallback=t,this.numSubrays=0,this.initSubray(this.addNewSubray(),this.rayParameters);for(var i=0;i<this.numSubrays;i++){var r=this.subrays[i];this.currentSubray=r,this.randomGenerator.setSeed(r.seed),r.endPropagationTime=_Math.lerp(r.birthTime,r.deathTime,r.propagationTimeFactor),r.beginVanishingTime=_Math.lerp(r.deathTime,r.birthTime,1-r.vanishingTimeFactor);var n=this.randomGenerator.random;r.linPos0.set(n(),n(),n()).multiplyScalar(1e3),r.linPos1.set(n(),n(),n()).multiplyScalar(1e3),this.timeFraction=(e-r.birthTime)/(r.deathTime-r.birthTime),this.currentSegmentIndex=0,this.isInitialSegment=!0;var o=this.getNewSegment();o.iteration=0,o.pos0.copy(r.pos0),o.pos1.copy(r.pos1),o.linPos0.copy(r.linPos0),o.linPos1.copy(r.linPos1),o.up0.copy(r.up0),o.up1.copy(r.up1),o.radius0=r.radius0,o.radius1=r.radius1,o.fraction0=0,o.fraction1=1,o.positionVariationFactor=1-r.straightness,this.subrayProbability=this.ramification*Math.pow(this.recursionProbability,r.recursion)/(1<<r.maxIterations),this.fractalRayRecursive(o)}this.currentSegmentCallback=null,this.currentSubray=null},LightningStrike.prototype.fractalRayRecursive=function(e){if(e.iteration>=this.currentSubray.maxIterations)this.currentSegmentCallback(e);else{this.forwards.subVectors(e.pos1,e.pos0);var t=this.forwards.length();t<1e-6&&(this.forwards.set(0,0,.01),t=this.forwards.length());var i=.5*(e.radius0+e.radius1),r=.5*(e.fraction0+e.fraction1),n=this.time*this.currentSubray.timeScale*Math.pow(2,e.iteration);this.middlePos.lerpVectors(e.pos0,e.pos1,.5),this.middleLinPos.lerpVectors(e.linPos0,e.linPos1,.5);var o=this.middleLinPos;this.newPos.set(this.simplexX.noise4d(o.x,o.y,o.z,n),this.simplexY.noise4d(o.x,o.y,o.z,n),this.simplexZ.noise4d(o.x,o.y,o.z,n)),this.newPos.multiplyScalar(e.positionVariationFactor*t),this.newPos.add(this.middlePos);var a=this.getNewSegment();a.pos0.copy(e.pos0),a.pos1.copy(this.newPos),a.linPos0.copy(e.linPos0),a.linPos1.copy(this.middleLinPos),a.up0.copy(e.up0),a.up1.copy(e.up1),a.radius0=e.radius0,a.radius1=i,a.fraction0=e.fraction0,a.fraction1=r,a.positionVariationFactor=e.positionVariationFactor*this.currentSubray.roughness,a.iteration=e.iteration+1;var s=this.getNewSegment();s.pos0.copy(this.newPos),s.pos1.copy(e.pos1),s.linPos0.copy(this.middleLinPos),s.linPos1.copy(e.linPos1),this.cross1.crossVectors(e.up0,this.forwards.normalize()),s.up0.crossVectors(this.forwards,this.cross1).normalize(),s.up1.copy(e.up1),s.radius0=i,s.radius1=e.radius1,s.fraction0=r,s.fraction1=e.fraction1,s.positionVariationFactor=e.positionVariationFactor*this.currentSubray.roughness,s.iteration=e.iteration+1,this.fractalRayRecursive(a),this.fractalRayRecursive(s)}},LightningStrike.prototype.createPrism=function(e){this.forwardsFill.subVectors(e.pos1,e.pos0).normalize(),this.isInitialSegment&&(this.currentCreateTriangleVertices(e.pos0,e.up0,this.forwardsFill,e.radius0,0),this.isInitialSegment=!1),this.currentCreateTriangleVertices(e.pos1,e.up0,this.forwardsFill,e.radius1,e.fraction1),this.createPrismFaces()},LightningStrike.prototype.createTriangleVerticesWithoutUVs=function(e,t,i,r){this.side.crossVectors(t,i).multiplyScalar(r*LightningStrike.COS30DEG),this.down.copy(t).multiplyScalar(-r*LightningStrike.SIN30DEG);var n=this.vPos,o=this.vertices;n.copy(e).sub(this.side).add(this.down),o[this.currentCoordinate++]=n.x,o[this.currentCoordinate++]=n.y,o[this.currentCoordinate++]=n.z,n.copy(e).add(this.side).add(this.down),o[this.currentCoordinate++]=n.x,o[this.currentCoordinate++]=n.y,o[this.currentCoordinate++]=n.z,n.copy(t).multiplyScalar(r).add(e),o[this.currentCoordinate++]=n.x,o[this.currentCoordinate++]=n.y,o[this.currentCoordinate++]=n.z,this.currentVertex+=3},LightningStrike.prototype.createTriangleVerticesWithUVs=function(e,t,i,r,n){this.side.crossVectors(t,i).multiplyScalar(r*LightningStrike.COS30DEG),this.down.copy(t).multiplyScalar(-r*LightningStrike.SIN30DEG);var o=this.vPos,a=this.vertices,s=this.uvs;o.copy(e).sub(this.side).add(this.down),a[this.currentCoordinate++]=o.x,a[this.currentCoordinate++]=o.y,a[this.currentCoordinate++]=o.z,s[this.currentUVCoordinate++]=n,s[this.currentUVCoordinate++]=0,o.copy(e).add(this.side).add(this.down),a[this.currentCoordinate++]=o.x,a[this.currentCoordinate++]=o.y,a[this.currentCoordinate++]=o.z,s[this.currentUVCoordinate++]=n,s[this.currentUVCoordinate++]=.5,o.copy(t).multiplyScalar(r).add(e),a[this.currentCoordinate++]=o.x,a[this.currentCoordinate++]=o.y,a[this.currentCoordinate++]=o.z,s[this.currentUVCoordinate++]=n,s[this.currentUVCoordinate++]=1,this.currentVertex+=3},LightningStrike.prototype.createPrismFaces=function(e,t){var i=this.indices;e=this.currentVertex-6;i[this.currentIndex++]=e+1,i[this.currentIndex++]=e+2,i[this.currentIndex++]=e+5,i[this.currentIndex++]=e+1,i[this.currentIndex++]=e+5,i[this.currentIndex++]=e+4,i[this.currentIndex++]=e+0,i[this.currentIndex++]=e+1,i[this.currentIndex++]=e+4,i[this.currentIndex++]=e+0,i[this.currentIndex++]=e+4,i[this.currentIndex++]=e+3,i[this.currentIndex++]=e+2,i[this.currentIndex++]=e+0,i[this.currentIndex++]=e+3,i[this.currentIndex++]=e+2,i[this.currentIndex++]=e+3,i[this.currentIndex++]=e+5},LightningStrike.prototype.createDefaultSubrayCreationCallbacks=function(){var e=this.randomGenerator.random;this.onDecideSubrayCreation=function(t,i){var r=i.currentSubray,n=i.rayParameters.subrayPeriod,o=i.rayParameters.subrayDutyCycle,a=i.rayParameters.isEternal&&0==r.recursion?-e()*n:_Math.lerp(r.birthTime,r.endPropagationTime,t.fraction0)-e()*n,s=i.time-a,l=Math.floor(s/n),u=e()*(l+1),h=s%n<=o*n;c=i.subrayProbability;var c=0;if(h&&(c=i.subrayProbability),r.recursion<i.maxSubrayRecursion&&i.numSubrays<i.maxSubrays&&e()<c){var d=i.addNewSubray(),p=i.randomGenerator.getSeed();d.seed=u,i.randomGenerator.setSeed(u),d.recursion=r.recursion+1,d.maxIterations=Math.max(1,r.maxIterations-1),d.linPos0.set(e(),e(),e()).multiplyScalar(1e3),d.linPos1.set(e(),e(),e()).multiplyScalar(1e3),d.up0.copy(r.up0),d.up1.copy(r.up1),d.radius0=t.radius0*i.rayParameters.radius0Factor,d.radius1=Math.min(i.rayParameters.minRadius,t.radius1*i.rayParameters.radius1Factor),d.birthTime=a+l*n,d.deathTime=d.birthTime+n*o,i.rayParameters.isEternal||0!=r.recursion||(d.birthTime=Math.max(d.birthTime,r.birthTime),d.deathTime=Math.min(d.deathTime,r.deathTime)),d.timeScale=2*r.timeScale,d.roughness=r.roughness,d.straightness=r.straightness,d.propagationTimeFactor=r.propagationTimeFactor,d.vanishingTimeFactor=r.vanishingTimeFactor,i.onSubrayCreation(t,r,d,i),i.randomGenerator.setSeed(p)}};var t=new Vector3,i=new Vector3,r=new Vector3,n=new Vector3;this.onSubrayCreation=function(e,t,i,r){r.subrayCylinderPosition(e,t,i,.5,.6,.2)},this.subrayConePosition=function(o,a,s,l,u,h){s.pos0.copy(o.pos0),t.subVectors(a.pos1,a.pos0),i.copy(t).normalize(),t.multiplyScalar(o.fraction0+(1-o.fraction0)*(e()*l));var c=t.length();r.crossVectors(a.up0,i);var d=2*Math.PI*e();r.multiplyScalar(Math.cos(d)),n.copy(a.up0).multiplyScalar(Math.sin(d)),s.pos1.copy(r).add(n).multiplyScalar(c*u*(h+e()*(1-h))).add(t).add(a.pos0)},this.subrayCylinderPosition=function(o,a,s,l,u,h){s.pos0.copy(o.pos0),t.subVectors(a.pos1,a.pos0),i.copy(t).normalize(),t.multiplyScalar(o.fraction0+(1-o.fraction0)*((2*e()-1)*l));var c=t.length();r.crossVectors(a.up0,i);var d=2*Math.PI*e();r.multiplyScalar(Math.cos(d)),n.copy(a.up0).multiplyScalar(Math.sin(d)),s.pos1.copy(r).add(n).multiplyScalar(c*u*(h+e()*(1-h))).add(t).add(a.pos0)}},LightningStrike.prototype.createSubray=function(){return{seed:0,maxIterations:0,recursion:0,pos0:new Vector3,pos1:new Vector3,linPos0:new Vector3,linPos1:new Vector3,up0:new Vector3,up1:new Vector3,radius0:0,radius1:0,birthTime:0,deathTime:0,timeScale:0,roughness:0,straightness:0,propagationTimeFactor:0,vanishingTimeFactor:0,endPropagationTime:0,beginVanishingTime:0}},LightningStrike.prototype.createSegment=function(){return{iteration:0,pos0:new Vector3,pos1:new Vector3,linPos0:new Vector3,linPos1:new Vector3,up0:new Vector3,up1:new Vector3,radius0:0,radius1:0,fraction0:0,fraction1:0,positionVariationFactor:0}},LightningStrike.prototype.getNewSegment=function(){return this.raySegments[this.currentSegmentIndex++]},LightningStrike.prototype.copy=function(e){return BufferGeometry.prototype.copy.call(this,e),this.init(LightningStrike.copyParameters({},e.rayParameters)),this},LightningStrike.prototype.clone=function(){return new this.constructor(LightningStrike.copyParameters({},this.rayParameters))};var TeapotBufferGeometry=function(e,t,i,r,n,o,a){var s=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,3,16,17,18,7,19,20,21,11,22,23,24,15,25,26,27,18,28,29,30,21,31,32,33,24,34,35,36,27,37,38,39,30,40,41,0,33,42,43,4,36,44,45,8,39,46,47,12,12,13,14,15,48,49,50,51,52,53,54,55,56,57,58,59,15,25,26,27,51,60,61,62,55,63,64,65,59,66,67,68,27,37,38,39,62,69,70,71,65,72,73,74,68,75,76,77,39,46,47,12,71,78,79,48,74,80,81,52,77,82,83,56,56,57,58,59,84,85,86,87,88,89,90,91,92,93,94,95,59,66,67,68,87,96,97,98,91,99,100,101,95,102,103,104,68,75,76,77,98,105,106,107,101,108,109,110,104,111,112,113,77,82,83,56,107,114,115,84,110,116,117,88,113,118,119,92,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,123,136,137,120,127,138,139,124,131,140,141,128,135,142,143,132,132,133,134,135,144,145,146,147,148,149,150,151,68,152,153,154,135,142,143,132,147,155,156,144,151,157,158,148,154,159,160,68,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,164,177,178,161,168,179,180,165,172,181,182,169,176,183,184,173,173,174,175,176,185,186,187,188,189,190,191,192,193,194,195,196,176,183,184,173,188,197,198,185,192,199,200,189,196,201,202,193,203,203,203,203,204,205,206,207,208,208,208,208,209,210,211,212,203,203,203,203,207,213,214,215,208,208,208,208,212,216,217,218,203,203,203,203,215,219,220,221,208,208,208,208,218,222,223,224,203,203,203,203,221,225,226,204,208,208,208,208,224,227,228,209,209,210,211,212,229,230,231,232,233,234,235,236,237,238,239,240,212,216,217,218,232,241,242,243,236,244,245,246,240,247,248,249,218,222,223,224,243,250,251,252,246,253,254,255,249,256,257,258,224,227,228,209,252,259,260,229,255,261,262,233,258,263,264,237,265,265,265,265,266,267,268,269,270,271,272,273,92,119,118,113,265,265,265,265,269,274,275,276,273,277,278,279,113,112,111,104,265,265,265,265,276,280,281,282,279,283,284,285,104,103,102,95,265,265,265,265,282,286,287,266,285,288,289,270,95,94,93,92],l=[1.4,0,2.4,1.4,-.784,2.4,.784,-1.4,2.4,0,-1.4,2.4,1.3375,0,2.53125,1.3375,-.749,2.53125,.749,-1.3375,2.53125,0,-1.3375,2.53125,1.4375,0,2.53125,1.4375,-.805,2.53125,.805,-1.4375,2.53125,0,-1.4375,2.53125,1.5,0,2.4,1.5,-.84,2.4,.84,-1.5,2.4,0,-1.5,2.4,-.784,-1.4,2.4,-1.4,-.784,2.4,-1.4,0,2.4,-.749,-1.3375,2.53125,-1.3375,-.749,2.53125,-1.3375,0,2.53125,-.805,-1.4375,2.53125,-1.4375,-.805,2.53125,-1.4375,0,2.53125,-.84,-1.5,2.4,-1.5,-.84,2.4,-1.5,0,2.4,-1.4,.784,2.4,-.784,1.4,2.4,0,1.4,2.4,-1.3375,.749,2.53125,-.749,1.3375,2.53125,0,1.3375,2.53125,-1.4375,.805,2.53125,-.805,1.4375,2.53125,0,1.4375,2.53125,-1.5,.84,2.4,-.84,1.5,2.4,0,1.5,2.4,.784,1.4,2.4,1.4,.784,2.4,.749,1.3375,2.53125,1.3375,.749,2.53125,.805,1.4375,2.53125,1.4375,.805,2.53125,.84,1.5,2.4,1.5,.84,2.4,1.75,0,1.875,1.75,-.98,1.875,.98,-1.75,1.875,0,-1.75,1.875,2,0,1.35,2,-1.12,1.35,1.12,-2,1.35,0,-2,1.35,2,0,.9,2,-1.12,.9,1.12,-2,.9,0,-2,.9,-.98,-1.75,1.875,-1.75,-.98,1.875,-1.75,0,1.875,-1.12,-2,1.35,-2,-1.12,1.35,-2,0,1.35,-1.12,-2,.9,-2,-1.12,.9,-2,0,.9,-1.75,.98,1.875,-.98,1.75,1.875,0,1.75,1.875,-2,1.12,1.35,-1.12,2,1.35,0,2,1.35,-2,1.12,.9,-1.12,2,.9,0,2,.9,.98,1.75,1.875,1.75,.98,1.875,1.12,2,1.35,2,1.12,1.35,1.12,2,.9,2,1.12,.9,2,0,.45,2,-1.12,.45,1.12,-2,.45,0,-2,.45,1.5,0,.225,1.5,-.84,.225,.84,-1.5,.225,0,-1.5,.225,1.5,0,.15,1.5,-.84,.15,.84,-1.5,.15,0,-1.5,.15,-1.12,-2,.45,-2,-1.12,.45,-2,0,.45,-.84,-1.5,.225,-1.5,-.84,.225,-1.5,0,.225,-.84,-1.5,.15,-1.5,-.84,.15,-1.5,0,.15,-2,1.12,.45,-1.12,2,.45,0,2,.45,-1.5,.84,.225,-.84,1.5,.225,0,1.5,.225,-1.5,.84,.15,-.84,1.5,.15,0,1.5,.15,1.12,2,.45,2,1.12,.45,.84,1.5,.225,1.5,.84,.225,.84,1.5,.15,1.5,.84,.15,-1.6,0,2.025,-1.6,-.3,2.025,-1.5,-.3,2.25,-1.5,0,2.25,-2.3,0,2.025,-2.3,-.3,2.025,-2.5,-.3,2.25,-2.5,0,2.25,-2.7,0,2.025,-2.7,-.3,2.025,-3,-.3,2.25,-3,0,2.25,-2.7,0,1.8,-2.7,-.3,1.8,-3,-.3,1.8,-3,0,1.8,-1.5,.3,2.25,-1.6,.3,2.025,-2.5,.3,2.25,-2.3,.3,2.025,-3,.3,2.25,-2.7,.3,2.025,-3,.3,1.8,-2.7,.3,1.8,-2.7,0,1.575,-2.7,-.3,1.575,-3,-.3,1.35,-3,0,1.35,-2.5,0,1.125,-2.5,-.3,1.125,-2.65,-.3,.9375,-2.65,0,.9375,-2,-.3,.9,-1.9,-.3,.6,-1.9,0,.6,-3,.3,1.35,-2.7,.3,1.575,-2.65,.3,.9375,-2.5,.3,1.125,-1.9,.3,.6,-2,.3,.9,1.7,0,1.425,1.7,-.66,1.425,1.7,-.66,.6,1.7,0,.6,2.6,0,1.425,2.6,-.66,1.425,3.1,-.66,.825,3.1,0,.825,2.3,0,2.1,2.3,-.25,2.1,2.4,-.25,2.025,2.4,0,2.025,2.7,0,2.4,2.7,-.25,2.4,3.3,-.25,2.4,3.3,0,2.4,1.7,.66,.6,1.7,.66,1.425,3.1,.66,.825,2.6,.66,1.425,2.4,.25,2.025,2.3,.25,2.1,3.3,.25,2.4,2.7,.25,2.4,2.8,0,2.475,2.8,-.25,2.475,3.525,-.25,2.49375,3.525,0,2.49375,2.9,0,2.475,2.9,-.15,2.475,3.45,-.15,2.5125,3.45,0,2.5125,2.8,0,2.4,2.8,-.15,2.4,3.2,-.15,2.4,3.2,0,2.4,3.525,.25,2.49375,2.8,.25,2.475,3.45,.15,2.5125,2.9,.15,2.475,3.2,.15,2.4,2.8,.15,2.4,0,0,3.15,.8,0,3.15,.8,-.45,3.15,.45,-.8,3.15,0,-.8,3.15,0,0,2.85,.2,0,2.7,.2,-.112,2.7,.112,-.2,2.7,0,-.2,2.7,-.45,-.8,3.15,-.8,-.45,3.15,-.8,0,3.15,-.112,-.2,2.7,-.2,-.112,2.7,-.2,0,2.7,-.8,.45,3.15,-.45,.8,3.15,0,.8,3.15,-.2,.112,2.7,-.112,.2,2.7,0,.2,2.7,.45,.8,3.15,.8,.45,3.15,.112,.2,2.7,.2,.112,2.7,.4,0,2.55,.4,-.224,2.55,.224,-.4,2.55,0,-.4,2.55,1.3,0,2.55,1.3,-.728,2.55,.728,-1.3,2.55,0,-1.3,2.55,1.3,0,2.4,1.3,-.728,2.4,.728,-1.3,2.4,0,-1.3,2.4,-.224,-.4,2.55,-.4,-.224,2.55,-.4,0,2.55,-.728,-1.3,2.55,-1.3,-.728,2.55,-1.3,0,2.55,-.728,-1.3,2.4,-1.3,-.728,2.4,-1.3,0,2.4,-.4,.224,2.55,-.224,.4,2.55,0,.4,2.55,-1.3,.728,2.55,-.728,1.3,2.55,0,1.3,2.55,-1.3,.728,2.4,-.728,1.3,2.4,0,1.3,2.4,.224,.4,2.55,.4,.224,2.55,.728,1.3,2.55,1.3,.728,2.55,.728,1.3,2.4,1.3,.728,2.4,0,0,0,1.425,0,0,1.425,.798,0,.798,1.425,0,0,1.425,0,1.5,0,.075,1.5,.84,.075,.84,1.5,.075,0,1.5,.075,-.798,1.425,0,-1.425,.798,0,-1.425,0,0,-.84,1.5,.075,-1.5,.84,.075,-1.5,0,.075,-1.425,-.798,0,-.798,-1.425,0,0,-1.425,0,-1.5,-.84,.075,-.84,-1.5,.075,0,-1.5,.075,.798,-1.425,0,1.425,-.798,0,.84,-1.5,.075,1.5,-.84,.075];BufferGeometry.call(this),e=e||50,t=void 0!==t?Math.max(2,Math.floor(t)||10):10,o=void 0===o||o;var u=3.15*((a=void 0===a||a)?1:1.3)/2,h=e/u,c=(i=void 0===i||i)?(8*t-4)*t:0;c+=(r=void 0===r||r)?(16*t-4)*t:0,c+=(n=void 0===n||n)?40*t*t:0;var d=new Uint32Array(3*c),p=i?4:0;p+=r?8:0,p+=n?20:0,p*=(t+1)*(t+1);var f=new Float32Array(3*p),m=new Float32Array(3*p),v=new Float32Array(2*p),g=new Matrix4;g.set(-1,3,-3,1,3,-6,3,0,-3,3,0,0,1,0,0,0);var y,_,b,x,w,S,M,T,A,C,L,N,P,k,E,D,O=[],R=[],F=[],I=[],B=[],U=[],V=[],z=[],G=[],j=new Vector3,W=0,H=0,q=new Vector3,Y=new Matrix4,X=new Matrix4,K=new Vector4,Q=new Vector4,Z=new Vector4,J=new Vector4,$=new Vector3,ee=new Vector3,te=g.clone();te.transpose();var ie=function(e,t,i){return!(f[3*e]===f[3*t]&&f[3*e+1]===f[3*t+1]&&f[3*e+2]===f[3*t+2]||f[3*e]===f[3*i]&&f[3*e+1]===f[3*i+1]&&f[3*e+2]===f[3*i+2]||f[3*t]===f[3*i]&&f[3*t+1]===f[3*i+1]&&f[3*t+2]===f[3*i+2])};for(y=0;y<3;y++)U[y]=new Matrix4;var re=i?32:28;M=t+1;for(var ne=0,oe=0,ae=0,se=0,le=0,ue=n?0:20;ue<re;ue++)if(r||ue<20||ue>=28){for(y=0;y<3;y++){for(_=0;_<4;_++)for(b=0;b<4;b++)O[4*b+_]=l[3*s[16*ue+4*_+b]+y],o&&ue>=20&&ue<28&&2!==y&&(O[4*b+_]*=1.077),a||2!==y||(O[4*b+_]*=1.3);Y.set(O[0],O[1],O[2],O[3],O[4],O[5],O[6],O[7],O[8],O[9],O[10],O[11],O[12],O[13],O[14],O[15]),X.multiplyMatrices(Y,g),U[y].multiplyMatrices(te,X)}for(w=0;w<=t;w++)for(T=w/t,S=0;S<=t;S++){for(A=S/t,N=4,C=L=1;N--;)R[N]=C,F[N]=L,C*=T,L*=A,3===N?(I[N]=B[N]=0,W=H=1):(I[N]=W*(3-N),B[N]=H*(3-N),W*=T,H*=A);for(K.fromArray(R),Q.fromArray(F),Z.fromArray(I),J.fromArray(B),y=0;y<3;y++)(x=K.clone()).applyMatrix4(U[y]),V[y]=x.dot(Q),(x=Z.clone()).applyMatrix4(U[y]),z[y]=x.dot(Q),(x=K.clone()).applyMatrix4(U[y]),G[y]=x.dot(J);$.fromArray(z),ee.fromArray(G),j.crossVectors(ee,$),j.normalize(),0===V[0]&&0===V[1]?q.set(0,V[2]>u?1:-1,0):q.set(j.x,j.z,-j.y),f[oe++]=h*V[0],f[oe++]=h*(V[2]-u),f[oe++]=-h*V[1],m[ae++]=q.x,m[ae++]=q.y,m[ae++]=q.z,v[se++]=1-A,v[se++]=1-T}for(w=0;w<t;w++)for(S=0;S<t;S++)D=(P=ne*M*M+w*M+S)+M,ie(P,k=P+1,E=k+M)&&(d[le++]=P,d[le++]=k,d[le++]=E),ie(P,E,D)&&(d[le++]=P,d[le++]=E,d[le++]=D);ne++}this.setIndex(new BufferAttribute(d,1)),this.addAttribute("position",new BufferAttribute(f,3)),this.addAttribute("normal",new BufferAttribute(m,3)),this.addAttribute("uv",new BufferAttribute(v,2)),this.computeBoundingSphere()};function DataTexture(e,t,i,r,n,o,a,s,l,u,h,c){Texture.call(this,null,o,a,s,l,u,r,n,h,c),this.image={data:e,width:t,height:i},this.magFilter=void 0!==l?l:NearestFilter,this.minFilter=void 0!==u?u:NearestFilter,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function GPUComputationRenderer(e,t,i){this.variables=[],this.currentTextureIndex=0;var r=new Scene,n=new Camera;n.position.z=1;var o={texture:{value:null}},a=u("uniform sampler2D texture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( texture, uv );\n\n}\n",o),s=new Mesh(new PlaneBufferGeometry(2,2),a);function l(i){i.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}function u(e,t){var i=new ShaderMaterial({uniforms:t=t||{},vertexShader:"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:e});return l(i),i}r.add(s),this.addVariable=function(e,t,i){var r={name:e,initialValueTexture:i,material:this.createShaderMaterial(t),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:NearestFilter,magFilter:NearestFilter};return this.variables.push(r),r},this.setVariableDependencies=function(e,t){e.dependencies=t},this.init=function(){if(!i.extensions.get("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===i.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(var r=0;r<this.variables.length;r++){var n=this.variables[r];n.renderTargets[0]=this.createRenderTarget(e,t,n.wrapS,n.wrapT,n.minFilter,n.magFilter),n.renderTargets[1]=this.createRenderTarget(e,t,n.wrapS,n.wrapT,n.minFilter,n.magFilter),this.renderTexture(n.initialValueTexture,n.renderTargets[0]),this.renderTexture(n.initialValueTexture,n.renderTargets[1]);var o=n.material,a=o.uniforms;if(null!==n.dependencies)for(var s=0;s<n.dependencies.length;s++){var l=n.dependencies[s];if(l.name!==n.name){for(var u=!1,h=0;h<this.variables.length;h++)if(l.name===this.variables[h].name){u=!0;break}if(!u)return"Variable dependency not found. Variable="+n.name+", dependency="+l.name}a[l.name]={value:null},o.fragmentShader="\nuniform sampler2D "+l.name+";\n"+o.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){for(var e=this.currentTextureIndex,t=0===this.currentTextureIndex?1:0,i=0,r=this.variables.length;i<r;i++){var n=this.variables[i];if(null!==n.dependencies)for(var o=n.material.uniforms,a=0,s=n.dependencies.length;a<s;a++){var l=n.dependencies[a];o[l.name].value=l.renderTargets[e].texture}this.doRenderTarget(n.material,n.renderTargets[t])}this.currentTextureIndex=t},this.getCurrentRenderTarget=function(e){return e.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(e){return e.renderTargets[0===this.currentTextureIndex?1:0]},this.addResolutionDefine=l,this.createShaderMaterial=u,this.createRenderTarget=function(i,r,n,o,a,s){return new WebGLRenderTarget(i=i||e,r=r||t,{wrapS:n=n||ClampToEdgeWrapping,wrapT:o=o||ClampToEdgeWrapping,minFilter:a=a||NearestFilter,magFilter:s=s||NearestFilter,format:RGBAFormat,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?HalfFloatType:FloatType,stencilBuffer:!1,depthBuffer:!1})},this.createTexture=function(){var i=new DataTexture(new Float32Array(e*t*4),e,t,RGBAFormat,FloatType);return i.needsUpdate=!0,i},this.renderTexture=function(e,t){o.texture.value=e,this.doRenderTarget(a,t),o.texture.value=null},this.doRenderTarget=function(e,t){var o=i.getRenderTarget();s.material=e,i.setRenderTarget(t),i.render(r,n),s.material=a,i.setRenderTarget(o)}}TeapotBufferGeometry.prototype=Object.create(BufferGeometry.prototype),TeapotBufferGeometry.prototype.constructor=TeapotBufferGeometry,DataTexture.prototype=Object.create(Texture.prototype),DataTexture.prototype.constructor=DataTexture,DataTexture.prototype.isDataTexture=!0;var Cache={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function LoadingManager(e,t,i){var r=this,n=!1,o=0,a=0,s=void 0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){a++,!1===n&&void 0!==r.onStart&&r.onStart(e,o,a),n=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,a),o===a&&(n=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this}}var DefaultLoadingManager=new LoadingManager;function ImageLoader(e){this.manager=void 0!==e?e:DefaultLoadingManager}function TextureLoader(e){this.manager=void 0!==e?e:DefaultLoadingManager}function PointsMaterial(e){Material$1.call(this),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function Points(e,t){Object3D.call(this),this.type="Points",this.geometry=void 0!==e?e:new BufferGeometry,this.material=void 0!==t?t:new PointsMaterial({color:16777215*Math.random()})}Object.assign(ImageLoader.prototype,{crossOrigin:"anonymous",load:function(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,o=Cache.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout(function(){t&&t(o),n.manager.itemEnd(e)},0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),Cache.add(e,this),t&&t(this),n.manager.itemEnd(e)}function l(t){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),r&&r(t),n.manager.itemError(e),n.manager.itemEnd(e)}return a.addEventListener("load",s,!1),a.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),n.manager.itemStart(e),a.src=e,a},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(TextureLoader.prototype,{crossOrigin:"anonymous",load:function(e,t,i,r){var n=new Texture,o=new ImageLoader(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(i){n.image=i;var r=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);n.format=r?RGBFormat:RGBAFormat,n.needsUpdate=!0,void 0!==t&&t(n)},i,r),n},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),PointsMaterial.prototype=Object.create(Material$1.prototype),PointsMaterial.prototype.constructor=PointsMaterial,PointsMaterial.prototype.isPointsMaterial=!0,PointsMaterial.prototype.copy=function(e){return Material$1.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this},Points.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Points,isPoints:!0,raycast:function(){var e=new Matrix4,t=new Ray,i=new Sphere;return function(r,n){var o=this,a=this.geometry,s=this.matrixWorld,l=r.params.Points.threshold;if(null===a.boundingSphere&&a.computeBoundingSphere(),i.copy(a.boundingSphere),i.applyMatrix4(s),i.radius+=l,!1!==r.ray.intersectsSphere(i)){e.getInverse(s),t.copy(r.ray).applyMatrix4(e);var u=l/((this.scale.x+this.scale.y+this.scale.z)/3),h=u*u,c=new Vector3,d=new Vector3;if(a.isBufferGeometry){var p=a.index,f=a.attributes.position.array;if(null!==p)for(var m=p.array,v=0,g=m.length;v<g;v++){var y=m[v];c.fromArray(f,3*y),x(c,y)}else{v=0;for(var _=f.length/3;v<_;v++)c.fromArray(f,3*v),x(c,v)}}else{var b=a.vertices;for(v=0,_=b.length;v<_;v++)x(b[v],v)}}function x(e,i){var a=t.distanceSqToPoint(e);if(a<h){t.closestPointToPoint(e,d),d.applyMatrix4(s);var l=r.ray.origin.distanceTo(d);if(l<r.near||l>r.far)return;n.push({distance:l,distanceToRay:Math.sqrt(a),point:d.clone(),index:i,face:null,object:o})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var GPUParticleSystem=function(e){Object3D.apply(this,arguments),e=e||{},this.PARTICLE_COUNT=e.maxParticles||1e6,this.PARTICLE_CONTAINERS=e.containerCount||1,this.PARTICLE_NOISE_TEXTURE=e.particleNoiseTex||null,this.PARTICLE_SPRITE_TEXTURE=e.particleSpriteTex||null,this.PARTICLES_PER_CONTAINER=Math.ceil(this.PARTICLE_COUNT/this.PARTICLE_CONTAINERS),this.PARTICLE_CURSOR=0,this.time=0,this.particleContainers=[],this.rand=[];var t,i={vertexShader:["uniform float uTime;","uniform float uScale;","uniform sampler2D tNoise;","attribute vec3 positionStart;","attribute float startTime;","attribute vec3 velocity;","attribute float turbulence;","attribute vec3 color;","attribute float size;","attribute float lifeTime;","varying vec4 vColor;","varying float lifeLeft;","void main() {","\tvColor = vec4( color, 1.0 );","\tvec3 newPosition;","\tvec3 v;","\tfloat timeElapsed = uTime - startTime;","\tlifeLeft = 1.0 - ( timeElapsed / lifeTime );","\tgl_PointSize = ( uScale * size ) * lifeLeft;","\tv.x = ( velocity.x - 0.5 ) * 3.0;","\tv.y = ( velocity.y - 0.5 ) * 3.0;","\tv.z = ( velocity.z - 0.5 ) * 3.0;","\tnewPosition = positionStart + ( v * 10.0 ) * timeElapsed;","\tvec3 noise = texture2D( tNoise, vec2( newPosition.x * 0.015 + ( uTime * 0.05 ), newPosition.y * 0.02 + ( uTime * 0.015 ) ) ).rgb;","\tvec3 noiseVel = ( noise.rgb - 0.5 ) * 30.0;","\tnewPosition = mix( newPosition, newPosition + vec3( noiseVel * ( turbulence * 5.0 ) ), ( timeElapsed / lifeTime ) );","\tif( v.y > 0. && v.y < .05 ) {","\t\tlifeLeft = 0.0;","\t}","\tif( v.x < - 1.45 ) {","\t\tlifeLeft = 0.0;","\t}","\tif( timeElapsed > 0.0 ) {","\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );","\t} else {","\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\t\tlifeLeft = 0.0;","\t\tgl_PointSize = 0.;","\t}","}"].join("\n"),fragmentShader:["float scaleLinear( float value, vec2 valueDomain ) {","\treturn ( value - valueDomain.x ) / ( valueDomain.y - valueDomain.x );","}","float scaleLinear( float value, vec2 valueDomain, vec2 valueRange ) {","\treturn mix( valueRange.x, valueRange.y, scaleLinear( value, valueDomain ) );","}","varying vec4 vColor;","varying float lifeLeft;","uniform sampler2D tSprite;","void main() {","\tfloat alpha = 0.;","\tif( lifeLeft > 0.995 ) {","\t\talpha = scaleLinear( lifeLeft, vec2( 1.0, 0.995 ), vec2( 0.0, 1.0 ) );","\t} else {","\t\talpha = lifeLeft * 0.75;","\t}","\tvec4 tex = texture2D( tSprite, gl_PointCoord );","\tgl_FragColor = vec4( vColor.rgb * tex.a, alpha * tex.a );","}"].join("\n")};for(t=1e5;t>0;t--)this.rand.push(Math.random()-.5);this.random=function(){return++t>=this.rand.length?this.rand[t=1]:this.rand[t]};var r=new TextureLoader;this.particleNoiseTex=this.PARTICLE_NOISE_TEXTURE||r.load("textures/perlin-512.png"),this.particleNoiseTex.wrapS=this.particleNoiseTex.wrapT=RepeatWrapping,this.particleSpriteTex=this.PARTICLE_SPRITE_TEXTURE||r.load("textures/particle2.png"),this.particleSpriteTex.wrapS=this.particleSpriteTex.wrapT=RepeatWrapping,this.particleShaderMat=new ShaderMaterial({transparent:!0,depthWrite:!1,uniforms:{uTime:{value:0},uScale:{value:1},tNoise:{value:this.particleNoiseTex},tSprite:{value:this.particleSpriteTex}},blending:AdditiveBlending,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader}),this.particleShaderMat.defaultAttributeValues.particlePositionsStartTime=[0,0,0,0],this.particleShaderMat.defaultAttributeValues.particleVelColSizeLife=[0,0,0,0],this.init=function(){for(var e=0;e<this.PARTICLE_CONTAINERS;e++){var t=new GPUParticleContainer(this.PARTICLES_PER_CONTAINER,this);this.particleContainers.push(t),this.add(t)}},this.spawnParticle=function(e){this.PARTICLE_CURSOR++,this.PARTICLE_CURSOR>=this.PARTICLE_COUNT&&(this.PARTICLE_CURSOR=1),this.particleContainers[Math.floor(this.PARTICLE_CURSOR/this.PARTICLES_PER_CONTAINER)].spawnParticle(e)},this.update=function(e){for(var t=0;t<this.PARTICLE_CONTAINERS;t++)this.particleContainers[t].update(e)},this.dispose=function(){this.particleShaderMat.dispose(),this.particleNoiseTex.dispose(),this.particleSpriteTex.dispose();for(var e=0;e<this.PARTICLE_CONTAINERS;e++)this.particleContainers[e].dispose()},this.init()};GPUParticleSystem.prototype=Object.create(Object3D.prototype),GPUParticleSystem.prototype.constructor=GPUParticleSystem;var GPUParticleContainer=function(e,t){Object3D.apply(this,arguments),this.PARTICLE_COUNT=e||1e5,this.PARTICLE_CURSOR=0,this.time=0,this.offset=0,this.count=0,this.DPR=window.devicePixelRatio,this.GPUParticleSystem=t,this.particleUpdate=!1,this.particleShaderGeo=new BufferGeometry,this.particleShaderGeo.addAttribute("position",new BufferAttribute(new Float32Array(3*this.PARTICLE_COUNT),3).setDynamic(!0)),this.particleShaderGeo.addAttribute("positionStart",new BufferAttribute(new Float32Array(3*this.PARTICLE_COUNT),3).setDynamic(!0)),this.particleShaderGeo.addAttribute("startTime",new BufferAttribute(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(!0)),this.particleShaderGeo.addAttribute("velocity",new BufferAttribute(new Float32Array(3*this.PARTICLE_COUNT),3).setDynamic(!0)),this.particleShaderGeo.addAttribute("turbulence",new BufferAttribute(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(!0)),this.particleShaderGeo.addAttribute("color",new BufferAttribute(new Float32Array(3*this.PARTICLE_COUNT),3).setDynamic(!0)),this.particleShaderGeo.addAttribute("size",new BufferAttribute(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(!0)),this.particleShaderGeo.addAttribute("lifeTime",new BufferAttribute(new Float32Array(this.PARTICLE_COUNT),1).setDynamic(!0)),this.particleShaderMat=this.GPUParticleSystem.particleShaderMat;var i=new Vector3,r=new Vector3,n=new Color;this.spawnParticle=function(e){var o=this.particleShaderGeo.getAttribute("positionStart"),a=this.particleShaderGeo.getAttribute("startTime"),s=this.particleShaderGeo.getAttribute("velocity"),l=this.particleShaderGeo.getAttribute("turbulence"),u=this.particleShaderGeo.getAttribute("color"),h=this.particleShaderGeo.getAttribute("size"),c=this.particleShaderGeo.getAttribute("lifeTime");i=void 0!==(e=e||{}).position?i.copy(e.position):i.set(0,0,0),r=void 0!==e.velocity?r.copy(e.velocity):r.set(0,0,0),n=void 0!==e.color?n.set(e.color):n.set(16777215);var d=void 0!==e.positionRandomness?e.positionRandomness:0,p=void 0!==e.velocityRandomness?e.velocityRandomness:0,f=void 0!==e.colorRandomness?e.colorRandomness:1,m=void 0!==e.turbulence?e.turbulence:1,v=void 0!==e.lifetime?e.lifetime:5,g=void 0!==e.size?e.size:10,y=void 0!==e.sizeRandomness?e.sizeRandomness:0,_=void 0!==e.smoothPosition&&e.smoothPosition;void 0!==this.DPR&&(g*=this.DPR);var b=this.PARTICLE_CURSOR;o.array[3*b+0]=i.x+t.random()*d,o.array[3*b+1]=i.y+t.random()*d,o.array[3*b+2]=i.z+t.random()*d,!0===_&&(o.array[3*b+0]+=-r.x*t.random(),o.array[3*b+1]+=-r.y*t.random(),o.array[3*b+2]+=-r.z*t.random());var x=r.x+t.random()*p,w=r.y+t.random()*p,S=r.z+t.random()*p;x=_Math.clamp((x- -2)/4,0,1),w=_Math.clamp((w- -2)/4,0,1),S=_Math.clamp((S- -2)/4,0,1),s.array[3*b+0]=x,s.array[3*b+1]=w,s.array[3*b+2]=S,n.r=_Math.clamp(n.r+t.random()*f,0,1),n.g=_Math.clamp(n.g+t.random()*f,0,1),n.b=_Math.clamp(n.b+t.random()*f,0,1),u.array[3*b+0]=n.r,u.array[3*b+1]=n.g,u.array[3*b+2]=n.b,l.array[b]=m,h.array[b]=g+t.random()*y,c.array[b]=v,a.array[b]=this.time+.02*t.random(),0===this.offset&&(this.offset=this.PARTICLE_CURSOR),this.count++,this.PARTICLE_CURSOR++,this.PARTICLE_CURSOR>=this.PARTICLE_COUNT&&(this.PARTICLE_CURSOR=0),this.particleUpdate=!0},this.init=function(){this.particleSystem=new Points(this.particleShaderGeo,this.particleShaderMat),this.particleSystem.frustumCulled=!1,this.add(this.particleSystem)},this.update=function(e){this.time=e,this.particleShaderMat.uniforms.uTime.value=e,this.geometryUpdate()},this.geometryUpdate=function(){if(!0===this.particleUpdate){this.particleUpdate=!1;var e=this.particleShaderGeo.getAttribute("positionStart"),t=this.particleShaderGeo.getAttribute("startTime"),i=this.particleShaderGeo.getAttribute("velocity"),r=this.particleShaderGeo.getAttribute("turbulence"),n=this.particleShaderGeo.getAttribute("color"),o=this.particleShaderGeo.getAttribute("size"),a=this.particleShaderGeo.getAttribute("lifeTime");this.offset+this.count<this.PARTICLE_COUNT?(e.updateRange.offset=this.offset*e.itemSize,t.updateRange.offset=this.offset*t.itemSize,i.updateRange.offset=this.offset*i.itemSize,r.updateRange.offset=this.offset*r.itemSize,n.updateRange.offset=this.offset*n.itemSize,o.updateRange.offset=this.offset*o.itemSize,a.updateRange.offset=this.offset*a.itemSize,e.updateRange.count=this.count*e.itemSize,t.updateRange.count=this.count*t.itemSize,i.updateRange.count=this.count*i.itemSize,r.updateRange.count=this.count*r.itemSize,n.updateRange.count=this.count*n.itemSize,o.updateRange.count=this.count*o.itemSize,a.updateRange.count=this.count*a.itemSize):(e.updateRange.offset=0,t.updateRange.offset=0,i.updateRange.offset=0,r.updateRange.offset=0,n.updateRange.offset=0,o.updateRange.offset=0,a.updateRange.offset=0,e.updateRange.count=-1,t.updateRange.count=-1,i.updateRange.count=-1,r.updateRange.count=-1,n.updateRange.count=-1,o.updateRange.count=-1,a.updateRange.count=-1),e.needsUpdate=!0,t.needsUpdate=!0,i.needsUpdate=!0,r.needsUpdate=!0,n.needsUpdate=!0,o.needsUpdate=!0,a.needsUpdate=!0,this.offset=0,this.count=0}},this.dispose=function(){this.particleShaderGeo.dispose()},this.init()};GPUParticleContainer.prototype=Object.create(Object3D.prototype),GPUParticleContainer.prototype.constructor=GPUParticleContainer;var Gyroscope=function(){Object3D.call(this)},translationObject,quaternionObject,scaleObject,translationWorld,quaternionWorld,scaleWorld;Gyroscope.prototype=Object.create(Object3D.prototype),Gyroscope.prototype.constructor=Gyroscope,Gyroscope.prototype.updateMatrixWorld=(translationObject=new Vector3,quaternionObject=new Quaternion,scaleObject=new Vector3,translationWorld=new Vector3,quaternionWorld=new Quaternion,scaleWorld=new Vector3,function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null!==this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(translationWorld,quaternionWorld,scaleWorld),this.matrix.decompose(translationObject,quaternionObject,scaleObject),this.matrixWorld.compose(translationWorld,quaternionObject,scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;t<i;t++)this.children[t].updateMatrixWorld(e)});var ImprovedNoise=function(){for(var e=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],t=0;t<256;t++)e[256+t]=e[t];function i(e){return e*e*e*(e*(6*e-15)+10)}function r(e,t,i){return t+e*(i-t)}function n(e,t,i,r){var n=15&e,o=n<8?t:i,a=n<4?i:12==n||14==n?t:r;return(0==(1&n)?o:-o)+(0==(2&n)?a:-a)}return{noise:function(t,o,a){var s=Math.floor(t),l=Math.floor(o),u=Math.floor(a),h=255&s,c=255&l,d=255&u,p=(t-=s)-1,f=(o-=l)-1,m=(a-=u)-1,v=i(t),g=i(o),y=i(a),_=e[h]+c,b=e[_]+d,x=e[_+1]+d,w=e[h+1]+c,S=e[w]+d,M=e[w+1]+d;return r(y,r(g,r(v,n(e[b],t,o,a),n(e[S],p,o,a)),r(v,n(e[x],t,f,a),n(e[M],p,f,a))),r(g,r(v,n(e[b+1],t,o,m),n(e[S+1],p,o,a-1)),r(v,n(e[x+1],t,f,m),n(e[M+1],p,f,m))))}}},p;function Frustum(e,t,i,r,n,o){this.planes=[void 0!==e?e:new Plane,void 0!==t?t:new Plane,void 0!==i?i:new Plane,void 0!==r?r:new Plane,void 0!==n?n:new Plane,void 0!==o?o:new Plane]}Object.assign(Frustum.prototype,{set:function(e,t,i,r,n,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(n),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,i=0;i<6;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,r=i[0],n=i[1],o=i[2],a=i[3],s=i[4],l=i[5],u=i[6],h=i[7],c=i[8],d=i[9],p=i[10],f=i[11],m=i[12],v=i[13],g=i[14],y=i[15];return t[0].setComponents(a-r,h-s,f-c,y-m).normalize(),t[1].setComponents(a+r,h+s,f+c,y+m).normalize(),t[2].setComponents(a+n,h+l,f+d,y+v).normalize(),t[3].setComponents(a-n,h-l,f-d,y-v).normalize(),t[4].setComponents(a-o,h-u,f-p,y-g).normalize(),t[5].setComponents(a+o,h+u,f+p,y+g).normalize(),this},intersectsObject:function(){var e=new Sphere;return function(t){var i=t.geometry;return null===i.boundingSphere&&i.computeBoundingSphere(),e.copy(i.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new Sphere;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,i=e.center,r=-e.radius,n=0;n<6;n++){if(t[n].distanceToPoint(i)<r)return!1}return!0},intersectsBox:(p=new Vector3,function(e){for(var t=this.planes,i=0;i<6;i++){var r=t[i];if(p.x=r.normal.x>0?e.max.x:e.min.x,p.y=r.normal.y>0?e.max.y:e.min.y,p.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(p)<0)return!1}return!0}),containsPoint:function(e){for(var t=this.planes,i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}});var SelectionBox=function(){var e=new Frustum,t=new Vector3;function i(e,t,i){this.camera=e,this.scene=t,this.startPoint=new Vector3,this.endPoint=new Vector3,this.collection=[],this.deep=i||Number.MAX_VALUE}return i.prototype.select=function(t,i){return this.startPoint=t||this.startPoint,this.endPoint=i||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(e,this.scene),this.collection},i.prototype.updateFrustum=function(t,i){t=t||this.startPoint,i=i||this.endPoint,this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld();var r=t.clone();r.x=Math.min(t.x,i.x),r.y=Math.max(t.y,i.y),i.x=Math.max(t.x,i.x),i.y=Math.min(t.y,i.y);var n=this.camera.position.clone(),o=r.clone(),a=new Vector3(i.x,r.y,0),s=i.clone(),l=new Vector3(r.x,i.y,0);o.unproject(this.camera),a.unproject(this.camera),s.unproject(this.camera),l.unproject(this.camera);var u=o.clone().sub(n),h=a.clone().sub(n),c=s.clone().sub(n);u.normalize(),h.normalize(),c.normalize(),u.multiplyScalar(this.deep),h.multiplyScalar(this.deep),c.multiplyScalar(this.deep),u.add(n),h.add(n),c.add(n);var d=e.planes;d[0].setFromCoplanarPoints(n,o,a),d[1].setFromCoplanarPoints(n,a,s),d[2].setFromCoplanarPoints(s,l,n),d[3].setFromCoplanarPoints(l,o,n),d[4].setFromCoplanarPoints(a,s,l),d[5].setFromCoplanarPoints(c,h,u),d[5].normal.multiplyScalar(-1)},i.prototype.searchChildInFrustum=function(e,i){if(i.isMesh&&void 0!==i.material&&(i.geometry.computeBoundingSphere(),t.copy(i.geometry.boundingSphere.center),t.applyMatrix4(i.matrixWorld),e.containsPoint(t)&&this.collection.push(i)),i.children.length>0)for(var r=0;r<i.children.length;r++)this.searchChildInFrustum(e,i.children[r])},i}(),SelectionHelper=function(){function e(e,t,i){this.element=document.createElement("div"),this.element.classList.add(i),this.element.style.pointerEvents="none",this.renderer=t,this.startPoint={x:0,y:0},this.pointTopLeft={x:0,y:0},this.pointBottomRight={x:0,y:0},this.isDown=!1,this.renderer.domElement.addEventListener("mousedown",function(e){this.isDown=!0,this.onSelectStart(e)}.bind(this),!1),this.renderer.domElement.addEventListener("mousemove",function(e){this.isDown&&this.onSelectMove(e)}.bind(this),!1),this.renderer.domElement.addEventListener("mouseup",function(e){this.isDown=!1,this.onSelectOver(e)}.bind(this),!1)}return e.prototype.onSelectStart=function(e){this.renderer.domElement.parentElement.appendChild(this.element),this.element.style.left=e.clientX+"px",this.element.style.top=e.clientY+"px",this.element.style.width="0px",this.element.style.height="0px",this.startPoint.x=e.clientX,this.startPoint.y=e.clientY},e.prototype.onSelectMove=function(e){this.pointBottomRight.x=Math.max(this.startPoint.x,e.clientX),this.pointBottomRight.y=Math.max(this.startPoint.y,e.clientY),this.pointTopLeft.x=Math.min(this.startPoint.x,e.clientX),this.pointTopLeft.y=Math.min(this.startPoint.y,e.clientY),this.element.style.left=this.pointTopLeft.x+"px",this.element.style.top=this.pointTopLeft.y+"px",this.element.style.width=this.pointBottomRight.x-this.pointTopLeft.x+"px",this.element.style.height=this.pointBottomRight.y-this.pointTopLeft.y+"px"},e.prototype.onSelectOver=function(){this.element.parentElement.removeChild(this.element)},e}();function InstancedBufferGeometry(){BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function InterleavedBuffer(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function InstancedInterleavedBuffer(e,t,i){InterleavedBuffer.call(this,e,t),this.meshPerAttribute=i||1}function InterleavedBufferAttribute(e,t,i,r){this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===r}function WireframeGeometry(e){BufferGeometry.call(this),this.type="WireframeGeometry";var t,i,r,n,o,a,s,l,u,h,c=[],d=[0,0],p={},f=["a","b","c"];if(e&&e.isGeometry){var m=e.faces;for(t=0,r=m.length;t<r;t++){var v=m[t];for(i=0;i<3;i++)s=v[f[i]],l=v[f[(i+1)%3]],d[0]=Math.min(s,l),d[1]=Math.max(s,l),void 0===p[u=d[0]+","+d[1]]&&(p[u]={index1:d[0],index2:d[1]})}for(u in p)a=p[u],h=e.vertices[a.index1],c.push(h.x,h.y,h.z),h=e.vertices[a.index2],c.push(h.x,h.y,h.z)}else if(e&&e.isBufferGeometry){var g,y,_,b,x,w,S;if(h=new Vector3,null!==e.index){for(g=e.attributes.position,y=e.index,0===(_=e.groups).length&&(_=[{start:0,count:y.count,materialIndex:0}]),n=0,o=_.length;n<o;++n)for(t=x=(b=_[n]).start,r=x+b.count;t<r;t+=3)for(i=0;i<3;i++)s=y.getX(t+i),l=y.getX(t+(i+1)%3),d[0]=Math.min(s,l),d[1]=Math.max(s,l),void 0===p[u=d[0]+","+d[1]]&&(p[u]={index1:d[0],index2:d[1]});for(u in p)a=p[u],h.fromBufferAttribute(g,a.index1),c.push(h.x,h.y,h.z),h.fromBufferAttribute(g,a.index2),c.push(h.x,h.y,h.z)}else for(t=0,r=(g=e.attributes.position).count/3;t<r;t++)for(i=0;i<3;i++)w=3*t+i,h.fromBufferAttribute(g,w),c.push(h.x,h.y,h.z),S=3*t+(i+1)%3,h.fromBufferAttribute(g,S),c.push(h.x,h.y,h.z)}this.addAttribute("position",new Float32BufferAttribute(c,3))}InstancedBufferGeometry.prototype=Object.assign(Object.create(BufferGeometry.prototype),{constructor:InstancedBufferGeometry,isInstancedBufferGeometry:!0,copy:function(e){return BufferGeometry.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),Object.defineProperty(InterleavedBuffer.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(InterleavedBuffer.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.stride:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,i){e*=this.stride,i*=t.stride;for(var r=0,n=this.stride;r<n;r++)this.array[e+r]=t.array[i+r];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),InstancedInterleavedBuffer.prototype=Object.assign(Object.create(InterleavedBuffer.prototype),{constructor:InstancedInterleavedBuffer,isInstancedInterleavedBuffer:!0,copy:function(e){return InterleavedBuffer.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.defineProperties(InterleavedBufferAttribute.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(InterleavedBufferAttribute.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this},setXYZ:function(e,t,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this},setXYZW:function(e,t,i,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this}}),WireframeGeometry.prototype=Object.create(BufferGeometry.prototype),WireframeGeometry.prototype.constructor=WireframeGeometry;var LineSegmentsGeometry=function(){InstancedBufferGeometry.call(this),this.type="LineSegmentsGeometry";new BufferGeometry;this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.addAttribute("position",new Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.addAttribute("uv",new Float32BufferAttribute([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))};LineSegmentsGeometry.prototype=Object.assign(Object.create(InstancedBufferGeometry.prototype),{constructor:LineSegmentsGeometry,isLineSegmentsGeometry:!0,applyMatrix:function(e){var t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return void 0!==t&&(e.applyToBufferAttribute(t),e.applyToBufferAttribute(i),t.data.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},setPositions:function(e){var t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));var i=new InstancedInterleavedBuffer(t,6,1);return this.addAttribute("instanceStart",new InterleavedBufferAttribute(i,3,0)),this.addAttribute("instanceEnd",new InterleavedBufferAttribute(i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(e){var t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));var i=new InstancedInterleavedBuffer(t,6,1);return this.addAttribute("instanceColorStart",new InterleavedBufferAttribute(i,3,0)),this.addAttribute("instanceColorEnd",new InterleavedBufferAttribute(i,3,3)),this},fromWireframeGeometry:function(e){return this.setPositions(e.attributes.position.array),this},fromEdgesGeometry:function(e){return this.setPositions(e.attributes.position.array),this},fromMesh:function(e){return this.fromWireframeGeometry(new WireframeGeometry(e.geometry)),this},fromLineSegements:function(e){var t=e.geometry;return t.isGeometry?this.setPositions(t.vertices):t.isBufferGeometry&&this.setPositions(t.position.array),this},computeBoundingBox:function(){var e=new Box3;return function(){null===this.boundingBox&&(this.boundingBox=new Box3);var t=this.attributes.instanceStart,i=this.attributes.instanceEnd;void 0!==t&&void 0!==i&&(this.boundingBox.setFromBufferAttribute(t),e.setFromBufferAttribute(i),this.boundingBox.union(e))}}(),computeBoundingSphere:function(){var e=new Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere),null===this.boundingBox&&this.computeBoundingBox();var t=this.attributes.instanceStart,i=this.attributes.instanceEnd;if(void 0!==t&&void 0!==i){var r=this.boundingSphere.center;this.boundingBox.getCenter(r);for(var n=0,o=0,a=t.count;o<a;o++)e.fromBufferAttribute(t,o),n=Math.max(n,r.distanceToSquared(e)),e.fromBufferAttribute(i,o),n=Math.max(n,r.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}(),toJSON:function(){},clone:function(){},copy:function(e){return this}}),UniformsLib.line={linewidth:{value:1},resolution:{value:new Vector2(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},ShaderLib.line={uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.fog,UniformsLib.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\tfloat a = vUv.x;\n\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t}\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );\n\n\t\t\t#include <premultiplied_alpha_fragment>\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\n\t\t}\n\t\t"};var LineMaterial=function(e){ShaderMaterial.call(this,{type:"LineMaterial",uniforms:UniformsUtils.clone(ShaderLib.line.uniforms),vertexShader:ShaderLib.line.vertexShader,fragmentShader:ShaderLib.line.fragmentShader}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}}}),this.setValues(e)};LineMaterial.prototype=Object.create(ShaderMaterial.prototype),LineMaterial.prototype.constructor=LineMaterial,LineMaterial.prototype.isLineMaterial=!0,LineMaterial.prototype.copy=function(e){return ShaderMaterial.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.resolution=e.resolution,this};var LineSegments2=function(e,t){Mesh.call(this),this.type="LineSegments2",this.geometry=void 0!==e?e:new LineSegmentsGeometry,this.material=void 0!==t?t:new LineMaterial({color:16777215*Math.random()})};LineSegments2.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:LineSegments2,isLineSegments2:!0,computeLineDistances:function(){var e=new Vector3,t=new Vector3;return function(){for(var i=this.geometry,r=i.attributes.instanceStart,n=i.attributes.instanceEnd,o=new Float32Array(2*r.data.count),a=0,s=0,l=r.data.count;a<l;a++,s+=2)e.fromBufferAttribute(r,a),t.fromBufferAttribute(n,a),o[s]=0===s?0:o[s-1],o[s+1]=o[s]+e.distanceTo(t);var u=new InstancedInterleavedBuffer(o,2,1);return i.addAttribute("instanceDistanceStart",new InterleavedBufferAttribute(u,1,0)),i.addAttribute("instanceDistanceEnd",new InterleavedBufferAttribute(u,1,1)),this}}(),copy:function(e){return this}});var LineGeometry=function(){LineSegmentsGeometry.call(this),this.type="LineGeometry"};LineGeometry.prototype=Object.assign(Object.create(LineSegmentsGeometry.prototype),{constructor:LineGeometry,isLineGeometry:!0,setPositions:function(e){for(var t=e.length-3,i=new Float32Array(2*t),r=0;r<t;r+=3)i[2*r]=e[r],i[2*r+1]=e[r+1],i[2*r+2]=e[r+2],i[2*r+3]=e[r+3],i[2*r+4]=e[r+4],i[2*r+5]=e[r+5];return LineSegmentsGeometry.prototype.setPositions.call(this,i),this},setColors:function(e){for(var t=e.length-3,i=new Float32Array(2*t),r=0;r<t;r+=3)i[2*r]=e[r],i[2*r+1]=e[r+1],i[2*r+2]=e[r+2],i[2*r+3]=e[r+3],i[2*r+4]=e[r+4],i[2*r+5]=e[r+5];return LineSegmentsGeometry.prototype.setColors.call(this,i),this},fromLine:function(e){var t=e.geometry;return t.isGeometry?this.setPositions(t.vertices):t.isBufferGeometry&&this.setPositions(t.position.array),this},copy:function(e){return this}});var Line2=function(e,t){LineSegments2.call(this),this.type="Line2",this.geometry=void 0!==e?e:new LineGeometry,this.material=void 0!==t?t:new LineMaterial({color:16777215*Math.random()})};Line2.prototype=Object.assign(Object.create(LineSegments2.prototype),{constructor:Line2,isLine2:!0,copy:function(e){return this}});var Wireframe=function(e,t){Mesh.call(this),this.type="Wireframe",this.geometry=void 0!==e?e:new LineSegmentsGeometry,this.material=void 0!==t?t:new LineMaterial({color:16777215*Math.random()})};Wireframe.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:Wireframe,isWireframe:!0,computeLineDistances:function(){var e=new Vector3,t=new Vector3;return function(){for(var i=this.geometry,r=i.attributes.instanceStart,n=i.attributes.instanceEnd,o=new Float32Array(2*r.data.count),a=0,s=0,l=r.data.count;a<l;a++,s+=2)e.fromBufferAttribute(r,a),t.fromBufferAttribute(n,a),o[s]=0===s?0:o[s-1],o[s+1]=o[s]+e.distanceTo(t);var u=new InstancedInterleavedBuffer(o,2,1);return i.addAttribute("instanceDistanceStart",new InterleavedBufferAttribute(u,1,0)),i.addAttribute("instanceDistanceEnd",new InterleavedBufferAttribute(u,1,1)),this}}(),copy:function(e){return this}});var WireframeGeometry2=function(e){LineSegmentsGeometry.call(this),this.type="WireframeGeometry2",this.fromWireframeGeometry(new WireframeGeometry(e))};WireframeGeometry2.prototype=Object.assign(Object.create(LineSegmentsGeometry.prototype),{constructor:WireframeGeometry2,isWireframeGeometry2:!0,copy:function(e){return this}});var loading={};function FileLoader(e){this.manager=void 0!==e?e:DefaultLoadingManager}function MeshPhongMaterial(e){Material$1.call(this),this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}Object.assign(FileLoader.prototype,{load:function(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,o=Cache.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout(function(){t&&t(o),n.manager.itemEnd(e)},0),o;if(void 0===loading[e]){var a=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],l=!!a[2],u=a[3];u=decodeURIComponent(u),l&&(u=atob(u));try{var h,c=(this.responseType||"").toLowerCase();switch(c){case"arraybuffer":case"blob":for(var d=new Uint8Array(u.length),p=0;p<u.length;p++)d[p]=u.charCodeAt(p);h="blob"===c?new Blob([d.buffer],{type:s}):d.buffer;break;case"document":var f=new DOMParser;h=f.parseFromString(u,s);break;case"json":h=JSON.parse(u);break;default:h=u}setTimeout(function(){t&&t(h),n.manager.itemEnd(e)},0)}catch(t){setTimeout(function(){r&&r(t),n.manager.itemError(e),n.manager.itemEnd(e)},0)}}else{loading[e]=[],loading[e].push({onLoad:t,onProgress:i,onError:r});var m=new XMLHttpRequest;for(var v in m.open("GET",e,!0),m.addEventListener("load",function(t){var i=this.response;Cache.add(e,i);var r=loading[e];if(delete loading[e],200===this.status||0===this.status){0===this.status&&console.warn("FileLoader: HTTP Status 0 received.");for(var o=0,a=r.length;o<a;o++){(s=r[o]).onLoad&&s.onLoad(i)}n.manager.itemEnd(e)}else{for(o=0,a=r.length;o<a;o++){var s;(s=r[o]).onError&&s.onError(t)}n.manager.itemError(e),n.manager.itemEnd(e)}},!1),m.addEventListener("progress",function(t){for(var i=loading[e],r=0,n=i.length;r<n;r++){var o=i[r];o.onProgress&&o.onProgress(t)}},!1),m.addEventListener("error",function(t){var i=loading[e];delete loading[e];for(var r=0,o=i.length;r<o;r++){var a=i[r];a.onError&&a.onError(t)}n.manager.itemError(e),n.manager.itemEnd(e)},!1),m.addEventListener("abort",function(t){var i=loading[e];delete loading[e];for(var r=0,o=i.length;r<o;r++){var a=i[r];a.onError&&a.onError(t)}n.manager.itemError(e),n.manager.itemEnd(e)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(v,this.requestHeader[v]);m.send(null)}return n.manager.itemStart(e),m}loading[e].push({onLoad:t,onProgress:i,onError:r})},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),MeshPhongMaterial.prototype=Object.create(Material$1.prototype),MeshPhongMaterial.prototype.constructor=MeshPhongMaterial,MeshPhongMaterial.prototype.isMeshPhongMaterial=!0,MeshPhongMaterial.prototype.copy=function(e){return Material$1.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};var LoaderUtils={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);return decodeURIComponent(escape(t))},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}},ThreeMFLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager,this.availableExtensions=[]};ThreeMFLoader.prototype={constructor:ThreeMFLoader,load:function(e,t,i,r){var n=this,o=new FileLoader(n.manager);o.setPath(n.path),o.setResponseType("arraybuffer"),o.load(e,function(e){t(n.parse(e))},i,r)},setPath:function(e){return this.path=e,this},parse:function(e){var t=this;function i(e){var t={type:e.getAttribute("type")},i=e.getAttribute("id");i&&(t.id=i);var r=e.getAttribute("pid");r&&(t.pid=r);var n=e.getAttribute("pindex");n&&(t.pindex=n);var o=e.getAttribute("thumbnail");o&&(t.thumbnail=o);var a=e.getAttribute("partnumber");a&&(t.partnumber=a);var s=e.getAttribute("name");s&&(t.name=s);var l=e.querySelector("mesh");l&&(t.mesh=function(e,t){for(var i={},r=[],n=e.querySelectorAll("vertices vertex"),o=0;o<n.length;o++){var a=n[o],s=a.getAttribute("x"),l=a.getAttribute("y"),u=a.getAttribute("z");r.push(parseFloat(s),parseFloat(l),parseFloat(u))}for(i.vertices=new Float32Array(r.length),o=0;o<r.length;o++)i.vertices[o]=r[o];var h=[],c=[],d=e.querySelectorAll("triangles triangle");for(o=0;o<d.length;o++){var p=d[o],f=p.getAttribute("v1"),m=p.getAttribute("v2"),v=p.getAttribute("v3"),g=p.getAttribute("p1"),y=p.getAttribute("p2"),_=p.getAttribute("p3"),b=p.getAttribute("pid");c.push(parseInt(f,10),parseInt(m,10),parseInt(v,10));var x={};g&&(x.p1=parseInt(g,10)),y&&(x.p2=parseInt(y,10)),_&&(x.p3=parseInt(_,10)),b&&(x.pid=b),0<Object.keys(x).length&&h.push(x)}for(i.triangleProperties=h,i.triangles=new Uint32Array(c.length),o=0;o<c.length;o++)i.triangles[o]=c[o];return i}(l));var u=e.querySelector("components");return u&&(t.components=void 0),t}function r(e){var t={unit:e.getAttribute("unit")||"millimeter"},r=e.querySelectorAll("metadata");r&&(t.metadata=function(e){for(var t={},i=0;i<e.length;i++){var r=e[i],n=r.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(n)&&(t[n]=r.textContent)}return t}(r));var n=e.querySelector("resources");n&&(t.resources=function(e){var t={},r=e.querySelector("basematerials");r&&(t.basematerial=void 0),t.object={};for(var n=e.querySelectorAll("object"),o=0;o<n.length;o++){var a=i(n[o]);t.object[a.id]=a}return t}(n));var o=e.querySelector("build");return o&&(t.build=function(e){for(var t=[],i=e.querySelectorAll("item"),r=0;r<i.length;r++){var n=i[r],o={objectid:n.getAttribute("objectid")},a=n.getAttribute("transform");if(a){var s=[];a.split(" ").forEach(function(e){s.push(parseFloat(e))});var l=new Matrix4;o.transform=l.set(s[0],s[3],s[6],s[9],s[1],s[4],s[7],s[10],s[2],s[5],s[8],s[11],0,0,0,1)}t.push(o)}return t}(o)),t}function n(e,t){var i=new BufferGeometry;i.setIndex(new BufferAttribute(e.triangles,1)),i.addAttribute("position",new BufferAttribute(e.vertices,3)),e.colors&&i.addAttribute("color",new BufferAttribute(e.colors,3)),i.computeBoundingSphere();var r={flatShading:!0};return e.colors&&0<e.colors.length?r.vertexColors=VertexColors:r.color=11184895,new Mesh(i,new MeshPhongMaterial(r))}function o(e,i,r,n){if(e){for(var o=[],a=Object.keys(e),s=0;s<a.length;s++)for(var l=a[s],u=0;u<t.availableExtensions.length;u++){(h=t.availableExtensions[u]).ns===l&&o.push(h)}for(s=0;s<o.length;s++){var h;(h=o[s]).apply(r,e[h.ns],i)}}}var a=function(e){var t,i,n=null,o=null,a=[],s=[],l={},u={};try{n=new JSZip(e)}catch(e){if(e instanceof ReferenceError)return console.error("ThreeMFLoader: jszip missing and file is compressed."),null}for(o in n.files)o.match(/\.rels$/)?t=o:o.match(/^3D\/.*\.model$/)?a.push(o):o.match(/^3D\/Metadata\/.*\.xml$/)||(o.match(/^3D\/Textures\/.*/)?s.push(o):o.match(/^3D\/Other\/.*/));var h=new Uint8Array(n.file(t).asArrayBuffer());i=function(e){var t=(new DOMParser).parseFromString(e,"application/xml").querySelector("Relationship"),i=t.getAttribute("Target"),r=t.getAttribute("Id"),n=t.getAttribute("Type");return{target:i,id:r,type:n}}(LoaderUtils.decodeText(h));for(var c=0;c<a.length;c++){var d=a[c],p=new Uint8Array(n.file(d).asArrayBuffer()),f=LoaderUtils.decodeText(p),m=(new DOMParser).parseFromString(f,"application/xml");"model"!==m.documentElement.nodeName.toLowerCase()&&console.error("ThreeMFLoader: Error loading 3MF - no 3MF document found: ",d);var v=m.querySelector("model"),g={};for(c=0;c<v.attributes.length;c++){var y=v.attributes[c];y.name.match(/^xmlns:(.+)$/)&&(g[y.value]=RegExp.$1)}var _=r(v);_.xml=v,0<Object.keys(g).length&&(_.extensions=g),l[d]=_}for(c=0;c<s.length;c++){var b=s[c];u[b]=n.file(b).asBinary()}return{rels:i,model:l,printTicket:{},texture:u,other:{}}}(e);return function(e,t,i){for(var r=new Group,n=i.model[t.target.substring(1)].build,o=0;o<n.length;o++){var a=n[o],s=e[a.objectid];a.transform&&s.geometry.applyMatrix(a.transform),r.add(s)}return r}(function(e){for(var t=e.model,i={},r=Object.keys(t),a=0;a<r.length;a++)for(var s=t[r[a]],l=s.xml,u=s.extensions,h=Object.keys(s.resources.object),c=0;c<h.length;c++){var d=h[c],p=s.resources.object[d].mesh;o(u,p,l),i[d]=n(p)}return i}(a),a.rels,a)},addExtension:function(e){this.availableExtensions.push(e)}};var AMFLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager};AMFLoader.prototype={constructor:AMFLoader,load:function(e,t,i,r){var n=this,o=new FileLoader(n.manager);o.setPath(n.path),o.setResponseType("arraybuffer"),o.load(e,function(e){t(n.parse(e))},i,r)},setPath:function(e){return this.path=e,this},parse:function(e){function t(e){for(var t="AMF Material",r=e.attributes.id.textContent,n={r:1,g:1,b:1,a:1},o=null,a=0;a<e.childNodes.length;a++){var s=e.childNodes[a];"metadata"===s.nodeName&&void 0!==s.attributes.type?"name"===s.attributes.type.value&&(t=s.textContent):"color"===s.nodeName&&(n=i(s))}return o=new MeshPhongMaterial({flatShading:!0,color:new Color(n.r,n.g,n.b),name:t}),1!==n.a&&(o.transparent=!0,o.opacity=n.a),{id:r,material:o}}function i(e){for(var t={r:1,g:1,b:1,a:1},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];"r"===r.nodeName?t.r=r.textContent:"g"===r.nodeName?t.g=r.textContent:"b"===r.nodeName?t.b=r.textContent:"a"===r.nodeName&&(t.a=r.textContent)}return t}function r(e){var t={name:"",triangles:[],materialid:null},i=e.firstElementChild;for(void 0!==e.attributes.materialid&&(t.materialId=e.attributes.materialid.nodeValue);i;){if("metadata"===i.nodeName)void 0!==i.attributes.type&&"name"===i.attributes.type.value&&(t.name=i.textContent);else if("triangle"===i.nodeName){var r=i.getElementsByTagName("v1")[0].textContent,n=i.getElementsByTagName("v2")[0].textContent,o=i.getElementsByTagName("v3")[0].textContent;t.triangles.push(r,n,o)}i=i.nextElementSibling}return t}function n(e){for(var t=[],i=[],r=e.firstElementChild;r;){if("vertex"===r.nodeName)for(var n=r.firstElementChild;n;){if("coordinates"===n.nodeName){var o=n.getElementsByTagName("x")[0].textContent,a=n.getElementsByTagName("y")[0].textContent,s=n.getElementsByTagName("z")[0].textContent;t.push(o,a,s)}else if("normal"===n.nodeName){var l=n.getElementsByTagName("nx")[0].textContent,u=n.getElementsByTagName("ny")[0].textContent,h=n.getElementsByTagName("nz")[0].textContent;i.push(l,u,h)}n=n.nextElementSibling}r=r.nextElementSibling}return{vertices:t,normals:i}}function o(e){for(var t=e.attributes.id.textContent,o={name:"amfobject",meshes:[]},a=null,s=e.firstElementChild;s;){if("metadata"===s.nodeName)void 0!==s.attributes.type&&"name"===s.attributes.type.value&&(o.name=s.textContent);else if("color"===s.nodeName)a=i(s);else if("mesh"===s.nodeName){for(var l=s.firstElementChild,u={vertices:[],normals:[],volumes:[],color:a};l;){if("vertices"===l.nodeName){var h=n(l);u.normals=u.normals.concat(h.normals),u.vertices=u.vertices.concat(h.vertices)}else"volume"===l.nodeName&&u.volumes.push(r(l));l=l.nextElementSibling}o.meshes.push(u)}s=s.nextElementSibling}return{id:t,obj:o}}var a,s,l=function(e){var t=new DataView(e);if("PK"===String.fromCharCode(t.getUint8(0),t.getUint8(1))){var i=null,r=null;console.log("AMFLoader: Loading Zip");try{i=new JSZip(e)}catch(e){if(e instanceof ReferenceError)return console.log("AMFLoader: jszip missing and file is compressed."),null}for(r in i.files)if(".amf"===r.toLowerCase().substr(-4))break;console.log("AMFLoader: Trying to load file asset: "+r),t=new DataView(i.file(r).asArrayBuffer())}var n=LoaderUtils.decodeText(t),o=(new DOMParser).parseFromString(n,"application/xml");return"amf"!==o.documentElement.nodeName.toLowerCase()?(console.log("AMFLoader: Error loading AMF - no AMF document found."),null):o}(e),u="",h="",c=function(e){var t=1,i="millimeter";void 0!==e.documentElement.attributes.unit&&(i=e.documentElement.attributes.unit.value.toLowerCase());var r={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return void 0!==r[i]&&(t=r[i]),console.log("AMFLoader: Unit scale: "+t),t}(l),d={},p={},f=l.documentElement.childNodes;for(a=0;a<f.length;a++){var m=f[a];if("metadata"===m.nodeName)void 0!==m.attributes.type&&("name"===m.attributes.type.value?u=m.textContent:"author"===m.attributes.type.value&&(h=m.textContent));else if("material"===m.nodeName){var v=t(m);d[v.id]=v.material}else if("object"===m.nodeName){var g=o(m);p[g.id]=g.obj}}var y=new Group,_=new MeshPhongMaterial({color:11184895,flatShading:!0});for(var b in y.name=u,y.userData.author=h,y.userData.loader="AMF",p){var x=p[b],w=x.meshes,S=new Group;for(S.name=x.name||"",a=0;a<w.length;a++){var M=_,T=w[a],A=new Float32BufferAttribute(T.vertices,3),C=null;if(T.normals.length&&(C=new Float32BufferAttribute(T.normals,3)),T.color){var L=T.color;(M=_.clone()).color=new Color(L.r,L.g,L.b),1!==L.a&&(M.transparent=!0,M.opacity=L.a)}var N=T.volumes;for(s=0;s<N.length;s++){var P=N[s],k=new BufferGeometry,E=M;k.setIndex(P.triangles),k.addAttribute("position",A.clone()),C&&k.addAttribute("normal",C.clone()),void 0!==d[P.materialId]&&(E=d[P.materialId]),k.scale(c,c,c),S.add(new Mesh(k,E.clone()))}}y.add(S)}return y}};var AssimpJSONLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager},offsetMatrix,identityMatrix;function Skeleton(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new Matrix4)}}function SkinnedMesh(e,t){e&&e.isGeometry&&console.error("SkinnedMesh no longer supports Geometry. Use BufferGeometry instead."),Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4}AssimpJSONLoader.prototype={constructor:AssimpJSONLoader,crossOrigin:"anonymous",load:function(e,t,i,r){var n=this,o=void 0===n.path?LoaderUtils.extractUrlBase(e):n.path,a=new FileLoader(this.manager);a.setPath(n.path),a.load(e,function(e){var i=JSON.parse(e),a=i.__metadata__;if(void 0!==a){if("assimp2json"!==a.format)return void r("AssimpJSONLoader: Not an assimp2json scene.");if(a.version<100&&a.version>=200)return void r("AssimpJSONLoader: Unsupported assimp2json file format version.")}t(n.parse(i,o))},i,r)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){function i(e,t){for(var i=new Array(e.length),r=0;r<e.length;++r)i[r]=t.call(this,e[r]);return i}var r=new TextureLoader(this.manager);r.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);var n=i(e.meshes,function(e){var t,i,r,n=new BufferGeometry,o=[],a=e.vertices||[],s=e.normals||[],l=e.texturecoords||[],u=e.colors||[];for(l=l[0]||[],t=0,i=e.faces.length;t<i;t++)r=e.faces[t],o.push(r[0],r[1],r[2]);return n.setIndex(o),n.addAttribute("position",new Float32BufferAttribute(a,3)),s.length>0&&n.addAttribute("normal",new Float32BufferAttribute(s,3)),l.length>0&&n.addAttribute("uv",new Float32BufferAttribute(l,2)),u.length>0&&n.addAttribute("color",new Float32BufferAttribute(u,3)),n.computeBoundingSphere(),n}),o=i(e.materials,function(e){var t=new MeshPhongMaterial;for(var i in e.properties){var n=e.properties[i],o=n.key,a=n.value;switch(o){case"$tex.file":var s=n.semantic;if(1===s||2===s||4===s||5===s||6===s){var l;switch(s){case 1:l="map";break;case 2:l="specularMap";break;case 4:l="emissiveMap";break;case 5:l="bumpMap";break;case 6:l="normalMap"}var u=r.load(a);u.wrapS=u.wrapT=RepeatWrapping,t[l]=u}break;case"?mat.name":t.name=a;break;case"$clr.diffuse":t.color.fromArray(a);break;case"$clr.specular":t.specular.fromArray(a);break;case"$clr.emissive":t.emissive.fromArray(a);break;case"$mat.shininess":t.shininess=a;break;case"$mat.shadingm":t.flatShading=1===a;break;case"$mat.opacity":a<1&&(t.opacity=a,t.transparent=!0)}}return t});return function e(t,i,r,n){var o,a,s=new Object3D;for(s.name=i.name||"",s.matrix=(new Matrix4).fromArray(i.transformation).transpose(),s.matrix.decompose(s.position,s.quaternion,s.scale),o=0;i.meshes&&o<i.meshes.length;o++)a=i.meshes[o],s.add(new Mesh(r[a],n[t.meshes[a].materialindex]));for(o=0;i.children&&o<i.children.length;o++)s.add(e(t,i.children[o],r,n));return s}(e,e.rootnode,n,o)}},Object.assign(Skeleton.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var i=new Matrix4;this.bones[e]&&i.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(i)}},pose:function(){var e,t,i;for(t=0,i=this.bones.length;t<i;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,i=this.bones.length;t<i;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:(offsetMatrix=new Matrix4,identityMatrix=new Matrix4,function(){for(var e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture,n=0,o=e.length;n<o;n++){var a=e[n]?e[n].matrixWorld:identityMatrix;offsetMatrix.multiplyMatrices(a,t[n]),offsetMatrix.toArray(i,16*n)}void 0!==r&&(r.needsUpdate=!0)}),clone:function(){return new Skeleton(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,i=this.bones.length;t<i;t++){var r=this.bones[t];if(r.name===e)return r}}}),SkinnedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:SkinnedMesh,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new Vector4,t=this.geometry.attributes.skinWeight,i=0,r=t.count;i<r;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);var n=1/e.manhattanLength();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Mesh.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var AssimpLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager};AssimpLoader.prototype={constructor:AssimpLoader,crossOrigin:"anonymous",load:function(e,t,i,r){var n=this,o=void 0===n.path?LoaderUtils.extractUrlBase(e):n.path,a=new FileLoader(this.manager);a.setPath(n.path),a.setResponseType("arraybuffer"),a.load(e,function(e){t(n.parse(e,o))},i,r)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){var i=new TextureLoader(this.manager);i.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);var r={KeyFrame:function(e,t){this.time=e,this.matrix=t.clone(),this.position=new Vector3,this.quaternion=new Quaternion,this.scale=new Vector3(1,1,1),this.matrix.decompose(this.position,this.quaternion,this.scale),this.clone=function(){return new r.KeyFrame(this.time,this.matrix)},this.lerp=function(e,t){var i=(t-=this.time)/(e.time-this.time),n=1-i,o=this.position,a=this.quaternion,s=e.position,l=e.quaternion;return r.KeyFrame.tempAniPos.x=o.x*n+s.x*i,r.KeyFrame.tempAniPos.y=o.y*n+s.y*i,r.KeyFrame.tempAniPos.z=o.z*n+s.z*i,r.KeyFrame.tempAniQuat.set(a.x,a.y,a.z,a.w),r.KeyFrame.tempAniQuat.slerp(l,i),r.KeyFrame.tempAniMatrix.compose(r.KeyFrame.tempAniPos,r.KeyFrame.tempAniQuat,r.KeyFrame.tempAniScale)}}};r.KeyFrame.tempAniPos=new Vector3,r.KeyFrame.tempAniQuat=new Quaternion,r.KeyFrame.tempAniScale=new Vector3(1,1,1),r.KeyFrame.tempAniMatrix=new Matrix4,r.KeyFrameTrack=function(){this.keys=[],this.target=null,this.time=0,this.length=0,this._accelTable={},this.fps=20,this.addKey=function(e){this.keys.push(e)},this.init=function(){if(this.sortKeys(),this.keys.length>0?this.length=this.keys[this.keys.length-1].time:this.length=0,this.fps)for(var e=0;e<this.length*this.fps;e++)for(var t=0;t<this.keys.length;t++){if(this.keys[t].time==e){this._accelTable[e]=t;break}if(this.keys[t].time<e/this.fps&&this.keys[t+1]&&this.keys[t+1].time>=e/this.fps){this._accelTable[e]=t;break}}},this.parseFromThree=function(e){var t=e.fps;this.target=e.node;for(var i=e.hierarchy[0].keys,n=0;n<i.length;n++)this.addKey(new r.KeyFrame(n/t||i[n].time,i[n].targets[0].data));this.init()},this.parseFromCollada=function(e){for(var t=e.keys,i=this.fps,n=0;n<t.length;n++)this.addKey(new r.KeyFrame(n/i||t[n].time,t[n].matrix));this.init()},this.sortKeys=function(){this.keys.sort(this.keySortFunc)},this.keySortFunc=function(e,t){return e.time-t.time},this.clone=function(){var e=new r.KeyFrameTrack;e.target=this.target,e.time=this.time,e.length=this.length;for(var t=0;t<this.keys.length;t++)e.addKey(this.keys[t].clone());return e.init(),e},this.reTarget=function(e,t){t||(t=r.TrackTargetNodeNameCompare),this.target=t(e,this.target)},this.keySearchAccel=function(e){return e*=this.fps,e=Math.floor(e),this._accelTable[e]||0},this.setTime=function(e){e=Math.abs(e),this.length&&(e=e%this.length+.05);for(var t=null,i=null,r=this.keySearchAccel(e);r<this.keys.length;r++){if(this.keys[r].time==e){t=this.keys[r],i=this.keys[r];break}if(this.keys[r].time<e&&this.keys[r+1]&&this.keys[r+1].time>e){t=this.keys[r],i=this.keys[r+1];break}if(this.keys[r].time<e&&r==this.keys.length-1){t=this.keys[r],(i=this.keys[0].clone()).time+=this.length+.05;break}}return t&&i&&t!==i?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(t.lerp(i,e)),void(this.target.matrixWorldNeedsUpdate=!0)):t&&i&&t==i?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(t.matrix),void(this.target.matrixWorldNeedsUpdate=!0)):void 0}},r.TrackTargetNodeNameCompare=function(e,t){return function e(t,i){if(t.name==i)return t;for(var r=0;r<t.children.length;r++){var n=e(t.children[r],i);if(n)return n}return null}(e,t.name)},r.Animation=function(){this.tracks=[],this.length=0,this.addTrack=function(e){this.tracks.push(e),this.length=Math.max(e.length,this.length)},this.setTime=function(e){this.time=e;for(var t=0;t<this.tracks.length;t++)this.tracks[t].setTime(e)},this.clone=function(e,t){t||(t=r.TrackTargetNodeNameCompare);var i=new r.Animation;i.target=e;for(var n=0;n<this.tracks.length;n++){var o=this.tracks[n].clone();o.reTarget(e,t),i.addTrack(o)}return i}};var n=4660,o=4661,a=4662,s=4663,l=4664,u=4665,h=4666,c=4667,d=4668,p=4669,f=4670,m=1,v=2,g=4,y=256,_=65536,b=1,x=4,w=1,S=3,M=1,T=6,A=8,C=10,L=4;function N(e){return y<<e}function P(e){return _<<e}function k(e,t){var i=new Bone;for(var r in i.matrix.copy(e.matrix),i.matrixWorld.copy(e.matrixWorld),i.position.copy(e.position),i.quaternion.copy(e.quaternion),i.scale.copy(e.scale),t.nodeCount++,i.name="bone_"+e.name+t.nodeCount.toString(),t.nodeToBoneMap[e.name]||(t.nodeToBoneMap[e.name]=[]),t.nodeToBoneMap[e.name].push(i),e.children){var n=k(e.children[r],t);n&&i.add(n)}return i}function E(e,t){for(var i=[],r=0;r<e.length;r++)i.push({i:e[r],w:t[r]});for(i.sort(function(e,t){return t.w-e.w});i.length<4;)i.push({i:0,w:0});i.length>4&&(i.length=4);var n=0;for(r=0;r<4;r++)n+=i[r].w*i[r].w;n=Math.sqrt(n);for(r=0;r<4;r++)i[r].w=i[r].w/n,e[r]=i[r].i,t[r]=i[r].w}function D(e,t){if(0==e.name.indexOf("bone_"+t))return e;for(var i in e.children){var r=D(e.children[i],t);if(r)return r}}function O(){this.mPrimitiveTypes=0,this.mNumVertices=0,this.mNumFaces=0,this.mNumBones=0,this.mMaterialIndex=0,this.mVertices=[],this.mNormals=[],this.mTangents=[],this.mBitangents=[],this.mColors=[[]],this.mTextureCoords=[[]],this.mFaces=[],this.mBones=[],this.hookupSkeletons=function(e,t){if(0!=this.mBones.length){for(var i=[],r=[],n=e.findNode(this.mBones[0].mName);n.mParent&&n.mParent.isBone;)n=n.mParent;var o=k(l=n.toTHREE(e),e);this.threeNode.add(o);for(var a=0;a<this.mBones.length;a++){if(u=D(o,this.mBones[a].mName)){var s=u;i.push(s),r.push(this.mBones[a].mOffsetMatrix.toTHREE())}else{if(!(n=e.findNode(this.mBones[a].mName)))return;var l;(l=n.toTHREE(e)).parent,o=k(l,e);this.threeNode.add(o);var u;s=u=D(o,this.mBones[a].mName);i.push(s),r.push(this.mBones[a].mOffsetMatrix.toTHREE())}}var h=new Skeleton(i,r);this.threeNode.bind(h,new Matrix4),this.threeNode.material.skinning=!0}},this.toTHREE=function(e){if(this.threeNode)return this.threeNode;var t,i,r=new BufferGeometry;if(t=e.mMaterials[this.mMaterialIndex]?e.mMaterials[this.mMaterialIndex].toTHREE(e):new MeshLambertMaterial,r.setIndex(new BufferAttribute(new Uint32Array(this.mIndexArray),1)),r.addAttribute("position",new BufferAttribute(this.mVertexBuffer,3)),this.mNormalBuffer&&this.mNormalBuffer.length>0&&r.addAttribute("normal",new BufferAttribute(this.mNormalBuffer,3)),this.mColorBuffer&&this.mColorBuffer.length>0&&r.addAttribute("color",new BufferAttribute(this.mColorBuffer,4)),this.mTexCoordsBuffers[0]&&this.mTexCoordsBuffers[0].length>0&&r.addAttribute("uv",new BufferAttribute(new Float32Array(this.mTexCoordsBuffers[0]),2)),this.mTexCoordsBuffers[1]&&this.mTexCoordsBuffers[1].length>0&&r.addAttribute("uv1",new BufferAttribute(new Float32Array(this.mTexCoordsBuffers[1]),2)),this.mTangentBuffer&&this.mTangentBuffer.length>0&&r.addAttribute("tangents",new BufferAttribute(this.mTangentBuffer,3)),this.mBitangentBuffer&&this.mBitangentBuffer.length>0&&r.addAttribute("bitangents",new BufferAttribute(this.mBitangentBuffer,3)),this.mBones.length>0){for(var n=[],o=[],a=0;a<this.mBones.length;a++)for(var s=0;s<this.mBones[a].mWeights.length;s++){var l=this.mBones[a].mWeights[s];l&&(n[l.mVertexId]||(n[l.mVertexId]=[]),o[l.mVertexId]||(o[l.mVertexId]=[]),n[l.mVertexId].push(l.mWeight),o[l.mVertexId].push(parseInt(a)))}for(var a in o)E(o[a],n[a]);var u=[],h=[];for(a=0;a<n.length;a++)for(s=0;s<4;s++)n[a]&&o[a]?(u.push(n[a][s]),h.push(o[a][s])):(u.push(0),h.push(0));r.addAttribute("skinWeight",new BufferAttribute(new Float32Array(u),L)),r.addAttribute("skinIndex",new BufferAttribute(new Float32Array(h),L))}return 0==this.mBones.length&&(i=new Mesh(r,t)),this.mBones.length>0&&(i=new SkinnedMesh(r,t)).normalizeSkinWeights(),this.threeNode=i,i}}function R(){this.mNumIndices=0,this.mIndices=[]}function F(){this.x=0,this.y=0,this.z=0,this.toTHREE=function(){return new Vector3(this.x,this.y,this.z)}}function I(){this.r=0,this.g=0,this.b=0,this.a=0,this.toTHREE=function(){return new Color(this.r,this.g,this.b,1)}}function B(){this.x=0,this.y=0,this.z=0,this.w=0,this.toTHREE=function(){return new Quaternion(this.x,this.y,this.z,this.w)}}function U(){this.mVertexId=0,this.mWeight=0}function V(){this.data=[],this.toString=function(){var e="";return this.data.forEach(function(t){e+=String.fromCharCode(t)}),e.replace(/[^\x20-\x7E]+/g,"")}}function z(){this.mTime=0,this.mValue=null}function G(){this.mTime=0,this.mValue=null}function j(){this.mName="",this.mTransformation=[],this.mNumChildren=0,this.mNumMeshes=0,this.mMeshes=[],this.mChildren=[],this.toTHREE=function(e){if(this.threeNode)return this.threeNode;var t=new Object3D;t.name=this.mName,t.matrix=this.mTransformation.toTHREE();for(var i=0;i<this.mChildren.length;i++)t.add(this.mChildren[i].toTHREE(e));for(i=0;i<this.mMeshes.length;i++)t.add(e.mMeshes[this.mMeshes[i]].toTHREE(e));return this.threeNode=t,t.matrix.decompose(t.position,t.quaternion,t.scale),t}}function W(){this.mName="",this.mNumWeights=0,this.mOffsetMatrix=0}function H(){this.mKey="",this.mSemantic=0,this.mIndex=0,this.mData=[],this.mDataLength=0,this.mType=0,this.dataAsColor=function(){var e=new Uint8Array(this.mData).buffer,t=new DataView(e);return new Color(t.getFloat32(0,!0),t.getFloat32(4,!0),t.getFloat32(8,!0))},this.dataAsFloat=function(){var e=new Uint8Array(this.mData).buffer;return new DataView(e).getFloat32(0,!0)},this.dataAsBool=function(){var e=new Uint8Array(this.mData).buffer;return!!new DataView(e).getFloat32(0,!0)},this.dataAsString=function(){var e=new V;return e.data=this.mData,e.toString()},this.dataAsMap=function(){var e=new V;e.data=this.mData;var t=e.toString();return-1!=(t=t.replace(/\\/g,"/")).indexOf("/")&&(t=t.substr(t.lastIndexOf("/")+1)),i.load(t)}}var q={"?mat.name":"name","$mat.shadingm":"shading","$mat.twosided":"twoSided","$mat.wireframe":"wireframe","$clr.ambient":"ambient","$clr.diffuse":"color","$clr.specular":"specular","$clr.emissive":"emissive","$clr.transparent":"transparent","$clr.reflective":"reflect","$mat.shininess":"shininess","$mat.reflectivity":"reflectivity","$mat.refracti":"refraction","$tex.file":"map"},Y={"?mat.name":"string","$mat.shadingm":"bool","$mat.twosided":"bool","$mat.wireframe":"bool","$clr.ambient":"color","$clr.diffuse":"color","$clr.specular":"color","$clr.emissive":"color","$clr.transparent":"color","$clr.reflective":"color","$mat.shininess":"float","$mat.reflectivity":"float","$mat.refracti":"float","$tex.file":"map"};function X(){this.mNumAllocated=0,this.mNumProperties=0,this.mProperties=[],this.toTHREE=function(e){this.mProperties[0].dataAsString();for(var t=new MeshPhongMaterial,i=0;i<this.mProperties.length;i++)if("float"==Y[this.mProperties[i].mKey]&&(t[q[this.mProperties[i].mKey]]=this.mProperties[i].dataAsFloat()),"color"==Y[this.mProperties[i].mKey]&&(t[q[this.mProperties[i].mKey]]=this.mProperties[i].dataAsColor()),"bool"==Y[this.mProperties[i].mKey]&&(t[q[this.mProperties[i].mKey]]=this.mProperties[i].dataAsBool()),"string"==Y[this.mProperties[i].mKey]&&(t[q[this.mProperties[i].mKey]]=this.mProperties[i].dataAsString()),"map"==Y[this.mProperties[i].mKey]){var r=this.mProperties[i];r.mSemantic==M&&(t.map=this.mProperties[i].dataAsMap()),r.mSemantic==T&&(t.normalMap=this.mProperties[i].dataAsMap()),r.mSemantic==C&&(t.lightMap=this.mProperties[i].dataAsMap()),r.mSemantic==A&&(t.alphaMap=this.mProperties[i].dataAsMap())}return t.ambient.r=.53,t.ambient.g=.53,t.ambient.b=.53,t.color.r=1,t.color.g=1,t.color.b=1,t}}function K(e,t,i){var r=new Vector3,n=1-i;return r.x=e.x*i+t.x*n,r.y=e.y*i+t.y*n,r.z=e.z*i+t.z*n,r}function Q(e,t,i){return e.clone().slerp(t,1-i)}function Z(e,t,i,r){if(1==e.length)return e[0].mValue.toTHREE();for(var n=1/0,o=null,a=null,s=0;s<e.length;s++){var l=Math.abs(e[s].mTime-t);l<n&&e[s].mTime<=t&&(n=l,o=e[s],a=e[s+1])}if(o){if(a){var u=a.mTime-o.mTime,h=(o.mTime-t)/u;return r(o.mValue.toTHREE(),a.mValue.toTHREE(),h)}(a=e[0].clone()).mTime+=i;u=a.mTime-o.mTime,h=(o.mTime-t)/u;return r(o.mValue.toTHREE(),a.mValue.toTHREE(),h)}return null}function J(){this.mNodeName="",this.mNumPositionKeys=0,this.mNumRotationKeys=0,this.mNumScalingKeys=0,this.mPositionKeys=[],this.mRotationKeys=[],this.mScalingKeys=[],this.mPreState="",this.mPostState="",this.init=function(e){function t(t){t.mTime/=e}e||(e=1),this.mPositionKeys.forEach(t),this.mRotationKeys.forEach(t),this.mScalingKeys.forEach(t)},this.sortKeys=function(){function e(e,t){return e.mTime-t.mTime}this.mPositionKeys.sort(e),this.mRotationKeys.sort(e),this.mScalingKeys.sort(e)},this.getLength=function(){return Math.max(Math.max.apply(null,this.mPositionKeys.map(function(e){return e.mTime})),Math.max.apply(null,this.mRotationKeys.map(function(e){return e.mTime})),Math.max.apply(null,this.mScalingKeys.map(function(e){return e.mTime})))},this.toTHREE=function(e,t){this.sortKeys();for(var i=this.getLength(),n=new r.KeyFrameTrack,o=0;o<i;o+=.05){var a=new Matrix4,s=o,l=Z(this.mPositionKeys,s,i,K),u=Z(this.mScalingKeys,s,i,K),h=Z(this.mRotationKeys,s,i,Q);a.compose(l,h,u);var c=new r.KeyFrame(s,a);n.addKey(c)}n.target=e.findNode(this.mNodeName).toTHREE();var d=[n];if(e.nodeToBoneMap[this.mNodeName])for(o=0;o<e.nodeToBoneMap[this.mNodeName].length;o++){var p=n.clone();p.target=e.nodeToBoneMap[this.mNodeName][o],d.push(p)}return d}}function $(){this.mName="",this.mDuration=0,this.mTicksPerSecond=0,this.mNumChannels=0,this.mChannels=[],this.toTHREE=function(e){var t=new r.Animation;for(var i in this.mChannels){this.mChannels[i].init(this.mTicksPerSecond);var n=this.mChannels[i].toTHREE(e);for(var o in n)n[o].init(),t.addTrack(n[o])}return t.length=Math.max.apply(null,t.tracks.map(function(e){return e.length})),t}}function ee(){this.mWidth=0,this.mHeight=0,this.texAchFormatHint=[],this.pcData=[]}function te(){this.mName="",this.mType=0,this.mAttenuationConstant=0,this.mAttenuationLinear=0,this.mAttenuationQuadratic=0,this.mAngleInnerCone=0,this.mAngleOuterCone=0,this.mColorDiffuse=null,this.mColorSpecular=null,this.mColorAmbient=null}function ie(){this.mName="",this.mPosition=null,this.mLookAt=null,this.mUp=null,this.mHorizontalFOV=0,this.mClipPlaneNear=0,this.mClipPlaneFar=0,this.mAspect=0}function re(){this.mFlags=0,this.mNumMeshes=0,this.mNumMaterials=0,this.mNumAnimations=0,this.mNumTextures=0,this.mNumLights=0,this.mNumCameras=0,this.mRootNode=null,this.mMeshes=[],this.mMaterials=[],this.mAnimations=[],this.mLights=[],this.mCameras=[],this.nodeToBoneMap={},this.findNode=function(e,t){if(t||(t=this.mRootNode),t.mName==e)return t;for(var i=0;i<t.mChildren.length;i++){var r=this.findNode(e,t.mChildren[i]);if(r)return r}return null},this.toTHREE=function(){this.nodeCount=0,function(e){for(var t in e.mMeshes){var i=e.mMeshes[t];for(var r in i.mBones){var n=e.findNode(i.mBones[r].mName);n&&(n.isBone=!0)}}}(this);var e=this.mRootNode.toTHREE(this);for(var t in this.mMeshes)this.mMeshes[t].hookupSkeletons(this,e);if(this.mAnimations.length>0)var i=this.mAnimations[0].toTHREE(this);return{object:e,animation:i}}}function ne(){this.elements=[[],[],[],[]],this.toTHREE=function(){for(var e=new Matrix4,t=0;t<4;++t)for(var i=0;i<4;++i)e.elements[4*t+i]=this.elements[i][t];return e}}var oe=!0;function ae(e){var t=e.getFloat32(e.readOffset,oe);return e.readOffset+=4,t}function se(e){var t=e.getFloat64(e.readOffset,oe);return e.readOffset+=8,t}function le(e){var t=e.getUint16(e.readOffset,oe);return e.readOffset+=2,t}function ue(e){var t=e.getUint32(e.readOffset,oe);return e.readOffset+=4,t}function he(e){var t=e.getUint32(e.readOffset,oe);return e.readOffset+=4,t}function ce(e){var t=new F;return t.x=ae(e),t.y=ae(e),t.z=ae(e),t}function de(e){var t=new I;return t.r=ae(e),t.g=ae(e),t.b=ae(e),t}function pe(e){var t=new V,i=ue(e);return e.ReadBytes(t.data,1,i),t.toString()}function fe(e){var t=new U;return t.mVertexId=ue(e),t.mWeight=ae(e),t}function me(e){for(var t=new ne,i=0;i<4;++i)for(var r=0;r<4;++r)t.elements[i][r]=ae(e);return t}function ve(e){var t=new z;return t.mTime=se(e),t.mValue=ce(e),t}function ge(e){var t=new G;return t.mTime=se(e),t.mValue=function(e){var t=new B;return t.w=ae(e),t.x=ae(e),t.y=ae(e),t.z=ae(e),t}(e),t}function ye(e,t,i){for(var r=0;r<i;r++)t[r]=ve(e)}function _e(e,t,i){return e.Seek(sizeof(t)*i,De)}function be(e){if(!e)throw"asset failed"}function xe(e,t){return be(he(e)==h),he(e),t.mName=pe(e),t.mNumWeights=ue(e),t.mOffsetMatrix=me(e),ke?_e(e,t.mWeights,t.mNumWeights):(t.mWeights=[],function(e,t,i){for(var r=0;r<i;r++)t[r]=fe(e)}(e,t.mWeights,t.mNumWeights)),t}function we(e,t){be(he(e)==s),he(e),t.mPrimitiveTypes=ue(e),t.mNumVertices=ue(e),t.mNumFaces=ue(e),t.mNumBones=ue(e),t.mMaterialIndex=ue(e),t.mNumUVComponents=[];var i=ue(e);i&m&&(ke?_e(e,t.mVertices,t.mNumVertices):(t.mVertices=[],t.mVertexBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,De))),i&v&&(ke?_e(e,t.mNormals,t.mNumVertices):(t.mNormals=[],t.mNormalBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,De))),i&g&&(ke?(_e(e,t.mTangents,t.mNumVertices),_e(e,t.mBitangents,t.mNumVertices)):(t.mTangents=[],t.mTangentBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,De),t.mBitangents=[],t.mBitangentBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,De)));for(var r=0;r<b&&i&P(r);++r)ke?_e(e,t.mColors[r],t.mNumVertices):(t.mColors[r]=[],t.mColorBuffer=e.subArray32(e.readOffset,e.readOffset+4*t.mNumVertices*4),e.Seek(4*t.mNumVertices*4,De));t.mTexCoordsBuffers=[];for(r=0;r<x&&i&N(r);++r)if(t.mNumUVComponents[r]=ue(e),ke)_e(e,t.mTextureCoords[r],t.mNumVertices);else{t.mTextureCoords[r]=[],t.mTexCoordsBuffers[r]=[];for(var n=0;n<t.mNumVertices;n++)t.mTexCoordsBuffers[r].push(ae(e)),t.mTexCoordsBuffers[r].push(ae(e)),ae(e)}if(ke)ue(e);else{t.mFaces=[],t.mIndexArray=[];for(var o=0;o<t.mNumFaces;++o){var a=t.mFaces[o]=new R;a.mNumIndices=le(e),a.mIndices=[];for(var l=0;l<a.mNumIndices;++l)t.mNumVertices<65536?a.mIndices[l]=le(e):a.mIndices[l]=ue(e);if(3===a.mNumIndices)t.mIndexArray.push(a.mIndices[0]),t.mIndexArray.push(a.mIndices[1]),t.mIndexArray.push(a.mIndices[2]);else{if(4!==a.mNumIndices)throw new Error("Sorry, can't currently triangulate polys. Use the triangulate preprocessor in Assimp.");t.mIndexArray.push(a.mIndices[0]),t.mIndexArray.push(a.mIndices[1]),t.mIndexArray.push(a.mIndices[2]),t.mIndexArray.push(a.mIndices[2]),t.mIndexArray.push(a.mIndices[3]),t.mIndexArray.push(a.mIndices[0])}}}if(t.mNumBones){t.mBones=[];for(l=0;l<t.mNumBones;++l)t.mBones[l]=new W,xe(e,t.mBones[l])}}function Se(e,t){be(he(e)==f),he(e),t.mKey=pe(e),t.mSemantic=ue(e),t.mIndex=ue(e),t.mDataLength=ue(e),t.mType=ue(e),t.mData=[],e.ReadBytes(t.mData,1,t.mDataLength)}function Me(e,t){if(be(he(e)==p),he(e),t.mNumAllocated=t.mNumProperties=ue(e),t.mNumProperties){t.mProperties&&delete t.mProperties,t.mProperties=[];for(var i=0;i<t.mNumProperties;++i)t.mProperties[i]=new H,Se(e,t.mProperties[i])}}function Te(e,t){be(he(e)==l),he(e),t.mNodeName=pe(e),t.mNumPositionKeys=ue(e),t.mNumRotationKeys=ue(e),t.mNumScalingKeys=ue(e),t.mPreState=ue(e),t.mPostState=ue(e),t.mNumPositionKeys&&(ke?_e(e,t.mPositionKeys,t.mNumPositionKeys):(t.mPositionKeys=[],ye(e,t.mPositionKeys,t.mNumPositionKeys))),t.mNumRotationKeys&&(ke?_e(e,t.mRotationKeys,t.mNumRotationKeys):(t.mRotationKeys=[],function(e,t,i){for(var r=0;r<i;r++)t[r]=ge(e)}(e,t.mRotationKeys,t.mNumRotationKeys))),t.mNumScalingKeys&&(ke?_e(e,t.mScalingKeys,t.mNumScalingKeys):(t.mScalingKeys=[],ye(e,t.mScalingKeys,t.mNumScalingKeys)))}function Ae(e,t){if(be(he(e)==c),he(e),t.mName=pe(e),t.mDuration=se(e),t.mTicksPerSecond=se(e),t.mNumChannels=ue(e),t.mNumChannels){t.mChannels=[];for(var i=0;i<t.mNumChannels;++i)t.mChannels[i]=new J,Te(e,t.mChannels[i])}}function Ce(e,t){be(he(e)==a),he(e),t.mWidth=ue(e),t.mHeight=ue(e),e.ReadBytes(t.achFormatHint,1,4),ke||(t.mHeight?(t.pcData=[],e.ReadBytes(t.pcData,1,t.mWidth*t.mHeight*4)):(t.pcData=[],e.ReadBytes(t.pcData,1,t.mWidth)))}function Le(e,t){be(he(e)==o),he(e),t.mName=pe(e),t.mType=ue(e),t.mType!=w&&(t.mAttenuationConstant=ae(e),t.mAttenuationLinear=ae(e),t.mAttenuationQuadratic=ae(e)),t.mColorDiffuse=de(e),t.mColorSpecular=de(e),t.mColorAmbient=de(e),t.mType==S&&(t.mAngleInnerCone=ae(e),t.mAngleOuterCone=ae(e))}function Ne(e,t){be(he(e)==n),he(e),t.mName=pe(e),t.mPosition=ce(e),t.mLookAt=ce(e),t.mUp=ce(e),t.mHorizontalFOV=ae(e),t.mClipPlaneNear=ae(e),t.mClipPlaneFar=ae(e),t.mAspect=ae(e)}function Pe(e,t){if(be(he(e)==u),he(e),t.mFlags=ue(e),t.mNumMeshes=ue(e),t.mNumMaterials=ue(e),t.mNumAnimations=ue(e),t.mNumTextures=ue(e),t.mNumLights=ue(e),t.mNumCameras=ue(e),t.mRootNode=new j,t.mRootNode=function e(t,i,r){be(he(t)==d),he(t);var n=new j;if(n.mParent=i,n.mDepth=r,n.mName=pe(t),n.mTransformation=me(t),n.mNumChildren=ue(t),n.mNumMeshes=ue(t),n.mNumMeshes){n.mMeshes=[];for(var o=0;o<n.mNumMeshes;++o)n.mMeshes[o]=ue(t)}if(n.mNumChildren)for(n.mChildren=[],o=0;o<n.mNumChildren;++o){var a=e(t,n,r++);n.mChildren[o]=a}return n}(e,null,0),t.mNumMeshes){t.mMeshes=[];for(var i=0;i<t.mNumMeshes;++i)t.mMeshes[i]=new O,we(e,t.mMeshes[i])}if(t.mNumMaterials){t.mMaterials=[];for(i=0;i<t.mNumMaterials;++i)t.mMaterials[i]=new X,Me(e,t.mMaterials[i])}if(t.mNumAnimations){t.mAnimations=[];for(i=0;i<t.mNumAnimations;++i)t.mAnimations[i]=new $,Ae(e,t.mAnimations[i])}if(t.mNumTextures){t.mTextures=[];for(i=0;i<t.mNumTextures;++i)t.mTextures[i]=new ee,Ce(e,t.mTextures[i])}if(t.mNumLights){t.mLights=[];for(i=0;i<t.mNumLights;++i)t.mLights[i]=new te,Le(e,t.mLights[i])}if(t.mNumCameras){t.mCameras=[];for(i=0;i<t.mNumCameras;++i)t.mCameras[i]=new ie,Ne(e,t.mCameras[i])}}var ke,Ee,De=0,Oe=1;return function(e){var t=new re,i=new DataView(e);if(function(e){e.readOffset=0,e.Seek=function(t,i){i==De&&(e.readOffset+=t),i==Oe&&(e.readOffset=t)},e.ReadBytes=function(e,t,i){for(var r,n,o=t*i,a=0;a<o;a++)e[a]=(n=void 0,n=(r=this).getUint8(r.readOffset),r.readOffset+=1,n)},e.subArray32=function(e,t){var i=this.buffer.slice(e,t);return new Float32Array(i)},e.subArrayUint16=function(e,t){var i=this.buffer.slice(e,t);return new Uint16Array(i)},e.subArrayUint8=function(e,t){var i=this.buffer.slice(e,t);return new Uint8Array(i)},e.subArrayUint32=function(e,t){var i=this.buffer.slice(e,t);return new Uint32Array(i)}}(i),i.Seek(44,De),ue(i),ue(i),ue(i),ue(i),ke=le(i)>0,Ee=le(i)>0,ke)throw"Shortened binaries are not supported!";if(i.Seek(256,De),i.Seek(128,De),i.Seek(64,De),!Ee)return Pe(i,t),t.toTHREE();var r=he(i),n=i.FileSize()-i.Tell(),o=[];i.Read(o,1,n);var a=[];uncompress(a,r,o,n),Pe(new ArrayBuffer(a),t)}(e)}};var AWD_FIELD_INT8=1,AWD_FIELD_INT16=2,AWD_FIELD_INT32=3,AWD_FIELD_UINT8=4,AWD_FIELD_UINT16=5,AWD_FIELD_UINT32=6,AWD_FIELD_FLOAT32=7,AWD_FIELD_FLOAT64=8,AWD_FIELD_BOOL=21,AWD_FIELD_BADDR=23,AWD_FIELD_VECTOR2x1=41,AWD_FIELD_VECTOR3x1=42,AWD_FIELD_VECTOR4x1=43,AWD_FIELD_MTX3x2=44,AWD_FIELD_MTX3x3=45,AWD_FIELD_MTX4x3=46,AWD_FIELD_MTX4x4=47,BOOL=21,BADDR=23,UINT8=4,UINT16=5,FLOAT32=7,FLOAT64=8,littleEndian=!0;function Block(){this.id=0,this.data=null}function AWDProperties(){}AWDProperties.prototype={set:function(e,t){this[e]=t},get:function(e,t){return this.hasOwnProperty(e)?this[e]:t}};var AWDLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager,this.trunk=new Object3D,this.materialFactory=void 0,this._url="",this._baseDir="",this._data=void 0,this._ptr=0,this._version=[],this._streaming=!1,this._optimized_for_accuracy=!1,this._compression=0,this._bodylen=4294967295,this._blocks=[new Block],this._accuracyMatrix=!1,this._accuracyGeo=!1,this._accuracyProps=!1};function Light(e,t){Object3D.call(this),this.type="Light",this.color=new Color(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function LightShadow(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Vector2(512,512),this.map=null,this.matrix=new Matrix4}function PointLight(e,t,i,r){Light.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==r?r:1,this.shadow=new LightShadow(new PerspectiveCamera(90,1,.5,500))}function DirectionalLightShadow(){LightShadow.call(this,new OrthographicCamera(-5,5,5,-5,.5,500))}function DirectionalLight(e,t){Light.call(this,e,t),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}function SpotLightShadow(){LightShadow.call(this,new PerspectiveCamera(50,1,.5,500))}function SpotLight(e,t,i,r,n,o){Light.call(this,e,t),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==n?n:0,this.decay=void 0!==o?o:1,this.shadow=new SpotLightShadow}function HemisphereLight(e,t,i){Light.call(this,e,i),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(t)}AWDLoader.prototype={constructor:AWDLoader,load:function(e,t,i,r){var n=this;this._url=e,this._baseDir=e.substr(0,e.lastIndexOf("/")+1);var o=new FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.load(e,function(e){t(n.parse(e))},i,r)},setPath:function(e){return this.path=e,this},parse:function(e){var t=e.byteLength;for(this._ptr=0,this._data=new DataView(e),this._parseHeader(),0!=this._compression&&console.error("compressed AWD not supported"),this._streaming||this._bodylen==e.byteLength-this._ptr||console.error("AWDLoader: body len does not match file length",this._bodylen,t-this._ptr);this._ptr<t;)this.parseNextBlock();return this.trunk},parseNextBlock:function(){var e,t,i=this.readU32(),r=(this.readU8(),this.readU8()),n=(this.readU8(),this.readU32());switch(r){case 1:e=this.parseMeshData(n);break;case 22:e=this.parseContainer(n);break;case 23:e=this.parseMeshInstance(n);break;case 81:e=this.parseMaterial(n);break;case 82:e=this.parseTexture(n);break;case 101:e=this.parseSkeleton(n);break;case 112:e=this.parseMeshPoseAnimation(n,!1);break;case 113:e=this.parseVertexAnimationSet(n);break;case 102:e=this.parseSkeletonPose(n);break;case 103:e=this.parseSkeletonAnimation(n);break;case 122:e=this.parseAnimatorSet(n);break;default:this._ptr+=n}this._blocks[i]=t=new Block,t.data=e,t.id=i},_parseHeader:function(){var e=this._version;if(4282180!=(this.readU8()<<16|this.readU8()<<8|this.readU8()))throw new Error("AWDLoader - bad magic");e[0]=this.readU8(),e[1]=this.readU8();var t=this.readU16();this._streaming=1==(1&t),2===e[0]&&1===e[1]&&(this._accuracyMatrix=2==(2&t),this._accuracyGeo=4==(4&t),this._accuracyProps=8==(8&t)),this._geoNrType=this._accuracyGeo?FLOAT64:FLOAT32,this._matrixNrType=this._accuracyMatrix?FLOAT64:FLOAT32,this._propsNrType=this._accuracyProps?FLOAT64:FLOAT32,this._optimized_for_accuracy=2==(2&t),this._compression=this.readU8(),this._bodylen=this.readU32()},parseContainer:function(e){var t=new Object3D,i=this.readU32(),r=this.parseMatrix4();return t.name=this.readUTF(),t.applyMatrix(r),(this._blocks[i].data||this.trunk).add(t),this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:UINT8}),t.extra=this.parseUserAttributes(),t},parseMeshInstance:function(e){var t,i,r,n,o,a,s,l,u,h,c,d,p;for(a=this.readU32(),l=this.parseMatrix4(),t=this.readUTF(),s=this.readU32(),d=this.readU16(),r=this.getBlock(s),u=[],p=0;p<d;p++)c=this.readU32(),h=this.getBlock(c),u.push(h);if(o=[],(n=r.length)>1)for(i=new Object3D,p=0;p<n;p++){var f=new Mesh(r[p]);o.push(f),i.add(f)}else i=new Mesh(r[0]),o.push(i);i.applyMatrix(l),i.name=t,(this.getBlock(a)||this.trunk).add(i);var m=u.length,v=Math.max(n,m);for(p=0;p<v;p++)o[p%n].material=u[p%m];return this.parseProperties(null),i.extra=this.parseUserAttributes(),i},parseMaterial:function(e){var t,i,r,n,o,a;for(t=this.readUTF(),i=this.readU8(),a=this.readU8(),r=this.parseProperties({1:AWD_FIELD_INT32,2:AWD_FIELD_BADDR,11:AWD_FIELD_BOOL,12:AWD_FIELD_FLOAT32,13:AWD_FIELD_BOOL}),0;0<a;){this.readU16();this.parseProperties(null),this.parseUserAttributes()}if(o=this.parseUserAttributes(),void 0!==this.materialFactory&&(n=this.materialFactory(t)))return n;if(n=new MeshPhongMaterial,1===i)n.color.setHex(r.get(1,13421772));else if(2===i){var s=r.get(2,0);n.map=this.getBlock(s)}return n.extra=o,n.alphaThreshold=r.get(12,0),n.repeat=r.get(13,!1),n},parseTexture:function(e){var t,i;this.readUTF();if(0===this.readU8()){i=this.readU32();var r=this.readUTFBytes(i);console.log(r),t=this.loadTexture(r)}return this.parseProperties(null),this.parseUserAttributes(),t},loadTexture:function(e){var t=new Texture;return new ImageLoader(this.manager).load(this._baseDir+e,function(e){t.image=e,t.needsUpdate=!0}),t},parseSkeleton:function(e){this.readUTF();var t=this.readU16(),i=[],r=0;for(this.parseProperties(null);r<t;){var n,o;this.readU16(),(n=new Bone).parent=this.readU16()-1,n.name=this.readUTF(),o=this.parseMatrix4(),n.skinMatrix=o,this.parseProperties(null),this.parseUserAttributes(),i.push(n),r++}return this.parseUserAttributes(),i},parseSkeletonPose:function(e){this.readUTF();var t=this.readU16();this.parseProperties(null);for(var i=[],r=0;r<t;){var n;n=1===this.readU8()?this.parseMatrix4():new Matrix4,i[r]=n,r++}return this.parseUserAttributes(),i},parseSkeletonAnimation:function(e){this.readUTF();var t,i,r,n=[],o=this.readU16();this.parseProperties(null);for(var a=0;a<o;)i=this.readU32(),t=this.readU16(),r=this._blocks[i].data,n.push({pose:r,duration:t}),a++;if(0!==n.length)return this.parseUserAttributes(),n},parseVertexAnimationSet:function(e){this.readUTF();for(var t,i=this.readU16(),r=(this.parseProperties({1:UINT16}),0),n=[];r<i;)t=this.readU32(),n.push(this._blocks[t].data),r++;return this.parseUserAttributes(),n},parseAnimatorSet:function(e){this.readUTF();var t,i,r=this.readU16(),n=this.parseProperties({1:BADDR});t=this.readU32();for(var o=this.readU16(),a=[],s=0;s<o;s++)a.push(this.readU32());this.readU16(),Boolean(this.readU8());this.parseUserAttributes(),this.parseUserAttributes();var l,u=[];for(s=0;s<a.length;s++)u.push(this._blocks[a[s]].data);for(i=this._blocks[t].data,1==r&&(l={animationSet:i,skeleton:this._blocks[n.get(1,0)].data}),s=0;s<u.length;s++)u[s].animator=l;return l},parseMeshData:function(e){var t,i,r=this.readUTF(),n=this.readU16(),o=0,a=[];for(this.parseProperties({1:this._geoNrType,2:this._geoNrType});o<n;){var s,l,u;for((t=new BufferGeometry).name=r,a.push(t),s=this.readU32(),l=this._ptr+s,this.parseProperties({1:this._geoNrType,2:this._geoNrType});this._ptr<l;){var h=0,c=this.readU8(),d=(this.readU8(),this.readU32()),p=d+this._ptr;if(1===c)for(u=new BufferAttribute(i=new Float32Array(d/12*3),3),t.addAttribute("position",u),h=0;this._ptr<p;)i[h]=-this.readF32(),i[h+1]=this.readF32(),i[h+2]=this.readF32(),h+=3;else if(2===c)for(u=new BufferAttribute(i=new Uint16Array(d/2),1),t.setIndex(u),h=0;this._ptr<p;)i[h+1]=this.readU16(),i[h]=this.readU16(),i[h+2]=this.readU16(),h+=3;else if(3===c)for(u=new BufferAttribute(i=new Float32Array(d/8*2),2),t.addAttribute("uv",u),h=0;this._ptr<p;)i[h]=this.readF32(),i[h+1]=1-this.readF32(),h+=2;else if(4===c)for(u=new BufferAttribute(i=new Float32Array(d/12*3),3),t.addAttribute("normal",u),h=0;this._ptr<p;)i[h]=-this.readF32(),i[h+1]=this.readF32(),i[h+2]=this.readF32(),h+=3;else this._ptr=p}this.parseUserAttributes(),t.computeBoundingSphere(),o++}return this.parseUserAttributes(),a},parseMeshPoseAnimation:function(e,t){var i,r,n,o,a,s,l,u,h,c=1,d=0,p={},f=[],m=(this.readUTF(),this.readU32()),v=this.getBlock(m);if(null!==v){for((s=v.geometry).morphTargets=[],t||(c=this.readU16()),i=this.readU16(),l=this.readU16(),u=0;u<l;)f.push(this.readU16()),u++;for(h=this.parseProperties({1:BOOL,2:BOOL}),p.looping=h.get(1,!0),p.stitchFinalFrame=h.get(2,!1),r=0;r<c;){for(this.readU16(),n=0;n<i;)for(u=0,o=this.readU32(),a=this._ptr+o;u<l;){if(1===f[u]){var g=new Float32Array(o/4);for(s.morphTargets.push({array:g}),d=0;this._ptr<a;)g[d]=this.readF32(),g[d+1]=this.readF32(),g[d+2]=this.readF32(),d+=3;n++}else this._ptr=a;u++}r++}return this.parseUserAttributes(),null}console.log("parseMeshPoseAnimation target mesh not found at:",m)},getBlock:function(e){return this._blocks[e].data},parseMatrix4:function(){var e=new Matrix4,t=e.elements;return t[0]=this.readF32(),t[1]=this.readF32(),t[2]=this.readF32(),t[3]=0,t[4]=this.readF32(),t[5]=this.readF32(),t[6]=this.readF32(),t[7]=0,t[8]=this.readF32(),t[9]=this.readF32(),t[10]=this.readF32(),t[11]=0,t[12]=-this.readF32(),t[13]=this.readF32(),t[14]=this.readF32(),t[15]=1,e},parseProperties:function(e){var t=this.readU32(),i=this._ptr+t,r=new AWDProperties;if(e)for(;this._ptr<i;){var n,o=this.readU16(),a=this.readU32();e.hasOwnProperty(o)?(n=e[o],r.set(o,this.parseAttrValue(n,a))):this._ptr+=a}return r},parseUserAttributes:function(){return this._ptr=this.readU32()+this._ptr,null},parseAttrValue:function(e,t){var i,r;switch(e){case AWD_FIELD_INT8:i=1,r=this.readI8;break;case AWD_FIELD_INT16:i=2,r=this.readI16;break;case AWD_FIELD_INT32:i=4,r=this.readI32;break;case AWD_FIELD_BOOL:case AWD_FIELD_UINT8:i=1,r=this.readU8;break;case AWD_FIELD_UINT16:i=2,r=this.readU16;break;case AWD_FIELD_UINT32:case AWD_FIELD_BADDR:i=4,r=this.readU32;break;case AWD_FIELD_FLOAT32:i=4,r=this.readF32;break;case AWD_FIELD_FLOAT64:i=8,r=this.readF64;break;case AWD_FIELD_VECTOR2x1:case AWD_FIELD_VECTOR3x1:case AWD_FIELD_VECTOR4x1:case AWD_FIELD_MTX3x2:case AWD_FIELD_MTX3x3:case AWD_FIELD_MTX4x3:case AWD_FIELD_MTX4x4:i=8,r=this.readF64}if(i<t){var n,o,a;for(n=[],o=0,a=t/i;o<a;)n.push(r.call(this)),o++;return n}return r.call(this)},readU8:function(){return this._data.getUint8(this._ptr++)},readI8:function(){return this._data.getInt8(this._ptr++)},readU16:function(){var e=this._data.getUint16(this._ptr,littleEndian);return this._ptr+=2,e},readI16:function(){var e=this._data.getInt16(this._ptr,littleEndian);return this._ptr+=2,e},readU32:function(){var e=this._data.getUint32(this._ptr,littleEndian);return this._ptr+=4,e},readI32:function(){var e=this._data.getInt32(this._ptr,littleEndian);return this._ptr+=4,e},readF32:function(){var e=this._data.getFloat32(this._ptr,littleEndian);return this._ptr+=4,e},readF64:function(){var e=this._data.getFloat64(this._ptr,littleEndian);return this._ptr+=8,e},readUTF:function(){var e=this.readU16();return this.readUTFBytes(e)},readUTFBytes:function(e){for(var t=[],i=0;t.length<e;){var r=this._data.getUint8(this._ptr++,littleEndian);if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){var n=this._data.getUint8(this._ptr++,littleEndian);t[i++]=String.fromCharCode((31&r)<<6|63&n)}else{n=this._data.getUint8(this._ptr++,littleEndian);var o=this._data.getUint8(this._ptr++,littleEndian);t[i++]=String.fromCharCode((15&r)<<12|(63&n)<<6|63&o)}}return t.join("")}},Light.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Light,isLight:!0,copy:function(e){return Object3D.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),Object.assign(LightShadow.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),PointLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:PointLight,isPointLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),DirectionalLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:DirectionalLightShadow}),DirectionalLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:DirectionalLight,isDirectionalLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),SpotLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:SpotLightShadow,isSpotLightShadow:!0,update:function(e){var t=this.camera,i=2*_Math.RAD2DEG*e.angle,r=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;i===t.fov&&r===t.aspect&&n===t.far||(t.fov=i,t.aspect=r,t.far=n,t.updateProjectionMatrix())}}),SpotLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:SpotLight,isSpotLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),HemisphereLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:HemisphereLight,isHemisphereLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}});var BabylonLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager};BabylonLoader.prototype={constructor:BabylonLoader,load:function(e,t,i,r){var n=this,o=new FileLoader(n.manager);o.setPath(n.path),o.load(e,function(e){t(n.parse(JSON.parse(e)))},i,r)},setPath:function(e){return this.path=e,this},parse:function(e){function t(e){var t=new BufferGeometry,i=e.indices,r=e.positions,n=e.normals,o=e.uvs;t.setIndex(i);for(var a=2,s=r.length;a<s;a+=3)r[a]=-r[a];if(t.addAttribute("position",new Float32BufferAttribute(r,3)),n){for(a=2,s=n.length;a<s;a+=3)n[a]=-n[a];t.addAttribute("normal",new Float32BufferAttribute(n,3))}o&&t.addAttribute("uv",new Float32BufferAttribute(o,2));var l=e.subMeshes;if(l)for(a=0,s=l.length;a<s;a++){var u=l[a];t.addGroup(u.indexStart,u.indexCount)}return t}return function(e,i){for(var r={},n=new Scene,o=e.cameras,a=0,s=o.length;a<s;a++){var l=new PerspectiveCamera((d=o[a]).fov/Math.PI*180,1.33,d.minZ,d.maxZ);l.name=d.name,l.position.fromArray(d.position),d.rotation&&l.rotation.fromArray(d.rotation),r[d.id]=l}var u=e.lights;for(a=0,s=u.length;a<s;a++){var h;switch((d=u[a]).type){case 0:h=new PointLight;break;case 1:h=new DirectionalLight;break;case 2:h=new SpotLight;break;case 3:h=new HemisphereLight}h.name=d.name,d.position&&h.position.set(d.position[0],d.position[1],-d.position[2]),h.color.fromArray(d.diffuse),d.groundColor&&h.groundColor.fromArray(d.groundColor),d.intensity&&(h.intensity=d.intensity),r[d.id]=h,n.add(h)}var c=e.meshes;for(a=0,s=c.length;a<s;a++){var d,p;(p=(d=c[a]).indices?new Mesh(t(d),i[d.materialId]):new Group).name=d.name,p.position.set(d.position[0],d.position[1],-d.position[2]),p.rotation.fromArray(d.rotation),d.rotationQuaternion&&p.quaternion.fromArray(d.rotationQuaternion),p.scale.fromArray(d.scaling),d.parentId?r[d.parentId].add(p):n.add(p),r[d.id]=p}return n}(e,function(e){for(var t={},i=0,r=e.materials.length;i<r;i++){var n=e.materials[i],o=new MeshPhongMaterial;o.name=n.name,o.color.fromArray(n.diffuse),o.emissive.fromArray(n.emissive),o.specular.fromArray(n.specular),o.shininess=n.specularPower,o.opacity=n.alpha,t[n.id]=o}if(e.multiMaterials)for(i=0,r=e.multiMaterials.length;i<r;i++)n=e.multiMaterials[i],console.warn("BabylonLoader: Multi materials not yet supported."),t[n.id]=new MeshPhongMaterial;return t}(e))}};var BVHLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager,this.animateBonePositions=!0,this.animateBoneRotations=!0};function AmbientLight(e,t){Light.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function LineSegments(e,t){Line.call(this,e,t),this.type="LineSegments"}BVHLoader.prototype={constructor:BVHLoader,load:function(e,t,i,r){var n=this,o=new FileLoader(n.manager);o.setPath(n.path),o.load(e,function(e){t(n.parse(e))},i,r)},setPath:function(e){return this.path=e,this},parse:function(e){function t(e,i,r){if("ENDSITE"!==r.type){var n={time:i,position:new Vector3,rotation:new Quaternion};r.frames.push(n);for(var o=new Quaternion,a=new Vector3(1,0,0),s=new Vector3(0,1,0),l=new Vector3(0,0,1),u=0;u<r.channels.length;u++)switch(r.channels[u]){case"Xposition":n.position.x=parseFloat(e.shift().trim());break;case"Yposition":n.position.y=parseFloat(e.shift().trim());break;case"Zposition":n.position.z=parseFloat(e.shift().trim());break;case"Xrotation":o.setFromAxisAngle(a,parseFloat(e.shift().trim())*Math.PI/180),n.rotation.multiply(o);break;case"Yrotation":o.setFromAxisAngle(s,parseFloat(e.shift().trim())*Math.PI/180),n.rotation.multiply(o);break;case"Zrotation":o.setFromAxisAngle(l,parseFloat(e.shift().trim())*Math.PI/180),n.rotation.multiply(o);break;default:console.warn("BVHLoader: Invalid channel type.")}for(u=0;u<r.children.length;u++)t(e,i,r.children[u])}}function i(e){for(var t;0===(t=e.shift().trim()).length;);return t}var r=this,n=function(e){"HIERARCHY"!==i(e)&&console.error("BVHLoader: HIERARCHY expected.");var r=[],n=function e(t,r,n){var o={name:"",type:"",frames:[]};n.push(o);var a=r.split(/[\s]+/);"END"===a[0].toUpperCase()&&"SITE"===a[1].toUpperCase()?(o.type="ENDSITE",o.name="ENDSITE"):(o.name=a[1],o.type=a[0].toUpperCase()),"{"!==i(t)&&console.error("BVHLoader: Expected opening { after type & name"),"OFFSET"!==(a=i(t).split(/[\s]+/))[0]&&console.error("BVHLoader: Expected OFFSET but got: "+a[0]),4!==a.length&&console.error("BVHLoader: Invalid number of values for OFFSET.");var s=new Vector3(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]));if((isNaN(s.x)||isNaN(s.y)||isNaN(s.z))&&console.error("BVHLoader: Invalid values of OFFSET."),o.offset=s,"ENDSITE"!==o.type){"CHANNELS"!==(a=i(t).split(/[\s]+/))[0]&&console.error("BVHLoader: Expected CHANNELS definition.");var l=parseInt(a[1]);o.channels=a.splice(2,l),o.children=[]}for(;;){var u=i(t);if("}"===u)return o;o.children.push(e(t,u,n))}}(e,i(e),r);"MOTION"!==i(e)&&console.error("BVHLoader: MOTION expected.");var o=i(e).split(/[\s]+/),a=parseInt(o[1]);isNaN(a)&&console.error("BVHLoader: Failed to read number of frames."),o=i(e).split(/[\s]+/);var s=parseFloat(o[2]);isNaN(s)&&console.error("BVHLoader: Failed to read frame time.");for(var l=0;l<a;l++)t(o=i(e).split(/[\s]+/),l*s,n);return r}(e.split(/[\r\n]+/g)),o=[];!function e(t,i){var r=new Bone;if(i.push(r),r.position.add(t.offset),r.name=t.name,"ENDSITE"!==t.type)for(var n=0;n<t.children.length;n++)r.add(e(t.children[n],i));return r}(n[0],o);var a=function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i];if("ENDSITE"!==n.type){for(var o=[],a=[],s=[],l=0;l<n.frames.length;l++){var u=n.frames[l];o.push(u.time),a.push(u.position.x+n.offset.x),a.push(u.position.y+n.offset.y),a.push(u.position.z+n.offset.z),s.push(u.rotation.x),s.push(u.rotation.y),s.push(u.rotation.z),s.push(u.rotation.w)}r.animateBonePositions&&t.push(new VectorKeyframeTrack(".bones["+n.name+"].position",o,a)),r.animateBoneRotations&&t.push(new QuaternionKeyframeTrack(".bones["+n.name+"].quaternion",o,s))}}return new AnimationClip("animation",-1,t)}(n);return{skeleton:new Skeleton(o),clip:a}}},AmbientLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:AmbientLight,isAmbientLight:!0}),LineSegments.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineSegments,isLineSegments:!0,computeLineDistances:function(){var e=new Vector3,t=new Vector3;return function(){var i=this.geometry;if(i.isBufferGeometry)if(null===i.index){for(var r=i.attributes.position,n=[],o=0,a=r.count;o<a;o+=2)e.fromBufferAttribute(r,o),t.fromBufferAttribute(r,o+1),n[o]=0===o?0:n[o-1],n[o+1]=n[o]+e.distanceTo(t);i.addAttribute("lineDistance",new Float32BufferAttribute(n,1))}else console.warn("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(i.isGeometry){var s=i.vertices;for(n=i.lineDistances,o=0,a=s.length;o<a;o+=2)e.copy(s[o]),t.copy(s[o+1]),n[o]=0===o?0:n[o-1],n[o+1]=n[o]+e.distanceTo(t)}return this}}()});var TGALoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager};TGALoader.prototype={constructor:TGALoader,load:function(e,t,i,r){var n=this,o=new Texture,a=new FileLoader(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.load(e,function(e){o.image=n.parse(e),o.needsUpdate=!0,void 0!==t&&t(o)},i,r),o},parse:function(e){var t=0,i=1,r=2,n=3,o=9,a=10,s=11,l=48,u=4,h=0,c=1,d=2,p=3;e.length<19&&console.error("TGALoader: Not enough data to contain header.");var f=new Uint8Array(e),m=0,v={id_length:f[m++],colormap_type:f[m++],image_type:f[m++],colormap_index:f[m++]|f[m++]<<8,colormap_length:f[m++]|f[m++]<<8,colormap_size:f[m++],origin:[f[m++]|f[m++]<<8,f[m++]|f[m++]<<8],width:f[m++]|f[m++]<<8,height:f[m++]|f[m++]<<8,pixel_size:f[m++],flags:f[m++]};!function(e){switch(e.image_type){case i:case o:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("TGALoader: Invalid type colormap data for indexed type.");break;case r:case n:case a:case s:e.colormap_type&&console.error("TGALoader: Invalid type colormap data for colormap type.");break;case t:console.error("TGALoader: No data.");default:console.error('TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('TGALoader: Invalid pixel size "%s".',e.pixel_size)}(v),v.id_length+m>e.length&&console.error("TGALoader: No data."),m+=v.id_length;var g=!1,y=!1,_=!1;switch(v.image_type){case o:g=!0,y=!0;break;case i:y=!0;break;case a:g=!0;break;case r:break;case s:g=!0,_=!0;break;case n:_=!0}var b="undefined"!=typeof OffscreenCanvas,x=b?new OffscreenCanvas(v.width,v.height):document.createElement("canvas");x.width=v.width,x.height=v.height;var w=x.getContext("2d"),S=w.createImageData(v.width,v.height),M=function(e,t,i,r,n){var o,a,s,l;if(a=i.pixel_size>>3,s=i.width*i.height*a,t&&(l=n.subarray(r,r+=i.colormap_length*(i.colormap_size>>3))),e){var u,h,c;o=new Uint8Array(s);for(var d=0,p=new Uint8Array(a);d<s;)if(h=1+(127&(u=n[r++])),128&u){for(c=0;c<a;++c)p[c]=n[r++];for(c=0;c<h;++c)o.set(p,d+c*a);d+=a*h}else{for(h*=a,c=0;c<h;++c)o[d+c]=n[r++];d+=h}}else o=n.subarray(r,r+=t?i.width*i.height:s);return{pixel_data:o,palettes:l}}(g,y,v,m,f);!function(e,t,i,r,n){var o,a,s,f,m,g;switch((v.flags&l)>>u){default:case d:o=0,s=1,m=t,a=0,f=1,g=i;break;case h:o=0,s=1,m=t,a=i-1,f=-1,g=-1;break;case p:o=t-1,s=-1,m=-1,a=0,f=1,g=i;break;case c:o=t-1,s=-1,m=-1,a=i-1,f=-1,g=-1}if(_)switch(v.pixel_size){case 8:!function(e,t,i,r,n,o,a,s){var l,u,h,c=0,d=v.width;for(h=t;h!==r;h+=i)for(u=n;u!==a;u+=o,c++)l=s[c],e[4*(u+d*h)+0]=l,e[4*(u+d*h)+1]=l,e[4*(u+d*h)+2]=l,e[4*(u+d*h)+3]=255}(e,a,f,g,o,s,m,r);break;case 16:!function(e,t,i,r,n,o,a,s){var l,u,h=0,c=v.width;for(u=t;u!==r;u+=i)for(l=n;l!==a;l+=o,h+=2)e[4*(l+c*u)+0]=s[h+0],e[4*(l+c*u)+1]=s[h+0],e[4*(l+c*u)+2]=s[h+0],e[4*(l+c*u)+3]=s[h+1]}(e,a,f,g,o,s,m,r);break;default:console.error("TGALoader: Format not supported.")}else switch(v.pixel_size){case 8:!function(e,t,i,r,n,o,a,s,l){var u,h,c,d=l,p=0,f=v.width;for(c=t;c!==r;c+=i)for(h=n;h!==a;h+=o,p++)u=s[p],e[4*(h+f*c)+3]=255,e[4*(h+f*c)+2]=d[3*u+0],e[4*(h+f*c)+1]=d[3*u+1],e[4*(h+f*c)+0]=d[3*u+2]}(e,a,f,g,o,s,m,r,n);break;case 16:!function(e,t,i,r,n,o,a,s){var l,u,h,c=0,d=v.width;for(h=t;h!==r;h+=i)for(u=n;u!==a;u+=o,c+=2)l=s[c+0]+(s[c+1]<<8),e[4*(u+d*h)+0]=(31744&l)>>7,e[4*(u+d*h)+1]=(992&l)>>2,e[4*(u+d*h)+2]=(31&l)>>3,e[4*(u+d*h)+3]=32768&l?0:255}(e,a,f,g,o,s,m,r);break;case 24:!function(e,t,i,r,n,o,a,s){var l,u,h=0,c=v.width;for(u=t;u!==r;u+=i)for(l=n;l!==a;l+=o,h+=3)e[4*(l+c*u)+3]=255,e[4*(l+c*u)+2]=s[h+0],e[4*(l+c*u)+1]=s[h+1],e[4*(l+c*u)+0]=s[h+2]}(e,a,f,g,o,s,m,r);break;case 32:!function(e,t,i,r,n,o,a,s){var l,u,h=0,c=v.width;for(u=t;u!==r;u+=i)for(l=n;l!==a;l+=o,h+=4)e[4*(l+c*u)+2]=s[h+0],e[4*(l+c*u)+1]=s[h+1],e[4*(l+c*u)+0]=s[h+2],e[4*(l+c*u)+3]=s[h+3]}(e,a,f,g,o,s,m,r);break;default:console.error("TGALoader: Format not supported.")}}(S.data,v.width,v.height,M.pixel_data,M.palettes);return w.putImageData(S,0,0),b?x.transferToImageBitmap():x},setPath:function(e){return this.path=e,this}};var ColladaLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager};function CompressedTexture(e,t,i,r,n,o,a,s,l,u,h,c){Texture.call(this,null,o,a,s,l,u,r,n,h,c),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function CompressedTextureLoader(e){this.manager=void 0!==e?e:DefaultLoadingManager,this._parser=null}ColladaLoader.prototype={constructor:ColladaLoader,crossOrigin:"anonymous",load:function(e,t,i,r){var n=this,o=void 0===n.path?LoaderUtils.extractUrlBase(e):n.path,a=new FileLoader(n.manager);a.setPath(n.path),a.load(e,function(e){t(n.parse(e,o))},i,r)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},options:{set convertUpAxis(e){console.warn("ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){function i(e,t){for(var i=[],r=e.childNodes,n=0,o=r.length;n<o;n++){var a=r[n];a.nodeName===t&&i.push(a)}return i}function r(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=new Array(t.length),r=0,n=t.length;r<n;r++)i[r]=t[r];return i}function n(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=new Array(t.length),r=0,n=t.length;r<n;r++)i[r]=parseFloat(t[r]);return i}function o(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=new Array(t.length),r=0,n=t.length;r<n;r++)i[r]=parseInt(t[r]);return i}function a(e){return e.substring(1)}function s(e){return 0===Object.keys(e).length}function l(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function u(e){return void 0!==e?e.textContent:"Y_UP"}function h(e,t,r,n){var o=i(e,t)[0];if(void 0!==o)for(var a=i(o,r),s=0;s<a.length;s++)n(a[s])}function c(e,t){for(var i in e){e[i].build=t(e[i])}}function d(e,t){return void 0!==e.build?e.build:(e.build=t(e),e.build)}function p(e){for(var t={inputs:{}},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"input":var o=a(n.getAttribute("source")),s=n.getAttribute("semantic");t.inputs[s]=o}}return t}function f(e){var t={},i=e.getAttribute("target").split("/"),r=i.shift(),n=i.shift(),o=-1!==n.indexOf("("),s=-1!==n.indexOf(".");if(s)i=n.split("."),n=i.shift(),t.member=i.shift();else if(o){var l=n.split("(");n=l.shift();for(var u=0;u<l.length;u++)l[u]=parseInt(l[u].replace(/\)/,""));t.indices=l}return t.id=r,t.sid=n,t.arraySyntax=o,t.memberSyntax=s,t.sampler=a(e.getAttribute("source")),t}function m(e){var t=[],i=e.channels,r=e.samplers,n=e.sources;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o],s=r[a.sampler],l=s.inputs.INPUT,u=s.inputs.OUTPUT;x(g(a,n[l],n[u]),t)}return t}function v(e){return d(qe.animations[e],m)}function g(e,t,i){var r,n,o,a,s,l,u=qe.nodes[e.id],h=Re(u.id),c=u.transforms[e.sid],d=u.matrix.clone().transpose(),p={};switch(c){case"matrix":for(o=0,a=t.array.length;o<a;o++)if(r=t.array[o],n=o*i.stride,void 0===p[r]&&(p[r]={}),!0===e.arraySyntax){var f=i.array[n],m=e.indices[0]+4*e.indices[1];p[r][m]=f}else for(s=0,l=i.stride;s<l;s++)p[r][s]=i.array[n+s];break;case"translate":case"rotate":case"scale":console.warn('ColladaLoader: Animation transform type "%s" not yet implemented.',c)}var v=function(e,t){var i=[];for(var r in e)i.push({time:parseFloat(r),value:e[r]});i.sort(function(e,t){return e.time-t.time});for(var n=0;n<16;n++)w(i,n,t.elements[n]);return i}(p,d);return{name:h.uuid,keyframes:v}}var y=new Vector3,_=new Vector3,b=new Quaternion;function x(e,t){for(var i=e.keyframes,r=e.name,n=[],o=[],a=[],s=[],l=0,u=i.length;l<u;l++){var h=i[l],c=h.time,d=h.value;Me.fromArray(d).transpose(),Me.decompose(y,b,_),n.push(c),o.push(y.x,y.y,y.z),a.push(b.x,b.y,b.z,b.w),s.push(_.x,_.y,_.z)}return o.length>0&&t.push(new VectorKeyframeTrack(r+".position",n,o)),a.length>0&&t.push(new QuaternionKeyframeTrack(r+".quaternion",n,a)),s.length>0&&t.push(new VectorKeyframeTrack(r+".scale",n,s)),t}function w(e,t,i){var r,n,o,a=!0;for(n=0,o=e.length;n<o;n++)void 0===(r=e[n]).value[t]?r.value[t]=null:a=!1;if(!0===a)for(n=0,o=e.length;n<o;n++)(r=e[n]).value[t]=i;else!function(e,t){for(var i,r,n=0,o=e.length;n<o;n++){var a=e[n];if(null===a.value[t]){if(i=S(e,n,t),r=M(e,n,t),null===i){a.value[t]=r.value[t];continue}if(null===r){a.value[t]=i.value[t];continue}T(a,i,r,t)}}}(e,t)}function S(e,t,i){for(;t>=0;){var r=e[t];if(null!==r.value[i])return r;t--}return null}function M(e,t,i){for(;t<e.length;){var r=e[t];if(null!==r.value[i])return r;t++}return null}function T(e,t,i,r){i.time-t.time!=0?e.value[r]=(e.time-t.time)*(i.value[r]-t.value[r])/(i.time-t.time)+t.value[r]:e.value[r]=t.value[r]}function A(e){for(var t=[],i=e.name,r=e.end-e.start||-1,n=e.animations,o=0,a=n.length;o<a;o++)for(var s=v(n[o]),l=0,u=s.length;l<u;l++)t.push(s[l]);return new AnimationClip(i,r,t)}function C(e){return d(qe.clips[e],A)}function L(e){for(var t={sources:{}},i=0,r=e.childNodes.length;i<r;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=n(o.textContent);break;case"source":var a=o.getAttribute("id");t.sources[a]=ne(o);break;case"joints":t.joints=N(o);break;case"vertex_weights":t.vertexWeights=P(o)}}return t}function N(e){for(var t={inputs:{}},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"input":var o=n.getAttribute("semantic"),s=a(n.getAttribute("source"));t.inputs[o]=s}}return t}function P(e){for(var t={inputs:{}},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"input":var s=n.getAttribute("semantic"),l=a(n.getAttribute("source")),u=parseInt(n.getAttribute("offset"));t.inputs[s]={id:l,offset:u};break;case"vcount":t.vcount=o(n.textContent);break;case"v":t.v=o(n.textContent)}}return t}function k(e){var t={id:e.id},i=qe.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t,i,r,n={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},o=e.sources,a=e.vertexWeights,s=a.vcount,l=a.v,u=a.inputs.JOINT.offset,h=a.inputs.WEIGHT.offset,c=e.sources[e.joints.inputs.JOINT],d=e.sources[e.joints.inputs.INV_BIND_MATRIX],p=o[a.inputs.WEIGHT.id].array,f=0;for(t=0,r=s.length;t<r;t++){var m=s[t],v=[];for(i=0;i<m;i++){var g=l[f+u],y=l[f+h],_=p[y];v.push({index:g,weight:_}),f+=2}for(v.sort(S),i=0;i<4;i++){var b=v[i];void 0!==b?(n.indices.array.push(b.index),n.weights.array.push(b.weight)):(n.indices.array.push(0),n.weights.array.push(0))}}e.bindShapeMatrix?n.bindMatrix=(new Matrix4).fromArray(e.bindShapeMatrix).transpose():n.bindMatrix=(new Matrix4).identity();for(t=0,r=c.array.length;t<r;t++){var x=c.array[t],w=(new Matrix4).fromArray(d.array,t*d.stride).transpose();n.joints.push({name:x,boneInverse:w})}return n;function S(e,t){return t.weight-e.weight}}(e.skin),i.sources.skinIndices=t.skin.indices,i.sources.skinWeights=t.skin.weights),t}function E(e){return void 0!==e.build?e.build:e.init_from}function D(e){var t=qe.images[e];return void 0!==t?d(t,E):(console.warn("ColladaLoader: Couldn't find image with ID:",e),null)}function O(e){for(var t={surfaces:{},samplers:{}},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"newparam":R(n,t);break;case"technique":t.technique=B(n);break;case"extra":t.extra=W(n)}}return t}function R(e,t){for(var i=e.getAttribute("sid"),r=0,n=e.childNodes.length;r<n;r++){var o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"surface":t.surfaces[i]=F(o);break;case"sampler2D":t.samplers[i]=I(o)}}}function F(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"init_from":t.init_from=n.textContent}}return t}function I(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"source":t.source=n.textContent}}return t}function B(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=n.nodeName,t.parameters=U(n)}}return t}function U(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[n.nodeName]=V(n);break;case"transparent":t[n.nodeName]={opaque:n.getAttribute("opaque"),data:V(n)}}}return t}function V(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"color":t[o.nodeName]=n(o.textContent);break;case"float":t[o.nodeName]=parseFloat(o.textContent);break;case"texture":t[o.nodeName]={id:o.getAttribute("texture"),extra:z(o)}}}return t}function z(e){for(var t={technique:{}},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"extra":G(n,t)}}return t}function G(e,t){for(var i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"technique":j(n,t)}}}function j(e,t){for(var i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[n.nodeName]=parseFloat(n.textContent);break;case"wrapU":case"wrapV":"TRUE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=1:"FALSE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=0:t.technique[n.nodeName]=parseInt(n.textContent)}}}function W(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"technique":t.technique=H(n)}}return t}function H(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"double_sided":t[n.nodeName]=parseInt(n.textContent)}}return t}function q(e){return e}function Y(e){var t,i,r=(t=e.url,d(qe.effects[t],q)),n=r.profile.technique,o=r.profile.extra;switch(n.type){case"phong":case"blinn":i=new MeshPhongMaterial;break;case"lambert":i=new MeshLambertMaterial;break;default:i=new MeshBasicMaterial}function a(e){var t=r.profile.samplers[e.id],i=null;void 0!==t?i=D(r.profile.surfaces[t.source].init_from):(console.warn("ColladaLoader: Undefined sampler. Access image directly (see #12530)."),i=D(e.id));if(null!==i){var n=function(e){var t,i=e.slice(2+(e.lastIndexOf(".")-1>>>0));switch(i=i.toLowerCase()){case"tga":t=Ve;break;default:t=Ge}return t}(i);if(void 0!==n){var o=n.load(i),a=e.extra;if(void 0!==a&&void 0!==a.technique&&!1===s(a.technique)){var l=a.technique;o.wrapS=l.wrapU?RepeatWrapping:ClampToEdgeWrapping,o.wrapT=l.wrapV?RepeatWrapping:ClampToEdgeWrapping,o.offset.set(l.offsetU||0,l.offsetV||0),o.repeat.set(l.repeatU||1,l.repeatV||1)}else o.wrapS=RepeatWrapping,o.wrapT=RepeatWrapping;return o}return console.warn("ColladaLoader: Loader for texture %s not found.",i),null}return console.warn("ColladaLoader: Couldn't create texture with ID:",e.id),null}i.name=e.name||"";var l=n.parameters;for(var u in l){var h=l[u];switch(u){case"diffuse":h.color&&i.color.fromArray(h.color),h.texture&&(i.map=a(h.texture));break;case"specular":h.color&&i.specular&&i.specular.fromArray(h.color),h.texture&&(i.specularMap=a(h.texture));break;case"bump":h.texture&&(i.normalMap=a(h.texture));break;case"ambient":h.texture&&(i.lightMap=a(h.texture));break;case"shininess":h.float&&i.shininess&&(i.shininess=h.float);break;case"emission":h.color&&i.emissive&&i.emissive.fromArray(h.color),h.texture&&(i.emissiveMap=a(h.texture))}}var c=l.transparent,p=l.transparency;if(void 0===p&&c&&(p={float:1}),void 0===c&&p&&(c={opaque:"A_ONE",data:{color:[1,1,1,1]}}),c&&p)if(c.data.texture)i.transparent=!0;else{var f=c.data.color;switch(c.opaque){case"A_ONE":i.opacity=f[3]*p.float;break;case"RGB_ZERO":i.opacity=1-f[0]*p.float;break;case"A_ZERO":i.opacity=1-f[3]*p.float;break;case"RGB_ONE":i.opacity=f[0]*p.float;break;default:console.warn('ColladaLoader: Invalid opaque type "%s" of transparent tag.',c.opaque)}i.opacity<1&&(i.transparent=!0)}return void 0!==o&&void 0!==o.technique&&1===o.technique.double_sided&&(i.side=DoubleSide),i}function X(e){return d(qe.materials[e],Y)}function K(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"technique_common":return Q(i)}}return{}}function Q(e){for(var t={},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];switch(r.nodeName){case"perspective":case"orthographic":t.technique=r.nodeName,t.parameters=Z(r)}}return t}function Z(e){for(var t={},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];switch(r.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[r.nodeName]=parseFloat(r.textContent)}}return t}function J(e){var t;switch(e.optics.technique){case"perspective":t=new PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var i=e.optics.parameters.ymag,r=e.optics.parameters.xmag,n=e.optics.parameters.aspect_ratio;r=void 0===r?i*n:r,i=void 0===i?r/n:i,t=new OrthographicCamera(-(r*=.5),r,i*=.5,-i,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new PerspectiveCamera}return t.name=e.name||"",t}function $(e){var t=qe.cameras[e];return void 0!==t?d(t,J):(console.warn("ColladaLoader: Couldn't find camera with ID:",e),null)}function ee(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=n.nodeName,t.parameters=te(n)}}return t}function te(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"color":var a=n(o.textContent);t.color=(new Color).fromArray(a);break;case"falloff_angle":t.falloffAngle=parseFloat(o.textContent);break;case"quadratic_attenuation":var s=parseFloat(o.textContent);t.distance=s?Math.sqrt(1/s):0}}return t}function ie(e){var t;switch(e.technique){case"directional":t=new DirectionalLight;break;case"point":t=new PointLight;break;case"spot":t=new SpotLight;break;case"ambient":t=new AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function re(e){var t=qe.lights[e];return void 0!==t?d(t,ie):(console.warn("ColladaLoader: Couldn't find light with ID:",e),null)}function ne(e){for(var t={array:[],stride:3},o=0;o<e.childNodes.length;o++){var a=e.childNodes[o];if(1===a.nodeType)switch(a.nodeName){case"float_array":t.array=n(a.textContent);break;case"Name_array":t.array=r(a.textContent);break;case"technique_common":var s=i(a,"accessor")[0];void 0!==s&&(t.stride=parseInt(s.getAttribute("stride")))}}return t}function oe(e){for(var t={},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];1===r.nodeType&&(t[r.getAttribute("semantic")]=a(r.getAttribute("source")))}return t}function ae(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"input":var s=a(n.getAttribute("source")),l=n.getAttribute("semantic"),u=parseInt(n.getAttribute("offset")),h=parseInt(n.getAttribute("set")),c=h>0?l+h:l;t.inputs[c]={id:s,offset:u},t.stride=Math.max(t.stride,u+1),"TEXCOORD"===l&&(t.hasUV=!0);break;case"vcount":t.vcount=o(n.textContent);break;case"p":t.p=o(n.textContent)}}return t}function se(e){for(var t=0,i=0,r=e.length;i<r;i++){!0===e[i].hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function le(e){var t={},i=e.sources,r=e.vertices,n=e.primitives;if(0===n.length)return{};var o=function(e){for(var t={},i=0;i<e.length;i++){var r=e[i];void 0===t[r.type]&&(t[r.type]=[]),t[r.type].push(r)}return t}(n);for(var a in o){var s=o[a];se(s),t[a]=ue(s,i,r)}return t}function ue(e,t,i){for(var r={},n={array:[],stride:0},o={array:[],stride:0},a={array:[],stride:0},s={array:[],stride:0},l={array:[],stride:0},u=[],h=4,c=[],d=4,p=new BufferGeometry,f=[],m=0,v=0;v<e.length;v++){var g=e[v],y=g.inputs,_=0;switch(g.type){case"lines":case"linestrips":_=2*g.count;break;case"triangles":_=3*g.count;break;case"polylist":for(var b=0;b<g.count;b++){var x=g.vcount[b];switch(x){case 3:_+=3;break;case 4:_+=6;break;default:_+=3*(x-2)}}break;default:console.warn("ColladaLoader: Unknow primitive type:",g.type)}for(var w in p.addGroup(m,_,v),m+=_,g.material&&f.push(g.material),y){var S=y[w];switch(w){case"VERTEX":for(var M in i){var T=i[M];switch(M){case"POSITION":var A=n.array.length;if(he(g,t[T],S.offset,n.array),n.stride=t[T].stride,t.skinWeights&&t.skinIndices&&(he(g,t.skinIndices,S.offset,u),he(g,t.skinWeights,S.offset,c)),!1===g.hasUV&&!0===e.uvsNeedsFix){_=(n.array.length-A)/n.stride;for(var C=0;C<_;C++)a.array.push(0,0)}break;case"NORMAL":he(g,t[T],S.offset,o.array),o.stride=t[T].stride;break;case"COLOR":he(g,t[T],S.offset,l.array),l.stride=t[T].stride;break;case"TEXCOORD":he(g,t[T],S.offset,a.array),a.stride=t[T].stride;break;case"TEXCOORD1":he(g,t[T],S.offset,s.array),a.stride=t[T].stride;break;default:console.warn('ColladaLoader: Semantic "%s" not handled in geometry build process.',M)}}break;case"NORMAL":he(g,t[S.id],S.offset,o.array),o.stride=t[S.id].stride;break;case"COLOR":he(g,t[S.id],S.offset,l.array),l.stride=t[S.id].stride;break;case"TEXCOORD":he(g,t[S.id],S.offset,a.array),a.stride=t[S.id].stride;break;case"TEXCOORD1":he(g,t[S.id],S.offset,s.array),s.stride=t[S.id].stride}}}return n.array.length>0&&p.addAttribute("position",new Float32BufferAttribute(n.array,n.stride)),o.array.length>0&&p.addAttribute("normal",new Float32BufferAttribute(o.array,o.stride)),l.array.length>0&&p.addAttribute("color",new Float32BufferAttribute(l.array,l.stride)),a.array.length>0&&p.addAttribute("uv",new Float32BufferAttribute(a.array,a.stride)),s.array.length>0&&p.addAttribute("uv2",new Float32BufferAttribute(s.array,s.stride)),u.length>0&&p.addAttribute("skinIndex",new Float32BufferAttribute(u,h)),c.length>0&&p.addAttribute("skinWeight",new Float32BufferAttribute(c,d)),r.data=p,r.type=e[0].type,r.materialKeys=f,r}function he(e,t,i,r){var n=e.p,o=e.stride,a=e.vcount;function s(e){for(var t=n[e+i]*u,o=t+u;t<o;t++)r.push(l[t])}var l=t.array,u=t.stride;if(void 0!==e.vcount)for(var h=0,c=0,d=a.length;c<d;c++){var p=a[c];if(4===p){var f=h+1*o,m=h+2*o,v=h+3*o;s(h+0*o),s(f),s(v),s(f),s(m),s(v)}else if(3===p){f=h+1*o,m=h+2*o;s(h+0*o),s(f),s(m)}else if(p>4)for(var g=1,y=p-2;g<=y;g++){f=h+o*g,m=h+o*(g+1);s(h+0*o),s(f),s(m)}h+=o*p}else for(c=0,d=n.length;c<d;c+=o)s(c)}function ce(e){return d(qe.geometries[e],le)}function de(e){return void 0!==e.build?e.build:e}function pe(e,t){for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"joint":t.joints[r.getAttribute("sid")]=fe(r);break;case"link":t.links.push(ve(r))}}}function fe(e){for(var t,i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"prismatic":case"revolute":t=me(r)}}return t}function me(e,t){t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"axis":var o=n(r.textContent);t.axis.fromArray(o);break;case"limits":var a=r.getElementsByTagName("max")[0],s=r.getElementsByTagName("min")[0];t.limits.max=parseFloat(a.textContent),t.limits.min=parseFloat(s.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function ve(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"attachment_full":t.attachments.push(ge(r));break;case"matrix":case"translate":case"rotate":t.transforms.push(ye(r))}}return t}function ge(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"link":t.links.push(ve(r));break;case"matrix":case"translate":case"rotate":t.transforms.push(ye(r))}}return t}function ye(e){var t={type:e.nodeName},i=n(e.textContent);switch(t.type){case"matrix":t.obj=new Matrix4,t.obj.fromArray(i).transpose();break;case"translate":t.obj=new Vector3,t.obj.fromArray(i);break;case"rotate":t.obj=new Vector3,t.obj.fromArray(i),t.angle=_Math.degToRad(i[3])}return t}function _e(e,t){for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"technique_common":be(r,t)}}}function be(e,t){for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"inertia":t.inertia=n(r.textContent);break;case"mass":t.mass=n(r.textContent)[0]}}}function xe(e){for(var t={target:e.getAttribute("target").split("/").pop()},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"axis":var n=r.getElementsByTagName("param")[0];t.axis=n.textContent;var o=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=o.substr(0,o.length-1)}}return t}function we(e){return void 0!==e.build?e.build:e}function Se(e){for(var t=[],i=Be.querySelector('[id="'+e.id+'"]'),r=0;r<i.childNodes.length;r++){var o=i.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"matrix":var a=n(o.textContent),s=(new Matrix4).fromArray(a).transpose();t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:s});break;case"translate":case"scale":a=n(o.textContent);var l=(new Vector3).fromArray(a);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:l});break;case"rotate":a=n(o.textContent),l=(new Vector3).fromArray(a);var u=_Math.degToRad(a[3]);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:l,angle:u})}}return t}var Me=new Matrix4,Te=new Vector3;function Ae(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"node":t.nodes.push(r.getAttribute("id")),Ae(r);break;case"instance_camera":t.instanceCameras.push(a(r.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Ce(r));break;case"instance_light":t.instanceLights.push(a(r.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Ce(r));break;case"instance_node":t.instanceNodes.push(a(r.getAttribute("url")));break;case"matrix":var o=n(r.textContent);t.matrix.multiply(Me.fromArray(o).transpose()),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"translate":o=n(r.textContent);Te.fromArray(o),t.matrix.multiply(Me.makeTranslation(Te.x,Te.y,Te.z)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"rotate":o=n(r.textContent);var s=_Math.degToRad(o[3]);t.matrix.multiply(Me.makeRotationAxis(Te.fromArray(o),s)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"scale":o=n(r.textContent);t.matrix.scale(Te.fromArray(o)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"extra":break;default:console.log(r)}}return Oe(t.id)?console.warn("ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):qe.nodes[t.id]=t,t}function Ce(e){for(var t={id:a(e.getAttribute("url")),materials:{},skeletons:[]},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];switch(r.nodeName){case"bind_material":for(var n=r.getElementsByTagName("instance_material"),o=0;o<n.length;o++){var s=n[o],l=s.getAttribute("symbol"),u=s.getAttribute("target");t.materials[l]=a(u)}break;case"skeleton":t.skeletons.push(a(r.textContent))}}return t}function Le(e,t){var i,r,n,o=[],a=[];for(i=0;i<e.length;i++){var s=e[i];if(Oe(s))Ne(Re(s),t,o);else if(n=s,void 0!==qe.visualScenes[n])for(var l=qe.visualScenes[s].children,u=0;u<l.length;u++){var h=l[u];if("JOINT"===h.type)Ne(Re(h.id),t,o)}else console.error("ColladaLoader: Unable to find root bone of skeleton with ID:",s)}for(i=0;i<t.length;i++)for(u=0;u<o.length;u++)if((r=o[u]).bone.name===t[i].name){a[i]=r,r.processed=!0;break}for(i=0;i<o.length;i++)!1===(r=o[i]).processed&&(a.push(r),r.processed=!0);var c=[],d=[];for(i=0;i<a.length;i++)r=a[i],c.push(r.bone),d.push(r.boneInverse);return new Skeleton(c,d)}function Ne(e,t,i){e.traverse(function(e){if(!0===e.isBone){for(var r,n=0;n<t.length;n++){var o=t[n];if(o.name===e.name){r=o.boneInverse;break}}void 0===r&&(r=new Matrix4),i.push({bone:e,boneInverse:r,processed:!1})}})}function Pe(e){for(var t,i=[],r=e.matrix,n=e.nodes,o=e.type,a=e.instanceCameras,s=e.instanceControllers,l=e.instanceLights,u=e.instanceGeometries,h=e.instanceNodes,c=0,p=n.length;c<p;c++)i.push(Re(n[c]));for(c=0,p=a.length;c<p;c++){var f=$(a[c]);null!==f&&i.push(f.clone())}for(c=0,p=s.length;c<p;c++)for(var m=s[c],v=(t=m.id,d(qe.controllers[t],k)),g=De(ce(v.id),m.materials),y=Le(m.skeletons,v.skin.joints),_=0,b=g.length;_<b;_++){var x;(x=g[_]).isSkinnedMesh&&(x.bind(y,v.skin.bindMatrix),x.normalizeSkinWeights()),i.push(x)}for(c=0,p=l.length;c<p;c++){var w=re(l[c]);null!==w&&i.push(w.clone())}for(c=0,p=u.length;c<p;c++)for(_=0,b=(g=De(ce((m=u[c]).id),m.materials)).length;_<b;_++)i.push(g[_]);for(c=0,p=h.length;c<p;c++)i.push(Re(h[c]).clone());if(0===n.length&&1===i.length)x=i[0];else{x="JOINT"===o?new Bone:new Group;for(c=0;c<i.length;c++)x.add(i[c])}return""===x.name&&(x.name="JOINT"===o?e.sid:e.name),x.matrix.copy(r),x.matrix.decompose(x.position,x.quaternion,x.scale),x}var ke=new MeshBasicMaterial({color:16711935});function Ee(e,t){for(var i=[],r=0,n=e.length;r<n;r++){var o=t[e[r]];void 0===o?(console.warn("ColladaLoader: Material with key %s not found. Apply fallback material.",e[r]),i.push(ke)):i.push(X(o))}return i}function De(e,t){var i=[];for(var r in e){var n=e[r],o=Ee(n.materialKeys,t);0===o.length&&("lines"===r||"linestrips"===r?o.push(new LineBasicMaterial):o.push(new MeshPhongMaterial));var a=void 0!==n.data.attributes.skinIndex;if(a)for(var s=0,l=o.length;s<l;s++)o[s].skinning=!0;var u,h=1===o.length?o[0]:o;switch(r){case"lines":u=new LineSegments(n.data,h);break;case"linestrips":u=new Line(n.data,h);break;case"triangles":case"polylist":u=a?new SkinnedMesh(n.data,h):new Mesh(n.data,h)}i.push(u)}return i}function Oe(e){return void 0!==qe.nodes[e]}function Re(e){return d(qe.nodes[e],Pe)}function Fe(e){var t=new Group;t.name=e.name;for(var i=e.children,r=0;r<i.length;r++){var n=i[r];t.add(Re(n.id))}return t}function Ie(e){return d(qe.visualScenes[e],Fe)}if(0===e.length)return{scene:new Scene};var Be=i((new DOMParser).parseFromString(e,"application/xml"),"COLLADA")[0],Ue=Be.getAttribute("version");console.log("ColladaLoader: File version",Ue);var Ve,ze=function(e){return{unit:l(i(e,"unit")[0]),upAxis:u(i(e,"up_axis")[0])}}(i(Be,"asset")[0]),Ge=new TextureLoader(this.manager);Ge.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),TGALoader&&(Ve=new TGALoader(this.manager)).setPath(this.resourcePath||t);var je=[],We={},He=0,qe={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};h(Be,"library_animations","animation",function(e){for(var t={sources:{},samplers:{},channels:{}},i=0,r=e.childNodes.length;i<r;i++){var n,o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"source":n=o.getAttribute("id"),t.sources[n]=ne(o);break;case"sampler":n=o.getAttribute("id"),t.samplers[n]=p(o);break;case"channel":n=o.getAttribute("target"),t.channels[n]=f(o);break;default:console.log(o)}}qe.animations[e.getAttribute("id")]=t}),h(Be,"library_animation_clips","animation_clip",function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"instance_animation":t.animations.push(a(n.getAttribute("url")))}}qe.clips[e.getAttribute("id")]=t}),h(Be,"library_controllers","controller",function(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"skin":t.id=a(n.getAttribute("source")),t.skin=L(n);break;case"morph":t.id=a(n.getAttribute("source")),console.warn("ColladaLoader: Morph target animation not supported yet.")}}qe.controllers[e.getAttribute("id")]=t}),h(Be,"library_images","image",function(e){var t={init_from:i(e,"init_from")[0].textContent};qe.images[e.getAttribute("id")]=t}),h(Be,"library_effects","effect",function(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"profile_COMMON":t.profile=O(n)}}qe.effects[e.getAttribute("id")]=t}),h(Be,"library_materials","material",function(e){for(var t={name:e.getAttribute("name")},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"instance_effect":t.url=a(n.getAttribute("url"))}}qe.materials[e.getAttribute("id")]=t}),h(Be,"library_cameras","camera",function(e){for(var t={name:e.getAttribute("name")},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"optics":t.optics=K(n)}}qe.cameras[e.getAttribute("id")]=t}),h(Be,"library_lights","light",function(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"technique_common":t=ee(n)}}qe.lights[e.getAttribute("id")]=t}),h(Be,"library_geometries","geometry",function(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},r=i(e,"mesh")[0];if(void 0!==r){for(var n=0;n<r.childNodes.length;n++){var o=r.childNodes[n];if(1===o.nodeType){var a=o.getAttribute("id");switch(o.nodeName){case"source":t.sources[a]=ne(o);break;case"vertices":t.vertices=oe(o);break;case"polygons":console.warn("ColladaLoader: Unsupported primitive type: ",o.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(ae(o));break;default:console.log(o)}}}qe.geometries[e.getAttribute("id")]=t}}),h(Be,"library_nodes","node",Ae),h(Be,"library_visual_scenes","visual_scene",function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),i=0;i<t.length;i++){var r=t[i];!1===r.hasAttribute("id")&&r.setAttribute("id","three_default_"+He++)}}(e);for(var r=i(e,"node"),n=0;n<r.length;n++)t.children.push(Ae(r[n]));qe.visualScenes[e.getAttribute("id")]=t}),h(Be,"library_kinematics_models","kinematics_model",function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"technique_common":pe(r,t)}}qe.kinematicsModels[e.getAttribute("id")]=t}),h(Be,"library_physics_models","physics_model",function(e){for(var t={name:e.getAttribute("name")||"",rigidBodies:{}},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"rigid_body":t.rigidBodies[r.getAttribute("name")]={},_e(r,t.rigidBodies[r.getAttribute("name")])}}qe.physicsModels[e.getAttribute("id")]=t}),h(Be,"scene","instance_kinematics_scene",function(e){for(var t={bindJointAxis:[]},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"bind_joint_axis":t.bindJointAxis.push(xe(r))}}qe.kinematicsScenes[a(e.getAttribute("url"))]=t}),c(qe.animations,m),c(qe.clips,A),c(qe.controllers,k),c(qe.images,E),c(qe.effects,q),c(qe.materials,Y),c(qe.cameras,J),c(qe.lights,ie),c(qe.geometries,le),c(qe.visualScenes,Fe),function(){var e=qe.clips;if(!0===s(e)){if(!1===s(qe.animations)){var t=[];for(var i in qe.animations)for(var r=v(i),n=0,o=r.length;n<o;n++)t.push(r[n]);je.push(new AnimationClip("default",-1,t))}}else for(var i in e)je.push(C(i))}(),function(){var e=Object.keys(qe.kinematicsModels)[0],t=Object.keys(qe.kinematicsScenes)[0],i=Object.keys(qe.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var r,n=(r=e,d(qe.kinematicsModels[r],de)),o=function(e){return d(qe.kinematicsScenes[e],we)}(t),a=Ie(i),s=o.bindJointAxis,l={},u=0,h=s.length;u<h;u++){var c=s[u],p=Be.querySelector('[sid="'+c.target+'"]');if(p){var f=p.parentElement;v(c.jointIndex,f)}}var m=new Matrix4;We={joints:n&&n.joints,getJointValue:function(e){var t=l[e];if(t)return t.position;console.warn("ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var i=l[e];if(i){var r=i.joint;if(t>r.limits.max||t<r.limits.min)console.warn("ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+r.limits.min+", max: "+r.limits.max+").");else if(r.static)console.warn("ColladaLoader: Joint "+e+" is static.");else{var n=i.object,o=r.axis,a=i.transforms;Me.identity();for(var s=0;s<a.length;s++){var u=a[s];if(u.sid&&-1!==u.sid.indexOf(e))switch(r.type){case"revolute":Me.multiply(m.makeRotationAxis(o,_Math.degToRad(t)));break;case"prismatic":Me.multiply(m.makeTranslation(o.x*t,o.y*t,o.z*t));break;default:console.warn("ColladaLoader: Unknown joint type: "+r.type)}else switch(u.type){case"matrix":Me.multiply(u.obj);break;case"translate":Me.multiply(m.makeTranslation(u.obj.x,u.obj.y,u.obj.z));break;case"scale":Me.scale(u.obj);break;case"rotate":Me.multiply(m.makeRotationAxis(u.obj,u.angle))}}n.matrix.copy(Me),n.matrix.decompose(n.position,n.quaternion,n.scale),l[e].position=t}}else console.log("ColladaLoader: "+e+" does not exist.")}}}function v(e,t){var i=t.getAttribute("name"),r=n.joints[e];a.traverse(function(n){n.name===i&&(l[e]={object:n,transforms:Se(t),joint:r,position:r.zeroPosition})})}}();var Ye=function(e){return Ie(a(i(e,"instance_visual_scene")[0].getAttribute("url")))}(i(Be,"scene")[0]);return"Z_UP"===ze.upAxis&&Ye.quaternion.setFromEuler(new Euler(-Math.PI/2,0,0)),Ye.scale.multiplyScalar(ze.unit),{animations:je,kinematics:We,library:qe,scene:Ye}}},CompressedTexture.prototype=Object.create(Texture.prototype),CompressedTexture.prototype.constructor=CompressedTexture,CompressedTexture.prototype.isCompressedTexture=!0,Object.assign(CompressedTextureLoader.prototype,{load:function(e,t,i,r){var n=this,o=[],a=new CompressedTexture;a.image=o;var s=new FileLoader(this.manager);function l(l){s.load(e[l],function(e){var i=n._parser(e,!0);o[l]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},6===(u+=1)&&(1===i.mipmapCount&&(a.minFilter=LinearFilter),a.format=i.format,a.needsUpdate=!0,t&&t(a))},i,r)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(e))for(var u=0,h=0,c=e.length;h<c;++h)l(h);else s.load(e,function(e){var i=n._parser(e,!0);if(i.isCubemap)for(var r=i.mipmaps.length/i.mipmapCount,s=0;s<r;s++){o[s]={mipmaps:[]};for(var l=0;l<i.mipmapCount;l++)o[s].mipmaps.push(i.mipmaps[s*i.mipmapCount+l]),o[s].format=i.format,o[s].width=i.width,o[s].height=i.height}else a.image.width=i.width,a.image.height=i.height,a.mipmaps=i.mipmaps;1===i.mipmapCount&&(a.minFilter=LinearFilter),a.format=i.format,a.needsUpdate=!0,t&&t(a)},i,r);return a},setPath:function(e){return this.path=e,this}});var DDSLoader=function(e){CompressedTextureLoader.call(this,e),this._parser=DDSLoader.parse},BlendingMode,color,textureLoader,materialLoader;function RawShaderMaterial(e){ShaderMaterial.call(this,e),this.type="RawShaderMaterial"}function LineLoop(e,t){Line.call(this,e,t),this.type="LineLoop"}function LineDashedMaterial(e){LineBasicMaterial.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}function MeshDepthMaterial(e){Material$1.call(this),this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function MeshDistanceMaterial(e){Material$1.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}function MeshNormalMaterial(e){Material$1.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function MeshStandardMaterial(e){Material$1.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function MeshPhysicalMaterial(e){MeshStandardMaterial.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}function MeshToonMaterial(e){MeshPhongMaterial.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function ShadowMaterial(e){Material$1.call(this),this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.setValues(e)}function SpriteMaterial(e){Material$1.call(this),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.rotation=0,this.sizeAttenuation=!0,this.lights=!1,this.transparent=!0,this.setValues(e)}function MaterialLoader(e){this.manager=void 0!==e?e:DefaultLoadingManager,this.textures={}}function Loader$1(){}DDSLoader.prototype=Object.create(CompressedTextureLoader.prototype),DDSLoader.prototype.constructor=DDSLoader,DDSLoader.parse=function(e,t){var i={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function r(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function n(e,t,i,r){for(var n=i*r*4,o=new Uint8Array(e,t,n),a=new Uint8Array(n),s=0,l=0,u=0;u<r;u++)for(var h=0;h<i;h++){var c=o[l],d=o[++l],p=o[++l],f=o[++l];l++,a[s]=p,a[++s]=d,a[++s]=c,a[++s]=f,s++}return a}var o,a=r("DXT1"),s=r("DXT3"),l=r("DXT5"),u=r("ETC1"),h=new Int32Array(e,0,31);if(542327876!==h[0])return console.error("DDSLoader.parse: Invalid magic number in DDS header."),i;if(4&!h[20])return console.error("DDSLoader.parse: Unsupported format, must contain a FourCC code."),i;var c,d=h[21],p=!1;switch(d){case a:o=8,i.format=RGB_S3TC_DXT1_Format;break;case s:o=16,i.format=RGBA_S3TC_DXT3_Format;break;case l:o=16,i.format=RGBA_S3TC_DXT5_Format;break;case u:o=8,i.format=RGB_ETC1_Format;break;default:if(!(32===h[22]&&16711680&h[23]&&65280&h[24]&&255&h[25]&&4278190080&h[26]))return console.error("DDSLoader.parse: Unsupported FourCC code ",(c=d,String.fromCharCode(255&c,c>>8&255,c>>16&255,c>>24&255))),i;p=!0,o=64,i.format=RGBAFormat}i.mipmapCount=1,131072&h[2]&&!1!==t&&(i.mipmapCount=Math.max(1,h[7]));var f=h[28];if(i.isCubemap=!!(512&f),i.isCubemap&&(!(1024&f)||!(2048&f)||!(4096&f)||!(8192&f)||!(16384&f)||!(32768&f)))return console.error("DDSLoader.parse: Incomplete cubemap faces"),i;i.width=h[4],i.height=h[3];for(var m=h[1]+4,v=i.isCubemap?6:1,g=0;g<v;g++)for(var y=i.width,_=i.height,b=0;b<i.mipmapCount;b++){if(p)var x=(w=n(e,m,y,_)).length;else{x=Math.max(4,y)/4*Math.max(4,_)/4*o;var w=new Uint8Array(e,m,x)}var S={data:w,width:y,height:_};i.mipmaps.push(S),m+=x,y=Math.max(y>>1,1),_=Math.max(_>>1,1)}return i},RawShaderMaterial.prototype=Object.create(ShaderMaterial.prototype),RawShaderMaterial.prototype.constructor=RawShaderMaterial,RawShaderMaterial.prototype.isRawShaderMaterial=!0,LineLoop.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineLoop,isLineLoop:!0}),LineDashedMaterial.prototype=Object.create(LineBasicMaterial.prototype),LineDashedMaterial.prototype.constructor=LineDashedMaterial,LineDashedMaterial.prototype.isLineDashedMaterial=!0,LineDashedMaterial.prototype.copy=function(e){return LineBasicMaterial.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this},MeshDepthMaterial.prototype=Object.create(Material$1.prototype),MeshDepthMaterial.prototype.constructor=MeshDepthMaterial,MeshDepthMaterial.prototype.isMeshDepthMaterial=!0,MeshDepthMaterial.prototype.copy=function(e){return Material$1.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},MeshDistanceMaterial.prototype=Object.create(Material$1.prototype),MeshDistanceMaterial.prototype.constructor=MeshDistanceMaterial,MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0,MeshDistanceMaterial.prototype.copy=function(e){return Material$1.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},MeshNormalMaterial.prototype=Object.create(Material$1.prototype),MeshNormalMaterial.prototype.constructor=MeshNormalMaterial,MeshNormalMaterial.prototype.isMeshNormalMaterial=!0,MeshNormalMaterial.prototype.copy=function(e){return Material$1.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},MeshStandardMaterial.prototype=Object.create(Material$1.prototype),MeshStandardMaterial.prototype.constructor=MeshStandardMaterial,MeshStandardMaterial.prototype.isMeshStandardMaterial=!0,MeshStandardMaterial.prototype.copy=function(e){return Material$1.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},MeshPhysicalMaterial.prototype=Object.create(MeshStandardMaterial.prototype),MeshPhysicalMaterial.prototype.constructor=MeshPhysicalMaterial,MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=!0,MeshPhysicalMaterial.prototype.copy=function(e){return MeshStandardMaterial.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},MeshToonMaterial.prototype=Object.create(MeshPhongMaterial.prototype),MeshToonMaterial.prototype.constructor=MeshToonMaterial,MeshToonMaterial.prototype.isMeshToonMaterial=!0,MeshToonMaterial.prototype.copy=function(e){return MeshPhongMaterial.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},ShadowMaterial.prototype=Object.create(Material$1.prototype),ShadowMaterial.prototype.constructor=ShadowMaterial,ShadowMaterial.prototype.isShadowMaterial=!0,ShadowMaterial.prototype.copy=function(e){return Material$1.prototype.copy.call(this,e),this.color.copy(e.color),this},SpriteMaterial.prototype=Object.create(Material$1.prototype),SpriteMaterial.prototype.constructor=SpriteMaterial,SpriteMaterial.prototype.isSpriteMaterial=!0,SpriteMaterial.prototype.copy=function(e){return Material$1.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this},Object.assign(MaterialLoader.prototype,{load:function(e,t,i,r){var n=this,o=new FileLoader(n.manager);o.setPath(n.path),o.load(e,function(e){t(n.parse(JSON.parse(e)))},i,r)},parse:function(e){var t=this.textures;function i(e){return void 0===t[e]&&console.warn("MaterialLoader: Undefined texture",e),t[e]}var r=new{LineBasicMaterial:LineBasicMaterial,LineDashedMaterial:LineDashedMaterial,MeshBasicMaterial:MeshBasicMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshToonMaterial:MeshToonMaterial,PointsMaterial:PointsMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial}[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearCoat&&(r.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(r.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.vertexColors&&(r.vertexColors=e.vertexColors),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(r.skinning=e.skinning),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.uniforms)for(var n in e.uniforms){var o=e.uniforms[n];switch(r.uniforms[n]={},o.type){case"t":r.uniforms[n].value=i(o.value);break;case"c":r.uniforms[n].value=(new Color).setHex(o.value);break;case"v2":r.uniforms[n].value=(new Vector2).fromArray(o.value);break;case"v3":r.uniforms[n].value=(new Vector3).fromArray(o.value);break;case"v4":r.uniforms[n].value=(new Vector4).fromArray(o.value);break;case"m3":r.uniforms[n].value=(new Matrix3).fromArray(o.value);case"m4":r.uniforms[n].value=(new Matrix4).fromArray(o.value);break;default:r.uniforms[n].value=o.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var a in e.extensions)r.extensions[a]=e.extensions[a];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=i(e.map)),void 0!==e.alphaMap&&(r.alphaMap=i(e.alphaMap),r.transparent=!0),void 0!==e.bumpMap&&(r.bumpMap=i(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=i(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){var s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),r.normalScale=(new Vector2).fromArray(s)}return void 0!==e.displacementMap&&(r.displacementMap=i(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=i(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=i(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=i(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=i(e.specularMap)),void 0!==e.envMap&&(r.envMap=i(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.lightMap&&(r.lightMap=i(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=i(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=i(e.gradientMap)),r},setPath:function(e){return this.path=e,this},setTextures:function(e){return this.textures=e,this}}),Loader$1.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,i=0,r=t.length;i<r;i+=2){var n=t[i],o=t[i+1];if(n.test(e))return o}return null}},Object.assign(Loader$1.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(e,t,i){for(var r=[],n=0;n<e.length;++n)r[n]=this.createMaterial(e[n],t,i);return r},createMaterial:(BlendingMode={NoBlending:NoBlending,NormalBlending:NormalBlending,AdditiveBlending:AdditiveBlending,SubtractiveBlending:SubtractiveBlending,MultiplyBlending:MultiplyBlending,CustomBlending:CustomBlending},color=new Color,textureLoader=new TextureLoader,materialLoader=new MaterialLoader,function(e,t,i){var r={};function n(e,n,o,a,s){var l,u=t+e,h=Loader$1.Handlers.get(u);null!==h?l=h.load(u):(textureLoader.setCrossOrigin(i),l=textureLoader.load(u)),void 0!==n&&(l.repeat.fromArray(n),1!==n[0]&&(l.wrapS=RepeatWrapping),1!==n[1]&&(l.wrapT=RepeatWrapping)),void 0!==o&&l.offset.fromArray(o),void 0!==a&&("repeat"===a[0]&&(l.wrapS=RepeatWrapping),"mirror"===a[0]&&(l.wrapS=MirroredRepeatWrapping),"repeat"===a[1]&&(l.wrapT=RepeatWrapping),"mirror"===a[1]&&(l.wrapT=MirroredRepeatWrapping)),void 0!==s&&(l.anisotropy=s);var c=_Math.generateUUID();return r[c]=l,c}var o={uuid:_Math.generateUUID(),type:"MeshLambertMaterial"};for(var a in e){var s=e[a];switch(a){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":o.name=s;break;case"blending":o.blending=BlendingMode[s];break;case"colorAmbient":case"mapAmbient":console.warn("Loader.createMaterial:",a,"is no longer supported.");break;case"colorDiffuse":o.color=color.fromArray(s).getHex();break;case"colorSpecular":o.specular=color.fromArray(s).getHex();break;case"colorEmissive":o.emissive=color.fromArray(s).getHex();break;case"specularCoef":o.shininess=s;break;case"shading":"basic"===s.toLowerCase()&&(o.type="MeshBasicMaterial"),"phong"===s.toLowerCase()&&(o.type="MeshPhongMaterial"),"standard"===s.toLowerCase()&&(o.type="MeshStandardMaterial");break;case"mapDiffuse":o.map=n(s,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":o.emissiveMap=n(s,e.mapEmissiveRepeat,e.mapEmissiveOffset,e.mapEmissiveWrap,e.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":o.lightMap=n(s,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":o.aoMap=n(s,e.mapAORepeat,e.mapAOOffset,e.mapAOWrap,e.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":o.bumpMap=n(s,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy);break;case"mapBumpScale":o.bumpScale=s;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":o.normalMap=n(s,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy);break;case"mapNormalFactor":o.normalScale=s;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":o.specularMap=n(s,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":o.metalnessMap=n(s,e.mapMetalnessRepeat,e.mapMetalnessOffset,e.mapMetalnessWrap,e.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":o.roughnessMap=n(s,e.mapRoughnessRepeat,e.mapRoughnessOffset,e.mapRoughnessWrap,e.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":o.alphaMap=n(s,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":o.side=BackSide;break;case"doubleSided":o.side=DoubleSide;break;case"transparency":console.warn("Loader.createMaterial: transparency has been renamed to opacity"),o.opacity=s;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":o[a]=s;break;case"vertexColors":!0===s&&(o.vertexColors=VertexColors),"face"===s&&(o.vertexColors=FaceColors);break;default:console.error("Loader.createMaterial: Unsupported",a,s)}}return"MeshBasicMaterial"===o.type&&delete o.emissive,"MeshPhongMaterial"!==o.type&&delete o.specular,o.opacity<1&&(o.transparent=!0),materialLoader.setTextures(r),materialLoader.parse(o)})});var LegacyGLTFLoader=function(){function e(e){this.manager=void 0!==e?e:DefaultLoadingManager}function t(){var e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}},update:function(t,i){for(var r in e){var n=e[r];n.update&&n.update(t,i)}}}}function i(e,t){var i={},r=e.material.uniforms;for(var n in r){var o=r[n];if(o.semantic){var a=o.node,s=e;a&&(s=t[a]),i[n]={semantic:o.semantic,sourceNode:s,targetNode:e,uniform:o}}}this.boundUniforms=i,this._m4=new Matrix4}e.prototype={constructor:e,crossOrigin:"anonymous",load:function(e,t,i,r){var n,o=this;n=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:LoaderUtils.extractUrlBase(e);var a=new FileLoader(o.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.load(e,function(e){o.parse(e,n,t)},i,r)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){this.path=e},setResourcePath:function(e){return this.resourcePath=e,this},parse:function(e,t,i){var a,l={};LoaderUtils.decodeText(new Uint8Array(e,0,4))===o.magic?(l[r.KHR_BINARY_GLTF]=new s(e),a=l[r.KHR_BINARY_GLTF].content):a=LoaderUtils.decodeText(new Uint8Array(e));var u=JSON.parse(a);u.extensionsUsed&&u.extensionsUsed.indexOf(r.KHR_MATERIALS_COMMON)>=0&&(l[r.KHR_MATERIALS_COMMON]=new n(u)),new A(u,l,{crossOrigin:this.crossOrigin,manager:this.manager,path:t||this.resourcePath||""}).parse(function(e,t,r,n){i({scene:e,scenes:t,cameras:r,animations:n})})}},e.Shaders={update:function(){console.warn("LegacyGLTFLoader.Shaders has been deprecated, and now updates automatically.")}},i.prototype.update=function(e,t){var i=this.boundUniforms;for(var r in i){var n=i[r];switch(n.semantic){case"MODELVIEW":n.uniform.value.multiplyMatrices(t.matrixWorldInverse,n.sourceNode.matrixWorld);break;case"MODELVIEWINVERSETRANSPOSE":var o=n.uniform.value;this._m4.multiplyMatrices(t.matrixWorldInverse,n.sourceNode.matrixWorld),o.getNormalMatrix(this._m4);break;case"PROJECTION":n.uniform.value.copy(t.projectionMatrix);break;case"JOINTMATRIX":for(var a=n.uniform.value,s=0;s<a.length;s++)a[s].getInverse(n.sourceNode.matrixWorld).multiply(n.targetNode.skeleton.bones[s].matrixWorld).multiply(n.targetNode.skeleton.boneInverses[s]).multiply(n.targetNode.bindMatrix);break;default:console.warn("Unhandled shader semantic: "+n.semantic)}}},e.Animations={update:function(){console.warn("LegacyGLTFLoader.Animation has been deprecated. Use AnimationMixer instead.")}};var r={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_MATERIALS_COMMON:"KHR_materials_common"};function n(e){this.name=r.KHR_MATERIALS_COMMON,this.lights={};var t=(e.extensions&&e.extensions[r.KHR_MATERIALS_COMMON]||{}).lights||{};for(var i in t){var n,o=t[i],a=o[o.type],s=(new Color).fromArray(a.color);switch(o.type){case"directional":(n=new DirectionalLight(s)).position.set(0,0,1);break;case"point":n=new PointLight(s);break;case"spot":(n=new SpotLight(s)).position.set(0,0,1);break;case"ambient":n=new AmbientLight(s)}n&&(this.lights[i]=n)}}var o={magic:"glTF",version:1,contentFormat:0},a=20;function s(e){this.name=r.KHR_BINARY_GLTF;var t=new DataView(e,0,a),i={magic:LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0),contentLength:t.getUint32(12,!0),contentFormat:t.getUint32(16,!0)};for(var n in o){var s=o[n];if(i[n]!==s)throw new Error('Unsupported glTF-Binary header: Expected "%s" to be "%s".',n,s)}var l=new Uint8Array(e,a,i.contentLength);this.header=i,this.content=LoaderUtils.decodeText(l),this.body=e.slice(a+i.contentLength,i.length)}s.prototype.loadShader=function(e,t){var i=t[e.extensions[r.KHR_BINARY_GLTF].bufferView],n=new Uint8Array(i);return LoaderUtils.decodeText(n)};var l={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,TRIANGLES:4,LINES:1,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,VERTEX_SHADER:35633,FRAGMENT_SHADER:35632},u={5126:Number,35675:Matrix3,35676:Matrix4,35664:Vector2,35665:Vector3,35666:Vector4,35678:Texture},h={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},c={9728:NearestFilter,9729:LinearFilter,9984:NearestMipMapNearestFilter,9985:LinearMipMapNearestFilter,9986:NearestMipMapLinearFilter,9987:LinearMipMapLinearFilter},d={33071:ClampToEdgeWrapping,33648:MirroredRepeatWrapping,10497:RepeatWrapping},p={6406:AlphaFormat,6407:RGBFormat,6408:RGBAFormat,6409:LuminanceFormat,6410:LuminanceAlphaFormat},f={5121:UnsignedByteType,32819:UnsignedShort4444Type,32820:UnsignedShort5551Type,33635:UnsignedShort565Type},m={1028:BackSide,1029:FrontSide},v={512:NeverDepth,513:LessDepth,514:EqualDepth,515:LessEqualDepth,516:GreaterEqualDepth,517:NotEqualDepth,518:GreaterEqualDepth,519:AlwaysDepth},g={32774:AddEquation,32778:SubtractEquation,32779:ReverseSubtractEquation},y={0:ZeroFactor,1:OneFactor,768:SrcColorFactor,769:OneMinusSrcColorFactor,770:SrcAlphaFactor,771:OneMinusSrcAlphaFactor,772:DstAlphaFactor,773:OneMinusDstAlphaFactor,774:DstColorFactor,775:OneMinusDstColorFactor,776:SrcAlphaSaturateFactor},_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},b={scale:"scale",translation:"position",rotation:"quaternion"},x={LINEAR:InterpolateLinear,STEP:InterpolateDiscrete},w={2884:"CULL_FACE",2929:"DEPTH_TEST",3042:"BLEND",3089:"SCISSOR_TEST",32823:"POLYGON_OFFSET_FILL",32926:"SAMPLE_ALPHA_TO_COVERAGE"};function S(e,t,i){var r;if(!e)return Promise.resolve();var n=[];if("[object Array]"===Object.prototype.toString.call(e)){r=[];for(var o=e.length,a=0;a<o;a++){(l=t.call(i||this,e[a],a))&&(n.push(l),l instanceof Promise?l.then(function(e,t){r[e]=t}.bind(this,a)):r[a]=l)}}else for(var s in r={},e){var l;if(e.hasOwnProperty(s))(l=t.call(i||this,e[s],s))&&(n.push(l),l instanceof Promise?l.then(function(e,t){r[e]=t}.bind(this,s)):r[s]=l)}return Promise.all(n).then(function(){return r})}function M(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:(t||"")+e}function T(e){this.isDeferredShaderMaterial=!0,this.params=e}function A(e,i,r){this.json=e||{},this.extensions=i||{},this.options=r||{},this.cache=new t}return T.prototype.create=function(){var e=UniformsUtils.clone(this.params.uniforms);for(var t in this.params.uniforms){var i=this.params.uniforms[t];i.value instanceof Texture&&(e[t].value=i.value,e[t].value.needsUpdate=!0),e[t].semantic=i.semantic,e[t].node=i.node}return this.params.uniforms=e,new RawShaderMaterial(this.params)},A.prototype._withDependencies=function(e){for(var t={},i=0;i<e.length;i++){var r=e[i],n="load"+r.charAt(0).toUpperCase()+r.slice(1),o=this.cache.get(r);if(void 0!==o)t[r]=o;else if(this[n]){var a=this[n]();this.cache.add(r,a),t[r]=a}}return S(t,function(e){return e})},A.prototype.parse=function(e){var t=this.json;this.cache.removeAll(),this._withDependencies(["scenes","cameras","animations"]).then(function(i){var r=[];for(var n in i.scenes)r.push(i.scenes[n]);var o=void 0!==t.scene?i.scenes[t.scene]:r[0],a=[];for(var n in i.cameras){var s=i.cameras[n];a.push(s)}var l=[];for(var n in i.animations)l.push(i.animations[n]);e(o,r,a,l)})},A.prototype.loadShaders=function(){var e=this.json,t=this.extensions,i=this.options;return this._withDependencies(["bufferViews"]).then(function(n){return S(e.shaders,function(e){return e.extensions&&e.extensions[r.KHR_BINARY_GLTF]?t[r.KHR_BINARY_GLTF].loadShader(e,n.bufferViews):new Promise(function(t){var r=new FileLoader(i.manager);r.setResponseType("text"),r.load(M(e.uri,i.path),function(e){t(e)})})})})},A.prototype.loadBuffers=function(){var e=this.json,t=this.extensions,i=this.options;return S(e.buffers,function(e,n){return"binary_glTF"===n?t[r.KHR_BINARY_GLTF].body:"arraybuffer"===e.type||void 0===e.type?new Promise(function(t){var r=new FileLoader(i.manager);r.setResponseType("arraybuffer"),r.load(M(e.uri,i.path),function(e){t(e)})}):void console.warn("LegacyGLTFLoader: "+e.type+" buffer type is not supported")})},A.prototype.loadBufferViews=function(){var e=this.json;return this._withDependencies(["buffers"]).then(function(t){return S(e.bufferViews,function(e){var i=t.buffers[e.buffer],r=void 0!==e.byteLength?e.byteLength:0;return i.slice(e.byteOffset,e.byteOffset+r)})})},A.prototype.loadAccessors=function(){var e=this.json;return this._withDependencies(["bufferViews"]).then(function(t){return S(e.accessors,function(e){var i=t.bufferViews[e.bufferView],r=_[e.type],n=h[e.componentType],o=n.BYTES_PER_ELEMENT,a=o*r;if(e.byteStride&&e.byteStride!==a){var s=new n(i);return new InterleavedBufferAttribute(new InterleavedBuffer(s,e.byteStride/o),r,e.byteOffset/o)}return new BufferAttribute(s=new n(i,e.byteOffset,e.count*r),r)})})},A.prototype.loadTextures=function(){var e=this.json,t=(this.extensions,this.options);return this._withDependencies(["bufferViews"]).then(function(i){return S(e.textures,function(n){if(n.source)return new Promise(function(o){var a=e.images[n.source],s=a.uri,l=!1;if(a.extensions&&a.extensions[r.KHR_BINARY_GLTF]){var u=a.extensions[r.KHR_BINARY_GLTF],h=i.bufferViews[u.bufferView],m=new Blob([h],{type:u.mimeType});s=URL.createObjectURL(m),l=!0}var v=Loader$1.Handlers.get(s);null===v&&(v=new TextureLoader(t.manager)),v.setCrossOrigin(t.crossOrigin),v.load(M(s,t.path),function(t){if(l&&URL.revokeObjectURL(s),t.flipY=!1,void 0!==n.name&&(t.name=n.name),t.format=void 0!==n.format?p[n.format]:RGBAFormat,void 0!==n.internalFormat&&t.format!==p[n.internalFormat]&&console.warn("LegacyGLTFLoader: Three.js doesn't support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format."),t.type=void 0!==n.type?f[n.type]:UnsignedByteType,n.sampler){var i=e.samplers[n.sampler];t.magFilter=c[i.magFilter]||LinearFilter,t.minFilter=c[i.minFilter]||NearestMipMapLinearFilter,t.wrapS=d[i.wrapS]||RepeatWrapping,t.wrapT=d[i.wrapT]||RepeatWrapping}o(t)},void 0,function(){l&&URL.revokeObjectURL(s),o()})})})})},A.prototype.loadMaterials=function(){var e=this.json;return this._withDependencies(["shaders","textures"]).then(function(t){return S(e.materials,function(i){var n,o,a={},s={};if(i.extensions&&i.extensions[r.KHR_MATERIALS_COMMON]&&(o=i.extensions[r.KHR_MATERIALS_COMMON]),o){var h=["ambient","emission","transparent","transparency","doubleSided"];switch(o.technique){case"BLINN":case"PHONG":n=MeshPhongMaterial,h.push("diffuse","specular","shininess");break;case"LAMBERT":n=MeshLambertMaterial,h.push("diffuse");break;case"CONSTANT":default:n=MeshBasicMaterial}h.forEach(function(e){void 0!==o.values[e]&&(a[e]=o.values[e])}),(o.doubleSided||a.doubleSided)&&(s.side=DoubleSide),(o.transparent||a.transparent)&&(s.transparent=!0,s.opacity=void 0!==a.transparency?a.transparency:1)}else if(void 0===i.technique)n=MeshPhongMaterial,Object.assign(a,i.values);else{n=T;var c=e.techniques[i.technique];s.uniforms={};var d=e.programs[c.program];if(d){s.fragmentShader=t.shaders[d.fragmentShader],s.fragmentShader||(console.warn("ERROR: Missing fragment shader definition:",d.fragmentShader),n=MeshPhongMaterial);var p=t.shaders[d.vertexShader];p||(console.warn("ERROR: Missing vertex shader definition:",d.vertexShader),n=MeshPhongMaterial),s.vertexShader=function(e,t){var i={};for(var r in t.attributes){var n=t.attributes[r],o=(c=t.parameters[n]).type,a=c.semantic;i[r]={type:o,semantic:a}}var s=t.parameters,l=t.attributes,u={};for(var r in i){var h=s[n=l[r]];(a=h.semantic)&&(u[r]=h)}for(var n in u){a=(c=u[n]).semantic;var c,d=new RegExp("\\b"+n+"\\b","g");switch(a){case"POSITION":e=e.replace(d,"position");break;case"NORMAL":e=e.replace(d,"normal");break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":e=e.replace(d,"uv");break;case"TEXCOORD_1":e=e.replace(d,"uv2");break;case"COLOR_0":case"COLOR0":case"COLOR":e=e.replace(d,"color");break;case"WEIGHT":e=e.replace(d,"skinWeight");break;case"JOINT":e=e.replace(d,"skinIndex")}}return e}(p,c);var f=c.uniforms;for(var _ in f){var b=f[_],x=c.parameters[b],S=x.type;if(!u[S])throw new Error("Unknown shader uniform param type: "+S);var M,A=x.count;void 0!==i.values&&(M=i.values[b]);var C=new u[S],L=x.semantic,N=x.node;switch(S){case l.FLOAT:C=x.value,"transparency"==b&&(s.transparent=!0),void 0!==M&&(C=M);break;case l.FLOAT_VEC2:case l.FLOAT_VEC3:case l.FLOAT_VEC4:case l.FLOAT_MAT3:x&&x.value&&C.fromArray(x.value),M&&C.fromArray(M);break;case l.FLOAT_MAT2:console.warn("FLOAT_MAT2 is not a supported uniform type");break;case l.FLOAT_MAT4:if(A){C=new Array(A);for(var P=0;P<A;P++)C[P]=new u[S];if(x&&x.value){var k=x.value;C.fromArray(k)}M&&C.fromArray(M)}else{if(x&&x.value){var E=x.value;C.fromArray(E)}M&&C.fromArray(M)}break;case l.SAMPLER_2D:C=void 0!==M?t.textures[M]:void 0!==x.value?t.textures[x.value]:null}s.uniforms[_]={value:C,semantic:L,node:N}}for(var D=c.states||{},O=D.enable||[],R=D.functions||{},F=!1,I=!1,B=!1,U=0,V=O.length;U<V;U++){var z=O[U];switch(w[z]){case"CULL_FACE":F=!0;break;case"DEPTH_TEST":I=!0;break;case"BLEND":B=!0;break;case"SCISSOR_TEST":case"POLYGON_OFFSET_FILL":case"SAMPLE_ALPHA_TO_COVERAGE":break;default:throw new Error("Unknown technique.states.enable: "+z)}}s.side=F?void 0!==R.cullFace?m[R.cullFace]:FrontSide:DoubleSide,s.depthTest=I,s.depthFunc=void 0!==R.depthFunc?v[R.depthFunc]:LessDepth,s.depthWrite=void 0===R.depthMask||R.depthMask[0],s.blending=B?CustomBlending:NoBlending,s.transparent=B;var G=R.blendEquationSeparate;void 0!==G?(s.blendEquation=g[G[0]],s.blendEquationAlpha=g[G[1]]):(s.blendEquation=AddEquation,s.blendEquationAlpha=AddEquation);var j=R.blendFuncSeparate;void 0!==j?(s.blendSrc=y[j[0]],s.blendDst=y[j[1]],s.blendSrcAlpha=y[j[2]],s.blendDstAlpha=y[j[3]]):(s.blendSrc=OneFactor,s.blendDst=ZeroFactor,s.blendSrcAlpha=OneFactor,s.blendDstAlpha=ZeroFactor)}}Array.isArray(a.diffuse)?s.color=(new Color).fromArray(a.diffuse):"string"==typeof a.diffuse&&(s.map=t.textures[a.diffuse]),delete s.diffuse,"string"==typeof a.reflective&&(s.envMap=t.textures[a.reflective]),"string"==typeof a.bump&&(s.bumpMap=t.textures[a.bump]),Array.isArray(a.emission)?n===MeshBasicMaterial?s.color=(new Color).fromArray(a.emission):s.emissive=(new Color).fromArray(a.emission):"string"==typeof a.emission&&(n===MeshBasicMaterial?s.map=t.textures[a.emission]:s.emissiveMap=t.textures[a.emission]),Array.isArray(a.specular)?s.specular=(new Color).fromArray(a.specular):"string"==typeof a.specular&&(s.specularMap=t.textures[a.specular]),void 0!==a.shininess&&(s.shininess=a.shininess);var W=new n(s);return void 0!==i.name&&(W.name=i.name),W})})},A.prototype.loadMeshes=function(){var e=this.json;return this._withDependencies(["accessors","materials"]).then(function(t){return S(e.meshes,function(i){var r=new Group;void 0!==i.name&&(r.name=i.name),i.extras&&(r.userData=i.extras);var n=i.primitives||[];for(var o in n){var a=n[o];if(a.mode===l.TRIANGLES||void 0===a.mode){var s=new BufferGeometry,u=a.attributes;for(var h in u){if(!(f=u[h]))return;var c=t.accessors[f];switch(h){case"POSITION":s.addAttribute("position",c);break;case"NORMAL":s.addAttribute("normal",c);break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":s.addAttribute("uv",c);break;case"TEXCOORD_1":s.addAttribute("uv2",c);break;case"COLOR_0":case"COLOR0":case"COLOR":s.addAttribute("color",c);break;case"WEIGHT":s.addAttribute("skinWeight",c);break;case"JOINT":s.addAttribute("skinIndex",c);break;default:if(!a.material)break;if(!(v=e.materials[a.material]).technique)break;var d=e.techniques[v.technique].parameters||{};for(var p in d)d[p].semantic===h&&s.addAttribute(p,c)}}a.indices&&s.setIndex(t.accessors[a.indices]),(m=new Mesh(s,v=void 0!==t.materials?t.materials[a.material]:new MeshPhongMaterial({color:0,emissive:8947848,specular:0,shininess:0,transparent:!1,depthTest:!0,side:FrontSide}))).castShadow=!0,m.name="0"===o?r.name:r.name+o,a.extras&&(m.userData=a.extras),r.add(m)}else if(a.mode===l.LINES){s=new BufferGeometry,u=a.attributes;for(var h in u){var f;if(!(f=u[h]))return;c=t.accessors[f];switch(h){case"POSITION":s.addAttribute("position",c);break;case"COLOR_0":case"COLOR0":case"COLOR":s.addAttribute("color",c)}}var m,v=t.materials[a.material];a.indices?(s.setIndex(t.accessors[a.indices]),m=new LineSegments(s,v)):m=new Line(s,v),m.name="0"===o?r.name:r.name+o,a.extras&&(m.userData=a.extras),r.add(m)}else console.warn("Only triangular and line primitives are supported")}return r})})},A.prototype.loadCameras=function(){return S(this.json.cameras,function(e){if("perspective"==e.type&&e.perspective){var t=e.perspective.yfov,i=void 0!==e.perspective.aspectRatio?e.perspective.aspectRatio:1,r=t*i,n=new PerspectiveCamera(_Math.radToDeg(r),i,e.perspective.znear||1,e.perspective.zfar||2e6);return void 0!==e.name&&(n.name=e.name),e.extras&&(n.userData=e.extras),n}if("orthographic"==e.type&&e.orthographic){n=new OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,e.orthographic.znear,e.orthographic.zfar);return void 0!==e.name&&(n.name=e.name),e.extras&&(n.userData=e.extras),n}})},A.prototype.loadSkins=function(){var e=this.json;return this._withDependencies(["accessors"]).then(function(t){return S(e.skins,function(e){var i=new Matrix4;return void 0!==e.bindShapeMatrix&&i.fromArray(e.bindShapeMatrix),{bindShapeMatrix:i,jointNames:e.jointNames,inverseBindMatrices:t.accessors[e.inverseBindMatrices]}})})},A.prototype.loadAnimations=function(){var e=this.json;return this._withDependencies(["accessors","nodes"]).then(function(t){return S(e.animations,function(e,i){var r=[];for(var n in e.channels){var o=e.channels[n],a=e.samplers[o.sampler];if(a){var s=o.target,l=s.id,u=void 0!==e.parameters?e.parameters[a.input]:a.input,h=void 0!==e.parameters?e.parameters[a.output]:a.output,c=t.accessors[u],d=t.accessors[h],p=t.nodes[l];if(p){p.updateMatrix(),p.matrixAutoUpdate=!0;var f=b[s.path]===b.rotation?QuaternionKeyframeTrack:VectorKeyframeTrack,m=p.name?p.name:p.uuid,v=void 0!==a.interpolation?x[a.interpolation]:InterpolateLinear;r.push(new f(m+"."+b[s.path],AnimationUtils.arraySlice(c.array,0),AnimationUtils.arraySlice(d.array,0),v))}}}return new AnimationClip(l=void 0!==e.name?e.name:"animation_"+i,void 0,r)})})},A.prototype.loadNodes=function(){var e=this.json,t=this.extensions,i=this;return S(e.nodes,function(e){var t,i=new Matrix4;return e.jointName?((t=new Bone).name=void 0!==e.name?e.name:e.jointName,t.jointName=e.jointName):(t=new Object3D,void 0!==e.name&&(t.name=e.name)),e.extras&&(t.userData=e.extras),void 0!==e.matrix?(i.fromArray(e.matrix),t.applyMatrix(i)):(void 0!==e.translation&&t.position.fromArray(e.translation),void 0!==e.rotation&&t.quaternion.fromArray(e.rotation),void 0!==e.scale&&t.scale.fromArray(e.scale)),t}).then(function(n){return i._withDependencies(["meshes","skins","cameras"]).then(function(i){return S(n,function(o,a){var s=e.nodes[a];if(void 0!==s.meshes)for(var l in s.meshes){var u=s.meshes[l],h=i.meshes[u];if(void 0!==h)for(var c in h.children){var d,p=h.children[c],f=p.material,m=p.geometry,v=p.userData,g=p.name;switch(f.isDeferredShaderMaterial?f=y=f.create():y=f,p.type){case"LineSegments":p=new LineSegments(m,y);break;case"LineLoop":p=new LineLoop(m,y);break;case"Line":p=new Line(m,y);break;default:p=new Mesh(m,y)}if(p.castShadow=!0,p.userData=v,p.name=g,s.skin&&(d=i.skins[s.skin]),d){var y,_=function(e){for(var t=Object.keys(n),i=0,r=t.length;i<r;i++){var o=n[t[i]];if(o.jointName===e)return o}return null},b=m;(y=f).skinning=!0,(p=new SkinnedMesh(b,y)).castShadow=!0,p.userData=v,p.name=g;for(var x=[],w=[],S=0,M=d.jointNames.length;S<M;S++){var T=d.jointNames[S],A=_(T);if(A){x.push(A);var C=d.inverseBindMatrices.array,L=(new Matrix4).fromArray(C,16*S);w.push(L)}else console.warn("WARNING: joint: '"+T+"' could not be found")}p.bind(new Skeleton(x,w),d.bindShapeMatrix);var N=function(t,i,r){var o=t[r];if(void 0!==o)for(var a=0,s=o.length;a<s;a++){var l=o[a],u=n[l],h=e.nodes[l];void 0!==u&&!0===u.isBone&&void 0!==h&&(i.add(u),N(h,u,"children"))}};N(s,p,"skeletons")}o.add(p)}else console.warn("LegacyGLTFLoader: Couldn't find node \""+u+'".')}if(void 0!==s.camera){var P=i.cameras[s.camera];o.add(P)}if(s.extensions&&s.extensions[r.KHR_MATERIALS_COMMON]&&s.extensions[r.KHR_MATERIALS_COMMON].light){var k=t[r.KHR_MATERIALS_COMMON].lights[s.extensions[r.KHR_MATERIALS_COMMON].light];o.add(k)}return o})})})},A.prototype.loadScenes=function(){var e=this.json;function t(i,r,n){var o=n[i];r.add(o);var a=e.nodes[i];if(a.children)for(var s=a.children,l=0,u=s.length;l<u;l++){t(s[l],o,n)}}return this._withDependencies(["nodes"]).then(function(r){return S(e.scenes,function(e){var n=new Scene;void 0!==e.name&&(n.name=e.name),e.extras&&(n.userData=e.extras);for(var o=e.nodes||[],a=0,s=o.length;a<s;a++){t(o[a],n,r.nodes)}return n.traverse(function(e){e.material&&e.material.isRawShaderMaterial&&(e.gltfShader=new i(e,r.nodes),e.onBeforeRender=function(e,t,i){this.gltfShader.update(t,i)})}),n})})},e}(),LegacyJSONLoader=function(){function e(e){"boolean"==typeof e&&(console.warn("JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:DefaultLoadingManager,this.withCredentials=!1}return Object.assign(e.prototype,{crossOrigin:"anonymous",load:function(e,t,i,r){var n=this,o=void 0===this.path?LoaderUtils.extractUrlBase(e):this.path,a=new FileLoader(this.manager);a.setPath(this.path),a.setWithCredentials(this.withCredentials),a.load(e,function(i){var r=JSON.parse(i),a=r.metadata;if(void 0!==a){var s=a.type;if(void 0!==s&&"object"===s.toLowerCase())return void console.error("JSONLoader: "+e+" should be loaded with ObjectLoader instead.")}var l=n.parse(r,o);t(l.geometry,l.materials)},i,r)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(){return function(e,t){void 0!==e.data&&(e=e.data),void 0!==e.scale?e.scale=1/e.scale:e.scale=1;var i=new Geometry;return function(e,t){function i(e,t){return e&1<<t}var r,n,o,a,s,l,u,h,c,d,p,f,m,v,g,y,_,b,x,w,S,M,T,A,C,L=e.faces,N=e.vertices,P=e.normals,k=e.colors,E=e.scale,D=0;if(void 0!==e.uvs){for(r=0;r<e.uvs.length;r++)e.uvs[r].length&&D++;for(r=0;r<D;r++)t.faceVertexUvs[r]=[]}for(a=0,s=N.length;a<s;)(b=new Vector3).x=N[a++]*E,b.y=N[a++]*E,b.z=N[a++]*E,t.vertices.push(b);for(a=0,s=L.length;a<s;)if(p=i(d=L[a++],0),f=i(d,1),m=i(d,3),v=i(d,4),g=i(d,5),y=i(d,6),_=i(d,7),p){if((w=new Face3).a=L[a],w.b=L[a+1],w.c=L[a+3],(S=new Face3).a=L[a+1],S.b=L[a+2],S.c=L[a+3],a+=4,f&&(c=L[a++],w.materialIndex=c,S.materialIndex=c),o=t.faces.length,m)for(r=0;r<D;r++)for(A=e.uvs[r],t.faceVertexUvs[r][o]=[],t.faceVertexUvs[r][o+1]=[],n=0;n<4;n++)C=new Vector2(A[2*(h=L[a++])],A[2*h+1]),2!==n&&t.faceVertexUvs[r][o].push(C),0!==n&&t.faceVertexUvs[r][o+1].push(C);if(v&&(u=3*L[a++],w.normal.set(P[u++],P[u++],P[u]),S.normal.copy(w.normal)),g)for(r=0;r<4;r++)u=3*L[a++],T=new Vector3(P[u++],P[u++],P[u]),2!==r&&w.vertexNormals.push(T),0!==r&&S.vertexNormals.push(T);if(y&&(M=k[l=L[a++]],w.color.setHex(M),S.color.setHex(M)),_)for(r=0;r<4;r++)M=k[l=L[a++]],2!==r&&w.vertexColors.push(new Color(M)),0!==r&&S.vertexColors.push(new Color(M));t.faces.push(w),t.faces.push(S)}else{if((x=new Face3).a=L[a++],x.b=L[a++],x.c=L[a++],f&&(c=L[a++],x.materialIndex=c),o=t.faces.length,m)for(r=0;r<D;r++)for(A=e.uvs[r],t.faceVertexUvs[r][o]=[],n=0;n<3;n++)C=new Vector2(A[2*(h=L[a++])],A[2*h+1]),t.faceVertexUvs[r][o].push(C);if(v&&(u=3*L[a++],x.normal.set(P[u++],P[u++],P[u])),g)for(r=0;r<3;r++)u=3*L[a++],T=new Vector3(P[u++],P[u++],P[u]),x.vertexNormals.push(T);if(y&&(l=L[a++],x.color.setHex(k[l])),_)for(r=0;r<3;r++)l=L[a++],x.vertexColors.push(new Color(k[l]));t.faces.push(x)}}(e,i),function(e,t){var i=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var r=0,n=e.skinWeights.length;r<n;r+=i){var o=e.skinWeights[r],a=i>1?e.skinWeights[r+1]:0,s=i>2?e.skinWeights[r+2]:0,l=i>3?e.skinWeights[r+3]:0;t.skinWeights.push(new Vector4(o,a,s,l))}if(e.skinIndices)for(r=0,n=e.skinIndices.length;r<n;r+=i){var u=e.skinIndices[r],h=i>1?e.skinIndices[r+1]:0,c=i>2?e.skinIndices[r+2]:0,d=i>3?e.skinIndices[r+3]:0;t.skinIndices.push(new Vector4(u,h,c,d))}t.bones=e.bones,t.bones&&t.bones.length>0&&(t.skinWeights.length!==t.skinIndices.length||t.skinIndices.length!==t.vertices.length)&&console.warn("When skinning, number of vertices ("+t.vertices.length+"), skinIndices ("+t.skinIndices.length+"), and skinWeights ("+t.skinWeights.length+") should match.")}(e,i),function(e,t){var i=e.scale;if(void 0!==e.morphTargets)for(var r=0,n=e.morphTargets.length;r<n;r++){t.morphTargets[r]={},t.morphTargets[r].name=e.morphTargets[r].name,t.morphTargets[r].vertices=[];for(var o=t.morphTargets[r].vertices,a=e.morphTargets[r].vertices,s=0,l=a.length;s<l;s+=3){var u=new Vector3;u.x=a[s]*i,u.y=a[s+1]*i,u.z=a[s+2]*i,o.push(u)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn('JSONLoader: "morphColors" no longer supported. Using them as face colors.');var h=t.faces,c=e.morphColors[0].colors;for(r=0,n=h.length;r<n;r++)h[r].color.fromArray(c,3*r)}}(e,i),function(e,t){var i=[],r=[];void 0!==e.animation&&r.push(e.animation),void 0!==e.animations&&(e.animations.length?r=r.concat(e.animations):r.push(e.animations));for(var n=0;n<r.length;n++){var o=AnimationClip.parseAnimation(r[n],t.bones);o&&i.push(o)}if(t.morphTargets){var a=AnimationClip.CreateClipsFromMorphTargetSequences(t.morphTargets,10);i=i.concat(a)}i.length>0&&(t.animations=i)}(e,i),i.computeFaceNormals(),i.computeBoundingSphere(),void 0===e.materials||0===e.materials.length?{geometry:i}:{geometry:i,materials:Loader$1.prototype.initMaterials(e.materials,this.resourcePath||t,this.crossOrigin)}}}()}),e}(),DRACOLoader$1=function(e){this.timeLoaded=0,this.manager=e||DefaultLoadingManager,this.materials=null,this.verbosity=0,this.attributeOptions={},this.drawMode=TrianglesDrawMode,this.nativeAttributeMap={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"}};function WebGLRenderTargetCube(e,t,i){WebGLRenderTarget.call(this,e,t,i)}function CubeCamera(e,t,i,r){Object3D.call(this),this.type="CubeCamera";var n=new PerspectiveCamera(90,1,e,t);n.up.set(0,-1,0),n.lookAt(new Vector3(1,0,0)),this.add(n);var o=new PerspectiveCamera(90,1,e,t);o.up.set(0,-1,0),o.lookAt(new Vector3(-1,0,0)),this.add(o);var a=new PerspectiveCamera(90,1,e,t);a.up.set(0,0,1),a.lookAt(new Vector3(0,1,0)),this.add(a);var s=new PerspectiveCamera(90,1,e,t);s.up.set(0,0,-1),s.lookAt(new Vector3(0,-1,0)),this.add(s);var l=new PerspectiveCamera(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new Vector3(0,0,1)),this.add(l);var u=new PerspectiveCamera(90,1,e,t);u.up.set(0,-1,0),u.lookAt(new Vector3(0,0,-1)),this.add(u),r=r||{format:RGBFormat,magFilter:LinearFilter,minFilter:LinearFilter},this.renderTarget=new WebGLRenderTargetCube(i,i,r),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var i=e.getRenderTarget(),r=this.renderTarget,h=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(t,n),e.setRenderTarget(r,1),e.render(t,o),e.setRenderTarget(r,2),e.render(t,a),e.setRenderTarget(r,3),e.render(t,s),e.setRenderTarget(r,4),e.render(t,l),r.texture.generateMipmaps=h,e.setRenderTarget(r,5),e.render(t,u),e.setRenderTarget(i)},this.clear=function(e,t,i,r){for(var n=e.getRenderTarget(),o=this.renderTarget,a=0;a<6;a++)e.setRenderTarget(o,a),e.clear(t,i,r);e.setRenderTarget(n)}}DRACOLoader$1.prototype={constructor:DRACOLoader$1,load:function(e,t,i,r){var n=this,o=new FileLoader(n.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.load(e,function(e){n.decodeDracoFile(e,t)},i,r)},setPath:function(e){return this.path=e,this},setVerbosity:function(e){return this.verbosity=e,this},setDrawMode:function(e){return this.drawMode=e,this},setSkipDequantization:function(e,t){var i=!0;return void 0!==t&&(i=t),this.getAttributeOptions(e).skipDequantization=i,this},decodeDracoFile:function(e,t,i,r){var n=this;DRACOLoader$1.getDecoderModule().then(function(o){n.decodeDracoFileInternal(e,o.decoder,t,i,r)})},decodeDracoFileInternal:function(e,t,i,r,n){var o=new t.DecoderBuffer;o.Init(new Int8Array(e),e.byteLength);var a=new t.Decoder,s=a.GetEncodedGeometryType(o);if(s==t.TRIANGULAR_MESH)this.verbosity>0&&console.log("Loaded a mesh.");else{if(s!=t.POINT_CLOUD){var l="DRACOLoader: Unknown geometry type.";throw console.error(l),new Error(l)}this.verbosity>0&&console.log("Loaded a point cloud.")}i(this.convertDracoGeometryTo3JS(t,a,s,o,r,n))},addAttributeToGeometry:function(e,t,i,r,n,o,a,s){if(0===o.ptr){var l="DRACOLoader: No attribute "+r;throw console.error(l),new Error(l)}var u,h,c=o.num_components(),d=i.num_points()*c;switch(n){case Float32Array:u=new e.DracoFloat32Array,t.GetAttributeFloatForAllPoints(i,o,u),s[r]=new Float32Array(d),h=Float32BufferAttribute;break;case Int8Array:u=new e.DracoInt8Array,t.GetAttributeInt8ForAllPoints(i,o,u),s[r]=new Int8Array(d),h=Int8BufferAttribute;break;case Int16Array:u=new e.DracoInt16Array,t.GetAttributeInt16ForAllPoints(i,o,u),s[r]=new Int16Array(d),h=Int16BufferAttribute;break;case Int32Array:u=new e.DracoInt32Array,t.GetAttributeInt32ForAllPoints(i,o,u),s[r]=new Int32Array(d),h=Int32BufferAttribute;break;case Uint8Array:u=new e.DracoUInt8Array,t.GetAttributeUInt8ForAllPoints(i,o,u),s[r]=new Uint8Array(d),h=Uint8BufferAttribute;break;case Uint16Array:u=new e.DracoUInt16Array,t.GetAttributeUInt16ForAllPoints(i,o,u),s[r]=new Uint16Array(d),h=Uint16BufferAttribute;break;case Uint32Array:u=new e.DracoUInt32Array,t.GetAttributeUInt32ForAllPoints(i,o,u),s[r]=new Uint32Array(d),h=Uint32BufferAttribute;break;default:l="DRACOLoader: Unexpected attribute type.";throw console.error(l),new Error(l)}for(var p=0;p<d;p++)s[r][p]=u.GetValue(p);a.addAttribute(r,new h(s[r],c)),e.destroy(u)},convertDracoGeometryTo3JS:function(e,t,i,r,n,o){var a,s;!0===this.getAttributeOptions("position").skipDequantization&&t.SkipAttributeTransform(e.POSITION);var l=performance.now();if(i===e.TRIANGULAR_MESH?(a=new e.Mesh,s=t.DecodeBufferToMesh(r,a)):(a=new e.PointCloud,s=t.DecodeBufferToPointCloud(r,a)),!s.ok()||0==a.ptr){var u="DRACOLoader: Decoding failed: ";throw u+=s.error_msg(),console.error(u),e.destroy(t),e.destroy(a),new Error(u)}var h,c=performance.now();e.destroy(r),i==e.TRIANGULAR_MESH?(h=a.num_faces(),this.verbosity>0&&console.log("Number of faces loaded: "+h.toString())):h=0;var d=a.num_points(),p=a.num_attributes();this.verbosity>0&&(console.log("Number of points loaded: "+d.toString()),console.log("Number of attributes loaded: "+p.toString()));var f=t.GetAttributeId(a,e.POSITION);if(-1==f){u="DRACOLoader: No position attribute found.";throw console.error(u),e.destroy(t),e.destroy(a),new Error(u)}var m=t.GetAttribute(a,f),v={},g=new BufferGeometry;if(n)for(var y in n){var _=o[y],b=n[y],x=t.GetAttributeByUniqueId(a,b);this.addAttributeToGeometry(e,t,a,y,_,x,g,v)}else for(var y in this.nativeAttributeMap){var w=t.GetAttributeId(a,e[this.nativeAttributeMap[y]]);if(-1!==w){this.verbosity>0&&console.log("Loaded "+y+" attribute.");x=t.GetAttribute(a,w);this.addAttributeToGeometry(e,t,a,y,Float32Array,x,g,v)}}if(i==e.TRIANGULAR_MESH)if(this.drawMode===TriangleStripDrawMode){var S=new e.DracoInt32Array;t.GetTriangleStripsFromMesh(a,S);v.indices=new Uint32Array(S.size());for(var M=0;M<S.size();++M)v.indices[M]=S.GetValue(M);e.destroy(S)}else{var T=3*h;v.indices=new Uint32Array(T);var A=new e.DracoInt32Array;for(M=0;M<h;++M){t.GetFaceFromMesh(a,M,A);var C=3*M;v.indices[C]=A.GetValue(0),v.indices[C+1]=A.GetValue(1),v.indices[C+2]=A.GetValue(2)}e.destroy(A)}g.drawMode=this.drawMode,i==e.TRIANGULAR_MESH&&g.setIndex(new(v.indices.length>65535?Uint32BufferAttribute:Uint16BufferAttribute)(v.indices,1));var L=new e.AttributeQuantizationTransform;if(L.InitFromAttribute(m)){g.attributes.position.isQuantized=!0,g.attributes.position.maxRange=L.range(),g.attributes.position.numQuantizationBits=L.quantization_bits(),g.attributes.position.minValues=new Float32Array(3);for(M=0;M<3;++M)g.attributes.position.minValues[M]=L.min_value(M)}return e.destroy(L),e.destroy(t),e.destroy(a),this.decode_time=c-l,this.import_time=performance.now()-c,this.verbosity>0&&(console.log("Decode time: "+this.decode_time),console.log("Import time: "+this.import_time)),g},isVersionSupported:function(e,t){DRACOLoader$1.getDecoderModule().then(function(i){t(i.decoder.isVersionSupported(e))})},getAttributeOptions:function(e){return void 0===this.attributeOptions[e]&&(this.attributeOptions[e]={}),this.attributeOptions[e]}},DRACOLoader$1.decoderPath="./",DRACOLoader$1.decoderConfig={},DRACOLoader$1.decoderModulePromise=null,DRACOLoader$1.setDecoderPath=function(e){DRACOLoader$1.decoderPath=e},DRACOLoader$1.setDecoderConfig=function(e){var t=DRACOLoader$1.decoderConfig.wasmBinary;DRACOLoader$1.decoderConfig=e||{},DRACOLoader$1.releaseDecoderModule(),t&&(DRACOLoader$1.decoderConfig.wasmBinary=t)},DRACOLoader$1.releaseDecoderModule=function(){DRACOLoader$1.decoderModulePromise=null},DRACOLoader$1.getDecoderModule=function(){var e=this,t=DRACOLoader$1.decoderPath,i=DRACOLoader$1.decoderConfig,r=DRACOLoader$1.decoderModulePromise;return r||("undefined"!=typeof DracoDecoderModule?r=Promise.resolve():"object"!=typeof WebAssembly||"js"===i.type?r=DRACOLoader$1._loadScript(t+"draco_decoder.js"):(i.wasmBinaryFile=t+"draco_decoder.wasm",r=DRACOLoader$1._loadScript(t+"draco_wasm_wrapper.js").then(function(){return DRACOLoader$1._loadArrayBuffer(i.wasmBinaryFile)}).then(function(e){i.wasmBinary=e})),r=r.then(function(){return new Promise(function(t){i.onModuleLoaded=function(i){e.timeLoaded=performance.now(),t({decoder:i})},DracoDecoderModule(i)})}),DRACOLoader$1.decoderModulePromise=r,r)},DRACOLoader$1._loadScript=function(e){var t=document.getElementById("decoder_script");null!==t&&t.parentNode.removeChild(t);var i=document.getElementsByTagName("head")[0],r=document.createElement("script");return r.id="decoder_script",r.type="text/javascript",r.src=e,new Promise(function(e){r.onload=e,i.appendChild(r)})},DRACOLoader$1._loadArrayBuffer=function(e){var t=new FileLoader;return t.setResponseType("arraybuffer"),new Promise(function(i,r){t.load(e,i,void 0,r)})},WebGLRenderTargetCube.prototype=Object.create(WebGLRenderTarget.prototype),WebGLRenderTargetCube.prototype.constructor=WebGLRenderTargetCube,WebGLRenderTargetCube.prototype.isWebGLRenderTargetCube=!0,CubeCamera.prototype=Object.create(Object3D.prototype),CubeCamera.prototype.constructor=CubeCamera;var CubemapGenerator=function(e){this.renderer=e};CubemapGenerator.prototype.fromEquirectangular=function(e,t){t=t||{};var i=new Scene,r={tEquirect:{value:null}},n="\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t//include <common>\n\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <project_vertex>\n\n\t\t\t}\n\t\t\t",o="\n\t\t\tuniform sampler2D tEquirect;\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t//include <common>\n\t\t\t#define RECIPROCAL_PI 0.31830988618\n\t\t\t#define RECIPROCAL_PI2 0.15915494\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\tvec2 sampleUV;\n\n\t\t\t\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\t\t\t\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\n\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t}\n\t\t\t",a=new ShaderMaterial({type:"CubemapFromEquirect",uniforms:UniformsUtils.clone(r),vertexShader:n,fragmentShader:o,side:BackSide,blending:NoBlending});a.uniforms.tEquirect.value=e;var s=new Mesh(new BoxBufferGeometry(5,5,5),a);i.add(s);var l=new CubeCamera(1,10,t.resolution||512,{type:e.type,format:e.format,encoding:e.encoding,generateMipmaps:void 0!==t.generateMipmaps?t.generateMipmaps:e.generateMipmaps,minFilter:void 0!==t.minFilter?t.minFilter:e.minFilter,magFilter:void 0!==t.magFilter?t.magFilter:e.magFilter});return l.update(this.renderer,i),s.geometry.dispose(),s.material.dispose(),l.renderTarget};var EquirectangularToCubeGenerator=function(){var e,t=new PerspectiveCamera(90,1,.1,10),i=new Scene,r=new Mesh(new BoxBufferGeometry(1,1,1),((e=new ShaderMaterial({uniforms:{equirectangularMap:{value:null}},vertexShader:"varying vec3 localPosition;\n        \n        void main() {\n          localPosition = position;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }",fragmentShader:"#include <common>\n        varying vec3 localPosition;\n        uniform sampler2D equirectangularMap;\n        \n        vec2 EquirectangularSampleUV(vec3 v) {\n          vec2 uv = vec2(atan(v.z, v.x), asin(v.y));\n          uv *= vec2(0.1591, 0.3183); // inverse atan\n          uv += 0.5;\n          return uv;\n        }\n        \n        void main() {\n          vec2 uv = EquirectangularSampleUV(normalize(localPosition));\n          gl_FragColor = texture2D(equirectangularMap, uv);\n        }",blending:NoBlending})).type="EquirectangularToCubeGenerator",e));r.material.side=BackSide,i.add(r);var n=function(e,t){t=t||{},this.sourceTexture=e,this.resolution=t.resolution||512,this.views=[{t:[1,0,0],u:[0,-1,0]},{t:[-1,0,0],u:[0,-1,0]},{t:[0,1,0],u:[0,0,1]},{t:[0,-1,0],u:[0,0,-1]},{t:[0,0,1],u:[0,-1,0]},{t:[0,0,-1],u:[0,-1,0]}];var i={format:t.format||this.sourceTexture.format,magFilter:this.sourceTexture.magFilter,minFilter:this.sourceTexture.minFilter,type:t.type||this.sourceTexture.type,generateMipmaps:this.sourceTexture.generateMipmaps,anisotropy:this.sourceTexture.anisotropy,encoding:this.sourceTexture.encoding};this.renderTarget=new WebGLRenderTargetCube(this.resolution,this.resolution,i)};return n.prototype={constructor:n,update:function(e){var n=e.getRenderTarget();r.material.uniforms.equirectangularMap.value=this.sourceTexture;for(var o=0;o<6;o++){var a=this.views[o];t.position.set(0,0,0),t.up.set(a.u[0],a.u[1],a.u[2]),t.lookAt(a.t[0],a.t[1],a.t[2]),e.setRenderTarget(this.renderTarget,o),e.clear(),e.render(i,t)}return e.setRenderTarget(n),this.renderTarget.texture},dispose:function(){this.renderTarget.dispose()}},n}();function DataTextureLoader(e){this.manager=void 0!==e?e:DefaultLoadingManager,this._parser=null}Object.assign(DataTextureLoader.prototype,{load:function(e,t,i,r){var n=this,o=new DataTexture,a=new FileLoader(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.load(e,function(e){var i=n._parser(e);i&&(void 0!==i.image?o.image=i.image:void 0!==i.data&&(o.image.width=i.width,o.image.height=i.height,o.image.data=i.data),o.wrapS=void 0!==i.wrapS?i.wrapS:ClampToEdgeWrapping,o.wrapT=void 0!==i.wrapT?i.wrapT:ClampToEdgeWrapping,o.magFilter=void 0!==i.magFilter?i.magFilter:LinearFilter,o.minFilter=void 0!==i.minFilter?i.minFilter:LinearMipMapLinearFilter,o.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(o.format=i.format),void 0!==i.type&&(o.type=i.type),void 0!==i.mipmaps&&(o.mipmaps=i.mipmaps),1===i.mipmapCount&&(o.minFilter=LinearFilter),o.needsUpdate=!0,t&&t(o,i))},i,r),o},setPath:function(e){return this.path=e,this}});var EXRLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager};EXRLoader.prototype=Object.create(DataTextureLoader.prototype),EXRLoader.prototype._parser=function(e){var t=65536,i=t>>3,r=14,n=65537,o=1<<r,a=o-1,s=59,l=63,u=2+l-s,h=8,c=4,d=4,p=2,f=1;var m={l:0,c:0,lc:0};function v(e,t,i,r,n){for(;i<e;)t=t<<8|O(r,n),i+=8;i-=e,m.l=t>>i&(1<<e)-1,m.c=t,m.lc=i}var g=new Array(59);function y(e,t,i,r,o,a,h){for(var c=i,d=0,p=0;o<=a;o++){if(c.value-i.value>r)return!1;v(6,d,p,e,c);var f=m.l;if(d=m.c,p=m.lc,h[o]=f,f==l){if(c.value-i.value>r)throw"Something wrong with hufUnpackEncTable";v(8,d,p,e,c);var y=m.l+u;if(d=m.c,p=m.lc,o+y>a+1)throw"Something wrong with hufUnpackEncTable";for(;y--;)h[o++]=0;o--}else if(f>=s){if(o+(y=f-s+2)>a+1)throw"Something wrong with hufUnpackEncTable";for(;y--;)h[o++]=0;o--}}!function(e){for(var t=0;t<=58;++t)g[t]=0;for(t=0;t<n;++t)g[e[t]]+=1;var i=0;for(t=58;t>0;--t){var r=i+g[t]>>1;g[t]=i,i=r}for(t=0;t<n;++t){var o=e[t];o>0&&(e[t]=o|g[o]++<<6)}}(h)}function _(e){return 63&e}function b(e){return e>>6}var x={c:0,lc:0};function w(e,t,i,r){e=e<<8|O(i,r),t+=8,x.c=e,x.lc=t}var S={c:0,lc:0};function M(e,t,i,r,n,o,a,s,l,u){if(e==t){r<8&&(w(i,r,n,a),i=x.c,r=x.lc);var h=i>>(r-=8);h=new Uint8Array([h])[0];if(l.value+h>u)return!1;for(var c=s[l.value-1];h-- >0;)s[l.value++]=c}else{if(!(l.value<u))return!1;s[l.value++]=e}S.c=i,S.lc=r}function T(e){var t=function(e){return 65535&e}(e);return t>32767?t-65536:t}var A={a:0,b:0};function C(e,t){var i=T(e),r=T(t),n=i+(1&r)+(r>>1),o=n,a=n-r;A.a=o,A.b=a}function L(e,t,i,r,n,o,a){for(var s,l=i>n?n:i,u=1;u<=l;)u<<=1;for(s=u>>=1,u>>=1;u>=1;){for(var h,c,d,p,f=0,m=f+o*(n-s),v=o*u,g=o*s,y=r*u,_=r*s;f<=m;f+=g){for(var b=f,x=f+r*(i-s);b<=x;b+=_){var w=b+y,S=(M=b+v)+y;C(t[b+e],t[M+e]),h=A.a,d=A.b,C(t[w+e],t[S+e]),c=A.a,p=A.b,C(h,c),t[b+e]=A.a,t[w+e]=A.b,C(d,p),t[M+e]=A.a,t[S+e]=A.b}if(i&u){var M=b+v;C(t[b+e],t[M+e]),h=A.a,t[M+e]=A.b,t[b+e]=h}}if(n&u)for(b=f,x=f+r*(i-s);b<=x;b+=_){w=b+y;C(t[b+e],t[w+e]),h=A.a,t[w+e]=A.b,t[b+e]=h}s=u,u>>=1}return f}function N(e,t,i,s,l,u,h){var c=i.value,d=D(t,i),p=D(t,i);i.value+=4;var f=D(t,i);if(i.value+=4,d<0||d>=n||p<0||p>=n)throw"Something wrong with HUF_ENCSIZE";var m=new Array(n),v=new Array(o);if(function(e){for(var t=0;t<o;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(v),y(e,0,i,s-(i.value-c),d,p,m),f>8*(s-(i.value-c)))throw"Something wrong with hufUncompress";!function(e,t,i,n){for(;t<=i;t++){var o=b(e[t]),a=_(e[t]);if(o>>a)throw"Invalid table entry";if(a>r){if((h=n[o>>a-r]).len)throw"Invalid table entry";if(h.lit++,h.p){var s=h.p;h.p=new Array(h.lit);for(var l=0;l<h.lit-1;++l)h.p[l]=s[l]}else h.p=new Array(1);h.p[h.lit-1]=t}else if(a){var u=0;for(l=1<<r-a;l>0;l--){var h;if((h=n[(o<<r-a)+u]).len||h.p)throw"Invalid table entry";h.len=a,h.lit=t,u++}}}}(m,d,p,v),function(e,t,i,n,o,s,l,u,h,c){for(var d=0,p=0,f=u,m=Math.trunc(o.value+(s+7)/8);o.value<m;)for(w(d,p,i,o),d=x.c,p=x.lc;p>=r;)if((T=t[d>>p-r&a]).len)p-=T.len,M(T.lit,l,d,p,i,0,o,h,c,f),d=S.c,p=S.lc;else{if(!T.p)throw"hufDecode issues";var v;for(v=0;v<T.lit;v++){for(var g=_(e[T.p[v]]);p<g&&o.value<m;)w(d,p,i,o),d=x.c,p=x.lc;if(p>=g&&b(e[T.p[v]])==(d>>p-g&(1<<g)-1)){p-=g,M(T.p[v],l,d,p,i,0,o,h,c,f),d=S.c,p=S.lc;break}}if(v==T.lit)throw"hufDecode issues"}var y=8-s&7;for(d>>=y,p-=y;p>0;){var T;if(!(T=t[d<<r-p&a]).len)throw"hufDecode issues";p-=T.len,M(T.lit,l,d,p,i,0,o,h,c,f),d=S.c,p=S.lc}}(m,v,e,0,i,f,p,h,l,u)}function P(e,r,n,o,a,s,l,u,h,c){var d=new Uint8Array(i),p=B(o,a),f=B(o,a);if(f>=i)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(p<=f)for(var m=0;m<f-p+1;m++)d[m+p]=R(o,a);var v=new Uint16Array(t);!function(e,i){for(var r=0,n=0;n<t;++n)(0==n||e[n>>3]&1<<(7&n))&&(i[r++]=n);for(var o=r-1;r<t;)i[r++]=0}(d,v);N(n,o,a,D(o,a),e,r,s);var g=new Array(l),y=0;for(m=0;m<l;m++){u[m];g[m]={},g[m].start=y,g[m].end=g[m].start,g[m].nx=h,g[m].ny=c,g[m].size=1,y+=g[m].nx*g[m].ny*g[m].size}var _=0;for(m=0;m<l;m++)for(var b=0;b<g[m].size;++b)_+=L(b+_,e,g[m].nx,g[m].size,g[m].ny,g[m].nx*g[m].size);return function(e,t,i){for(var r=0;r<i;++r)t[r]=e[t[r]]}(v,e,y),!0}function k(e,t){for(var i=new Uint8Array(e),r=0;0!=i[t.value+r];)r+=1;var n=(new TextDecoder).decode(i.slice(t.value,t.value+r));return t.value=t.value+r+1,n}function E(e,t){var i=e.getUint32(0,!0);return t.value=t.value+h,i}function D(e,t){var i=e.getUint32(t.value,!0);return t.value=t.value+d,i}function O(e,t){var i=e[t.value];return t.value=t.value+f,i}function R(e,t){var i=e.getUint8(t.value);return t.value=t.value+f,i}function F(e,t){var i=e.getFloat32(t.value,!0);return t.value+=c,i}function I(e){var t=(31744&e)>>10,i=1023&e;return(e>>15?-1:1)*(t?31===t?i?NaN:1/0:Math.pow(2,t-15)*(1+i/1024):i/1024*6103515625e-14)}function B(e,t){var i=e.getUint16(t.value,!0);return t.value+=p,i}function U(e,t){return I(B(e,t))}function V(e,t,i,r,n){if("string"===r||"iccProfile"===r)return function(e,t,i){var r=(new TextDecoder).decode(new Uint8Array(e).slice(t.value,t.value+i));return t.value=t.value+i,r}(t,i,n);if("chlist"===r)return function(e,t,i,r){for(var n=i.value,o=[];i.value<n+r-1;){var a=k(t,i),s=D(e,i),l=R(e,i);i.value+=3;var u=D(e,i),h=D(e,i);o.push({name:a,pixelType:s,pLinear:l,xSampling:u,ySampling:h})}return i.value+=1,o}(e,t,i,n);if("chromaticities"===r)return function(e,t){return{redX:F(e,t),redY:F(e,t),greenX:F(e,t),greenY:F(e,t),blueX:F(e,t),blueY:F(e,t),whiteX:F(e,t),whiteY:F(e,t)}}(e,i);if("compression"===r)return function(e,t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][R(e,t)]}(e,i);if("box2i"===r)return function(e,t){return{xMin:D(e,t),yMin:D(e,t),xMax:D(e,t),yMax:D(e,t)}}(e,i);if("lineOrder"===r)return function(e,t){return["INCREASING_Y"][R(e,t)]}(e,i);if("float"===r)return F(e,i);if("v2f"===r)return function(e,t){return[F(e,t),F(e,t)]}(e,i);if("int"===r)return D(e,i);throw"Cannot parse value for unsupported type: "+r}for(var z=new DataView(e),G=new Uint8Array(e),j={},W=(z.getUint32(0,!0),z.getUint8(4,!0),z.getUint8(5,!0),{value:8}),H=!0;H;){var q=k(e,W);if(0==q)H=!1;else{var Y=V(z,e,W,k(e,W),D(z,W));j[q]=Y}}var X=j.dataWindow.yMax+1,K=1;"PIZ_COMPRESSION"===j.compression&&(K=32);for(var Q=X/K,Z=0;Z<Q;Z++)E(z,W);var J=j.dataWindow.xMax-j.dataWindow.xMin+1,$=j.dataWindow.yMax-j.dataWindow.yMin+1,ee=j.channels.length,te=new Float32Array(J*$*ee),ie={R:0,G:1,B:2,A:3};if("NO_COMPRESSION"===j.compression)for(var re=0;re<$;re++)for(var ne=D(z,W),oe=(D(z,W),0);oe<j.channels.length;oe++){var ae=ie[j.channels[oe].name];if(1!==j.channels[oe].pixelType)throw"EXRLoader._parser: unsupported pixelType "+j.channels[oe].pixelType+". Only pixelType is 1 (HALF) is supported.";for(var se=0;se<J;se++){var le=U(z,W);te[J*ee*($-ne)+se*ee+ae]=le}}else{if("PIZ_COMPRESSION"!==j.compression)throw"EXRLoader._parser: "+j.compression+" is unsupported";for(var ue=0;ue<$/K;ue++){D(z,W),D(z,W);var he=J*K*(2*j.channels.length),ce=new Uint16Array(he);P(ce,{value:0},G,z,W,he,ee,j.channels,J,K);for(var de=0;de<K;de++)for(oe=0;oe<j.channels.length;oe++){ae=ie[j.channels[oe].name];if(1!==j.channels[oe].pixelType)throw"EXRLoader._parser: unsupported pixelType "+j.channels[oe].pixelType+". Only pixelType is 1 (HALF) is supported.";for(se=0;se<J;se++){le=I(ce[oe*(K*J)+de*J+se]);te[J*ee*($-(de+ue*K))+se*ee+ae]=le}}}}return{header:j,width:J,height:$,data:te,format:4==j.channels.length?RGBAFormat:RGBFormat,type:FloatType}};var FBXLoader=function(){var e,t,i;function r(e){this.manager=void 0!==e?e:DefaultLoadingManager}function n(e){this.textureLoader=e}function o(){}function a(){}function s(){}function l(){}function u(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function h(){}function c(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("FBXLoader: Cannot find the version number for the file given.")}function d(e){return e/46186158e3}r.prototype={constructor:r,crossOrigin:"anonymous",load:function(e,t,i,r){var n=this,o=void 0===n.path?LoaderUtils.extractUrlBase(e):n.path,a=new FileLoader(this.manager);a.setPath(n.path),a.setResponseType("arraybuffer"),a.load(e,function(i){try{t(n.parse(i,o))}catch(t){setTimeout(function(){r&&r(t),n.manager.itemError(e)},0)}},i,r)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(t,i){if(a="Kaydara FBX Binary  \0",(o=t).byteLength>=a.length&&a===b(o,0,a.length))e=(new l).parse(t);else{var r=b(t);if(!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],i=0;function r(t){var r=e[t-1];return e=e.slice(i+t),i++,r}for(var n=0;n<t.length;++n){var o=r(1);if(o===t[n])return!1}return!0}(r))throw new Error("FBXLoader: Unknown format.");if(c(r)<7e3)throw new Error("FBXLoader: FBX version not supported, FileVersion: "+c(r));e=(new s).parse(r)}var o,a;return new n(new TextureLoader(this.manager).setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin)).parse(e)}},n.prototype={constructor:n,parse:function(){t=this.parseConnections();var e=this.parseImages(),r=this.parseTextures(e),n=this.parseMaterials(r),a=this.parseDeformers(),s=(new o).parse(a);return this.parseScene(a,s,n),i},parseConnections:function(){var t=new Map;"Connections"in e&&e.Connections.connections.forEach(function(e){var i=e[0],r=e[1],n=e[2];t.has(i)||t.set(i,{parents:[],children:[]});var o={ID:r,relationship:n};t.get(i).parents.push(o),t.has(r)||t.set(r,{parents:[],children:[]});var a={ID:i,relationship:n};t.get(r).children.push(a)});return t},parseImages:function(){var t={},i={};if("Video"in e.Objects){var r=e.Objects.Video;for(var n in r){var o=r[n];if(t[u=parseInt(n)]=o.RelativeFilename||o.Filename,"Content"in o){var a=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,s="string"==typeof o.Content&&""!==o.Content;if(a||s){var l=this.parseImage(r[n]);i[o.RelativeFilename||o.Filename]=l}}}}for(var u in t){var h=t[u];void 0!==i[h]?t[u]=i[h]:t[u]=t[u].split("\\").pop()}return t},parseImage:function(e){var t,i=e.Content,r=e.RelativeFilename||e.Filename,n=r.slice(r.lastIndexOf(".")+1).toLowerCase();switch(n){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":if("function"!=typeof TGALoader)return void console.warn("FBXLoader: TGALoader is required to load TGA textures");if(null===Loader.Handlers.get(".tga")){var o=new TGALoader;o.setPath(this.textureLoader.path),Loader.Handlers.add(/\.tga$/i,o)}t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+n+'" is not supported.')}if("string"==typeof i)return"data:"+t+";base64,"+i;var a=new Uint8Array(i);return window.URL.createObjectURL(new Blob([a],{type:t}))},parseTextures:function(t){var i=new Map;if("Texture"in e.Objects){var r=e.Objects.Texture;for(var n in r){var o=this.parseTexture(r[n],t);i.set(parseInt(n),o)}}return i},parseTexture:function(e,t){var i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;var r=e.WrapModeU,n=e.WrapModeV,o=void 0!==r?r.value:0,a=void 0!==n?n.value:0;if(i.wrapS=0===o?RepeatWrapping:ClampToEdgeWrapping,i.wrapT=0===a?RepeatWrapping:ClampToEdgeWrapping,"Scaling"in e){var s=e.Scaling.value;i.repeat.x=s[0],i.repeat.y=s[1]}return i},loadTexture:function(e,i){var r,n,o=this.textureLoader.path,a=t.get(e.id).children;void 0!==a&&a.length>0&&void 0!==i[a[0].ID]&&(0!==(r=i[a[0].ID]).indexOf("blob:")&&0!==r.indexOf("data:")||this.textureLoader.setPath(void 0));var s=e.FileName.slice(-3).toLowerCase();if("tga"===s){var l=Loader.Handlers.get(".tga");null===l?(console.warn("FBXLoader: TGALoader not found, creating empty placeholder texture for",r),n=new Texture):n=l.load(r)}else"psd"===s?(console.warn("FBXLoader: PSD textures are not supported, creating empty placeholder texture for",r),n=new Texture):n=this.textureLoader.load(r);return this.textureLoader.setPath(o),n},parseMaterials:function(t){var i=new Map;if("Material"in e.Objects){var r=e.Objects.Material;for(var n in r){var o=this.parseMaterial(r[n],t);null!==o&&i.set(parseInt(n),o)}}return i},parseMaterial:function(e,i){var r=e.id,n=e.attrName,o=e.ShadingModel;if("object"==typeof o&&(o=o.value),!t.has(r))return null;var a,s=this.parseParameters(e,i,r);switch(o.toLowerCase()){case"phong":a=new MeshPhongMaterial;break;case"lambert":a=new MeshLambertMaterial;break;default:console.warn('FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),a=new MeshPhongMaterial}return a.setValues(s),a.name=n,a},parseParameters:function(e,i,r){var n={};e.BumpFactor&&(n.bumpScale=e.BumpFactor.value),e.Diffuse?n.color=(new Color).fromArray(e.Diffuse.value):e.DiffuseColor&&"Color"===e.DiffuseColor.type&&(n.color=(new Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(n.displacementScale=e.DisplacementFactor.value),e.Emissive?n.emissive=(new Color).fromArray(e.Emissive.value):e.EmissiveColor&&"Color"===e.EmissiveColor.type&&(n.emissive=(new Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(n.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(n.opacity=parseFloat(e.Opacity.value)),n.opacity<1&&(n.transparent=!0),e.ReflectionFactor&&(n.reflectivity=e.ReflectionFactor.value),e.Shininess&&(n.shininess=e.Shininess.value),e.Specular?n.specular=(new Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(n.specular=(new Color).fromArray(e.SpecularColor.value));var o=this;return t.get(r).children.forEach(function(e){var t=e.relationship;switch(t){case"Bump":n.bumpMap=o.getTexture(i,e.ID);break;case"Maya|TEX_ao_map":n.aoMap=o.getTexture(i,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":n.map=o.getTexture(i,e.ID);break;case"DisplacementColor":n.displacementMap=o.getTexture(i,e.ID);break;case"EmissiveColor":n.emissiveMap=o.getTexture(i,e.ID);break;case"NormalMap":case"Maya|TEX_normal_map":n.normalMap=o.getTexture(i,e.ID);break;case"ReflectionColor":n.envMap=o.getTexture(i,e.ID),n.envMap.mapping=EquirectangularReflectionMapping;break;case"SpecularColor":n.specularMap=o.getTexture(i,e.ID);break;case"TransparentColor":n.alphaMap=o.getTexture(i,e.ID),n.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("FBXLoader: %s map is not supported in three.js, skipping texture.",t)}}),n},getTexture:function(i,r){return"LayeredTexture"in e.Objects&&r in e.Objects.LayeredTexture&&(console.warn("FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),r=t.get(r).children[0].ID),i.get(r)},parseDeformers:function(){var i={},r={};if("Deformer"in e.Objects){var n=e.Objects.Deformer;for(var o in n){var a=n[o],s=t.get(parseInt(o));if("Skin"===a.attrType){var l=this.parseSkeleton(s,n);l.ID=o,s.parents.length>1&&console.warn("FBXLoader: skeleton attached to more than one geometry is not supported."),l.geometryID=s.parents[0].ID,i[o]=l}else if("BlendShape"===a.attrType){var u={id:o};u.rawTargets=this.parseMorphTargets(s,n),u.id=o,s.parents.length>1&&console.warn("FBXLoader: morph target attached to more than one geometry is not supported."),r[o]=u}}}return{skeletons:i,morphTargets:r}},parseSkeleton:function(e,t){var i=[];return e.children.forEach(function(e){var r=t[e.ID];if("Cluster"===r.attrType){var n={ID:e.ID,indices:[],weights:[],transformLink:(new Matrix4).fromArray(r.TransformLink.a)};"Indexes"in r&&(n.indices=r.Indexes.a,n.weights=r.Weights.a),i.push(n)}}),{rawBones:i,bones:[]}},parseMorphTargets:function(e,i){for(var r=[],n=0;n<e.children.length;n++){var o=e.children[n],a=i[o.ID],s={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if("BlendShapeChannel"!==a.attrType)return;s.geoID=t.get(parseInt(o.ID)).children.filter(function(e){return void 0===e.relationship})[0].ID,r.push(s)}return r},parseScene:function(r,n,o){i=new Group;var s=this.parseModels(r.skeletons,n,o),l=e.Objects.Model,u=this;s.forEach(function(e){var r=l[e.ID];u.setLookAtProperties(e,r),t.get(e.ID).parents.forEach(function(t){var i=s.get(t.ID);void 0!==i&&i.add(e)}),null===e.parent&&i.add(e)}),this.bindSkeleton(r.skeletons,n,s),this.createAmbientLight(),this.setupMorphMaterials(),i.traverse(function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrixWorld=e.parent.matrix);var t=g(e.userData.transformData);e.applyMatrix(t)}});var h=(new a).parse();1===i.children.length&&i.children[0].isGroup&&(i.children[0].animations=h,i=i.children[0]),i.animations=h},parseModels:function(i,r,n){var o=new Map,a=e.Objects.Model;for(var s in a){var l=parseInt(s),u=a[s],h=t.get(l),c=this.buildSkeleton(h,i,l,u.attrName);if(!c){switch(u.attrType){case"Camera":c=this.createCamera(h);break;case"Light":c=this.createLight(h);break;case"Mesh":c=this.createMesh(h,r,n);break;case"NurbsCurve":c=this.createCurve(h,r);break;case"LimbNode":case"Root":c=new Bone;break;case"Null":default:c=new Group}c.name=PropertyBinding.sanitizeNodeName(u.attrName),c.ID=l}this.getTransformData(c,u),o.set(l,c)}return o},buildSkeleton:function(e,t,i,r){var n=null;return e.parents.forEach(function(e){for(var o in t){var a=t[o];a.rawBones.forEach(function(t,o){if(t.ID===e.ID){var s=n;(n=new Bone).matrixWorld.copy(t.transformLink),n.name=PropertyBinding.sanitizeNodeName(r),n.ID=i,a.bones[o]=n,null!==s&&n.add(s)}})}}),n},createCamera:function(t){var i,r;if(t.children.forEach(function(t){var i=e.Objects.NodeAttribute[t.ID];void 0!==i&&(r=i)}),void 0===r)i=new Object3D;else{var n=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(n=1);var o=1;void 0!==r.NearPlane&&(o=r.NearPlane.value/1e3);var a=1e3;void 0!==r.FarPlane&&(a=r.FarPlane.value/1e3);var s=window.innerWidth,l=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(s=r.AspectWidth.value,l=r.AspectHeight.value);var u=s/l,h=45;void 0!==r.FieldOfView&&(h=r.FieldOfView.value);var c=r.FocalLength?r.FocalLength.value:null;switch(n){case 0:i=new PerspectiveCamera(h,u,o,a),null!==c&&i.setFocalLength(c);break;case 1:i=new OrthographicCamera(-s/2,s/2,l/2,-l/2,o,a);break;default:console.warn("FBXLoader: Unknown camera type "+n+"."),i=new Object3D}}return i},createLight:function(t){var i,r;if(t.children.forEach(function(t){var i=e.Objects.NodeAttribute[t.ID];void 0!==i&&(r=i)}),void 0===r)i=new Object3D;else{var n;n=void 0===r.LightType?0:r.LightType.value;var o=16777215;void 0!==r.Color&&(o=(new Color).fromArray(r.Color.value));var a=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(a=0);var s=0;void 0!==r.FarAttenuationEnd&&(s=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value);switch(n){case 0:i=new PointLight(o,a,s,1);break;case 1:i=new DirectionalLight(o,a);break;case 2:var l=Math.PI/3;void 0!==r.InnerAngle&&(l=_Math.degToRad(r.InnerAngle.value));var u=0;void 0!==r.OuterAngle&&(u=_Math.degToRad(r.OuterAngle.value),u=Math.max(u,1)),i=new SpotLight(o,a,s,l,u,1);break;default:console.warn("FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),i=new PointLight(o,a)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(i.castShadow=!0)}return i},createMesh:function(e,t,i){var r,n=null,o=null,a=[];return e.children.forEach(function(e){t.has(e.ID)&&(n=t.get(e.ID)),i.has(e.ID)&&a.push(i.get(e.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new MeshPhongMaterial({color:13421772}),a.push(o)),"color"in n.attributes&&a.forEach(function(e){e.vertexColors=VertexColors}),n.FBX_Deformer?(a.forEach(function(e){e.skinning=!0}),(r=new SkinnedMesh(n,o)).normalizeSkinWeights()):r=new Mesh(n,o),r},createCurve:function(e,t){return new Line(e.children.reduce(function(e,i){return t.has(i.ID)&&(e=t.get(i.ID)),e},null),new LineBasicMaterial({color:3342591,linewidth:1}))},getTransformData:function(e,t){var i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),i.eulerOrder="RotationOrder"in t?y(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i},setLookAtProperties:function(r,n){"LookAtProperty"in n&&t.get(r.ID).children.forEach(function(t){if("LookAtProperty"===t.relationship){var n=e.Objects.Model[t.ID];if("Lcl_Translation"in n){var o=n.Lcl_Translation.value;void 0!==r.target?(r.target.position.fromArray(o),i.add(r.target)):r.lookAt((new Vector3).fromArray(o))}}})},bindSkeleton:function(e,i,r){var n=this.parsePoseNodes();for(var o in e){var a=e[o];t.get(parseInt(a.ID)).parents.forEach(function(e){if(i.has(e.ID)){var o=e.ID;t.get(o).parents.forEach(function(e){r.has(e.ID)&&r.get(e.ID).bind(new Skeleton(a.bones),n[e.ID])})}})}},parsePoseNodes:function(){var t={};if("Pose"in e.Objects){var i=e.Objects.Pose;for(var r in i)if("BindPose"===i[r].attrType){var n=i[r].PoseNode;Array.isArray(n)?n.forEach(function(e){t[e.Node]=(new Matrix4).fromArray(e.Matrix.a)}):t[n.Node]=(new Matrix4).fromArray(n.Matrix.a)}}return t},createAmbientLight:function(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var t=e.GlobalSettings.AmbientColor.value,r=t[0],n=t[1],o=t[2];if(0!==r||0!==n||0!==o){var a=new Color(r,n,o);i.add(new AmbientLight(a,1))}}},setupMorphMaterials:function(){var e=this;i.traverse(function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach(function(i,r){e.setupMorphMaterial(t,i,r)}):e.setupMorphMaterial(t,t.material))})},setupMorphMaterial:function(e,t,r){var n=e.uuid,o=t.uuid,a=!1;if(i.traverse(function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach(function(t){t.uuid===o&&e.uuid!==n&&(a=!0)}):e.material.uuid===o&&e.uuid!==n&&(a=!0))}),!0===a){var s=t.clone();s.morphTargets=!0,void 0===r?e.material=s:e.material[r]=s}else t.morphTargets=!0}},o.prototype={constructor:o,parse:function(i){var r=new Map;if("Geometry"in e.Objects){var n=e.Objects.Geometry;for(var o in n){var a=t.get(parseInt(o)),s=this.parseGeometry(a,n[o],i);r.set(parseInt(o),s)}}return r},parseGeometry:function(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(t,i,r){var n=r.skeletons,o=r.morphTargets,a=t.parents.map(function(t){return e.Objects.Model[t.ID]});if(0!==a.length){var s=t.children.reduce(function(e,t){return void 0!==n[t.ID]&&(e=n[t.ID]),e},null),l=t.children.reduce(function(e,t){return void 0!==o[t.ID]&&(e=o[t.ID]),e},null),u=a[0],h={};"RotationOrder"in u&&(h.eulerOrder=y(u.RotationOrder.value)),"InheritType"in u&&(h.inheritType=parseInt(u.InheritType.value)),"GeometricTranslation"in u&&(h.translation=u.GeometricTranslation.value),"GeometricRotation"in u&&(h.rotation=u.GeometricRotation.value),"GeometricScaling"in u&&(h.scale=u.GeometricScaling.value);var c=g(h);return this.genGeometry(i,s,l,c)}},genGeometry:function(e,t,i,r){var n=new BufferGeometry;e.attrName&&(n.name=e.attrName);var o=this.parseGeoNode(e,t),a=this.genBuffers(o),s=new Float32BufferAttribute(a.vertex,3);if(r.applyToBufferAttribute(s),n.addAttribute("position",s),a.colors.length>0&&n.addAttribute("color",new Float32BufferAttribute(a.colors,3)),t&&(n.addAttribute("skinIndex",new Uint16BufferAttribute(a.weightsIndices,4)),n.addAttribute("skinWeight",new Float32BufferAttribute(a.vertexWeights,4)),n.FBX_Deformer=t),a.normal.length>0){var l=new Float32BufferAttribute(a.normal,3);(new Matrix3).getNormalMatrix(r).applyToBufferAttribute(l),n.addAttribute("normal",l)}if(a.uvs.forEach(function(e,t){var i="uv"+(t+1).toString();0===t&&(i="uv"),n.addAttribute(i,new Float32BufferAttribute(a.uvs[t],2))}),o.material&&"AllSame"!==o.material.mappingType){var u=a.materialIndex[0],h=0;if(a.materialIndex.forEach(function(e,t){e!==u&&(n.addGroup(h,t-h,u),u=e,h=t)}),n.groups.length>0){var c=n.groups[n.groups.length-1],d=c.start+c.count;d!==a.materialIndex.length&&n.addGroup(d,a.materialIndex.length-d,u)}0===n.groups.length&&n.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(n,e,i,r),n},parseGeoNode:function(e,t){var i={};if(i.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],i.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];for(var r=0;e.LayerElementUV[r];)i.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return i.weightTable={},null!==t&&(i.skeleton=t,t.rawBones.forEach(function(e,t){e.indices.forEach(function(r,n){void 0===i.weightTable[r]&&(i.weightTable[r]=[]),i.weightTable[r].push({id:t,weight:e.weights[n]})})})),i},genBuffers:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},i=0,r=0,n=!1,o=[],a=[],s=[],l=[],u=[],h=[],c=this;return e.vertexIndices.forEach(function(d,p){var m=!1;d<0&&(d^=-1,m=!0);var v=[],g=[];if(o.push(3*d,3*d+1,3*d+2),e.color){var y=f(p,i,d,e.color);s.push(y[0],y[1],y[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach(function(e){g.push(e.weight),v.push(e.id)}),g.length>4){n||(console.warn("FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),n=!0);var _=[0,0,0,0],b=[0,0,0,0];g.forEach(function(e,t){var i=e,r=v[t];b.forEach(function(e,t,n){if(i>e){n[t]=i,i=e;var o=_[t];_[t]=r,r=o}})}),v=_,g=b}for(;g.length<4;)g.push(0),v.push(0);for(var x=0;x<4;++x)u.push(g[x]),h.push(v[x])}if(e.normal){y=f(p,i,d,e.normal);a.push(y[0],y[1],y[2])}if(e.material&&"AllSame"!==e.material.mappingType)var w=f(p,i,d,e.material)[0];e.uv&&e.uv.forEach(function(e,t){var r=f(p,i,d,e);void 0===l[t]&&(l[t]=[]),l[t].push(r[0]),l[t].push(r[1])}),r++,m&&(c.genFace(t,e,o,w,a,s,l,u,h,r),i++,r=0,o=[],a=[],s=[],l=[],u=[],h=[])}),t},genFace:function(e,t,i,r,n,o,a,s,l,u){for(var h=2;h<u;h++)e.vertex.push(t.vertexPositions[i[0]]),e.vertex.push(t.vertexPositions[i[1]]),e.vertex.push(t.vertexPositions[i[2]]),e.vertex.push(t.vertexPositions[i[3*(h-1)]]),e.vertex.push(t.vertexPositions[i[3*(h-1)+1]]),e.vertex.push(t.vertexPositions[i[3*(h-1)+2]]),e.vertex.push(t.vertexPositions[i[3*h]]),e.vertex.push(t.vertexPositions[i[3*h+1]]),e.vertex.push(t.vertexPositions[i[3*h+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(h-1)]),e.vertexWeights.push(s[4*(h-1)+1]),e.vertexWeights.push(s[4*(h-1)+2]),e.vertexWeights.push(s[4*(h-1)+3]),e.vertexWeights.push(s[4*h]),e.vertexWeights.push(s[4*h+1]),e.vertexWeights.push(s[4*h+2]),e.vertexWeights.push(s[4*h+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(h-1)]),e.weightsIndices.push(l[4*(h-1)+1]),e.weightsIndices.push(l[4*(h-1)+2]),e.weightsIndices.push(l[4*(h-1)+3]),e.weightsIndices.push(l[4*h]),e.weightsIndices.push(l[4*h+1]),e.weightsIndices.push(l[4*h+2]),e.weightsIndices.push(l[4*h+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[3*(h-1)]),e.colors.push(o[3*(h-1)+1]),e.colors.push(o[3*(h-1)+2]),e.colors.push(o[3*h]),e.colors.push(o[3*h+1]),e.colors.push(o[3*h+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(n[0]),e.normal.push(n[1]),e.normal.push(n[2]),e.normal.push(n[3*(h-1)]),e.normal.push(n[3*(h-1)+1]),e.normal.push(n[3*(h-1)+2]),e.normal.push(n[3*h]),e.normal.push(n[3*h+1]),e.normal.push(n[3*h+2])),t.uv&&t.uv.forEach(function(t,i){void 0===e.uvs[i]&&(e.uvs[i]=[]),e.uvs[i].push(a[i][0]),e.uvs[i].push(a[i][1]),e.uvs[i].push(a[i][2*(h-1)]),e.uvs[i].push(a[i][2*(h-1)+1]),e.uvs[i].push(a[i][2*h]),e.uvs[i].push(a[i][2*h+1])})},addMorphTargets:function(t,i,r,n){if(null!==r){t.morphAttributes.position=[];var o=this;r.rawTargets.forEach(function(r){var a=e.Objects.Geometry[r.geoID];void 0!==a&&o.genMorphGeometry(t,i,a,n,r.name)})}},genMorphGeometry:function(e,t,i,r,n){var o=new BufferGeometry;i.attrName&&(o.name=i.attrName);for(var a=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==t.Vertices?t.Vertices.a.slice():[],l=void 0!==i.Vertices?i.Vertices.a:[],u=void 0!==i.Indexes?i.Indexes.a:[],h=0;h<u.length;h++){var c=3*u[h];s[c]+=l[3*h],s[c+1]+=l[3*h+1],s[c+2]+=l[3*h+2]}var d={vertexIndices:a,vertexPositions:s},p=new Float32BufferAttribute(this.genBuffers(d).vertex,3);p.name=n||i.attrName,r.applyToBufferAttribute(p),e.morphAttributes.position.push(p)},parseNormals:function(e){var t=e.MappingInformationType,i=e.ReferenceInformationType,r=e.Normals.a,n=[];return"IndexToDirect"===i&&("NormalIndex"in e?n=e.NormalIndex.a:"NormalsIndex"in e&&(n=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:n,mappingType:t,referenceType:i}},parseUVs:function(e){var t=e.MappingInformationType,i=e.ReferenceInformationType,r=e.UV.a,n=[];return"IndexToDirect"===i&&(n=e.UVIndex.a),{dataSize:2,buffer:r,indices:n,mappingType:t,referenceType:i}},parseVertexColors:function(e){var t=e.MappingInformationType,i=e.ReferenceInformationType,r=e.Colors.a,n=[];return"IndexToDirect"===i&&(n=e.ColorIndex.a),{dataSize:4,buffer:r,indices:n,mappingType:t,referenceType:i}},parseMaterialIndices:function(e){var t=e.MappingInformationType,i=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};for(var r=e.Materials.a,n=[],o=0;o<r.length;++o)n.push(o);return{dataSize:1,buffer:r,indices:n,mappingType:t,referenceType:i}},parseNurbsGeometry:function(e){if(void 0===NURBSCurve)return console.error("FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new BufferGeometry;var t=parseInt(e.Order);if(isNaN(t))return console.error("FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new BufferGeometry;for(var i,r,n=t-1,o=e.KnotVector.a,a=[],s=e.Points.a,l=0,u=s.length;l<u;l+=4)a.push((new Vector4).fromArray(s,l));if("Closed"===e.Form)a.push(a[0]);else if("Periodic"===e.Form){i=n,r=o.length-1-i;for(l=0;l<n;++l)a.push(a[l])}var h=new NURBSCurve(n,o,a,i,r).getPoints(7*a.length),c=new Float32Array(3*h.length);h.forEach(function(e,t){e.toArray(c,3*t)});var d=new BufferGeometry;return d.addAttribute("position",new BufferAttribute(c,3)),d}},a.prototype={constructor:a,parse:function(){var e=[],t=this.parseClips();if(void 0!==t)for(var i in t){var r=t[i],n=this.addClip(r);e.push(n)}return e},parseClips:function(){if(void 0!==e.Objects.AnimationCurve){var t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);var i=this.parseAnimationLayers(t);return this.parseAnimStacks(i)}},parseAnimationCurveNodes:function(){var t=e.Objects.AnimationCurveNode,i=new Map;for(var r in t){var n=t[r];if(null!==n.attrName.match(/S|R|T|DeformPercent/)){var o={id:n.id,attr:n.attrName,curves:{}};i.set(o.id,o)}}return i},parseAnimationCurves:function(i){var r=e.Objects.AnimationCurve;for(var n in r){var o={id:r[n].id,times:r[n].KeyTime.a.map(d),values:r[n].KeyValueFloat.a},a=t.get(o.id);if(void 0!==a){var s=a.parents[0].ID,l=a.parents[0].relationship;l.match(/X/)?i.get(s).curves.x=o:l.match(/Y/)?i.get(s).curves.y=o:l.match(/Z/)?i.get(s).curves.z=o:l.match(/d|DeformPercent/)&&i.has(s)&&(i.get(s).curves.morph=o)}}},parseAnimationLayers:function(r){var n=e.Objects.AnimationLayer,o=new Map;for(var a in n){var s=[],l=t.get(parseInt(a));if(void 0!==l)l.children.forEach(function(n,o){if(r.has(n.ID)){var a=r.get(n.ID);if(void 0!==a.curves.x||void 0!==a.curves.y||void 0!==a.curves.z){if(void 0===s[o])if(void 0!==(p=t.get(n.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID)){var l=e.Objects.Model[p.toString()],u={modelName:PropertyBinding.sanitizeNodeName(l.attrName),ID:l.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};i.traverse(function(e){e.ID===l.id&&(u.transform=e.matrix,e.userData.transformData&&(u.eulerOrder=e.userData.transformData.eulerOrder))}),u.transform||(u.transform=new Matrix4),"PreRotation"in l&&(u.preRotation=l.PreRotation.value),"PostRotation"in l&&(u.postRotation=l.PostRotation.value),s[o]=u}s[o]&&(s[o][a.attr]=a)}else if(void 0!==a.curves.morph){if(void 0===s[o]){var h=t.get(n.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID,c=t.get(h).parents[0].ID,d=t.get(c).parents[0].ID,p=t.get(d).parents[0].ID;l=e.Objects.Model[p],u={modelName:PropertyBinding.sanitizeNodeName(l.attrName),morphName:e.Objects.Deformer[h].attrName};s[o]=u}s[o][a.attr]=a}}}),o.set(parseInt(a),s)}return o},parseAnimStacks:function(i){var r=e.Objects.AnimationStack,n={};for(var o in r){var a=t.get(parseInt(o)).children;a.length>1&&console.warn("FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=i.get(a[0].ID);n[o]={name:r[o].attrName,layer:s}}return n},addClip:function(e){var t=[],i=this;return e.layer.forEach(function(e){t=t.concat(i.generateTracks(e))}),new AnimationClip(e.name,-1,t)},generateTracks:function(e){var t=[],i=new Vector3,r=new Quaternion,n=new Vector3;if(e.transform&&e.transform.decompose(i,r,n),i=i.toArray(),r=(new Euler).setFromQuaternion(r,e.eulerOrder).toArray(),n=n.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var o=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");void 0!==o&&t.push(o)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var a=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);void 0!==a&&t.push(a)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var s=this.generateVectorTrack(e.modelName,e.S.curves,n,"scale");void 0!==s&&t.push(s)}if(void 0!==e.DeformPercent){var l=this.generateMorphTrack(e);void 0!==l&&t.push(l)}return t},generateVectorTrack:function(e,t,i,r){var n=this.getTimesForAllAxes(t);return new VectorKeyframeTrack(e+"."+r,n,this.getKeyframeTrackValues(n,t,i))},generateRotationTrack:function(e,t,i,r,n,o){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(_Math.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(_Math.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(_Math.degToRad));var a=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(a,t,i);void 0!==r&&((r=r.map(_Math.degToRad)).push(o),r=(new Euler).fromArray(r),r=(new Quaternion).setFromEuler(r)),void 0!==n&&((n=n.map(_Math.degToRad)).push(o),n=(new Euler).fromArray(n),n=(new Quaternion).setFromEuler(n).inverse());for(var l=new Quaternion,u=new Euler,h=[],c=0;c<s.length;c+=3)u.set(s[c],s[c+1],s[c+2],o),l.setFromEuler(u),void 0!==r&&l.premultiply(r),void 0!==n&&l.multiply(n),l.toArray(h,c/3*4);return new QuaternionKeyframeTrack(e+".quaternion",a,h)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,r=t.values.map(function(e){return e/100}),n=i.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+n+"]",t.times,r)},getTimesForAllAxes:function(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort(function(e,t){return e-t}).filter(function(e,t,i){return i.indexOf(e)==t})},getKeyframeTrackValues:function(e,t,i){var r=i,n=[],o=-1,a=-1,s=-1;return e.forEach(function(e){if(t.x&&(o=t.x.times.indexOf(e)),t.y&&(a=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==o){var i=t.x.values[o];n.push(i),r[0]=i}else n.push(r[0]);if(-1!==a){var l=t.y.values[a];n.push(l),r[1]=l}else n.push(r[1]);if(-1!==s){var u=t.z.values[s];n.push(u),r[2]=u}else n.push(r[2])}),n},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var i=e.values[t-1],r=e.values[t]-i,n=Math.abs(r);if(n>=180){for(var o=n/180,a=r/o,s=i+a,l=e.times[t-1],u=(e.times[t]-l)/o,h=l+u,c=[],d=[];h<e.times[t];)c.push(h),h+=u,d.push(s),s+=a;e.times=x(e.times,t,c),e.values=x(e.values,t,d)}}}},s.prototype={constructor:s,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new h,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,i=e.split(/[\r\n]+/);return i.forEach(function(e,r){var n=e.match(/^[\s\t]*;/),o=e.match(/^[\s\t]*$/);if(!n&&!o){var a=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");a?t.parseNodeBegin(e,a):s?t.parseNodeProperty(e,s,i[++r]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}}),this.allNodes},parseNodeBegin:function(e,t){var i=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),n={name:i},o=this.parseNodeAttr(r),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(i,n):i in a?("PoseNode"===i?a.PoseNode.push(n):void 0!==a[i].id&&(a[i]={},a[i][a[i].id]=a[i]),""!==o.id&&(a[i][o.id]=n)):"number"==typeof o.id?(a[i]={},a[i][o.id]=n):"Properties70"!==i&&(a[i]="PoseNode"===i?[n]:n),"number"==typeof o.id&&(n.id=o.id),""!==o.name&&(n.attrName=o.name),""!==o.type&&(n.attrType=o.type),this.pushStack(n)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var i="",r="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:i,type:r}},parseNodeProperty:function(e,t,i){var r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),n=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===n&&(n=i.replace(/"/g,"").replace(/,$/,"").trim());var o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===r){var a=n.split(",").slice(1),s=parseInt(a[0]),l=parseInt(a[1]),u=n.split(",").slice(3);r="connections",function(e,t){for(var i=0,r=e.length,n=t.length;i<n;i++,r++)e[r]=t[i]}(n=[s,l],u=u.map(function(e){return e.trim().replace(/^"/,"")})),void 0===o[r]&&(o[r]=[])}"Node"===r&&(o.id=n),r in o&&Array.isArray(o[r])?o[r].push(n):"a"!==r?o[r]=n:o.a=n,this.setCurrentProp(o,r),"a"===r&&","!==n.slice(-1)&&(o.a=_(n))}else this.parseNodeSpecialProperty(e,r,n)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=_(t.a))},parseNodeSpecialProperty:function(e,t,i){var r=i.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),n=r[0],o=r[1],a=r[2],s=r[3],l=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=_(l)}this.getPrevNode()[n]={type:o,type2:a,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),n)}},l.prototype={constructor:l,parse:function(e){var t=new u(e);t.skip(23);var i=t.getUint32();console.log("FBXLoader: FBX binary version: "+i);for(var r=new h;!this.endOfContent(t);){var n=this.parseNode(t,i);null!==n&&r.add(n.name,n)}return r},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var i={},r=t>=7500?e.getUint64():e.getUint32(),n=t>=7500?e.getUint64():e.getUint32(),o=(t>=7500?e.getUint64():e.getUint32(),e.getUint8()),a=e.getString(o);if(0===r)return null;for(var s=[],l=0;l<n;l++)s.push(this.parseProperty(e));var u=s.length>0?s[0]:"",h=s.length>1?s[1]:"",c=s.length>2?s[2]:"";for(i.singleProperty=1===n&&e.getOffset()===r;r>e.getOffset();){var d=this.parseNode(e,t);null!==d&&this.parseSubNode(a,i,d)}return i.propertyList=s,"number"==typeof u&&(i.id=u),""!==h&&(i.attrName=h),""!==c&&(i.attrType=c),""!==a&&(i.name=a),i},parseSubNode:function(e,t,i){if(!0===i.singleProperty){var r=i.propertyList[0];Array.isArray(r)?(t[i.name]=i,i.a=r):t[i.name]=r}else if("Connections"===e&&"C"===i.name){var n=[];i.propertyList.forEach(function(e,t){0!==t&&n.push(e)}),void 0===t.connections&&(t.connections=[]),t.connections.push(n)}else if("Properties70"===i.name){Object.keys(i).forEach(function(e){t[e]=i[e]})}else if("Properties70"===e&&"P"===i.name){var o,a=i.propertyList[0],s=i.propertyList[1],l=i.propertyList[2],u=i.propertyList[3];0===a.indexOf("Lcl ")&&(a=a.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),o="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:i.propertyList[4],t[a]={type:s,type2:l,flag:u,value:o}}else void 0===t[i.name]?"number"==typeof i.id?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:"PoseNode"===i.name?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):void 0===t[i.name][i.id]&&(t[i.name][i.id]=i)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var i=e.getUint32();return e.getArrayBuffer(i);case"S":i=e.getUint32();return e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var r=e.getUint32(),n=e.getUint32(),o=e.getUint32();if(0===n)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}"undefined"==typeof Zlib&&console.error("FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var a=new u(new Zlib.Inflate(new Uint8Array(e.getArrayBuffer(o))).decompress().buffer);switch(t){case"b":case"c":return a.getBooleanArray(r);case"d":return a.getFloat64Array(r);case"f":return a.getFloat32Array(r);case"i":return a.getInt32Array(r);case"l":return a.getInt64Array(r)}default:throw new Error("FBXLoader: Unknown property type "+t)}}},u.prototype={constructor:u,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],i=0;i<e;i++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],i=0;i<e;i++)t[i]=this.getUint8();var r=t.indexOf(0);return r>=0&&(t=t.slice(0,r)),LoaderUtils.decodeText(new Uint8Array(t))}},h.prototype={constructor:h,add:function(e,t){this[e]=t}};var p=[];function f(e,t,i,r){var n;switch(r.mappingType){case"ByPolygonVertex":n=e;break;case"ByPolygon":n=t;break;case"ByVertice":n=i;break;case"AllSame":n=r.indices[0];break;default:console.warn("FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(n=r.indices[n]);var o=n*r.dataSize,a=o+r.dataSize;return function(e,t,i,r){for(var n=i,o=0;n<r;n++,o++)e[o]=t[n];return e}(p,r.buffer,o,a)}var m=new Euler,v=new Vector3;function g(e){var t,i=new Matrix4,r=new Matrix4,n=new Matrix4,o=new Matrix4,a=new Matrix4,s=new Matrix4,l=new Matrix4,u=new Matrix4,h=new Matrix4,c=new Matrix4,d=new Matrix4,p=e.inheritType?e.inheritType:0;(e.translation&&i.setPosition(v.fromArray(e.translation)),e.preRotation)&&((t=e.preRotation.map(_Math.degToRad)).push(e.eulerOrder),r.makeRotationFromEuler(m.fromArray(t)));e.rotation&&((t=e.rotation.map(_Math.degToRad)).push(e.eulerOrder),n.makeRotationFromEuler(m.fromArray(t)));e.postRotation&&((t=e.postRotation.map(_Math.degToRad)).push(e.eulerOrder),o.makeRotationFromEuler(m.fromArray(t)));e.scale&&a.scale(v.fromArray(e.scale)),e.scalingOffset&&l.setPosition(v.fromArray(e.scalingOffset)),e.scalingPivot&&s.setPosition(v.fromArray(e.scalingPivot)),e.rotationOffset&&u.setPosition(v.fromArray(e.rotationOffset)),e.rotationPivot&&h.setPosition(v.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(c=e.parentMatrixWorld);var f=r.multiply(n).multiply(o),g=new Matrix4;c.extractRotation(g);var y,_,b,x,w=new Matrix4;if(w.copyPosition(c),b=w.getInverse(w).multiply(c),_=g.getInverse(g).multiply(b),y=a,0===p)x=g.multiply(f).multiply(_).multiply(y);else if(1===p)x=g.multiply(_).multiply(f).multiply(y);else{var S=(new Matrix4).copy(a),M=_.multiply(S.getInverse(S));x=g.multiply(f).multiply(M).multiply(y)}var T=i.multiply(u).multiply(h).multiply(r).multiply(n).multiply(o).multiply(h.getInverse(h)).multiply(l).multiply(s).multiply(a).multiply(s.getInverse(s)),A=(new Matrix4).copyPosition(T),C=c.multiply(A);return d.copyPosition(C),T=d.multiply(x)}function y(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function _(e){return e.split(",").map(function(e){return parseFloat(e)})}function b(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=e.byteLength),LoaderUtils.decodeText(new Uint8Array(e,t,i))}function x(e,t,i){return e.slice(0,t).concat(i).concat(e.slice(t))}return r}(),GCodeLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager,this.splitLayer=!1};GCodeLoader.prototype.load=function(e,t,i,r){var n=this,o=new FileLoader(n.manager);o.setPath(n.path),o.load(e,function(e){t(n.parse(e))},i,r)},GCodeLoader.prototype.setPath=function(e){return this.path=e,this},GCodeLoader.prototype.parse=function(e){var t={x:0,y:0,z:0,e:0,f:0,extruding:!1,relative:!1},i=[],r=void 0,n=new LineBasicMaterial({color:16711680});n.name="path";var o=new LineBasicMaterial({color:65280});function a(e){r={vertex:[],pathVertex:[],z:e.z},i.push(r)}function s(e,i){return t.relative?i:i-e}function l(e,i){return t.relative?e+i:i}o.name="extruded";for(var u,h,c=e.replace(/;.+/g,"").split("\n"),d=0;d<c.length;d++){var p=c[d].split(" "),f=p[0].toUpperCase(),m={};if(p.splice(1).forEach(function(e){if(void 0!==e[0]){var t=e[0].toLowerCase(),i=parseFloat(e.substring(1));m[t]=i}}),"G0"===f||"G1"===f){var v={x:void 0!==m.x?l(t.x,m.x):t.x,y:void 0!==m.y?l(t.y,m.y):t.y,z:void 0!==m.z?l(t.z,m.z):t.z,e:void 0!==m.e?l(t.e,m.e):t.e,f:void 0!==m.f?l(t.f,m.f):t.f};s(t.e,v.e)>0&&(v.extruding=s(t.e,v.e)>0,null!=r&&v.z==r.z||a(v)),u=t,h=v,void 0===r&&a(u),v.extruding?(r.vertex.push(u.x,u.y,u.z),r.vertex.push(h.x,h.y,h.z)):(r.pathVertex.push(u.x,u.y,u.z),r.pathVertex.push(h.x,h.y,h.z)),t=v}else if("G2"===f||"G3"===f)console.warn("GCodeLoader: Arc command not supported");else if("G90"===f)t.relative=!1;else if("G91"===f)t.relative=!0;else if("G92"===f){(v=t).x=void 0!==m.x?m.x:v.x,v.y=void 0!==m.y?m.y:v.y,v.z=void 0!==m.z?m.z:v.z,v.e=void 0!==m.e?m.e:v.e,t=v}else console.warn("GCodeLoader: Command not supported:"+f)}function g(e,t){var i=new BufferGeometry;i.addAttribute("position",new Float32BufferAttribute(e,3));var r=new LineSegments(i,t?o:n);r.name="layer"+d,y.add(r)}var y=new Group;if(y.name="gcode",this.splitLayer)for(d=0;d<i.length;d++){g((x=i[d]).vertex,!0),g(x.pathVertex,!1)}else{var _=[],b=[];for(d=0;d<i.length;d++){var x=i[d];_=_.concat(x.vertex),b=b.concat(x.pathVertex)}g(_,!0),g(b,!1)}return y.quaternion.setFromEuler(new Euler(-Math.PI/2,0,0)),y};var BufferGeometryUtils={computeTangents:function(e){var t=e.index,i=e.attributes;if(null!==t&&void 0!==i.position&&void 0!==i.normal&&void 0!==i.uv){var r=t.array,n=i.position.array,o=i.normal.array,a=i.uv.array,s=n.length/3;void 0===i.tangent&&e.addAttribute("tangent",new BufferAttribute(new Float32Array(4*s),4));for(var l=i.tangent.array,u=[],h=[],c=0;c<s;c++)u[c]=new Vector3,h[c]=new Vector3;var d=new Vector3,p=new Vector3,f=new Vector3,m=new Vector2,v=new Vector2,g=new Vector2,y=new Vector3,_=new Vector3,b=e.groups;0===b.length&&(b=[{start:0,count:r.length}]);c=0;for(var x=b.length;c<x;++c)for(var w=E=(k=b[c]).start,S=E+k.count;w<S;w+=3)D(r[w+0],r[w+1],r[w+2]);var M,T,A,C=new Vector3,L=new Vector3,N=new Vector3,P=new Vector3;for(c=0,x=b.length;c<x;++c){var k,E;for(w=E=(k=b[c]).start,S=E+k.count;w<S;w+=3)O(r[w+0]),O(r[w+1]),O(r[w+2])}}else console.warn("BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function D(e,t,i){d.fromArray(n,3*e),p.fromArray(n,3*t),f.fromArray(n,3*i),m.fromArray(a,2*e),v.fromArray(a,2*t),g.fromArray(a,2*i);var r=p.x-d.x,o=f.x-d.x,s=p.y-d.y,l=f.y-d.y,c=p.z-d.z,b=f.z-d.z,x=v.x-m.x,w=g.x-m.x,S=v.y-m.y,M=g.y-m.y,T=1/(x*M-w*S);y.set((M*r-S*o)*T,(M*s-S*l)*T,(M*c-S*b)*T),_.set((x*o-w*r)*T,(x*l-w*s)*T,(x*b-w*c)*T),u[e].add(y),u[t].add(y),u[i].add(y),h[e].add(_),h[t].add(_),h[i].add(_)}function O(e){N.fromArray(o,3*e),P.copy(N),T=u[e],C.copy(T),C.sub(N.multiplyScalar(N.dot(T))).normalize(),L.crossVectors(P,T),A=L.dot(h[e]),M=A<0?-1:1,l[4*e]=C.x,l[4*e+1]=C.y,l[4*e+2]=C.z,l[4*e+3]=M}},mergeBufferGeometries:function(e,t){for(var i=null!==e[0].index,r=new Set(Object.keys(e[0].attributes)),n=new Set(Object.keys(e[0].morphAttributes)),o={},a={},s=new BufferGeometry,l=0,u=0;u<e.length;++u){var h=e[u];if(i!==(null!==h.index))return null;for(var c in h.attributes){if(!r.has(c))return null;void 0===o[c]&&(o[c]=[]),o[c].push(h.attributes[c])}for(var c in h.morphAttributes){if(!n.has(c))return null;void 0===a[c]&&(a[c]=[]),a[c].push(h.morphAttributes[c])}if(s.userData.mergedUserData=s.userData.mergedUserData||[],s.userData.mergedUserData.push(h.userData),t){var d;if(i)d=h.index.count;else{if(void 0===h.attributes.position)return null;d=h.attributes.position.count}s.addGroup(l,d,u),l+=d}}if(i){var p=0,f=[];for(u=0;u<e.length;++u){for(var m=e[u].index,v=0;v<m.count;++v)f.push(m.getX(v)+p);p+=e[u].attributes.position.count}s.setIndex(f)}for(var c in o){var g=this.mergeBufferAttributes(o[c]);if(!g)return null;s.addAttribute(c,g)}for(var c in a){var y=a[c][0].length;if(0===y)break;s.morphAttributes=s.morphAttributes||{},s.morphAttributes[c]=[];for(u=0;u<y;++u){var _=[];for(v=0;v<a[c].length;++v)_.push(a[c][v][u]);var b=this.mergeBufferAttributes(_);if(!b)return null;s.morphAttributes[c].push(b)}}return s},mergeBufferAttributes:function(e){for(var t,i,r,n=0,o=0;o<e.length;++o){var a=e[o];if(a.isInterleavedBufferAttribute)return null;if(void 0===t&&(t=a.array.constructor),t!==a.array.constructor)return null;if(void 0===i&&(i=a.itemSize),i!==a.itemSize)return null;if(void 0===r&&(r=a.normalized),r!==a.normalized)return null;n+=a.array.length}var s=new t(n),l=0;for(o=0;o<e.length;++o)s.set(e[o].array,l),l+=e[o].array.length;return new BufferAttribute(s,i,r)},interleaveAttributes:function(e){for(var t,i=0,r=0,n=0,o=e.length;n<o;++n){var a=e[n];if(void 0===t&&(t=a.array.constructor),t!==a.array.constructor)return console.warn("AttributeBuffers of different types cannot be interleaved"),null;i+=a.array.length,r+=a.itemSize}var s=new InterleavedBuffer(new t(i),r),l=0,u=[],h=["getX","getY","getZ","getW"],c=["setX","setY","setZ","setW"],d=0;for(o=e.length;d<o;d++){var p=(a=e[d]).itemSize,f=a.count,m=new InterleavedBufferAttribute(s,p,l,a.normalized);u.push(m),l+=p;for(var v=0;v<f;v++)for(var g=0;g<p;g++)m[c[g]](v,a[h[g]](v))}return u},estimateBytesUsed:function(e){var t=0;for(var i in e.attributes){var r=e.getAttribute(i);t+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}var n=e.getIndex();return t+=n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0},mergeVertices:function(e,t){void 0===t&&(t=1e-4),t=Math.max(t,Number.EPSILON);for(var i={},r=e.getIndex(),n=e.getAttribute("position"),o=r?r.count:n.count,a=0,s=Object.keys(e.attributes),l={},u={},h=[],c=["getX","getY","getZ","getW"],d=0,p=s.length;d<p;d++){l[x=s[d]]=[],(T=e.morphAttributes[x])&&(u[x]=new Array(T.length).fill().map(function(){return[]}))}for(var f=Math.log10(1/t),m=Math.pow(10,f),v=0;v<o;v++){for(var g=r?r.getX(v):v,y="",_=0,b=s.length;_<b;_++)for(var x=s[_],w=(M=e.getAttribute(x)).itemSize,S=0;S<w;S++)y+=~~(M[c[S]](g)*m)+",";if(y in i)h.push(i[y]);else{for(_=0,b=s.length;_<b;_++){x=s[_];var M=e.getAttribute(x),T=e.morphAttributes[x],A=(w=M.itemSize,l[x]),C=u[x];for(S=0;S<w;S++){var L=c[S];if(A.push(M[L](g)),T)for(var N=0,P=T.length;N<P;N++)C[N].push(T[N][L](g))}}i[y]=a,h.push(a),a++}}var k=e.clone();for(v=0,b=s.length;v<b;v++){x=s[v];var E=e.getAttribute(x),D=new E.array.constructor(l[x]);if(E.isInterleavedBufferAttribute?M=new BufferAttribute(D,E.itemSize,E.itemSize):(M=e.getAttribute(x).clone()).setArray(D),k.addAttribute(x,M),x in u)for(_=0;_<u[x].length;_++){var O=e.morphAttributes[x][_].clone();O.setArray(new O.array.constructor(u[x][_])),k.morphAttributes[x][_]=O}}var R=Uint8Array;h.length>=Math.pow(2,8)&&(R=Uint16Array),h.length>=Math.pow(2,16)&&(R=Uint32Array);var F=new R(h);h=null;return null===r?h=new BufferAttribute(F,1):(h=e.getIndex().clone()).setArray(F),k.setIndex(h),k}},GLTFLoader=function(){function e(e){this.manager=void 0!==e?e:DefaultLoadingManager,this.dracoLoader=null}function t(){var e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype={constructor:e,crossOrigin:"anonymous",load:function(e,t,i,r){var n,o=this;n=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:LoaderUtils.extractUrlBase(e),o.manager.itemStart(e);var a=function(t){r?r(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},s=new FileLoader(o.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.load(e,function(i){try{o.parse(i,n,function(i){t(i),o.manager.itemEnd(e)},a)}catch(e){a(e)}},i,a)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setDRACOLoader:function(e){return this.dracoLoader=e,this},parse:function(e,t,s,l){var p,f={};if("string"==typeof e)p=e;else if(LoaderUtils.decodeText(new Uint8Array(e,0,4))===a){try{f[i.KHR_BINARY_GLTF]=new u(e)}catch(e){return void(l&&l(e))}p=f[i.KHR_BINARY_GLTF].content}else p=LoaderUtils.decodeText(new Uint8Array(e));var m=JSON.parse(p);if(void 0===m.asset||m.asset.version[0]<2)l&&l(new Error("GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(m.extensionsUsed)for(var v=0;v<m.extensionsUsed.length;++v){var g=m.extensionsUsed[v],y=m.extensionsRequired||[];switch(g){case i.KHR_LIGHTS_PUNCTUAL:f[g]=new n(m);break;case i.KHR_MATERIALS_UNLIT:f[g]=new o(m);break;case i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:f[g]=new d(m);break;case i.KHR_DRACO_MESH_COMPRESSION:f[g]=new h(m,this.dracoLoader);break;case i.MSFT_TEXTURE_DDS:f[i.MSFT_TEXTURE_DDS]=new r;break;case i.KHR_TEXTURE_TRANSFORM:f[i.KHR_TEXTURE_TRANSFORM]=new c(m);break;default:y.indexOf(g)>=0&&console.warn('GLTFLoader: Unknown extension "'+g+'".')}}var _=new V(m,f,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});_.parse(function(e,t,i,r,n){var o={scene:e,scenes:t,cameras:i,animations:r,asset:n.asset,parser:_,userData:{}};D(f,o,n),s(o)},l)}}};var i={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function r(){if(!DDSLoader)throw new Error("GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=i.MSFT_TEXTURE_DDS,this.ddsLoader=new DDSLoader}function n(e){this.name=i.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[i.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function o(e){this.name=i.KHR_MATERIALS_UNLIT}n.prototype.loadLight=function(e){var t,i=this.lightDefs[e],r=new Color(16777215);void 0!==i.color&&r.fromArray(i.color);var n=void 0!==i.range?i.range:0;switch(i.type){case"directional":(t=new DirectionalLight(r)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new PointLight(r)).distance=n;break;case"spot":(t=new SpotLight(r)).distance=n,i.spot=i.spot||{},i.spot.innerConeAngle=void 0!==i.spot.innerConeAngle?i.spot.innerConeAngle:0,i.spot.outerConeAngle=void 0!==i.spot.outerConeAngle?i.spot.outerConeAngle:Math.PI/4,t.angle=i.spot.outerConeAngle,t.penumbra=1-i.spot.innerConeAngle/i.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw new Error('GLTFLoader: Unexpected light type, "'+i.type+'".')}return t.position.set(0,0,0),t.decay=2,void 0!==i.intensity&&(t.intensity=i.intensity),t.name=i.name||"light_"+e,Promise.resolve(t)},o.prototype.getMaterialType=function(e){return MeshBasicMaterial},o.prototype.extendParams=function(e,t,i){var r=[];e.color=new Color(1,1,1),e.opacity=1;var n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){var o=n.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==n.baseColorTexture&&r.push(i.assignTexture(e,"map",n.baseColorTexture))}return Promise.all(r)};var a="glTF",s=12,l={JSON:1313821514,BIN:5130562};function u(e){this.name=i.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,s);if(this.header={magic:LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==a)throw new Error("GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var r=new DataView(e,s),n=0;n<r.byteLength;){var o=r.getUint32(n,!0);n+=4;var u=r.getUint32(n,!0);if(n+=4,u===l.JSON){var h=new Uint8Array(e,s+n,o);this.content=LoaderUtils.decodeText(h)}else if(u===l.BIN){var c=s+n;this.body=e.slice(c,c+o)}n+=o}if(null===this.content)throw new Error("GLTFLoader: JSON content not found.")}function h(e,t){if(!t)throw new Error("GLTFLoader: No DRACOLoader instance provided.");this.name=i.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,DRACOLoader.getDecoderModule()}function c(e){this.name=i.KHR_TEXTURE_TRANSFORM}function d(){return{name:i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return ShaderMaterial},extendParams:function(e,t,i){var r=t.extensions[this.name],n=ShaderLib.standard,o=UniformsUtils.clone(n.uniforms),a=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),u=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),h=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),c=n.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",a).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",u).replace("#include <lights_physical_fragment>",h);delete o.roughness,delete o.metalness,delete o.roughnessMap,delete o.metalnessMap,o.specular={value:(new Color).setHex(1118481)},o.glossiness={value:.5},o.specularMap={value:null},o.glossinessMap={value:null},e.vertexShader=n.vertexShader,e.fragmentShader=c,e.uniforms=o,e.defines={STANDARD:""},e.color=new Color(1,1,1),e.opacity=1;var d=[];if(Array.isArray(r.diffuseFactor)){var p=r.diffuseFactor;e.color.fromArray(p),e.opacity=p[3]}if(void 0!==r.diffuseTexture&&d.push(i.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new Color(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new Color(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var f=r.specularGlossinessTexture;d.push(i.assignTexture(e,"glossinessMap",f)),d.push(i.assignTexture(e,"specularMap",f))}return Promise.all(d)},createMaterial:function(e){var t=new ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return t.isGLTFSpecularGlossinessMaterial=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t.extensions.derivatives=!0,t},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var i=this.specularGlossinessParams,r=0,n=i.length;r<n;r++)t[i[r]]=e[i[r]];return t},refreshUniforms:function(e,t,i,r,n,o){if(!0===n.isGLTFSpecularGlossinessMaterial){var a,s=n.uniforms,l=n.defines;s.opacity.value=n.opacity,s.diffuse.value.copy(n.color),s.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),s.map.value=n.map,s.specularMap.value=n.specularMap,s.alphaMap.value=n.alphaMap,s.lightMap.value=n.lightMap,s.lightMapIntensity.value=n.lightMapIntensity,s.aoMap.value=n.aoMap,s.aoMapIntensity.value=n.aoMapIntensity,n.map?a=n.map:n.specularMap?a=n.specularMap:n.displacementMap?a=n.displacementMap:n.normalMap?a=n.normalMap:n.bumpMap?a=n.bumpMap:n.glossinessMap?a=n.glossinessMap:n.alphaMap?a=n.alphaMap:n.emissiveMap&&(a=n.emissiveMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),s.uvTransform.value.copy(a.matrix)),n.envMap&&(s.envMap.value=n.envMap,s.envMapIntensity.value=n.envMapIntensity,s.flipEnvMap.value=n.envMap.isCubeTexture?-1:1,s.reflectivity.value=n.reflectivity,s.refractionRatio.value=n.refractionRatio,s.maxMipLevel.value=e.properties.get(n.envMap).__maxMipLevel),s.specular.value.copy(n.specular),s.glossiness.value=n.glossiness,s.glossinessMap.value=n.glossinessMap,s.emissiveMap.value=n.emissiveMap,s.bumpMap.value=n.bumpMap,s.normalMap.value=n.normalMap,s.displacementMap.value=n.displacementMap,s.displacementScale.value=n.displacementScale,s.displacementBias.value=n.displacementBias,null!==s.glossinessMap.value&&void 0===l.USE_GLOSSINESSMAP&&(l.USE_GLOSSINESSMAP="",l.USE_ROUGHNESSMAP=""),null===s.glossinessMap.value&&void 0!==l.USE_GLOSSINESSMAP&&(delete l.USE_GLOSSINESSMAP,delete l.USE_ROUGHNESSMAP)}}}}function p(e,t,i,r){Interpolant.call(this,e,t,i,r)}h.prototype.decodePrimitive=function(e,t){var i=this.json,r=this.dracoLoader,n=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},s={},l={};for(var u in o)u in T&&(a[T[u]]=o[u]);for(u in e.attributes)if(void 0!==T[u]&&void 0!==o[u]){var h=i.accessors[e.attributes[u]],c=x[h.componentType];l[T[u]]=c,s[T[u]]=!0===h.normalized}return t.getDependency("bufferView",n).then(function(e){return new Promise(function(t){r.decodeDracoFile(e,function(e){for(var i in e.attributes){var r=e.attributes[i],n=s[i];void 0!==n&&(r.normalized=n)}t(e)},a,l)})})},c.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},p.prototype=Object.create(Interpolant.prototype),p.prototype.constructor=p,p.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r*3+r,o=0;o!==r;o++)t[o]=i[n+o];return t},p.prototype.beforeStart_=p.prototype.copySampleValue_,p.prototype.afterEnd_=p.prototype.copySampleValue_,p.prototype.interpolate_=function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,u=r-t,h=(i-t)/u,c=h*h,d=c*h,p=e*l,f=p-l,m=-2*d+3*c,v=d-c,g=1-m,y=v-c+h,_=0;_!==a;_++){var b=o[f+_+a],x=o[f+_+s]*u,w=o[p+_+a],S=o[p+_]*u;n[_]=g*b+y*x+m*w+v*S}return n};var f=0,m=1,v=2,g=3,y=4,_=5,b=6,x={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},w={9728:NearestFilter,9729:LinearFilter,9984:NearestMipMapNearestFilter,9985:LinearMipMapNearestFilter,9986:NearestMipMapLinearFilter,9987:LinearMipMapLinearFilter},S={33071:ClampToEdgeWrapping,33648:MirroredRepeatWrapping,10497:RepeatWrapping},M={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},T={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},A={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},C={CUBICSPLINE:InterpolateSmooth,LINEAR:InterpolateLinear,STEP:InterpolateDiscrete},L="OPAQUE",N="MASK",P="BLEND",k={"image/png":RGBAFormat,"image/jpeg":RGBFormat};function E(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function D(e,t,i){for(var r in i.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=i.extensions[r])}function O(e,t){void 0!==t.extras&&("object"==typeof t.extras?e.userData=t.extras:console.warn("GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function R(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var i=0,r=t.weights.length;i<r;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){var n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(i=0,r=n.length;i<r;i++)e.morphTargetDictionary[n[i]]=i}else console.warn("GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function F(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var i in e)if(e[i]!==t[i])return!1;return!0}function I(e){var t=e.extensions&&e.extensions[i.KHR_DRACO_MESH_COMPRESSION];return t?"draco:"+t.bufferView+":"+t.indices+":"+B(t.attributes):e.indices+":"+B(e.attributes)+":"+e.mode}function B(e){for(var t="",i=Object.keys(e).sort(),r=0,n=i.length;r<n;r++)t+=i[r]+":"+e[i[r]]+";";return t}function U(e){if(e.isInterleavedBufferAttribute){for(var t=e.count,i=e.itemSize,r=e.array.slice(0,t*i),n=0,o=0;n<t;++n)r[o++]=e.getX(n),i>=2&&(r[o++]=e.getY(n)),i>=3&&(r[o++]=e.getZ(n)),i>=4&&(r[o++]=e.getW(n));return new BufferAttribute(r,i,e.normalized)}return e.clone()}function V(e,i,r){this.json=e||{},this.extensions=i||{},this.options=r||{},this.cache=new t,this.primitiveCache={},this.multiplePrimitivesCache={},this.multiPassGeometryCache={},this.textureLoader=new TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function z(e,t,i){var r=t.attributes,n=[];function o(t,r){return i.getDependency("accessor",t).then(function(t){e.addAttribute(r,t)})}for(var a in r){var s=T[a];s&&(s in e.attributes||n.push(o(r[a],s)))}if(void 0!==t.indices&&!e.index){var l=i.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});n.push(l)}return O(e,t),Promise.all(n).then(function(){return void 0!==t.targets?function(e,t,i){for(var r=!1,n=!1,o=0,a=t.length;o<a&&(void 0!==(u=t[o]).POSITION&&(r=!0),void 0!==u.NORMAL&&(n=!0),!r||!n);o++);if(!r&&!n)return Promise.resolve(e);var s=[],l=[];for(o=0,a=t.length;o<a;o++){var u=t[o];if(r){var h=void 0!==u.POSITION?i.getDependency("accessor",u.POSITION).then(function(e){return U(e)}):e.attributes.position;s.push(h)}n&&(h=void 0!==u.NORMAL?i.getDependency("accessor",u.NORMAL).then(function(e){return U(e)}):e.attributes.normal,l.push(h))}return Promise.all([Promise.all(s),Promise.all(l)]).then(function(i){for(var o=i[0],a=i[1],s=0,l=t.length;s<l;s++){var u=t[s],h="morphTarget"+s;if(r&&void 0!==u.POSITION){var c=o[s];c.name=h;for(var d=e.attributes.position,p=0,f=c.count;p<f;p++)c.setXYZ(p,c.getX(p)+d.getX(p),c.getY(p)+d.getY(p),c.getZ(p)+d.getZ(p))}if(n&&void 0!==u.NORMAL){var m=a[s];m.name=h;var v=e.attributes.normal;for(p=0,f=m.count;p<f;p++)m.setXYZ(p,m.getX(p)+v.getX(p),m.getY(p)+v.getY(p),m.getZ(p)+v.getZ(p))}}return r&&(e.morphAttributes.position=o),n&&(e.morphAttributes.normal=a),e})}(e,t.targets,i):e})}return V.prototype.parse=function(e,t){var i=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(t){var r=t.scenes||[],n=r[i.scene||0],o=t.animations||[],a=t.cameras||[];e(n,r,a,o,i)}).catch(t)},V.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[],r={},n={},o=0,a=t.length;o<a;o++)for(var s=t[o].joints,l=0,u=s.length;l<u;l++)e[s[l]].isBone=!0;for(var h=0,c=e.length;h<c;h++){var d=e[h];void 0!==d.mesh&&(void 0===r[d.mesh]&&(r[d.mesh]=n[d.mesh]=0),r[d.mesh]++,void 0!==d.skin&&(i[d.mesh].isSkinnedMesh=!0))}this.json.meshReferences=r,this.json.meshUses=n},V.prototype.getDependency=function(e,t){var r=e+":"+t,n=this.cache.get(r);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this.loadMesh(t);break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this.loadBufferView(t);break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this.loadMaterial(t);break;case"texture":n=this.loadTexture(t);break;case"skin":n=this.loadSkin(t);break;case"animation":n=this.loadAnimation(t);break;case"camera":n=this.loadCamera(t);break;case"light":n=this.extensions[i.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,n)}return n},V.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var i=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map(function(t,r){return i.getDependency(e,r)})),this.cache.add(e,t)}return t},V.prototype.getMultiDependencies=function(e){for(var t={},i=[],r=0,n=e.length;r<n;r++){var o=e[r],a=this.getDependencies(o);a=a.then(function(e,i){t[e]=i}.bind(this,o+("mesh"===o?"es":"s"))),i.push(a)}return Promise.all(i).then(function(){return t})},V.prototype.loadBuffer=function(e){var t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[i.KHR_BINARY_GLTF].body);var n=this.options;return new Promise(function(e,i){r.load(E(t.uri,n.path),e,void 0,function(){i(new Error('GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},V.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var i=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+i)})},V.prototype.loadAccessor=function(e){var t=this,i=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);var n=[];return void 0!==r.bufferView?n.push(this.getDependency("bufferView",r.bufferView)):n.push(null),void 0!==r.sparse&&(n.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(n).then(function(e){var n,o=e[0],a=M[r.type],s=x[r.componentType],l=s.BYTES_PER_ELEMENT,u=l*a,h=r.byteOffset||0,c=void 0!==r.bufferView?i.bufferViews[r.bufferView].byteStride:void 0,d=!0===r.normalized;if(c&&c!==u){var p="InterleavedBuffer:"+r.bufferView+":"+r.componentType,f=t.cache.get(p);f||(f=new InterleavedBuffer(new s(o),c/l),t.cache.add(p,f)),n=new InterleavedBufferAttribute(f,a,h/l,d)}else n=new BufferAttribute(null===o?new s(r.count*a):new s(o,h,r.count*a),a,d);if(void 0!==r.sparse){var m=M.SCALAR,v=x[r.sparse.indices.componentType],g=r.sparse.indices.byteOffset||0,y=r.sparse.values.byteOffset||0,_=new v(e[1],g,r.sparse.count*m),b=new s(e[2],y,r.sparse.count*a);null!==o&&n.setArray(n.array.slice());for(var w=0,S=_.length;w<S;w++){var T=_[w];if(n.setX(T,b[w*a]),a>=2&&n.setY(T,b[w*a+1]),a>=3&&n.setZ(T,b[w*a+2]),a>=4&&n.setW(T,b[w*a+3]),a>=5)throw new Error("GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return n})},V.prototype.loadTexture=function(e){var t,r=this,n=this.json,o=this.options,a=this.textureLoader,s=window.URL||window.webkitURL,l=n.textures[e],u=l.extensions||{},h=(t=u[i.MSFT_TEXTURE_DDS]?n.images[u[i.MSFT_TEXTURE_DDS].source]:n.images[l.source]).uri,c=!1;return void 0!==t.bufferView&&(h=r.getDependency("bufferView",t.bufferView).then(function(e){c=!0;var i=new Blob([e],{type:t.mimeType});return h=s.createObjectURL(i)})),Promise.resolve(h).then(function(e){var t=Loader$1.Handlers.get(e);return t||(t=u[i.MSFT_TEXTURE_DDS]?r.extensions[i.MSFT_TEXTURE_DDS].ddsLoader:a),new Promise(function(i,r){t.load(E(e,o.path),i,void 0,r)})}).then(function(e){!0===c&&s.revokeObjectURL(h),e.flipY=!1,void 0!==l.name&&(e.name=l.name),t.mimeType in k&&(e.format=k[t.mimeType]);var i=(n.samplers||{})[l.sampler]||{};return e.magFilter=w[i.magFilter]||LinearFilter,e.minFilter=w[i.minFilter]||LinearMipMapLinearFilter,e.wrapS=S[i.wrapS]||RepeatWrapping,e.wrapT=S[i.wrapT]||RepeatWrapping,e})},V.prototype.assignTexture=function(e,t,r){var n=this;return this.getDependency("texture",r.index).then(function(o){switch(t){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":o.format=RGBFormat}if(n.extensions[i.KHR_TEXTURE_TRANSFORM]){var a=void 0!==r.extensions?r.extensions[i.KHR_TEXTURE_TRANSFORM]:void 0;a&&(o=n.extensions[i.KHR_TEXTURE_TRANSFORM].extendTexture(o,a))}e[t]=o})},V.prototype.loadMaterial=function(e){var t,r=this.json,n=this.extensions,o=r.materials[e],a={},s=o.extensions||{},l=[];if(s[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=n[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=u.getMaterialType(o),l.push(u.extendParams(a,o,this))}else if(s[i.KHR_MATERIALS_UNLIT]){var h=n[i.KHR_MATERIALS_UNLIT];t=h.getMaterialType(o),l.push(h.extendParams(a,o,this))}else{t=MeshStandardMaterial;var c=o.pbrMetallicRoughness||{};if(a.color=new Color(1,1,1),a.opacity=1,Array.isArray(c.baseColorFactor)){var d=c.baseColorFactor;a.color.fromArray(d),a.opacity=d[3]}void 0!==c.baseColorTexture&&l.push(this.assignTexture(a,"map",c.baseColorTexture)),a.metalness=void 0!==c.metallicFactor?c.metallicFactor:1,a.roughness=void 0!==c.roughnessFactor?c.roughnessFactor:1,void 0!==c.metallicRoughnessTexture&&(l.push(this.assignTexture(a,"metalnessMap",c.metallicRoughnessTexture)),l.push(this.assignTexture(a,"roughnessMap",c.metallicRoughnessTexture)))}!0===o.doubleSided&&(a.side=DoubleSide);var p=o.alphaMode||L;return p===P?a.transparent=!0:(a.transparent=!1,p===N&&(a.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&t!==MeshBasicMaterial&&(l.push(this.assignTexture(a,"normalMap",o.normalTexture)),a.normalScale=new Vector2(1,1),void 0!==o.normalTexture.scale&&a.normalScale.set(o.normalTexture.scale,o.normalTexture.scale)),void 0!==o.occlusionTexture&&t!==MeshBasicMaterial&&(l.push(this.assignTexture(a,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(a.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&t!==MeshBasicMaterial&&(a.emissive=(new Color).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&t!==MeshBasicMaterial&&l.push(this.assignTexture(a,"emissiveMap",o.emissiveTexture)),Promise.all(l).then(function(){var e;return e=t===ShaderMaterial?n[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new t(a),void 0!==o.name&&(e.name=o.name),e.map&&(e.map.encoding=sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=sRGBEncoding),e.specularMap&&(e.specularMap.encoding=sRGBEncoding),O(e,o),o.extensions&&D(n,e,o),e})},V.prototype.loadGeometries=function(e){var t,r=this,n=this.extensions,o=this.primitiveCache,a=function(e){if(e.length<2)return!1;var t=e[0],r=t.targets||[];if(void 0===t.indices)return!1;for(var n=1,o=e.length;n<o;n++){var a=e[n];if(t.mode!==a.mode)return!1;if(void 0===a.indices)return!1;if(a.extensions&&a.extensions[i.KHR_DRACO_MESH_COMPRESSION])return!1;if(!F(t.attributes,a.attributes))return!1;var s=a.targets||[];if(r.length!==s.length)return!1;for(var l=0,u=r.length;l<u;l++)if(!F(r[l],s[l]))return!1}return!0}(e);function s(e){return n[i.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,r).then(function(t){return z(t,e,r)})}a&&(t=e,e=[e[0]]);for(var l=[],u=0,h=e.length;u<h;u++){var c,d=e[u],p=I(d),f=o[p];if(f)l.push(f.promise);else c=d.extensions&&d.extensions[i.KHR_DRACO_MESH_COMPRESSION]?s(d):z(new BufferGeometry,d,r),o[p]={primitive:d,promise:c},l.push(c)}return Promise.all(l).then(function(i){if(a){var n=i[0],o=r.multiPassGeometryCache,s=function(e,t){for(var i=e.uuid,r=0,n=t.length;r<n;r++)i+=r+I(t[r]);return i}(n,t);if(null!==(p=o[s]))return[p.geometry];var l=new BufferGeometry;for(var u in l.name=n.name,l.userData=n.userData,n.attributes)l.addAttribute(u,n.attributes[u]);for(var u in n.morphAttributes)l.morphAttributes[u]=n.morphAttributes[u];for(var h=[],c=0,d=t.length;c<d;c++)h.push(r.getDependency("accessor",t[c].indices));return Promise.all(h).then(function(e){for(var i=[],r=0,a=0,u=t.length;a<u;a++){for(var h=e[a],c=0,d=h.count;c<d;c++)i.push(h.array[c]);l.addGroup(r,h.count,a),r+=h.count}return l.setIndex(i),o[s]={geometry:l,baseGeometry:n,primitives:t},[l]})}if(i.length>1&&void 0!==BufferGeometryUtils){for(c=1,d=e.length;c<d;c++)if(e[0].mode!==e[c].mode)return i;var p;o=r.multiplePrimitivesCache,s=function(e){for(var t="",i=0,r=e.length;i<r;i++)t+=":"+e[i].uuid;return t}(i);if(p=o[s]){if(null!==p.geometry)return[p.geometry]}else{l=BufferGeometryUtils.mergeBufferGeometries(i,!0);if(o[s]={geometry:l,baseGeometries:i},null!==l)return[l]}}return i})},V.prototype.loadMesh=function(e){for(var t=this,r=this.json,n=this.extensions,o=r.meshes[e],a=o.primitives,s=[],l=0,u=a.length;l<u;l++){var h=void 0===a[l].material?new MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:FrontSide}):this.getDependency("material",a[l].material);s.push(h)}return Promise.all(s).then(function(r){return t.loadGeometries(a).then(function(s){for(var l=1===s.length&&s[0].groups.length>0,u=[],h=0,c=s.length;h<c;h++){var d,p=s[h],x=a[h],w=l?r:r[h];if(x.mode===y||x.mode===_||x.mode===b||void 0===x.mode)!0===(d=!0===o.isSkinnedMesh?new SkinnedMesh(p,w):new Mesh(p,w)).isSkinnedMesh&&d.normalizeSkinWeights(),x.mode===_?d.drawMode=TriangleStripDrawMode:x.mode===b&&(d.drawMode=TriangleFanDrawMode);else if(x.mode===m)d=new LineSegments(p,w);else if(x.mode===g)d=new Line(p,w);else if(x.mode===v)d=new LineLoop(p,w);else{if(x.mode!==f)throw new Error("GLTFLoader: Primitive mode unsupported: "+x.mode);d=new Points(p,w)}Object.keys(d.geometry.morphAttributes).length>0&&R(d,o),d.name=o.name||"mesh_"+e,s.length>1&&(d.name+="_"+h),O(d,o),u.push(d);for(var S=l?d.material:[d.material],M=void 0!==p.attributes.tangent,T=void 0!==p.attributes.color,A=void 0===p.attributes.normal,C=!0===d.isSkinnedMesh,L=Object.keys(p.morphAttributes).length>0,N=L&&void 0!==p.morphAttributes.normal,P=0,k=S.length;P<k;P++){w=S[P];if(d.isPoints){var E="PointsMaterial:"+w.uuid,D=t.cache.get(E);D||(D=new PointsMaterial,Material$1.prototype.copy.call(D,w),D.color.copy(w.color),D.map=w.map,D.lights=!1,t.cache.add(E,D)),w=D}else if(d.isLine){E="LineBasicMaterial:"+w.uuid;var F=t.cache.get(E);F||(F=new LineBasicMaterial,Material$1.prototype.copy.call(F,w),F.color.copy(w.color),F.lights=!1,t.cache.add(E,F)),w=F}if(M||T||A||C||L){E="ClonedMaterial:"+w.uuid+":";w.isGLTFSpecularGlossinessMaterial&&(E+="specular-glossiness:"),C&&(E+="skinning:"),M&&(E+="vertex-tangents:"),T&&(E+="vertex-colors:"),A&&(E+="flat-shading:"),L&&(E+="morph-targets:"),N&&(E+="morph-normals:");var I=t.cache.get(E);I||(I=w.isGLTFSpecularGlossinessMaterial?n[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(w):w.clone(),C&&(I.skinning=!0),M&&(I.vertexTangents=!0),T&&(I.vertexColors=VertexColors),A&&(I.flatShading=!0),L&&(I.morphTargets=!0),N&&(I.morphNormals=!0),t.cache.add(E,I)),w=I}S[P]=w,w.aoMap&&void 0===p.attributes.uv2&&void 0!==p.attributes.uv&&(console.log("GLTFLoader: Duplicating UVs to support aoMap."),p.addAttribute("uv2",new BufferAttribute(p.attributes.uv.array,2))),w.isGLTFSpecularGlossinessMaterial&&(d.onBeforeRender=n[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms)}d.material=l?S:S[0]}if(1===u.length)return u[0];var B=new Group;for(h=0,c=u.length;h<c;h++)B.add(u[h]);return B})})},V.prototype.loadCamera=function(e){var t,i=this.json.cameras[e],r=i[i.type];if(r)return"perspective"===i.type?t=new PerspectiveCamera(_Math.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===i.type&&(t=new OrthographicCamera(r.xmag/-2,r.xmag/2,r.ymag/2,r.ymag/-2,r.znear,r.zfar)),void 0!==i.name&&(t.name=i.name),O(t,i),Promise.resolve(t);console.warn("GLTFLoader: Missing camera parameters.")},V.prototype.loadSkin=function(e){var t=this.json.skins[e],i={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return i.inverseBindMatrices=e,i})},V.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],i=[],r=[],n=[],o=[],a=[],s=0,l=t.channels.length;s<l;s++){var u=t.channels[s],h=t.samplers[u.sampler],c=u.target,d=void 0!==c.node?c.node:c.id,f=void 0!==t.parameters?t.parameters[h.input]:h.input,m=void 0!==t.parameters?t.parameters[h.output]:h.output;i.push(this.getDependency("node",d)),r.push(this.getDependency("accessor",f)),n.push(this.getDependency("accessor",m)),o.push(h),a.push(c)}return Promise.all([Promise.all(i),Promise.all(r),Promise.all(n),Promise.all(o),Promise.all(a)]).then(function(i){for(var r=i[0],n=i[1],o=i[2],a=i[3],s=i[4],l=[],u=0,h=r.length;u<h;u++){var c=r[u],d=n[u],f=o[u],m=a[u],v=s[u];if(void 0!==c){var g;switch(c.updateMatrix(),c.matrixAutoUpdate=!0,A[v.path]){case A.weights:g=NumberKeyframeTrack;break;case A.rotation:g=QuaternionKeyframeTrack;break;case A.position:case A.scale:default:g=VectorKeyframeTrack}var y=c.name?c.name:c.uuid,_=void 0!==m.interpolation?C[m.interpolation]:InterpolateLinear,b=[];A[v.path]===A.weights?c.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&b.push(e.name?e.name:e.uuid)}):b.push(y);for(var x=0,w=b.length;x<w;x++){var S=new g(b[x]+"."+A[v.path],AnimationUtils.arraySlice(d.array,0),AnimationUtils.arraySlice(f.array,0),_);"CUBICSPLINE"===m.interpolation&&(S.createInterpolant=function(e){return new p(this.times,this.values,this.getValueSize()/3,e)},S.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(S)}}}return new AnimationClip(void 0!==t.name?t.name:"animation_"+e,void 0,l)})},V.prototype.loadNode=function(e){var t=this.json,r=this.extensions,n=this,o=t.meshReferences,a=t.meshUses,s=t.nodes[e];return(!0===s.isBone?Promise.resolve(new Bone):void 0!==s.mesh?n.getDependency("mesh",s.mesh).then(function(e){var t;if(o[s.mesh]>1){var i=a[s.mesh]++;(t=e.clone()).name+="_instance_"+i,t.onBeforeRender=e.onBeforeRender;for(var r=0,n=t.children.length;r<n;r++)t.children[r].name+="_instance_"+i,t.children[r].onBeforeRender=e.children[r].onBeforeRender}else t=e;return void 0!==s.weights&&t.traverse(function(e){if(e.isMesh)for(var t=0,i=s.weights.length;t<i;t++)e.morphTargetInfluences[t]=s.weights[t]}),t}):void 0!==s.camera?n.getDependency("camera",s.camera):s.extensions&&s.extensions[i.KHR_LIGHTS_PUNCTUAL]&&void 0!==s.extensions[i.KHR_LIGHTS_PUNCTUAL].light?n.getDependency("light",s.extensions[i.KHR_LIGHTS_PUNCTUAL].light):Promise.resolve(new Object3D)).then(function(e){if(void 0!==s.name&&(e.name=PropertyBinding.sanitizeNodeName(s.name)),O(e,s),s.extensions&&D(r,e,s),void 0!==s.matrix){var t=new Matrix4;t.fromArray(s.matrix),e.applyMatrix(t)}else void 0!==s.translation&&e.position.fromArray(s.translation),void 0!==s.rotation&&e.quaternion.fromArray(s.rotation),void 0!==s.scale&&e.scale.fromArray(s.scale);return e})},V.prototype.loadScene=function(){function e(t,i,r,n){var o=r.nodes[t];return n.getDependency("node",t).then(function(e){return void 0===o.skin?e:n.getDependency("skin",o.skin).then(function(e){for(var i=[],r=0,o=(t=e).joints.length;r<o;r++)i.push(n.getDependency("node",t.joints[r]));return Promise.all(i)}).then(function(i){for(var r=!0===e.isGroup?e.children:[e],n=0,o=r.length;n<o;n++){for(var a=r[n],s=[],l=[],u=0,h=i.length;u<h;u++){var c=i[u];if(c){s.push(c);var d=new Matrix4;void 0!==t.inverseBindMatrices&&d.fromArray(t.inverseBindMatrices.array,16*u),l.push(d)}else console.warn('GLTFLoader: Joint "%s" could not be found.',t.joints[u])}a.bind(new Skeleton(s,l),a.matrixWorld)}return e});var t}).then(function(t){i.add(t);var a=[];if(o.children)for(var s=o.children,l=0,u=s.length;l<u;l++){var h=s[l];a.push(e(h,t,r,n))}return Promise.all(a)})}return function(t){var i=this.json,r=this.extensions,n=this.json.scenes[t],o=new Scene;void 0!==n.name&&(o.name=n.name),O(o,n),n.extensions&&D(r,o,n);for(var a=n.nodes||[],s=[],l=0,u=a.length;l<u;l++)s.push(e(a[l],o,i,this));return Promise.all(s).then(function(){return o})}}(),e}(),RGBELoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager,this.type=UnsignedByteType};RGBELoader.prototype=Object.create(DataTextureLoader.prototype),RGBELoader.prototype._parser=function(e){var t=function(e,t){switch(e){case 1:console.error("RGBELoader Read Error: "+(t||""));break;case 2:console.error("RGBELoader Write Error: "+(t||""));break;case 3:console.error("RGBELoader Bad File Format: "+(t||""));break;default:case 4:console.error("RGBELoader: Error: "+(t||""))}return-1},i=function(e,t,i){t=t||1024;for(var r=e.pos,n=-1,o=0,a="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));0>(n=s.indexOf("\n"))&&o<t&&r<e.byteLength;)a+=s,o+=s.length,r+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));return-1<n&&(!1!==i&&(e.pos+=o+n+1),a+s.slice(0,n))},r=new Uint8Array(e);r.pos=0;var n,o,a,s,l,u,h=function(e){var r,n,o=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,l=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,u={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(r=i(e)))return t(1,"no header found");if(!(n=r.match(/^#\?(\S+)$/)))return t(3,"bad initial token");for(u.valid|=1,u.programtype=n[1],u.string+=r+"\n";!1!==(r=i(e));)if(u.string+=r+"\n","#"!==r.charAt(0)){if((n=r.match(o))&&(u.gamma=parseFloat(n[1],10)),(n=r.match(a))&&(u.exposure=parseFloat(n[1],10)),(n=r.match(s))&&(u.valid|=2,u.format=n[1]),(n=r.match(l))&&(u.valid|=4,u.height=parseInt(n[1],10),u.width=parseInt(n[2],10)),2&u.valid&&4&u.valid)break}else u.comments+=r+"\n";return 2&u.valid?4&u.valid?u:t(3,"missing image size specifier"):t(3,"missing format specifier")}(r);if(-1!==h){var c=h.width,d=h.height,p=function(e,i,r){var n,o,a,s,l,u,h,c,d,p,f,m,v,g=i,y=r;if(g<8||g>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(g!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");if(!(n=new Uint8Array(4*i*r))||!n.length)return t(4,"unable to allocate buffer space");for(o=0,a=0,c=4*g,v=new Uint8Array(4),u=new Uint8Array(c);y>0&&a<e.byteLength;){if(a+4>e.byteLength)return t(1);if(v[0]=e[a++],v[1]=e[a++],v[2]=e[a++],v[3]=e[a++],2!=v[0]||2!=v[1]||(v[2]<<8|v[3])!=g)return t(3,"bad rgbe scanline format");for(h=0;h<c&&a<e.byteLength;){if((m=(s=e[a++])>128)&&(s-=128),0===s||h+s>c)return t(3,"bad scanline data");if(m)for(l=e[a++],d=0;d<s;d++)u[h++]=l;else u.set(e.subarray(a,a+s),h),h+=s,a+=s}for(p=g,d=0;d<p;d++)f=0,n[o]=u[d+f],f+=g,n[o+1]=u[d+f],f+=g,n[o+2]=u[d+f],f+=g,n[o+3]=u[d+f],o+=4;y--}return n}(r.subarray(r.pos),c,d);if(-1!==p){if(this.type===UnsignedByteType)var f=p,m=RGBEFormat,v=UnsignedByteType;else if(this.type===FloatType){for(var g=p.length/4*3,y=new Float32Array(g),_=0;_<g;_++)a=y,s=3*_,l=void 0,u=void 0,l=(n=p)[(o=4*_)+3],u=Math.pow(2,l-128)/255,a[s+0]=n[o+0]*u,a[s+1]=n[o+1]*u,a[s+2]=n[o+2]*u;f=y,m=RGBFormat,v=FloatType}else console.error("RGBELoader: unsupported type: ",this.type);return{width:c,height:d,data:f,header:h.string,gamma:h.gamma,exposure:h.exposure,format:m,type:v}}}return null};var HDRLoader=RGBELoader;function CubeTexture(e,t,i,r,n,o,a,s,l,u){e=void 0!==e?e:[],t=void 0!==t?t:CubeReflectionMapping,a=void 0!==a?a:RGBFormat,Texture.call(this,e,t,i,r,n,o,a,s,l,u),this.flipY=!1}RGBELoader.prototype.setType=function(e){return this.type=e,this},CubeTexture.prototype=Object.create(Texture.prototype),CubeTexture.prototype.constructor=CubeTexture,CubeTexture.prototype.isCubeTexture=!0,Object.defineProperty(CubeTexture.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});var HDRCubeTextureLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager,this.hdrLoader=new RGBELoader};HDRCubeTextureLoader.prototype.load=function(e,t,i,r,n){var o=function(e,t,i,r){var n=e[t+3],o=Math.pow(2,n-128)/255;i[r+0]=e[t+0]*o,i[r+1]=e[t+1]*o,i[r+2]=e[t+2]*o},a=function(){var e=new Float32Array(1),t=new Int32Array(e.buffer);function i(i){e[0]=i;var r=t[0],n=r>>16&32768,o=r>>12&2047,a=r>>23&255;return a<103?n:a>142?(n|=31744,n|=(255==a?0:1)&&8388607&r):a<113?n|=((o|=2048)>>114-a)+(o>>113-a&1):(n|=a-112<<10|o>>1,n+=1&o)}return function(e,t,r,n){var o=e[t+3],a=Math.pow(2,o-128)/255;r[n+0]=i(e[t+0]*a),r[n+1]=i(e[t+1]*a),r[n+2]=i(e[t+2]*a)}}(),s=new CubeTexture;s.type=e,s.encoding=e===UnsignedByteType?RGBEEncoding:LinearEncoding,s.format=e===UnsignedByteType?RGBAFormat:RGBFormat,s.minFilter=s.encoding===RGBEEncoding?NearestFilter:LinearFilter,s.magFilter=s.encoding===RGBEEncoding?NearestFilter:LinearFilter,s.generateMipmaps=s.encoding!==RGBEEncoding,s.anisotropy=0;var l=this,u=0;function h(i,r,n,h){var c=new FileLoader(l.manager);c.setPath(l.path),c.setResponseType("arraybuffer"),c.load(t[i],function(t){u++;var n=l.hdrLoader._parser(t);if(n){if(e===FloatType){for(var h=n.data.length/4*3,c=new Float32Array(h),d=0;d<h;d++)o(n.data,4*d,c,3*d);n.data=c}else if(e===HalfFloatType){h=n.data.length/4*3;var p=new Uint16Array(h);for(d=0;d<h;d++)a(n.data,4*d,p,3*d);n.data=p}if(void 0!==n.image)s[i].images=n.image;else if(void 0!==n.data){var f=new DataTexture(n.data,n.width,n.height);f.format=s.format,f.type=s.type,f.encoding=s.encoding,f.minFilter=s.minFilter,f.magFilter=s.magFilter,f.generateMipmaps=s.generateMipmaps,s.images[i]=f}6===u&&(s.needsUpdate=!0,r&&r(s))}},n,h)}for(var c=0;c<t.length;c++)h(c,i,r,n);return s},HDRCubeTextureLoader.prototype.setPath=function(e){return this.path=e,this};var KMZLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager};KMZLoader.prototype={constructor:KMZLoader,load:function(e,t,i,r){var n=this,o=new FileLoader(n.manager);o.setPath(n.path),o.setResponseType("arraybuffer"),o.load(e,function(e){t(n.parse(e))},i,r)},setPath:function(e){return this.path=e,this},parse:function(e){var t=new LoadingManager;t.setURLModifier(function(e){var t=function(e){for(var t in i.files)if(t.substr(-e.length)===e)return i.files[t]}(e);if(t){console.log("Loading",e);var r=new Blob([t.asArrayBuffer()],{type:"application/octet-stream"});return URL.createObjectURL(r)}return e});var i=new JSZip(e);if(i.files["doc.kml"]){var r=(new DOMParser).parseFromString(i.files["doc.kml"].asText(),"application/xml").querySelector("Placemark Model Link href");if(r)return new ColladaLoader(t).parse(i.files[r.textContent].asText())}else for(var n in console.warn("KMZLoader: Missing doc.kml file."),i.files){if("dae"===n.split(".").pop().toLowerCase())return new ColladaLoader(t).parse(i.files[n].asText())}return console.error("KMZLoader: Couldn't find .dae file."),{scene:new Group}}};var KTXLoader=function(e){CompressedTextureLoader.call(this,e),this._parser=KTXLoader.parse};KTXLoader.prototype=Object.create(CompressedTextureLoader.prototype),KTXLoader.prototype.constructor=KTXLoader,KTXLoader.parse=function(e,t){var i=new KhronosTextureContainer(e,1);return{mipmaps:i.mipmaps(t),width:i.pixelWidth,height:i.pixelHeight,format:i.glInternalFormat,isCubemap:6===i.numberOfFaces,mipmapCount:i.numberOfMipmapLevels}};var KhronosTextureContainer=function(){function e(t,i,r,n){this.arrayBuffer=t;var o=new Uint8Array(this.arrayBuffer,0,12);if(171===o[0]&&75===o[1]&&84===o[2]&&88===o[3]&&32===o[4]&&49===o[5]&&49===o[6]&&187===o[7]&&13===o[8]&&10===o[9]&&26===o[10]&&10===o[11]){var a=Uint32Array.BYTES_PER_ELEMENT,s=new DataView(this.arrayBuffer,12,13*a),l=67305985===s.getUint32(0,!0);this.glType=s.getUint32(1*a,l),this.glTypeSize=s.getUint32(2*a,l),this.glFormat=s.getUint32(3*a,l),this.glInternalFormat=s.getUint32(4*a,l),this.glBaseInternalFormat=s.getUint32(5*a,l),this.pixelWidth=s.getUint32(6*a,l),this.pixelHeight=s.getUint32(7*a,l),this.pixelDepth=s.getUint32(8*a,l),this.numberOfArrayElements=s.getUint32(9*a,l),this.numberOfFaces=s.getUint32(10*a,l),this.numberOfMipmapLevels=s.getUint32(11*a,l),this.bytesOfKeyValueData=s.getUint32(12*a,l),0===this.glType?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===i?this.loadType=e.COMPRESSED_2D:console.warn("number of faces expected"+i+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}else console.error("texture missing KTX identifier")}return e.prototype.mipmaps=function(t){for(var i=[],r=e.HEADER_LEN+this.bytesOfKeyValueData,n=this.pixelWidth,o=this.pixelHeight,a=t?this.numberOfMipmapLevels:1,s=0;s<a;s++){for(var l=new Int32Array(this.arrayBuffer,r,1)[0],u=0;u<this.numberOfFaces;u++){var h=new Uint8Array(this.arrayBuffer,r+4,l);i.push({data:h,width:n,height:o}),r+=l+4,r+=3-(l+3)%4}n=Math.max(1,.5*n),o=Math.max(1,.5*o)}return i},e.HEADER_LEN=64,e.COMPRESSED_2D=0,e.COMPRESSED_3D=1,e.TEX_2D=2,e.TEX_3D=3,e}(),LDrawLoader=function(){function e(e,t){this.line=e,this.lineLength=e.length,this.currentCharIndex=0,this.currentChar=" ",this.lineNumber=t}function t(e,t){return e.colourCode===t.colourCode?0:e.colourCode<t.colourCode?-1:1}function i(e,i){e.sort(t);var r=[],n=[],o=new BufferGeometry;o.clearGroups();for(var a=null,s=0,l=0,u=0,h=e.length;u<h;u++){var c=e[u],d=c.v0,p=c.v1;r.push(d.x,d.y,d.z,p.x,p.y,p.z),3===i&&r.push(c.v2.x,c.v2.y,c.v2.z),a!==c.material?(null!==a&&o.addGroup(s,l,n.length-1),n.push(c.material),a=c.material,s=u*i,l=i):l+=i}l>0&&o.addGroup(s,1/0,n.length-1),o.addAttribute("position",new Float32BufferAttribute(r,3));var f=null;return 2===i?f=new LineSegments(o,n):3===i&&(o.computeVertexNormals(),f=new Mesh(o,n)),f}function r(t){this.manager=void 0!==t?t:DefaultLoadingManager,this.parseScopesStack=null,this.path="",this.materials=[],this.subobjectCache={},this.fileMap=null,this.setMaterials([this.parseColourMetaDirective(new e("Main_Colour CODE 16 VALUE #FF8080 EDGE #333333")),this.parseColourMetaDirective(new e("Edge_Colour CODE 24 VALUE #A0A0A0 EDGE #333333"))]),this.separateObjects=!1,this.currentGroupObject=null,this.currentTriangles=null,this.currentLineSegments=null}return e.prototype={constructor:e,seekNonSpace:function(){for(;this.currentCharIndex<this.lineLength;){if(this.currentChar=this.line.charAt(this.currentCharIndex)," "!==this.currentChar&&"\t"!==this.currentChar)return;this.currentCharIndex++}},getToken:function(){for(var e=this.currentCharIndex++;this.currentCharIndex<this.lineLength&&(this.currentChar=this.line.charAt(this.currentCharIndex)," "!==this.currentChar&&"\t"!==this.currentChar);)this.currentCharIndex++;var t=this.currentCharIndex;return this.seekNonSpace(),this.line.substring(e,t)},getRemainingString:function(){return this.line.substring(this.currentCharIndex,this.lineLength)},isAtTheEnd:function(){return this.currentCharIndex>=this.lineLength},setToEnd:function(){this.currentCharIndex=this.lineLength},getLineNumberString:function(){return this.lineNumber>=0?" at line "+this.lineNumber:""}},r.FINISH_TYPE_DEFAULT=0,r.FINISH_TYPE_CHROME=1,r.FINISH_TYPE_PEARLESCENT=2,r.FINISH_TYPE_RUBBER=3,r.FINISH_TYPE_MATTE_METALLIC=4,r.FINISH_TYPE_METAL=5,r.FILE_LOCATION_AS_IS=0,r.FILE_LOCATION_TRY_PARTS=1,r.FILE_LOCATION_TRY_P=2,r.FILE_LOCATION_TRY_MODELS=3,r.FILE_LOCATION_TRY_RELATIVE=4,r.FILE_LOCATION_TRY_ABSOLUTE=5,r.FILE_LOCATION_NOT_FOUND=6,r.prototype={constructor:r,load:function(e,t,n,o){this.fileMap||(this.fileMap={});var a=this,s=new FileLoader(this.manager);s.setPath(this.path),s.load(e,function(n){!function t(n,o){var s=a.newParseScopeLevel();s.url=e;var l=a.getParentParseScope();var u=l.currentFileName;void 0===a.subobjectCache[u]&&(a.subobjectCache[u]=n);var h=a.parse(n);s.subobjects=h.userData.subobjects;s.numSubobjects=s.subobjects.length;s.subobjectIndex=0;if(s.numSubobjects>0){var c=p(s.subobjects[0],!0);if(c){for(;c&&s.subobjectIndex<s.numSubobjects-1;)c=p(s.subobjects[++s.subobjectIndex],!0);c&&d()}}else d();return h;function d(){a.separateObjects||l.isFromParse||(a.currentLineSegments.length>0&&h.add(i(a.currentLineSegments,2)),a.currentTriangles.length>0&&h.add(i(a.currentTriangles,3))),a.removeScopeLevel(),o&&o(h)}function p(i,n){s.mainColourCode=i.material.userData.code,s.mainEdgeColourCode=i.material.userData.edgeMaterial.userData.code,s.currentFileName=i.originalFileName,a.separateObjects||s.currentMatrix.multiplyMatrices(l.currentMatrix,i.matrix);var u=a.subobjectCache[i.originalFileName];if(u){var c=t(u,n?void 0:f);return n?(m(i,c),c):void 0}var d=i.fileName,g=r.FILE_LOCATION_NOT_FOUND;switch(i.locationState){case r.FILE_LOCATION_AS_IS:g=i.locationState+1;break;case r.FILE_LOCATION_TRY_PARTS:d="parts/"+d,g=i.locationState+1;break;case r.FILE_LOCATION_TRY_P:d="p/"+d,g=i.locationState+1;break;case r.FILE_LOCATION_TRY_MODELS:d="models/"+d,g=i.locationState+1;break;case r.FILE_LOCATION_TRY_RELATIVE:d=e.substring(0,e.lastIndexOf("/")+1)+d,g=i.locationState+1;break;case r.FILE_LOCATION_TRY_ABSOLUTE:i.triedLowerCase?g=r.FILE_LOCATION_NOT_FOUND:(i.fileName=i.fileName.toLowerCase(),d=i.fileName,i.triedLowerCase=!0,g=r.FILE_LOCATION_AS_IS);break;case r.FILE_LOCATION_NOT_FOUND:return console.warn('LDrawLoader: Subobject "'+i.originalFileName+'" could not be found.'),s.subobjectIndex++,void(s.subobjectIndex>=s.numSubobjects?(a.removeScopeLevel(),o(h)):p(s.subobjects[s.subobjectIndex]))}i.locationState=g,i.url=d,a.load(d,f,void 0,v)}function f(e){var t=s.subobjects[s.subobjectIndex];null!==e?(m(t,e),s.subobjectIndex++,s.subobjectIndex<s.numSubobjects?p(s.subobjects[s.subobjectIndex]):d()):p(t)}function m(e,t){a.separateObjects&&(t.name=e.fileName,h.add(t),t.matrix.copy(e.matrix),t.matrixAutoUpdate=!1),a.fileMap[e.originalFileName]=e.url}function v(e){p(s.subobjects[s.subobjectIndex])}}(n,t)},n,o)},setPath:function(e){return this.path=e,this},setMaterials:function(e){return this.parseScopesStack=[],this.newParseScopeLevel(e),this.getCurrentParseScope().isFromParse=!1,this.materials=e,this.currentGroupObject=null,this},setFileMap:function(e){return this.fileMap=e,this},newParseScopeLevel:function(e){var t={};if(e)for(var i=0,r=e.length;i<r;i++){var n=e[i];t[n.userData.code]=n}var o=this.getCurrentParseScope(),a=(this.getParentParseScope(),{lib:t,url:null,subobjects:null,numSubobjects:0,subobjectIndex:0,currentFileName:null,mainColourCode:o?o.mainColourCode:"16",mainEdgeColourCode:o?o.mainEdgeColourCode:"24",currentMatrix:new Matrix4,isFromParse:!0});return this.parseScopesStack.push(a),a},removeScopeLevel:function(){return this.parseScopesStack.pop(),this},addMaterial:function(e){var t=this.getCurrentParseScope().lib;return t[e.userData.code]||this.materials.push(e),t[e.userData.code]=e,this},getMaterial:function(t){if(t.startsWith("0x2")){var i=t.substring(3);return this.parseColourMetaDirective(new e("Direct_Color_"+i+" CODE -1 VALUE #"+i+" EDGE #"+i))}for(var r=this.parseScopesStack.length-1;r>=0;r--){var n=this.parseScopesStack[r].lib[t];if(n)return n}return null},getParentParseScope:function(){return this.parseScopesStack.length>1?this.parseScopesStack[this.parseScopesStack.length-2]:null},getCurrentParseScope:function(){return this.parseScopesStack.length>0?this.parseScopesStack[this.parseScopesStack.length-1]:null},parseColourMetaDirective:function(e){var t=null,i=16711935,n=16711935,o=1,a=!1,s=0,l=r.FINISH_TYPE_DEFAULT,u=!0,h=null,c=e.getToken();if(!c)throw'LDrawLoader: Material name was expected after "!COLOUR tag'+e.getLineNumberString()+".";for(var d=null;d=e.getToken();)switch(d.toUpperCase()){case"CODE":t=e.getToken();break;case"VALUE":if((i=e.getToken()).startsWith("0x"))i="#"+i.substring(2);else if(!i.startsWith("#"))throw"LDrawLoader: Invalid colour while parsing material"+e.getLineNumberString()+".";break;case"EDGE":if((n=e.getToken()).startsWith("0x"))n="#"+n.substring(2);else if(!n.startsWith("#")){if(!(h=this.getMaterial(n)))throw"LDrawLoader: Invalid edge colour while parsing material"+e.getLineNumberString()+".";h=h.userData.edgeMaterial}break;case"ALPHA":if(o=parseInt(e.getToken()),isNaN(o))throw"LDrawLoader: Invalid alpha value in material definition"+e.getLineNumberString()+".";(o=Math.max(0,Math.min(1,o/255)))<1&&(a=!0);break;case"LUMINANCE":if(s=parseInt(e.getToken()),isNaN(s))throw"LDrawLoader: Invalid luminance value in material definition"+e.getLineNumberString()+".";s=Math.max(0,Math.min(1,s/255));break;case"CHROME":l=r.FINISH_TYPE_CHROME;break;case"PEARLESCENT":l=r.FINISH_TYPE_PEARLESCENT;break;case"RUBBER":l=r.FINISH_TYPE_RUBBER;break;case"MATTE_METALLIC":l=r.FINISH_TYPE_MATTE_METALLIC;break;case"METAL":l=r.FINISH_TYPE_METAL;break;case"MATERIAL":e.setToEnd();break;default:throw'LDrawLoader: Unknown token "'+d+'" while parsing material'+e.getLineNumberString()+"."}var p=null;switch(l){case r.FINISH_TYPE_DEFAULT:case r.FINISH_TYPE_PEARLESCENT:var f=new Color(i),m=35,v=f.getHSL({h:0,s:0,l:0});l===r.FINISH_TYPE_DEFAULT?v.l=Math.min(1,v.l+.12*(1-v.l)):(v.h=(v.h+.5)%1,v.l=Math.min(1,v.l+.7*(1-v.l)),m=10),f.setHSL(v.h,v.s,v.l),p=new MeshPhongMaterial({color:i,specular:f,shininess:m,reflectivity:.3});break;case r.FINISH_TYPE_CHROME:p=new MeshStandardMaterial({color:i,roughness:0,metalness:1});break;case r.FINISH_TYPE_RUBBER:p=new MeshLambertMaterial({color:i}),u=!1;break;case r.FINISH_TYPE_MATTE_METALLIC:p=new MeshStandardMaterial({color:i,roughness:.8,metalness:.4});break;case r.FINISH_TYPE_METAL:p=new MeshStandardMaterial({color:i,roughness:.2,metalness:.85})}return p.side=DoubleSide,p.transparent=a,p.opacity=o,p.userData.canHaveEnvMap=u,0!==s&&p.emissive.set(p.color).multiplyScalar(s),h||((h=new LineBasicMaterial({color:n})).userData.code=t,h.name=c+" - Edge",h.userData.canHaveEnvMap=!1),p.userData.code=t,p.name=c,p.userData.edgeMaterial=h,p},parse:function(t){var n,o,a=this.getParentParseScope(),s=a.mainColourCode,l=a.mainEdgeColourCode;a.url,this.getCurrentParseScope();this.separateObjects?(n=[],o=[]):(null===this.currentGroupObject&&(this.currentGroupObject=new Group,this.currentTriangles=[],this.currentLineSegments=[]),n=this.currentTriangles,o=this.currentLineSegments);var u=[],h=null,c=null;-1!==t.indexOf("\r\n")&&(t=t.replace(/\r\n/g,"\n"));var d=t.split("\n"),p=d.length,f=0,m=!1,v=null,g=null,y=this;function _(e,t){var i=e.getToken();t||"16"!==i||(i=s),t&&"24"===i&&(i=l);var r=y.getMaterial(i);if(!r)throw'LDrawLoader: Unknown colour code "'+i+'" is used'+e.getLineNumberString()+" but it was not defined previously.";return r}function b(e){var t=new Vector3(parseFloat(e.getToken()),parseFloat(e.getToken()),parseFloat(e.getToken()));return y.separateObjects||t.applyMatrix4(a.currentMatrix),t}for(f=0;f<p;f++){var x=d[f];if(0!==x.length)if(m)x.startsWith("0 FILE ")?(this.subobjectCache[v]=g,v=x.substring(7),g=""):g+=x+"\n";else{var w=new e(x,f+1);if(w.seekNonSpace(),!w.isAtTheEnd()){var S=w.getToken();switch(S){case"0":var M=w.getToken();if(M)switch(M){case"!COLOUR":(A=this.parseColourMetaDirective(w))?this.addMaterial(A):console.warn("LDrawLoader: Error parsing material"+w.getLineNumberString());break;case"!CATEGORY":h=w.getToken();break;case"!KEYWORDS":var T=w.getRemainingString().split(",");T.length>0&&(c||(c=[]),T.forEach(function(e){c.push(e.trim())}));break;case"FILE":f>0&&(m=!0,v=w.getRemainingString(),g="")}break;case"1":var A=_(w),C=parseFloat(w.getToken()),L=parseFloat(w.getToken()),N=parseFloat(w.getToken()),P=parseFloat(w.getToken()),k=parseFloat(w.getToken()),E=parseFloat(w.getToken()),D=parseFloat(w.getToken()),O=parseFloat(w.getToken()),R=parseFloat(w.getToken()),F=parseFloat(w.getToken()),I=parseFloat(w.getToken()),B=parseFloat(w.getToken()),U=(new Matrix4).set(P,k,E,C,D,O,R,L,F,I,B,N,0,0,0,1),V=w.getRemainingString().trim().replace("\\","/");y.fileMap[V]?V=y.fileMap[V]:V.startsWith("s/")?V="parts/"+V:V.startsWith("48/")&&(V="p/"+V),u.push({material:A,matrix:U,fileName:V,originalFileName:V,locationState:r.FILE_LOCATION_AS_IS,url:null,triedLowerCase:!1});break;case"2":A=_(w,!0);o.push({material:A.userData.edgeMaterial,colourCode:A.userData.code,v0:b(w),v1:b(w)});break;case"3":A=_(w);n.push({material:A,colourCode:A.userData.code,v0:b(w),v1:b(w),v2:b(w)});break;case"4":A=_(w);var z=b(w),G=b(w),j=b(w),W=b(w);n.push({material:A,colourCode:A.userData.code,v0:z,v1:G,v2:j}),n.push({material:A,colourCode:A.userData.code,v0:z,v1:j,v2:W});break;case"5":break;default:throw'LDrawLoader: Unknown line type "'+S+'"'+w.getLineNumberString()+"."}}}}m&&(this.subobjectCache[v]=g);var H=null;return this.separateObjects?(H=new Group,o.length>0&&H.add(i(o,2)),n.length>0&&H.add(i(n,3))):H=this.currentGroupObject,H.userData.category=h,H.userData.keywords=c,H.userData.subobjects=u,H}},r}(),LoaderSupport={Validator:{isValid:function(e){return null!=e},verifyInput:function(e,t){return null==e?t:e}},Callbacks:function(){this.onProgress=null,this.onReportError=null,this.onMeshAlter=null,this.onLoad=null,this.onLoadMaterials=null}};LoaderSupport.Callbacks.prototype={constructor:LoaderSupport.Callbacks,setCallbackOnProgress:function(e){this.onProgress=LoaderSupport.Validator.verifyInput(e,this.onProgress)},setCallbackOnReportError:function(e){this.onReportError=LoaderSupport.Validator.verifyInput(e,this.onReportError)},setCallbackOnMeshAlter:function(e){this.onMeshAlter=LoaderSupport.Validator.verifyInput(e,this.onMeshAlter)},setCallbackOnLoad:function(e){this.onLoad=LoaderSupport.Validator.verifyInput(e,this.onLoad)},setCallbackOnLoadMaterials:function(e){this.onLoadMaterials=LoaderSupport.Validator.verifyInput(e,this.onLoadMaterials)}},LoaderSupport.LoadedMeshUserOverride=function(e,t){this.disregardMesh=!0===e,this.alteredMesh=!0===t,this.meshes=[]},LoaderSupport.LoadedMeshUserOverride.prototype={constructor:LoaderSupport.LoadedMeshUserOverride,addMesh:function(e){this.meshes.push(e),this.alteredMesh=!0},isDisregardMesh:function(){return this.disregardMesh},providesAlteredMeshes:function(){return this.alteredMesh}},LoaderSupport.ResourceDescriptor=function(e,t){var i=e.split("/");this.path,this.resourcePath,this.name=e,this.url=e,i.length>=2&&(this.path=LoaderSupport.Validator.verifyInput(i.slice(0,i.length-1).join("/")+"/",this.path),this.name=i[i.length-1],this.url=e),this.name=LoaderSupport.Validator.verifyInput(this.name,"Unnamed_Resource"),this.extension=LoaderSupport.Validator.verifyInput(t,"default"),this.extension=this.extension.trim(),this.content=null},LoaderSupport.ResourceDescriptor.prototype={constructor:LoaderSupport.ResourceDescriptor,setContent:function(e){this.content=LoaderSupport.Validator.verifyInput(e,null)},setResourcePath:function(e){this.resourcePath=LoaderSupport.Validator.verifyInput(e,this.resourcePath)}},LoaderSupport.PrepData=function(e){this.logging={enabled:!0,debug:!1},this.modelName=LoaderSupport.Validator.verifyInput(e,""),this.resources=[],this.callbacks=new LoaderSupport.Callbacks},LoaderSupport.PrepData.prototype={constructor:LoaderSupport.PrepData,setLogging:function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},getCallbacks:function(){return this.callbacks},addResource:function(e){this.resources.push(e)},clone:function(){var e,t,i=new LoaderSupport.PrepData(this.modelName);for(e in i.logging.enabled=this.logging.enabled,i.logging.debug=this.logging.debug,i.resources=this.resources,i.callbacks=this.callbacks,this)t=this[e],i.hasOwnProperty(e)||"function"==typeof this[e]||(i[e]=t);return i},checkResourceDescriptorFiles:function(e,t){var i,r,n,o,a={};for(var s in e)if(i=e[s],o=!1,LoaderSupport.Validator.isValid(i.name))if(LoaderSupport.Validator.isValid(i.content)){for(n=0;n<t.length&&!o;n++)if(r=t[n],i.extension.toLowerCase()===r.ext.toLowerCase())if(r.ignore)o=!0;else if("ArrayBuffer"===r.type){if(!(i.content instanceof ArrayBuffer||i.content instanceof Uint8Array))throw"Provided content is not of type ArrayBuffer! Aborting...";a[r.ext]=i,o=!0}else if("String"===r.type){if(!("string"==typeof i.content||i.content instanceof String))throw"Provided  content is not of type String! Aborting...";a[r.ext]=i,o=!0}if(!o)throw'Unidentified resource "'+i.name+'": '+i.url}else{if(!("string"==typeof i.name||i.name instanceof String))throw"Provided file is not properly defined! Aborting...";for(n=0;n<t.length&&!o;n++)r=t[n],i.extension.toLowerCase()===r.ext.toLowerCase()&&(r.ignore||(a[r.ext]=i),o=!0);if(!o)throw'Unidentified resource "'+i.name+'": '+i.url}return a}},LoaderSupport.MeshBuilder=function(){console.info("Using LoaderSupport.MeshBuilder version: "+LoaderSupport.MeshBuilder.LOADER_MESH_BUILDER_VERSION),this.validator=LoaderSupport.Validator,this.logging={enabled:!0,debug:!1},this.callbacks=new LoaderSupport.Callbacks,this.materials=[]},LoaderSupport.MeshBuilder.LOADER_MESH_BUILDER_VERSION="1.3.0",LoaderSupport.MeshBuilder.prototype={constructor:LoaderSupport.MeshBuilder,setLogging:function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},init:function(){var e=new MeshStandardMaterial({color:14479871});e.name="defaultMaterial";var t=new MeshStandardMaterial({color:14479871});t.name="defaultVertexColorMaterial",t.vertexColors=VertexColors;var i=new LineBasicMaterial;i.name="defaultLineMaterial";var r=new PointsMaterial({size:1});r.name="defaultPointMaterial";var n={};n[e.name]=e,n[t.name]=t,n[i.name]=i,n[r.name]=r,this.updateMaterials({cmd:"materialData",materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:n}})},setMaterials:function(e){var t={cmd:"materialData",materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:this.validator.isValid(this.callbacks.onLoadMaterials)?this.callbacks.onLoadMaterials(e):e}};this.updateMaterials(t)},_setCallbacks:function(e){this.validator.isValid(e.onProgress)&&this.callbacks.setCallbackOnProgress(e.onProgress),this.validator.isValid(e.onReportError)&&this.callbacks.setCallbackOnReportError(e.onReportError),this.validator.isValid(e.onMeshAlter)&&this.callbacks.setCallbackOnMeshAlter(e.onMeshAlter),this.validator.isValid(e.onLoad)&&this.callbacks.setCallbackOnLoad(e.onLoad),this.validator.isValid(e.onLoadMaterials)&&this.callbacks.setCallbackOnLoadMaterials(e.onLoadMaterials)},processPayload:function(e){return"meshData"===e.cmd?this.buildMeshes(e):"materialData"===e.cmd?(this.updateMaterials(e),null):void 0},buildMeshes:function(e){var t,i,r,n=e.params.meshName,o=new BufferGeometry;o.addAttribute("position",new BufferAttribute(new Float32Array(e.buffers.vertices),3)),this.validator.isValid(e.buffers.indices)&&o.setIndex(new BufferAttribute(new Uint32Array(e.buffers.indices),1)),this.validator.isValid(e.buffers.colors)&&o.addAttribute("color",new BufferAttribute(new Float32Array(e.buffers.colors),3)),this.validator.isValid(e.buffers.normals)?o.addAttribute("normal",new BufferAttribute(new Float32Array(e.buffers.normals),3)):o.computeVertexNormals(),this.validator.isValid(e.buffers.uvs)&&o.addAttribute("uv",new BufferAttribute(new Float32Array(e.buffers.uvs),2));var a=e.materials.materialNames,s=e.materials.multiMaterial,l=[];for(r in a)i=a[r],t=this.materials[i],s&&l.push(t);if(s){t=l;var u,h=e.materials.materialGroups;for(r in h)u=h[r],o.addGroup(u.start,u.count,u.index)}var c,d,p,f=[],m=this.callbacks.onMeshAlter,v=!0,g=this.validator.verifyInput(e.geometryType,0);if(this.validator.isValid(m)&&(d=m({detail:{meshName:n,bufferGeometry:o,material:t,geometryType:g}}),this.validator.isValid(d)))if(d.isDisregardMesh())v=!1;else if(d.providesAlteredMeshes()){for(var y in d.meshes)f.push(d.meshes[y]);v=!1}if(v&&(e.computeBoundingSphere&&o.computeBoundingSphere(),(c=0===g?new Mesh(o,t):1===g?new LineSegments(o,t):new Points(o,t)).name=n,f.push(c)),this.validator.isValid(f)&&f.length>0){var _=[];for(var y in f)c=f[y],_[y]=c.name;p="Adding mesh(es) ("+_.length+": "+_+") from input mesh: "+n,p+=" ("+(100*e.progress.numericalValue).toFixed(2)+"%)"}else p="Not adding mesh: "+n,p+=" ("+(100*e.progress.numericalValue).toFixed(2)+"%)";var b=this.callbacks.onProgress;this.validator.isValid(b)&&b(new CustomEvent("MeshBuilderEvent",{detail:{type:"progress",modelName:e.params.meshName,text:p,numericalValue:e.progress.numericalValue}}));return f},updateMaterials:function(e){var t,i,r=e.materials.materialCloneInstructions;if(this.validator.isValid(r)){var n=r.materialNameOrg,o=this.materials[n];if(this.validator.isValid(n)){t=o.clone(),i=r.materialName,t.name=i;var a=r.materialProperties;for(var s in a)t.hasOwnProperty(s)&&a.hasOwnProperty(s)&&(t[s]=a[s]);this.materials[i]=t}else console.warn('Requested material "'+n+'" is not available!')}var l=e.materials.serializedMaterials;if(this.validator.isValid(l)&&Object.keys(l).length>0){var u,h=new MaterialLoader;for(i in l)u=l[i],this.validator.isValid(u)&&(t=h.parse(u),this.logging.enabled&&console.info('De-serialized material with name "'+i+'" will be added.'),this.materials[i]=t)}if(l=e.materials.runtimeMaterials,this.validator.isValid(l)&&Object.keys(l).length>0)for(i in l)t=l[i],this.logging.enabled&&console.info('Material with name "'+i+'" will be added.'),this.materials[i]=t},getMaterialsJSON:function(){var e,t={};for(var i in this.materials)e=this.materials[i],t[i]=e.toJSON();return t},getMaterials:function(){return this.materials}},LoaderSupport.WorkerSupport=function(){console.info("Using LoaderSupport.WorkerSupport version: "+LoaderSupport.WorkerSupport.WORKER_SUPPORT_VERSION),this.logging={enabled:!0,debug:!1},this.loaderWorker="undefined"!=typeof window?new LoaderSupport.WorkerSupport.LoaderWorker:new LoaderSupport.WorkerSupport.NodeLoaderWorker},LoaderSupport.WorkerSupport.WORKER_SUPPORT_VERSION="2.3.0",LoaderSupport.WorkerSupport.prototype={constructor:LoaderSupport.WorkerSupport,setLogging:function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t,this.loaderWorker.setLogging(this.logging.enabled,this.logging.debug)},setForceWorkerDataCopy:function(e){this.loaderWorker.setForceCopy(e)},validate:function(e,t,i,r,n){if(!LoaderSupport.Validator.isValid(this.loaderWorker.worker)){this.logging.enabled&&(console.info("WorkerSupport: Building worker code..."),console.time("buildWebWorkerCode")),LoaderSupport.Validator.isValid(n)?this.logging.enabled&&console.info('WorkerSupport: Using "'+n.runnerName+'" as Runner class for worker.'):"undefined"!=typeof window?(n=LoaderSupport.WorkerRunnerRefImpl,this.logging.enabled&&console.info('WorkerSupport: Using DEFAULT "LoaderSupport.WorkerRunnerRefImpl" as Runner class for worker.')):(n=LoaderSupport.NodeWorkerRunnerRefImpl,this.logging.enabled&&console.info('WorkerSupport: Using DEFAULT "LoaderSupport.NodeWorkerRunnerRefImpl" as Runner class for worker.'));var o=e(LoaderSupport.WorkerSupport.CodeSerializer);o+="var Parser = "+t+";\n\n",o+=LoaderSupport.WorkerSupport.CodeSerializer.serializeClass(n.runnerName,n),o+="new "+n.runnerName+"();\n\n";var a=this;if(LoaderSupport.Validator.isValid(i)&&i.length>0){var s="",l=function(e,t){if(0===t.length)a.loaderWorker.initWorker(s+o,n.runnerName),a.logging.enabled&&console.timeEnd("buildWebWorkerCode");else{var i=new FileLoader;i.setPath(e),i.setResponseType("text"),i.load(t[0],function(i){s+=i,l(e,t)}),t.shift()}};l(r,i)}else this.loaderWorker.initWorker(o,n.runnerName),this.logging.enabled&&console.timeEnd("buildWebWorkerCode")}},setCallbacks:function(e,t){this.loaderWorker.setCallbacks(e,t)},run:function(e){this.loaderWorker.run(e)},setTerminateRequested:function(e){this.loaderWorker.setTerminateRequested(e)}},LoaderSupport.WorkerSupport.LoaderWorker=function(){this._reset()},LoaderSupport.WorkerSupport.LoaderWorker.prototype={constructor:LoaderSupport.WorkerSupport.LoaderWorker,_reset:function(){this.logging={enabled:!0,debug:!1},this.worker=null,this.runnerImplName=null,this.callbacks={meshBuilder:null,onLoad:null},this.terminateRequested=!1,this.queuedMessage=null,this.started=!1,this.forceCopy=!1},checkSupport:function(){return void 0===window.Worker?"This browser does not support web workers!":void 0===window.Blob?"This browser does not support Blob!":"function"!=typeof window.URL.createObjectURL?"This browser does not support Object creation from URL!":void 0},setLogging:function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},setForceCopy:function(e){this.forceCopy=!0===e},initWorker:function(e,t){var i=this.checkSupport();if(i)throw i;this.runnerImplName=t;var r=new Blob([e],{type:"application/javascript"});this.worker=new Worker(window.URL.createObjectURL(r)),this.worker.onmessage=this._receiveWorkerMessage,this.worker.runtimeRef=this,this._postMessage()},_receiveWorkerMessage:function(e){var t=e.data;switch(t.cmd){case"meshData":case"materialData":case"imageData":this.runtimeRef.callbacks.meshBuilder(t);break;case"complete":this.runtimeRef.queuedMessage=null,this.started=!1,this.runtimeRef.callbacks.onLoad(t.msg),this.runtimeRef.terminateRequested&&(this.runtimeRef.logging.enabled&&console.info("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Run is complete. Terminating application on request!"),this.runtimeRef._terminate());break;case"error":console.error("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Reported error: "+t.msg),this.runtimeRef.queuedMessage=null,this.started=!1,this.runtimeRef.callbacks.onLoad(t.msg),this.runtimeRef.terminateRequested&&(this.runtimeRef.logging.enabled&&console.info("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Run reported error. Terminating application on request!"),this.runtimeRef._terminate());break;default:console.error("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Received unknown command: "+t.cmd)}},setCallbacks:function(e,t){this.callbacks.meshBuilder=LoaderSupport.Validator.verifyInput(e,this.callbacks.meshBuilder),this.callbacks.onLoad=LoaderSupport.Validator.verifyInput(t,this.callbacks.onLoad)},run:function(e){if(LoaderSupport.Validator.isValid(this.queuedMessage))console.warn("Already processing message. Rejecting new run instruction");else{if(this.queuedMessage=e,this.started=!0,!LoaderSupport.Validator.isValid(this.callbacks.meshBuilder))throw'Unable to run as no "MeshBuilder" callback is set.';if(!LoaderSupport.Validator.isValid(this.callbacks.onLoad))throw'Unable to run as no "onLoad" callback is set.';"run"!==e.cmd&&(e.cmd="run"),LoaderSupport.Validator.isValid(e.logging)?(e.logging.enabled=!0===e.logging.enabled,e.logging.debug=!0===e.logging.debug):e.logging={enabled:!0,debug:!1},this._postMessage()}},_postMessage:function(){var e;LoaderSupport.Validator.isValid(this.queuedMessage)&&LoaderSupport.Validator.isValid(this.worker)&&(this.queuedMessage.data.input instanceof ArrayBuffer?(e=this.forceCopy?this.queuedMessage.data.input.slice(0):this.queuedMessage.data.input,this.worker.postMessage(this.queuedMessage,[e])):this.worker.postMessage(this.queuedMessage))},setTerminateRequested:function(e){this.terminateRequested=!0===e,this.terminateRequested&&LoaderSupport.Validator.isValid(this.worker)&&!LoaderSupport.Validator.isValid(this.queuedMessage)&&this.started&&(this.logging.enabled&&console.info("Worker is terminated immediately as it is not running!"),this._terminate())},_terminate:function(){this.worker.terminate(),this._reset()}},LoaderSupport.WorkerSupport.CodeSerializer={serializeObject:function(e,t){var i,r=e+" = {\n\n";for(var n in t)"string"==typeof(i=t[n])||i instanceof String?r+="\t"+n+': "'+(i=(i=i.replace("\n","\\n")).replace("\r","\\r"))+'",\n':i instanceof Array?r+="\t"+n+": ["+i+"],\n":r+="object"==typeof i?"\t"+n+": {},\n":"\t"+n+": "+i+",\n";return r+="}\n\n"},serializeClass:function(e,t,i,r,n,o,a){var s,l,u,h,c,d=[],p=[],f=[],m=null!=r;for(var v in Array.isArray(n)||(n=[]),Array.isArray(o)||(o=null),Array.isArray(a)||(a=[]),t.prototype)s=(l=t.prototype[v]).toString(),"constructor"===v?u=e+" = "+s+";\n\n":"function"==typeof l&&n.indexOf(v)<0&&(null===o||o.indexOf(v)>=0)&&((c=a[v])&&c.fullName===e+".prototype."+v&&(s=c.code),m?d.push(e+".prototype."+v+" = "+s+";\n\n"):d.push("\t"+v+": "+s+",\n\n"));for(var v in t)"function"==typeof(l=t[v])?n.indexOf(v)<0&&(null===o||o.indexOf(v)>=0)&&(s=(c=a[v])&&c.fullName===e+"."+v?c.code:l.toString(),f.push(e+"."+v+" = "+s+";\n\n")):(s="string"==typeof l||l instanceof String?'"'+l.toString()+'"':"object"==typeof l?"{}":l,p.push(e+"."+v+" = "+s+";\n"));null==u&&"function"==typeof t.prototype.constructor&&(u=e+" = "+t.prototype.constructor.toString().replace(i,""));var g=u+"\n\n";for(m&&(g+=e+".prototype = Object.create( "+r+".prototype );\n"),g+=e+".prototype.constructor = "+e+";\n",g+="\n\n",h=0;h<p.length;h++)g+=p[h];for(g+="\n\n",h=0;h<f.length;h++)g+=f[h];if(g+="\n\n",m)for(h=0;h<d.length;h++)g+=d[h];else{for(g+=e+".prototype = {\n\n",h=0;h<d.length;h++)g+=d[h];g+="\n};"}return g+="\n\n"}},LoaderSupport.WorkerRunnerRefImpl=function(){this.getParentScope().addEventListener("message",function(e){this.processMessage(e.data)}.bind(this))},LoaderSupport.WorkerRunnerRefImpl.runnerName="LoaderSupport.WorkerRunnerRefImpl",LoaderSupport.WorkerRunnerRefImpl.prototype={constructor:LoaderSupport.WorkerRunnerRefImpl,getParentScope:function(){return self},applyProperties:function(e,t){var i,r,n;for(i in t)r="set"+i.substring(0,1).toLocaleUpperCase()+i.substring(1),n=t[i],"function"==typeof e[r]?e[r](n):e.hasOwnProperty(i)&&(e[i]=n)},processMessage:function(e){if("run"===e.cmd){var t=this.getParentScope(),i={callbackMeshBuilder:function(e){t.postMessage(e)},callbackProgress:function(t){e.logging.enabled&&e.logging.debug&&console.debug("WorkerRunner: progress: "+t)}},r=new Parser;"function"==typeof r.setLogging&&r.setLogging(e.logging.enabled,e.logging.debug),this.applyProperties(r,e.params),this.applyProperties(r,e.materials),this.applyProperties(r,i),r.workerScope=t,r.parse(e.data.input,e.data.options),e.logging.enabled&&console.log("WorkerRunner: Run complete!"),i.callbackMeshBuilder({cmd:"complete",msg:"WorkerRunner completed run."})}else console.error("WorkerRunner: Received unknown command: "+e.cmd)}},LoaderSupport.NodeWorkerRunnerRefImpl=function(){this.runnerName="LoaderSupport.NodeWorkerRunnerRefImpl",this.getParentScope().onmessage=this.processMessage.bind(this)},LoaderSupport.NodeWorkerRunnerRefImpl.prototype=Object.create(LoaderSupport.WorkerRunnerRefImpl.prototype),LoaderSupport.NodeWorkerRunnerRefImpl.prototype.constructor=LoaderSupport.NodeWorkerRunnerRefImpl,LoaderSupport.NodeWorkerRunnerRefImpl.runnerName="LoaderSupport.NodeWorkerRunnerRefImpl",LoaderSupport.NodeWorkerRunnerRefImpl.prototype={getParentScope:function(){var _require=eval("require");return _require("worker_threads").parentPort}},LoaderSupport.WorkerSupport.NodeLoaderWorker=function(){LoaderSupport.WorkerSupport.LoaderWorker.call(this)},LoaderSupport.WorkerSupport.NodeLoaderWorker.prototype=Object.create(LoaderSupport.WorkerSupport.LoaderWorker.prototype),LoaderSupport.WorkerSupport.NodeLoaderWorker.prototype.constructor=LoaderSupport.WorkerSupport.NodeLoaderWorker,LoaderSupport.WorkerSupport.NodeLoaderWorker.checkSupport=function(){try{var _require=eval("require");_require.resolve("worker_threads")}catch(e){return"This version of Node does not support web workers!"}},LoaderSupport.WorkerSupport.NodeLoaderWorker.prototype.initWorker=function(code,runnerImplName){var supportError=this.checkSupport();if(supportError)throw supportError;this.runnerImplName=runnerImplName;var _require=eval("require"),Worker=_require("worker_threads").Worker;this.worker=new Worker(code,{eval:!0}),this.worker.onmessage=this._receiveWorkerMessage,this.worker.runtimeRef=this,this._postMessage()},LoaderSupport.WorkerDirector=function(e){if(console.info("Using LoaderSupport.WorkerDirector version: "+LoaderSupport.WorkerDirector.LOADER_WORKER_DIRECTOR_VERSION),this.logging={enabled:!0,debug:!1},this.maxQueueSize=LoaderSupport.WorkerDirector.MAX_QUEUE_SIZE,this.maxWebWorkers=LoaderSupport.WorkerDirector.MAX_WEB_WORKER,this.crossOrigin=null,!LoaderSupport.Validator.isValid(e))throw"Provided invalid classDef: "+e;this.workerDescription={classDef:e,globalCallbacks:{},workerSupports:{},forceWorkerDataCopy:!0},this.objectsCompleted=0,this.instructionQueue=[],this.instructionQueuePointer=0,this.callbackOnFinishedProcessing=null},LoaderSupport.WorkerDirector.LOADER_WORKER_DIRECTOR_VERSION="2.3.0",LoaderSupport.WorkerDirector.MAX_WEB_WORKER=16,LoaderSupport.WorkerDirector.MAX_QUEUE_SIZE=2048,LoaderSupport.WorkerDirector.prototype={constructor:LoaderSupport.WorkerDirector,setLogging:function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},getMaxQueueSize:function(){return this.maxQueueSize},getMaxWebWorkers:function(){return this.maxWebWorkers},setCrossOrigin:function(e){this.crossOrigin=e},setForceWorkerDataCopy:function(e){this.workerDescription.forceWorkerDataCopy=!0===e},prepareWorkers:function(e,t,i){LoaderSupport.Validator.isValid(e)&&(this.workerDescription.globalCallbacks=e),this.maxQueueSize=Math.min(t,LoaderSupport.WorkerDirector.MAX_QUEUE_SIZE),this.maxWebWorkers=Math.min(i,LoaderSupport.WorkerDirector.MAX_WEB_WORKER),this.maxWebWorkers=Math.min(this.maxWebWorkers,this.maxQueueSize),this.objectsCompleted=0,this.instructionQueue=[],this.instructionQueuePointer=0;for(var r=0;r<this.maxWebWorkers;r++){var n=new LoaderSupport.WorkerSupport;n.setLogging(this.logging.enabled,this.logging.debug),n.setForceWorkerDataCopy(this.workerDescription.forceWorkerDataCopy),this.workerDescription.workerSupports[r]={instanceNo:r,inUse:!1,terminateRequested:!1,workerSupport:n,loader:null}}},enqueueForRun:function(e){this.instructionQueue.length<this.maxQueueSize&&this.instructionQueue.push(e)},isRunning:function(){var e=Object.keys(this.workerDescription.workerSupports);return this.instructionQueue.length>0&&this.instructionQueuePointer<this.instructionQueue.length||e.length>0},processQueue:function(){var e,t;for(var i in this.workerDescription.workerSupports)(t=this.workerDescription.workerSupports[i]).inUse||(this.instructionQueuePointer<this.instructionQueue.length?(e=this.instructionQueue[this.instructionQueuePointer],this._kickWorkerRun(e,t),this.instructionQueuePointer++):this._deregister(t));this.isRunning()||null===this.callbackOnFinishedProcessing||(this.callbackOnFinishedProcessing(),this.callbackOnFinishedProcessing=null)},_kickWorkerRun:function(e,t){t.inUse=!0,t.workerSupport.setTerminateRequested(t.terminateRequested),this.logging.enabled&&console.info("\nAssigning next item from queue to worker (queue length: "+this.instructionQueue.length+")\n\n");var i=LoaderSupport.Validator,r=this,n=e.getCallbacks(),o=this.workerDescription.globalCallbacks;t.loader=this._buildLoader(t.instanceNo);var a=new LoaderSupport.Callbacks;a.setCallbackOnLoad(function(e){i.isValid(o.onLoad)&&o.onLoad(e),i.isValid(n.onLoad)&&n.onLoad(e),r.objectsCompleted++,t.inUse=!1,r.processQueue()}),a.setCallbackOnProgress(function(e){i.isValid(o.onProgress)&&o.onProgress(e),i.isValid(n.onProgress)&&n.onProgress(e)}),a.setCallbackOnReportError(function(e){var a=!0;i.isValid(o.onReportError)&&(a=o.onReportError(t,e)),i.isValid(n.onReportError)&&(a=n.onReportError(t,e)),i.isValid(o.onReportError)||i.isValid(n.onReportError)||(console.error("Loader reported an error: "),console.error(e)),a&&(t.inUse=!1,r.processQueue())}),a.setCallbackOnMeshAlter(function(e,t){return i.isValid(o.onMeshAlter)&&(t=o.onMeshAlter(e,t)),i.isValid(n.onMeshAlter)&&(t=o.onMeshAlter(e,t)),t}),a.setCallbackOnLoadMaterials(function(e){return i.isValid(o.onLoadMaterials)&&(e=o.onLoadMaterials(e)),i.isValid(n.onLoadMaterials)&&(e=n.onLoadMaterials(e)),e}),e.callbacks=a,t.loader.run(e,t.workerSupport)},_buildLoader:function(e){var t=this.workerDescription.classDef,i=Object.create(t.prototype);if(t.call(i,DefaultLoadingManager),!i.hasOwnProperty("instanceNo"))throw t.name+' has no property "instanceNo".';if(i.instanceNo=e,!i.hasOwnProperty("workerSupport"))throw t.name+' has no property "workerSupport".';if("function"!=typeof i.run)throw t.name+' has no function "run".';return i.hasOwnProperty("callbacks")&&LoaderSupport.Validator.isValid(i.callbacks)||(console.warn(t.name+' has an invalid property "callbacks". Will change to "LoaderSupport.Callbacks"'),i.callbacks=new LoaderSupport.Callbacks),i},_deregister:function(e){if(LoaderSupport.Validator.isValid(e)){e.workerSupport.setTerminateRequested(!0),this.logging.enabled&&console.info("Requested termination of worker #"+e.instanceNo+".");var t=e.loader.callbacks;LoaderSupport.Validator.isValid(t.onProgress)&&t.onProgress({detail:{text:""}}),delete this.workerDescription.workerSupports[e.instanceNo]}},tearDown:function(e){for(var t in this.logging.enabled&&console.info("WorkerDirector received the deregister call. Terminating all workers!"),this.instructionQueuePointer=this.instructionQueue.length,this.callbackOnFinishedProcessing=LoaderSupport.Validator.verifyInput(e,null),this.workerDescription.workerSupports)this.workerDescription.workerSupports[t].terminateRequested=!0}};var MD2Loader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager},normalData;MD2Loader.prototype={constructor:MD2Loader,load:function(e,t,i,r){var n=this,o=new FileLoader(n.manager);o.setPath(n.path),o.setResponseType("arraybuffer"),o.load(e,function(e){t(n.parse(e))},i,r)},setPath:function(e){return this.path=e,this},parse:(normalData=[[-.525731,0,.850651],[-.442863,.238856,.864188],[-.295242,0,.955423],[-.309017,.5,.809017],[-.16246,.262866,.951056],[0,0,1],[0,.850651,.525731],[-.147621,.716567,.681718],[.147621,.716567,.681718],[0,.525731,.850651],[.309017,.5,.809017],[.525731,0,.850651],[.295242,0,.955423],[.442863,.238856,.864188],[.16246,.262866,.951056],[-.681718,.147621,.716567],[-.809017,.309017,.5],[-.587785,.425325,.688191],[-.850651,.525731,0],[-.864188,.442863,.238856],[-.716567,.681718,.147621],[-.688191,.587785,.425325],[-.5,.809017,.309017],[-.238856,.864188,.442863],[-.425325,.688191,.587785],[-.716567,.681718,-.147621],[-.5,.809017,-.309017],[-.525731,.850651,0],[0,.850651,-.525731],[-.238856,.864188,-.442863],[0,.955423,-.295242],[-.262866,.951056,-.16246],[0,1,0],[0,.955423,.295242],[-.262866,.951056,.16246],[.238856,.864188,.442863],[.262866,.951056,.16246],[.5,.809017,.309017],[.238856,.864188,-.442863],[.262866,.951056,-.16246],[.5,.809017,-.309017],[.850651,.525731,0],[.716567,.681718,.147621],[.716567,.681718,-.147621],[.525731,.850651,0],[.425325,.688191,.587785],[.864188,.442863,.238856],[.688191,.587785,.425325],[.809017,.309017,.5],[.681718,.147621,.716567],[.587785,.425325,.688191],[.955423,.295242,0],[1,0,0],[.951056,.16246,.262866],[.850651,-.525731,0],[.955423,-.295242,0],[.864188,-.442863,.238856],[.951056,-.16246,.262866],[.809017,-.309017,.5],[.681718,-.147621,.716567],[.850651,0,.525731],[.864188,.442863,-.238856],[.809017,.309017,-.5],[.951056,.16246,-.262866],[.525731,0,-.850651],[.681718,.147621,-.716567],[.681718,-.147621,-.716567],[.850651,0,-.525731],[.809017,-.309017,-.5],[.864188,-.442863,-.238856],[.951056,-.16246,-.262866],[.147621,.716567,-.681718],[.309017,.5,-.809017],[.425325,.688191,-.587785],[.442863,.238856,-.864188],[.587785,.425325,-.688191],[.688191,.587785,-.425325],[-.147621,.716567,-.681718],[-.309017,.5,-.809017],[0,.525731,-.850651],[-.525731,0,-.850651],[-.442863,.238856,-.864188],[-.295242,0,-.955423],[-.16246,.262866,-.951056],[0,0,-1],[.295242,0,-.955423],[.16246,.262866,-.951056],[-.442863,-.238856,-.864188],[-.309017,-.5,-.809017],[-.16246,-.262866,-.951056],[0,-.850651,-.525731],[-.147621,-.716567,-.681718],[.147621,-.716567,-.681718],[0,-.525731,-.850651],[.309017,-.5,-.809017],[.442863,-.238856,-.864188],[.16246,-.262866,-.951056],[.238856,-.864188,-.442863],[.5,-.809017,-.309017],[.425325,-.688191,-.587785],[.716567,-.681718,-.147621],[.688191,-.587785,-.425325],[.587785,-.425325,-.688191],[0,-.955423,-.295242],[0,-1,0],[.262866,-.951056,-.16246],[0,-.850651,.525731],[0,-.955423,.295242],[.238856,-.864188,.442863],[.262866,-.951056,.16246],[.5,-.809017,.309017],[.716567,-.681718,.147621],[.525731,-.850651,0],[-.238856,-.864188,-.442863],[-.5,-.809017,-.309017],[-.262866,-.951056,-.16246],[-.850651,-.525731,0],[-.716567,-.681718,-.147621],[-.716567,-.681718,.147621],[-.525731,-.850651,0],[-.5,-.809017,.309017],[-.238856,-.864188,.442863],[-.262866,-.951056,.16246],[-.864188,-.442863,.238856],[-.809017,-.309017,.5],[-.688191,-.587785,.425325],[-.681718,-.147621,.716567],[-.442863,-.238856,.864188],[-.587785,-.425325,.688191],[-.309017,-.5,.809017],[-.147621,-.716567,.681718],[-.425325,-.688191,.587785],[-.16246,-.262866,.951056],[.442863,-.238856,.864188],[.16246,-.262866,.951056],[.309017,-.5,.809017],[.147621,-.716567,.681718],[0,-.525731,.850651],[.425325,-.688191,.587785],[.587785,-.425325,.688191],[.688191,-.587785,.425325],[-.955423,.295242,0],[-.951056,.16246,.262866],[-1,0,0],[-.850651,0,.525731],[-.955423,-.295242,0],[-.951056,-.16246,.262866],[-.864188,.442863,-.238856],[-.951056,.16246,-.262866],[-.809017,.309017,-.5],[-.864188,-.442863,-.238856],[-.951056,-.16246,-.262866],[-.809017,-.309017,-.5],[-.681718,.147621,-.716567],[-.681718,-.147621,-.716567],[-.850651,0,-.525731],[-.688191,.587785,-.425325],[-.587785,.425325,-.688191],[-.425325,.688191,-.587785],[-.425325,-.688191,-.587785],[-.587785,-.425325,-.688191],[-.688191,-.587785,-.425325]],function(e){console.time("MD2Loader");for(var t=new DataView(e),i={},r=["ident","version","skinwidth","skinheight","framesize","num_skins","num_vertices","num_st","num_tris","num_glcmds","num_frames","offset_skins","offset_st","offset_tris","offset_frames","offset_glcmds","offset_end"],n=0;n<r.length;n++)i[r[n]]=t.getInt32(4*n,!0);if(844121161===i.ident&&8===i.version){if(i.offset_end===t.byteLength){for(var o=new BufferGeometry,a=[],s=i.offset_st,l=(n=0,i.num_st);n<l;n++){var u=t.getInt16(s+0,!0),h=t.getInt16(s+2,!0);a.push(u/i.skinwidth,1-h/i.skinheight),s+=4}s=i.offset_tris;var c=[],d=[];for(n=0,l=i.num_tris;n<l;n++)c.push(t.getUint16(s+0,!0),t.getUint16(s+2,!0),t.getUint16(s+4,!0)),d.push(t.getUint16(s+6,!0),t.getUint16(s+8,!0),t.getUint16(s+10,!0)),s+=12;var p=new Vector3,f=new Vector3,m=[],v=[];for(s=i.offset_frames,n=0,l=i.num_frames;n<l;n++){f.set(t.getFloat32(s+0,!0),t.getFloat32(s+4,!0),t.getFloat32(s+8,!0)),p.set(t.getFloat32(s+12,!0),t.getFloat32(s+16,!0),t.getFloat32(s+20,!0)),s+=24;for(var g=0;g<16;g++){var y=t.getUint8(s+g,!0);if(0===y)break;m[g]=y}var _={name:String.fromCharCode.apply(null,m),vertices:[],normals:[]};for(s+=16,g=0;g<i.num_vertices;g++){var b=t.getUint8(s++,!0),x=t.getUint8(s++,!0),w=t.getUint8(s++,!0),S=normalData[t.getUint8(s++,!0)];b=b*f.x+p.x,x=x*f.y+p.y,w=w*f.z+p.z,_.vertices.push(b,w,x),_.normals.push(S[0],S[2],S[1])}v.push(_)}var M=[],T=[],A=[],C=v[0].vertices,L=v[0].normals;for(n=0,l=c.length;n<l;n++){b=C[F=3*c[n]],x=C[F+1],w=C[F+2],M.push(b,x,w);var N=L[F],P=L[F+1],k=L[F+2];T.push(N,P,k),u=a[F=2*d[n]],h=a[F+1],A.push(u,h)}o.addAttribute("position",new Float32BufferAttribute(M,3)),o.addAttribute("normal",new Float32BufferAttribute(T,3)),o.addAttribute("uv",new Float32BufferAttribute(A,2));var E=[],D=[];for(n=0,l=v.length;n<l;n++){var O=(_=v[n]).name;if(_.vertices.length>0){M=[],g=0;for(var R=c.length;g<R;g++){var F=3*c[g];b=_.vertices[F],x=_.vertices[F+1],w=_.vertices[F+2],M.push(b,x,w)}var I=new Float32BufferAttribute(M,3);I.name=O,E.push(I)}if(_.normals.length>0){for(T=[],g=0,R=c.length;g<R;g++)F=3*c[g],N=_.normals[F],P=_.normals[F+1],k=_.normals[F+2],T.push(N,P,k);var B=new Float32BufferAttribute(T,3);B.name=O,D.push(B)}}return o.morphAttributes.position=E,o.morphAttributes.normal=D,o.animations=AnimationClip.CreateClipsFromMorphTargetSequences(v,10),console.timeEnd("MD2Loader"),o}console.error("Corrupted MD2 file")}else console.error("Not a valid MD2 file")})};var MMDLoader=function(){function e(e){this.manager=void 0!==e?e:DefaultLoadingManager,this.loader=new FileLoader(this.manager),this.parser=null,this.meshBuilder=new i(this.manager),this.animationBuilder=new o}e.prototype={constructor:e,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},setAnimationPath:function(e){return this.animationPath=e,this},setPath:function(e){return this.path=e,this},setResoucePath:function(e){return this.resourcePath=e,this},load:function(e,t,i,r){var n,o=this.meshBuilder.setCrossOrigin(this.crossOrigin);n=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:LoaderUtils.extractUrlBase(e);var a=this._extractExtension(e).toLowerCase();"pmd"===a||"pmx"===a?this["pmd"===a?"loadPMD":"loadPMX"](e,function(e){t(o.build(e,n,i,r))},i,r):r&&r(new Error("MMDLoader: Unknown model file extension ."+a+"."))},loadAnimation:function(e,t,i,r,n){var o=this.animationBuilder;this.loadVMD(e,function(e){i(t.isCamera?o.buildCameraAnimation(e):o.build(e,t))},r,n)},loadWithAnimation:function(e,t,i,r,n){var o=this;this.load(e,function(e){o.loadAnimation(t,e,function(t){i({mesh:e,animation:t})},r,n)},r,n)},loadPMD:function(e,t,i,r){var n=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").load(e,function(e){t(n.parsePmd(e,!0))},i,r)},loadPMX:function(e,t,i,r){var n=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").load(e,function(e){t(n.parsePmx(e,!0))},i,r)},loadVMD:function(e,t,i,r){var n=Array.isArray(e)?e:[e],o=[],a=n.length,s=this._getParser();this.loader.setMimeType(void 0).setPath(this.animationPath).setResponseType("arraybuffer");for(var l=0,u=n.length;l<u;l++)this.loader.load(n[l],function(e){o.push(s.parseVmd(e,!0)),o.length===a&&t(s.mergeVmds(o))},i,r)},loadVPD:function(e,t,i,r,n){var o=this._getParser();this.loader.setMimeType(t?void 0:"text/plain; charset=shift_jis").setPath(this.animationPath).setResponseType("text").load(e,function(e){i(o.parseVpd(e,!0))},r,n)},_extractExtension:function(e){var t=e.lastIndexOf(".");return t<0?"":e.slice(t+1)},_getParser:function(){if(null===this.parser){if("undefined"==typeof MMDParser)throw new Error("MMDLoader: Import MMDParser https://github.com/takahirox/mmd-parser");this.parser=new MMDParser.Parser}return this.parser}};var t=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII="];function i(e){this.geometryBuilder=new r,this.materialBuilder=new n(e)}function r(){}function n(e){this.manager=e,this.textureLoader=new TextureLoader(this.manager),this.tgaLoader=null}function o(){}function a(e,t,i,r,n){Interpolant.call(this,e,t,i,r),this.interpolationParams=n}return i.prototype={constructor:i,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},build:function(e,t,i,r){var n=this.geometryBuilder.build(e),o=new SkinnedMesh(n,this.materialBuilder.setCrossOrigin(this.crossOrigin).setResourcePath(t).build(e,n,i,r)),a=new Skeleton(function(e){var t,i,r,n,o=e.geometry,a=[];if(o&&void 0!==o.bones){for(r=0,n=o.bones.length;r<n;r++)i=o.bones[r],t=new Bone,a.push(t),t.name=i.name,t.position.fromArray(i.pos),t.quaternion.fromArray(i.rotq),void 0!==i.scl&&t.scale.fromArray(i.scl);for(r=0,n=o.bones.length;r<n;r++)-1!==(i=o.bones[r]).parent&&null!==i.parent&&void 0!==a[i.parent]?a[i.parent].add(a[r]):e.add(a[r])}return e.updateMatrixWorld(!0),a}(o));return o.bind(a),o}},r.prototype={constructor:r,build:function(e){for(var t=[],i=[],r=[],n=[],o=[],a=[],s=[],l=[],u=[],h=[],c=[],d=[],p=[],f=[],m=0,v={},g=0;g<e.metadata.vertexCount;g++){for(var y=e.vertices[g],_=0,b=y.position.length;_<b;_++)t.push(y.position[_]);for(_=0,b=y.normal.length;_<b;_++)r.push(y.normal[_]);for(_=0,b=y.uv.length;_<b;_++)i.push(y.uv[_]);for(_=0;_<4;_++)s.push(y.skinIndices.length-1>=_?y.skinIndices[_]:0);for(_=0;_<4;_++)l.push(y.skinWeights.length-1>=_?y.skinWeights[_]:0)}for(g=0;g<e.metadata.faceCount;g++){var x=e.faces[g];for(_=0,b=x.indices.length;_<b;_++)n.push(x.indices[_])}for(g=0;g<e.metadata.materialCount;g++){var w=e.materials[g];o.push({offset:3*m,count:3*w.faceCount}),m+=w.faceCount}for(g=0;g<e.metadata.rigidBodyCount;g++){var S=e.rigidBodies[g],M=v[S.boneIndex];M=void 0===M?S.type:Math.max(S.type,M),v[S.boneIndex]=M}for(g=0;g<e.metadata.boneCount;g++){-1!==(G={parent:(E=e.bones[g]).parentIndex,name:E.name,pos:E.position.slice(0,3),rotq:[0,0,0,1],scl:[1,1,1],rigidBodyType:void 0!==v[g]?v[g]:-1}).parent&&(G.pos[0]-=e.bones[G.parent].position[0],G.pos[1]-=e.bones[G.parent].position[1],G.pos[2]-=e.bones[G.parent].position[2]),a.push(G)}if("pmd"===e.metadata.format)for(g=0;g<e.metadata.ikCount;g++){var T={target:(A=e.iks[g]).target,effector:A.effector,iteration:A.iteration,maxAngle:4*A.maxAngle,links:[]};for(_=0,b=A.links.length;_<b;_++){(C={}).index=A.links[_].index,C.enabled=!0,e.bones[C.index].name.indexOf("ひざ")>=0&&(C.limitation=new Vector3(1,0,0)),T.links.push(C)}c.push(T)}else for(g=0;g<e.metadata.boneCount;g++){var A;if(void 0!==(A=e.bones[g].ik)){for(T={target:g,effector:A.effector,iteration:A.iteration,maxAngle:A.maxAngle,links:[]},_=0,b=A.links.length;_<b;_++){var C;if((C={}).index=A.links[_].index,C.enabled=!0,1===A.links[_].angleLimitation){var L=A.links[_].lowerLimitationAngle,N=A.links[_].upperLimitationAngle,P=-N[0],k=-N[1];N[0]=-L[0],N[1]=-L[1],L[0]=P,L[1]=k,C.rotationMin=(new Vector3).fromArray(L),C.rotationMax=(new Vector3).fromArray(N)}T.links.push(C)}c.push(T)}}if("pmx"===e.metadata.format){for(g=0;g<e.metadata.boneCount;g++){var E,D=(E=e.bones[g]).grant;if(void 0!==D){T={index:g,parentIndex:D.parentIndex,ratio:D.ratio,isLocal:D.isLocal,affectRotation:D.affectRotation,affectPosition:D.affectPosition,transformationClass:E.transformationClass};d.push(T)}}d.sort(function(e,t){return e.transformationClass-t.transformationClass})}function O(t,i,r){for(var n=0;n<i.elementCount;n++){var o,a=i.elements[n];o="pmd"===e.metadata.format?e.morphs[0].elements[a.index].index:a.index,t.array[3*o+0]+=a.position[0]*r,t.array[3*o+1]+=a.position[1]*r,t.array[3*o+2]+=a.position[2]*r}}for(g=0;g<e.metadata.morphCount;g++){var R=e.morphs[g],F={name:R.name},I=new Float32BufferAttribute(3*e.metadata.vertexCount,3);I.name=R.name;for(_=0;_<3*e.metadata.vertexCount;_++)I.array[_]=t[_];if("pmd"===e.metadata.format)0!==g&&O(I,R,1);else if(0===R.type)for(_=0;_<R.elementCount;_++){var B=e.morphs[R.elements[_].index],U=R.elements[_].ratio;1===B.type&&O(I,B,U)}else 1===R.type?O(I,R,1):2===R.type||3===R.type||4===R.type||5===R.type||6===R.type||7===R.type||R.type;u.push(F),h.push(I)}for(g=0;g<e.metadata.rigidBodyCount;g++){var V=e.rigidBodies[g];F={};for(var z in V)F[z]=V[z];if("pmx"===e.metadata.format&&-1!==F.boneIndex){var G=e.bones[F.boneIndex];F.position[0]-=G.position[0],F.position[1]-=G.position[1],F.position[2]-=G.position[2]}p.push(F)}for(g=0;g<e.metadata.constraintCount;g++){var j=e.constraints[g];F={};for(var z in j)F[z]=j[z];var W=p[F.rigidBodyIndex1],H=p[F.rigidBodyIndex2];0!==W.type&&2===H.type&&-1!==W.boneIndex&&-1!==H.boneIndex&&e.bones[H.boneIndex].parentIndex===W.boneIndex&&(H.type=1),f.push(F)}var q=new BufferGeometry;q.addAttribute("position",new Float32BufferAttribute(t,3)),q.addAttribute("normal",new Float32BufferAttribute(r,3)),q.addAttribute("uv",new Float32BufferAttribute(i,2)),q.addAttribute("skinIndex",new Uint16BufferAttribute(s,4)),q.addAttribute("skinWeight",new Float32BufferAttribute(l,4)),q.setIndex(n);g=0;for(var Y=o.length;g<Y;g++)q.addGroup(o[g].offset,o[g].count,g);return q.bones=a,q.morphTargets=u,q.morphAttributes.position=h,q.userData.MMD={bones:a,iks:c,grants:d,rigidBodies:p,constraints:f,format:e.metadata.format},q.computeBoundingSphere(),q}},n.prototype={constructor:n,crossOrigin:"anonymous",resourcePath:void 0,setCrossOrigin:function(e){return this.crossOrigin=e,this},setResourcePath:function(e){return this.resourcePath=e,this},build:function(e,t,i,r){var n=[],o={};this.textureLoader.setCrossOrigin(this.crossOrigin);for(var a=0;a<e.metadata.materialCount;a++){var s=e.materials[a],l={userData:{}};if(void 0!==s.name&&(l.name=s.name),l.color=(new Color).fromArray(s.diffuse),l.opacity=s.diffuse[3],l.specular=(new Color).fromArray(s.specular),l.emissive=(new Color).fromArray(s.ambient),l.shininess=Math.max(s.shininess,1e-4),l.transparent=1!==l.opacity,l.skinning=t.bones.length>0,l.morphTargets=t.morphTargets.length>0,l.lights=!0,l.fog=!0,l.blending=CustomBlending,l.blendSrc=SrcAlphaFactor,l.blendDst=OneMinusSrcAlphaFactor,l.blendSrcAlpha=SrcAlphaFactor,l.blendDstAlpha=DstAlphaFactor,"pmx"===e.metadata.format&&1==(1&s.flag)?l.side=DoubleSide:l.side=1===l.opacity?FrontSide:DoubleSide,"pmd"===e.metadata.format){if(s.fileName){var u=s.fileName.split("*");if(l.map=this._loadTexture(u[0],o),u.length>1){var h=u[1].slice(-4).toLowerCase();l.envMap=this._loadTexture(u[1],o,{sphericalReflectionMapping:!0}),l.combine=".sph"===h?MultiplyOperation:AddOperation}}var c=-1===s.toonIndex?"toon00.bmp":e.toonTextures[s.toonIndex].fileName;l.gradientMap=this._loadTexture(c,o,{isToonTexture:!0,isDefaultToonTexture:this._isDefaultToonTexture(c)}),l.userData.outlineParameters={thickness:1===s.edgeFlag?.003:0,color:[0,0,0],alpha:1,visible:1===s.edgeFlag}}else{var d;-1!==s.textureIndex&&(l.map=this._loadTexture(e.textures[s.textureIndex],o)),-1===s.envTextureIndex||1!==s.envFlag&&2!=s.envFlag||(l.envMap=this._loadTexture(e.textures[s.envTextureIndex],o,{sphericalReflectionMapping:!0}),l.combine=1===s.envFlag?MultiplyOperation:AddOperation),-1===s.toonIndex||0!==s.toonFlag?(c="toon"+("0"+(s.toonIndex+1)).slice(-2)+".bmp",d=!0):(c=e.textures[s.toonIndex],d=!1),l.gradientMap=this._loadTexture(c,o,{isToonTexture:!0,isDefaultToonTexture:d}),l.userData.outlineParameters={thickness:s.edgeSize/300,color:s.edgeColor.slice(0,3),alpha:s.edgeColor[3],visible:0!=(16&s.flag)&&s.edgeSize>0}}void 0!==l.map&&(l.transparent||this._checkImageTransparency(l.map,t,a),l.emissive.multiplyScalar(.2)),n.push(new MeshToonMaterial(l))}if("pmx"===e.metadata.format){function p(e,t){for(var i=0,r=e.length;i<r;i++){var n=e[i];if(-1!==n.index){var o=t[n.index];o.opacity!==n.diffuse[3]&&(o.transparent=!0)}}}a=0;for(var f=e.morphs.length;a<f;a++){var m=e.morphs[a],v=m.elements;if(0===m.type)for(var g=0,y=v.length;g<y;g++){var _=e.morphs[v[g].index];8===_.type&&p(_.elements,n)}else 8===m.type&&p(v,n)}}return n},_getTGALoader:function(){if(null===this.tgaLoader){if(void 0===TGALoader)throw new Error("MMDLoader: Import TGALoader");this.tgaLoader=new TGALoader(this.manager)}return this.tgaLoader},_isDefaultToonTexture:function(e){return 10===e.length&&/toon(10|0[0-9])\.bmp/.test(e)},_loadTexture:function(e,i,r,n,o){var a,s=this;if(!0===(r=r||{}).isDefaultToonTexture){var l;try{l=parseInt(e.match("toon([0-9]{2}).bmp$")[1])}catch(t){console.warn("MMDLoader: "+e+" seems like a not right default texture path. Using toon00.bmp instead."),l=0}a=t[l]}else a=this.resourcePath+e;if(void 0!==i[a])return i[a];var u=Loader.Handlers.get(a);null===u&&(u=".tga"===e.slice(-4).toLowerCase()?this._getTGALoader():this.textureLoader);var h=u.load(a,function(e){!0===r.isToonTexture&&(e.image=s._getRotatedImage(e.image)),e.flipY=!1,e.wrapS=RepeatWrapping,e.wrapT=RepeatWrapping;for(var t=0;t<h.readyCallbacks.length;t++)h.readyCallbacks[t](h);delete h.readyCallbacks},n,o);return!0===r.sphericalReflectionMapping&&(h.mapping=SphericalReflectionMapping),h.readyCallbacks=[],i[a]=h,h},_getRotatedImage:function(e){var t=document.createElement("canvas"),i=t.getContext("2d"),r=e.width,n=e.height;return t.width=r,t.height=n,i.clearRect(0,0,r,n),i.translate(r/2,n/2),i.rotate(.5*Math.PI),i.translate(-r/2,-n/2),i.drawImage(e,0,0),i.getImageData(0,0,r,n)},_checkImageTransparency:function(e,t,i){e.readyCallbacks.push(function(r){function n(e,t){var i=e.width,r=e.height,n=Math.round(t.x*i)%i,o=Math.round(t.y*r)%r;n<0&&(n+=i),o<0&&(o+=r);var a=o*i+n;return e.data[4*a+3]}var o=void 0!==r.image.data?r.image:function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var i=t.getContext("2d");return i.drawImage(e,0,0),i.getImageData(0,0,t.width,t.height)}(r.image),a=t.groups[i];(function(e,t,i){var r=e.width,o=e.height;if(e.data.length/(r*o)!=4)return!1;for(var a=0;a<i.length;a+=3){for(var s={x:0,y:0},l=0;l<3;l++){var u=i[3*a+l],h={x:t[2*u+0],y:t[2*u+1]};if(n(e,h)<253)return!0;s.x+=h.x,s.y+=h.y}if(s.x/=3,s.y/=3,n(e,s)<253)return!0}return!1})(o,t.attributes.uv.array,t.index.array.slice(a.start,a.start+a.count))&&(e.transparent=!0)})}},o.prototype={constructor:o,build:function(e,t){for(var i=this.buildSkeletalAnimation(e,t).tracks,r=this.buildMorphAnimation(e,t).tracks,n=0,o=r.length;n<o;n++)i.push(r[n]);return new AnimationClip("",-1,i)},buildSkeletalAnimation:function(e,t){function i(e,t,i){e.push(t[i+0]/127),e.push(t[i+8]/127),e.push(t[i+4]/127),e.push(t[i+12]/127)}for(var r=[],n={},o=t.skeleton.bones,a={},s=0,l=o.length;s<l;s++)a[o[s].name]=!0;for(s=0;s<e.metadata.motionCount;s++){var u=e.motions[s],h=u.boneName;void 0!==a[h]&&(n[h]=n[h]||[],n[h].push(u))}for(var c in n){var d=n[c];d.sort(function(e,t){return e.frameNum-t.frameNum});var p=[],f=[],m=[],v=[],g=[],y=t.skeleton.getBoneByName(c).position.toArray();for(s=0,l=d.length;s<l;s++){var _=d[s].frameNum/30,b=d[s].position,x=d[s].rotation,w=d[s].interpolation;p.push(_);for(var S=0;S<3;S++)f.push(y[S]+b[S]);for(S=0;S<4;S++)m.push(x[S]);for(S=0;S<3;S++)i(v,w,S);i(g,w,3)}var M=".bones["+c+"]";r.push(this._createTrack(M+".position",VectorKeyframeTrack,p,f,v)),r.push(this._createTrack(M+".quaternion",QuaternionKeyframeTrack,p,m,g))}return new AnimationClip("",-1,r)},buildMorphAnimation:function(e,t){for(var i=[],r={},n=t.morphTargetDictionary,o=0;o<e.metadata.morphCount;o++){var a=e.morphs[o],s=a.morphName;void 0!==n[s]&&(r[s]=r[s]||[],r[s].push(a))}for(var l in r){var u=r[l];u.sort(function(e,t){return e.frameNum-t.frameNum});for(var h=[],c=[],d=(o=0,u.length);o<d;o++)h.push(u[o].frameNum/30),c.push(u[o].weight);i.push(new NumberKeyframeTrack(".morphTargetInfluences["+n[l]+"]",h,c))}return new AnimationClip("",-1,i)},buildCameraAnimation:function(e){function t(e,t){e.push(t.x),e.push(t.y),e.push(t.z)}function i(e,t,i){e.push(t[4*i+0]/127),e.push(t[4*i+1]/127),e.push(t[4*i+2]/127),e.push(t[4*i+3]/127)}var r=[],n=void 0===e.cameras?[]:e.cameras.slice();n.sort(function(e,t){return e.frameNum-t.frameNum});for(var o,a,s=[],l=[],u=[],h=[],c=[],d=[],p=[],f=[],m=[],v=new Quaternion,g=new Euler,y=new Vector3,_=new Vector3,b=0,x=n.length;b<x;b++){var w=n[b],S=w.frameNum/30,M=w.position,T=w.rotation,A=w.distance,C=w.fov,L=w.interpolation;s.push(S),y.set(0,0,-A),_.set(M[0],M[1],M[2]),g.set(-T[0],-T[1],-T[2]),v.setFromEuler(g),y.add(_),y.applyQuaternion(v),t(l,_),(o=u).push((a=v).x),o.push(a.y),o.push(a.z),o.push(a.w),t(h,y),c.push(C);for(var N=0;N<3;N++)i(d,L,N);i(p,L,3);for(N=0;N<3;N++)i(f,L,4);i(m,L,5)}return(r=[]).push(this._createTrack("target.position",VectorKeyframeTrack,s,l,d)),r.push(this._createTrack(".quaternion",QuaternionKeyframeTrack,s,u,p)),r.push(this._createTrack(".position",VectorKeyframeTrack,s,h,f)),r.push(this._createTrack(".fov",NumberKeyframeTrack,s,c,m)),new AnimationClip("",-1,r)},_createTrack:function(e,t,i,r,n){if(i.length>2){i=i.slice(),r=r.slice(),n=n.slice();for(var o=r.length/i.length,s=n.length/i.length,l=1,u=2,h=i.length;u<h;u++){for(var c=0;c<o;c++)if(r[l*o+c]!==r[(l-1)*o+c]||r[l*o+c]!==r[u*o+c]){l++;break}if(u>l){i[l]=i[u];for(c=0;c<o;c++)r[l*o+c]=r[u*o+c];for(c=0;c<s;c++)n[l*s+c]=n[u*s+c]}}i.length=l+1,r.length=(l+1)*o,n.length=(l+1)*s}var d=new t(e,i,r);return d.createInterpolant=function(e){return new a(this.times,this.values,this.getValueSize(),e,new Float32Array(n))},d}},a.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:a,interpolate_:function(e,t,i,r){var n=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=this.interpolationParams,l=e*a,u=l-a,h=r-t<.05?0:(i-t)/(r-t);if(4===a){var c=s[4*e+0],d=s[4*e+1],p=s[4*e+2],f=s[4*e+3],m=this._calculate(c,d,p,f,h);Quaternion.slerpFlat(n,0,o,u,o,l,m)}else if(3===a)for(var v=0;v!==a;++v){c=s[12*e+4*v+0],d=s[12*e+4*v+1],p=s[12*e+4*v+2],f=s[12*e+4*v+3],m=this._calculate(c,d,p,f,h);n[v]=o[u+v]*(1-m)+o[l+v]*m}else{c=s[4*e+0],d=s[4*e+1],p=s[4*e+2],f=s[4*e+3],m=this._calculate(c,d,p,f,h);n[0]=o[u]*(1-m)+o[l]*m}return n},_calculate:function(e,t,i,r,n){for(var o,a,s,l=.5,u=l,h=1-u,c=Math,d=0;d<15;d++){var p=(o=3*h*h*u)*e+(a=3*h*u*u)*t+(s=u*u*u)-n;if(c.abs(p)<1e-5)break;l/=2,h=1-(u+=p<0?l:-l)}return o*i+a*r+s}}),e}(),MTLLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager};MTLLoader.prototype={constructor:MTLLoader,load:function(e,t,i,r){var n=this,o=void 0===this.path?LoaderUtils.extractUrlBase(e):this.path,a=new FileLoader(this.manager);a.setPath(this.path),a.load(e,function(e){t(n.parse(e,o))},i,r)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setTexturePath:function(e){return console.warn("MTLLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setMaterialOptions:function(e){return this.materialOptions=e,this},parse:function(e,t){for(var i=e.split("\n"),r={},n=/\s+/,o={},a=0;a<i.length;a++){var s=i[a];if(0!==(s=s.trim()).length&&"#"!==s.charAt(0)){var l=s.indexOf(" "),u=l>=0?s.substring(0,l):s;u=u.toLowerCase();var h=l>=0?s.substring(l+1):"";if(h=h.trim(),"newmtl"===u)r={name:h},o[h]=r;else if("ka"===u||"kd"===u||"ks"===u||"ke"===u){var c=h.split(n,3);r[u]=[parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2])]}else r[u]=h}}var d=new MTLLoader.MaterialCreator(this.resourcePath||t,this.materialOptions);return d.setCrossOrigin(this.crossOrigin),d.setManager(this.manager),d.setMaterials(o),d}},MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e||"",this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:RepeatWrapping},MTLLoader.MaterialCreator.prototype={constructor:MTLLoader.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var i in e){var r=e[i],n={};for(var o in t[i]=n,r){var a=!0,s=r[o],l=o.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(a=!1)}a&&(n[l]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this,i=this.materialsInfo[e],r={name:e,side:this.side};function n(e,i){if(!r[e]){var n,o,a=t.getTextureParams(i,r),s=t.loadTexture((n=t.baseUrl,"string"!=typeof(o=a.url)||""===o?"":/^https?:\/\//i.test(o)?o:n+o));s.repeat.copy(a.scale),s.offset.copy(a.offset),s.wrapS=t.wrap,s.wrapT=t.wrap,r[e]=s}}for(var o in i){var a,s=i[o];if(""!==s)switch(o.toLowerCase()){case"kd":r.color=(new Color).fromArray(s);break;case"ks":r.specular=(new Color).fromArray(s);break;case"ke":r.emissive=(new Color).fromArray(s);break;case"map_kd":n("map",s);break;case"map_ks":n("specularMap",s);break;case"map_ke":n("emissiveMap",s);break;case"norm":n("normalMap",s);break;case"map_bump":case"bump":n("bumpMap",s);break;case"map_d":n("alphaMap",s),r.transparent=!0;break;case"ns":r.shininess=parseFloat(s);break;case"d":(a=parseFloat(s))<1&&(r.opacity=a,r.transparent=!0);break;case"tr":a=parseFloat(s),this.options&&this.options.invertTrProperty&&(a=1-a),a>0&&(r.opacity=1-a,r.transparent=!0)}}return this.materials[e]=new MeshPhongMaterial(r),this.materials[e]},getTextureParams:function(e,t){var i,r={scale:new Vector2(1,1),offset:new Vector2(0,0)},n=e.split(/\s+/);return(i=n.indexOf("-bm"))>=0&&(t.bumpScale=parseFloat(n[i+1]),n.splice(i,2)),(i=n.indexOf("-s"))>=0&&(r.scale.set(parseFloat(n[i+1]),parseFloat(n[i+2])),n.splice(i,4)),(i=n.indexOf("-o"))>=0&&(r.offset.set(parseFloat(n[i+1]),parseFloat(n[i+2])),n.splice(i,4)),r.url=n.join(" ").trim(),r},loadTexture:function(e,t,i,r,n){var o,a=Loader$1.Handlers.get(e),s=void 0!==this.manager?this.manager:DefaultLoadingManager;return null===a&&(a=new TextureLoader(s)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin),o=a.load(e,i,r,n),void 0!==t&&(o.mapping=t),o}};var NodeMaterialLoader=function(e,t){this.manager=void 0!==e?e:DefaultLoadingManager,this.nodes={},this.materials={},this.passes={},this.names={},this.library=t||{}};Object.assign(NodeMaterialLoader.prototype,{load:function(e,t,i,r){var n=this,o=new FileLoader(n.manager);return o.setPath(n.path),o.load(e,function(e){t(n.parse(JSON.parse(e)))},i,r),this},setPath:function(e){return this.path=e,this},getObjectByName:function(e){return this.names[e]},getObjectById:function(e){return this.library[e]||this.nodes[e]||this.materials[e]||this.passes[e]||this.names[e]},getNode:function(e){var t=this.getObjectById(e);return t||console.warn('Node "'+e+'" not found.'),t},resolve:function(e){switch(typeof e){case"boolean":case"number":return e;case"string":return/^\w{8}-\w{4}-\w{4}-\w{4}-\w{12}$/i.test(e)||this.library[e]?this.getNode(e):e;default:if(Array.isArray(e))for(var t=0;t<e.length;t++)e[t]=this.resolve(e[t]);else for(var i in e)"uuid"!==i&&(e[i]=this.resolve(e[i]))}return e},declare:function(e){var t,i,r;for(t in e.nodes)i=e.nodes[t],r=new THREE[i.nodeType+"Node"],i.name&&(r.name=i.name,this.names[r.name]=r),this.nodes[t]=r;for(t in e.materials)i=e.materials[t],r=new THREE[i.type],i.name&&(r.name=i.name,this.names[r.name]=r),this.materials[t]=r;for(t in e.passes)i=e.passes[t],r=new THREE[i.type],i.name&&(r.name=i.name,this.names[r.name]=r),this.passes[t]=r;return e.material&&(this.material=this.materials[e.material]),e.pass&&(this.pass=this.passes[e.pass]),e},parse:function(e){var t;for(t in(e=this.resolve(this.declare(e))).nodes)this.nodes[t].copy(e.nodes[t]);for(t in e.materials)this.materials[t].copy(e.materials[t]);for(t in e.passes)this.passes[t].copy(e.passes[t]);return this.material||this.pass||this}});var OBJLoader=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,i=/^usemtl /;function r(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var i=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);var r={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==i?i.smooth:this.smooth,groupStart:void 0!==i?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var i=this.materials.length-1;i>=0;i--)this.materials[i].groupCount<=0&&this.materials.splice(i,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},i&&i.name&&"function"==typeof i.clone){var r=i.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseNormalIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseUVIndex:function(e,t){var i=parseInt(e,10);return 2*(i>=0?i-1:i+t/2)},addVertex:function(e,t,i){var r=this.vertices,n=this.object.geometry.vertices;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){var r=this.normals,n=this.object.geometry.normals;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addColor:function(e,t,i){var r=this.colors,n=this.object.geometry.colors;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addUV:function(e,t,i){var r=this.uvs,n=this.object.geometry.uvs;n.push(r[e+0],r[e+1]),n.push(r[t+0],r[t+1]),n.push(r[i+0],r[i+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,r,n,o,a,s,l){var u=this.vertices.length,h=this.parseVertexIndex(e,u),c=this.parseVertexIndex(t,u),d=this.parseVertexIndex(i,u);if(this.addVertex(h,c,d),void 0!==r&&""!==r){var p=this.uvs.length;h=this.parseUVIndex(r,p),c=this.parseUVIndex(n,p),d=this.parseUVIndex(o,p),this.addUV(h,c,d)}if(void 0!==a&&""!==a){var f=this.normals.length;h=this.parseNormalIndex(a,f),c=a===s?h:this.parseNormalIndex(s,f),d=a===l?h:this.parseNormalIndex(l,f),this.addNormal(h,c,d)}this.colors.length>0&&this.addColor(h,c,d)},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,i=0,r=e.length;i<r;i++)this.addVertexPoint(this.parseVertexIndex(e[i],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var i=this.vertices.length,r=this.uvs.length,n=0,o=e.length;n<o;n++)this.addVertexLine(this.parseVertexIndex(e[n],i));var a=0;for(o=t.length;a<o;a++)this.addUVLine(this.parseUVIndex(t[a],r))}};return e.startObject("",!1),e}function n(e){this.manager=void 0!==e?e:DefaultLoadingManager,this.materials=null}return n.prototype={constructor:n,load:function(e,t,i,r){var n=this,o=new FileLoader(n.manager);o.setPath(this.path),o.load(e,function(e){t(n.parse(e))},i,r)},setPath:function(e){return this.path=e,this},setMaterials:function(e){return this.materials=e,this},parse:function(n){console.time("OBJLoader");var o=new r;-1!==n.indexOf("\r\n")&&(n=n.replace(/\r\n/g,"\n")),-1!==n.indexOf("\\\n")&&(n=n.replace(/\\\n/g,""));for(var a=n.split("\n"),s="",l="",u=[],h="function"==typeof"".trimLeft,c=0,d=a.length;c<d;c++)if(s=a[c],0!==(s=h?s.trimLeft():s.trim()).length&&"#"!==(l=s.charAt(0)))if("v"===l){var p=s.split(/\s+/);switch(p[0]){case"v":o.vertices.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])),8===p.length&&o.colors.push(parseFloat(p[4]),parseFloat(p[5]),parseFloat(p[6]));break;case"vn":o.normals.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3]));break;case"vt":o.uvs.push(parseFloat(p[1]),parseFloat(p[2]))}}else if("f"===l){for(var f=s.substr(1).trim().split(/\s+/),m=[],v=0,g=f.length;v<g;v++){var y=f[v];if(y.length>0){var _=y.split("/");m.push(_)}}var b=m[0];for(v=1,g=m.length-1;v<g;v++){var x=m[v],w=m[v+1];o.addFace(b[0],x[0],w[0],b[1],x[1],w[1],b[2],x[2],w[2])}}else if("l"===l){var S=s.substring(1).trim().split(" "),M=[],T=[];if(-1===s.indexOf("/"))M=S;else for(var A=0,C=S.length;A<C;A++){var L=S[A].split("/");""!==L[0]&&M.push(L[0]),""!==L[1]&&T.push(L[1])}o.addLineGeometry(M,T)}else if("p"===l){var N=s.substr(1).trim().split(" ");o.addPointGeometry(N)}else if(null!==(u=e.exec(s))){var P=(" "+u[0].substr(1).trim()).substr(1);o.startObject(P)}else if(i.test(s))o.object.startMaterial(s.substring(7).trim(),o.materialLibraries);else if(t.test(s))o.materialLibraries.push(s.substring(7).trim());else{if("s"!==l){if("\0"===s)continue;throw new Error('OBJLoader: Unexpected line: "'+s+'"')}if((u=s.split(" ")).length>1){var k=u[1].trim().toLowerCase();o.object.smooth="0"!==k&&"off"!==k}else o.object.smooth=!0;(H=o.object.currentMaterial())&&(H.smooth=o.object.smooth)}o.finalize();var E=new Group;E.materialLibraries=[].concat(o.materialLibraries);for(c=0,d=o.objects.length;c<d;c++){var D=o.objects[c],O=D.geometry,R=D.materials,F="Line"===O.type,I="Points"===O.type,B=!1;if(0!==O.vertices.length){var U=new BufferGeometry;U.addAttribute("position",new Float32BufferAttribute(O.vertices,3)),O.normals.length>0?U.addAttribute("normal",new Float32BufferAttribute(O.normals,3)):U.computeVertexNormals(),O.colors.length>0&&(B=!0,U.addAttribute("color",new Float32BufferAttribute(O.colors,3))),O.uvs.length>0&&U.addAttribute("uv",new Float32BufferAttribute(O.uvs,2));for(var V,z=[],G=0,j=R.length;G<j;G++){var W=R[G],H=void 0;if(null!==this.materials)if(H=this.materials.create(W.name),!F||!H||H instanceof LineBasicMaterial){if(I&&H&&!(H instanceof PointsMaterial)){var q=new PointsMaterial({size:10,sizeAttenuation:!1});Material.prototype.copy.call(q,H),q.color.copy(H.color),q.map=H.map,q.lights=!1,H=q}}else{var Y=new LineBasicMaterial;Material.prototype.copy.call(Y,H),Y.color.copy(H.color),Y.lights=!1,H=Y}H||((H=F?new LineBasicMaterial:I?new PointsMaterial({size:1,sizeAttenuation:!1}):new MeshPhongMaterial).name=W.name),H.flatShading=!W.smooth,H.vertexColors=B?VertexColors:NoColors,z.push(H)}if(z.length>1){for(G=0,j=R.length;G<j;G++){W=R[G];U.addGroup(W.groupStart,W.groupCount,G)}V=F?new LineSegments(U,z):I?new Points(U,z):new Mesh(U,z)}else V=F?new LineSegments(U,z[0]):I?new Points(U,z[0]):new Mesh(U,z[0]);V.name=D.name,E.add(V)}}return console.timeEnd("OBJLoader"),E}},n}();void 0===LoaderSupport&&console.error('"LoaderSupport" is not available. "OBJLoader2" requires it. Please include "LoaderSupport.js" in your HTML.');var OBJLoader2=function(e){console.info("Using OBJLoader2 version: "+OBJLoader2.OBJLOADER2_VERSION),this.manager=LoaderSupport.Validator.verifyInput(e,DefaultLoadingManager),this.logging={enabled:!0,debug:!1},this.modelName="",this.instanceNo=0,this.path,this.resourcePath,this.useIndices=!1,this.disregardNormals=!1,this.materialPerSmoothingGroup=!1,this.useOAsMesh=!1,this.loaderRootNode=new Group,this.meshBuilder=new LoaderSupport.MeshBuilder,this.callbacks=new LoaderSupport.Callbacks,this.workerSupport=new LoaderSupport.WorkerSupport,this.terminateWorkerOnLoad=!0};OBJLoader2.OBJLOADER2_VERSION="2.5.0",OBJLoader2.prototype={constructor:OBJLoader2,setLogging:function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t,this.meshBuilder.setLogging(this.logging.enabled,this.logging.debug)},setModelName:function(e){this.modelName=LoaderSupport.Validator.verifyInput(e,this.modelName)},setPath:function(e){this.path=LoaderSupport.Validator.verifyInput(e,this.path)},setResourcePath:function(e){this.resourcePath=LoaderSupport.Validator.verifyInput(e,this.resourcePath)},setStreamMeshesTo:function(e){this.loaderRootNode=LoaderSupport.Validator.verifyInput(e,this.loaderRootNode)},setMaterials:function(e){this.meshBuilder.setMaterials(e)},setUseIndices:function(e){this.useIndices=!0===e},setDisregardNormals:function(e){this.disregardNormals=!0===e},setMaterialPerSmoothingGroup:function(e){this.materialPerSmoothingGroup=!0===e},setUseOAsMesh:function(e){this.useOAsMesh=!0===e},_setCallbacks:function(e){LoaderSupport.Validator.isValid(e.onProgress)&&this.callbacks.setCallbackOnProgress(e.onProgress),LoaderSupport.Validator.isValid(e.onReportError)&&this.callbacks.setCallbackOnReportError(e.onReportError),LoaderSupport.Validator.isValid(e.onMeshAlter)&&this.callbacks.setCallbackOnMeshAlter(e.onMeshAlter),LoaderSupport.Validator.isValid(e.onLoad)&&this.callbacks.setCallbackOnLoad(e.onLoad),LoaderSupport.Validator.isValid(e.onLoadMaterials)&&this.callbacks.setCallbackOnLoadMaterials(e.onLoadMaterials),this.meshBuilder._setCallbacks(this.callbacks)},onProgress:function(e,t,i){var r=LoaderSupport.Validator.isValid(t)?t:"",n={detail:{type:e,modelName:this.modelName,instanceNo:this.instanceNo,text:r,numericalValue:i}};LoaderSupport.Validator.isValid(this.callbacks.onProgress)&&this.callbacks.onProgress(n),this.logging.enabled&&this.logging.debug&&console.debug(r)},_onError:function(e){var t="Error occurred while downloading!";e.currentTarget&&null!==e.currentTarget.statusText&&(t+="\nurl: "+e.currentTarget.responseURL+"\nstatus: "+e.currentTarget.statusText),this.onProgress("error",t,-1),this._throwError(t)},_throwError:function(e){if(!LoaderSupport.Validator.isValid(this.callbacks.onReportError))throw e;this.callbacks.onReportError(e)},load:function(e,t,i,r,n,o){var a=new LoaderSupport.ResourceDescriptor(e,"OBJ");this._loadObj(a,t,i,r,n,o)},_loadObj:function(e,t,i,r,n,o){var a=this;LoaderSupport.Validator.isValid(r)||(r=function(e){a._onError(e)}),LoaderSupport.Validator.isValid(e)||r("An invalid ResourceDescriptor was provided. Unable to continue!");var s=function(i){if(e.content=i,o)a.parseAsync(i,t);else{var r=new LoaderSupport.Callbacks;r.setCallbackOnMeshAlter(n),a._setCallbacks(r),t({detail:{loaderRootNode:a.parse(i),modelName:a.modelName,instanceNo:a.instanceNo}})}};if(this.setPath(e.path),this.setResourcePath(e.resourcePath),!LoaderSupport.Validator.isValid(e.url)||LoaderSupport.Validator.isValid(e.content))s(LoaderSupport.Validator.isValid(e.content)?e.content:null);else{if(!LoaderSupport.Validator.isValid(i)){var l=0,u=0;i=function(t){if(t.lengthComputable&&(u=t.loaded/t.total)>l){l=u;var i='Download of "'+e.url+'": '+(100*u).toFixed(2)+"%";a.onProgress("progressLoad",i,u)}}}var h=new FileLoader(this.manager);h.setPath(this.path||this.resourcePath),h.setResponseType("arraybuffer"),h.load(e.name,s,i,r)}},run:function(e,t){this._applyPrepData(e);var i=e.checkResourceDescriptorFiles(e.resources,[{ext:"obj",type:"ArrayBuffer",ignore:!1},{ext:"mtl",type:"String",ignore:!1},{ext:"zip",type:"String",ignore:!0}]);LoaderSupport.Validator.isValid(t)&&(this.terminateWorkerOnLoad=!1,this.workerSupport=t,this.logging.enabled=this.workerSupport.logging.enabled,this.logging.debug=this.workerSupport.logging.debug);var r=this;this._loadMtl(i.mtl,function(t){null!==t&&r.meshBuilder.setMaterials(t),r._loadObj(i.obj,r.callbacks.onLoad,null,null,r.callbacks.onMeshAlter,e.useAsync)},null,null,e.crossOrigin,e.materialOptions)},_applyPrepData:function(e){LoaderSupport.Validator.isValid(e)&&(this.setLogging(e.logging.enabled,e.logging.debug),this.setModelName(e.modelName),this.setStreamMeshesTo(e.streamMeshesTo),this.meshBuilder.setMaterials(e.materials),this.setUseIndices(e.useIndices),this.setDisregardNormals(e.disregardNormals),this.setMaterialPerSmoothingGroup(e.materialPerSmoothingGroup),this.setUseOAsMesh(e.useOAsMesh),this._setCallbacks(e.getCallbacks()))},parse:function(e){if(!LoaderSupport.Validator.isValid(e))return console.warn("Provided content is not a valid ArrayBuffer or String."),this.loaderRootNode;this.logging.enabled&&console.time("OBJLoader2 parse: "+this.modelName),this.meshBuilder.init();var t=new OBJLoader2.Parser;t.setLogging(this.logging.enabled,this.logging.debug),t.setMaterialPerSmoothingGroup(this.materialPerSmoothingGroup),t.setUseOAsMesh(this.useOAsMesh),t.setUseIndices(this.useIndices),t.setDisregardNormals(this.disregardNormals),t.setMaterials(this.meshBuilder.getMaterials());var i=this;t.setCallbackMeshBuilder(function(e){var t,r=i.meshBuilder.processPayload(e);for(var n in r)t=r[n],i.loaderRootNode.add(t)});return t.setCallbackProgress(function(e,t){i.onProgress("progressParse",e,t)}),e instanceof ArrayBuffer||e instanceof Uint8Array?(this.logging.enabled&&console.info("Parsing arrayBuffer..."),t.parse(e)):"string"==typeof e||e instanceof String?(this.logging.enabled&&console.info("Parsing text..."),t.parseText(e)):this._throwError("Provided content was neither of type String nor Uint8Array! Aborting..."),this.logging.enabled&&console.timeEnd("OBJLoader2 parse: "+this.modelName),this.loaderRootNode},parseAsync:function(e,t){var i=this,r=!1,n=function(){t({detail:{loaderRootNode:i.loaderRootNode,modelName:i.modelName,instanceNo:i.instanceNo}}),r&&i.logging.enabled&&console.timeEnd("OBJLoader2 parseAsync: "+i.modelName)};LoaderSupport.Validator.isValid(e)?r=!0:(console.warn("Provided content is not a valid ArrayBuffer."),n()),r&&this.logging.enabled&&console.time("OBJLoader2 parseAsync: "+this.modelName),this.meshBuilder.init();this.workerSupport.validate(function(e){var t="";return t+="\n\n",t+="THREE = { LoaderSupport: {}, OBJLoader2: {} };\n\n",t+=e.serializeObject("LoaderSupport.Validator",LoaderSupport.Validator),t+=e.serializeClass("OBJLoader2.Parser",OBJLoader2.Parser)},"OBJLoader2.Parser"),this.workerSupport.setCallbacks(function(e){var t,r=i.meshBuilder.processPayload(e);for(var n in r)t=r[n],i.loaderRootNode.add(t)},n),i.terminateWorkerOnLoad&&this.workerSupport.setTerminateRequested(!0);var o={},a=this.meshBuilder.getMaterials();for(var s in a)o[s]=s;this.workerSupport.run({params:{useAsync:!0,materialPerSmoothingGroup:this.materialPerSmoothingGroup,useOAsMesh:this.useOAsMesh,useIndices:this.useIndices,disregardNormals:this.disregardNormals},logging:{enabled:this.logging.enabled,debug:this.logging.debug},materials:{materials:o},data:{input:e,options:null}})},loadMtl:function(e,t,i,r,n,o,a){var s=new LoaderSupport.ResourceDescriptor(e,"MTL");s.setContent(t),this._loadMtl(s,i,r,n,o,a)},_loadMtl:function(e,t,i,r,n,o){void 0===MTLLoader&&console.error('"MTLLoader" is not available. "OBJLoader2" requires it for loading MTL files.'),LoaderSupport.Validator.isValid(e)&&this.logging.enabled&&console.time("Loading MTL: "+e.name);var a=[],s=this,l=function(i){var r=[];if(LoaderSupport.Validator.isValid(i))for(var n in i.preload(),r=i.materials)r.hasOwnProperty(n)&&(a[n]=r[n]);LoaderSupport.Validator.isValid(e)&&s.logging.enabled&&console.timeEnd("Loading MTL: "+e.name),t(a,i)};if(LoaderSupport.Validator.isValid(e)&&(LoaderSupport.Validator.isValid(e.content)||LoaderSupport.Validator.isValid(e.url))){var u=new MTLLoader(this.manager);n=LoaderSupport.Validator.verifyInput(n,"anonymous"),u.setCrossOrigin(n),u.setResourcePath(e.resourcePath||e.path),LoaderSupport.Validator.isValid(o)&&u.setMaterialOptions(o);var h=function(e){var t=e;"string"==typeof e||e instanceof String||(e.length>0||e.byteLength>0?t=LoaderUtils.decodeText(e):this._throwError("Unable to parse mtl as it it seems to be neither a String, an Array or an ArrayBuffer!")),l(u.parse(t))};if(LoaderSupport.Validator.isValid(e.content))h(e.content);else if(LoaderSupport.Validator.isValid(e.url)){var c=new FileLoader(this.manager);if(LoaderSupport.Validator.isValid(r)||(r=function(e){s._onError(e)}),!LoaderSupport.Validator.isValid(i)){var d=0,p=0;i=function(t){if(t.lengthComputable&&(p=t.loaded/t.total)>d){d=p;var i='Download of "'+e.url+'": '+(100*p).toFixed(2)+"%";s.onProgress("progressLoad",i,p)}}}c.load(e.url,h,i,r)}}else l()}},OBJLoader2.Parser=function(){this.callbackProgress=null,this.callbackMeshBuilder=null,this.contentRef=null,this.legacyMode=!1,this.materials={},this.useAsync=!1,this.materialPerSmoothingGroup=!1,this.useOAsMesh=!1,this.useIndices=!1,this.disregardNormals=!1,this.vertices=[],this.colors=[],this.normals=[],this.uvs=[],this.rawMesh={objectName:"",groupName:"",activeMtlName:"",mtllibName:"",faceType:-1,subGroups:[],subGroupInUse:null,smoothingGroup:{splitMaterials:!1,normalized:-1,real:-1},counts:{doubleIndicesCount:0,faceCount:0,mtlCount:0,smoothingGroupCount:0}},this.inputObjectCount=1,this.outputObjectCount=1,this.globalCounts={vertices:0,faces:0,doubleIndicesCount:0,lineByte:0,currentByte:0,totalBytes:0},this.logging={enabled:!0,debug:!1}},OBJLoader2.Parser.prototype={constructor:OBJLoader2.Parser,resetRawMesh:function(){this.rawMesh.subGroups=[],this.rawMesh.subGroupInUse=null,this.rawMesh.smoothingGroup.normalized=-1,this.rawMesh.smoothingGroup.real=-1,this.pushSmoothingGroup(1),this.rawMesh.counts.doubleIndicesCount=0,this.rawMesh.counts.faceCount=0,this.rawMesh.counts.mtlCount=0,this.rawMesh.counts.smoothingGroupCount=0},setUseAsync:function(e){this.useAsync=e},setMaterialPerSmoothingGroup:function(e){this.materialPerSmoothingGroup=e},setUseOAsMesh:function(e){this.useOAsMesh=e},setUseIndices:function(e){this.useIndices=e},setDisregardNormals:function(e){this.disregardNormals=e},setMaterials:function(e){this.materials=LoaderSupport.Validator.verifyInput(e,this.materials),this.materials=LoaderSupport.Validator.verifyInput(this.materials,{})},setCallbackMeshBuilder:function(e){LoaderSupport.Validator.isValid(e)||this._throwError('Unable to run as no "MeshBuilder" callback is set.'),this.callbackMeshBuilder=e},setCallbackProgress:function(e){this.callbackProgress=e},setLogging:function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},configure:function(){if(this.pushSmoothingGroup(1),this.logging.enabled){var e=Object.keys(this.materials),t="OBJLoader2.Parser configuration:"+(e.length>0?"\n\tmaterialNames:\n\t\t- "+e.join("\n\t\t- "):"\n\tmaterialNames: None")+"\n\tuseAsync: "+this.useAsync+"\n\tmaterialPerSmoothingGroup: "+this.materialPerSmoothingGroup+"\n\tuseOAsMesh: "+this.useOAsMesh+"\n\tuseIndices: "+this.useIndices+"\n\tdisregardNormals: "+this.disregardNormals+"\n\tcallbackMeshBuilderName: "+this.callbackMeshBuilder.name+"\n\tcallbackProgressName: "+this.callbackProgress.name;console.info(t)}},parse:function(e){this.logging.enabled&&console.time("OBJLoader2.Parser.parse"),this.configure();var t=new Uint8Array(e);this.contentRef=t;var i=t.byteLength;this.globalCounts.totalBytes=i;for(var r,n=new Array(128),o="",a=0,s=0,l=0;l<i;l++)switch(r=t[l]){case 32:o.length>0&&(n[a++]=o),o="";break;case 47:o.length>0&&(n[a++]=o),s++,o="";break;case 10:o.length>0&&(n[a++]=o),o="",this.globalCounts.lineByte=this.globalCounts.currentByte,this.globalCounts.currentByte=l,this.processLine(n,a,s),a=0,s=0;break;case 13:break;default:o+=String.fromCharCode(r)}this.finalizeParsing(),this.logging.enabled&&console.timeEnd("OBJLoader2.Parser.parse")},parseText:function(e){this.logging.enabled&&console.time("OBJLoader2.Parser.parseText"),this.configure(),this.legacyMode=!0,this.contentRef=e;var t=e.length;this.globalCounts.totalBytes=t;for(var i,r=new Array(128),n="",o=0,a=0,s=0;s<t;s++)switch(i=e[s]){case" ":n.length>0&&(r[o++]=n),n="";break;case"/":n.length>0&&(r[o++]=n),a++,n="";break;case"\n":n.length>0&&(r[o++]=n),n="",this.globalCounts.lineByte=this.globalCounts.currentByte,this.globalCounts.currentByte=s,this.processLine(r,o,a),o=0,a=0;break;case"\r":break;default:n+=i}this.finalizeParsing(),this.logging.enabled&&console.timeEnd("OBJLoader2.Parser.parseText")},processLine:function(e,t,i){if(!(t<1)){var r,n,o,a,s=function(e,t,i,r){var n="";if(r>i){var o;if(t)for(o=i;o<r;o++)n+=e[o];else for(o=i;o<r;o++)n+=String.fromCharCode(e[o]);n=n.trim()}return n};switch(a=e[0]){case"v":this.vertices.push(parseFloat(e[1])),this.vertices.push(parseFloat(e[2])),this.vertices.push(parseFloat(e[3])),t>4&&(this.colors.push(parseFloat(e[4])),this.colors.push(parseFloat(e[5])),this.colors.push(parseFloat(e[6])));break;case"vt":this.uvs.push(parseFloat(e[1])),this.uvs.push(parseFloat(e[2]));break;case"vn":this.normals.push(parseFloat(e[1])),this.normals.push(parseFloat(e[2])),this.normals.push(parseFloat(e[3]));break;case"f":if(r=t-1,0===i)for(this.checkFaceType(0),o=2,n=r;o<n;o++)this.buildFace(e[1]),this.buildFace(e[o]),this.buildFace(e[o+1]);else if(r===2*i)for(this.checkFaceType(1),o=3,n=r-2;o<n;o+=2)this.buildFace(e[1],e[2]),this.buildFace(e[o],e[o+1]),this.buildFace(e[o+2],e[o+3]);else if(2*r==3*i)for(this.checkFaceType(2),o=4,n=r-3;o<n;o+=3)this.buildFace(e[1],e[2],e[3]),this.buildFace(e[o],e[o+1],e[o+2]),this.buildFace(e[o+3],e[o+4],e[o+5]);else for(this.checkFaceType(3),o=3,n=r-2;o<n;o+=2)this.buildFace(e[1],void 0,e[2]),this.buildFace(e[o],void 0,e[o+1]),this.buildFace(e[o+2],void 0,e[o+3]);break;case"l":case"p":if((r=t-1)===2*i)for(this.checkFaceType(4),o=1,n=r+1;o<n;o+=2)this.buildFace(e[o],e[o+1]);else for(this.checkFaceType("l"===a?5:6),o=1,n=r+1;o<n;o++)this.buildFace(e[o]);break;case"s":this.pushSmoothingGroup(e[1]);break;case"g":this.processCompletedMesh(),this.rawMesh.groupName=s(this.contentRef,this.legacyMode,this.globalCounts.lineByte+2,this.globalCounts.currentByte);break;case"o":this.useOAsMesh&&this.processCompletedMesh(),this.rawMesh.objectName=s(this.contentRef,this.legacyMode,this.globalCounts.lineByte+2,this.globalCounts.currentByte);break;case"mtllib":this.rawMesh.mtllibName=s(this.contentRef,this.legacyMode,this.globalCounts.lineByte+7,this.globalCounts.currentByte);break;case"usemtl":var l=s(this.contentRef,this.legacyMode,this.globalCounts.lineByte+7,this.globalCounts.currentByte);""!==l&&this.rawMesh.activeMtlName!==l&&(this.rawMesh.activeMtlName=l,this.rawMesh.counts.mtlCount++,this.checkSubGroup())}}},pushSmoothingGroup:function(e){var t=parseInt(e);isNaN(t)&&(t="off"===e?0:1);var i=this.rawMesh.smoothingGroup.normalized;this.rawMesh.smoothingGroup.normalized=this.rawMesh.smoothingGroup.splitMaterials?t:0===t?0:1,this.rawMesh.smoothingGroup.real=t,i!==t&&(this.rawMesh.counts.smoothingGroupCount++,this.checkSubGroup())},checkFaceType:function(e){this.rawMesh.faceType!==e&&(this.processCompletedMesh(),this.rawMesh.faceType=e,this.checkSubGroup())},checkSubGroup:function(){var e=this.rawMesh.activeMtlName+"|"+this.rawMesh.smoothingGroup.normalized;this.rawMesh.subGroupInUse=this.rawMesh.subGroups[e],LoaderSupport.Validator.isValid(this.rawMesh.subGroupInUse)||(this.rawMesh.subGroupInUse={index:e,objectName:this.rawMesh.objectName,groupName:this.rawMesh.groupName,materialName:this.rawMesh.activeMtlName,smoothingGroup:this.rawMesh.smoothingGroup.normalized,vertices:[],indexMappingsCount:0,indexMappings:[],indices:[],colors:[],uvs:[],normals:[]},this.rawMesh.subGroups[e]=this.rawMesh.subGroupInUse)},buildFace:function(e,t,i){this.disregardNormals&&(i=void 0);var r=this,n=function(){var n=parseInt(e),o=3*(n>0?n-1:n+r.vertices.length/3),a=r.colors.length>0?o:null,s=r.rawMesh.subGroupInUse.vertices;if(s.push(r.vertices[o++]),s.push(r.vertices[o++]),s.push(r.vertices[o]),null!==a){var l=r.rawMesh.subGroupInUse.colors;l.push(r.colors[a++]),l.push(r.colors[a++]),l.push(r.colors[a])}if(t){var u=parseInt(t),h=2*(u>0?u-1:u+r.uvs.length/2),c=r.rawMesh.subGroupInUse.uvs;c.push(r.uvs[h++]),c.push(r.uvs[h])}if(i){var d=parseInt(i),p=3*(d>0?d-1:d+r.normals.length/3),f=r.rawMesh.subGroupInUse.normals;f.push(r.normals[p++]),f.push(r.normals[p++]),f.push(r.normals[p])}};if(this.useIndices){var o=e+(t?"_"+t:"_n")+(i?"_"+i:"_n"),a=this.rawMesh.subGroupInUse.indexMappings[o];LoaderSupport.Validator.isValid(a)?this.rawMesh.counts.doubleIndicesCount++:(a=this.rawMesh.subGroupInUse.vertices.length/3,n(),this.rawMesh.subGroupInUse.indexMappings[o]=a,this.rawMesh.subGroupInUse.indexMappingsCount++),this.rawMesh.subGroupInUse.indices.push(a)}else n();this.rawMesh.counts.faceCount++},createRawMeshReport:function(e){return"Input Object number: "+e+"\n\tObject name: "+this.rawMesh.objectName+"\n\tGroup name: "+this.rawMesh.groupName+"\n\tMtllib name: "+this.rawMesh.mtllibName+"\n\tVertex count: "+this.vertices.length/3+"\n\tNormal count: "+this.normals.length/3+"\n\tUV count: "+this.uvs.length/2+"\n\tSmoothingGroup count: "+this.rawMesh.counts.smoothingGroupCount+"\n\tMaterial count: "+this.rawMesh.counts.mtlCount+"\n\tReal MeshOutputGroup count: "+this.rawMesh.subGroups.length},finalizeRawMesh:function(){var e,t,i=[],r=0,n=0,o=0,a=0,s=0,l=0;for(var u in this.rawMesh.subGroups)if((e=this.rawMesh.subGroups[u]).vertices.length>0){if((t=e.indices).length>0&&n>0)for(var h in t)t[h]=t[h]+n;i.push(e),r+=e.vertices.length,n+=e.indexMappingsCount,o+=e.indices.length,a+=e.colors.length,l+=e.uvs.length,s+=e.normals.length}var c=null;return i.length>0&&(c={name:""!==this.rawMesh.groupName?this.rawMesh.groupName:this.rawMesh.objectName,subGroups:i,absoluteVertexCount:r,absoluteIndexCount:o,absoluteColorCount:a,absoluteNormalCount:s,absoluteUvCount:l,faceCount:this.rawMesh.counts.faceCount,doubleIndicesCount:this.rawMesh.counts.doubleIndicesCount}),c},processCompletedMesh:function(){var e=this.finalizeRawMesh();if(LoaderSupport.Validator.isValid(e)){this.colors.length>0&&this.colors.length!==this.vertices.length&&this._throwError("Vertex Colors were detected, but vertex count and color count do not match!"),this.logging.enabled&&this.logging.debug&&console.debug(this.createRawMeshReport(this.inputObjectCount)),this.inputObjectCount++,this.buildMesh(e);var t=this.globalCounts.currentByte/this.globalCounts.totalBytes;return this.callbackProgress("Completed [o: "+this.rawMesh.objectName+" g:"+this.rawMesh.groupName+"] Total progress: "+(100*t).toFixed(2)+"%",t),this.resetRawMesh(),!0}return!1},buildMesh:function(e){var t=e.subGroups,i=new Float32Array(e.absoluteVertexCount);this.globalCounts.vertices+=e.absoluteVertexCount/3,this.globalCounts.faces+=e.faceCount,this.globalCounts.doubleIndicesCount+=e.doubleIndicesCount;var r,n,o,a,s,l,u,h=e.absoluteIndexCount>0?new Uint32Array(e.absoluteIndexCount):null,c=e.absoluteColorCount>0?new Float32Array(e.absoluteColorCount):null,d=e.absoluteNormalCount>0?new Float32Array(e.absoluteNormalCount):null,p=e.absoluteUvCount>0?new Float32Array(e.absoluteUvCount):null,f=LoaderSupport.Validator.isValid(c),m=[],v=t.length>1,g=0,y=[],_=[],b=0,x=0,w=0,S=0,M=0,T=0,A=0;for(var C in t)if(t.hasOwnProperty(C)){if(u=(r=t[C]).materialName,l=this.rawMesh.faceType<4?u+(f?"_vertexColor":"")+(0===r.smoothingGroup?"_flat":""):6===this.rawMesh.faceType?"defaultPointMaterial":"defaultLineMaterial",a=this.materials[u],s=this.materials[l],!LoaderSupport.Validator.isValid(a)&&!LoaderSupport.Validator.isValid(s)){var L=f?"defaultVertexColorMaterial":"defaultMaterial";a=this.materials[L],this.logging.enabled&&console.warn('object_group "'+r.objectName+"_"+r.groupName+'" was defined with unresolvable material "'+u+'"! Assigning "'+L+'".'),(u=L)===l&&(s=a,l=L)}if(!LoaderSupport.Validator.isValid(s)){var N={materialNameOrg:u,materialName:l,materialProperties:{vertexColors:f?2:0,flatShading:0===r.smoothingGroup}},P={cmd:"materialData",materials:{materialCloneInstructions:N}};this.callbackMeshBuilder(P),this.useAsync&&(this.materials[l]=N)}if(v?((n=y[l])||(n=g,y[l]=g,m.push(l),g++),o={start:T,count:A=this.useIndices?r.indices.length:r.vertices.length/3,index:n},_.push(o),T+=A):m.push(l),i.set(r.vertices,b),b+=r.vertices.length,h&&(h.set(r.indices,x),x+=r.indices.length),c&&(c.set(r.colors,w),w+=r.colors.length),d&&(d.set(r.normals,S),S+=r.normals.length),p&&(p.set(r.uvs,M),M+=r.uvs.length),this.logging.enabled&&this.logging.debug){var k=LoaderSupport.Validator.isValid(n)?"\n\t\tmaterialIndex: "+n:"",E="\tOutput Object no.: "+this.outputObjectCount+"\n\t\tgroupName: "+r.groupName+"\n\t\tIndex: "+r.index+"\n\t\tfaceType: "+this.rawMesh.faceType+"\n\t\tmaterialName: "+r.materialName+"\n\t\tsmoothingGroup: "+r.smoothingGroup+k+"\n\t\tobjectName: "+r.objectName+"\n\t\t#vertices: "+r.vertices.length/3+"\n\t\t#indices: "+r.indices.length+"\n\t\t#colors: "+r.colors.length/3+"\n\t\t#uvs: "+r.uvs.length/2+"\n\t\t#normals: "+r.normals.length/3;console.debug(E)}}this.outputObjectCount++,this.callbackMeshBuilder({cmd:"meshData",progress:{numericalValue:this.globalCounts.currentByte/this.globalCounts.totalBytes},params:{meshName:e.name},materials:{multiMaterial:v,materialNames:m,materialGroups:_},buffers:{vertices:i,indices:h,colors:c,normals:d,uvs:p},geometryType:this.rawMesh.faceType<4?0:6===this.rawMesh.faceType?2:1},[i.buffer],LoaderSupport.Validator.isValid(h)?[h.buffer]:null,LoaderSupport.Validator.isValid(c)?[c.buffer]:null,LoaderSupport.Validator.isValid(d)?[d.buffer]:null,LoaderSupport.Validator.isValid(p)?[p.buffer]:null)},finalizeParsing:function(){if(this.logging.enabled&&console.info("Global output object count: "+this.outputObjectCount),this.processCompletedMesh()&&this.logging.enabled){var e="Overall counts: \n\tVertices: "+this.globalCounts.vertices+"\n\tFaces: "+this.globalCounts.faces+"\n\tMultiple definitions: "+this.globalCounts.doubleIndicesCount;console.info(e)}}};var PCDLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager,this.littleEndian=!0};PCDLoader.prototype={constructor:PCDLoader,load:function(e,t,i,r){var n=this,o=new FileLoader(n.manager);o.setPath(n.path),o.setResponseType("arraybuffer"),o.load(e,function(i){try{t(n.parse(i,e))}catch(e){if(!r)throw e;r(e)}},i,r)},setPath:function(e){return this.path=e,this},parse:function(e,t){var i=LoaderUtils.decodeText(e),r=function(e){var t={},i=e.search(/[\r\n]DATA\s(\S*)\s/i),r=/[\r\n]DATA\s(\S*)\s/i.exec(e.substr(i-1));if(t.data=r[1],t.headerLen=r[0].length+i,t.str=e.substr(0,t.headerLen),t.str=t.str.replace(/\#.*/gi,""),t.version=/VERSION (.*)/i.exec(t.str),t.fields=/FIELDS (.*)/i.exec(t.str),t.size=/SIZE (.*)/i.exec(t.str),t.type=/TYPE (.*)/i.exec(t.str),t.count=/COUNT (.*)/i.exec(t.str),t.width=/WIDTH (.*)/i.exec(t.str),t.height=/HEIGHT (.*)/i.exec(t.str),t.viewpoint=/VIEWPOINT (.*)/i.exec(t.str),t.points=/POINTS (.*)/i.exec(t.str),null!==t.version&&(t.version=parseFloat(t.version[1])),null!==t.fields&&(t.fields=t.fields[1].split(" ")),null!==t.type&&(t.type=t.type[1].split(" ")),null!==t.width&&(t.width=parseInt(t.width[1])),null!==t.height&&(t.height=parseInt(t.height[1])),null!==t.viewpoint&&(t.viewpoint=t.viewpoint[1]),null!==t.points&&(t.points=parseInt(t.points[1],10)),null===t.points&&(t.points=t.width*t.height),null!==t.size&&(t.size=t.size[1].split(" ").map(function(e){return parseInt(e,10)})),null!==t.count)t.count=t.count[1].split(" ").map(function(e){return parseInt(e,10)});else{t.count=[];for(var n=0,o=t.fields.length;n<o;n++)t.count.push(1)}t.offset={};var a=0;for(n=0,o=t.fields.length;n<o;n++)"ascii"===t.data?t.offset[t.fields[n]]=n:(t.offset[t.fields[n]]=a,a+=t.size[n]);return t.rowSize=a,t}(i),n=[],o=[],a=[];if("ascii"===r.data)for(var s=r.offset,l=i.substr(r.headerLen).split("\n"),u=0,h=l.length;u<h;u++)if(""!==l[u]){var c=l[u].split(" ");if(void 0!==s.x&&(n.push(parseFloat(c[s.x])),n.push(parseFloat(c[s.y])),n.push(parseFloat(c[s.z]))),void 0!==s.rgb){var d=parseFloat(c[s.rgb]),p=d>>16&255,f=d>>8&255,m=d>>0&255;a.push(p/255,f/255,m/255)}void 0!==s.normal_x&&(o.push(parseFloat(c[s.normal_x])),o.push(parseFloat(c[s.normal_y])),o.push(parseFloat(c[s.normal_z])))}if("binary_compressed"!==r.data){if("binary"===r.data)for(var v=new DataView(e,r.headerLen),g=(s=r.offset,u=0,0);u<r.points;u++,g+=r.rowSize)void 0!==s.x&&(n.push(v.getFloat32(g+s.x,this.littleEndian)),n.push(v.getFloat32(g+s.y,this.littleEndian)),n.push(v.getFloat32(g+s.z,this.littleEndian))),void 0!==s.rgb&&(a.push(v.getUint8(g+s.rgb+2)/255),a.push(v.getUint8(g+s.rgb+1)/255),a.push(v.getUint8(g+s.rgb+0)/255)),void 0!==s.normal_x&&(o.push(v.getFloat32(g+s.normal_x,this.littleEndian)),o.push(v.getFloat32(g+s.normal_y,this.littleEndian)),o.push(v.getFloat32(g+s.normal_z,this.littleEndian)));var y=new BufferGeometry;n.length>0&&y.addAttribute("position",new Float32BufferAttribute(n,3)),o.length>0&&y.addAttribute("normal",new Float32BufferAttribute(o,3)),a.length>0&&y.addAttribute("color",new Float32BufferAttribute(a,3)),y.computeBoundingSphere();var _=new PointsMaterial({size:.005});a.length>0?_.vertexColors=VertexColors:_.color.setHex(16777215*Math.random());var b=new Points(y,_),x=t.split("").reverse().join("");return x=(x=/([^\/]*)/.exec(x))[1].split("").reverse().join(""),b.name=x,b}console.error("PCDLoader: binary_compressed files are not supported")}};var PDBLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager};PDBLoader.prototype={constructor:PDBLoader,load:function(e,t,i,r){var n=this,o=new FileLoader(n.manager);o.setPath(n.path),o.load(e,function(e){t(n.parse(e))},i,r)},setPath:function(e){return this.path=e,this},parse:function(e){function t(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function i(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}function r(e,t){var i,r,n=parseInt(p[f].substr(e,t));if(n){var o=(i=v,r=n,"s"+Math.min(i,r)+"e"+Math.max(i,r));void 0===d[o]&&(c.push([v-1,n-1,1]),d[o]=c.length-1)}}for(var n,o,a,s,l,u={h:[255,255,255],he:[217,255,255],li:[204,128,255],be:[194,255,0],b:[255,181,181],c:[144,144,144],n:[48,80,248],o:[255,13,13],f:[144,224,80],ne:[179,227,245],na:[171,92,242],mg:[138,255,0],al:[191,166,166],si:[240,200,160],p:[255,128,0],s:[255,255,48],cl:[31,240,31],ar:[128,209,227],k:[143,64,212],ca:[61,255,0],sc:[230,230,230],ti:[191,194,199],v:[166,166,171],cr:[138,153,199],mn:[156,122,199],fe:[224,102,51],co:[240,144,160],ni:[80,208,80],cu:[200,128,51],zn:[125,128,176],ga:[194,143,143],ge:[102,143,143],as:[189,128,227],se:[255,161,0],br:[166,41,41],kr:[92,184,209],rb:[112,46,176],sr:[0,255,0],y:[148,255,255],zr:[148,224,224],nb:[115,194,201],mo:[84,181,181],tc:[59,158,158],ru:[36,143,143],rh:[10,125,140],pd:[0,105,133],ag:[192,192,192],cd:[255,217,143],in:[166,117,115],sn:[102,128,128],sb:[158,99,181],te:[212,122,0],i:[148,0,148],xe:[66,158,176],cs:[87,23,143],ba:[0,201,0],la:[112,212,255],ce:[255,255,199],pr:[217,255,199],nd:[199,255,199],pm:[163,255,199],sm:[143,255,199],eu:[97,255,199],gd:[69,255,199],tb:[48,255,199],dy:[31,255,199],ho:[0,255,156],er:[0,230,117],tm:[0,212,82],yb:[0,191,56],lu:[0,171,36],hf:[77,194,255],ta:[77,166,255],w:[33,148,214],re:[38,125,171],os:[38,102,150],ir:[23,84,135],pt:[208,208,224],au:[255,209,35],hg:[184,184,208],tl:[166,84,77],pb:[87,89,97],bi:[158,79,181],po:[171,92,0],at:[117,79,69],rn:[66,130,150],fr:[66,0,102],ra:[0,125,0],ac:[112,171,250],th:[0,186,255],pa:[0,161,255],u:[0,143,255],np:[0,128,255],pu:[0,107,255],am:[84,92,242],cm:[120,92,227],bk:[138,79,227],cf:[161,54,212],es:[179,31,212],fm:[179,31,186],md:[179,13,166],no:[189,13,135],lr:[199,0,102],rf:[204,0,89],db:[209,0,79],sg:[217,0,69],bh:[224,0,56],hs:[230,0,46],mt:[235,0,38],ds:[235,0,38],rg:[235,0,38],cn:[235,0,38],uut:[235,0,38],uuq:[235,0,38],uup:[235,0,38],uuh:[235,0,38],uus:[235,0,38],uuo:[235,0,38]},h=[],c=[],d={},p=e.split("\n"),f=0,m=p.length;f<m;f++)if("ATOM"===p[f].substr(0,4)||"HETATM"===p[f].substr(0,6))n=parseFloat(p[f].substr(30,7)),o=parseFloat(p[f].substr(38,7)),a=parseFloat(p[f].substr(46,7)),s=parseInt(p[f].substr(6,5))-1,""===(l=t(p[f].substr(76,2)).toLowerCase())&&(l=t(p[f].substr(12,2)).toLowerCase()),h[s]=[n,o,a,u[l],i(l)];else if("CONECT"===p[f].substr(0,6)){var v=parseInt(p[f].substr(6,5));r(11,5),r(16,5),r(21,5),r(26,5)}return function(){var e,t,i={geometryAtoms:new BufferGeometry,geometryBonds:new BufferGeometry,json:{atoms:h,bonds:c}},r=i.geometryAtoms,n=i.geometryBonds,o=[],a=[],s=[];for(e=0,t=h.length;e<t;e++){var l=h[e],u=l[0],d=l[1],p=l[2];o.push(u,d,p);var f=l[3][0]/255,m=l[3][1]/255,v=l[3][2]/255;a.push(f,m,v)}for(e=0,t=c.length;e<t;e++){var g=c[e],y=g[0],_=g[1];s.push(o[3*y+0]),s.push(o[3*y+1]),s.push(o[3*y+2]),s.push(o[3*_+0]),s.push(o[3*_+1]),s.push(o[3*_+2])}return r.addAttribute("position",new Float32BufferAttribute(o,3)),r.addAttribute("color",new Float32BufferAttribute(a,3)),n.addAttribute("position",new Float32BufferAttribute(s,3)),i}()}};var PlayCanvasLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager};PlayCanvasLoader.prototype={constructor:PlayCanvasLoader,load:function(e,t,i,r){var n=this,o=new FileLoader(n.manager);o.setPath(n.path),o.load(e,function(e){t(n.parse(JSON.parse(e)))},i,r)},setPath:function(e){return this.path=e,this},parse:function(e){function t(e){var t={};for(var i in e){var r,n=e[i],o=n.type,a=n.components;switch(o){case"float32":r=new Float32BufferAttribute(n.data,a);break;case"uint8":r=new Uint8BufferAttribute(n.data,a);break;case"uint16":r=new Uint16BufferAttribute(n.data,a);break;default:console.log('PlayCanvasLoader: Array type "%s" not yet supported.',o)}t[i]=r}e._attributes=t}function i(e){var t=new BufferGeometry;t.setIndex(e.indices);var i=s.vertices[e.vertices]._attributes;for(var r in i){var n=i[r];"texCoord0"===r&&(r="uv"),t.addAttribute(r,n)}e._geometry=t}function r(e){var t=new Group,i=e._geometries;if(void 0!==i)for(var r=new MeshPhongMaterial,n=0,o=i.length;n<o;n++){var a=i[n];t.add(new Mesh(a,r))}for(n=0,o=e.rotation.length;n<o;n++)e.rotation[n]*=Math.PI/180;t.name=e.name,t.position.fromArray(e.position),t.quaternion.setFromEuler((new Euler).fromArray(e.rotation)),t.scale.fromArray(e.scale),e._object=t}for(var n,o,a,s=e.model,l=0,u=s.vertices.length;l<u;l++)t(s.vertices[l]);for(l=0,u=s.meshes.length;l<u;l++)i(s.meshes[l]);for(l=0,u=s.meshInstances.length;l<u;l++)n=s.meshInstances[l],o=void 0,a=void 0,o=s.nodes[n.node],a=s.meshes[n.mesh],void 0===o._geometries&&(o._geometries=[]),o._geometries.push(a._geometry);for(l=0,u=s.nodes.length;l<u;l++)r(s.nodes[l]);for(l=0,u=s.parents.length;l<u;l++){var h=s.parents[l];-1!==h&&s.nodes[h]._object.add(s.nodes[l]._object)}return s.nodes[0]._object}};var PLYLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager,this.propertyNameMapping={}};PLYLoader.prototype={constructor:PLYLoader,load:function(e,t,i,r){var n=this,o=new FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.load(e,function(e){t(n.parse(e))},i,r)},setPath:function(e){return this.path=e,this},setPropertyNameMapping:function(e){this.propertyNameMapping=e},parse:function(e){function t(e){var t="",i=0,r=/ply([\s\S]*)end_header\r?\n/.exec(e);null!==r&&(t=r[1],i=r[0].length);var n,o,a,s,l,u,c={comments:[],elements:[],headerLength:i},d=t.split("\n");for(var p=0;p<d.length;p++){var f=d[p];if(""!==(f=f.trim()))switch(o=(a=f.split(/\s+/)).shift(),f=a.join(" "),o){case"format":c.format=a[0],c.version=a[1];break;case"comment":c.comments.push(f);break;case"element":void 0!==n&&c.elements.push(n),(n={}).name=a[0],n.count=parseInt(a[1]),n.properties=[];break;case"property":n.properties.push((s=a,l=h.propertyNameMapping,u=void 0,"list"===(u={type:s[0]}).type?(u.name=s[3],u.countType=s[1],u.itemType=s[2]):u.name=s[1],u.name in l&&(u.name=l[u.name]),u));break;default:console.log("unhandled",o,a)}}return void 0!==n&&c.elements.push(n),c}function i(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function r(e,t){for(var r=t.split(/\s+/),n={},o=0;o<e.length;o++)if("list"===e[o].type){for(var a=[],s=i(r.shift(),e[o].countType),l=0;l<s;l++)a.push(i(r.shift(),e[o].itemType));n[e[o].name]=a}else n[e[o].name]=i(r.shift(),e[o].type);return n}function n(e,t){var i,n={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},s="";null!==(i=/end_header\s([\s\S]*)$/.exec(e))&&(s=i[1]);for(var l=s.split("\n"),u=0,h=0,c=0;c<l.length;c++){var d=l[c];if(""!==(d=d.trim())){h>=t.elements[u].count&&(u++,h=0);var p=r(t.elements[u].properties,d);a(n,t.elements[u].name,p),h++}}return o(n)}function o(e){var t=new BufferGeometry;return e.indices.length>0&&t.setIndex(e.indices),t.addAttribute("position",new Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&t.addAttribute("normal",new Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&t.addAttribute("uv",new Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&t.addAttribute("color",new Float32BufferAttribute(e.colors,3)),e.faceVertexUvs.length>0&&(t=t.toNonIndexed()).addAttribute("uv",new Float32BufferAttribute(e.faceVertexUvs,2)),t.computeBoundingSphere(),t}function a(e,t,i){if("vertex"===t)e.vertices.push(i.x,i.y,i.z),"nx"in i&&"ny"in i&&"nz"in i&&e.normals.push(i.nx,i.ny,i.nz),"s"in i&&"t"in i&&e.uvs.push(i.s,i.t),"red"in i&&"green"in i&&"blue"in i&&e.colors.push(i.red/255,i.green/255,i.blue/255);else if("face"===t){var r=i.vertex_indices||i.vertex_index,n=i.texcoord;3===r.length?(e.indices.push(r[0],r[1],r[2]),n&&6===n.length&&(e.faceVertexUvs.push(n[0],n[1]),e.faceVertexUvs.push(n[2],n[3]),e.faceVertexUvs.push(n[4],n[5]))):4===r.length&&(e.indices.push(r[0],r[1],r[3]),e.indices.push(r[1],r[2],r[3]))}}function s(e,t,i,r){switch(i){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,r),2];case"uint16":case"ushort":return[e.getUint16(t,r),2];case"int32":case"int":return[e.getInt32(t,r),4];case"uint32":case"uint":return[e.getUint32(t,r),4];case"float32":case"float":return[e.getFloat32(t,r),4];case"float64":case"double":return[e.getFloat64(t,r),8]}}function l(e,t,i,r){for(var n,o={},a=0,l=0;l<i.length;l++)if("list"===i[l].type){var u=[],h=(n=s(e,t+a,i[l].countType,r))[0];a+=n[1];for(var c=0;c<h;c++)n=s(e,t+a,i[l].itemType,r),u.push(n[0]),a+=n[1];o[i[l].name]=u}else n=s(e,t+a,i[l].type,r),o[i[l].name]=n[0],a+=n[1];return[o,a]}var u,h=this;if(e instanceof ArrayBuffer){var c=LoaderUtils.decodeText(new Uint8Array(e)),d=t(c);u="ascii"===d.format?n(c,d):function(e,t){for(var i,r={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},n="binary_little_endian"===t.format,s=new DataView(e,t.headerLength),u=0,h=0;h<t.elements.length;h++)for(var c=0;c<t.elements[h].count;c++){u+=(i=l(s,u,t.elements[h].properties,n))[1];var d=i[0];a(r,t.elements[h].name,d)}return o(r)}(e,d)}else u=n(e,t(e));return u}};var bigEndianPlatform=null;function isBigEndianPlatform(){if(null===bigEndianPlatform){var e=new ArrayBuffer(2),t=new Uint8Array(e),i=new Uint16Array(e);t[0]=170,t[1]=187,bigEndianPlatform=43707===i[0]}return bigEndianPlatform}var InvertedEncodingTypes=[null,Float32Array,null,Int8Array,Int16Array,null,Int32Array,Uint8Array,Uint16Array,null,Uint32Array],getMethods={Uint16Array:"getUint16",Uint32Array:"getUint32",Int16Array:"getInt16",Int32Array:"getInt32",Float32Array:"getFloat32",Float64Array:"getFloat64"};function copyFromBuffer(e,t,i,r,n){var o,a=t.BYTES_PER_ELEMENT;if(n===isBigEndianPlatform()||1===a)o=new t(e,i,r);else{var s=new DataView(e,i,r*a),l=getMethods[t.name],u=!n,h=0;for(o=new t(r);h<r;h++)o[h]=s[l](h*a,u)}return o}function decodePrwm(e){var t=new Uint8Array(e),i=t[0],r=t[1],n=!!(r>>7&1),o=r>>6&1,a=1==(r>>5&1),s=31&r,l=0,u=0;if(a?(l=(t[2]<<16)+(t[3]<<8)+t[4],u=(t[5]<<16)+(t[6]<<8)+t[7]):(l=t[2]+(t[3]<<8)+(t[4]<<16),u=t[5]+(t[6]<<8)+(t[7]<<16)),0===i)throw new Error("PRWM decoder: Invalid format version: 0");if(1!==i)throw new Error("PRWM decoder: Unsupported format version: "+i);if(!n){if(0!==o)throw new Error("PRWM decoder: Indices type must be set to 0 for non-indexed geometries");if(0!==u)throw new Error("PRWM decoder: Number of indices must be set to 0 for non-indexed geometries")}var h,c,d,p,f,m,v,g,y=8,_={};for(g=0;g<s;g++){for(h="";y<t.length&&(c=t[y],y++,0!==c);)h+=String.fromCharCode(c);d=(r=t[y])>>7&1,p=1+(r>>4&3),y++,m=copyFromBuffer(e,f=InvertedEncodingTypes[15&r],y=4*Math.ceil(y/4),p*l,a),y+=f.BYTES_PER_ELEMENT*p*l,_[h]={type:d,cardinality:p,values:m}}return y=4*Math.ceil(y/4),v=null,n&&(v=copyFromBuffer(e,1===o?Uint32Array:Uint16Array,y,u,a)),{version:i,attributes:_,indices:v}}var PRWMLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager};PRWMLoader.prototype={constructor:PRWMLoader,load:function(e,t,i,r){var n=this,o=new FileLoader(n.manager);o.setPath(n.path),o.setResponseType("arraybuffer"),e=e.replace(/\*/g,isBigEndianPlatform()?"be":"le"),o.load(e,function(e){t(n.parse(e))},i,r)},setPath:function(e){return this.path=e,this},parse:function(e){console.time("PRWMLoader");var t,i,r=decodePrwm(e),n=Object.keys(r.attributes),o=new BufferGeometry;for(i=0;i<n.length;i++)t=r.attributes[n[i]],o.addAttribute(n[i],new BufferAttribute(t.values,t.cardinality,t.normalized));return null!==r.indices&&o.setIndex(new BufferAttribute(r.indices,1)),console.timeEnd("PRWMLoader"),o}},PRWMLoader.isBigEndianPlatform=function(){return isBigEndianPlatform()};var PVRLoader=function(e){CompressedTextureLoader.call(this,e),this._parser=PVRLoader.parse};PVRLoader.prototype=Object.create(CompressedTextureLoader.prototype),PVRLoader.prototype.constructor=PVRLoader,PVRLoader.parse=function(e,t){var i=new Uint32Array(e,0,13),r={buffer:e,header:i,loadMipmaps:t};return 55727696===i[0]?PVRLoader._parseV3(r):559044176===i[11]?PVRLoader._parseV2(r):void console.error("PVRLoader: Unknown PVR format.")},PVRLoader._parseV3=function(e){var t,i,r=e.header,n=r[12],o=r[2],a=r[6],s=r[7],l=r[10],u=r[11];switch(o){case 0:t=2,i=RGB_PVRTC_2BPPV1_Format;break;case 1:t=2,i=RGBA_PVRTC_2BPPV1_Format;break;case 2:t=4,i=RGB_PVRTC_4BPPV1_Format;break;case 3:t=4,i=RGBA_PVRTC_4BPPV1_Format;break;default:console.error("PVRLoader: Unsupported PVR format:",o)}return e.dataPtr=52+n,e.bpp=t,e.format=i,e.width=s,e.height=a,e.numSurfaces=l,e.numMipmaps=u,e.isCubemap=6===l,PVRLoader._extract(e)},PVRLoader._parseV2=function(e){var t,i,r=e.header,n=r[0],o=r[1],a=r[2],s=r[3],l=r[4],u=r[10],h=r[12],c=255&l,d=u>0;return 25===c?(i=d?RGBA_PVRTC_4BPPV1_Format:RGB_PVRTC_4BPPV1_Format,t=4):24===c?(i=d?RGBA_PVRTC_2BPPV1_Format:RGB_PVRTC_2BPPV1_Format,t=2):console.error("PVRLoader: Unknown PVR format:",c),e.dataPtr=n,e.bpp=t,e.format=i,e.width=a,e.height=o,e.numSurfaces=h,e.numMipmaps=s+1,e.isCubemap=6===h,PVRLoader._extract(e)},PVRLoader._extract=function(e){var t,i={mipmaps:[],width:e.width,height:e.height,format:e.format,mipmapCount:e.numMipmaps,isCubemap:e.isCubemap},r=e.buffer,n=e.dataPtr,o=e.bpp,a=e.numSurfaces,s=0,l=0,u=0,h=0,c=0;2===o?(l=8,u=4):(l=4,u=4),t=l*u*o/8,i.mipmaps.length=e.numMipmaps*a;for(var d=0;d<e.numMipmaps;){var p=e.width>>d,f=e.height>>d;(h=p/l)<2&&(h=2),(c=f/u)<2&&(c=2),s=h*c*t;for(var m=0;m<a;m++){var v={data:new Uint8Array(r,n,s),width:p,height:f};i.mipmaps[m*e.numMipmaps+d]=v,n+=s}d++}return i};var STLLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager};function EllipseCurve(e,t,i,r,n,o,a,s){Curve.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=i||1,this.yRadius=r||1,this.aStartAngle=n||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function ArcCurve(e,t,i,r,n,o){EllipseCurve.call(this,e,t,i,i,r,n,o),this.type="ArcCurve"}function CubicPoly(){var e=0,t=0,i=0,r=0;function n(n,o,a,s){e=n,t=a,i=-3*n+3*o-2*a-s,r=2*n-2*o+a+s}return{initCatmullRom:function(e,t,i,r,o){n(t,i,o*(i-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,i,r,o,a,s){var l=(t-e)/o-(i-e)/(o+a)+(i-t)/a,u=(i-t)/a-(r-t)/(a+s)+(r-i)/s;n(t,i,l*=a,u*=a)},calc:function(n){var o=n*n;return e+t*n+i*o+r*(o*n)}}}STLLoader.prototype={constructor:STLLoader,load:function(e,t,i,r){var n=this,o=new FileLoader(n.manager);o.setPath(n.path),o.setResponseType("arraybuffer"),o.load(e,function(e){try{t(n.parse(e))}catch(e){r&&r(e)}},i,r)},setPath:function(e){return this.path=e,this},parse:function(e){function t(e,t,i){for(var r=0,n=e.length;r<n;r++)if(e[r]!==t.getUint8(i+r,!1))return!1;return!0}var i,r=function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=255&e.charCodeAt(i);return t.buffer||t}return e}(e);return function(e){var i;if(84+50*(i=new DataView(e)).getUint32(80,!0)===i.byteLength)return!0;for(var r=[115,111,108,105,100],n=0;n<5;n++)if(t(r,i,n))return!1;return!0}(r)?function(e){for(var t,i,r,n,o,a,s,l,u=new DataView(e),h=u.getUint32(80,!0),c=!1,d=0;d<70;d++)1129270351==u.getUint32(d,!1)&&82==u.getUint8(d+4)&&61==u.getUint8(d+5)&&(c=!0,n=[],o=u.getUint8(d+6)/255,a=u.getUint8(d+7)/255,s=u.getUint8(d+8)/255,l=u.getUint8(d+9)/255);for(var p=new BufferGeometry,f=[],m=[],v=0;v<h;v++){var g=84+50*v,y=u.getFloat32(g,!0),_=u.getFloat32(g+4,!0),b=u.getFloat32(g+8,!0);if(c){var x=u.getUint16(g+48,!0);0==(32768&x)?(t=(31&x)/31,i=(x>>5&31)/31,r=(x>>10&31)/31):(t=o,i=a,r=s)}for(var w=1;w<=3;w++){var S=g+12*w;f.push(u.getFloat32(S,!0)),f.push(u.getFloat32(S+4,!0)),f.push(u.getFloat32(S+8,!0)),m.push(y,_,b),c&&n.push(t,i,r)}}return p.addAttribute("position",new BufferAttribute(new Float32Array(f),3)),p.addAttribute("normal",new BufferAttribute(new Float32Array(m),3)),c&&(p.addAttribute("color",new BufferAttribute(new Float32Array(n),3)),p.hasColors=!0,p.alpha=l),p}(r):function(e){for(var t,i=new BufferGeometry,r=/facet([\s\S]*?)endfacet/g,n=0,o=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,a=new RegExp("vertex"+o+o+o,"g"),s=new RegExp("normal"+o+o+o,"g"),l=[],u=[],h=new Vector3;null!==(t=r.exec(e));){for(var c=0,d=0,p=t[0];null!==(t=s.exec(p));)h.x=parseFloat(t[1]),h.y=parseFloat(t[2]),h.z=parseFloat(t[3]),d++;for(;null!==(t=a.exec(p));)l.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),u.push(h.x,h.y,h.z),c++;1!==d&&console.error("STLLoader: Something isn't right with the normal of face number "+n),3!==c&&console.error("STLLoader: Something isn't right with the vertices of face number "+n),n++}return i.addAttribute("position",new Float32BufferAttribute(l,3)),i.addAttribute("normal",new Float32BufferAttribute(u,3)),i}("string"!=typeof(i=e)?LoaderUtils.decodeText(new Uint8Array(i)):i)}},EllipseCurve.prototype=Object.create(Curve.prototype),EllipseCurve.prototype.constructor=EllipseCurve,EllipseCurve.prototype.isEllipseCurve=!0,EllipseCurve.prototype.getPoint=function(e,t){for(var i=t||new Vector2,r=2*Math.PI,n=this.aEndAngle-this.aStartAngle,o=Math.abs(n)<Number.EPSILON;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(n=o?0:r),!0!==this.aClockwise||o||(n===r?n=-r:n-=r);var a=this.aStartAngle+e*n,s=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),c=s-this.aX,d=l-this.aY;s=c*u-d*h+this.aX,l=c*h+d*u+this.aY}return i.set(s,l)},EllipseCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},EllipseCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},EllipseCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},ArcCurve.prototype=Object.create(EllipseCurve.prototype),ArcCurve.prototype.constructor=ArcCurve,ArcCurve.prototype.isArcCurve=!0;var tmp=new Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;function CatmullRomCurve3(e,t,i,r){Curve.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=i||"centripetal",this.tension=r||.5}function CatmullRom(e,t,i,r,n){var o=.5*(r-t),a=.5*(n-i),s=e*e;return(2*i-2*r+o+a)*(e*s)+(-3*i+3*r-2*o-a)*s+o*e+i}function QuadraticBezierP0(e,t){var i=1-e;return i*i*t}function QuadraticBezierP1(e,t){return 2*(1-e)*e*t}function QuadraticBezierP2(e,t){return e*e*t}function QuadraticBezier(e,t,i,r){return QuadraticBezierP0(e,t)+QuadraticBezierP1(e,i)+QuadraticBezierP2(e,r)}function CubicBezierP0(e,t){var i=1-e;return i*i*i*t}function CubicBezierP1(e,t){var i=1-e;return 3*i*i*e*t}function CubicBezierP2(e,t){return 3*(1-e)*e*e*t}function CubicBezierP3(e,t){return e*e*e*t}function CubicBezier(e,t,i,r,n){return CubicBezierP0(e,t)+CubicBezierP1(e,i)+CubicBezierP2(e,r)+CubicBezierP3(e,n)}function CubicBezierCurve(e,t,i,r){Curve.call(this),this.type="CubicBezierCurve",this.v0=e||new Vector2,this.v1=t||new Vector2,this.v2=i||new Vector2,this.v3=r||new Vector2}function CubicBezierCurve3(e,t,i,r){Curve.call(this),this.type="CubicBezierCurve3",this.v0=e||new Vector3,this.v1=t||new Vector3,this.v2=i||new Vector3,this.v3=r||new Vector3}function LineCurve(e,t){Curve.call(this),this.type="LineCurve",this.v1=e||new Vector2,this.v2=t||new Vector2}function LineCurve3(e,t){Curve.call(this),this.type="LineCurve3",this.v1=e||new Vector3,this.v2=t||new Vector3}function QuadraticBezierCurve(e,t,i){Curve.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Vector2,this.v1=t||new Vector2,this.v2=i||new Vector2}function QuadraticBezierCurve3(e,t,i){Curve.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new Vector3,this.v1=t||new Vector3,this.v2=i||new Vector3}function SplineCurve(e){Curve.call(this),this.type="SplineCurve",this.points=e||[]}CatmullRomCurve3.prototype=Object.create(Curve.prototype),CatmullRomCurve3.prototype.constructor=CatmullRomCurve3,CatmullRomCurve3.prototype.isCatmullRomCurve3=!0,CatmullRomCurve3.prototype.getPoint=function(e,t){var i,r,n,o,a=t||new Vector3,s=this.points,l=s.length,u=(l-(this.closed?0:1))*e,h=Math.floor(u),c=u-h;if(this.closed?h+=h>0?0:(Math.floor(Math.abs(h)/l)+1)*l:0===c&&h===l-1&&(h=l-2,c=1),this.closed||h>0?i=s[(h-1)%l]:(tmp.subVectors(s[0],s[1]).add(s[0]),i=tmp),r=s[h%l],n=s[(h+1)%l],this.closed||h+2<l?o=s[(h+2)%l]:(tmp.subVectors(s[l-1],s[l-2]).add(s[l-1]),o=tmp),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,p=Math.pow(i.distanceToSquared(r),d),f=Math.pow(r.distanceToSquared(n),d),m=Math.pow(n.distanceToSquared(o),d);f<1e-4&&(f=1),p<1e-4&&(p=f),m<1e-4&&(m=f),px.initNonuniformCatmullRom(i.x,r.x,n.x,o.x,p,f,m),py.initNonuniformCatmullRom(i.y,r.y,n.y,o.y,p,f,m),pz.initNonuniformCatmullRom(i.z,r.z,n.z,o.z,p,f,m)}else"catmullrom"===this.curveType&&(px.initCatmullRom(i.x,r.x,n.x,o.x,this.tension),py.initCatmullRom(i.y,r.y,n.y,o.y,this.tension),pz.initCatmullRom(i.z,r.z,n.z,o.z,this.tension));return a.set(px.calc(c),py.calc(c),pz.calc(c)),a},CatmullRomCurve3.prototype.copy=function(e){Curve.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},CatmullRomCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},CatmullRomCurve3.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new Vector3).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},CubicBezierCurve.prototype=Object.create(Curve.prototype),CubicBezierCurve.prototype.constructor=CubicBezierCurve,CubicBezierCurve.prototype.isCubicBezierCurve=!0,CubicBezierCurve.prototype.getPoint=function(e,t){var i=t||new Vector2,r=this.v0,n=this.v1,o=this.v2,a=this.v3;return i.set(CubicBezier(e,r.x,n.x,o.x,a.x),CubicBezier(e,r.y,n.y,o.y,a.y)),i},CubicBezierCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},CubicBezierCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},CubicBezierCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},CubicBezierCurve3.prototype=Object.create(Curve.prototype),CubicBezierCurve3.prototype.constructor=CubicBezierCurve3,CubicBezierCurve3.prototype.isCubicBezierCurve3=!0,CubicBezierCurve3.prototype.getPoint=function(e,t){var i=t||new Vector3,r=this.v0,n=this.v1,o=this.v2,a=this.v3;return i.set(CubicBezier(e,r.x,n.x,o.x,a.x),CubicBezier(e,r.y,n.y,o.y,a.y),CubicBezier(e,r.z,n.z,o.z,a.z)),i},CubicBezierCurve3.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},CubicBezierCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},CubicBezierCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},LineCurve.prototype=Object.create(Curve.prototype),LineCurve.prototype.constructor=LineCurve,LineCurve.prototype.isLineCurve=!0,LineCurve.prototype.getPoint=function(e,t){var i=t||new Vector2;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},LineCurve.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},LineCurve.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},LineCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},LineCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},LineCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},LineCurve3.prototype=Object.create(Curve.prototype),LineCurve3.prototype.constructor=LineCurve3,LineCurve3.prototype.isLineCurve3=!0,LineCurve3.prototype.getPoint=function(e,t){var i=t||new Vector3;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},LineCurve3.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},LineCurve3.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},LineCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},LineCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},QuadraticBezierCurve.prototype=Object.create(Curve.prototype),QuadraticBezierCurve.prototype.constructor=QuadraticBezierCurve,QuadraticBezierCurve.prototype.isQuadraticBezierCurve=!0,QuadraticBezierCurve.prototype.getPoint=function(e,t){var i=t||new Vector2,r=this.v0,n=this.v1,o=this.v2;return i.set(QuadraticBezier(e,r.x,n.x,o.x),QuadraticBezier(e,r.y,n.y,o.y)),i},QuadraticBezierCurve.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},QuadraticBezierCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},QuadraticBezierCurve.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},QuadraticBezierCurve3.prototype=Object.create(Curve.prototype),QuadraticBezierCurve3.prototype.constructor=QuadraticBezierCurve3,QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=!0,QuadraticBezierCurve3.prototype.getPoint=function(e,t){var i=t||new Vector3,r=this.v0,n=this.v1,o=this.v2;return i.set(QuadraticBezier(e,r.x,n.x,o.x),QuadraticBezier(e,r.y,n.y,o.y),QuadraticBezier(e,r.z,n.z,o.z)),i},QuadraticBezierCurve3.prototype.copy=function(e){return Curve.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},QuadraticBezierCurve3.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},QuadraticBezierCurve3.prototype.fromJSON=function(e){return Curve.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},SplineCurve.prototype=Object.create(Curve.prototype),SplineCurve.prototype.constructor=SplineCurve,SplineCurve.prototype.isSplineCurve=!0,SplineCurve.prototype.getPoint=function(e,t){var i=t||new Vector2,r=this.points,n=(r.length-1)*e,o=Math.floor(n),a=n-o,s=r[0===o?o:o-1],l=r[o],u=r[o>r.length-2?r.length-1:o+1],h=r[o>r.length-3?r.length-1:o+2];return i.set(CatmullRom(a,s.x,l.x,u.x,h.x),CatmullRom(a,s.y,l.y,u.y,h.y)),i},SplineCurve.prototype.copy=function(e){Curve.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this},SplineCurve.prototype.toJSON=function(){var e=Curve.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}return e},SplineCurve.prototype.fromJSON=function(e){Curve.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new Vector2).fromArray(r))}return this};var Curves$1={ArcCurve:ArcCurve,CatmullRomCurve3:CatmullRomCurve3,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,EllipseCurve:EllipseCurve,LineCurve:LineCurve,LineCurve3:LineCurve3,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,SplineCurve:SplineCurve};function CurvePath(){Curve.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Path(e){CurvePath.call(this),this.type="Path",this.currentPoint=new Vector2,e&&this.setFromPoints(e)}function Shape(e){Path.call(this,e),this.uuid=_Math.generateUUID(),this.type="Shape",this.holes=[]}CurvePath.prototype=Object.assign(Object.create(Curve.prototype),{constructor:CurvePath,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Curves$1.LineCurve(t,e))},getPoint:function(e){for(var t=e*this.getLength(),i=this.getCurveLengths(),r=0;r<i.length;){if(i[r]>=t){var n=i[r]-t,o=this.curves[r],a=o.getLength(),s=0===a?0:1-n/a;return o.getPointAt(s)}r++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,i=[],r=0,n=this.curves;r<n.length;r++)for(var o=n[r],a=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,s=o.getPoints(a),l=0;l<s.length;l++){var u=s[l];t&&t.equals(u)||(i.push(u),t=u)}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i},copy:function(e){Curve.prototype.copy.call(this,e),this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Curve.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,i=this.curves.length;t<i;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e},fromJSON:function(e){Curve.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push((new Curves$1[r.type]).fromJSON(r))}return this}}),Path.prototype=Object.assign(Object.create(CurvePath.prototype),{constructor:Path,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var i=new LineCurve(this.currentPoint.clone(),new Vector2(e,t));this.curves.push(i),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,i,r){var n=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(i,r));this.curves.push(n),this.currentPoint.set(i,r)},bezierCurveTo:function(e,t,i,r,n,o){var a=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(i,r),new Vector2(n,o));this.curves.push(a),this.currentPoint.set(n,o)},splineThru:function(e){var t=new SplineCurve([this.currentPoint.clone()].concat(e));this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,i,r,n,o){var a=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+a,t+s,i,r,n,o)},absarc:function(e,t,i,r,n,o){this.absellipse(e,t,i,i,r,n,o)},ellipse:function(e,t,i,r,n,o,a,s){var l=this.currentPoint.x,u=this.currentPoint.y;this.absellipse(e+l,t+u,i,r,n,o,a,s)},absellipse:function(e,t,i,r,n,o,a,s){var l=new EllipseCurve(e,t,i,r,n,o,a,s);if(this.curves.length>0){var u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);var h=l.getPoint(1);this.currentPoint.copy(h)},copy:function(e){return CurvePath.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=CurvePath.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return CurvePath.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Shape.prototype=Object.assign(Object.create(Path.prototype),{constructor:Shape,getPointsHoles:function(e){for(var t=[],i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Path.prototype.copy.call(this,e),this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push(r.clone())}return this},toJSON:function(){var e=Path.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,i=this.holes.length;t<i;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e},fromJSON:function(e){Path.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push((new Path).fromJSON(r))}return this}});var Earcut={triangulate:function(e,t,i){i=i||2;var r,n,o,a,s,l,u,h=t&&t.length,c=h?t[0]*i:e.length,d=linkedList(e,0,c,i,!0),p=[];if(!d)return p;if(h&&(d=eliminateHoles(e,t,d,i)),e.length>80*i){r=o=e[0],n=a=e[1];for(var f=i;f<c;f+=i)(s=e[f])<r&&(r=s),(l=e[f+1])<n&&(n=l),s>o&&(o=s),l>a&&(a=l);u=0!==(u=Math.max(o-r,a-n))?1/u:0}return earcutLinked(d,p,i,r,n,u),p}};function linkedList(e,t,i,r,n){var o,a;if(n===signedArea(e,t,i,r)>0)for(o=t;o<i;o+=r)a=insertNode(o,e[o],e[o+1],a);else for(o=i-r;o>=t;o-=r)a=insertNode(o,e[o],e[o+1],a);return a&&equals(a,a.next)&&(removeNode(a),a=a.next),a}function filterPoints(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!equals(r,r.next)&&0!==area(r.prev,r,r.next))r=r.next;else{if(removeNode(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function earcutLinked(e,t,i,r,n,o,a){if(e){!a&&o&&indexCurve(e,r,n,o);for(var s,l,u=e;e.prev!==e.next;)if(s=e.prev,l=e.next,o?isEarHashed(e,r,n,o):isEar(e))t.push(s.i/i),t.push(e.i/i),t.push(l.i/i),removeNode(e),e=l.next,u=l.next;else if((e=l)===u){a?1===a?earcutLinked(e=cureLocalIntersections(e,t,i),t,i,r,n,o,2):2===a&&splitEarcut(e,t,i,r,n,o):earcutLinked(filterPoints(e),t,i,r,n,o,1);break}}}function isEar(e){var t=e.prev,i=e,r=e.next;if(area(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(pointInTriangle(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function isEarHashed(e,t,i,r){var n=e.prev,o=e,a=e.next;if(area(n,o,a)>=0)return!1;for(var s=n.x<o.x?n.x<a.x?n.x:a.x:o.x<a.x?o.x:a.x,l=n.y<o.y?n.y<a.y?n.y:a.y:o.y<a.y?o.y:a.y,u=n.x>o.x?n.x>a.x?n.x:a.x:o.x>a.x?o.x:a.x,h=n.y>o.y?n.y>a.y?n.y:a.y:o.y>a.y?o.y:a.y,c=zOrder(s,l,t,i,r),d=zOrder(u,h,t,i,r),p=e.nextZ;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&pointInTriangle(n.x,n.y,o.x,o.y,a.x,a.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=e.prevZ;p&&p.z>=c;){if(p!==e.prev&&p!==e.next&&pointInTriangle(n.x,n.y,o.x,o.y,a.x,a.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function cureLocalIntersections(e,t,i){var r=e;do{var n=r.prev,o=r.next.next;!equals(n,o)&&intersects(n,r,r.next,o)&&locallyInside(n,o)&&locallyInside(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),removeNode(r),removeNode(r.next),r=e=o),r=r.next}while(r!==e);return r}function splitEarcut(e,t,i,r,n,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&isValidDiagonal(a,s)){var l=splitPolygon(a,s);return a=filterPoints(a,a.next),l=filterPoints(l,l.next),earcutLinked(a,t,i,r,n,o),void earcutLinked(l,t,i,r,n,o)}s=s.next}a=a.next}while(a!==e)}function eliminateHoles(e,t,i,r){var n,o,a,s=[];for(n=0,o=t.length;n<o;n++)(a=linkedList(e,t[n]*r,n<o-1?t[n+1]*r:e.length,r,!1))===a.next&&(a.steiner=!0),s.push(getLeftmost(a));for(s.sort(compareX),n=0;n<s.length;n++)eliminateHole(s[n],i),i=filterPoints(i,i.next);return i}function compareX(e,t){return e.x-t.x}function eliminateHole(e,t){if(t=findHoleBridge(e,t)){var i=splitPolygon(t,e);filterPoints(i,i.next)}}function findHoleBridge(e,t){var i,r=t,n=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=n&&s>a){if(a=s,s===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===a)return i.prev;var l,u=i,h=i.x,c=i.y,d=1/0;for(r=i.next;r!==u;)n>=r.x&&r.x>=h&&n!==r.x&&pointInTriangle(o<c?n:a,o,h,c,o<c?a:n,o,r.x,r.y)&&((l=Math.abs(o-r.y)/(n-r.x))<d||l===d&&r.x>i.x)&&locallyInside(r,e)&&(i=r,d=l),r=r.next;return i}function indexCurve(e,t,i,r){var n=e;do{null===n.z&&(n.z=zOrder(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,sortLinked(n)}function sortLinked(e){var t,i,r,n,o,a,s,l,u=1;do{for(i=e,e=null,o=null,a=0;i;){for(a++,r=i,s=0,t=0;t<u&&(s++,r=r.nextZ);t++);for(l=u;s>0||l>0&&r;)0!==s&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,s--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,u*=2}while(a>1);return e}function zOrder(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function getLeftmost(e){var t=e,i=e;do{t.x<i.x&&(i=t),t=t.next}while(t!==e);return i}function pointInTriangle(e,t,i,r,n,o,a,s){return(n-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(i-a)*(t-s)>=0&&(i-a)*(o-s)-(n-a)*(r-s)>=0}function isValidDiagonal(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!intersectsPolygon(e,t)&&locallyInside(e,t)&&locallyInside(t,e)&&middleInside(e,t)}function area(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function equals(e,t){return e.x===t.x&&e.y===t.y}function intersects(e,t,i,r){return!!(equals(e,t)&&equals(i,r)||equals(e,r)&&equals(i,t))||area(e,t,i)>0!=area(e,t,r)>0&&area(i,r,e)>0!=area(i,r,t)>0}function intersectsPolygon(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&intersects(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function locallyInside(e,t){return area(e.prev,e,e.next)<0?area(e,t,e.next)>=0&&area(e,e.prev,t)>=0:area(e,t,e.prev)<0||area(e,e.next,t)<0}function middleInside(e,t){var i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}function splitPolygon(e,t){var i=new Node(e.i,e.x,e.y),r=new Node(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function insertNode(e,t,i,r){var n=new Node(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(e,t,i,r){for(var n=0,o=t,a=i-r;o<i;o+=r)n+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return n}var ShapeUtils={area:function(e){for(var t=e.length,i=0,r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return.5*i},isClockWise:function(e){return ShapeUtils.area(e)<0},triangulateShape:function(e,t){var i=[],r=[],n=[];removeDupEndPts(e),addContour(i,e);var o=e.length;t.forEach(removeDupEndPts);for(var a=0;a<t.length;a++)r.push(o),o+=t[a].length,addContour(i,t[a]);var s=Earcut.triangulate(i,r);for(a=0;a<s.length;a+=3)n.push(s.slice(a,a+3));return n}};function removeDupEndPts(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function addContour(e,t){for(var i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}function ShapePath(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}Object.assign(ShapePath.prototype,{moveTo:function(e,t){this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,i,r){this.currentPath.quadraticCurveTo(e,t,i,r)},bezierCurveTo:function(e,t,i,r,n,o){this.currentPath.bezierCurveTo(e,t,i,r,n,o)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function i(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i],o=new Shape;o.curves=n.curves,t.push(o)}return t}function r(e,t){for(var i=t.length,r=!1,n=i-1,o=0;o<i;n=o++){var a=t[n],s=t[o],l=s.x-a.x,u=s.y-a.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(a=t[o],l=-l,s=t[n],u=-u),e.y<a.y||e.y>s.y)continue;if(e.y===a.y){if(e.x===a.x)return!0}else{var h=u*(e.x-a.x)-l*(e.y-a.y);if(0===h)return!0;if(h<0)continue;r=!r}}else{if(e.y!==a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return r}var n=ShapeUtils.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return i(o);var a,s,l,u=[];if(1===o.length)return s=o[0],(l=new Shape).curves=s.curves,u.push(l),u;var h=!n(o[0].getPoints());h=e?!h:h;var c,d,p=[],f=[],m=[],v=0;f[v]=void 0,m[v]=[];for(var g=0,y=o.length;g<y;g++)a=n(c=(s=o[g]).getPoints()),(a=e?!a:a)?(!h&&f[v]&&v++,f[v]={s:new Shape,p:c},f[v].s.curves=s.curves,h&&v++,m[v]=[]):m[v].push({h:s,p:c[0]});if(!f[0])return i(o);if(f.length>1){for(var _=!1,b=[],x=0,w=f.length;x<w;x++)p[x]=[];for(x=0,w=f.length;x<w;x++)for(var S=m[x],M=0;M<S.length;M++){for(var T=S[M],A=!0,C=0;C<f.length;C++)r(T.p,f[C].p)&&(x!==C&&b.push({froms:x,tos:C,hole:M}),A?(A=!1,p[C].push(T)):_=!0);A&&p[x].push(T)}b.length>0&&(_||(m=p))}g=0;for(var L=f.length;g<L;g++){l=f[g].s,u.push(l);for(var N=0,P=(d=m[g]).length;N<P;N++)l.holes.push(d[N].h)}return u}});var SVGLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager};SVGLoader.prototype={constructor:SVGLoader,load:function(e,t,i,r){var n=this,o=new FileLoader(n.manager);o.setPath(n.path),o.load(e,function(e){t(n.parse(e))},i,r)},setPath:function(e){return this.path=e,this},parse:function(e){function t(e,t,r,n,o,a,s,l){n=n*Math.PI/180,t=Math.abs(t),r=Math.abs(r);var u=(s.x-l.x)/2,h=(s.y-l.y)/2,c=Math.cos(n)*u+Math.sin(n)*h,d=-Math.sin(n)*u+Math.cos(n)*h,p=t*t,f=r*r,m=c*c,v=d*d,g=m/p+v/f;if(g>1){var y=Math.sqrt(g);p=(t*=y)*t,f=(r*=y)*r}var _=p*v+f*m,b=(p*f-_)/_,x=Math.sqrt(Math.max(0,b));o===a&&(x=-x);var w=x*t*d/r,S=-x*r*c/t,M=Math.cos(n)*w-Math.sin(n)*S+(s.x+l.x)/2,T=Math.sin(n)*w+Math.cos(n)*S+(s.y+l.y)/2,A=i(1,0,(c-w)/t,(d-S)/r),C=i((c-w)/t,(d-S)/r,(-c-w)/t,(-d-S)/r)%(2*Math.PI);e.currentPath.absellipse(M,T,t,r,A,A+C,0===a,n)}function i(e,t,i,r){var n=e*i+t*r,o=Math.sqrt(e*e+t*t)*Math.sqrt(i*i+r*r),a=Math.acos(Math.max(-1,Math.min(1,n/o)));return e*r-t*i<0&&(a=-a),a}function r(e,t){return t=Object.assign({},t),e.hasAttribute("fill")&&(t.fill=e.getAttribute("fill")),""!==e.style.fill&&(t.fill=e.style.fill),t}function n(e){return"none"!==e.fill&&"transparent"!==e.fill}function o(e,t){return e-(t-e)}function a(e){for(var t=e.split(/[\s,]+|(?=\s?[+\-])/),i=0;i<t.length;i++){var r=t[i];if(r.indexOf(".")!==r.lastIndexOf("."))for(var n=r.split("."),o=2;o<n.length;o++)t.splice(i+o-1,0,"0."+n[o]);t[i]=parseFloat(r)}return t}function s(e){var t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function l(e){var t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}console.log("SVGLoader");var u=[],h=[],c=new Matrix3,d=new Matrix3,p=new Matrix3,f=new Matrix3,m=new Matrix3;console.time("SVGLoader: DOMParser");var v=(new DOMParser).parseFromString(e,"image/svg+xml");return console.timeEnd("SVGLoader: DOMParser"),console.time("SVGLoader: Parse"),function e(i,v){if(1===i.nodeType){var g=function(e){if(!e.hasAttribute("transform"))return null;var t=function(e){for(var t=new Matrix3,i=c,r=e.getAttribute("transform").split(" "),n=r.length-1;n>=0;n--){var o=r[n],s=o.indexOf("("),l=o.indexOf(")");if(s>0&&s<l){var u=o.substr(0,s),h=a(o.substr(s+1,l-s-1));switch(i.identity(),u){case"translate":if(h.length>=1){var m=h[0],v=m;h.length>=2&&(v=h[1]),i.translate(m,v)}break;case"rotate":if(h.length>=1){var g=0,y=0,_=0;g=-h[0]*Math.PI/180,h.length>=3&&(y=h[1],_=h[2]),d.identity().translate(-y,-_),p.identity().rotate(g),f.multiplyMatrices(p,d),d.identity().translate(y,_),i.multiplyMatrices(d,f)}break;case"scale":if(h.length>=1){var b=h[0],x=b;h.length>=2&&(x=h[1]),i.scale(b,x)}break;case"skewX":1===h.length&&i.set(1,Math.tan(h[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===h.length&&i.set(1,0,0,Math.tan(h[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===h.length&&i.set(h[0],h[2],h[4],h[1],h[3],h[5],0,0,1)}}t.premultiply(i)}return t}(e);return t&&(h.length>0&&t.premultiply(h[h.length-1]),m.copy(t),h.push(t)),t}(i),y=null;switch(i.nodeName){case"svg":break;case"g":v=r(i,v);break;case"path":v=r(i,v),i.hasAttribute("d")&&n(v)&&(y=function(e,i){var r=new ShapePath;r.color.setStyle(i.fill);for(var n=new Vector2,s=new Vector2,l=new Vector2,u=!0,h=!1,c=e.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi),d=0,p=c.length;d<p;d++){var f=c[d],m=f.charAt(0),v=f.substr(1).trim();switch(!0===u&&(h=!0,u=!1),m){case"M":for(var g=a(v),y=0,_=g.length;y<_;y+=2)n.x=g[y+0],n.y=g[y+1],s.x=n.x,s.y=n.y,0===y?r.moveTo(n.x,n.y):r.lineTo(n.x,n.y),0===y&&!0===h&&l.copy(n);break;case"H":for(var g=a(v),y=0,_=g.length;y<_;y++)n.x=g[y],s.x=n.x,s.y=n.y,r.lineTo(n.x,n.y),0===y&&!0===h&&l.copy(n);break;case"V":for(var g=a(v),y=0,_=g.length;y<_;y++)n.y=g[y],s.x=n.x,s.y=n.y,r.lineTo(n.x,n.y),0===y&&!0===h&&l.copy(n);break;case"L":for(var g=a(v),y=0,_=g.length;y<_;y+=2)n.x=g[y+0],n.y=g[y+1],s.x=n.x,s.y=n.y,r.lineTo(n.x,n.y),0===y&&!0===h&&l.copy(n);break;case"C":for(var g=a(v),y=0,_=g.length;y<_;y+=6)r.bezierCurveTo(g[y+0],g[y+1],g[y+2],g[y+3],g[y+4],g[y+5]),s.x=g[y+2],s.y=g[y+3],n.x=g[y+4],n.y=g[y+5],0===y&&!0===h&&l.copy(n);break;case"S":for(var g=a(v),y=0,_=g.length;y<_;y+=4)r.bezierCurveTo(o(n.x,s.x),o(n.y,s.y),g[y+0],g[y+1],g[y+2],g[y+3]),s.x=g[y+0],s.y=g[y+1],n.x=g[y+2],n.y=g[y+3],0===y&&!0===h&&l.copy(n);break;case"Q":for(var g=a(v),y=0,_=g.length;y<_;y+=4)r.quadraticCurveTo(g[y+0],g[y+1],g[y+2],g[y+3]),s.x=g[y+0],s.y=g[y+1],n.x=g[y+2],n.y=g[y+3],0===y&&!0===h&&l.copy(n);break;case"T":for(var g=a(v),y=0,_=g.length;y<_;y+=2){var b=o(n.x,s.x),x=o(n.y,s.y);r.quadraticCurveTo(b,x,g[y+0],g[y+1]),s.x=b,s.y=x,n.x=g[y+0],n.y=g[y+1],0===y&&!0===h&&l.copy(n)}break;case"A":for(var g=a(v),y=0,_=g.length;y<_;y+=7){var w=n.clone();n.x=g[y+5],n.y=g[y+6],s.x=n.x,s.y=n.y,t(r,g[y],g[y+1],g[y+2],g[y+3],g[y+4],w,n),0===y&&!0===h&&l.copy(n)}break;case"m":for(var g=a(v),y=0,_=g.length;y<_;y+=2)n.x+=g[y+0],n.y+=g[y+1],s.x=n.x,s.y=n.y,0===y?r.moveTo(n.x,n.y):r.lineTo(n.x,n.y),0===y&&!0===h&&l.copy(n);break;case"h":for(var g=a(v),y=0,_=g.length;y<_;y++)n.x+=g[y],s.x=n.x,s.y=n.y,r.lineTo(n.x,n.y),0===y&&!0===h&&l.copy(n);break;case"v":for(var g=a(v),y=0,_=g.length;y<_;y++)n.y+=g[y],s.x=n.x,s.y=n.y,r.lineTo(n.x,n.y),0===y&&!0===h&&l.copy(n);break;case"l":for(var g=a(v),y=0,_=g.length;y<_;y+=2)n.x+=g[y+0],n.y+=g[y+1],s.x=n.x,s.y=n.y,r.lineTo(n.x,n.y),0===y&&!0===h&&l.copy(n);break;case"c":for(var g=a(v),y=0,_=g.length;y<_;y+=6)r.bezierCurveTo(n.x+g[y+0],n.y+g[y+1],n.x+g[y+2],n.y+g[y+3],n.x+g[y+4],n.y+g[y+5]),s.x=n.x+g[y+2],s.y=n.y+g[y+3],n.x+=g[y+4],n.y+=g[y+5],0===y&&!0===h&&l.copy(n);break;case"s":for(var g=a(v),y=0,_=g.length;y<_;y+=4)r.bezierCurveTo(o(n.x,s.x),o(n.y,s.y),n.x+g[y+0],n.y+g[y+1],n.x+g[y+2],n.y+g[y+3]),s.x=n.x+g[y+0],s.y=n.y+g[y+1],n.x+=g[y+2],n.y+=g[y+3],0===y&&!0===h&&l.copy(n);break;case"q":for(var g=a(v),y=0,_=g.length;y<_;y+=4)r.quadraticCurveTo(n.x+g[y+0],n.y+g[y+1],n.x+g[y+2],n.y+g[y+3]),s.x=n.x+g[y+0],s.y=n.y+g[y+1],n.x+=g[y+2],n.y+=g[y+3],0===y&&!0===h&&l.copy(n);break;case"t":for(var g=a(v),y=0,_=g.length;y<_;y+=2){var b=o(n.x,s.x),x=o(n.y,s.y);r.quadraticCurveTo(b,x,n.x+g[y+0],n.y+g[y+1]),s.x=b,s.y=x,n.x=n.x+g[y+0],n.y=n.y+g[y+1],0===y&&!0===h&&l.copy(n)}break;case"a":for(var g=a(v),y=0,_=g.length;y<_;y+=7){var w=n.clone();n.x+=g[y+5],n.y+=g[y+6],s.x=n.x,s.y=n.y,t(r,g[y],g[y+1],g[y+2],g[y+3],g[y+4],w,n),0===y&&!0===h&&l.copy(n)}break;case"Z":case"z":r.currentPath.autoClose=!0,r.currentPath.curves.length>0&&(n.copy(l),r.currentPath.currentPoint.copy(n),u=!0);break;default:console.warn(f)}h=!1}return r}(i,v));break;case"rect":n(v=r(i,v))&&(y=function(e,t){var i=parseFloat(e.getAttribute("x")||0),r=parseFloat(e.getAttribute("y")||0),n=parseFloat(e.getAttribute("rx")||0),o=parseFloat(e.getAttribute("ry")||0),a=parseFloat(e.getAttribute("width")),s=parseFloat(e.getAttribute("height")),l=new ShapePath;return l.color.setStyle(t.fill),l.moveTo(i+2*n,r),l.lineTo(i+a-2*n,r),(0!==n||0!==o)&&l.bezierCurveTo(i+a,r,i+a,r,i+a,r+2*o),l.lineTo(i+a,r+s-2*o),(0!==n||0!==o)&&l.bezierCurveTo(i+a,r+s,i+a,r+s,i+a-2*n,r+s),l.lineTo(i+2*n,r+s),(0!==n||0!==o)&&l.bezierCurveTo(i,r+s,i,r+s,i,r+s-2*o),l.lineTo(i,r+2*o),(0!==n||0!==o)&&l.bezierCurveTo(i,r,i,r,i+2*n,r),l}(i,v));break;case"polygon":n(v=r(i,v))&&(y=function(e,t){var i=new ShapePath;i.color.setStyle(t.fill);var r=0;return e.getAttribute("points").replace(/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,function(e,t,n){var o=parseFloat(t),a=parseFloat(n);0===r?i.moveTo(o,a):i.lineTo(o,a),r++}),i.currentPath.autoClose=!0,i}(i,v));break;case"polyline":n(v=r(i,v))&&(y=function(e,t){var i=new ShapePath;i.color.setStyle(t.fill);var r=0;return e.getAttribute("points").replace(/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,function(e,t,n){var o=parseFloat(t),a=parseFloat(n);0===r?i.moveTo(o,a):i.lineTo(o,a),r++}),i.currentPath.autoClose=!1,i}(i,v));break;case"circle":n(v=r(i,v))&&(y=function(e,t){var i=parseFloat(e.getAttribute("cx")),r=parseFloat(e.getAttribute("cy")),n=parseFloat(e.getAttribute("r")),o=new Path;o.absarc(i,r,n,0,2*Math.PI);var a=new ShapePath;return a.color.setStyle(t.fill),a.subPaths.push(o),a}(i,v));break;case"ellipse":n(v=r(i,v))&&(y=function(e,t){var i=parseFloat(e.getAttribute("cx")),r=parseFloat(e.getAttribute("cy")),n=parseFloat(e.getAttribute("rx")),o=parseFloat(e.getAttribute("ry")),a=new Path;a.absellipse(i,r,n,o,0,2*Math.PI);var s=new ShapePath;return s.color.setStyle(t.fill),s.subPaths.push(a),s}(i,v));break;case"line":n(v=r(i,v))&&(y=function(e,t){var i=parseFloat(e.getAttribute("x1")),r=parseFloat(e.getAttribute("y1")),n=parseFloat(e.getAttribute("x2")),o=parseFloat(e.getAttribute("y2")),a=new ShapePath;return a.moveTo(i,r),a.lineTo(n,o),a.currentPath.autoClose=!1,a}(i));break;default:console.log(i)}y&&(function(e,t){function i(e){o.set(e.x,e.y,1).applyMatrix3(t),e.set(o.x,o.y)}for(var r=function(e){return 0!==e.elements[1]||0!==e.elements[3]}(t),n=new Vector2,o=new Vector3,a=e.subPaths,u=0,h=a.length;u<h;u++)for(var c=a[u],d=c.curves,p=0;p<d.length;p++){var f=d[p];f.isLineCurve?(i(f.v1),i(f.v2)):f.isCubicBezierCurve?(i(f.v0),i(f.v1),i(f.v2),i(f.v3)):f.isQuadraticBezierCurve?(i(f.v0),i(f.v1),i(f.v2)):f.isEllipseCurve&&(r&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),n.set(f.aX,f.aY),i(n),f.aX=n.x,f.aY=n.y,f.xRadius*=s(t),f.yRadius*=l(t))}}(y,m),u.push(y));for(var _=i.childNodes,b=0;b<_.length;b++)e(_[b],v);g&&m.copy(h.pop())}}(v.documentElement,{fill:"#000"}),console.timeEnd("SVGLoader: Parse"),u}};var TDSLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager,this.debug=!1,this.group=null,this.position=0,this.materials=[],this.meshes=[]};TDSLoader.prototype={constructor:TDSLoader,crossOrigin:"anonymous",load:function(e,t,i,r){var n=this,o=void 0!==this.path?this.path:LoaderUtils.extractUrlBase(e),a=new FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.load(e,function(e){t(n.parse(e,o))},i,r)},parse:function(e,t){this.group=new Group,this.position=0,this.materials=[],this.meshes=[],this.readFile(e,t);for(var i=0;i<this.meshes.length;i++)this.group.add(this.meshes[i]);return this.group},readFile:function(e,t){var i=new DataView(e),r=this.readChunk(i);if(r.id===MLIBMAGIC||r.id===CMAGIC||r.id===M3DMAGIC)for(var n=this.nextChunk(i,r);0!==n;){if(n===M3D_VERSION){var o=this.readDWord(i);this.debugMessage("3DS file version: "+o)}else n===MDATA?(this.resetPosition(i),this.readMeshData(i,t)):this.debugMessage("Unknown main chunk: "+n.toString(16));n=this.nextChunk(i,r)}this.debugMessage("Parsed "+this.meshes.length+" meshes")},readMeshData:function(e,t){for(var i=this.readChunk(e),r=this.nextChunk(e,i);0!==r;){if(r===MESH_VERSION){var n=+this.readDWord(e);this.debugMessage("Mesh Version: "+n)}else if(r===MASTER_SCALE){var o=this.readFloat(e);this.debugMessage("Master scale: "+o),this.group.scale.set(o,o,o)}else r===NAMED_OBJECT?(this.debugMessage("Named Object"),this.resetPosition(e),this.readNamedObject(e)):r===MAT_ENTRY?(this.debugMessage("Material"),this.resetPosition(e),this.readMaterialEntry(e,t)):this.debugMessage("Unknown MDATA chunk: "+r.toString(16));r=this.nextChunk(e,i)}},readNamedObject:function(e){var t=this.readChunk(e),i=this.readString(e,64);t.cur=this.position;for(var r=this.nextChunk(e,t);0!==r;){if(r===N_TRI_OBJECT){this.resetPosition(e);var n=this.readMesh(e);n.name=i,this.meshes.push(n)}else this.debugMessage("Unknown named object chunk: "+r.toString(16));r=this.nextChunk(e,t)}this.endChunk(t)},readMaterialEntry:function(e,t){for(var i=this.readChunk(e),r=this.nextChunk(e,i),n=new MeshPhongMaterial;0!==r;){if(r===MAT_NAME)n.name=this.readString(e,64),this.debugMessage("   Name: "+n.name);else if(r===MAT_WIRE)this.debugMessage("   Wireframe"),n.wireframe=!0;else if(r===MAT_WIRE_SIZE){var o=this.readByte(e);n.wireframeLinewidth=o,this.debugMessage("   Wireframe Thickness: "+o)}else if(r===MAT_TWO_SIDE)n.side=DoubleSide,this.debugMessage("   DoubleSided");else if(r===MAT_ADDITIVE)this.debugMessage("   Additive Blending"),n.blending=AdditiveBlending;else if(r===MAT_DIFFUSE)this.debugMessage("   Diffuse Color"),n.color=this.readColor(e);else if(r===MAT_SPECULAR)this.debugMessage("   Specular Color"),n.specular=this.readColor(e);else if(r===MAT_AMBIENT)this.debugMessage("   Ambient color"),n.color=this.readColor(e);else if(r===MAT_SHININESS){var a=this.readWord(e);n.shininess=a,this.debugMessage("   Shininess : "+a)}else r===MAT_TEXMAP?(this.debugMessage("   ColorMap"),this.resetPosition(e),n.map=this.readMap(e,t)):r===MAT_BUMPMAP?(this.debugMessage("   BumpMap"),this.resetPosition(e),n.bumpMap=this.readMap(e,t)):r===MAT_OPACMAP?(this.debugMessage("   OpacityMap"),this.resetPosition(e),n.alphaMap=this.readMap(e,t)):r===MAT_SPECMAP?(this.debugMessage("   SpecularMap"),this.resetPosition(e),n.specularMap=this.readMap(e,t)):this.debugMessage("   Unknown material chunk: "+r.toString(16));r=this.nextChunk(e,i)}this.endChunk(i),this.materials[n.name]=n},readMesh:function(e){var t=this.readChunk(e),i=this.nextChunk(e,t),r=new BufferGeometry,n=[],o=new Mesh(r,new MeshPhongMaterial);for(o.name="mesh";0!==i;){if(i===POINT_ARRAY){var a=this.readWord(e);this.debugMessage("   Vertex: "+a);for(var s=[],l=0;l<a;l++)s.push(this.readFloat(e)),s.push(this.readFloat(e)),s.push(this.readFloat(e));r.addAttribute("position",new Float32BufferAttribute(s,3))}else if(i===FACE_ARRAY)this.resetPosition(e),this.readFaceArray(e,o);else if(i===TEX_VERTS){var u=this.readWord(e);this.debugMessage("   UV: "+u);for(n=[],l=0;l<u;l++)n.push(this.readFloat(e)),n.push(this.readFloat(e));r.addAttribute("uv",new Float32BufferAttribute(n,2))}else if(i===MESH_MATRIX){this.debugMessage("   Tranformation Matrix (TODO)");var h=[];for(l=0;l<12;l++)h[l]=this.readFloat(e);var c=new Matrix4;c.elements[0]=h[0],c.elements[1]=h[6],c.elements[2]=h[3],c.elements[3]=h[9],c.elements[4]=h[2],c.elements[5]=h[8],c.elements[6]=h[5],c.elements[7]=h[11],c.elements[8]=h[1],c.elements[9]=h[7],c.elements[10]=h[4],c.elements[11]=h[10],c.elements[12]=0,c.elements[13]=0,c.elements[14]=0,c.elements[15]=1,c.transpose();var d=new Matrix4;d.getInverse(c,!0),r.applyMatrix(d),c.decompose(o.position,o.quaternion,o.scale)}else this.debugMessage("   Unknown mesh chunk: "+i.toString(16));i=this.nextChunk(e,t)}return this.endChunk(t),r.computeVertexNormals(),o},readFaceArray:function(e,t){var i=this.readChunk(e),r=this.readWord(e);this.debugMessage("   Faces: "+r);for(var n=[],o=0;o<r;++o){n.push(this.readWord(e),this.readWord(e),this.readWord(e));this.readWord(e)}for(t.geometry.setIndex(n);this.position<i.end;){if((i=this.readChunk(e)).id===MSH_MAT_GROUP){this.debugMessage("      Material Group"),this.resetPosition(e);var a=this.readMaterialGroup(e),s=this.materials[a.name];void 0!==s&&(t.material=s,""===s.name&&(s.name=t.name))}else this.debugMessage("      Unknown face array chunk: "+i.toString(16));this.endChunk(i)}this.endChunk(i)},readMap:function(e,t){var i=this.readChunk(e),r=this.nextChunk(e,i),n={},o=new TextureLoader(this.manager);for(o.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);0!==r;){if(r===MAT_MAPNAME){var a=this.readString(e,128);n=o.load(a),this.debugMessage("      File: "+t+a)}else r===MAT_MAP_UOFFSET?(n.offset.x=this.readFloat(e),this.debugMessage("      OffsetX: "+n.offset.x)):r===MAT_MAP_VOFFSET?(n.offset.y=this.readFloat(e),this.debugMessage("      OffsetY: "+n.offset.y)):r===MAT_MAP_USCALE?(n.repeat.x=this.readFloat(e),this.debugMessage("      RepeatX: "+n.repeat.x)):r===MAT_MAP_VSCALE?(n.repeat.y=this.readFloat(e),this.debugMessage("      RepeatY: "+n.repeat.y)):this.debugMessage("      Unknown map chunk: "+r.toString(16));r=this.nextChunk(e,i)}return this.endChunk(i),n},readMaterialGroup:function(e){this.readChunk(e);var t=this.readString(e,64),i=this.readWord(e);this.debugMessage("         Name: "+t),this.debugMessage("         Faces: "+i);for(var r=[],n=0;n<i;++n)r.push(this.readWord(e));return{name:t,index:r}},readColor:function(e){var t=this.readChunk(e),i=new Color;if(t.id===COLOR_24||t.id===LIN_COLOR_24){var r=this.readByte(e),n=this.readByte(e),o=this.readByte(e);i.setRGB(r/255,n/255,o/255),this.debugMessage("      Color: "+i.r+", "+i.g+", "+i.b)}else if(t.id===COLOR_F||t.id===LIN_COLOR_F){r=this.readFloat(e),n=this.readFloat(e),o=this.readFloat(e);i.setRGB(r,n,o),this.debugMessage("      Color: "+i.r+", "+i.g+", "+i.b)}else this.debugMessage("      Unknown color chunk: "+t.toString(16));return this.endChunk(t),i},readChunk:function(e){var t={};return t.cur=this.position,t.id=this.readWord(e),t.size=this.readDWord(e),t.end=t.cur+t.size,t.cur+=6,t},endChunk:function(e){this.position=e.end},nextChunk:function(e,t){if(t.cur>=t.end)return 0;this.position=t.cur;try{var i=this.readChunk(e);return t.cur+=i.size,i.id}catch(e){return this.debugMessage("Unable to read chunk at "+this.position),0}},resetPosition:function(){this.position-=6},readByte:function(e){var t=e.getUint8(this.position,!0);return this.position+=1,t},readFloat:function(e){try{var t=e.getFloat32(this.position,!0);return this.position+=4,t}catch(t){this.debugMessage(t+" "+this.position+" "+e.byteLength)}},readInt:function(e){var t=e.getInt32(this.position,!0);return this.position+=4,t},readShort:function(e){var t=e.getInt16(this.position,!0);return this.position+=2,t},readDWord:function(e){var t=e.getUint32(this.position,!0);return this.position+=4,t},readWord:function(e){var t=e.getUint16(this.position,!0);return this.position+=2,t},readString:function(e,t){for(var i="",r=0;r<t;r++){var n=this.readByte(e);if(!n)break;i+=String.fromCharCode(n)}return i},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},debugMessage:function(e){this.debug&&console.log(e)}};var M3DMAGIC=19789,MLIBMAGIC=15786,CMAGIC=49725,M3D_VERSION=2,COLOR_F=16,COLOR_24=17,LIN_COLOR_24=18,LIN_COLOR_F=19,MDATA=15677,MESH_VERSION=15678,MASTER_SCALE=256,MAT_ENTRY=45055,MAT_NAME=40960,MAT_AMBIENT=40976,MAT_DIFFUSE=40992,MAT_SPECULAR=41008,MAT_SHININESS=41024,MAT_TWO_SIDE=41089,MAT_ADDITIVE=41091,MAT_WIRE=41093,MAT_WIRE_SIZE=41095,MAT_TEXMAP=41472,MAT_OPACMAP=41488,MAT_BUMPMAP=41520,MAT_SPECMAP=41476,MAT_MAPNAME=41728,MAT_MAP_USCALE=41812,MAT_MAP_VSCALE=41814,MAT_MAP_UOFFSET=41816,MAT_MAP_VOFFSET=41818,NAMED_OBJECT=16384,N_TRI_OBJECT=16640,POINT_ARRAY=16656,FACE_ARRAY=16672,MSH_MAT_GROUP=16688,TEX_VERTS=16704,MESH_MATRIX=16736,TTFLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager,this.reversed=!1};TTFLoader.prototype={constructor:TTFLoader,load:function(e,t,i,r){var n=this,o=new FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.load(e,function(e){t(n.parse(e))},i,r)},setPath:function(e){return this.path=e,this},parse:function(e){function t(e){var t,i=[];e.forEach(function(e){"m"===e.type.toLowerCase()?(t=[e],i.push(t)):"z"!==e.type.toLowerCase()&&t.push(e)});var r=[];return i.forEach(function(e){var t={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};r.push(t);for(var i=e.length-1;i>0;i--){var n=e[i];t={type:n.type};void 0!==n.x2&&void 0!==n.y2?(t.x1=n.x2,t.y1=n.y2,t.x2=n.x1,t.y2=n.y1):void 0!==n.x1&&void 0!==n.y1&&(t.x1=n.x1,t.y1=n.y1),t.x=e[i-1].x,t.y=e[i-1].y,r.push(t)}}),r}return"undefined"==typeof opentype?(console.warn("TTFLoader: The loader requires opentype.js. Make sure it's included before using the loader."),null):function(e,i){for(var r=Math.round,n={},o=1e5/(72*(e.unitsPerEm||2048)),a=0;a<e.glyphs.length;a++){var s=e.glyphs.glyphs[a];if(void 0!==s.unicode){var l={ha:r(s.advanceWidth*o),x_min:r(s.xMin*o),x_max:r(s.xMax*o),o:""};i&&(s.path.commands=t(s.path.commands)),s.path.commands.forEach(function(e,t){"c"===e.type.toLowerCase()&&(e.type="b"),l.o+=e.type.toLowerCase()+" ",void 0!==e.x&&void 0!==e.y&&(l.o+=r(e.x*o)+" "+r(e.y*o)+" "),void 0!==e.x1&&void 0!==e.y1&&(l.o+=r(e.x1*o)+" "+r(e.y1*o)+" "),void 0!==e.x2&&void 0!==e.y2&&(l.o+=r(e.x2*o)+" "+r(e.y2*o)+" ")}),n[String.fromCharCode(s.unicode)]=l}}return{glyphs:n,familyName:e.familyName,ascender:r(e.ascender*o),descender:r(e.descender*o),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}(opentype.parse(e),this.reversed)}};var VRMLLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager};VRMLLoader.prototype={constructor:VRMLLoader,isRecordingPoints:!1,isRecordingFaces:!1,points:[],indexes:[],isRecordingAngles:!1,isRecordingColors:!1,angles:[],colors:[],recordingFieldname:null,crossOrigin:"anonymous",load:function(e,t,i,r){var n=this,o=void 0===n.path?LoaderUtils.extractUrlBase(e):n.path,a=new FileLoader(this.manager);a.setPath(n.path),a.load(e,function(e){t(n.parse(e,o))},i,r)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){var i=this,r=new TextureLoader(this.manager);r.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);for(var n=new Scene,o=e.split("\n"),a=o.length-1;a>-1;a--){var s=o[a];if(s=s.replace(/(#.*)/,""),/{.*[{\[]/.test(s))(l=s.split("{").join("{\n").split("\n")).unshift(1),l.unshift(a),o.splice.apply(o,l);else if(/\].*}/.test(s)){var l;(l=s.split("]").join("]\n").split("\n")).unshift(1),l.unshift(a),o.splice.apply(o,l)}if(/}.*}/.test(s))(l=s.split("}").join("}\n").split("\n")).unshift(1),l.unshift(a),o.splice.apply(o,l);/^\b[^\s]+\b$/.test(s.trim())?(o[a+1]=s+" "+o[a+1].trim(),o.splice(a,1)):s.indexOf("coord")>-1&&s.indexOf("[")<0&&s.indexOf("{")<0&&(o[a]+=" Coordinate {}")}var u=o.shift();return/V1.0/.exec(u)?console.warn("VRMLLoader: V1.0 not supported yet."):/V2.0/.exec(u)&&function(e,t){var n={},o=/(\b|\-|\+)([\d\.e]+)/,a=/([\d\.\+\-e]+)\s+([\d\.\+\-e]+)/g,s=/([\d\.\+\-e]+)\s+([\d\.\+\-e]+)\s+([\d\.\+\-e]+)/g;function l(e,t,i,r,n){for(var o=!0===n?1:-1,a=[],s={},l={},u=0;u<i.length;u++){var h={x:o*(Math.cos(i[u])*t),y:o*(Math.sin(i[u])*t)};a.push(h)}for(var c=e.index,d=e.attributes.position,p=new BufferAttribute(new Float32Array(3*e.attributes.position.count),3),f=new Vector3,m=new Color,v=0;v<c.count;v++){var g=c.getX(v);f.fromBufferAttribute(d,g);for(var y=0;y<r.length;y++)if(0===y?(s.x=0,s.y=!0===n?t:-1*t):(s.x=a[y-1].x,s.y=a[y-1].y),void 0!==(l=a[y]))if(!0==(!0===n?f.y<=s.y&&f.y>l.y:f.y>=s.y&&f.y<l.y)){var _=r[y],b=r[y+1],x=Math.abs(f.y-s.y)/(s.y-l.y);m.copy(_).lerp(b,x),p.setXYZ(g,m.r,m.g,m.b)}else{var w=r[!0===n?r.length-1:0];p.setXYZ(g,w.r,w.g,w.b)}}e.addAttribute("color",p)}var u=[];function h(e,t){for(var r,n,l,h=[],c={},d=/[^\s,\[\]]+/g;null!==(r=d.exec(t));)h.push(r[0]);switch(n=h[0]){case"skyAngle":case"groundAngle":i.recordingFieldname=n,i.isRecordingAngles=!0,i.angles=[];break;case"color":case"skyColor":case"groundColor":i.recordingFieldname=n,i.isRecordingColors=!0,i.colors=[];break;case"point":case"vector":i.recordingFieldname=n,i.isRecordingPoints=!0,i.points=[];break;case"colorIndex":case"coordIndex":case"normalIndex":case"texCoordIndex":i.recordingFieldname=n,i.isRecordingFaces=!0,i.indexes=[]}if(i.isRecordingFaces){if(h.length>0)for(var p=0;p<h.length;p++)/(-?\d+)/.test(h[p])&&("-1"===h[p]?(u.length>0&&i.indexes.push(u),u=[]):u.push(parseInt(h[p])));/]/.exec(t)&&(u.length>0&&i.indexes.push(u),u=[],i.isRecordingFaces=!1,e[i.recordingFieldname]=i.indexes)}else if(i.isRecordingPoints){if("Coordinate"==e.nodeType)for(;null!==(h=s.exec(t));)l={x:parseFloat(h[1]),y:parseFloat(h[2]),z:parseFloat(h[3])},i.points.push(l);if("Normal"==e.nodeType)for(;null!==(h=s.exec(t));)l={x:parseFloat(h[1]),y:parseFloat(h[2]),z:parseFloat(h[3])},i.points.push(l);if("TextureCoordinate"==e.nodeType)for(;null!==(h=a.exec(t));)l={x:parseFloat(h[1]),y:parseFloat(h[2])},i.points.push(l);/]/.exec(t)&&(i.isRecordingPoints=!1,e.points=i.points)}else if(i.isRecordingAngles){if(h.length>0)for(p=0;p<h.length;p++)o.test(h[p])&&i.angles.push(parseFloat(h[p]));/]/.exec(t)&&(i.isRecordingAngles=!1,e[i.recordingFieldname]=i.angles)}else if(i.isRecordingColors){for(;null!==(h=s.exec(t));){var f={r:parseFloat(h[1]),g:parseFloat(h[2]),b:parseFloat(h[3])};i.colors.push(f)}/]/.exec(t)&&(i.isRecordingColors=!1,e[i.recordingFieldname]=i.colors)}else if("NULL"!==h[h.length-1]&&"children"!==n){switch(n){case"diffuseColor":case"emissiveColor":case"specularColor":case"color":if(4!==h.length){console.warn("VRMLLoader: Invalid color format detected for %s.",n);break}c={r:parseFloat(h[1]),g:parseFloat(h[2]),b:parseFloat(h[3])};break;case"location":case"direction":case"translation":case"scale":case"size":if(4!==h.length){console.warn("VRMLLoader: Invalid vector format detected for %s.",n);break}c={x:parseFloat(h[1]),y:parseFloat(h[2]),z:parseFloat(h[3])};break;case"intensity":case"cutOffAngle":case"radius":case"topRadius":case"bottomRadius":case"height":case"transparency":case"shininess":case"ambientIntensity":case"creaseAngle":if(2!==h.length){console.warn("VRMLLoader: Invalid single float value specification detected for %s.",n);break}c=parseFloat(h[1]);break;case"rotation":if(5!==h.length){console.warn("VRMLLoader: Invalid quaternion format detected for %s.",n);break}c={x:parseFloat(h[1]),y:parseFloat(h[2]),z:parseFloat(h[3]),w:parseFloat(h[4])};break;case"on":case"ccw":case"solid":case"colorPerVertex":case"convex":if(2!==h.length){console.warn("VRMLLoader: Invalid format detected for %s.",n);break}c="TRUE"===h[1]}e[n]=c}return c}!function e(i,o){var a;if("string"!=typeof i){a=o,i.string.indexOf("AmbientLight")>-1&&"PointLight"===i.nodeType&&(i.nodeType="AmbientLight");var s=void 0===i.on||i.on,u=void 0!==i.intensity?i.intensity:1,h=new Color;if(i.color&&h.copy(i.color),"AmbientLight"===i.nodeType)(a=new AmbientLight(h,u)).visible=s,o.add(a);else if("PointLight"===i.nodeType){var c=0;void 0!==i.radius&&i.radius<1e3&&(c=i.radius),(a=new PointLight(h,u,c)).visible=s,o.add(a)}else if("SpotLight"===i.nodeType){u=1,c=0;var d=Math.PI/3;s=!0,void 0!==i.radius&&i.radius<1e3&&(c=i.radius),void 0!==i.cutOffAngle&&(d=i.cutOffAngle),(a=new SpotLight(h,u,c,d,0)).visible=s,o.add(a)}else if("Transform"===i.nodeType||"Group"===i.nodeType){if(a=new Object3D,/DEF/.exec(i.string)&&(a.name=/DEF\s+([^\s]+)/.exec(i.string)[1],n[a.name]=a),void 0!==i.translation){var p=i.translation;a.position.set(p.x,p.y,p.z)}if(void 0!==i.rotation){var f=i.rotation;a.quaternion.setFromAxisAngle(new Vector3(f.x,f.y,f.z),f.w)}if(void 0!==i.scale){var m=i.scale;a.scale.set(m.x,m.y,m.z)}o.add(a)}else if("Shape"===i.nodeType)a=new Mesh,/DEF/.exec(i.string)&&(a.name=/DEF\s+([^\s]+)/.exec(i.string)[1],n[a.name]=a),o.add(a);else if("Background"===i.nodeType){var v=2e4,g=new SphereBufferGeometry(v,20,20),y=new MeshBasicMaterial({fog:!1,side:BackSide});if(i.skyColor.length>1)l(g,v,i.skyAngle,i.skyColor,!0),y.vertexColors=VertexColors;else{var _=i.skyColor[0];y.color.setRGB(_.r,_.b,_.g)}if(t.add(new Mesh(g,y)),void 0!==i.groundColor){var b=new SphereBufferGeometry(v=12e3,20,20,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),x=new MeshBasicMaterial({fog:!1,side:BackSide,vertexColors:VertexColors});l(b,v,i.groundAngle,i.groundColor,!1),t.add(new Mesh(b,x))}}else{if(/geometry/.exec(i.string)){if("Box"===i.nodeType)m=i.size,o.geometry=new BoxBufferGeometry(m.x,m.y,m.z);else if("Cylinder"===i.nodeType)o.geometry=new CylinderBufferGeometry(i.radius,i.radius,i.height);else if("Cone"===i.nodeType)o.geometry=new CylinderBufferGeometry(i.topRadius,i.bottomRadius,i.height);else if("Sphere"===i.nodeType)o.geometry=new SphereBufferGeometry(i.radius);else if("IndexedFaceSet"===i.nodeType){var w,S,M,T,A,C,L=new BufferGeometry,N=[],P=[],k=[],E=[];for(J=0,T=i.children.length;J<T;J++){if("TextureCoordinate"===($=i.children[J]).nodeType&&$.points)for(A=0,C=$.points.length;A<C;A++)M=$.points[A],E.push(M.x,M.y);if("Normal"===$.nodeType&&$.points)for(A=0,C=$.points.length;A<C;A++)S=$.points[A],k.push(S.x,S.y,S.z);if("Color"===$.nodeType&&$.color)for(A=0,C=$.color.length;A<C;A++)_=$.color[A],P.push(_.r,_.g,_.b);if("Coordinate"===$.nodeType){if($.points)for(A=0,C=$.points.length;A<C;A++)w=$.points[A],N.push(w.x,w.y,w.z);if($.string.indexOf("DEF")>-1){var D=/DEF\s+([^\s]+)/.exec($.string)[1];n[D]=N.slice(0)}$.string.indexOf("USE")>-1&&(oe=/USE\s+([^\s]+)/.exec($.string)[1],N=n[oe])}}if(i.coordIndex){function O(e,t,i){void 0===t&&(t=!0);var r=[],n=0;for(J=0,T=e.length;J<T;J++)if(!1===i){var o=e[J];for(A=0,C=o.length;A<C;A++){var a=o[A];r.push(a,a,a)}}else{var s=e[J];for(n=0;s.length>=3&&n<s.length-2;){var l=s[0],u=s[n+(t?1:2)],h=s[n+(t?2:1)];r.push(l,u,h),n++}}return r}var R=i.coordIndex?O(i.coordIndex,i.ccw):[],F=i.normalIndex?O(i.normalIndex,i.ccw):R,I=i.colorIndex?O(i.colorIndex,i.ccw,i.colorPerVertex):[],B=i.texCoordIndex?O(i.texCoordIndex,i.ccw):R,U=[],V=[],z=[],G=[],j=[],W=Object.create(null);for(J=0;J<R.length;J++){var H=[],q=R[J],Y=F[J],X=I[J],K=B[J];H.push(q.toString(10)),void 0!==Y&&H.push(Y.toString(10)),void 0!==X&&H.push(X.toString(10)),void 0!==K&&H.push(K.toString(10));var Q=H.join(","),Z=W[Q];void 0===Z&&(Z=V.length/3,W[Q]=Z,V.push(N[3*q],N[3*q+1],N[3*q+2]),void 0!==Y&&k.length>0&&z.push(k[3*Y],k[3*Y+1],k[3*Y+2]),void 0!==X&&P.length>0&&G.push(P[3*X],P[3*X+1],P[3*X+2]),void 0!==K&&E.length>0&&j.push(E[2*K],E[2*K+1])),U.push(Z)}N=V,k=z,P=G,E=j,L.setIndex(U)}else o.parent.remove(o);!1===i.solid&&(o.material.side=DoubleSide),L.solid=i.solid,L.addAttribute("position",new Float32BufferAttribute(N,3)),P.length>0&&(L.addAttribute("color",new Float32BufferAttribute(P,3)),o.material.vertexColors=VertexColors),E.length>0&&L.addAttribute("uv",new Float32BufferAttribute(E,2)),k.length>0?L.addAttribute("normal",new Float32BufferAttribute(k,3)):(L=L.toNonIndexed()).computeVertexNormals(),L.computeBoundingSphere(),/DEF/.exec(i.string)&&(L.name=/DEF ([^\s]+)/.exec(i.string)[1],n[L.name]=L),o.geometry=L}return}if(/appearance/.exec(i.string)){for(var J=0;J<i.children.length;J++){var $;if("Material"===($=i.children[J]).nodeType){var ee=new MeshPhongMaterial;if(void 0!==$.diffuseColor){var te=$.diffuseColor;ee.color.setRGB(te.r,te.g,te.b)}if(void 0!==$.emissiveColor){var ie=$.emissiveColor;ee.emissive.setRGB(ie.r,ie.g,ie.b)}void 0!==$.specularColor&&(m=$.specularColor,ee.specular.setRGB(m.r,m.g,m.b)),void 0!==$.transparency&&(p=$.transparency,ee.opacity=Math.abs(1-p),ee.transparent=!0),/DEF/.exec(i.string)&&(ee.name=/DEF ([^\s]+)/.exec(i.string)[1],n[ee.name]=ee),o.material=ee}if("ImageTexture"===$.nodeType){var re=/"([^"]+)"/.exec($.children[0]);re&&(o.material.name=re[1],o.material.map=r.load(re[1]))}}return}}J=0;for(var ne=i.children.length;J<ne;J++)e(i.children[J],a)}else if(/USE/.exec(i)){var oe=/USE\s+?([^\s]+)/.exec(i)[1];null==n[oe]?console.warn("VRMLLoader: %s is not defined.",oe):/appearance/.exec(i)&&oe?o.material=n[oe].clone():/geometry/.exec(i)&&oe?(o.geometry=n[oe].clone(),void 0!==n[oe].solid&&!1===n[oe].solid&&(o.geometry.solid=!1,o.material.side=DoubleSide)):oe&&(a=n[oe].clone(),o.add(a))}}(function(e){for(var t,i,r={string:"Scene",children:[]},n=r,o=0;o<e.length;o++){var a="",s=e[o];if(null===/^\s+?$/g.exec(s)&&""!==(s=s.trim())){if(/#/.exec(s)){var l=s.split("#");s=l[0],a=l[1]}if(t=/([^\s]*){1}(?:\s+)?{/.exec(s)){var u={nodeType:t[1],string:s,parent:n,children:[],comment:a};n.children.push(u),n=u,/}/.exec(s)&&(i=/{(.*)}/.exec(s)[1],u.children.push(i),h(n,i),n=n.parent)}else/}/.exec(s)?n=n.parent:""!==s&&(h(n,s),n.children.push(s))}}return r}(e),t)}(o,n),n}};var VRMLoader=function(){function e(e){if(void 0===GLTFLoader)throw new Error("VRMLoader: Import GLTFLoader.");this.manager=void 0!==e?e:DefaultLoadingManager,this.gltfLoader=new GLTFLoader(this.manager)}return e.prototype={constructor:e,crossOrigin:"anonymous",load:function(e,t,i,r){var n=this;this.gltfLoader.load(e,function(e){n.parse(e,t)},i,r)},setCrossOrigin:function(e){return this.glTFLoader.setCrossOrigin(e),this},setPath:function(e){return this.glTFLoader.setPath(e),this},setResourcePath:function(e){return this.glTFLoader.setResourcePath(e),this},setDRACOLoader:function(e){return this.glTFLoader.setDRACOLoader(e),this},parse:function(e,t){e.parser,(e.userData.gltfExtensions||{}).VRM;t(e)}},e}(),VTKLoader=function(e){this.manager=void 0!==e?e:DefaultLoadingManager};function ImmediateRenderObject(e){Object3D.call(this),this.material=e,this.render=function(){}}Object.assign(VTKLoader.prototype,EventDispatcher.prototype,{load:function(e,t,i,r){var n=this,o=new FileLoader(n.manager);o.setPath(n.path),o.setResponseType("arraybuffer"),o.load(e,function(e){t(n.parse(e))},i,r)},setPath:function(e){return this.path=e,this},parse:function(e){function t(e,t){var i=e.length,r=new Int32Array(i+t.length);return r.set(e),r.set(t,i),r}function i(e){for(var t="",i=new Uint8Array(e),r=0,n=i.length;n--;)t+=String.fromCharCode(i[r++]);return t}var r=LoaderUtils.decodeText(new Uint8Array(e,0,250)).split("\n");return-1!==r[0].indexOf("xml")?function(e){function i(e){var t,i,r,n,o,a,s="undefined"!=typeof Uint8Array?Uint8Array:Array,l=[],u=[],h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=h.length;for(t=0;t<c;t++)l[t]=h[t];for(t=0;t<c;++t)u[h.charCodeAt(t)]=t;if(u["-".charCodeAt(0)]=62,u["_".charCodeAt(0)]=63,(c=e.length)%4>0)throw new Error("Invalid string. Length must be a multiple of 4");a=new s(3*c/4-(o="="===e[c-2]?2:"="===e[c-1]?1:0)),r=o>0?c-4:c;var d=0;for(t=0,i=0;t<r;t+=4,i+=3)n=u[e.charCodeAt(t)]<<18|u[e.charCodeAt(t+1)]<<12|u[e.charCodeAt(t+2)]<<6|u[e.charCodeAt(t+3)],a[d++]=(16711680&n)>>16,a[d++]=(65280&n)>>8,a[d++]=255&n;return 2===o?(n=u[e.charCodeAt(t)]<<2|u[e.charCodeAt(t+1)]>>4,a[d++]=255&n):1===o&&(n=u[e.charCodeAt(t)]<<10|u[e.charCodeAt(t+1)]<<4|u[e.charCodeAt(t+2)]>>2,a[d++]=n>>8&255,a[d++]=255&n),a}function r(e,r){var n,a,s,l,u=0;if("UInt64"===o.attributes.header_type?u=8:"UInt32"===o.attributes.header_type&&(u=4),"binary"===e.attributes.format&&r){var h,c,d,p,f,m;if("Float32"===e.attributes.type)var v=new Float32Array;else"Int64"===e.attributes.type&&(v=new Int32Array);c=(h=i(e["#text"]))[0];for(var g=1;g<u-1;g++)c|=h[g]<<g*u;for(p=(c+3)*u,m=p+=p%3>0?3-p%3:0,(f=[]).push(m),d=3*u,g=0;g<c;g++){for(var y=h[g*u+d],_=1;_<u-1;_++)y|=h[g*u+d+_]<<8*_;m+=y,f.push(m)}for(g=0;g<f.length-1;g++)b=(b=new Zlib.Inflate(h.slice(f[g],f[g+1]),{resize:!0,verify:!0}).decompress()).buffer,"Float32"===e.attributes.type?(b=new Float32Array(b),a=b,s=void 0,l=void 0,s=(n=v).length,(l=new Float32Array(s+a.length)).set(n),l.set(a,s),v=l):"Int64"===e.attributes.type&&(v=t(v,b=new Int32Array(b)));delete e["#text"],"Int64"===e.attributes.type&&"binary"===e.attributes.format&&(v=v.filter(function(e,t){if(t%2!=1)return!0}))}else{if("binary"!==e.attributes.format||r)if(e["#text"])var b=e["#text"].split(/\s+/).filter(function(e){if(""!==e)return e});else b=new Int32Array(0).buffer;else b=(b=i(e["#text"])).slice(u).buffer;delete e["#text"],"Float32"===e.attributes.type?v=new Float32Array(b):"Int32"===e.attributes.type?v=new Int32Array(b):"Int64"===e.attributes.type&&(v=new Int32Array(b),"binary"===e.attributes.format&&(v=v.filter(function(e,t){if(t%2!=1)return!0})))}return v}var n=null;if(window.DOMParser)try{n=(new DOMParser).parseFromString(e,"text/xml")}catch(e){n=null}else{if(!window.ActiveXObject)throw new Error("Cannot parse xml string!");try{if((n=new ActiveXObject("Microsoft.XMLDOM")).async=!1,!n.loadXML())throw new Error(n.parseError.reason+n.parseError.srcText)}catch(e){n=null}}var o=function e(t){var i={};if(1===t.nodeType){if(t.attributes&&t.attributes.length>0){i.attributes={};for(var r=0;r<t.attributes.length;r++){var n=t.attributes.item(r);i.attributes[n.nodeName]=n.nodeValue.trim()}}}else 3===t.nodeType&&(i=t.nodeValue.trim());if(t.hasChildNodes())for(var o=0;o<t.childNodes.length;o++){var a=t.childNodes.item(o),s=a.nodeName;if(void 0===i[s])""!==(u=e(a))&&(i[s]=u);else{if(void 0===i[s].push){var l=i[s];i[s]=[l]}var u;""!==(u=e(a))&&i[s].push(u)}}return i}(n.documentElement),a=[],s=[],l=[];if(o.PolyData){for(var u=o.PolyData.Piece,h=o.attributes.hasOwnProperty("compressor"),c=["PointData","Points","Strips","Polys"],d=0,p=c.length;d<p;){var f=u[c[d]];if(f&&f.DataArray){if("[object Array]"===Object.prototype.toString.call(f.DataArray))var m=f.DataArray;else m=[f.DataArray];for(var v=0,g=m.length;v<g;)"#text"in m[v]&&m[v]["#text"].length>0&&(m[v].text=r(m[v],h)),v++;switch(c[d]){case"PointData":var y=parseInt(u.attributes.NumberOfPoints),_=f.attributes.Normals;if(y>0)for(var b=0,x=m.length;b<x;b++)if(_===m[b].attributes.Name){var w=m[b].attributes.NumberOfComponents;(s=new Float32Array(y*w)).set(m[b].text,0)}break;case"Points":(y=parseInt(u.attributes.NumberOfPoints))>0&&(w=f.DataArray.attributes.NumberOfComponents,(a=new Float32Array(y*w)).set(f.DataArray.text,0));break;case"Strips":var S=parseInt(u.attributes.NumberOfStrips);if(S>0){var M=new Int32Array(f.DataArray[0].text.length),T=new Int32Array(f.DataArray[1].text.length);M.set(f.DataArray[0].text,0),T.set(f.DataArray[1].text,0);var A=S+M.length;l=new Uint32Array(3*A-9*S);var C=0;for(b=0,x=S;b<x;b++){for(var L=[],N=0,P=T[b],k=0;N<P-k;N++)L.push(M[N]),b>0&&(k=T[b-1]);var E=0;for(P=T[b],k=0;E<P-k-2;E++)E%2?(l[C++]=L[E],l[C++]=L[E+2],l[C++]=L[E+1]):(l[C++]=L[E],l[C++]=L[E+1],l[C++]=L[E+2]),b>0&&(k=T[b-1])}}break;case"Polys":var D=parseInt(u.attributes.NumberOfPolys);if(D>0){M=new Int32Array(f.DataArray[0].text.length),T=new Int32Array(f.DataArray[1].text.length),M.set(f.DataArray[0].text,0),T.set(f.DataArray[1].text,0),A=D+M.length,l=new Uint32Array(3*A-9*D),C=0;var O=0;for(b=0,x=D,k=0;b<x;){var R=[];for(N=0,P=T[b];N<P-k;)R.push(M[O++]),N++;for(E=1;E<P-k-1;)l[C++]=R[0],l[C++]=R[E],l[C++]=R[E+1],E++;k=T[++b-1]}}}}d++}var F=new BufferGeometry;return F.setIndex(new BufferAttribute(l,1)),F.addAttribute("position",new BufferAttribute(a,3)),s.length===a.length&&F.addAttribute("normal",new BufferAttribute(s,3)),F}}(i(e)):r[2].includes("ASCII")?function(e){var t,i=[],r=[],n=[],o=[],a=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,s=/^(\d+)\s+([\s\d]*)/,l=/^POINTS /,u=/^POLYGONS /,h=/^TRIANGLE_STRIPS /,c=/^POINT_DATA[ ]+(\d+)/,d=/^CELL_DATA[ ]+(\d+)/,p=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,f=/^NORMALS[ ]+(\w+)[ ]+(\w+)/,m=!1,v=!1,g=!1,y=!1,_=!1,b=!1,x=!1,w=e.split("\n");for(var S in w){var M=w[S];if(m)for(;null!==(t=a.exec(M));){var T=parseFloat(t[1]),A=parseFloat(t[2]),C=parseFloat(t[3]);r.push(T,A,C)}else if(v){if(null!==(t=s.exec(M))){var L=parseInt(t[1]),N=t[2].split(/\s+/);if(L>=3)for(var P=parseInt(N[0]),k=1,E=0;E<L-2;++E)D=parseInt(N[k]),O=parseInt(N[k+1]),i.push(P,D,O),k++}}else if(g){if(null!==(t=s.exec(M))){var D,O;if(L=parseInt(t[1]),N=t[2].split(/\s+/),L>=3)for(E=0;E<L-2;E++)E%2==1?(P=parseInt(N[E]),D=parseInt(N[E+2]),O=parseInt(N[E+1]),i.push(P,D,O)):(P=parseInt(N[E]),D=parseInt(N[E+1]),O=parseInt(N[E+2]),i.push(P,D,O))}}else if(y||_)if(b)for(;null!==(t=a.exec(M));){var R=parseFloat(t[1]),F=parseFloat(t[2]),I=parseFloat(t[3]);n.push(R,F,I)}else if(x)for(;null!==(t=a.exec(M));){var B=parseFloat(t[1]),U=parseFloat(t[2]),V=parseFloat(t[3]);o.push(B,U,V)}null!==u.exec(M)?(v=!0,m=!1,g=!1):null!==l.exec(M)?(v=!1,m=!0,g=!1):null!==h.exec(M)?(v=!1,m=!1,g=!0):null!==c.exec(M)?(y=!0,m=!1,v=!1,g=!1):null!==d.exec(M)?(_=!0,m=!1,v=!1,g=!1):null!==p.exec(M)?(b=!0,x=!1,m=!1,v=!1,g=!1):null!==f.exec(M)&&(x=!0,b=!1,m=!1,v=!1,g=!1)}var z=new BufferGeometry;if(z.setIndex(i),z.addAttribute("position",new Float32BufferAttribute(r,3)),o.length===r.length&&z.addAttribute("normal",new Float32BufferAttribute(o,3)),n.length!==i.length)n.length===r.length&&z.addAttribute("color",new Float32BufferAttribute(n,3));else{var G=(z=z.toNonIndexed()).attributes.position.count/3;if(n.length===3*G){var j=[];for(S=0;S<G;S++)R=n[3*S+0],F=n[3*S+1],I=n[3*S+2],j.push(R,F,I),j.push(R,F,I),j.push(R,F,I);z.addAttribute("color",new Float32BufferAttribute(j,3))}}return z}(i(e)):function(e){var t,i,r,n,o,a,s,l=new Uint8Array(e),u=new DataView(e),h=[],c=[],d=[],p=0;function f(e,t){for(var i=t,r=e[i],n=[];10!==r;)n.push(String.fromCharCode(r)),r=e[++i];return{start:t,end:i,next:i+1,parsedString:n.join("")}}for(;;){if(0===(s=(a=f(l,p)).parsedString).indexOf("POINTS")){for(t=4*(n=parseInt(s.split(" ")[1],10))*3,h=new Float32Array(3*n),i=a.next,r=0;r<n;r++)h[3*r]=u.getFloat32(i,!1),h[3*r+1]=u.getFloat32(i+4,!1),h[3*r+2]=u.getFloat32(i+8,!1),i+=12;a.next=a.next+t+1}else if(0===s.indexOf("TRIANGLE_STRIPS")){var m=parseInt(s.split(" ")[1],10);t=4*(b=parseInt(s.split(" ")[2],10)),d=new Uint32Array(3*b-9*m);var v=0;for(i=a.next,r=0;r<m;r++){var g=u.getInt32(i,!1),y=[];for(i+=4,o=0;o<g;o++)y.push(u.getInt32(i,!1)),i+=4;for(var _=0;_<g-2;_++)_%2?(d[v++]=y[_],d[v++]=y[_+2],d[v++]=y[_+1]):(d[v++]=y[_],d[v++]=y[_+1],d[v++]=y[_+2])}a.next=a.next+t+1}else if(0===s.indexOf("POLYGONS")){var b;for(m=parseInt(s.split(" ")[1],10),t=4*(b=parseInt(s.split(" ")[2],10)),d=new Uint32Array(3*b-9*m),v=0,i=a.next,r=0;r<m;r++){for(g=u.getInt32(i,!1),y=[],i+=4,o=0;o<g;o++)y.push(u.getInt32(i,!1)),i+=4;for(_=1;_<g-1;_++)d[v++]=y[0],d[v++]=y[_],d[v++]=y[_+1]}a.next=a.next+t+1}else if(0===s.indexOf("POINT_DATA")){for(n=parseInt(s.split(" ")[1],10),a=f(l,a.next),t=4*n*3,c=new Float32Array(3*n),i=a.next,r=0;r<n;r++)c[3*r]=u.getFloat32(i,!1),c[3*r+1]=u.getFloat32(i+4,!1),c[3*r+2]=u.getFloat32(i+8,!1),i+=12;a.next=a.next+t}if((p=a.next)>=l.byteLength)break}var x=new BufferGeometry;return x.setIndex(new BufferAttribute(d,1)),x.addAttribute("position",new BufferAttribute(h,3)),c.length===h.length&&x.addAttribute("normal",new BufferAttribute(c,3)),x}(e)}}),ImmediateRenderObject.prototype=Object.create(Object3D.prototype),ImmediateRenderObject.prototype.constructor=ImmediateRenderObject,ImmediateRenderObject.prototype.isImmediateRenderObject=!0;var MarchingCubes=function(e,t,i,r){ImmediateRenderObject.call(this,t);var n=this,o=new Float32Array(36),a=new Float32Array(36),s=new Float32Array(36);function l(e,t,i){return e+(t-e)*i}function u(e,t,i,r,u,h,c,d,p,f){var m=(i-c)/(d-c),v=n.normal_cache;o[t+0]=r+m*n.delta,o[t+1]=u,o[t+2]=h,a[t+0]=l(v[e+0],v[e+3],m),a[t+1]=l(v[e+1],v[e+4],m),a[t+2]=l(v[e+2],v[e+5],m),s[t+0]=l(n.palette[3*p+0],n.palette[3*f+0],m),s[t+1]=l(n.palette[3*p+1],n.palette[3*f+1],m),s[t+2]=l(n.palette[3*p+2],n.palette[3*f+2],m)}function h(e,t,i,r,u,h,c,d,p,f){var m=(i-c)/(d-c),v=n.normal_cache;o[t+0]=r,o[t+1]=u+m*n.delta,o[t+2]=h;var g=e+3*n.yd;a[t+0]=l(v[e+0],v[g+0],m),a[t+1]=l(v[e+1],v[g+1],m),a[t+2]=l(v[e+2],v[g+2],m),s[t+0]=l(n.palette[3*p+0],n.palette[3*f+0],m),s[t+1]=l(n.palette[3*p+1],n.palette[3*f+1],m),s[t+2]=l(n.palette[3*p+2],n.palette[3*f+2],m)}function c(e,t,i,r,u,h,c,d,p,f){var m=(i-c)/(d-c),v=n.normal_cache;o[t+0]=r,o[t+1]=u,o[t+2]=h+m*n.delta;var g=e+3*n.zd;a[t+0]=l(v[e+0],v[g+0],m),a[t+1]=l(v[e+1],v[g+1],m),a[t+2]=l(v[e+2],v[g+2],m),s[t+0]=l(n.palette[3*p+0],n.palette[3*f+0],m),s[t+1]=l(n.palette[3*p+1],n.palette[3*f+1],m),s[t+2]=l(n.palette[3*p+2],n.palette[3*f+2],m)}function d(e){var t=3*e;0===n.normal_cache[t]&&(n.normal_cache[t+0]=n.field[e-1]-n.field[e+1],n.normal_cache[t+1]=n.field[e-n.yd]-n.field[e+n.yd],n.normal_cache[t+2]=n.field[e-n.zd]-n.field[e+n.zd])}function p(e,t,i,r,l,p){var m=r+1,v=r+n.yd,g=r+n.zd,y=m+n.yd,_=m+n.zd,b=r+n.yd+n.zd,x=m+n.yd+n.zd,w=0,S=n.field[r],M=n.field[m],T=n.field[v],A=n.field[y],C=n.field[g],L=n.field[_],N=n.field[b],P=n.field[x];S<l&&(w|=1),M<l&&(w|=2),T<l&&(w|=8),A<l&&(w|=4),C<l&&(w|=16),L<l&&(w|=32),N<l&&(w|=128),P<l&&(w|=64);var k=edgeTable[w];if(0===k)return 0;var E=n.delta,D=e+E,O=t+E,R=i+E;1&k&&(d(r),d(m),u(3*r,0,l,e,t,i,S,M,r,m)),2&k&&(d(m),d(y),h(3*m,3,l,D,t,i,M,A,m,y)),4&k&&(d(v),d(y),u(3*v,6,l,e,O,i,T,A,v,y)),8&k&&(d(r),d(v),h(3*r,9,l,e,t,i,S,T,r,v)),16&k&&(d(g),d(_),u(3*g,12,l,e,t,R,C,L,g,_)),32&k&&(d(_),d(x),h(3*_,15,l,D,t,R,L,P,_,x)),64&k&&(d(b),d(x),u(3*b,18,l,e,O,R,N,P,b,x)),128&k&&(d(g),d(b),h(3*g,21,l,e,t,R,C,N,g,b)),256&k&&(d(r),d(g),c(3*r,24,l,e,t,i,S,C,r,g)),512&k&&(d(m),d(_),c(3*m,27,l,D,t,i,M,L,m,_)),1024&k&&(d(y),d(x),c(3*y,30,l,D,O,i,A,P,y,x)),2048&k&&(d(v),d(b),c(3*v,33,l,e,O,i,T,N,v,b)),w<<=4;for(var F,I,B,U=0,V=0;-1!=triTable[w+V];)I=(F=w+V)+1,B=F+2,f(o,a,s,3*triTable[F],3*triTable[I],3*triTable[B],p),V+=3,U++;return U}function f(e,t,i,r,o,a,s){var l=3*n.count;if(n.positionArray[l+0]=e[r],n.positionArray[l+1]=e[r+1],n.positionArray[l+2]=e[r+2],n.positionArray[l+3]=e[o],n.positionArray[l+4]=e[o+1],n.positionArray[l+5]=e[o+2],n.positionArray[l+6]=e[a],n.positionArray[l+7]=e[a+1],n.positionArray[l+8]=e[a+2],!0===n.material.flatShading){var u=(t[r+0]+t[o+0]+t[a+0])/3,h=(t[r+1]+t[o+1]+t[a+1])/3,c=(t[r+2]+t[o+2]+t[a+2])/3;n.normalArray[l+0]=u,n.normalArray[l+1]=h,n.normalArray[l+2]=c,n.normalArray[l+3]=u,n.normalArray[l+4]=h,n.normalArray[l+5]=c,n.normalArray[l+6]=u,n.normalArray[l+7]=h,n.normalArray[l+8]=c}else n.normalArray[l+0]=t[r+0],n.normalArray[l+1]=t[r+1],n.normalArray[l+2]=t[r+2],n.normalArray[l+3]=t[o+0],n.normalArray[l+4]=t[o+1],n.normalArray[l+5]=t[o+2],n.normalArray[l+6]=t[a+0],n.normalArray[l+7]=t[a+1],n.normalArray[l+8]=t[a+2];if(n.enableUvs){var d=2*n.count;n.uvArray[d+0]=e[r+0],n.uvArray[d+1]=e[r+2],n.uvArray[d+2]=e[o+0],n.uvArray[d+3]=e[o+2],n.uvArray[d+4]=e[a+0],n.uvArray[d+5]=e[a+2]}n.enableColors&&(n.colorArray[l+0]=i[r+0],n.colorArray[l+1]=i[r+1],n.colorArray[l+2]=i[r+2],n.colorArray[l+3]=i[o+0],n.colorArray[l+4]=i[o+1],n.colorArray[l+5]=i[o+2],n.colorArray[l+6]=i[a+0],n.colorArray[l+7]=i[a+1],n.colorArray[l+8]=i[a+2]),n.count+=3,n.count>=n.maxCount-3&&(n.hasPositions=!0,n.hasNormals=!0,n.enableUvs&&(n.hasUvs=!0),n.enableColors&&(n.hasColors=!0),s(n))}function m(e,t,i){var r=new Float32Array(e.length+i);return r.set(e,0),r.set(t.slice(0,i),e.length),r}this.enableUvs=void 0!==i&&i,this.enableColors=void 0!==r&&r,this.init=function(e){this.resolution=e,this.isolation=80,this.size=e,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(3*this.size3),this.palette=new Float32Array(3*this.size3),this.maxCount=4096,this.count=0,this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=new Float32Array(3*this.maxCount),this.normalArray=new Float32Array(3*this.maxCount),this.enableUvs&&(this.uvArray=new Float32Array(2*this.maxCount)),this.enableColors&&(this.colorArray=new Float32Array(3*this.maxCount))},this.begin=function(){this.count=0,this.hasPositions=!1,this.hasNormals=!1,this.hasUvs=!1,this.hasColors=!1},this.end=function(e){if(0!==this.count){for(var t=3*this.count;t<this.positionArray.length;t++)this.positionArray[t]=0;this.hasPositions=!0,this.hasNormals=!0,this.enableUvs&&this.material.map&&(this.hasUvs=!0),this.enableColors&&this.material.vertexColors!==NoColors&&(this.hasColors=!0),e(this)}},this.addBall=function(e,t,i,r,n,o){var a=Math.sign(r);r=Math.abs(r);var s=!(null==o),l=new Color(e,t,i);if(s)try{l=o instanceof Color?o:Array.isArray(o)?new Color(Math.min(Math.abs(o[0]),1),Math.min(Math.abs(o[1]),1),Math.min(Math.abs(o[2]),1)):new Color(o)}catch(r){s=!1,l=new Color(e,t,i)}var u=this.size*Math.sqrt(r/n),h=i*this.size,c=t*this.size,d=e*this.size,p=Math.floor(h-u);p<1&&(p=1);var f=Math.floor(h+u);f>this.size-1&&(f=this.size-1);var m=Math.floor(c-u);m<1&&(m=1);var v=Math.floor(c+u);v>this.size-1&&(v=this.size-1);var g=Math.floor(d-u);g<1&&(g=1);var y,_,b,x,w,S,M,T,A,C,L,N=Math.floor(d+u);for(N>this.size-1&&(N=this.size-1),b=p;b<f;b++)for(w=this.size2*b,A=(T=b/this.size-i)*T,_=m;_<v;_++)for(x=w+this.size*_,C=(M=_/this.size-t)*M,y=g;y<N;y++)if((L=r/(1e-6+(S=y/this.size-e)*S+C+A)-n)>0){this.field[x+y]+=L*a;var P=Math.sqrt((y-d)*(y-d)+(_-c)*(_-c)+(b-h)*(b-h))/u,k=1-P*P*P*(P*(6*P-15)+10);this.palette[3*(x+y)+0]+=l.r*k,this.palette[3*(x+y)+1]+=l.g*k,this.palette[3*(x+y)+2]+=l.b*k}},this.addPlaneX=function(e,t){var i,r,n,o,a,s,l=this.size,u=this.yd,h=this.zd,c=this.field,d=l*Math.sqrt(e/t);for(d>l&&(d=l),i=0;i<d;i++)if((o=e/(1e-4+(a=i/l)*a)-t)>0)for(r=0;r<l;r++)for(s=i+r*u,n=0;n<l;n++)c[h*n+s]+=o},this.addPlaneY=function(e,t){var i,r,n,o,a,s,l,u=this.size,h=this.yd,c=this.zd,d=this.field,p=u*Math.sqrt(e/t);for(p>u&&(p=u),r=0;r<p;r++)if((o=e/(1e-4+(a=r/u)*a)-t)>0)for(s=r*h,i=0;i<u;i++)for(l=s+i,n=0;n<u;n++)d[c*n+l]+=o},this.addPlaneZ=function(e,t){var i,r,n,o,a,s,l,u=this.size,h=this.yd,c=this.zd,d=this.field,p=u*Math.sqrt(e/t);for(p>u&&(p=u),n=0;n<p;n++)if((o=e/(1e-4+(a=n/u)*a)-t)>0)for(s=c*n,r=0;r<u;r++)for(l=s+r*h,i=0;i<u;i++)d[l+i]+=o},this.reset=function(){var e;for(e=0;e<this.size3;e++)this.normal_cache[3*e]=0,this.field[e]=0,this.palette[3*e]=this.palette[3*e+1]=this.palette[3*e+2]=0},this.render=function(e){this.begin();for(var t=this.size-2,i=1;i<t;i++)for(var r=this.size2*i,n=(i-this.halfsize)/this.halfsize,o=1;o<t;o++)for(var a=r+this.size*o,s=(o-this.halfsize)/this.halfsize,l=1;l<t;l++){p((l-this.halfsize)/this.halfsize,s,n,a+l,this.isolation,e)}this.end(e)},this.generateGeometry=function(){return console.warn("MarchingCubes: generateGeometry() now returns BufferGeometry"),this.generateBufferGeometry()},this.generateBufferGeometry=function(){var e=new BufferGeometry,t=new Float32Array,i=new Float32Array,r=new Float32Array,n=new Float32Array,o=this;return this.render(function(e){o.hasPositions&&(t=m(t,e.positionArray,3*e.count)),o.hasNormals&&(i=m(i,e.normalArray,3*e.count)),o.hasColors&&(r=m(r,e.colorArray,3*e.count)),o.hasUvs&&(n=m(n,e.uvArray,2*e.count)),e.count=0}),this.hasPositions&&e.addAttribute("position",new BufferAttribute(t,3)),this.hasNormals&&e.addAttribute("normal",new BufferAttribute(i,3)),this.hasColors&&e.addAttribute("color",new BufferAttribute(r,3)),this.hasUvs&&e.addAttribute("uv",new BufferAttribute(n,2)),e},this.init(e)};MarchingCubes.prototype=Object.create(ImmediateRenderObject.prototype),MarchingCubes.prototype.constructor=MarchingCubes;var edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),ColorConverter={setHSV:function(e,t,i,r){return t=_Math.euclideanModulo(t,1),i=_Math.clamp(i,0,1),r=_Math.clamp(r,0,1),e.setHSL(t,i*r/((t=(2-i)*r)<1?t:2-t),.5*t)},getHSV:function(){var e={};return function(t,i){return void 0===i&&(console.warn("ColorConverter: .getHSV() target is now required"),i={h:0,s:0,l:0}),t.getHSL(e),e.s*=e.l<.5?e.l:1-e.l,i.h=e.h,i.s=2*e.s/(e.l+e.s),i.v=e.l+e.s,i}}(),setCMYK:function(e,t,i,r,n){var o=(1-t)*(1-n),a=(1-i)*(1-n),s=(1-r)*(1-n);return e.setRGB(o,a,s)},getCMYK:function(e,t){void 0===t&&(console.warn("ColorConverter: .getCMYK() target is now required"),t={c:0,m:0,y:0,k:0});var i=e.r,r=e.g,n=e.b,o=1-Math.max(i,r,n),a=(1-i-o)/(1-o),s=(1-r-o)/(1-o),l=(1-n-o)/(1-o);return t.c=a,t.m=s,t.y=l,t.k=o,t}},geometry;function CanvasTexture(e,t,i,r,n,o,a,s,l){Texture.call(this,e,t,i,r,n,o,a,s,l),this.needsUpdate=!0}function Sprite(e){if(Object3D.call(this),this.type="Sprite",void 0===geometry){geometry=new BufferGeometry;var t=new InterleavedBuffer(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);geometry.setIndex([0,1,2,0,2,3]),geometry.addAttribute("position",new InterleavedBufferAttribute(t,3,0,!1)),geometry.addAttribute("uv",new InterleavedBufferAttribute(t,2,3,!1))}this.geometry=geometry,this.material=void 0!==e?e:new SpriteMaterial,this.center=new Vector2(.5,.5)}CanvasTexture.prototype=Object.create(Texture.prototype),CanvasTexture.prototype.constructor=CanvasTexture,CanvasTexture.prototype.isCanvasTexture=!0,Sprite.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Sprite,isSprite:!0,raycast:function(){var e=new Vector3,t=new Vector3,i=new Vector3,r=new Vector2,n=new Vector2,o=new Matrix4,a=new Vector3,s=new Vector3,l=new Vector3,u=new Vector2,h=new Vector2,c=new Vector2;function d(e,t,i,a,s,l){r.subVectors(e,i).addScalar(.5).multiply(a),void 0!==s?(n.x=l*r.x-s*r.y,n.y=s*r.x+l*r.y):n.copy(r),e.copy(t),e.x+=n.x,e.y+=n.y,e.applyMatrix4(o)}return function(r,n){t.setFromMatrixScale(this.matrixWorld),o.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld),i.setFromMatrixPosition(this.modelViewMatrix);var p,f,m=this.material.rotation;0!==m&&(f=Math.cos(m),p=Math.sin(m));var v=this.center;d(a.set(-.5,-.5,0),i,v,t,p,f),d(s.set(.5,-.5,0),i,v,t,p,f),d(l.set(.5,.5,0),i,v,t,p,f),u.set(0,0),h.set(1,0),c.set(1,1);var g=r.ray.intersectTriangle(a,s,l,!1,e);if(null!==g||(d(s.set(-.5,.5,0),i,v,t,p,f),h.set(0,1),null!==(g=r.ray.intersectTriangle(a,l,s,!1,e)))){var y=r.ray.origin.distanceTo(e);y<r.near||y>r.far||n.push({distance:y,point:e.clone(),uv:Triangle.getUV(e,a,s,l,u,h,c,new Vector2),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return Object3D.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}});var Lut=function(e,t){this.lut=[],this.map=ColorMapKeywords[e],this.n=t,this.mapname=e;for(var i=1/this.n,r=0;r<=1;r+=i)for(var n=0;n<this.map.length-1;n++)if(r>=this.map[n][0]&&r<this.map[n+1][0]){var o=this.map[n][0],a=this.map[n+1][0],s=new Color(16777215).setHex(this.map[n][1]),l=new Color(16777215).setHex(this.map[n+1][1]),u=s.lerp(l,(r-o)/(a-o));this.lut.push(u)}return this.set(this)};Lut.prototype={constructor:Lut,lut:[],map:[],mapname:"rainbow",n:256,minV:0,maxV:1,legend:null,set:function(e){return e instanceof Lut&&this.copy(e),this},setMin:function(e){return this.minV=e,this},setMax:function(e){return this.maxV=e,this},changeNumberOfColors:function(e){return this.n=e,new Lut(this.mapname,this.n)},changeColorMap:function(e){return this.mapname=e,new Lut(this.mapname,this.n)},copy:function(e){return this.lut=e.lut,this.mapname=e.mapname,this.map=e.map,this.n=e.n,this.minV=e.minV,this.maxV=e.maxV,this},getColor:function(e){e<=this.minV?e=this.minV:e>=this.maxV&&(e=this.maxV),e=(e-this.minV)/(this.maxV-this.minV);var t=Math.round(e*this.n);return t==this.n&&(t-=1),this.lut[t]},addColorMap:function(e,t){ColorMapKeywords[e]=t},setLegendOn:function(e){void 0===e&&(e={}),this.legend={},this.legend.layout=e.hasOwnProperty("layout")?e.layout:"vertical",this.legend.position=e.hasOwnProperty("position")?e.position:{x:4,y:0,z:0},this.legend.dimensions=e.hasOwnProperty("dimensions")?e.dimensions:{width:.5,height:3},this.legend.canvas=document.createElement("canvas"),this.legend.canvas.setAttribute("id","legend"),this.legend.canvas.setAttribute("hidden",!0),document.body.appendChild(this.legend.canvas),this.legend.ctx=this.legend.canvas.getContext("2d"),this.legend.canvas.setAttribute("width",1),this.legend.canvas.setAttribute("height",this.n),this.legend.texture=new Texture(this.legend.canvas);var t=this.legend.ctx.getImageData(0,0,1,this.n),i=t.data;this.map=ColorMapKeywords[this.mapname];for(var r=0,n=1/this.n,o=1;o>=0;o-=n)for(var a=this.map.length-1;a>=0;a--)if(o<this.map[a][0]&&o>=this.map[a-1][0]){var s=this.map[a-1][0],l=this.map[a][0],u=new Color(16777215).setHex(this.map[a-1][1]),h=new Color(16777215).setHex(this.map[a][1]),c=u.lerp(h,(o-s)/(l-s));i[4*r]=Math.round(255*c.r),i[4*r+1]=Math.round(255*c.g),i[4*r+2]=Math.round(255*c.b),i[4*r+3]=255,r+=1}return this.legend.ctx.putImageData(t,0,0),this.legend.texture.needsUpdate=!0,this.legend.legendGeometry=new PlaneBufferGeometry(this.legend.dimensions.width,this.legend.dimensions.height),this.legend.legendMaterial=new MeshBasicMaterial({map:this.legend.texture,side:DoubleSide}),this.legend.mesh=new Mesh(this.legend.legendGeometry,this.legend.legendMaterial),"horizontal"==this.legend.layout&&(this.legend.mesh.rotation.z=Math.PI/180*-90),this.legend.mesh.position.copy(this.legend.position),this.legend.mesh},setLegendOff:function(){return this.legend=null,this.legend},setLegendLayout:function(e){return!!this.legend&&(this.legend.layout!=e&&(("horizontal"==e||"vertical"==e)&&(this.layout=e,"horizontal"==e&&(this.legend.mesh.rotation.z=Math.PI/180*90),"vertical"==e&&(this.legend.mesh.rotation.z=Math.PI/180*-90),this.legend.mesh)))},setLegendPosition:function(e){return this.legend.position=new Vector3(e.x,e.y,e.z),this.legend},setLegendLabels:function(e,t){if(!this.legend)return!1;"function"==typeof e&&(t=e),void 0===e&&(e={}),this.legend.labels={},this.legend.labels.fontsize=e.hasOwnProperty("fontsize")?e.fontsize:24,this.legend.labels.fontface=e.hasOwnProperty("fontface")?e.fontface:"Arial",this.legend.labels.title=e.hasOwnProperty("title")?e.title:"",this.legend.labels.um=e.hasOwnProperty("um")?" [ "+e.um+" ]":"",this.legend.labels.ticks=e.hasOwnProperty("ticks")?e.ticks:0,this.legend.labels.decimal=e.hasOwnProperty("decimal")?e.decimal:2,this.legend.labels.notation=e.hasOwnProperty("notation")?e.notation:"standard";var i=255,r=100,n=100,o=.8,a=255,s=0,l=0,u=1,h=document.createElement("canvas"),c=h.getContext("2d");c.font="Normal "+1.2*this.legend.labels.fontsize+"px "+this.legend.labels.fontface,c.fillStyle="rgba("+i+","+r+","+n+","+o+")",c.strokeStyle="rgba("+a+","+s+","+l+","+u+")",c.lineWidth=4,c.fillStyle="rgba( 0, 0, 0, 1.0 )",c.fillText(this.legend.labels.title.toString()+this.legend.labels.um.toString(),4,this.legend.labels.fontsize+4);var d=new CanvasTexture(h);d.minFilter=LinearFilter;var p=new Sprite(new SpriteMaterial({map:d}));if(p.scale.set(2,1,1),"vertical"==this.legend.layout&&p.position.set(this.legend.position.x+this.legend.dimensions.width,this.legend.position.y+.45*this.legend.dimensions.height,this.legend.position.z),"horizontal"==this.legend.layout&&p.position.set(1.015*this.legend.position.x,this.legend.position.y+.03*this.legend.dimensions.height,this.legend.position.z),this.legend.labels.ticks>0){var f={},m={};if("vertical"==this.legend.layout)var v=this.legend.position.y+.36*this.legend.dimensions.height,g=this.legend.position.y-.61*this.legend.dimensions.height;if("horizontal"==this.legend.layout)var y=this.legend.position.x+.75*this.legend.dimensions.height,_=this.legend.position.x-1.2*this.legend.dimensions.width;for(var b=0;b<this.legend.labels.ticks;b++){var x=(this.maxV-this.minV)/(this.legend.labels.ticks-1)*b+this.minV;x=t?t(x):"scientific"==this.legend.labels.notation?x.toExponential(this.legend.labels.decimal):x.toFixed(this.legend.labels.decimal);var w=document.createElement("canvas"),S=w.getContext("2d");S.font="Normal "+this.legend.labels.fontsize+"px "+this.legend.labels.fontface,S.fillStyle="rgba("+i+","+r+","+n+","+o+")",S.strokeStyle="rgba("+a+","+s+","+l+","+u+")",S.lineWidth=4,S.fillStyle="rgba( 0, 0, 0, 1.0 )",S.fillText(x.toString(),4,this.legend.labels.fontsize+4);var M=new CanvasTexture(w);M.minFilter=LinearFilter;var T=new Sprite(new SpriteMaterial({map:M}));if(T.scale.set(2,1,1),"vertical"==this.legend.layout){var A=g+(v-g)*((x-this.minV)/(this.maxV-this.minV));T.position.set(this.legend.position.x+2.7*this.legend.dimensions.width,A,this.legend.position.z)}if("horizontal"==this.legend.layout){A=_+(y-_)*((x-this.minV)/(this.maxV-this.minV));if(this.legend.labels.ticks>5)if(b%2==0)var C=1.7;else C=2.1;else C=1.7;T.position.set(A,this.legend.position.y-this.legend.dimensions.width*C,this.legend.position.z)}var L=new LineBasicMaterial({color:0,linewidth:2}),N=[];if("vertical"==this.legend.layout){var P=this.legend.position.y-.5*this.legend.dimensions.height+.01+this.legend.dimensions.height*((x-this.minV)/(this.maxV-this.minV)*.99);N.push(new Vector3(this.legend.position.x+.55*this.legend.dimensions.width,P,this.legend.position.z)),N.push(new Vector3(this.legend.position.x+.7*this.legend.dimensions.width,P,this.legend.position.z))}if("horizontal"==this.legend.layout){P=this.legend.position.x-.5*this.legend.dimensions.height+.01+this.legend.dimensions.height*((x-this.minV)/(this.maxV-this.minV)*.99);N.push(new Vector3(P,this.legend.position.y-.55*this.legend.dimensions.width,this.legend.position.z)),N.push(new Vector3(P,this.legend.position.y-.7*this.legend.dimensions.width,this.legend.position.z))}var k=new Line((new BufferGeometry).setFromPoints(N),L);m[b]=k,f[b]=T}}return{title:p,ticks:f,lines:m}}};var ColorMapKeywords={rainbow:[[0,"0x0000FF"],[.2,"0x00FFFF"],[.5,"0x00FF00"],[.8,"0xFFFF00"],[1,"0xFF0000"]],cooltowarm:[[0,"0x3C4EC2"],[.2,"0x9BBCFF"],[.5,"0xDCDCDC"],[.8,"0xF6A385"],[1,"0xB40426"]],blackbody:[[0,"0x000000"],[.2,"0x780000"],[.5,"0xE63200"],[.8,"0xFFFF00"],[1,"0xFFFFFF"]],grayscale:[[0,"0x000000"],[.2,"0x404040"],[.5,"0x7F7F80"],[.8,"0xBFBFBF"],[1,"0xFFFFFF"]]},MD2Character=function(){var e=this;function t(e,t){for(var i=new TextureLoader,n=[],o=0;o<t.length;o++)n[o]=i.load(e+t[o],r),n[o].mapping=UVMapping,n[o].name=t[o];return n}function i(e,t){var i=new MeshLambertMaterial({color:16755200,wireframe:!0,morphTargets:!0,morphNormals:!0}),r=new MeshLambertMaterial({color:16777215,wireframe:!1,map:t,morphTargets:!0,morphNormals:!0}),n=new Mesh(e,r);return n.rotation.y=-Math.PI/2,n.castShadow=!0,n.receiveShadow=!0,n.materialTexture=r,n.materialWireframe=i,n}function r(){e.loadCounter-=1,0===e.loadCounter&&e.onLoadComplete()}this.scale=1,this.animationFPS=6,this.root=new Object3D,this.meshBody=null,this.meshWeapon=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.activeAnimation=null,this.mixer=null,this.onLoadComplete=function(){},this.loadCounter=0,this.loadParts=function(n){this.loadCounter=2*n.weapons.length+n.skins.length+1;for(var o=[],a=0;a<n.weapons.length;a++)o[a]=n.weapons[a][1];this.skinsBody=t(n.baseUrl+"skins/",n.skins),this.skinsWeapon=t(n.baseUrl+"skins/",o);var s=new MD2Loader;s.load(n.baseUrl+n.body,function(t){t.computeBoundingBox(),e.root.position.y=-e.scale*t.boundingBox.min.y;var n=i(t,e.skinsBody[0]);n.scale.set(e.scale,e.scale,e.scale),e.root.add(n),e.meshBody=n,e.meshBody.clipOffset=0,e.activeAnimationClipName=n.geometry.animations[0].name,e.mixer=new AnimationMixer(n),r()});var l=function(t,n){return function(o){var a=i(o,e.skinsWeapon[t]);a.scale.set(e.scale,e.scale,e.scale),a.visible=!1,a.name=n,e.root.add(a),e.weapons[t]=a,e.meshWeapon=a,r()}};for(a=0;a<n.weapons.length;a++)s.load(n.baseUrl+n.weapons[a][0],l(a,n.weapons[a][0]))},this.setPlaybackRate=function(e){this.mixer.timeScale=0!==e?1/e:0},this.setWireframe=function(e){e?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))},this.setSkin=function(e){this.meshBody&&!1===this.meshBody.material.wireframe&&(this.meshBody.material.map=this.skinsBody[e])},this.setWeapon=function(t){for(var i=0;i<this.weapons.length;i++)this.weapons[i].visible=!1;var r=this.weapons[t];r&&(r.visible=!0,this.meshWeapon=r,e.syncWeaponAnimation())},this.setAnimation=function(t){if(this.meshBody){this.meshBody.activeAction&&(this.meshBody.activeAction.stop(),this.meshBody.activeAction=null);var i=this.mixer.clipAction(t,this.meshBody);i&&(this.meshBody.activeAction=i.play())}e.activeClipName=t,e.syncWeaponAnimation()},this.syncWeaponAnimation=function(){var t=e.activeClipName;if(e.meshWeapon){this.meshWeapon.activeAction&&(this.meshWeapon.activeAction.stop(),this.meshWeapon.activeAction=null);var i=this.mixer.clipAction(t,this.meshWeapon);i&&(this.meshWeapon.activeAction=i.syncWith(this.meshBody.activeAction).play())}},this.update=function(e){this.mixer&&this.mixer.update(e)}},MorphBlendMesh=function(e,t){Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var i=Object.keys(this.morphTargetDictionary).length,r=i-1,n=i/1;this.createAnimation("__default",0,r,n),this.setAnimationWeight("__default",1)};MorphBlendMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:MorphBlendMesh,createAnimation:function(e,t,i,r){var n={start:t,end:i,length:i-t+1,fps:r,duration:(i-t)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=n,this.animationsList.push(n)},autoCreateAnimations:function(e){var t,i=/([a-z]+)_?(\d+)/i,r={},n=0;for(var o in this.morphTargetDictionary){var a=o.match(i);if(a&&a.length>1)r[s=a[1]]||(r[s]={start:1/0,end:-1/0}),n<(l=r[s]).start&&(l.start=n),n>l.end&&(l.end=n),t||(t=s);n++}for(var s in r){var l=r[s];this.createAnimation(s,l.start,l.end,e)}this.firstAnimation=t},setAnimationDirectionForward:function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},setAnimationDirectionBackward:function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},setAnimationFPS:function(e,t){var i=this.animationsMap[e];i&&(i.fps=t,i.duration=(i.end-i.start)/i.fps)},setAnimationDuration:function(e,t){var i=this.animationsMap[e];i&&(i.duration=t,i.fps=(i.end-i.start)/i.duration)},setAnimationWeight:function(e,t){var i=this.animationsMap[e];i&&(i.weight=t)},setAnimationTime:function(e,t){var i=this.animationsMap[e];i&&(i.time=t)},getAnimationTime:function(e){var t=0,i=this.animationsMap[e];return i&&(t=i.time),t},getAnimationDuration:function(e){var t=-1,i=this.animationsMap[e];return i&&(t=i.duration),t},playAnimation:function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")},stopAnimation:function(e){var t=this.animationsMap[e];t&&(t.active=!1)},update:function(e){for(var t=0,i=this.animationsList.length;t<i;t++){var r=this.animationsList[t];if(r.active){var n=r.duration/r.length;r.time+=r.direction*e,r.mirroredLoop?(r.time>r.duration||r.time<0)&&(r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),r.time<0&&(r.time=0,r.directionBackwards=!1)):(r.time=r.time%r.duration,r.time<0&&(r.time+=r.duration));var o=r.start+_Math.clamp(Math.floor(r.time/n),0,r.length-1),a=r.weight;o!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*a,this.morphTargetInfluences[o]=0,r.lastFrame=r.currentFrame,r.currentFrame=o);var s=r.time%n/n;r.directionBackwards&&(s=1-s),r.currentFrame!==r.lastFrame?(this.morphTargetInfluences[r.currentFrame]=s*a,this.morphTargetInfluences[r.lastFrame]=(1-s)*a):this.morphTargetInfluences[r.currentFrame]=a}}}});var MD2CharacterComplex=function(){var e=this;function t(e,t){for(var i=new TextureLoader,n=[],o=0;o<t.length;o++)n[o]=i.load(e+t[o],r),n[o].mapping=UVMapping,n[o].name=t[o];return n}function i(t,i){var r=new MeshLambertMaterial({color:16755200,wireframe:!0,morphTargets:!0,morphNormals:!0}),n=new MeshLambertMaterial({color:16777215,wireframe:!1,map:i,morphTargets:!0,morphNormals:!0}),o=new MorphBlendMesh(t,n);return o.rotation.y=-Math.PI/2,o.materialTexture=n,o.materialWireframe=r,o.autoCreateAnimations(e.animationFPS),o}function r(){e.loadCounter-=1,0===e.loadCounter&&e.onLoadComplete()}function n(e){return 1===e?1:1-Math.pow(2,-10*e)}this.scale=1,this.animationFPS=6,this.transitionFrames=15,this.maxSpeed=275,this.maxReverseSpeed=-275,this.frontAcceleration=600,this.backAcceleration=600,this.frontDecceleration=600,this.angularSpeed=2.5,this.root=new Object3D,this.meshBody=null,this.meshWeapon=null,this.controls=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.currentSkin=void 0,this.onLoadComplete=function(){},this.meshes=[],this.animations={},this.loadCounter=0,this.speed=0,this.bodyOrientation=0,this.walkSpeed=this.maxSpeed,this.crouchSpeed=.5*this.maxSpeed,this.activeAnimation=null,this.oldAnimation=null,this.enableShadows=function(e){for(var t=0;t<this.meshes.length;t++)this.meshes[t].castShadow=e,this.meshes[t].receiveShadow=e},this.setVisible=function(e){for(var t=0;t<this.meshes.length;t++)this.meshes[t].visible=e,this.meshes[t].visible=e},this.shareParts=function(e){this.animations=e.animations,this.walkSpeed=e.walkSpeed,this.crouchSpeed=e.crouchSpeed,this.skinsBody=e.skinsBody,this.skinsWeapon=e.skinsWeapon;var t=i(e.meshBody.geometry,this.skinsBody[0]);t.scale.set(this.scale,this.scale,this.scale),this.root.position.y=e.root.position.y,this.root.add(t),this.meshBody=t,this.meshes.push(t);for(var r=0;r<e.weapons.length;r++){var n=i(e.weapons[r].geometry,this.skinsWeapon[r]);n.scale.set(this.scale,this.scale,this.scale),n.visible=!1,n.name=e.weapons[r].name,this.root.add(n),this.weapons[r]=n,this.meshWeapon=n,this.meshes.push(n)}},this.loadParts=function(n){this.animations=n.animations,this.walkSpeed=n.walkSpeed,this.crouchSpeed=n.crouchSpeed,this.loadCounter=2*n.weapons.length+n.skins.length+1;for(var o=[],a=0;a<n.weapons.length;a++)o[a]=n.weapons[a][1];this.skinsBody=t(n.baseUrl+"skins/",n.skins),this.skinsWeapon=t(n.baseUrl+"skins/",o);var s=new MD2Loader;s.load(n.baseUrl+n.body,function(t){t.computeBoundingBox(),e.root.position.y=-e.scale*t.boundingBox.min.y;var n=i(t,e.skinsBody[0]);n.scale.set(e.scale,e.scale,e.scale),e.root.add(n),e.meshBody=n,e.meshes.push(n),r()});var l=function(t,n){return function(o){var a=i(o,e.skinsWeapon[t]);a.scale.set(e.scale,e.scale,e.scale),a.visible=!1,a.name=n,e.root.add(a),e.weapons[t]=a,e.meshWeapon=a,e.meshes.push(a),r()}};for(a=0;a<n.weapons.length;a++)s.load(n.baseUrl+n.weapons[a][0],l(a,n.weapons[a][0]))},this.setPlaybackRate=function(e){this.meshBody&&(this.meshBody.duration=this.meshBody.baseDuration/e),this.meshWeapon&&(this.meshWeapon.duration=this.meshWeapon.baseDuration/e)},this.setWireframe=function(e){e?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))},this.setSkin=function(e){this.meshBody&&!1===this.meshBody.material.wireframe&&(this.meshBody.material.map=this.skinsBody[e],this.currentSkin=e)},this.setWeapon=function(e){for(var t=0;t<this.weapons.length;t++)this.weapons[t].visible=!1;var i=this.weapons[e];i&&(i.visible=!0,this.meshWeapon=i,this.activeAnimation&&(i.playAnimation(this.activeAnimation),this.meshWeapon.setAnimationTime(this.activeAnimation,this.meshBody.getAnimationTime(this.activeAnimation))))},this.setAnimation=function(e){e!==this.activeAnimation&&e&&(this.meshBody&&(this.meshBody.setAnimationWeight(e,0),this.meshBody.playAnimation(e),this.oldAnimation=this.activeAnimation,this.activeAnimation=e,this.blendCounter=this.transitionFrames),this.meshWeapon&&(this.meshWeapon.setAnimationWeight(e,0),this.meshWeapon.playAnimation(e)))},this.update=function(e){this.controls&&this.updateMovementModel(e),this.animations&&(this.updateBehaviors(e),this.updateAnimations(e))},this.updateAnimations=function(e){var t=1;this.blendCounter>0&&(t=(this.transitionFrames-this.blendCounter)/this.transitionFrames,this.blendCounter-=1),this.meshBody&&(this.meshBody.update(e),this.meshBody.setAnimationWeight(this.activeAnimation,t),this.meshBody.setAnimationWeight(this.oldAnimation,1-t)),this.meshWeapon&&(this.meshWeapon.update(e),this.meshWeapon.setAnimationWeight(this.activeAnimation,t),this.meshWeapon.setAnimationWeight(this.oldAnimation,1-t))},this.updateBehaviors=function(e){var t,i,r=this.controls,n=this.animations;r.crouch?(t=n.crouchMove,i=n.crouchIdle):(t=n.move,i=n.idle),r.jump&&(t=n.jump,i=n.jump),r.attack&&(r.crouch?(t=n.crouchAttack,i=n.crouchAttack):(t=n.attack,i=n.attack)),(r.moveForward||r.moveBackward||r.moveLeft||r.moveRight)&&this.activeAnimation!==t&&this.setAnimation(t),Math.abs(this.speed)<.2*this.maxSpeed&&!(r.moveLeft||r.moveRight||r.moveForward||r.moveBackward)&&this.activeAnimation!==i&&this.setAnimation(i),r.moveForward&&(this.meshBody&&(this.meshBody.setAnimationDirectionForward(this.activeAnimation),this.meshBody.setAnimationDirectionForward(this.oldAnimation)),this.meshWeapon&&(this.meshWeapon.setAnimationDirectionForward(this.activeAnimation),this.meshWeapon.setAnimationDirectionForward(this.oldAnimation))),r.moveBackward&&(this.meshBody&&(this.meshBody.setAnimationDirectionBackward(this.activeAnimation),this.meshBody.setAnimationDirectionBackward(this.oldAnimation)),this.meshWeapon&&(this.meshWeapon.setAnimationDirectionBackward(this.activeAnimation),this.meshWeapon.setAnimationDirectionBackward(this.oldAnimation)))},this.updateMovementModel=function(e){var t=this.controls;t.crouch?this.maxSpeed=this.crouchSpeed:this.maxSpeed=this.walkSpeed,this.maxReverseSpeed=-this.maxSpeed,t.moveForward&&(this.speed=_Math.clamp(this.speed+e*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),t.moveBackward&&(this.speed=_Math.clamp(this.speed-e*this.backAcceleration,this.maxReverseSpeed,this.maxSpeed));if(t.moveLeft&&(this.bodyOrientation+=e*this.angularSpeed,this.speed=_Math.clamp(this.speed+1*e*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),t.moveRight&&(this.bodyOrientation-=e*this.angularSpeed,this.speed=_Math.clamp(this.speed+1*e*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),!t.moveForward&&!t.moveBackward)if(this.speed>0){var i=n(this.speed/this.maxSpeed);this.speed=_Math.clamp(this.speed-i*e*this.frontDecceleration,0,this.maxSpeed)}else{i=n(this.speed/this.maxReverseSpeed);this.speed=_Math.clamp(this.speed+i*e*this.backAcceleration,this.maxReverseSpeed,0)}var r=this.speed*e;this.root.position.x+=Math.sin(this.bodyOrientation)*r,this.root.position.z+=Math.cos(this.bodyOrientation)*r,this.root.rotation.y=this.bodyOrientation}},ExplodeModifier=function(){};ExplodeModifier.prototype.modify=function(e){for(var t=[],i=0,r=e.faces.length;i<r;i++){var n=t.length,o=e.faces[i],a=o.a,s=o.b,l=o.c,u=e.vertices[a],h=e.vertices[s],c=e.vertices[l];t.push(u.clone()),t.push(h.clone()),t.push(c.clone()),o.a=n,o.b=n+1,o.c=n+2}e.vertices=t};var SimplifyModifier=function(){};!function(){var e=new Vector3,t=new Vector3;function i(e,t){var i=e.indexOf(t);i>-1&&e.splice(i,1)}function r(e,t){var i,r,n,o=t.position.distanceTo(e.position),a=0,s=[],l=e.faces.length;for(i=0;i<l;i++)(r=e.faces[i]).hasVertex(t)&&s.push(r);for(i=0;i<l;i++){var u=1;r=e.faces[i];for(var h=0;h<s.length;h++){n=s[h];var c=r.normal.dot(n.normal);u=Math.min(u,(1.001-c)/2)}a=Math.max(a,u)}return s.length<2&&(a=1),o*a+0}function n(e){if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(var t=0;t<e.neighbors.length;t++){var i=r(e,e.neighbors[t]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[t],e.collapseCost=i,e.minCost=i,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=i,i<e.minCost&&(e.collapseNeighbor=e.neighbors[t],e.minCost=i)}e.collapseCost=e.totalCost/e.costCount}function o(e,t){for(console.assert(0===e.faces.length);e.neighbors.length;){i(e.neighbors.pop().neighbors,e)}i(t,e)}function a(e,t){i(t,e),e.v1&&i(e.v1.faces,e),e.v2&&i(e.v2.faces,e),e.v3&&i(e.v3.faces,e);for(var r,n,o=[e.v1,e.v2,e.v3],a=0;a<3;a++)n=o[(a+1)%3],(r=o[a])&&n&&(r.removeIfNonNeighbor(n),n.removeIfNonNeighbor(r))}function s(e,t,i,r){if(r){var s,l=[];for(s=0;s<i.neighbors.length;s++)l.push(i.neighbors[s]);for(s=i.faces.length-1;s>=0;s--)i.faces[s].hasVertex(r)&&a(i.faces[s],t);for(s=i.faces.length-1;s>=0;s--)i.faces[s].replaceVertex(i,r);for(o(i,e),s=0;s<l.length;s++)n(l[s])}else o(i,e)}function l(e){for(var t=e[0],i=0;i<e.length;i++)e[i].collapseCost<t.collapseCost&&(t=e[i]);return t}function u(e,t,i,r,n,o){this.a=r,this.b=n,this.c=o,this.v1=e,this.v2=t,this.v3=i,this.normal=new Vector3,this.computeNormal(),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(i),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(i),i.faces.push(this),i.addUniqueNeighbor(e),i.addUniqueNeighbor(t)}function h(e,t){this.position=e,this.id=t,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}u.prototype.computeNormal=function(){var i=this.v1.position,r=this.v2.position,n=this.v3.position;e.subVectors(n,r),t.subVectors(i,r),e.cross(t).normalize(),this.normal.copy(e)},u.prototype.hasVertex=function(e){return e===this.v1||e===this.v2||e===this.v3},u.prototype.replaceVertex=function(e,t){e===this.v1?this.v1=t:e===this.v2?this.v2=t:e===this.v3&&(this.v3=t),i(e.faces,this),t.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},h.prototype.addUniqueNeighbor=function(e){var t,i;t=this.neighbors,i=e,-1===t.indexOf(i)&&t.push(i)},h.prototype.removeIfNonNeighbor=function(e){var t=this.neighbors,i=this.faces,r=t.indexOf(e);if(-1!==r){for(var n=0;n<i.length;n++)if(i[n].hasVertex(e))return;t.splice(r,1)}},SimplifyModifier.prototype.modify=function(e,t){e.isBufferGeometry&&(e=(new Geometry).fromBufferGeometry(e)),e.mergeVertices();var i,r,o,a=e.vertices,c=e.faces,d=[],p=[];for(i=0,r=a.length;i<r;i++){var f=new h(a[i],i);d.push(f)}for(i=0,r=c.length;i<r;i++){var m=(S=c[i]).a,v=S.b,g=S.c,y=new u(d[m],d[v],d[g],m,v,g);p.push(y)}for(i=0,r=d.length;i<r;i++)n(d[i]);for(var _=t;_--;){if(!(o=l(d))){console.log("SimplifyModifier: No next vertex");break}s(d,p,o,o.collapseNeighbor)}var b=new BufferGeometry,x=[],w=[];for(i=0;i<d.length;i++){f=d[i].position;x.push(f.x,f.y,f.z)}for(i=0;i<p.length;i++){var S=p[i];m=d.indexOf(S.v1),v=d.indexOf(S.v2),g=d.indexOf(S.v3);w.push(m,v,g)}return b.addAttribute("position",new Float32BufferAttribute(x,3)),b.setIndex(w),b}}();var SubdivisionModifier=function(e){this.subdivisions=void 0===e?1:e};SubdivisionModifier.prototype.modify=function(e){(e=e.isBufferGeometry?(new Geometry).fromBufferGeometry(e):e.clone()).mergeVertices();for(var t=this.subdivisions;t-- >0;)this.smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e},function(){var e=["a","b","c"];function t(e,t,i){return i[Math.min(e,t)+"_"+Math.max(e,t)]}function i(e,t,i,r,n,o){var a,s=Math.min(e,t),l=Math.max(e,t),u=s+"_"+l;u in r?a=r[u]:(a={a:i[s],b:i[l],newEdge:null,faces:[]},r[u]=a);a.faces.push(n),o[e].edges.push(a),o[t].edges.push(a)}function r(e,t,i,r,n){e.push(new Face3(t,i,r,void 0,void 0,n))}function n(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function o(e,t,i,r){e.push([t.clone(),i.clone(),r.clone()])}SubdivisionModifier.prototype.smooth=function(a){var s,l,u,h,c,d,p,f,m,v,g,y,_,b,x=new Vector3,w=[];s=a.vertices,l=a.faces;var S,M,T,A,C,L,N,P,k,E,D,O,R,F,I=void 0!==(u=a.faceVertexUvs[0])&&u.length>0;for(p in function(e,t,r,n){var o,a,s;for(o=0,a=e.length;o<a;o++)r[o]={edges:[]};for(o=0,a=t.length;o<a;o++)i((s=t[o]).a,s.b,e,n,s,r),i(s.b,s.c,e,n,s,r),i(s.c,s.a,e,n,s,r)}(s,l,g=new Array(s.length),y={}),_=[],y){for(M=y[p],T=new Vector3,C=3/8,L=1/8,2!=(N=M.faces.length)&&(C=.5,L=0),T.addVectors(M.a,M.b).multiplyScalar(C),x.set(0,0,0),m=0;m<N;m++){for(A=M.faces[m],v=0;v<3&&((S=s[A[e[v]]])===M.a||S===M.b);v++);x.add(S)}x.multiplyScalar(L),T.add(x),M.newEdge=_.length,_.push(T)}for(b=[],p=0,f=s.length;p<f;p++){for(R=s[p],3==(d=(O=g[p].edges).length)?P=3/16:d>3&&(P=3/(8*d)),k=1-d*P,E=P,d<=2&&2==d&&(k=.75,E=1/8),F=R.clone().multiplyScalar(k),x.set(0,0,0),m=0;m<d;m++)S=(D=O[m]).a!==R?D.a:D.b,x.add(S);x.multiplyScalar(E),F.add(x),b.push(F)}h=b.concat(_);var B,U,V,z,G,j,W,H=b.length;c=[];var q=new Vector2,Y=new Vector2,X=new Vector2;for(p=0,f=l.length;p<f;p++)r(c,B=t((A=l[p]).a,A.b,y).newEdge+H,U=t(A.b,A.c,y).newEdge+H,V=t(A.c,A.a,y).newEdge+H,A.materialIndex),r(c,A.a,B,V,A.materialIndex),r(c,A.b,U,B,A.materialIndex),r(c,A.c,V,U,A.materialIndex),I&&(G=(z=u[p])[0],j=z[1],W=z[2],q.set(n(G.x,j.x),n(G.y,j.y)),Y.set(n(j.x,W.x),n(j.y,W.y)),X.set(n(G.x,W.x),n(G.y,W.y)),o(w,q,Y,X),o(w,G,q,X),o(w,j,Y,q),o(w,W,X,Y));a.vertices=h,a.faces=c,I&&(a.faceVertexUvs[0]=w)}}();var TessellateModifier=function(e){this.maxEdgeLength=e};TessellateModifier.prototype.modify=function(e){for(var t,i=[],r=[],n=this.maxEdgeLength*this.maxEdgeLength,o=0,a=e.faceVertexUvs.length;o<a;o++)r[o]=[];for(o=0,a=e.faces.length;o<a;o++){var s=e.faces[o];if(s instanceof Face3){var l=s.a,u=s.b,h=s.c,c=e.vertices[l],d=e.vertices[u],p=e.vertices[h],f=c.distanceToSquared(d),m=d.distanceToSquared(p),v=c.distanceToSquared(p);if(f>n||m>n||v>n){var g=e.vertices.length,y=s.clone(),_=s.clone();if(f>=m&&f>=v){if((b=c.clone()).lerp(d,.5),y.a=l,y.b=g,y.c=h,_.a=g,_.b=u,_.c=h,3===s.vertexNormals.length)(x=s.vertexNormals[0].clone()).lerp(s.vertexNormals[1],.5),y.vertexNormals[1].copy(x),_.vertexNormals[0].copy(x);if(3===s.vertexColors.length)(w=s.vertexColors[0].clone()).lerp(s.vertexColors[1],.5),y.vertexColors[1].copy(w),_.vertexColors[0].copy(w);t=0}else if(m>=f&&m>=v){if((b=d.clone()).lerp(p,.5),y.a=l,y.b=u,y.c=g,_.a=g,_.b=h,_.c=l,3===s.vertexNormals.length)(x=s.vertexNormals[1].clone()).lerp(s.vertexNormals[2],.5),y.vertexNormals[2].copy(x),_.vertexNormals[0].copy(x),_.vertexNormals[1].copy(s.vertexNormals[2]),_.vertexNormals[2].copy(s.vertexNormals[0]);if(3===s.vertexColors.length)(w=s.vertexColors[1].clone()).lerp(s.vertexColors[2],.5),y.vertexColors[2].copy(w),_.vertexColors[0].copy(w),_.vertexColors[1].copy(s.vertexColors[2]),_.vertexColors[2].copy(s.vertexColors[0]);t=1}else{var b,x,w;if((b=c.clone()).lerp(p,.5),y.a=l,y.b=u,y.c=g,_.a=g,_.b=u,_.c=h,3===s.vertexNormals.length)(x=s.vertexNormals[0].clone()).lerp(s.vertexNormals[2],.5),y.vertexNormals[2].copy(x),_.vertexNormals[0].copy(x);if(3===s.vertexColors.length)(w=s.vertexColors[0].clone()).lerp(s.vertexColors[2],.5),y.vertexColors[2].copy(w),_.vertexColors[0].copy(w);t=2}i.push(y,_),e.vertices.push(b);for(var S=0,M=e.faceVertexUvs.length;S<M;S++)if(e.faceVertexUvs[S].length){var T=e.faceVertexUvs[S][o],A=T[0],C=T[1],L=T[2];if(0===t){(k=A.clone()).lerp(C,.5);var N=[A.clone(),k.clone(),L.clone()],P=[k.clone(),C.clone(),L.clone()]}else if(1===t){(k=C.clone()).lerp(L,.5);N=[A.clone(),C.clone(),k.clone()],P=[k.clone(),L.clone(),A.clone()]}else{var k;(k=A.clone()).lerp(L,.5);N=[A.clone(),C.clone(),k.clone()],P=[k.clone(),C.clone(),L.clone()]}r[S].push(N,P)}}else{i.push(s);for(S=0,M=e.faceVertexUvs.length;S<M;S++)r[S].push(e.faceVertexUvs[S][o])}}}e.faces=i,e.faceVertexUvs=r};var MorphAnimMesh=function(e,t){Mesh.call(this,e,t),this.type="MorphAnimMesh",this.mixer=new AnimationMixer(this),this.activeAction=null};function Node$1(e){this.uuid=_Math.generateUUID(),this.name="",this.type=e,this.userData={}}function TempNode(e,t){Node$1.call(this,e),t=t||{},this.shared=void 0===t.shared||t.shared,this.unique=void 0!==t.unique&&t.unique}MorphAnimMesh.prototype=Object.create(Mesh.prototype),MorphAnimMesh.prototype.constructor=MorphAnimMesh,MorphAnimMesh.prototype.setDirectionForward=function(){this.mixer.timeScale=1},MorphAnimMesh.prototype.setDirectionBackward=function(){this.mixer.timeScale=-1},MorphAnimMesh.prototype.playAnimation=function(e,t){this.activeAction&&(this.activeAction.stop(),this.activeAction=null);var i=AnimationClip.findByName(this,e);if(!i)throw new Error("MorphAnimMesh: animations["+e+"] undefined in .playAnimation()");var r=this.mixer.clipAction(i);r.timeScale=i.tracks.length*t/i.duration,this.activeAction=r.play()},MorphAnimMesh.prototype.updateAnimation=function(e){this.mixer.update(e)},MorphAnimMesh.prototype.copy=function(e){return Mesh.prototype.copy.call(this,e),this.mixer=new AnimationMixer(this),this},Node$1.prototype={constructor:Node$1,isNode:!0,parse:function(e,t){t=t||{},e.parsing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.parsing=!1},parseAndBuildCode:function(e,t,i){return i=i||{},this.parse(e,i),this.buildCode(e,t,i)},buildCode:function(e,t,i){i=i||{};var r={result:this.build(e.addFlow(i.slot,i.cache,i.context),t)};return r.code=e.clearNodeCode(),e.removeFlow(),r},build:function(e,t,i){t=t||this.getType(e,t);var r=e.getNodeData(i||this);return e.parsing&&this.appendDepsNode(e,r,t),-1===e.nodes.indexOf(this)&&e.nodes.push(this),void 0!==this.updateFrame&&-1===e.updaters.indexOf(this)&&e.updaters.push(this),this.generate(e,t,i)},appendDepsNode:function(e,t,i){t.deps=(t.deps||0)+1;var r=e.getTypeLength(i);(r>(t.outputMax||0)||this.getType(e,i))&&(t.outputMax=r,t.output=i)},setName:function(e){return this.name=e,this},getName:function(e){return this.name},getType:function(e,t){return"sampler2D"===t||"samplerCube"===t?t:this.type},getJSONNode:function(e){if(!(void 0===e||"string"==typeof e)&&void 0!==e.nodes[this.uuid])return e.nodes[this.uuid]},copy:function(e){void 0!==e.name&&(this.name=e.name),void 0!==e.userData&&(this.userData=JSON.parse(JSON.stringify(e.userData)))},createJSONNode:function(e){var t=void 0===e||"string"==typeof e,i={};if("string"!=typeof this.nodeType)throw new Error("Node does not allow serialization.");return i.uuid=this.uuid,i.nodeType=this.nodeType,""!==this.name&&(i.name=this.name),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t||(e.nodes[this.uuid]=i),i},toJSON:function(e){return this.getJSONNode(e)||this.createJSONNode(e)}},TempNode.prototype=Object.create(Node$1.prototype),TempNode.prototype.constructor=TempNode,TempNode.prototype.build=function(e,t,i,r){if(t=t||this.getType(e),this.getShared(e,t)){var n=this.getUnique(e,t);n&&void 0===this.constructor.uuid&&(this.constructor.uuid=_Math.generateUUID()),i=e.getUuid(i||this.getUuid(),!n);var o=e.getNodeData(i),a=o.output||this.getType(e);if(e.parsing)return(o.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,o,t),this.generate(e,t,i)):Node$1.prototype.build.call(this,e,t,i);if(n)return o.name=o.name||Node$1.prototype.build.call(this,e,t,i),o.name;if(!(this.getLabel()||this.getShared(e,a)&&e.optimize&&1!==o.deps))return Node$1.prototype.build.call(this,e,t,i);i=this.getUuid(!1);var s=this.getTemp(e,i);if(s)return e.format(s,a,t);s=TempNode.prototype.generate.call(this,e,t,i,o.output,r);var l=this.generate(e,a,i);return e.addNodeCode(s+" = "+l+";"),e.format(s,a,t)}return Node$1.prototype.build.call(this,e,t,i)},TempNode.prototype.getShared=function(e,t){return"sampler2D"!==t&&"samplerCube"!==t&&this.shared},TempNode.prototype.getUnique=function(e,t){return this.unique},TempNode.prototype.setLabel=function(e){return this.label=e,this},TempNode.prototype.getLabel=function(e){return this.label},TempNode.prototype.getUuid=function(e){var t=(e||null==e)&&this.constructor.uuid||this.uuid;return"string"==typeof this.scope&&(t=this.scope+"-"+t),t},TempNode.prototype.getTemp=function(e,t){t=t||this.uuid;var i=e.getVars()[t];return i?i.name:void 0},TempNode.prototype.generate=function(e,t,i,r,n){return this.getShared(e,t)||console.error("TempNode is not shared!"),i=i||this.uuid,e.getTempVar(i,r||this.getType(e),n,this.getLabel()).name};var NodeLib={nodes:{},keywords:{},add:function(e){this.nodes[e.name]=e},addKeyword:function(e,t,i){i=void 0===i||i,this.keywords[e]={callback:t,cache:i}},remove:function(e){delete this.nodes[e.name]},removeKeyword:function(e){delete this.keywords[e]},get:function(e){return this.nodes[e]},getKeyword:function(e,t){return this.keywords[e].callback.call(this,t)},getKeywordData:function(e){return this.keywords[e]},contains:function(e){return null!=this.nodes[e]},containsKeyword:function(e){return null!=this.keywords[e]}},declarationRegexp=/^([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,propertiesRegexp=/[a-z_0-9]+/gi;function FunctionNode(e,t,i,r,n){this.isMethod=void 0===n,TempNode.call(this,n),this.eval(e,t,i,r)}function InputNode(e,t){(t=t||{}).shared=void 0!==t.shared&&t.shared,TempNode.call(this,e,t),this.readonly=!1}function FloatNode(e){InputNode.call(this,"f"),this.value=e||0}function PositionNode(e){TempNode.call(this,"v3"),this.scope=e||PositionNode.LOCAL}function CameraNode(e,t){TempNode.call(this,"v3"),this.setScope(e||CameraNode.POSITION),this.setCamera(t)}FunctionNode.prototype=Object.create(TempNode.prototype),FunctionNode.prototype.constructor=FunctionNode,FunctionNode.prototype.nodeType="Function",FunctionNode.prototype.useKeywords=!0,FunctionNode.prototype.getShared=function(e,t){return!this.isMethod},FunctionNode.prototype.getType=function(e){return e.getTypeByFormat(this.type)},FunctionNode.prototype.getInputByName=function(e){for(var t=this.inputs.length;t--;)if(this.inputs[t].name===e)return this.inputs[t]},FunctionNode.prototype.getIncludeByName=function(e){for(var t=this.includes.length;t--;)if(this.includes[t].name===e)return this.includes[t]},FunctionNode.prototype.generate=function(e,t){for(var i,r=0,n=this.src,o=0;o<this.includes.length;o++)e.include(this.includes[o],this);for(var a in this.extensions)e.extensions[a]=!0;for(;i=propertiesRegexp.exec(this.src);){var s=i[0],l=!this.isMethod||!this.getInputByName(s),u=s;if(this.keywords[s]||this.useKeywords&&l&&NodeLib.containsKeyword(s)){var h=this.keywords[s];if(!h){var c=NodeLib.getKeywordData(s);c.cache&&(h=e.keywords[s]),h=h||NodeLib.getKeyword(s,e),c.cache&&(e.keywords[s]=h)}u=h.build(e)}s!=u&&(n=n.substring(0,i.index+r)+u+n.substring(i.index+s.length+r),r+=u.length-s.length),void 0===this.getIncludeByName(u)&&NodeLib.contains(u)&&e.include(NodeLib.get(u))}return"source"===t?n:this.isMethod?(e.include(this,!1,n),this.name):e.format("( "+n+" )",this.getType(e),t)},FunctionNode.prototype.eval=function(e,t,i,r){if(this.src=e||"",this.includes=t||[],this.extensions=i||{},this.keywords=r||{},this.isMethod){var n=this.src.match(declarationRegexp);if(this.inputs=[],n&&4==n.length){this.type=n[1],this.name=n[2];var o=n[3].match(propertiesRegexp);if(o)for(var a=0;a<o.length;){var s,l,u=o[a++];"in"==u||"out"==u||"inout"==u?s=o[a++]:(s=u,u=""),l=o[a++],this.inputs.push({name:l,type:s,qualifier:u})}}else this.type="",this.name=""}},FunctionNode.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.isMethod=e.isMethod,this.useKeywords=e.useKeywords,this.eval(e.src,e.includes,e.extensions,e.keywords),void 0!==e.type&&(this.type=e.type)},FunctionNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t){for(var i in(t=this.createJSONNode(e)).src=this.src,t.isMethod=this.isMethod,t.useKeywords=this.useKeywords,this.isMethod||(t.type=this.type),t.extensions=JSON.parse(JSON.stringify(this.extensions)),t.keywords={},this.keywords)t.keywords[i]=this.keywords[i].toJSON(e).uuid;if(this.includes.length){t.includes=[];for(var r=0;r<this.includes.length;r++)t.includes.push(this.includes[r].toJSON(e).uuid)}}return t},InputNode.prototype=Object.create(TempNode.prototype),InputNode.prototype.constructor=InputNode,InputNode.prototype.setReadonly=function(e){return this.readonly=e,this},InputNode.prototype.getReadonly=function(e){return this.readonly},InputNode.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),void 0!==e.readonly&&(this.readonly=e.readonly)},InputNode.prototype.createJSONNode=function(e){var t=TempNode.prototype.createJSONNode.call(this,e);return!0===this.readonly&&(t.readonly=this.readonly),t},InputNode.prototype.generate=function(e,t,i,r,n,o){i=e.getUuid(i||this.getUuid()),r=r||this.getType(e);var a=e.getNodeData(i);return this.getReadonly(e)&&void 0!==this.generateReadonly?this.generateReadonly(e,t,i,r,n,o):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(r,this,n,o,this.getLabel())),e.format(a.vertex.name,r,t)):(a.fragment||(a.fragment=e.createFragmentUniform(r,this,n,o,this.getLabel())),e.format(a.fragment.name,r,t))},FloatNode.prototype=Object.create(InputNode.prototype),FloatNode.prototype.constructor=FloatNode,FloatNode.prototype.nodeType="Float",FloatNode.prototype.generateReadonly=function(e,t,i,r,n,o){return e.format(this.value+(this.value%1?"":".0"),r,t)},FloatNode.prototype.copy=function(e){InputNode.prototype.copy.call(this,e),this.value=e.value},FloatNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value,!0===this.readonly&&(t.readonly=!0)),t},PositionNode.LOCAL="local",PositionNode.WORLD="world",PositionNode.VIEW="view",PositionNode.PROJECTION="projection",PositionNode.prototype=Object.create(TempNode.prototype),PositionNode.prototype.constructor=PositionNode,PositionNode.prototype.nodeType="Position",PositionNode.prototype.getType=function(){switch(this.scope){case PositionNode.PROJECTION:return"v4"}return this.type},PositionNode.prototype.getShared=function(e){switch(this.scope){case PositionNode.LOCAL:case PositionNode.WORLD:return!1}return!0},PositionNode.prototype.generate=function(e,t){var i;switch(this.scope){case PositionNode.LOCAL:e.requires.position=!0,i=e.isShader("vertex")?"transformed":"vPosition";break;case PositionNode.WORLD:e.requires.worldPosition=!0,i="vWPosition";break;case PositionNode.VIEW:i=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case PositionNode.PROJECTION:i=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return e.format(i,this.getType(e),t)},PositionNode.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.scope=e.scope},PositionNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t},NodeLib.addKeyword("position",function(){return new PositionNode}),NodeLib.addKeyword("worldPosition",function(){return new PositionNode(PositionNode.WORLD)}),NodeLib.addKeyword("viewPosition",function(){return new PositionNode(NormalNode.VIEW)}),CameraNode.Nodes={depthColor:new FunctionNode(["float depthColor( float mNear, float mFar ) {","\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\treturn 1.0 - smoothstep( mNear, mFar, depth );","}"].join("\n"))},CameraNode.POSITION="position",CameraNode.DEPTH="depth",CameraNode.TO_VERTEX="toVertex",CameraNode.prototype=Object.create(TempNode.prototype),CameraNode.prototype.constructor=CameraNode,CameraNode.prototype.nodeType="Camera",CameraNode.prototype.setCamera=function(e){this.camera=e,this.updateFrame=void 0!==e?this.onUpdateFrame:void 0},CameraNode.prototype.setScope=function(e){switch(this.scope){case CameraNode.DEPTH:delete this.near,delete this.far}switch(this.scope=e,e){case CameraNode.DEPTH:var t=this.camera;this.near=new FloatNode(t?t.near:1),this.far=new FloatNode(t?t.far:1200)}},CameraNode.prototype.getType=function(e){switch(this.scope){case CameraNode.DEPTH:return"f"}return this.type},CameraNode.prototype.getUnique=function(e){switch(this.scope){case CameraNode.DEPTH:case CameraNode.TO_VERTEX:return!0}return!1},CameraNode.prototype.getShared=function(e){switch(this.scope){case CameraNode.POSITION:return!1}return!0},CameraNode.prototype.generate=function(e,t){var i;switch(this.scope){case CameraNode.POSITION:i="cameraPosition";break;case CameraNode.DEPTH:i=e.include(CameraNode.Nodes.depthColor)+"( "+this.near.build(e,"f")+", "+this.far.build(e,"f")+" )";break;case CameraNode.TO_VERTEX:i="normalize( "+new PositionNode(PositionNode.WORLD).build(e,"v3")+" - cameraPosition )"}return e.format(i,this.getType(e),t)},CameraNode.prototype.onUpdateFrame=function(e){switch(this.scope){case CameraNode.DEPTH:var t=this.camera;this.near.value=t.near,this.far.value=t.far}},CameraNode.prototype.copy=function(e){switch(TempNode.prototype.copy.call(this,e),this.setScope(e.scope),e.camera&&this.setCamera(e.camera),e.scope){case CameraNode.DEPTH:this.near.number=e.near,this.far.number=e.far}},CameraNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t)switch((t=this.createJSONNode(e)).scope=this.scope,this.camera&&(t.camera=this.camera.uuid),this.scope){case CameraNode.DEPTH:t.near=this.near.value,t.far=this.far.value}return t};var vertexDict=["color","color2"],fragmentDict=["vColor","vColor2"];function ColorsNode(e){TempNode.call(this,"v4",{shared:!1}),this.index=e||0}function LightNode(e){TempNode.call(this,"v3",{shared:!1}),this.scope=e||LightNode.TOTAL}function NormalNode$1(e){TempNode.call(this,"v3"),this.scope=e||NormalNode$1.LOCAL}function ReflectNode(e){TempNode.call(this,"v3",{unique:!0}),this.scope=e||ReflectNode.CUBE}ColorsNode.prototype=Object.create(TempNode.prototype),ColorsNode.prototype.constructor=ColorsNode,ColorsNode.prototype.generate=function(e,t){e.requires.color[this.index]=!0;var i=e.isShader("vertex")?vertexDict[this.index]:fragmentDict[this.index];return e.format(i,this.getType(e),t)},ColorsNode.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.index=e.index},ColorsNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).index=this.index),t},LightNode.TOTAL="total",LightNode.prototype=Object.create(TempNode.prototype),LightNode.prototype.constructor=LightNode,LightNode.prototype.nodeType="Light",LightNode.prototype.generate=function(e,t){return e.isCache("light")?e.format("reflectedLight.directDiffuse",this.type,t):(console.warn('LightNode is only compatible in "light" channel.'),e.format("vec3( 0.0 )",this.type,t))},LightNode.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.scope=e.scope},LightNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t},NormalNode$1.LOCAL="local",NormalNode$1.WORLD="world",NormalNode$1.VIEW="view",NormalNode$1.prototype=Object.create(TempNode.prototype),NormalNode$1.prototype.constructor=NormalNode$1,NormalNode$1.prototype.nodeType="Normal",NormalNode$1.prototype.getShared=function(e){switch(this.scope){case NormalNode$1.WORLD:return!0}return!1},NormalNode$1.prototype.generate=function(e,t){var i;switch(this.scope){case NormalNode$1.LOCAL:e.requires.normal=!0,i="normal";break;case NormalNode$1.WORLD:e.requires.worldNormal=!0,i=e.isShader("vertex")?"( modelMatrix * vec4( objectNormal, 0.0 ) ).xyz":"vWNormal";break;case NormalNode$1.VIEW:i="vNormal"}return e.format(i,this.getType(e),t)},NormalNode$1.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.scope=e.scope},NormalNode$1.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t},NodeLib.addKeyword("normal",function(){return new NormalNode$1}),NodeLib.addKeyword("worldNormal",function(){return new NormalNode$1(NormalNode$1.WORLD)}),NodeLib.addKeyword("viewNormal",function(){return new NormalNode$1(NormalNode$1.VIEW)}),ReflectNode.CUBE="cube",ReflectNode.SPHERE="sphere",ReflectNode.VECTOR="vector",ReflectNode.prototype=Object.create(TempNode.prototype),ReflectNode.prototype.constructor=ReflectNode,ReflectNode.prototype.nodeType="Reflect",ReflectNode.prototype.getType=function(e){switch(this.scope){case ReflectNode.SPHERE:return"v2"}return this.type},ReflectNode.prototype.generate=function(e,t){if(e.isShader("fragment")){var i;switch(this.scope){case ReflectNode.VECTOR:e.addNodeCode("vec3 reflectVec = inverseTransformDirection( reflect( -normalize( vViewPosition ), normal ), viewMatrix );"),i="reflectVec";break;case ReflectNode.CUBE:var r=new ReflectNode(ReflectNode.VECTOR).build(e,"v3");e.addNodeCode("vec3 reflectCubeVec = vec3( -1.0 * "+r+".x, "+r+".yz );"),i="reflectCubeVec";break;case ReflectNode.SPHERE:r=new ReflectNode(ReflectNode.VECTOR).build(e,"v3");e.addNodeCode("vec2 reflectSphereVec = normalize( ( viewMatrix * vec4( "+r+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5;"),i="reflectSphereVec"}return e.format(i,this.getType(e),t)}return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)},ReflectNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope),t};var NodeUtils={elements:["x","y","z","w"],addShortcuts:function(){function e(e,t,i){return i?{get:function(){return this[e][t][i]},set:function(r){this[e][t][i]=r}}:{get:function(){return this[e][t]},set:function(i){this[e][t]=i}}}return function(t,i,r){for(var n={},o=0;o<r.length;++o){var a=r[o].split("."),s=a[0],l=a[1];n[s]=e(i,s,l)}Object.defineProperties(t,n)}}()};function Vector2Node(e,t){InputNode.call(this,"v2"),this.value=e instanceof Vector2?e:new Vector2(e,t)}function ResolutionNode(){Vector2Node.call(this)}function ScreenUVNode(e){TempNode.call(this,"v2"),this.resolution=e||new ResolutionNode}Vector2Node.prototype=Object.create(InputNode.prototype),Vector2Node.prototype.constructor=Vector2Node,Vector2Node.prototype.nodeType="Vector2",NodeUtils.addShortcuts(Vector2Node.prototype,"value",["x","y"]),Vector2Node.prototype.generateReadonly=function(e,t,i,r,n,o){return e.format("vec2( "+this.x+", "+this.y+" )",r,t)},Vector2Node.prototype.copy=function(e){InputNode.prototype.copy.call(this,e),this.value.copy(e)},Vector2Node.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).x=this.x,t.y=this.y,!0===this.readonly&&(t.readonly=!0)),t},ResolutionNode.prototype=Object.create(Vector2Node.prototype),ResolutionNode.prototype.constructor=ResolutionNode,ResolutionNode.prototype.nodeType="Resolution",ResolutionNode.prototype.updateFrame=function(e){if(e.renderer){var t=e.renderer.getSize(),i=e.renderer.getPixelRatio();this.x=t.width*i,this.y=t.height*i}else console.warn("ResolutionNode need a renderer in NodeFrame")},ResolutionNode.prototype.copy=function(e){Vector2Node.prototype.copy.call(this,e),this.renderer=e.renderer},ResolutionNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).renderer=this.renderer.uuid),t},ScreenUVNode.prototype=Object.create(TempNode.prototype),ScreenUVNode.prototype.constructor=ScreenUVNode,ScreenUVNode.prototype.nodeType="ScreenUV",ScreenUVNode.prototype.generate=function(e,t){var i;return e.isShader("fragment")?i="( gl_FragCoord.xy / "+this.resolution.build(e,"v2")+")":(console.warn("ScreenUVNode is not compatible with "+e.shader+" shader."),i="vec2( 0.0 )"),e.format(i,this.getType(e),t)},ScreenUVNode.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.resolution=e.resolution},ScreenUVNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).resolution=this.resolution.toJSON(e).uuid),t};var vertexDict$1=["uv","uv2"],fragmentDict$1=["vUv","vUv2"];function UVNode(e){TempNode.call(this,"v2",{shared:!1}),this.index=e||0}function BlinnShininessExponentNode(){TempNode.call(this,"f")}function BlinnExponentToRoughnessNode(e){TempNode.call(this,"f"),this.blinnExponent=e||new BlinnShininessExponentNode}function MaxMIPLevelNode(e){FloatNode.call(this),this.texture=e,this.maxMIPLevel=0}function RoughnessToBlinnExponentNode(e){TempNode.call(this,"f"),this.texture=e,this.maxMIPLevel=new MaxMIPLevelNode(e),this.blinnShininessExponent=new BlinnShininessExponentNode}function AttributeNode(e,t){Node$1.call(this,t),this.name=e}UVNode.prototype=Object.create(TempNode.prototype),UVNode.prototype.constructor=UVNode,UVNode.prototype.nodeType="UV",UVNode.prototype.generate=function(e,t){e.requires.uv[this.index]=!0;var i=e.isShader("vertex")?vertexDict$1[this.index]:fragmentDict$1[this.index];return e.format(i,this.getType(e),t)},UVNode.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.index=e.index},UVNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).index=this.index),t},NodeLib.addKeyword("uv",function(){return new UVNode}),NodeLib.addKeyword("uv2",function(){return new UVNode(1)}),BlinnShininessExponentNode.prototype=Object.create(TempNode.prototype),BlinnShininessExponentNode.prototype.constructor=BlinnShininessExponentNode,BlinnShininessExponentNode.prototype.nodeType="BlinnShininessExponent",BlinnShininessExponentNode.prototype.generate=function(e,t){return e.isCache("clearCoat")?e.format("Material_ClearCoat_BlinnShininessExponent( material )",this.type,t):e.format("Material_BlinnShininessExponent( material )",this.type,t)},BlinnExponentToRoughnessNode.prototype=Object.create(TempNode.prototype),BlinnExponentToRoughnessNode.prototype.constructor=BlinnExponentToRoughnessNode,BlinnExponentToRoughnessNode.prototype.nodeType="BlinnExponentToRoughness",BlinnExponentToRoughnessNode.prototype.generate=function(e,t){return e.format("BlinnExponentToGGXRoughness( "+this.blinnExponent.build(e,"f")+" )",this.type,t)},BlinnExponentToRoughnessNode.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.blinnExponent=e.blinnExponent},BlinnExponentToRoughnessNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).blinnExponent=this.blinnExponent),t},MaxMIPLevelNode.prototype=Object.create(FloatNode.prototype),MaxMIPLevelNode.prototype.constructor=MaxMIPLevelNode,MaxMIPLevelNode.prototype.nodeType="MaxMIPLevel",Object.defineProperties(MaxMIPLevelNode.prototype,{value:{get:function(){if(0===this.maxMIPLevel){var e=this.texture.value.image?this.texture.value.image[0]:void 0;this.maxMIPLevel=void 0!==e?Math.log(Math.max(e.width,e.height))*Math.LOG2E:0}return this.maxMIPLevel},set:function(){}}}),MaxMIPLevelNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).texture=this.texture.uuid),t},RoughnessToBlinnExponentNode.Nodes={getSpecularMIPLevel:new FunctionNode(["float getSpecularMIPLevel( const in float blinnShininessExponent, const in float maxMIPLevelScalar ) {","\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );","\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );","}"].join("\n"))},RoughnessToBlinnExponentNode.prototype=Object.create(TempNode.prototype),RoughnessToBlinnExponentNode.prototype.constructor=RoughnessToBlinnExponentNode,RoughnessToBlinnExponentNode.prototype.nodeType="RoughnessToBlinnExponent",RoughnessToBlinnExponentNode.prototype.generate=function(e,t){if(e.isShader("fragment")){this.maxMIPLevel.texture=this.texture;var i=e.include(RoughnessToBlinnExponentNode.Nodes.getSpecularMIPLevel);return e.format(i+"( "+this.blinnShininessExponent.build(e,"f")+", "+this.maxMIPLevel.build(e,"f")+" )",this.type,t)}return console.warn("RoughnessToBlinnExponentNode is not compatible with "+e.shader+" shader."),e.format("0.0",this.type,t)},RoughnessToBlinnExponentNode.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.texture=e.texture},RoughnessToBlinnExponentNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).texture=this.texture),t},AttributeNode.prototype=Object.create(Node$1.prototype),AttributeNode.prototype.constructor=AttributeNode,AttributeNode.prototype.nodeType="Attribute",AttributeNode.prototype.getAttributeType=function(e){return"number"==typeof this.type?e.getConstructorFromLength(this.type):this.type},AttributeNode.prototype.getType=function(e){var t=this.getAttributeType(e);return e.getTypeByFormat(t)},AttributeNode.prototype.generate=function(e,t){var i=this.getAttributeType(e),r=e.getAttribute(this.name,i),n=e.isShader("vertex")?this.name:r.varying.name;return console.log(r),e.format(n,this.getType(e),t)},AttributeNode.prototype.copy=function(e){Node$1.prototype.copy.call(this,e),this.type=e.type},AttributeNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).type=this.type),t};var declarationRegexp$1=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i;function ConstNode(e,t){TempNode.call(this),this.eval(e||ConstNode.PI,t)}function ExpressionNode(e,t,i,r,n){FunctionNode.call(this,e,n,r,i,t)}function FunctionCallNode(e,t){TempNode.call(this),this.setFunction(e,t)}function NodeUniform(e){e=e||{},this.name=e.name,this.type=e.type,this.node=e.node,this.needsUpdate=e.needsUpdate}ConstNode.PI="PI",ConstNode.PI2="PI2",ConstNode.RECIPROCAL_PI="RECIPROCAL_PI",ConstNode.RECIPROCAL_PI2="RECIPROCAL_PI2",ConstNode.LOG2="LOG2",ConstNode.EPSILON="EPSILON",ConstNode.prototype=Object.create(TempNode.prototype),ConstNode.prototype.constructor=ConstNode,ConstNode.prototype.nodeType="Const",ConstNode.prototype.getType=function(e){return e.getTypeByFormat(this.type)},ConstNode.prototype.eval=function(e,t){this.src=e||"";var i,r,n="",o=this.src.match(declarationRegexp$1);this.useDefine=t||"#"===this.src.charAt(0),o&&o.length>1?(r=o[1],i=o[2],n=o[3]):(i=this.src,r="f"),this.name=i,this.type=r,this.value=n},ConstNode.prototype.build=function(e,t){return"source"!==t?(e.include(this),e.format(this.name,this.getType(e),t)):this.value?this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";":this.useDefine?this.src:void 0},ConstNode.prototype.generate=function(e,t){return e.format(this.name,this.getType(e),t)},ConstNode.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.eval(e.src,e.useDefine)},ConstNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).src=this.src,!0===t.useDefine&&(t.useDefine=!0)),t},ExpressionNode.prototype=Object.create(FunctionNode.prototype),ExpressionNode.prototype.constructor=ExpressionNode,ExpressionNode.prototype.nodeType="Expression",FunctionCallNode.prototype=Object.create(TempNode.prototype),FunctionCallNode.prototype.constructor=FunctionCallNode,FunctionCallNode.prototype.nodeType="FunctionCall",FunctionCallNode.prototype.setFunction=function(e,t){this.value=e,this.inputs=t||[]},FunctionCallNode.prototype.getFunction=function(){return this.value},FunctionCallNode.prototype.getType=function(e){return this.value.getType(e)},FunctionCallNode.prototype.generate=function(e,t){for(var i=this.getType(e),r=this.value,n=r.build(e,t)+"( ",o=[],a=0;a<r.inputs.length;a++){var s=r.inputs[a],l=this.inputs[a]||this.inputs[s.name];o.push(l.build(e,e.getTypeByFormat(s.type)))}return n+=o.join(", ")+" )",e.format(n,i,t)},FunctionCallNode.prototype.copy=function(e){for(var t in TempNode.prototype.copy.call(this,e),e.inputs)this.inputs[t]=e.inputs[t];this.value=e.value},FunctionCallNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t){var i=this.value;if((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,i.inputs.length){t.inputs={};for(var r=0;r<i.inputs.length;r++){var n=i.inputs[r],o=this.inputs[r]||this.inputs[n.name];t.inputs[n.name]=o.toJSON(e).uuid}}}return t},Object.defineProperties(NodeUniform.prototype,{value:{get:function(){return this.node.value},set:function(e){this.node.value=e}}});var declarationRegexp$2=/^struct\s*([a-z_0-9]+)\s*{\s*((.|\n)*?)}/gim,propertiesRegexp$1=/\s*(\w*?)\s*(\w*?)(\=|\;)/gim,LinearToLinear,GammaToLinear,LinearToGamma,sRGBToLinear,LinearTosRGB,RGBEToLinear,LinearToRGBE,RGBMToLinear,LinearToRGBM,RGBDToLinear,LinearToRGBD,cLogLuvM,LinearToLogLuv,cLogLuvInverseM,TextureCubeUVData,getFaceFromDirection,cubeUV_maxLods1,cubeUV_rangeClamp,MipLevelInfo,cubeUV_maxLods2,cubeUV_rcpTextureSize,getCubeUV,cubeUV_maxLods3;function StructNode(e){TempNode.call(this),this.eval(e)}function Vector3Node(e,t,i){InputNode.call(this,"v3"),this.value=e instanceof Vector3?e:new Vector3(e,t,i)}function Vector4Node(e,t,i,r){InputNode.call(this,"v4"),this.value=e instanceof Vector4?e:new Vector4(e,t,i,r)}function ColorSpaceNode(e,t){TempNode.call(this,"v4"),this.input=e,this.method=t||ColorSpaceNode.LINEAR}function TextureNode(e,t,i,r){InputNode.call(this,"v4",{shared:!0}),this.value=e,this.uv=t||new UVNode,this.bias=i,this.project=void 0!==r&&r}function CubeTextureNode(e,t,i){InputNode.call(this,"v4",{shared:!0}),this.value=e,this.uv=t||new ReflectNode,this.bias=i}function TextureCubeUVNode(e,t,i){TempNode.call(this,"TextureCubeUVData"),this.uv=e||new ReflectNode(ReflectNode.VECTOR),this.textureSize=t||new FloatNode(1024),this.blinnExponentToRoughness=i||new BlinnExponentToRoughnessNode}function TextureCubeNode(e,t){TempNode.call(this,"v4"),this.value=e,this.uv=t||new TextureCubeUVNode}StructNode.prototype=Object.create(TempNode.prototype),StructNode.prototype.constructor=StructNode,StructNode.prototype.nodeType="Struct",StructNode.prototype.getType=function(e){return e.getTypeByFormat(this.name)},StructNode.prototype.getInputByName=function(e){for(var t=this.inputs.length;t--;)if(this.inputs[t].name===e)return this.inputs[t]},StructNode.prototype.generate=function(e,t){return"source"===t?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)},StructNode.prototype.eval=function(e){this.src=e||"",this.inputs=[];var t=declarationRegexp$2.exec(this.src);if(t){for(var i,r=t[2];i=propertiesRegexp$1.exec(r);)this.inputs.push({type:i[1],name:i[2]});this.name=t[1]}else this.name="";this.type=this.name},StructNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).src=this.src),t},Vector3Node.prototype=Object.create(InputNode.prototype),Vector3Node.prototype.constructor=Vector3Node,Vector3Node.prototype.nodeType="Vector3",NodeUtils.addShortcuts(Vector3Node.prototype,"value",["x","y","z"]),Vector3Node.prototype.generateReadonly=function(e,t,i,r,n,o){return e.format("vec3( "+this.x+", "+this.y+", "+this.z+" )",r,t)},Vector3Node.prototype.copy=function(e){InputNode.prototype.copy.call(this,e),this.value.copy(e)},Vector3Node.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).x=this.x,t.y=this.y,t.z=this.z,!0===this.readonly&&(t.readonly=!0)),t},Vector4Node.prototype=Object.create(InputNode.prototype),Vector4Node.prototype.constructor=Vector4Node,Vector4Node.prototype.nodeType="Vector4",NodeUtils.addShortcuts(Vector4Node.prototype,"value",["x","y","z","w"]),Vector4Node.prototype.generateReadonly=function(e,t,i,r,n,o){return e.format("vec4( "+this.x+", "+this.y+", "+this.z+", "+this.w+" )",r,t)},Vector4Node.prototype.copy=function(e){InputNode.prototype.copy.call(this,e),this.value.copy(e)},Vector4Node.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,!0===this.readonly&&(t.readonly=!0)),t},ColorSpaceNode.Nodes=(LinearToLinear=new FunctionNode(["vec4 LinearToLinear( in vec4 value ) {","\treturn value;","}"].join("\n")),GammaToLinear=new FunctionNode(["vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {","\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );","}"].join("\n")),LinearToGamma=new FunctionNode(["vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {","\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );","}"].join("\n")),sRGBToLinear=new FunctionNode(["vec4 sRGBToLinear( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join("\n")),LinearTosRGB=new FunctionNode(["vec4 LinearTosRGB( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join("\n")),RGBEToLinear=new FunctionNode(["vec4 RGBEToLinear( in vec4 value ) {","\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );","}"].join("\n")),LinearToRGBE=new FunctionNode(["vec4 LinearToRGBE( in vec4 value ) {","\tfloat maxComponent = max( max( value.r, value.g ), value.b );","\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );","\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );","}"].join("\n")),RGBMToLinear=new FunctionNode(["vec3 RGBMToLinear( in vec4 value, in float maxRange ) {","\treturn vec4( value.xyz * value.w * maxRange, 1.0 );","}"].join("\n")),LinearToRGBM=new FunctionNode(["vec3 LinearToRGBM( in vec4 value, in float maxRange ) {","\tfloat maxRGB = max( value.x, max( value.g, value.b ) );","\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );","\tM            = ceil( M * 255.0 ) / 255.0;","\treturn vec4( value.rgb / ( M * maxRange ), M );","}"].join("\n")),RGBDToLinear=new FunctionNode(["vec3 RGBDToLinear( in vec4 value, in float maxRange ) {","\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );","}"].join("\n")),LinearToRGBD=new FunctionNode(["vec3 LinearToRGBD( in vec4 value, in float maxRange ) {","\tfloat maxRGB = max( value.x, max( value.g, value.b ) );","\tfloat D      = max( maxRange / maxRGB, 1.0 );","\tD            = min( floor( D ) / 255.0, 1.0 );","\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );","}"].join("\n")),cLogLuvM=new ConstNode("const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );"),LinearToLogLuv=new FunctionNode(["vec4 LinearToLogLuv( in vec4 value ) {","\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;","\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));","\tvec4 vResult;","\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;","\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;","\tvResult.w = fract(Le);","\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;","\treturn vResult;","}"].join("\n"),[cLogLuvM]),cLogLuvInverseM=new ConstNode("const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );"),{LinearToLinear:LinearToLinear,GammaToLinear:GammaToLinear,LinearToGamma:LinearToGamma,sRGBToLinear:sRGBToLinear,LinearTosRGB:LinearTosRGB,RGBEToLinear:RGBEToLinear,LinearToRGBE:LinearToRGBE,RGBMToLinear:RGBMToLinear,LinearToRGBM:LinearToRGBM,RGBDToLinear:RGBDToLinear,LinearToRGBD:LinearToRGBD,cLogLuvM:cLogLuvM,LinearToLogLuv:LinearToLogLuv,cLogLuvInverseM:cLogLuvInverseM,LogLuvToLinear:new FunctionNode(["vec4 LogLuvToLinear( in vec4 value ) {","\tfloat Le = value.z * 255.0 + value.w;","\tvec3 Xp_Y_XYZp;","\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);","\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;","\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;","\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;","\treturn vec4( max(vRGB, 0.0), 1.0 );","}"].join("\n"),[cLogLuvInverseM])}),ColorSpaceNode.LINEAR_TO_LINEAR="LinearToLinear",ColorSpaceNode.GAMMA_TO_LINEAR="GammaToLinear",ColorSpaceNode.LINEAR_TO_GAMMA="LinearToGamma",ColorSpaceNode.SRGB_TO_LINEAR="sRGBToLinear",ColorSpaceNode.LINEAR_TO_SRGB="LinearTosRGB",ColorSpaceNode.RGBE_TO_LINEAR="RGBEToLinear",ColorSpaceNode.LINEAR_TO_RGBE="LinearToRGBE",ColorSpaceNode.RGBM_TO_LINEAR="RGBMToLinear",ColorSpaceNode.LINEAR_TO_RGBM="LinearToRGBM",ColorSpaceNode.RGBD_TO_LINEAR="RGBDToLinear",ColorSpaceNode.LINEAR_TO_RGBD="LinearToRGBD",ColorSpaceNode.LINEAR_TO_LOG_LUV="LinearToLogLuv",ColorSpaceNode.LOG_LUV_TO_LINEAR="LogLuvToLinear",ColorSpaceNode.prototype=Object.create(TempNode.prototype),ColorSpaceNode.prototype.constructor=ColorSpaceNode,ColorSpaceNode.prototype.nodeType="ColorAdjustment",ColorSpaceNode.prototype.generate=function(e,t){var i=e.context.input||this.input.build(e,"v4"),r=void 0!==e.context.encoding?this.getEncodingMethod(e.context.encoding):[this.method],n=this.factor?this.factor.build(e,"f"):r[1],o=e.include(ColorSpaceNode.Nodes[r[0]]);return n?e.format(o+"( "+i+", "+n+" )",this.getType(e),t):e.format(o+"( "+i+" )",this.getType(e),t)},ColorSpaceNode.prototype.getDecodingMethod=function(e){var t=this.getEncodingComponents(e);return t[0]+="ToLinear",t},ColorSpaceNode.prototype.getEncodingMethod=function(e){var t=this.getEncodingComponents(e);return t[0]="LinearTo"+t[0],t},ColorSpaceNode.prototype.getEncodingComponents=function(e){switch(e){case LinearEncoding:return["Linear"];case sRGBEncoding:return["sRGB"];case RGBEEncoding:return["RGBE"];case RGBM7Encoding:return["RGBM","7.0"];case RGBM16Encoding:return["RGBM","16.0"];case RGBDEncoding:return["RGBD","256.0"];case GammaEncoding:return["Gamma","float( GAMMA_FACTOR )"]}},ColorSpaceNode.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.input=e.input,this.method=e.method},ColorSpaceNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).input=this.input.toJSON(e).uuid,t.method=this.method),t},TextureNode.prototype=Object.create(InputNode.prototype),TextureNode.prototype.constructor=TextureNode,TextureNode.prototype.nodeType="Texture",TextureNode.prototype.getTexture=function(e,t){return InputNode.prototype.generate.call(this,e,t,this.value.uuid,"t")},TextureNode.prototype.generate=function(e,t){if("sampler2D"===t)return this.getTexture(e,t);var i,r,n=this.getTexture(e,t),o=this.uv.build(e,this.project?"v4":"v2"),a=this.bias?this.bias.build(e,"f"):void 0;return null==a&&e.context.bias&&(a=new e.context.bias(this).build(e,"f")),i=this.project?"texture2DProj":a?"tex2DBias":"tex2D",r=a?i+"( "+n+", "+o+", "+a+" )":i+"( "+n+", "+o+" )",e.addContext({input:r,encoding:e.getTextureEncodingFromMap(this.value),include:e.isShader("vertex")}),this.colorSpace=this.colorSpace||new ColorSpaceNode(this),r=this.colorSpace.build(e,this.type),e.removeContext(),e.format(r,this.type,t)},TextureNode.prototype.copy=function(e){InputNode.prototype.copy.call(this,e),e.value&&(this.value=e.value),this.uv=e.uv,e.bias&&(this.bias=e.bias),void 0!==e.project&&(this.project=e.project)},TextureNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.value&&(t.value=this.value.uuid),t.uv=this.uv.toJSON(e).uuid,t.project=this.project,this.bias&&(t.bias=this.bias.toJSON(e).uuid)),t},CubeTextureNode.prototype=Object.create(InputNode.prototype),CubeTextureNode.prototype.constructor=CubeTextureNode,CubeTextureNode.prototype.nodeType="CubeTexture",CubeTextureNode.prototype.getTexture=function(e,t){return InputNode.prototype.generate.call(this,e,t,this.value.uuid,"tc")},CubeTextureNode.prototype.generate=function(e,t){if("samplerCube"===t)return this.getTexture(e,t);var i,r=this.getTexture(e,t),n=this.uv.build(e,"v3"),o=this.bias?this.bias.build(e,"f"):void 0;return void 0===o&&e.context.bias&&(o=new e.context.bias(this).build(e,"f")),i=o?"texCubeBias( "+r+", "+n+", "+o+" )":"texCube( "+r+", "+n+" )",e.addContext({input:i,encoding:e.getTextureEncodingFromMap(this.value),include:e.isShader("vertex")}),this.colorSpace=this.colorSpace||new ColorSpaceNode(this),i=this.colorSpace.build(e,this.type),e.removeContext(),e.format(i,this.type,t)},CubeTextureNode.prototype.copy=function(e){InputNode.prototype.copy.call(this,e),e.value&&(this.value=e.value),this.uv=e.uv,e.bias&&(this.bias=e.bias)},CubeTextureNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.uuid,t.uv=this.uv.toJSON(e).uuid,this.bias&&(t.bias=this.bias.toJSON(e).uuid)),t},TextureCubeUVNode.Nodes=(TextureCubeUVData=new StructNode(["struct TextureCubeUVData {","\tvec2 uv_10;","\tvec2 uv_20;","\tfloat t;","}"].join("\n")),getFaceFromDirection=new FunctionNode(["int getFaceFromDirection(vec3 direction) {","\tvec3 absDirection = abs(direction);","\tint face = -1;","\tif( absDirection.x > absDirection.z ) {","\t\tif(absDirection.x > absDirection.y )","\t\t\tface = direction.x > 0.0 ? 0 : 3;","\t\telse","\t\t\tface = direction.y > 0.0 ? 1 : 4;","\t}","\telse {","\t\tif(absDirection.z > absDirection.y )","\t\t\tface = direction.z > 0.0 ? 2 : 5;","\t\telse","\t\t\tface = direction.y > 0.0 ? 1 : 4;","\t}","\treturn face;","}"].join("\n")),cubeUV_maxLods1=new ConstNode("#define cubeUV_maxLods1 ( log2( cubeUV_textureSize * 0.25 ) - 1.0 )"),cubeUV_rangeClamp=new ConstNode("#define cubeUV_rangeClamp ( exp2( ( 6.0 - 1.0 ) * 2.0 ) )"),MipLevelInfo=new FunctionNode(["vec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness, in float cubeUV_textureSize ) {","\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);","\tfloat dxRoughness = dFdx(roughness);","\tfloat dyRoughness = dFdy(roughness);","\tvec3 dx = dFdx( vec * scale * dxRoughness );","\tvec3 dy = dFdy( vec * scale * dyRoughness );","\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );","\td = clamp(d, 1.0, cubeUV_rangeClamp);","\tfloat mipLevel = 0.5 * log2(d);","\treturn vec2(floor(mipLevel), fract(mipLevel));","}"].join("\n"),[cubeUV_maxLods1,cubeUV_rangeClamp],{derivatives:!0}),cubeUV_maxLods2=new ConstNode("#define cubeUV_maxLods2 ( log2( cubeUV_textureSize * 0.25 ) - 2.0 )"),cubeUV_rcpTextureSize=new ConstNode("#define cubeUV_rcpTextureSize ( 1.0 / cubeUV_textureSize )"),getCubeUV=new FunctionNode(["vec2 getCubeUV( vec3 direction, float roughnessLevel, float mipLevel, in float cubeUV_textureSize ) {","\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;","\tfloat a = 16.0 * cubeUV_rcpTextureSize;","","\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );","\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;","\tfloat powScale = exp2_packed.x * exp2_packed.y;","\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;","\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;","","\tbool bRes = mipLevel == 0.0;","\tscale =  bRes && (scale < a) ? a : scale;","","\tvec3 r;","\tvec2 offset;","\tint face = getFaceFromDirection(direction);","","\tfloat rcpPowScale = 1.0 / powScale;","","\tif( face == 0) {","\t\tr = vec3(direction.x, -direction.z, direction.y);","\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);","\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;","\t}","\telse if( face == 1) {","\t\tr = vec3(direction.y, direction.x, direction.z);","\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);","\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;","\t}","\telse if( face == 2) {","\t\tr = vec3(direction.z, direction.x, direction.y);","\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);","\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;","\t}","\telse if( face == 3) {","\t\tr = vec3(direction.x, direction.z, direction.y);","\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);","\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;","\t}","\telse if( face == 4) {","\t\tr = vec3(direction.y, direction.x, -direction.z);","\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);","\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;","\t}","\telse {","\t\tr = vec3(direction.z, -direction.x, direction.y);","\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);","\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;","\t}","\tr = normalize(r);","\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;","\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;","\tvec2 base = offset + vec2( texelOffset );","\treturn base + s * ( scale - 2.0 * texelOffset );","}"].join("\n"),[cubeUV_maxLods2,cubeUV_rcpTextureSize,getFaceFromDirection]),cubeUV_maxLods3=new ConstNode("#define cubeUV_maxLods3 ( log2( cubeUV_textureSize * 0.25 ) - 3.0 )"),{TextureCubeUVData:TextureCubeUVData,textureCubeUV:new FunctionNode(["TextureCubeUVData textureCubeUV( vec3 reflectedDirection, float roughness, in float cubeUV_textureSize ) {","\tfloat roughnessVal = roughness * cubeUV_maxLods3;","\tfloat r1 = floor(roughnessVal);","\tfloat r2 = r1 + 1.0;","\tfloat t = fract(roughnessVal);","\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness, cubeUV_textureSize);","\tfloat s = mipInfo.y;","\tfloat level0 = mipInfo.x;","\tfloat level1 = level0 + 1.0;","\tlevel1 = level1 > 5.0 ? 5.0 : level1;","","\tlevel0 += min( floor( s + 0.5 ), 5.0 );","","\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0, cubeUV_textureSize);","\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0, cubeUV_textureSize);","","\treturn TextureCubeUVData(uv_10, uv_20, t);","}"].join("\n"),[TextureCubeUVData,cubeUV_maxLods3,MipLevelInfo,getCubeUV])}),TextureCubeUVNode.prototype=Object.create(TempNode.prototype),TextureCubeUVNode.prototype.constructor=TextureCubeUVNode,TextureCubeUVNode.prototype.nodeType="TextureCubeUV",TextureCubeUVNode.prototype.generate=function(e,t){if(e.isShader("fragment")){var i=e.include(TextureCubeUVNode.Nodes.textureCubeUV);return e.format(i+"( "+this.uv.build(e,"v3")+", "+this.blinnExponentToRoughness.build(e,"f")+", "+this.textureSize.build(e,"f")+" )",this.getType(e),t)}return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)},TextureCubeUVNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).uv=this.uv.toJSON(e).uuid,t.textureSize=this.textureSize.toJSON(e).uuid,t.blinnExponentToRoughness=this.blinnExponentToRoughness.toJSON(e).uuid),t},TextureCubeNode.prototype=Object.create(TempNode.prototype),TextureCubeNode.prototype.constructor=TextureCubeNode,TextureCubeNode.prototype.nodeType="TextureCube",TextureCubeNode.prototype.generate=function(e,t){if(e.isShader("fragment")){var i=this.uv.build(e)+".uv_10",r=this.uv.build(e)+".uv_20",n=this.uv.build(e)+".t",o=e.getTexelDecodingFunctionFromTexture("texture2D( "+this.value.build(e,"sampler2D")+", "+i+" )",this.value.value),a=e.getTexelDecodingFunctionFromTexture("texture2D( "+this.value.build(e,"sampler2D")+", "+r+" )",this.value.value);return e.format("vec4( mix( "+o+", "+a+", "+n+" ).rgb, 1.0 )",this.getType(e),t)}return console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)},TextureCubeNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).uv=this.uv.toJSON(e).uuid,t.textureSize=this.textureSize.toJSON(e).uuid,t.blinnExponentToRoughness=this.blinnExponentToRoughness.toJSON(e).uuid,this.roughness&&(t.roughness=this.roughness.toJSON(e).uuid)),t};var elements=NodeUtils.elements,constructors=["float","vec2","vec3","vec4"],convertFormatToType={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b"},convertTypeToFormat={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4"},LUMA,dHdxy_fwd;function NodeBuilder(){this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.requires={uv:[],color:[],lights:!1,fog:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","#include <packing>","#include <common>"].join("\n"),this.parsCode={vertex:"",fragment:""},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={},this.updaters=[],this.nodes=[],this.parsing=!1,this.optimize=!0}function NodeFrame(e){this.time=void 0!==e?e:0,this.id=0}function VarNode(e,t){Node$1.call(this,e),this.value=t}function BlurNode(e,t,i,r){TempNode.call(this,"v4"),this.value=e,this.uv=t||new UVNode,this.radius=new Vector2Node(1,1),this.size=r,this.blurX=!0,this.blurY=!0,this.horizontal=new FloatNode(1/64),this.vertical=new FloatNode(1/64)}function LuminanceNode(e){TempNode.call(this,"f"),this.rgb=e}function ColorAdjustmentNode(e,t,i){TempNode.call(this,"v3"),this.rgb=e,this.adjustment=t,this.method=i||ColorAdjustmentNode.SATURATION}function BoolNode(e){InputNode.call(this,"b"),this.value=Boolean(e)}function ColorNode(e,t,i){InputNode.call(this,"c"),this.value=e instanceof Color?e:new Color(e||0,t,i)}function IntNode(e){InputNode.call(this,"i"),this.value=Math.floor(e||0)}function Matrix3Node(e){InputNode.call(this,"m3"),this.value=e||new Matrix3}function Matrix4Node(e){InputNode.call(this,"m4"),this.value=e||new Matrix4}function PropertyNode(e,t,i){InputNode.call(this,i),this.object=e,this.property=t}function OperatorNode(e,t,i){TempNode.call(this),this.a=e,this.b=t,this.op=i}function ReflectorNode(e){TempNode.call(this,"v4"),e&&this.setMirror(e)}function RawNode(e){Node$1.call(this,"v4"),this.value=e}function NodeMaterial(e,t){ShaderMaterial.call(this),this.vertex=e||new RawNode(new PositionNode(PositionNode.PROJECTION)),this.fragment=t||new RawNode(new ColorNode(16711680)),this.updaters=[]}function RTTNode(e,t,i,r){r=r||{},this.input=i,this.clear=void 0===r.clear||r.clear,this.renderTarget=new WebGLRenderTarget(e,t,r),this.material=new NodeMaterial,this.camera=new OrthographicCamera(-1,1,1,-1,0,1),this.scene=new Scene,this.quad=new Mesh(new PlaneBufferGeometry(2,2),this.material),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.render=!0,TextureNode.call(this,this.renderTarget.texture)}function ScreenNode(e){TextureNode.call(this,void 0,e)}function StandardNode(){Node$1.call(this),this.color=new ColorNode(15658734),this.roughness=new FloatNode(.5),this.metalness=new FloatNode(.5)}function SwitchNode(e,t){Node$1.call(this),this.node=e,this.components=t||"x"}function NormalMapNode(e,t){TempNode.call(this,"v3"),this.value=e,this.scale=t||new Vector2Node(1,1)}function MeshStandardNode(){StandardNode.call(this),this.properties={color:new Color(16777215),roughness:.5,metalness:.5,normalScale:new Vector2(1,1)},this.inputs={color:new PropertyNode(this.properties,"color","c"),roughness:new PropertyNode(this.properties,"roughness","f"),metalness:new PropertyNode(this.properties,"metalness","f"),normalScale:new PropertyNode(this.properties,"normalScale","v2")}}function MeshStandardNodeMaterial(){var e=new MeshStandardNode;NodeMaterial.call(this,e,e),this.type="MeshStandardNodeMaterial"}function PhongNode(){Node$1.call(this),this.color=new ColorNode(15658734),this.specular=new ColorNode(1118481),this.shininess=new FloatNode(30)}function SpriteNode(){Node$1.call(this),this.color=new ColorNode(15658734),this.spherical=!0}function PhongNodeMaterial(){var e=new PhongNode;NodeMaterial.call(this,e,e),this.type="PhongNodeMaterial"}function SpriteNodeMaterial(){var e=new SpriteNode;NodeMaterial.call(this,e,e),this.type="SpriteNodeMaterial"}function StandardNodeMaterial(){var e=new StandardNode;NodeMaterial.call(this,e,e),this.type="StandardNodeMaterial"}function CondNode(e,t,i,r,n){TempNode.call(this),this.a=e,this.b=t,this.op=i,this.ifNode=r,this.elseNode=n}function Math1Node(e,t){TempNode.call(this),this.a=e,this.method=t}function Math2Node(e,t,i){TempNode.call(this),this.a=e,this.b=t,this.method=i}function Math3Node(e,t,i,r){TempNode.call(this),this.a=e,this.b=t,this.c=i,this.method=r}function BumpMapNode(e,t){TempNode.call(this,"v3"),this.value=e,this.scale=t||new FloatNode(1),this.toNormalMap=!1}NodeBuilder.prototype={constructor:NodeBuilder,build:function(e,t){return this.buildShader("vertex",e),this.buildShader("fragment",t),this.requires.uv[0]&&(this.addVaryCode("varying vec2 vUv;"),this.addVertexFinalCode("vUv = uv;")),this.requires.uv[1]&&(this.addVaryCode("varying vec2 vUv2;"),this.addVertexParsCode("attribute vec2 uv2;"),this.addVertexFinalCode("vUv2 = uv2;")),this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition&&(this.addVaryCode("varying vec3 vWPosition;"),this.addVertexFinalCode("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;")),this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = ( modelMatrix * vec4( objectNormal, 0.0 ) ).xyz;")),this},buildShader:function(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")},setMaterial:function(e,t){return this.material=e,this.renderer=t,this.requires.lights=e.lights,this.requires.fog=e.fog,this.mergeDefines(e.defines),this},addFlow:function(e,t,i){return this.addSlot(e).addCache(t).addContext(i)},removeFlow:function(){return this.removeSlot().removeCache().removeContext()},addCache:function(e){return this.cache=e||"",this.caches.push(this.cache),this},removeCache:function(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this},addContext:function(e){return this.context=Object.assign({},this.context,e),this.contexts.push(this.context),this},removeContext:function(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this},addSlot:function(e){return this.slot=e||"",this.slots.push(this.slot),this},removeSlot:function(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this},addVertexCode:function(e){this.addCode(e,"vertex")},addFragmentCode:function(e){this.addCode(e,"fragment")},addCode:function(e,t){this.code[t||this.shader]+=e+"\n"},addVertexNodeCode:function(e){this.addNodeCode(e,"vertex")},addFragmentNodeCode:function(e){this.addNodeCode(e,"fragment")},addNodeCode:function(e,t){this.nodeCode[t||this.shader]+=e+"\n"},clearNodeCode:function(e){e=e||this.shader;var t=this.nodeCode[e];return this.nodeCode[e]="",t},clearVertexNodeCode:function(){return this.clearNodeCode("vertex")},clearFragmentNodeCode:function(){return this.clearNodeCode("fragment")},addVertexFinalCode:function(e){this.addFinalCode(e,"vertex")},addFragmentFinalCode:function(e){this.addFinalCode(e,"fragment")},addFinalCode:function(e,t){this.finalCode[t||this.shader]+=e+"\n"},addVertexParsCode:function(e){this.addParsCode(e,"vertex")},addFragmentParsCode:function(e){this.addParsCode(e,"fragment")},addParsCode:function(e,t){this.parsCode[t||this.shader]+=e+"\n"},addVaryCode:function(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)},isCache:function(e){return-1!==this.caches.indexOf(e)},isSlot:function(e){return-1!==this.slots.indexOf(e)},define:function(e,t){this.defines[e]=void 0===t?1:t},isDefined:function(e){return void 0!==this.defines[e]},getVar:function(e,t,i,r,n,o){void 0===r&&(r="varying"),void 0===n&&(n="V"),void 0===o&&(o="");var a=this.getVars(r),s=a[e];if(!s){var l=a.length;s={name:i||"node"+n+l+(o?"_"+o:""),type:t},a.push(s),a[e]=s}return s},getTempVar:function(e,t,i,r){return this.getVar(e,t,i,this.shader,"T",r)},getAttribute:function(e,t){if(!this.attributes[e]){var i=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(i.name+" = "+e+";"),this.attributes[e]={varying:i,name:e,type:t}}return this.attributes[e]},getCode:function(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join("\n")},getVarListCode:function(e,t){t=t||"";for(var i="",r=0,n=e.length;r<n;++r){var o=e[r],a=o.type,s=o.name,l=this.getFormatByType(a);if(void 0===l)throw new Error("Node pars "+l+" not found.");i+=t+" "+l+" "+s+";\n"}return i},getVars:function(e){return this.inputs.vars[e||this.shader]},getNodeData:function(e){var t=e.isNode?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}},createUniform:function(e,t,i,r,n,o){var a=this.inputs.uniforms,s=a.list.length,l=new NodeUniform({type:t,name:r||"nodeU"+s+(o?"_"+o:""),node:i,needsUpdate:n});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l},createVertexUniform:function(e,t,i,r,n){return this.createUniform("vertex",e,t,i,r,n)},createFragmentUniform:function(e,t,i,r,n){return this.createUniform("fragment",e,t,i,r,n)},include:function(e,t,i){var r;if(e="string"==typeof e?NodeLib.get(e):e,!1===this.context.include)return e.name;e instanceof FunctionNode?r=this.includes.functions:e instanceof ConstNode?r=this.includes.consts:e instanceof StructNode&&(r=this.includes.structs);var n=r[this.shader]=r[this.shader]||[];if(e){var o=n[e.name];if(o||(o=n[e.name]={node:e,deps:[]},n.push(o),o.src=e.build(this,"source")),e instanceof FunctionNode&&t&&n[t.name]&&-1==n[t.name].deps.indexOf(e)&&(n[t.name].deps.push(e),e.includes&&e.includes.length)){var a=0;do{this.include(e.includes[a++],t)}while(a<e.includes.length)}return i&&(o.src=i),e.name}throw new Error("Include not found.")},colorToVectorProperties:function(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")},colorToVector:function(e){return e.replace(/c/g,"v3")},getIncludes:function(e,t){return this.includes[e][t||this.shader]},getIncludesCode:function(){function e(e,t){return e.deps.length-t.deps.length}return function(t,i){if(!(n=this.getIncludes(t,i)))return"";for(var r="",n=n.sort(e),o=0;o<n.length;o++)n[o].src&&(r+=n[o].src+"\n");return r}}(),getConstructorFromLength:function(e){return constructors[e-1]},isTypeMatrix:function(e){return/^m/.test(e)},getTypeLength:function(e){return"f"===e?1:parseInt(this.colorToVector(e).substr(1))},getTypeFromLength:function(e){return 1===e?"f":"v"+e},findNode:function(){for(var e=arguments,t=0;t<arguments.length;t++){var i=e[t];if(void 0!==i&&i.isNode)return i}},resolve:function(){for(var e=arguments,t=0;t<arguments.length;t++){var i=e[t];if(void 0!==i){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case CubeReflectionMapping:case CubeRefractionMapping:return new CubeTextureNode(i);case CubeUVReflectionMapping:case CubeUVRefractionMapping:return new TextureCubeNode(new TextureNode(i));default:return new TextureNode(i)}else{if(i.isVector2)return new Vector2Node(i);if(i.isVector3)return new Vector3Node(i);if(i.isVector4)return new Vector4Node(i)}}}},format:function(e,t,i){switch(this.colorToVector(i+" <- "+t)){case"f <- v2":case"f <- v3":case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e},getTypeByFormat:function(e){return convertFormatToType[e]||e},getFormatByType:function(e){return convertTypeToFormat[e]||e},getUuid:function(e,t){return(t=void 0===t||t)&&this.cache&&(e=this.cache+"-"+e),e},getElementByIndex:function(e){return elements[e]},getIndexByElement:function(e){return elements.indexOf(e)},isShader:function(e){return this.shader===e},setShader:function(e){return this.shader=e,this},mergeDefines:function(e){for(var t in e)this.defines[t]=e[t];return this.defines},mergeUniform:function(e){for(var t in e)this.uniforms[t]=e[t];return this.uniforms},getTextureEncodingFromMap:function(e,t){var i;return t=void 0!==t?t:this.context.gamma&&!!this.renderer&&this.renderer.gammaInput,e?e.isTexture?i=e.encoding:e.isWebGLRenderTarget&&(console.warn("WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=e.texture.encoding):i=LinearEncoding,i===LinearEncoding&&t&&(i=GammaEncoding),i}},NodeFrame.prototype={constructor:NodeFrame,update:function(e){return++this.id,this.time+=e,this.delta=e,this},setRenderer:function(e){return this.renderer=e,this},setRenderTexture:function(e){return this.renderTexture=e,this},updateNode:function(e){return e.frameId===this.id?this:(e.updateFrame(this),e.frameId=this.id,this)}},VarNode.prototype=Object.create(Node$1.prototype),VarNode.prototype.constructor=VarNode,VarNode.prototype.nodeType="Var",VarNode.prototype.getType=function(e){return e.getTypeByFormat(this.type)},VarNode.prototype.generate=function(e,t){var i=e.getVar(this.uuid,this.type);return this.value&&e.isShader("vertex")&&e.addNodeCode(i.name+" = "+this.value.build(e,this.getType(e))+";"),e.format(i.name,this.getType(e),t)},VarNode.prototype.copy=function(e){Node$1.prototype.copy.call(this,e),this.type=e.type,this.value=e.value},VarNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).type=this.type,this.value&&(t.value=this.value.toJSON(e).uuid)),t},BlurNode.Nodes={blurX:new FunctionNode(["vec4 blurX( sampler2D texture, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( texture, vec2( uv.x - 4.0 * s, uv.y ) ) * 0.051;","\tsum += texture2D( texture, vec2( uv.x - 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x - 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x - 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( texture, vec2( uv.x + 1.0 * s, uv.y ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x + 2.0 * s, uv.y ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x + 3.0 * s, uv.y ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x + 4.0 * s, uv.y ) ) * 0.051;","\treturn sum * .667;","}"].join("\n")),blurY:new FunctionNode(["vec4 blurY( sampler2D texture, vec2 uv, float s ) {","\tvec4 sum = vec4( 0.0 );","\tsum += texture2D( texture, vec2( uv.x, uv.y - 4.0 * s ) ) * 0.051;","\tsum += texture2D( texture, vec2( uv.x, uv.y - 3.0 * s ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x, uv.y - 2.0 * s ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x, uv.y - 1.0 * s ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x, uv.y ) ) * 0.1633;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 1.0 * s ) ) * 0.1531;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 2.0 * s ) ) * 0.12245;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 3.0 * s ) ) * 0.0918;","\tsum += texture2D( texture, vec2( uv.x, uv.y + 4.0 * s ) ) * 0.051;","\treturn sum * .667;","}"].join("\n"))},BlurNode.prototype=Object.create(TempNode.prototype),BlurNode.prototype.constructor=BlurNode,BlurNode.prototype.nodeType="Blur",BlurNode.prototype.updateFrame=function(e){if(this.size)this.horizontal.value=this.radius.x/this.size.x,this.vertical.value=this.radius.y/this.size.y;else if(this.value.value&&this.value.value.image){var t=this.value.value.image;this.horizontal.value=this.radius.x/t.width,this.vertical.value=this.radius.y/t.height}},BlurNode.prototype.generate=function(e,t){if(e.isShader("fragment")){var i,r=[],n=e.include(BlurNode.Nodes.blurX),o=e.include(BlurNode.Nodes.blurY);return this.blurX&&r.push(n+"( "+this.value.build(e,"sampler2D")+", "+this.uv.build(e,"v2")+", "+this.horizontal.build(e,"f")+" )"),this.blurY&&r.push(o+"( "+this.value.build(e,"sampler2D")+", "+this.uv.build(e,"v2")+", "+this.vertical.build(e,"f")+" )"),i=2==r.length?"( "+r.join(" + ")+" / 2.0 )":r.length?"( "+r[0]+" )":"vec4( 0.0 )",e.format(i,this.getType(e),t)}return console.warn("BlurNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)},BlurNode.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.value=e.value,this.uv=e.uv,this.radius=e.radius,void 0!==e.size&&(this.size=new Vector2(e.size.x,e.size.y)),this.blurX=e.blurX,this.blurY=e.blurY},BlurNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,t.uv=this.uv.toJSON(e).uuid,t.radius=this.radius.toJSON(e).uuid,this.size&&(t.size={x:this.size.x,y:this.size.y}),t.blurX=this.blurX,t.blurY=this.blurY),t},LuminanceNode.Nodes=(LUMA=new ConstNode("vec3 LUMA vec3( 0.2125, 0.7154, 0.0721 )"),{LUMA:LUMA,luminance:new FunctionNode(["float luminance( vec3 rgb ) {","\treturn dot( rgb, LUMA );","}"].join("\n"),[LUMA])}),LuminanceNode.prototype=Object.create(TempNode.prototype),LuminanceNode.prototype.constructor=LuminanceNode,LuminanceNode.prototype.nodeType="Luminance",LuminanceNode.prototype.generate=function(e,t){var i=e.include(LuminanceNode.Nodes.luminance);return e.format(i+"( "+this.rgb.build(e,"v3")+" )",this.getType(e),t)},LuminanceNode.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.rgb=e.rgb},LuminanceNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).rgb=this.rgb.toJSON(e).uuid),t},ColorAdjustmentNode.Nodes={hue:new FunctionNode(["vec3 hue(vec3 rgb, float adjustment) {","\tconst mat3 RGBtoYIQ = mat3(0.299, 0.587, 0.114, 0.595716, -0.274453, -0.321263, 0.211456, -0.522591, 0.311135);","\tconst mat3 YIQtoRGB = mat3(1.0, 0.9563, 0.6210, 1.0, -0.2721, -0.6474, 1.0, -1.107, 1.7046);","\tvec3 yiq = RGBtoYIQ * rgb;","\tfloat hue = atan(yiq.z, yiq.y) + adjustment;","\tfloat chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);","\treturn YIQtoRGB * vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));","}"].join("\n")),saturation:new FunctionNode(["vec3 saturation(vec3 rgb, float adjustment) {","\tvec3 intensity = vec3( luminance( rgb ) );","\treturn mix( intensity, rgb, adjustment );","}"].join("\n"),[LuminanceNode.Nodes.luminance]),vibrance:new FunctionNode(["vec3 vibrance(vec3 rgb, float adjustment) {","\tfloat average = (rgb.r + rgb.g + rgb.b) / 3.0;","\tfloat mx = max(rgb.r, max(rgb.g, rgb.b));","\tfloat amt = (mx - average) * (-3.0 * adjustment);","\treturn mix(rgb.rgb, vec3(mx), amt);","}"].join("\n"))},ColorAdjustmentNode.SATURATION="saturation",ColorAdjustmentNode.HUE="hue",ColorAdjustmentNode.VIBRANCE="vibrance",ColorAdjustmentNode.BRIGHTNESS="brightness",ColorAdjustmentNode.CONTRAST="contrast",ColorAdjustmentNode.prototype=Object.create(TempNode.prototype),ColorAdjustmentNode.prototype.constructor=ColorAdjustmentNode,ColorAdjustmentNode.prototype.nodeType="ColorAdjustment",ColorAdjustmentNode.prototype.generate=function(e,t){var i=this.rgb.build(e,"v3"),r=this.adjustment.build(e,"f");switch(this.method){case ColorAdjustmentNode.BRIGHTNESS:return e.format("( "+i+" + "+r+" )",this.getType(e),t);case ColorAdjustmentNode.CONTRAST:return e.format("( "+i+" * "+r+" )",this.getType(e),t)}var n=e.include(ColorAdjustmentNode.Nodes[this.method]);return e.format(n+"( "+i+", "+r+" )",this.getType(e),t)},ColorAdjustmentNode.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.rgb=e.rgb,this.adjustment=e.adjustment,this.method=e.method},ColorAdjustmentNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).rgb=this.rgb.toJSON(e).uuid,t.adjustment=this.adjustment.toJSON(e).uuid,t.method=this.method),t},BoolNode.prototype=Object.create(InputNode.prototype),BoolNode.prototype.constructor=BoolNode,BoolNode.prototype.nodeType="Bool",BoolNode.prototype.generateReadonly=function(e,t,i,r,n,o){return e.format(this.value,r,t)},BoolNode.prototype.copy=function(e){InputNode.prototype.copy.call(this,e),this.value=e.value},BoolNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value,!0===this.readonly&&(t.readonly=!0)),t},ColorNode.prototype=Object.create(InputNode.prototype),ColorNode.prototype.constructor=ColorNode,ColorNode.prototype.nodeType="Color",NodeUtils.addShortcuts(ColorNode.prototype,"value",["r","g","b"]),ColorNode.prototype.generateReadonly=function(e,t,i,r,n,o){return e.format("vec3( "+this.r+", "+this.g+", "+this.b+" )",r,t)},ColorNode.prototype.copy=function(e){InputNode.prototype.copy.call(this,e),this.value.copy(e)},ColorNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).r=this.r,t.g=this.g,t.b=this.b,!0===this.readonly&&(t.readonly=!0)),t},IntNode.prototype=Object.create(InputNode.prototype),IntNode.prototype.constructor=IntNode,IntNode.prototype.nodeType="Int",IntNode.prototype.generateReadonly=function(e,t,i,r,n,o){return e.format(this.value,r,t)},IntNode.prototype.copy=function(e){InputNode.prototype.copy.call(this,e),this.value=e.value},IntNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value,!0===this.readonly&&(t.readonly=!0)),t},Matrix3Node.prototype=Object.create(InputNode.prototype),Matrix3Node.prototype.constructor=Matrix3Node,Matrix3Node.prototype.nodeType="Matrix3",Object.defineProperties(Matrix3Node.prototype,{elements:{set:function(e){this.value.elements=e},get:function(){return this.value.elements}}}),Matrix3Node.prototype.generateReadonly=function(e,t,i,r,n,o){return e.format("mat3( "+this.value.elements.join(", ")+" )",r,t)},Matrix3Node.prototype.copy=function(e){InputNode.prototype.copy.call(this,e),this.value.fromArray(e.elements)},Matrix3Node.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).elements=this.value.elements.concat()),t},Matrix4Node.prototype=Object.create(InputNode.prototype),Matrix4Node.prototype.constructor=Matrix4Node,Matrix4Node.prototype.nodeType="Matrix4",Object.defineProperties(Matrix4Node.prototype,{elements:{set:function(e){this.value.elements=e},get:function(){return this.value.elements}}}),Matrix4Node.prototype.generateReadonly=function(e,t,i,r,n,o){return e.format("mat4( "+this.value.elements.join(", ")+" )",r,t)},Matrix4Node.prototype.copy=function(e){InputNode.prototype.copy.call(this,e),this.scope.value.fromArray(e.elements)},Matrix4Node.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).elements=this.value.elements.concat()),t},PropertyNode.prototype=Object.create(InputNode.prototype),PropertyNode.prototype.constructor=PropertyNode,PropertyNode.prototype.nodeType="Property",Object.defineProperties(PropertyNode.prototype,{value:{get:function(){return this.object[this.property]},set:function(e){this.object[this.property]=e}}}),PropertyNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value,t.property=this.property),t},OperatorNode.ADD="+",OperatorNode.SUB="-",OperatorNode.MUL="*",OperatorNode.DIV="/",OperatorNode.prototype=Object.create(TempNode.prototype),OperatorNode.prototype.constructor=OperatorNode,OperatorNode.prototype.nodeType="Operator",OperatorNode.prototype.getType=function(e){var t=this.a.getType(e),i=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(i)>e.getTypeLength(t)?i:t},OperatorNode.prototype.generate=function(e,t){e.getNodeData(this);var i=this.getType(e),r=this.a.build(e,i),n=this.b.build(e,i);return e.format("( "+r+" "+this.op+" "+n+" )",i,t)},OperatorNode.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.a=e.a,this.b=e.b,this.op=e.op},OperatorNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).a=this.a.toJSON(e).uuid,t.b=this.b.toJSON(e).uuid,t.op=this.op),t},ReflectorNode.prototype=Object.create(TempNode.prototype),ReflectorNode.prototype.constructor=ReflectorNode,ReflectorNode.prototype.nodeType="Reflector",ReflectorNode.prototype.setMirror=function(e){this.mirror=e,this.textureMatrix=new Matrix4Node(this.mirror.material.uniforms.textureMatrix.value),this.localPosition=new PositionNode(PositionNode.LOCAL),this.uv=new OperatorNode(this.textureMatrix,this.localPosition,OperatorNode.MUL),this.uvResult=new OperatorNode(null,this.uv,OperatorNode.ADD),this.texture=new TextureNode(this.mirror.material.uniforms.tDiffuse.value,this.uv,null,!0)},ReflectorNode.prototype.generate=function(e,t){return e.isShader("fragment")?(this.uvResult.a=this.offset,this.texture.uv=this.offset?this.uvResult:this.uv,"sampler2D"===t?this.texture.build(e,t):e.format(this.texture.build(e,this.type),this.type,t)):(console.warn("ReflectorNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.type,t))},ReflectorNode.prototype.copy=function(e){InputNode.prototype.copy.call(this,e),this.scope.mirror=e.mirror},ReflectorNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).mirror=this.mirror.uuid,this.offset&&(t.offset=this.offset.toJSON(e).uuid)),t},RawNode.prototype=Object.create(Node$1.prototype),RawNode.prototype.constructor=RawNode,RawNode.prototype.nodeType="Raw",RawNode.prototype.generate=function(e){var t=this.value.parseAndBuildCode(e,this.type),i=t.code+"\n";return e.isShader("vertex")?i+="gl_Position = "+t.result+";":i+="gl_FragColor = "+t.result+";",i},RawNode.prototype.copy=function(e){Node$1.prototype.copy.call(this,e),this.value=e.value},RawNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid),t},NodeMaterial.prototype=Object.create(ShaderMaterial.prototype),NodeMaterial.prototype.constructor=NodeMaterial,NodeMaterial.prototype.type="NodeMaterial",NodeMaterial.prototype.isNodeMaterial=!0,Object.defineProperties(NodeMaterial.prototype,{properties:{get:function(){return this.fragment.properties}}}),NodeMaterial.prototype.updateFrame=function(e){for(var t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])},NodeMaterial.prototype.onBeforeCompile=function(e,t){this.needsUpdate&&(this.build({renderer:t}),e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader)},NodeMaterial.prototype.build=function(e){var t=(e=e||{}).builder||new NodeBuilder;return t.setMaterial(this,e.renderer),t.build(this.vertex,this.fragment),this.vertexShader=t.getCode("vertex"),this.fragmentShader=t.getCode("fragment"),this.defines=t.defines,this.uniforms=t.uniforms,this.extensions=t.extensions,this.updaters=t.updaters,this.fog=t.requires.fog,this.lights=t.requires.lights,this.transparent=t.requires.transparent||this.blending>NormalBlending,this.needsUpdate=!1,this},NodeMaterial.prototype.copy=function(e){var t=this.uuid;for(var i in e)this[i]=e[i];this.uuid=t,void 0!==e.userData&&(this.userData=JSON.parse(JSON.stringify(e.userData)))},NodeMaterial.prototype.toJSON=function(e){if((void 0===e||"string"==typeof e)&&(e={nodes:{}}),e&&!e.materials&&(e.materials={}),!e.materials[this.uuid]){var t={};t.uuid=this.uuid,t.type=this.type,e.materials[t.uuid]=t,""!==this.name&&(t.name=this.name),void 0!==this.size&&(t.size=this.size),void 0!==this.sizeAttenuation&&(t.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(t.blending=this.blending),!0===this.flatShading&&(t.flatShading=this.flatShading),this.side!==FrontSide&&(t.side=this.side),this.vertexColors!==NoColors&&(t.vertexColors=this.vertexColors),this.depthFunc!==LessEqualDepth&&(t.depthFunc=this.depthFunc),!1===this.depthTest&&(t.depthTest=this.depthTest),!1===this.depthWrite&&(t.depthWrite=this.depthWrite),1!==this.linewidth&&(t.linewidth=this.linewidth),void 0!==this.dashSize&&(t.dashSize=this.dashSize),void 0!==this.gapSize&&(t.gapSize=this.gapSize),void 0!==this.scale&&(t.scale=this.scale),!0===this.dithering&&(t.dithering=!0),!0===this.wireframe&&(t.wireframe=this.wireframe),this.wireframeLinewidth>1&&(t.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(t.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(t.wireframeLinejoin=this.wireframeLinejoin),this.alphaTest>0&&(t.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(t.premultipliedAlpha=this.premultipliedAlpha),!0===this.morphTargets&&(t.morphTargets=!0),!0===this.skinning&&(t.skinning=!0),!1===this.visible&&(t.visible=!1),"{}"!==JSON.stringify(this.userData)&&(t.userData=this.userData),t.fog=this.fog,t.lights=this.lights,t.vertex=this.vertex.toJSON(e).uuid,t.fragment=this.fragment.toJSON(e).uuid}return e.material=this.uuid,e},RTTNode.prototype=Object.create(TextureNode.prototype),RTTNode.prototype.constructor=RTTNode,RTTNode.prototype.nodeType="RTT",RTTNode.prototype.build=function(e,t,i){var r=new NodeBuilder;return r.nodes=e.nodes,r.updaters=e.updaters,this.material.fragment.value=this.input,this.material.build({builder:r}),TextureNode.prototype.build.call(this,e,t,i)},RTTNode.prototype.updateFramesaveTo=function(e){if(this.saveTo.render=!1,this.saveTo!==this.saveToCurrent){this.saveToMaterial&&this.saveToMaterial.dispose();var t=new NodeMaterial;t.fragment.value=this,t.build();var i=new Scene,r=new Mesh(new PlaneBufferGeometry(2,2),t);r.frustumCulled=!1,i.add(r),this.saveToScene=i,this.saveToMaterial=t}this.saveToCurrent=this.saveTo,e.renderer.setRenderTarget(this.saveTo.renderTarget),this.saveTo.clear&&e.renderer.clear(),e.renderer.render(this.saveToScene,this.camera)},RTTNode.prototype.updateFrame=function(e){e.renderer?(this.saveTo&&!1===this.saveTo.render&&this.updateFramesaveTo(e),this.render&&(this.material.uniforms.renderTexture&&(this.material.uniforms.renderTexture.value=e.renderTexture),e.renderer.setRenderTarget(this.renderTarget),this.clear&&e.renderer.clear(),e.renderer.render(this.scene,this.camera)),this.saveTo&&!0===this.saveTo.render&&this.updateFramesaveTo(e)):console.warn("RTTNode need a renderer in NodeFrame")},RTTNode.prototype.copy=function(e){TextureNode.prototype.copy.call(this,e),this.saveTo=e.saveTo},RTTNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=TextureNode.prototype.toJSON.call(this,e),this.saveTo&&(t.saveTo=this.saveTo.toJSON(e).uuid)),t},ScreenNode.prototype=Object.create(TextureNode.prototype),ScreenNode.prototype.constructor=ScreenNode,ScreenNode.prototype.nodeType="Screen",ScreenNode.prototype.getUnique=function(){return!0},ScreenNode.prototype.getTexture=function(e,t){return InputNode.prototype.generate.call(this,e,t,this.getUuid(),"t","renderTexture")},StandardNode.prototype=Object.create(Node$1.prototype),StandardNode.prototype.constructor=StandardNode,StandardNode.prototype.nodeType="Standard",StandardNode.prototype.build=function(e){var t;if(e.define(this.clearCoat||this.clearCoatRoughness?"PHYSICAL":"STANDARD"),e.requires.lights=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){var i=this.position?this.position.parseAndBuildCode(e,"v3",{cache:"position"}):void 0;e.mergeUniform(UniformsUtils.merge([UniformsLib.fog,UniformsLib.lights])),e.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));var r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];i&&r.push(i.code,i.result?"transformed = "+i.result+";":""),r.push("#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","#include <fog_vertex>","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),t=r.join("\n")}else{var n={bias:RoughnessToBlinnExponentNode,gamma:!0},o={gamma:!0},a=!e.isDefined("STANDARD");this.mask&&this.mask.parse(e),this.color.parse(e,{slot:"color",context:o}),this.roughness.parse(e),this.metalness.parse(e),this.alpha&&this.alpha.parse(e),this.normal&&this.normal.parse(e),this.clearCoat&&this.clearCoat.parse(e),this.clearCoatRoughness&&this.clearCoatRoughness.parse(e),this.reflectivity&&this.reflectivity.parse(e),this.light&&this.light.parse(e,{cache:"light"}),this.ao&&this.ao.parse(e),this.ambient&&this.ambient.parse(e),this.shadow&&this.shadow.parse(e),this.emissive&&this.emissive.parse(e,{slot:"emissive"}),this.environment&&this.environment.parse(e,{cache:"env",context:n,slot:"environment"});var s=this.mask?this.mask.buildCode(e,"b"):void 0,l=this.color.buildCode(e,"c",{slot:"color",context:o}),u=this.roughness.buildCode(e,"f"),h=this.metalness.buildCode(e,"f"),c=this.alpha?this.alpha.buildCode(e,"f"):void 0,d=this.normal?this.normal.buildCode(e,"v3"):void 0,p=this.clearCoat?this.clearCoat.buildCode(e,"f"):void 0,f=this.clearCoatRoughness?this.clearCoatRoughness.buildCode(e,"f"):void 0,m=this.reflectivity?this.reflectivity.buildCode(e,"f"):void 0,v=this.light?this.light.buildCode(e,"v3",{cache:"light"}):void 0,g=this.ao?this.ao.buildCode(e,"f"):void 0,y=this.ambient?this.ambient.buildCode(e,"c"):void 0,_=this.shadow?this.shadow.buildCode(e,"c"):void 0,b=this.emissive?this.emissive.buildCode(e,"c",{slot:"emissive"}):void 0,x=this.environment?this.environment.buildCode(e,"c",{cache:"env",context:n,slot:"environment"}):void 0,w=a&&x?this.environment.buildCode(e,"c",{cache:"clearCoat",context:n,slot:"environment"}):void 0;e.requires.transparent=void 0!==c,e.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>"].join("\n"));r=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"];s&&r.push(s.code,"if ( ! "+s.result+" ) discard;"),r.push(l.code,"\tvec3 diffuseColor = "+l.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",u.code,"\tfloat roughnessFactor = "+u.result+";",h.code,"\tfloat metalnessFactor = "+h.result+";"),c&&r.push(c.code,"#ifdef ALPHATEST","\tif ( "+c.result+" <= ALPHATEST ) discard;","#endif"),d&&r.push(d.code,"normal = "+d.result+";"),r.push("material.diffuseColor = "+(v?"vec3( 1.0 )":"diffuseColor * (1.0 - metalnessFactor)")+";","material.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );"),p?r.push(p.code,"material.clearCoat = saturate( "+p.result+" );"):a&&r.push("material.clearCoat = 0.0;"),f?r.push(f.code,"material.clearCoatRoughness = clamp( "+f.result+", 0.04, 1.0 );"):a&&r.push("material.clearCoatRoughness = 0.0;"),m?r.push(m.code,"material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( "+m.result+" ) ), diffuseColor, metalnessFactor );"):r.push("material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor, metalnessFactor );"),r.push("#include <lights_fragment_begin>"),v&&(r.push(v.code,"reflectedLight.directDiffuse = "+v.result+";"),r.push("diffuseColor *= 1.0 - metalnessFactor;","reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),g&&r.push(g.code,"reflectedLight.indirectDiffuse *= "+g.result+";","float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );","reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, "+g.result+", material.specularRoughness );"),y&&r.push(y.code,"reflectedLight.indirectDiffuse += "+y.result+";"),_&&r.push(_.code,"reflectedLight.directDiffuse *= "+_.result+";","reflectedLight.directSpecular *= "+_.result+";"),b&&r.push(b.code,"reflectedLight.directDiffuse += "+b.result+";"),x&&(r.push(x.code),w&&r.push(w.code,"clearCoatRadiance += "+w.result+";"),r.push("radiance += "+x.result+";")),r.push("#include <lights_fragment_end>"),r.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),c?r.push("gl_FragColor = vec4( outgoingLight, "+c.result+" );"):r.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),r.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>","#include <premultiplied_alpha_fragment>","#include <dithering_fragment>"),t=r.join("\n")}return t},StandardNode.prototype.copy=function(e){Node$1.prototype.copy.call(this,e),e.position&&(this.position=e.position),this.color=e.color,this.roughness=e.roughness,this.metalness=e.metalness,e.mask&&(this.mask=e.mask),e.alpha&&(this.alpha=e.alpha),e.normal&&(this.normal=e.normal),e.clearCoat&&(this.clearCoat=e.clearCoat),e.clearCoatRoughness&&(this.clearCoatRoughness=e.clearCoatRoughness),e.reflectivity&&(this.reflectivity=e.reflectivity),e.light&&(this.light=e.light),e.shadow&&(this.shadow=e.shadow),e.ao&&(this.ao=e.ao),e.emissive&&(this.emissive=e.emissive),e.ambient&&(this.ambient=e.ambient),e.environment&&(this.environment=e.environment)},StandardNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.position&&(t.position=this.position.toJSON(e).uuid),t.color=this.color.toJSON(e).uuid,t.roughness=this.roughness.toJSON(e).uuid,t.metalness=this.metalness.toJSON(e).uuid,this.mask&&(t.mask=this.mask.toJSON(e).uuid),this.alpha&&(t.alpha=this.alpha.toJSON(e).uuid),this.normal&&(t.normal=this.normal.toJSON(e).uuid),this.clearCoat&&(t.clearCoat=this.clearCoat.toJSON(e).uuid),this.clearCoatRoughness&&(t.clearCoatRoughness=this.clearCoatRoughness.toJSON(e).uuid),this.reflectivity&&(t.reflectivity=this.reflectivity.toJSON(e).uuid),this.light&&(t.light=this.light.toJSON(e).uuid),this.shadow&&(t.shadow=this.shadow.toJSON(e).uuid),this.ao&&(t.ao=this.ao.toJSON(e).uuid),this.emissive&&(t.emissive=this.emissive.toJSON(e).uuid),this.ambient&&(t.ambient=this.ambient.toJSON(e).uuid),this.environment&&(t.environment=this.environment.toJSON(e).uuid)),t},SwitchNode.prototype=Object.create(Node$1.prototype),SwitchNode.prototype.constructor=SwitchNode,SwitchNode.prototype.nodeType="Switch",SwitchNode.prototype.getType=function(e){return e.getTypeFromLength(this.components.length)},SwitchNode.prototype.generate=function(e,t){var i=this.node.getType(e),r=this.node.build(e,i),n=e.getTypeLength(i)-1;if(n>0){var o,a=0,s=e.colorToVectorProperties(this.components),l=s.length;for(o=0;o<l;o++)a=Math.max(a,e.getIndexByElement(s.charAt(o)));for(a>n&&(a=n),r+=".",o=0;o<l;o++){s.charAt(o);var u=e.getIndexByElement(s.charAt(o));u>a&&(u=a),r+=e.getElementByIndex(u)}return e.format(r,this.getType(e),t)}return e.format(r,i,t)},SwitchNode.prototype.copy=function(e){Node$1.prototype.copy.call(this,e),this.node=e.node,this.components=e.components},SwitchNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).node=this.node.toJSON(e).uuid,t.components=this.components),t},NormalMapNode.Nodes={perturbNormal2Arb:new FunctionNode(["vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 map, vec2 mUv, vec2 normalScale ) {","\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );","\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );","\tvec2 st0 = dFdx( mUv.st );","\tvec2 st1 = dFdy( mUv.st );","\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );","\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );","\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );","\tvec3 N = normalize( surf_norm );","\tmat3 tsn = mat3( S, T, N );","\tvec3 mapN = map * 2.0 - 1.0;","\tmapN.xy *= normalScale;","\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );","\treturn normalize( tsn * mapN );","}"].join("\n"),null,{derivatives:!0})},NormalMapNode.prototype=Object.create(TempNode.prototype),NormalMapNode.prototype.constructor=NormalMapNode,NormalMapNode.prototype.nodeType="NormalMap",NormalMapNode.prototype.generate=function(e,t){if(e.isShader("fragment")){var i=e.include(NormalMapNode.Nodes.perturbNormal2Arb);return this.normal=this.normal||new NormalNode$1,this.position=this.position||new PositionNode(PositionNode.VIEW),this.uv=this.uv||new UVNode,e.format(i+"( -"+this.position.build(e,"v3")+", "+this.normal.build(e,"v3")+", "+this.value.build(e,"v3")+", "+this.uv.build(e,"v2")+", "+this.scale.build(e,"v2")+" )",this.getType(e),t)}return console.warn("NormalMapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)},NormalMapNode.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.value=e.value,this.scale=e.scale},NormalMapNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,t.scale=this.scale.toJSON(e).uuid),t},MeshStandardNode.prototype=Object.create(StandardNode.prototype),MeshStandardNode.prototype.constructor=MeshStandardNode,MeshStandardNode.prototype.nodeType="MeshStandard",MeshStandardNode.prototype.build=function(e){var t=this.properties,i=this.inputs;if(e.isShader("fragment")){var r=e.findNode(t.color,i.color),n=e.resolve(t.map);this.color=n?new OperatorNode(r,n,OperatorNode.MUL):r;var o=e.findNode(t.roughness,i.roughness),a=e.resolve(t.roughnessMap);this.roughness=a?new OperatorNode(o,new SwitchNode(a,"g"),OperatorNode.MUL):o;var s=e.findNode(t.metalness,i.metalness),l=e.resolve(t.metalnessMap);this.metalness=l?new OperatorNode(s,new SwitchNode(l,"b"),OperatorNode.MUL):s,t.normalMap?(this.normal=new NormalMapNode(e.resolve(t.normalMap)),this.normal.scale=e.findNode(t.normalScale,i.normalScale)):this.normal=void 0,this.environment=e.resolve(t.envMap)}return StandardNode.prototype.build.call(this,e)},MeshStandardNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),console.warn(".toJSON not implemented in",this)),t},MeshStandardNodeMaterial.prototype=Object.create(NodeMaterial.prototype),MeshStandardNodeMaterial.prototype.constructor=MeshStandardNodeMaterial,NodeUtils.addShortcuts(MeshStandardNodeMaterial.prototype,"properties",["color","roughness","metalness","map","normalMap","normalScale","metalnessMap","roughnessMap","envMap"]),PhongNode.prototype=Object.create(Node$1.prototype),PhongNode.prototype.constructor=PhongNode,PhongNode.prototype.nodeType="Phong",PhongNode.prototype.build=function(e){var t;if(e.define("PHONG"),e.requires.lights=!0,e.isShader("vertex")){var i=this.position?this.position.parseAndBuildCode(e,"v3",{cache:"position"}):void 0;e.mergeUniform(UniformsUtils.merge([UniformsLib.fog,UniformsLib.lights])),e.addParsCode(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));var r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif","#include <begin_vertex>"];i&&r.push(i.code,i.result?"transformed = "+i.result+";":""),r.push("\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <logdepthbuf_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),t=r.join("\n")}else{this.mask&&this.mask.parse(e),this.color.parse(e,{slot:"color"}),this.specular.parse(e),this.shininess.parse(e),this.alpha&&this.alpha.parse(e),this.normal&&this.normal.parse(e),this.light&&this.light.parse(e,{cache:"light"}),this.ao&&this.ao.parse(e),this.ambient&&this.ambient.parse(e),this.shadow&&this.shadow.parse(e),this.emissive&&this.emissive.parse(e,{slot:"emissive"}),this.environment&&this.environment.parse(e,{slot:"environment"}),this.environmentAlpha&&this.environment&&this.environmentAlpha.parse(e);var n=this.mask?this.mask.buildCode(e,"b"):void 0,o=this.color.buildCode(e,"c",{slot:"color"}),a=this.specular.buildCode(e,"c"),s=this.shininess.buildCode(e,"f"),l=this.alpha?this.alpha.buildCode(e,"f"):void 0,u=this.normal?this.normal.buildCode(e,"v3"):void 0,h=this.light?this.light.buildCode(e,"v3",{cache:"light"}):void 0,c=this.ao?this.ao.buildCode(e,"f"):void 0,d=this.ambient?this.ambient.buildCode(e,"c"):void 0,p=this.shadow?this.shadow.buildCode(e,"c"):void 0,f=this.emissive?this.emissive.buildCode(e,"c",{slot:"emissive"}):void 0,m=this.environment?this.environment.buildCode(e,"c",{slot:"environment"}):void 0,v=this.environmentAlpha&&this.environment?this.environmentAlpha.buildCode(e,"f"):void 0;e.requires.transparent=null!=l,e.addParsCode(["#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <logdepthbuf_pars_fragment>"].join("\n"));r=["#include <normal_fragment_begin>","\tBlinnPhongMaterial material;"];n&&r.push(n.code,"if ( ! "+n.result+" ) discard;"),r.push(o.code,"\tvec3 diffuseColor = "+o.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","#include <logdepthbuf_fragment>",a.code,"\tvec3 specular = "+a.result+";",s.code,"\tfloat shininess = max( 0.0001, "+s.result+" );","\tfloat specularStrength = 1.0;"),l&&r.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),u&&r.push(u.code,"normal = "+u.result+";"),r.push("material.diffuseColor = "+(h?"vec3( 1.0 )":"diffuseColor")+";"),r.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h&&(r.push(h.code,"reflectedLight.directDiffuse = "+h.result+";"),r.push("reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),c&&r.push(c.code,"reflectedLight.indirectDiffuse *= "+c.result+";"),d&&r.push(d.code,"reflectedLight.indirectDiffuse += "+d.result+";"),p&&r.push(p.code,"reflectedLight.directDiffuse *= "+p.result+";","reflectedLight.directSpecular *= "+p.result+";"),f&&r.push(f.code,"reflectedLight.directDiffuse += "+f.result+";"),r.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),m&&(r.push(m.code),v?r.push(v.code,"outgoingLight = mix( outgoingLight, "+m.result+", "+v.result+" );"):r.push("outgoingLight = "+m.result+";")),l?r.push("gl_FragColor = vec4( outgoingLight, "+l.result+" );"):r.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),r.push("#include <premultiplied_alpha_fragment>","#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>"),t=r.join("\n")}return t},PhongNode.prototype.copy=function(e){Node$1.prototype.copy.call(this,e),e.position&&(this.position=e.position),this.color=e.color,this.specular=e.specular,this.shininess=e.shininess,e.mask&&(this.mask=e.mask),e.alpha&&(this.alpha=e.alpha),e.normal&&(this.normal=e.normal),e.light&&(this.light=e.light),e.shadow&&(this.shadow=e.shadow),e.ao&&(this.ao=e.ao),e.emissive&&(this.emissive=e.emissive),e.ambient&&(this.ambient=e.ambient),e.environment&&(this.environment=e.environment),e.environmentAlpha&&(this.environmentAlpha=e.environmentAlpha)},PhongNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.position&&(t.position=this.position.toJSON(e).uuid),t.color=this.color.toJSON(e).uuid,t.specular=this.specular.toJSON(e).uuid,t.shininess=this.shininess.toJSON(e).uuid,this.mask&&(t.mask=this.mask.toJSON(e).uuid),this.alpha&&(t.alpha=this.alpha.toJSON(e).uuid),this.normal&&(t.normal=this.normal.toJSON(e).uuid),this.light&&(t.light=this.light.toJSON(e).uuid),this.ao&&(t.ao=this.ao.toJSON(e).uuid),this.ambient&&(t.ambient=this.ambient.toJSON(e).uuid),this.shadow&&(t.shadow=this.shadow.toJSON(e).uuid),this.emissive&&(t.emissive=this.emissive.toJSON(e).uuid),this.environment&&(t.environment=this.environment.toJSON(e).uuid),this.environmentAlpha&&(t.environmentAlpha=this.environmentAlpha.toJSON(e).uuid)),t},SpriteNode.prototype=Object.create(Node$1.prototype),SpriteNode.prototype.constructor=SpriteNode,SpriteNode.prototype.nodeType="Sprite",SpriteNode.prototype.build=function(e){if(e.define("SPRITE"),e.requires.lights=!1,e.requires.transparent=void 0!==this.alpha,e.isShader("vertex")){var t=this.position?this.position.parseAndBuildCode(e,"v3",{cache:"position"}):void 0;e.mergeUniform(UniformsUtils.merge([UniformsLib.fog])),e.addParsCode(["#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n")),o=["#include <clipping_planes_fragment>","#include <begin_vertex>"],t&&o.push(t.code,t.result?"transformed = "+t.result+";":""),o.push("#include <project_vertex>","#include <fog_vertex>","mat4 modelViewMtx = modelViewMatrix;","mat4 modelMtx = modelMatrix;","modelMtx[3][0] = 0.0;","modelMtx[3][1] = 0.0;","modelMtx[3][2] = 0.0;"),this.spherical||o.push("modelMtx[1][1] = 1.0;"),o.push("modelViewMtx[0][0] = 1.0;","modelViewMtx[0][1] = 0.0;","modelViewMtx[0][2] = 0.0;"),this.spherical&&o.push("modelViewMtx[1][0] = 0.0;","modelViewMtx[1][1] = 1.0;","modelViewMtx[1][2] = 0.0;"),o.push("modelViewMtx[2][0] = 0.0;","modelViewMtx[2][1] = 0.0;","modelViewMtx[2][2] = 1.0;","gl_Position = projectionMatrix * modelViewMtx * modelMtx * vec4( transformed, 1.0 );","#include <logdepthbuf_vertex>","#include <clipping_planes_vertex>","#include <fog_vertex>")}else{e.addParsCode(["#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>"].join("\n")),e.addCode(["#include <clipping_planes_fragment>","#include <logdepthbuf_fragment>"].join("\n")),this.mask&&this.mask.parse(e),this.alpha&&this.alpha.parse(e),this.color.parse(e,{slot:"color"});var i=this.mask?this.mask.buildCode(e,"b"):void 0,r=this.alpha?this.alpha.buildCode(e,"f"):void 0,n=this.color.buildCode(e,"c",{slot:"color"}),o=[];i&&o.push(i.code,"if ( ! "+i.result+" ) discard;"),r?o.push(r.code,"#ifdef ALPHATEST","if ( "+r.result+" <= ALPHATEST ) discard;","#endif",n.code,"gl_FragColor = vec4( "+n.result+", "+r.result+" );"):o.push(n.code,"gl_FragColor = vec4( "+n.result+", 1.0 );"),o.push("#include <tonemapping_fragment>","#include <encodings_fragment>","#include <fog_fragment>")}return o.join("\n")},SpriteNode.prototype.copy=function(e){Node$1.prototype.copy.call(this,e),e.position&&(this.position=e.position),this.color=e.color,void 0!==e.spherical&&(this.spherical=e.spherical),e.mask&&(this.mask=e.mask),e.alpha&&(this.alpha=e.alpha)},SpriteNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.position&&(t.position=this.position.toJSON(e).uuid),t.color=this.color.toJSON(e).uuid,!1===this.spherical&&(t.spherical=!1),this.mask&&(t.mask=this.mask.toJSON(e).uuid),this.alpha&&(t.alpha=this.alpha.toJSON(e).uuid)),t},PhongNodeMaterial.prototype=Object.create(NodeMaterial.prototype),PhongNodeMaterial.prototype.constructor=PhongNodeMaterial,NodeUtils.addShortcuts(PhongNodeMaterial.prototype,"fragment",["color","alpha","specular","shininess","normal","emissive","ambient","light","shadow","ao","environment","environmentAlpha","mask","position"]),SpriteNodeMaterial.prototype=Object.create(NodeMaterial.prototype),SpriteNodeMaterial.prototype.constructor=SpriteNodeMaterial,NodeUtils.addShortcuts(SpriteNodeMaterial.prototype,"fragment",["color","alpha","mask","position","spherical"]),StandardNodeMaterial.prototype=Object.create(NodeMaterial.prototype),StandardNodeMaterial.prototype.constructor=StandardNodeMaterial,NodeUtils.addShortcuts(StandardNodeMaterial.prototype,"fragment",["color","alpha","roughness","metalness","reflectivity","clearCoat","clearCoatRoughness","normal","emissive","ambient","light","shadow","ao","environment","mask","position"]),CondNode.EQUAL="==",CondNode.NOT_EQUAL="!=",CondNode.GREATER=">",CondNode.GREATER_EQUAL=">=",CondNode.LESS="<",CondNode.LESS_EQUAL="<=",CondNode.prototype=Object.create(TempNode.prototype),CondNode.prototype.constructor=CondNode,CondNode.prototype.nodeType="Cond",CondNode.prototype.getType=function(e){if(this.ifNode){var t=this.ifNode.getType(e),i=this.elseNode.getType(e);return e.getTypeLength(i)>e.getTypeLength(t)?i:t}return"b"},CondNode.prototype.getCondType=function(e){return e.getTypeLength(this.b.getType(e))>e.getTypeLength(this.a.getType(e))?this.b.getType(e):this.a.getType(e)},CondNode.prototype.generate=function(e,t){var i,r=this.getType(e),n=this.getCondType(e),o=this.a.build(e,n),a=this.b.build(e,n);if(this.ifNode){var s=this.ifNode.build(e,r),l=this.elseNode.build(e,r);i="( "+[o,this.op,a,"?",s,":",l].join(" ")+" )"}else i="( "+o+" "+this.op+" "+a+" )";return e.format(i,this.getType(e),t)},CondNode.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.a=e.a,this.b=e.b,this.op=e.op,this.ifNode=e.ifNode,this.elseNode=e.elseNode},CondNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).a=this.a.toJSON(e).uuid,t.b=this.b.toJSON(e).uuid,t.op=this.op,t.ifNode&&(t.ifNode=this.ifNode.toJSON(e).uuid),t.elseNode&&(t.elseNode=this.elseNode.toJSON(e).uuid)),t},Math1Node.RAD="radians",Math1Node.DEG="degrees",Math1Node.EXP="exp",Math1Node.EXP2="exp2",Math1Node.LOG="log",Math1Node.LOG2="log2",Math1Node.SQRT="sqrt",Math1Node.INV_SQRT="inversesqrt",Math1Node.FLOOR="floor",Math1Node.CEIL="ceil",Math1Node.NORMALIZE="normalize",Math1Node.FRACT="fract",Math1Node.SATURATE="saturate",Math1Node.SIN="sin",Math1Node.COS="cos",Math1Node.TAN="tan",Math1Node.ASIN="asin",Math1Node.ACOS="acos",Math1Node.ARCTAN="atan",Math1Node.ABS="abs",Math1Node.SIGN="sign",Math1Node.LENGTH="length",Math1Node.NEGATE="negate",Math1Node.INVERT="invert",Math1Node.prototype=Object.create(TempNode.prototype),Math1Node.prototype.constructor=Math1Node,Math1Node.prototype.nodeType="Math1",Math1Node.prototype.getType=function(e){switch(this.method){case Math1Node.LENGTH:return"f"}return this.a.getType(e)},Math1Node.prototype.generate=function(e,t){var i=this.getType(e),r=this.a.build(e,i);switch(this.method){case Math1Node.NEGATE:r="( -"+r+" )";break;case Math1Node.INVERT:r="( 1.0 - "+r+" )";break;default:r=this.method+"( "+r+" )"}return e.format(r,i,t)},Math1Node.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.a=e.a,this.method=e.method},Math1Node.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).a=this.a.toJSON(e).uuid,t.method=this.method),t},Math2Node.MIN="min",Math2Node.MAX="max",Math2Node.MOD="mod",Math2Node.STEP="step",Math2Node.REFLECT="reflect",Math2Node.DISTANCE="distance",Math2Node.DOT="dot",Math2Node.CROSS="cross",Math2Node.POW="pow",Math2Node.prototype=Object.create(TempNode.prototype),Math2Node.prototype.constructor=Math2Node,Math2Node.prototype.nodeType="Math2",Math2Node.prototype.getInputType=function(e){return e.getTypeLength(this.b.getType(e))>e.getTypeLength(this.a.getType(e))?this.b.getType(e):this.a.getType(e)},Math2Node.prototype.getType=function(e){switch(this.method){case Math2Node.DISTANCE:case Math2Node.DOT:return"f";case Math2Node.CROSS:return"v3"}return this.getInputType(e)},Math2Node.prototype.generate=function(e,t){var i,r,n=this.getInputType(e),o=e.getTypeLength(this.a.getType(e)),a=e.getTypeLength(this.b.getType(e));switch(this.method){case Math2Node.CROSS:i=this.a.build(e,"v3"),r=this.b.build(e,"v3");break;case Math2Node.STEP:i=this.a.build(e,1===o?"f":n),r=this.b.build(e,n);break;case Math2Node.MIN:case Math2Node.MAX:case Math2Node.MOD:i=this.a.build(e,n),r=this.b.build(e,1===a?"f":n);break;default:i=this.a.build(e,n),r=this.b.build(e,n)}return e.format(this.method+"( "+i+", "+r+" )",this.getType(e),t)},Math2Node.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.a=e.a,this.b=e.b,this.method=e.method},Math2Node.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).a=this.a.toJSON(e).uuid,t.b=this.b.toJSON(e).uuid,t.method=this.method),t},Math3Node.MIX="mix",Math3Node.CLAMP="clamp",Math3Node.REFRACT="refract",Math3Node.SMOOTHSTEP="smoothstep",Math3Node.FACEFORWARD="faceforward",Math3Node.prototype=Object.create(TempNode.prototype),Math3Node.prototype.constructor=Math3Node,Math3Node.prototype.nodeType="Math3",Math3Node.prototype.getType=function(e){var t=e.getTypeLength(this.a.getType(e)),i=e.getTypeLength(this.b.getType(e)),r=e.getTypeLength(this.c.getType(e));return t>i&&t>r?this.a.getType(e):i>r?this.b.getType(e):this.c.getType(e)},Math3Node.prototype.generate=function(e,t){e.getTypeLength(this.a.getType(e)),e.getTypeLength(this.b.getType(e));var i,r,n,o=e.getTypeLength(this.c.getType(e)),a=this.getType(e);switch(this.method){case Math3Node.REFRACT:i=this.a.build(e,a),r=this.b.build(e,a),n=this.c.build(e,"f");break;case Math3Node.MIX:i=this.a.build(e,a),r=this.b.build(e,a),n=this.c.build(e,1===o?"f":a);break;default:i=this.a.build(e,a),r=this.b.build(e,a),n=this.c.build(e,a)}return e.format(this.method+"( "+i+", "+r+", "+n+" )",a,t)},Math3Node.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.a=e.a,this.b=e.b,this.c=e.c,this.method=e.method},Math3Node.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).a=this.a.toJSON(e).uuid,t.b=this.b.toJSON(e).uuid,t.c=this.c.toJSON(e).uuid,t.method=this.method),t},BumpMapNode.Nodes=(dHdxy_fwd=new FunctionNode(["vec2 dHdxy_fwd( sampler2D bumpMap, vec2 vUv, float bumpScale ) {","\tvec2 dSTdx = dFdx( vUv );","\tvec2 dSTdy = dFdy( vUv );","\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;","\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","\treturn vec2( dBx, dBy );","}"].join("\n"),null,{derivatives:!0}),{dHdxy_fwd:dHdxy_fwd,perturbNormalArb:new FunctionNode(["vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );","\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );","\tvec3 vN = surf_norm;","\tvec3 R1 = cross( vSigmaY, vN );","\tvec3 R2 = cross( vN, vSigmaX );","\tfloat fDet = dot( vSigmaX, R1 );","\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );","\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","\treturn normalize( abs( fDet ) * surf_norm - vGrad );","}"].join("\n"),[dHdxy_fwd],{derivatives:!0}),bumpToNormal:new FunctionNode(["vec3 bumpToNormal( sampler2D bumpMap, vec2 uv, float scale ) {","\tvec2 dSTdx = dFdx( uv );","\tvec2 dSTdy = dFdy( uv );","\tfloat Hll = texture2D( bumpMap, uv ).x;","\tfloat dBx = texture2D( bumpMap, uv + dSTdx ).x - Hll;","\tfloat dBy = texture2D( bumpMap, uv + dSTdy ).x - Hll;","\treturn vec3( .5 - ( dBx * scale ), .5 - ( dBy * scale ), 1.0 );","}"].join("\n"),null,{derivatives:!0})}),BumpMapNode.prototype=Object.create(TempNode.prototype),BumpMapNode.prototype.constructor=BumpMapNode,BumpMapNode.prototype.nodeType="BumpMap",BumpMapNode.prototype.generate=function(e,t){if(e.isShader("fragment")){if(this.toNormalMap){var i=e.include(BumpMapNode.Nodes.bumpToNormal);return e.format(i+"( "+this.value.build(e,"sampler2D")+", "+this.value.uv.build(e,"v2")+", "+this.scale.build(e,"f")+" )",this.getType(e),t)}var r=e.include(BumpMapNode.Nodes.dHdxy_fwd),n=e.include(BumpMapNode.Nodes.perturbNormalArb);this.normal=this.normal||new NormalNode$1,this.position=this.position||new PositionNode(PositionNode.VIEW);var o=r+"( "+this.value.build(e,"sampler2D")+", "+this.value.uv.build(e,"v2")+", "+this.scale.build(e,"f")+" )";return e.format(n+"( -"+this.position.build(e,"v3")+", "+this.normal.build(e,"v3")+", "+o+" )",this.getType(e),t)}return console.warn("BumpMapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)},BumpMapNode.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.value=e.value,this.scale=e.scale},BumpMapNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).value=this.value.toJSON(e).uuid,t.scale=this.scale.toJSON(e).uuid),t};var Pass=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(Pass.prototype,{setSize:function(e,t){},render:function(e,t,i,r,n){console.error("Pass: .render() must be implemented in derived pass.")}});var ShaderPass=function(e,t){Pass.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=UniformsUtils.clone(e.uniforms),this.material=new ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.camera=new OrthographicCamera(-1,1,1,-1,0,1),this.scene=new Scene,this.quad=new Mesh(new PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};function NodePass(){ShaderPass.call(this),this.name="",this.uuid=_Math.generateUUID(),this.userData={},this.textureID="renderTexture",this.input=new ScreenNode,this.material=new NodeMaterial,this.needsUpdate=!0}function NodePostProcessing(e,t){if(void 0===t){var i={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,stencilBuffer:!1},r=e.getDrawingBufferSize(new Vector2);t=new WebGLRenderTarget(r.width,r.height,i)}this.renderer=e,this.renderTarget=t,this.output=new ScreenNode,this.material=new NodeMaterial,this.camera=new OrthographicCamera(-1,1,1,-1,0,1),this.scene=new Scene,this.quad=new Mesh(new PlaneBufferGeometry(2,2),this.material),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.needsUpdate=!0}function CheckerNode(e){TempNode.call(this,"f"),this.uv=e||new UVNode}function NoiseNode(e){TempNode.call(this,"f"),this.uv=e||new UVNode}function BypassNode(e,t){Node$1.call(this),this.code=e,this.value=t}ShaderPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:ShaderPass,render:function(e,t,i,r,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.quad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),e.render(this.scene,this.camera)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera))}}),NodePass.prototype=Object.create(ShaderPass.prototype),NodePass.prototype.constructor=NodePass,NodePass.prototype.render=function(){this.needsUpdate&&(this.material.dispose(),this.material.fragment.value=this.input,this.needsUpdate=!1),this.uniforms=this.material.uniforms,ShaderPass.prototype.render.apply(this,arguments)},NodePass.prototype.copy=function(e){this.input=e.input},NodePass.prototype.toJSON=function(e){if((void 0===e||"string"==typeof e)&&(e={nodes:{}}),e&&!e.passes&&(e.passes={}),!e.passes[this.uuid]){var t={};t.uuid=this.uuid,t.type="NodePass",e.passes[this.uuid]=t,""!==this.name&&(t.name=this.name),"{}"!==JSON.stringify(this.userData)&&(t.userData=this.userData),t.input=this.input.toJSON(e).uuid}return e.pass=this.uuid,e},NodePostProcessing.prototype={constructor:NodePostProcessing,render:function(e,t,i){this.needsUpdate&&(this.material.dispose(),this.material.fragment.value=this.output,this.material.build(),this.material.uniforms.renderTexture&&(this.material.uniforms.renderTexture.value=this.renderTarget.texture),this.needsUpdate=!1),i.setRenderer(this.renderer).setRenderTexture(this.renderTarget.texture),this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(e,t),i.updateNode(this.material),this.renderer.setRenderTarget(null),this.renderer.render(this.scene,this.camera)},setSize:function(e,t){this.renderTarget.setSize(e,t),this.renderer.setSize(e,t)},copy:function(e){this.output=e.output},toJSON:function(e){if((void 0===e||"string"==typeof e)&&(e={nodes:{}}),e&&!e.post&&(e.post={}),!e.post[this.uuid]){var t={};t.uuid=this.uuid,t.type="NodePostProcessing",e.post[this.uuid]=t,""!==this.name&&(t.name=this.name),"{}"!==JSON.stringify(this.userData)&&(t.userData=this.userData),t.output=this.output.toJSON(e).uuid}return e.post=this.uuid,e}},CheckerNode.prototype=Object.create(TempNode.prototype),CheckerNode.prototype.constructor=CheckerNode,CheckerNode.prototype.nodeType="Noise",CheckerNode.Nodes={checker:new FunctionNode(["float checker( vec2 uv ) {","\tfloat cx = floor( uv.x );","\tfloat cy = floor( uv.y ); ","\tfloat result = mod( cx + cy, 2.0 );","\treturn sign( result );","}"].join("\n"))},CheckerNode.prototype.generate=function(e,t){var i=e.include(CheckerNode.Nodes.checker);return e.format(i+"( "+this.uv.build(e,"v2")+" )",this.getType(e),t)},CheckerNode.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.uv=e.uv},CheckerNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).uv=this.uv.toJSON(e).uuid),t},NoiseNode.prototype=Object.create(TempNode.prototype),NoiseNode.prototype.constructor=NoiseNode,NoiseNode.prototype.nodeType="Noise",NoiseNode.Nodes={snoise:new FunctionNode(["float snoise(vec2 co) {","\treturn fract( sin( dot( co.xy, vec2( 12.9898, 78.233 ) ) ) * 43758.5453 );","}"].join("\n"))},NoiseNode.prototype.generate=function(e,t){var i=e.include(NoiseNode.Nodes.snoise);return e.format(i+"( "+this.uv.build(e,"v2")+" )",this.getType(e),t)},NoiseNode.prototype.copy=function(e){TempNode.prototype.copy.call(this,e),this.uv=e.uv},NoiseNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).uv=this.uv.toJSON(e).uuid),t},BypassNode.prototype=Object.create(Node$1.prototype),BypassNode.prototype.constructor=BypassNode,BypassNode.prototype.nodeType="Bypass",BypassNode.prototype.getType=function(e){return this.value?this.value.getType(e):e.isShader("fragment")?"f":"void"},BypassNode.prototype.generate=function(e,t){var i=this.code.build(e,t)+";";return e.addNodeCode(i),e.isShader("vertex")?this.value?this.value.build(e,t):void 0:this.value?this.value.build(e,t):e.format("0.0","f",t)},BypassNode.prototype.copy=function(e){Node$1.prototype.copy.call(this,e),this.code=e.code,this.value=e.value},BypassNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).code=this.code.toJSON(e).uuid,this.value&&(t.value=this.value.toJSON(e).uuid)),t};var inputs=NodeUtils.elements;function JoinNode(e,t,i,r){TempNode.call(this,"f"),this.x=e,this.y=t,this.z=i,this.w=r}function TimerNode(e,t,i){FloatNode.call(this),this.scale=void 0!==e?e:1,this.scope=t||TimerNode.GLOBAL,this.timeScale=void 0!==i?i:void 0!==e}function UVTransformNode(e,t){ExpressionNode.call(this,"( uvTransform * vec3( uvNode, 1 ) ).xy","vec2"),this.uv=e||new UVNode,this.position=t||new Matrix3Node}function VelocityNode(e,t){Vector3Node.call(this),this.params={},this.velocity=new Vector3,this.setTarget(e),this.setParams(t)}function Clock(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}JoinNode.prototype=Object.create(TempNode.prototype),JoinNode.prototype.constructor=JoinNode,JoinNode.prototype.nodeType="Join",JoinNode.prototype.getNumElements=function(){for(var e=inputs.length;e--;)if(void 0!==this[inputs[e]]){++e;break}return Math.max(e,2)},JoinNode.prototype.getType=function(e){return e.getTypeFromLength(this.getNumElements())},JoinNode.prototype.generate=function(e,t){for(var i=this.getType(e),r=this.getNumElements(),n=[],o=0;o<r;o++){var a=this[inputs[o]];n.push(a?a.build(e,"f"):"0.0")}var s=(r>1?e.getConstructorFromLength(r):"")+"( "+n.join(", ")+" )";return e.format(s,i,t)},JoinNode.prototype.copy=function(e){for(var t in TempNode.prototype.copy.call(this,e),e.inputs)this[t]=e.inputs[t]},JoinNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t){(t=this.createJSONNode(e)).inputs={};for(var i=this.getNumElements(),r=0;r<i;r++){var n=this[inputs[r]];n&&(t.inputs[inputs[r]]=n.toJSON(e).uuid)}}return t},TimerNode.GLOBAL="global",TimerNode.LOCAL="local",TimerNode.DELTA="delta",TimerNode.prototype=Object.create(FloatNode.prototype),TimerNode.prototype.constructor=TimerNode,TimerNode.prototype.nodeType="Timer",TimerNode.prototype.getReadonly=function(){return!1},TimerNode.prototype.getUnique=function(){return this.timeScale&&(this.scope===TimerNode.GLOBAL||this.scope===TimerNode.DELTA)},TimerNode.prototype.updateFrame=function(e){var t=this.timeScale?this.scale:1;switch(this.scope){case TimerNode.LOCAL:this.value+=e.delta*t;break;case TimerNode.DELTA:this.value=e.delta*t;break;default:this.value=e.time*t}},TimerNode.prototype.copy=function(e){FloatNode.prototype.copy.call(this,e),this.scope=e.scope,this.scale=e.scale,this.timeScale=e.timeScale},TimerNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).scope=this.scope,t.scale=this.scale,t.timeScale=this.timeScale),t},NodeLib.addKeyword("time",function(){return new TimerNode}),UVTransformNode.prototype=Object.create(ExpressionNode.prototype),UVTransformNode.prototype.constructor=UVTransformNode,UVTransformNode.prototype.nodeType="UVTransform",UVTransformNode.prototype.generate=function(e,t){return this.keywords.uvNode=this.uv,this.keywords.uvTransform=this.position,ExpressionNode.prototype.generate.call(this,e,t)},UVTransformNode.prototype.setUvTransform=function(e,t,i,r,n,o,a){o=void 0!==o?o:.5,a=void 0!==a?a:.5,this.position.value.setUvTransform(e,t,i,r,n,o,a)},UVTransformNode.prototype.copy=function(e){ExpressionNode.prototype.copy.call(this,e),this.uv=e.uv,this.position=e.position},UVTransformNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||((t=this.createJSONNode(e)).uv=this.uv.toJSON(e).uuid,t.position=this.position.toJSON(e).uuid),t},VelocityNode.prototype=Object.create(Vector3Node.prototype),VelocityNode.prototype.constructor=VelocityNode,VelocityNode.prototype.nodeType="Velocity",VelocityNode.prototype.getReadonly=function(e){return!1},VelocityNode.prototype.setParams=function(e){switch(this.params.type){case"elastic":delete this.moment,delete this.speed,delete this.springVelocity,delete this.lastVelocity}switch(this.params=e||{},this.params.type){case"elastic":this.moment=new Vector3,this.speed=new Vector3,this.springVelocity=new Vector3,this.lastVelocity=new Vector3}},VelocityNode.prototype.setTarget=function(e){this.target&&(delete this.position,delete this.oldPosition),this.target=e,e&&(this.position=e.getWorldPosition(this.position||new Vector3),this.oldPosition=this.position.clone())},VelocityNode.prototype.updateFrameVelocity=function(e){this.target&&(this.position=this.target.getWorldPosition(this.position||new Vector3),this.velocity.subVectors(this.position,this.oldPosition),this.oldPosition.copy(this.position))},VelocityNode.prototype.updateFrame=function(e){switch(this.updateFrameVelocity(e),this.params.type){case"elastic":var t=e.delta*(this.params.fps||60),i=Math.pow(this.params.spring,t),r=Math.pow(this.params.damping,t);this.velocity.multiplyScalar(Math.exp(-this.params.damping*t)),this.velocity.add(this.springVelocity),this.velocity.add(this.speed.multiplyScalar(r).multiplyScalar(1-i)),this.speed.subVectors(this.velocity,this.lastVelocity),this.springVelocity.add(this.speed),this.springVelocity.multiplyScalar(i),this.moment.add(this.springVelocity),this.moment.multiplyScalar(r),this.lastVelocity.copy(this.velocity),this.value.copy(this.moment);break;default:this.value.copy(this.velocity)}},VelocityNode.prototype.copy=function(e){Vector3Node.prototype.copy.call(this,e),e.target&&object.setTarget(e.target),object.setParams(e.params)},VelocityNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.target&&(t.target=this.target.uuid),t.params=JSON.parse(JSON.stringify(this.params))),t},Object.assign(Clock.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});var Fire=function(e,t){Mesh.call(this,e),this.type="Fire",this.clock=new Clock;var i=(t=t||{}).textureWidth||512,r=t.textureHeight||512,n=1/i,o=1/r,a=void 0!==t.debug&&t.debug;this.color1=t.color1||new Color(16777215),this.color2=t.color2||new Color(16752640),this.color3=t.color3||new Color(0),this.colorBias=void 0===t.colorBias?.8:t.colorBias,this.diffuse=void 0===t.diffuse?1.33:t.diffuse,this.viscosity=void 0===t.viscosity?.25:t.viscosity,this.expansion=void 0===t.expansion?-.25:t.expansion,this.swirl=void 0===t.swirl?50:t.swirl,this.burnRate=void 0===t.burnRate?.3:t.burnRate,this.drag=void 0===t.drag?.35:t.drag,this.airSpeed=void 0===t.airSpeed?6:t.airSpeed,this.windVector=t.windVector||new Vector2(0,.75),this.speed=void 0===t.speed?500:t.speed,this.massConservation=void 0!==t.massConservation&&t.massConservation;var s=i*r;this.sourceData=new Uint8Array(4*s),this.clearSources=function(){for(var e=0;e<r;e++)for(var t=0;t<i;t++){var n=4*(e*i+t);this.sourceData[n]=0,this.sourceData[n+1]=0,this.sourceData[n+2]=0,this.sourceData[n+3]=0}return this.sourceMaterial.uniforms.sourceMap.value=this.internalSource,this.sourceMaterial.needsUpdate=!0,this.sourceData},this.addSource=function(e,t,a,s,l,u){void 0===s&&(s=null),void 0===l&&(l=null),void 0===u&&(u=null);for(var h=Math.max(Math.floor((e-a)*i),0),c=Math.max(Math.floor((t-a)*r),0),d=Math.min(Math.floor((e+a)*i),i),p=Math.min(Math.floor((t+a)*r),r),f=c;f<p;f++)for(var m=h;m<d;m++){var v=m*n-e,g=f*o-t;if(v*v+g*g<a*a){var y,_=4*(f*i+m);if(null!=s&&(this.sourceData[_]=255*Math.min(Math.max(s,0),1)),null!=l)y=(y=Math.min(Math.max(l,-1),1))<0?Math.floor(127*y)+255:Math.floor(127*y),this.sourceData[_+1]=y;if(null!=u)y=(y=Math.min(Math.max(u,-1),1))<0?Math.floor(127*y)+255:Math.floor(127*y),this.sourceData[_+2]=y}}return this.internalSource.needsUpdate=!0,this.sourceData},this.setSourceMap=function(e){this.sourceMaterial.uniforms.sourceMap.value=e};var l={minFilter:NearestFilter,magFilter:NearestFilter,depthBuffer:!1,stencilBuffer:!1};this.field0=new WebGLRenderTarget(i,r,l),this.field0.background=new Color(0),this.field1=new WebGLRenderTarget(i,r,l),this.field0.background=new Color(0),this.fieldProj=new WebGLRenderTarget(i,r,l),this.field0.background=new Color(0),_Math.isPowerOfTwo(i)&&_Math.isPowerOfTwo(r)||(this.field0.texture.generateMipmaps=!1,this.field1.texture.generateMipmaps=!1,this.fieldProj.texture.generateMipmaps=!1),this.fieldScene=new Scene,this.fieldScene.background=new Color(0),this.orthoCamera=new OrthographicCamera(i/-2,i/2,r/2,r/-2,1,2),this.orthoCamera.position.z=1,this.fieldGeometry=new PlaneBufferGeometry(i,r),this.internalSource=new DataTexture(this.sourceData,i,r,RGBAFormat);var u=Fire.SourceShader;this.sourceMaterial=new ShaderMaterial({uniforms:u.uniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,transparent:!1}),this.clearSources(),this.sourceMesh=new Mesh(this.fieldGeometry,this.sourceMaterial),this.fieldScene.add(this.sourceMesh);u=Fire.DiffuseShader;this.diffuseMaterial=new ShaderMaterial({uniforms:u.uniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,transparent:!1}),this.diffuseMaterial.uniforms.oneOverWidth.value=n,this.diffuseMaterial.uniforms.oneOverHeight.value=o,this.diffuseMesh=new Mesh(this.fieldGeometry,this.diffuseMaterial),this.fieldScene.add(this.diffuseMesh),u=Fire.DriftShader,this.driftMaterial=new ShaderMaterial({uniforms:u.uniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,transparent:!1}),this.driftMaterial.uniforms.oneOverWidth.value=n,this.driftMaterial.uniforms.oneOverHeight.value=o,this.driftMesh=new Mesh(this.fieldGeometry,this.driftMaterial),this.fieldScene.add(this.driftMesh),u=Fire.ProjectionShader1,this.projMaterial1=new ShaderMaterial({uniforms:u.uniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,transparent:!1}),this.projMaterial1.uniforms.oneOverWidth.value=n,this.projMaterial1.uniforms.oneOverHeight.value=o,this.projMesh1=new Mesh(this.fieldGeometry,this.projMaterial1),this.fieldScene.add(this.projMesh1),u=Fire.ProjectionShader2,this.projMaterial2=new ShaderMaterial({uniforms:u.uniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,transparent:!1}),this.projMaterial2.uniforms.oneOverWidth.value=n,this.projMaterial2.uniforms.oneOverHeight.value=o,this.projMesh2=new Mesh(this.fieldGeometry,this.projMaterial2),this.fieldScene.add(this.projMesh2),u=Fire.ProjectionShader3,this.projMaterial3=new ShaderMaterial({uniforms:u.uniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,transparent:!1}),this.projMaterial3.uniforms.oneOverWidth.value=n,this.projMaterial3.uniforms.oneOverHeight.value=o,this.projMesh3=new Mesh(this.fieldGeometry,this.projMaterial3),this.fieldScene.add(this.projMesh3),u=a?Fire.DebugShader:Fire.ColorShader,this.material=new ShaderMaterial({uniforms:u.uniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,transparent:!0}),this.material.uniforms.densityMap.value=this.field1.texture,this.configShaders=function(e){this.diffuseMaterial.uniforms.diffuse.value=.05*e*this.diffuse,this.diffuseMaterial.uniforms.viscosity.value=.05*e*this.viscosity,this.diffuseMaterial.uniforms.expansion.value=Math.exp(-1*this.expansion),this.diffuseMaterial.uniforms.swirl.value=Math.exp(-.1*this.swirl),this.diffuseMaterial.uniforms.drag.value=Math.exp(-.1*this.drag),this.diffuseMaterial.uniforms.burnRate.value=this.burnRate*e*.01,this.driftMaterial.uniforms.windVector.value=this.windVector,this.driftMaterial.uniforms.airSpeed.value=e*this.airSpeed*.001*r,this.material.uniforms.color1.value=this.color1,this.material.uniforms.color2.value=this.color2,this.material.uniforms.color3.value=this.color3,this.material.uniforms.colorBias.value=this.colorBias},this.clearDiffuse=function(){this.diffuseMaterial.uniforms.expansion.value=1,this.diffuseMaterial.uniforms.swirl.value=1,this.diffuseMaterial.uniforms.drag.value=1,this.diffuseMaterial.uniforms.burnRate.value=0},this.swapTextures=function(){var e=this.field0;this.field0=this.field1,this.field1=e},this.saveRenderState=function(e){this.savedRenderTarget=e.getRenderTarget(),this.savedVrEnabled=e.vr.enabled,this.savedShadowAutoUpdate=e.shadowMap.autoUpdate,this.savedAntialias=e.antialias,this.savedToneMapping=e.toneMapping},this.restoreRenderState=function(e){e.vr.enabled=this.savedVrEnabled,e.shadowMap.autoUpdate=this.savedShadowAutoUpdate,e.setRenderTarget(this.savedRenderTarget),e.antialias=this.savedAntialias,e.toneMapping=this.savedToneMapping},this.renderSource=function(e){this.sourceMesh.visible=!0,this.sourceMaterial.uniforms.densityMap.value=this.field0.texture,e.setRenderTarget(this.field1),e.render(this.fieldScene,this.orthoCamera),this.sourceMesh.visible=!1,this.swapTextures()},this.renderDiffuse=function(e){this.diffuseMesh.visible=!0,this.diffuseMaterial.uniforms.densityMap.value=this.field0.texture,e.setRenderTarget(this.field1),e.render(this.fieldScene,this.orthoCamera),this.diffuseMesh.visible=!1,this.swapTextures()},this.renderDrift=function(e){this.driftMesh.visible=!0,this.driftMaterial.uniforms.densityMap.value=this.field0.texture,e.setRenderTarget(this.field1),e.render(this.fieldScene,this.orthoCamera),this.driftMesh.visible=!1,this.swapTextures()},this.renderProject=function(e){this.projMesh1.visible=!0,this.projMaterial1.uniforms.densityMap.value=this.field0.texture,e.setRenderTarget(this.fieldProj),e.render(this.fieldScene,this.orthoCamera),this.projMesh1.visible=!1,this.projMaterial2.uniforms.densityMap.value=this.fieldProj.texture,this.projMesh2.visible=!0;for(var t=0;t<20;t++){e.setRenderTarget(this.field1),e.render(this.fieldScene,this.orthoCamera);var i=this.field1;this.field1=this.fieldProj,this.fieldProj=i,this.projMaterial2.uniforms.densityMap.value=this.fieldProj.texture}this.projMesh2.visible=!1,this.projMaterial3.uniforms.densityMap.value=this.field0.texture,this.projMaterial3.uniforms.projMap.value=this.fieldProj.texture,this.projMesh3.visible=!0,e.setRenderTarget(this.field1),e.render(this.fieldScene,this.orthoCamera),this.projMesh3.visible=!1,this.swapTextures()},this.onBeforeRender=function(e,t,i){var r=this.clock.getDelta();r>.1&&(r=.1);var n=r*(.1*this.speed);this.configShaders(n),this.saveRenderState(e),e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.antialias=!1,e.toneMapping=NoToneMapping,this.sourceMesh.visible=!1,this.diffuseMesh.visible=!1,this.driftMesh.visible=!1,this.projMesh1.visible=!1,this.projMesh2.visible=!1,this.projMesh3.visible=!1,this.renderSource(e),this.clearDiffuse();for(var o=0;o<21;o++)this.renderDiffuse(e);this.configShaders(n),this.renderDiffuse(e),this.renderDrift(e),this.massConservation&&(this.renderProject(e),this.renderProject(e)),this.material.map=this.field1.texture,this.material.transparent=!0,this.material.minFilter=LinearFilter,this.material.magFilter=LinearFilter,this.restoreRenderState(e)}};function Box2(e,t){this.min=void 0!==e?e:new Vector2(1/0,1/0),this.max=void 0!==t?t:new Vector2(-1/0,-1/0)}Fire.prototype=Object.create(Mesh.prototype),Fire.prototype.constructor=Fire,Fire.SourceShader={uniforms:{sourceMap:{type:"t",value:null},densityMap:{type:"t",value:null}},vertexShader:["varying vec2 vUv;","void main() {"," \t  vUv = uv;","     vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","     gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform sampler2D sourceMap;","uniform sampler2D densityMap;","varying vec2 vUv;","void main() {","    vec4 source = texture2D( sourceMap, vUv );","    vec4 current = texture2D( densityMap, vUv );","    vec2 v0 = (current.gb - step(0.5, current.gb)) * 2.0;","    vec2 v1 = (source.gb - step(0.5, source.gb)) * 2.0;","    vec2 newVel = v0 + v1;","    newVel = clamp(newVel, -0.99, 0.99);","    newVel = newVel * 0.5 + step(0.0, -newVel);","    float newDensity = source.r + current.a;","    float newTemp = source.r + current.r;","    newDensity = clamp(newDensity, 0.0, 1.0);","    newTemp = clamp(newTemp, 0.0, 1.0);","    gl_FragColor = vec4(newTemp, newVel.xy, newDensity);","}"].join("\n")},Fire.DiffuseShader={uniforms:{oneOverWidth:{type:"f",value:null},oneOverHeight:{type:"f",value:null},diffuse:{type:"f",value:null},viscosity:{type:"f",value:null},expansion:{type:"f",value:null},swirl:{type:"f",value:null},drag:{type:"f",value:null},burnRate:{type:"f",value:null},densityMap:{type:"t",value:null}},vertexShader:["varying vec2 vUv;","void main() {"," \t  vUv = uv;","     vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","     gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float oneOverWidth;","uniform float oneOverHeight;","uniform float diffuse;","uniform float viscosity;","uniform float expansion;","uniform float swirl;","uniform float burnRate;","uniform float drag;","uniform sampler2D densityMap;","varying vec2 vUv;","void main() {","    vec4 dC = texture2D( densityMap, vUv );","    vec4 dL = texture2D( densityMap, vec2(vUv.x - oneOverWidth, vUv.y) );","    vec4 dR = texture2D( densityMap, vec2(vUv.x + oneOverWidth, vUv.y) );","    vec4 dU = texture2D( densityMap, vec2(vUv.x, vUv.y - oneOverHeight) );","    vec4 dD = texture2D( densityMap, vec2(vUv.x, vUv.y + oneOverHeight) );","    vec4 dUL = texture2D( densityMap, vec2(vUv.x - oneOverWidth, vUv.y - oneOverHeight) );","    vec4 dUR = texture2D( densityMap, vec2(vUv.x + oneOverWidth, vUv.y - oneOverHeight) );","    vec4 dDL = texture2D( densityMap, vec2(vUv.x - oneOverWidth, vUv.y + oneOverHeight) );","    vec4 dDR = texture2D( densityMap, vec2(vUv.x + oneOverWidth, vUv.y + oneOverHeight) );","    dC.yz = (dC.yz - step(0.5, dC.yz)) * 2.0;","    dL.yz = (dL.yz - step(0.5, dL.yz)) * 2.0;","    dR.yz = (dR.yz - step(0.5, dR.yz)) * 2.0;","    dU.yz = (dU.yz - step(0.5, dU.yz)) * 2.0;","    dD.yz = (dD.yz - step(0.5, dD.yz)) * 2.0;","    dUL.yz = (dUL.yz - step(0.5, dUL.yz)) * 2.0;","    dUR.yz = (dUR.yz - step(0.5, dUR.yz)) * 2.0;","    dDL.yz = (dDL.yz - step(0.5, dDL.yz)) * 2.0;","    dDR.yz = (dDR.yz - step(0.5, dDR.yz)) * 2.0;","    vec4 result = (dC + vec4(diffuse, viscosity, viscosity, diffuse) * ( dL + dR + dU + dD + dUL + dUR + dDL + dDR )) / (1.0 + 8.0 * vec4(diffuse, viscosity, viscosity, diffuse)) - vec4(0.0, 0.0, 0.0, 0.001);","    float temperature = result.r;","    temperature = clamp(temperature - burnRate, 0.0, 1.0);","    vec2 velocity = result.yz;","    vec2 expansionVec = vec2(dL.w - dR.w, dU.w - dD.w);","    vec2 swirlVec = vec2((dL.z - dR.z) * 0.5, (dU.y - dD.y) * 0.5);","    velocity = velocity + (1.0 - expansion) * expansionVec + (1.0 - swirl) * swirlVec;","    velocity = velocity - (1.0 - drag) * velocity;","    gl_FragColor = vec4(temperature, velocity * 0.5 + step(0.0, -velocity), result.w);","    gl_FragColor = gl_FragColor * step(oneOverWidth, vUv.x);","    gl_FragColor = gl_FragColor * step(oneOverHeight, vUv.y);","    gl_FragColor = gl_FragColor * step(vUv.x, 1.0 - oneOverWidth);","    gl_FragColor = gl_FragColor * step(vUv.y, 1.0 - oneOverHeight);","}"].join("\n")},Fire.DriftShader={uniforms:{oneOverWidth:{type:"f",value:null},oneOverHeight:{type:"f",value:null},windVector:{type:"v2",value:new Vector2(0,0)},airSpeed:{type:"f",value:null},densityMap:{type:"t",value:null}},vertexShader:["varying vec2 vUv;","void main() {"," \t  vUv = uv;","     vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","     gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float oneOverWidth;","uniform float oneOverHeight;","uniform vec2 windVector;","uniform float airSpeed;","uniform sampler2D densityMap;","varying vec2 vUv;","void main() {","    vec2 velocity = texture2D( densityMap, vUv ).gb;","    velocity = (velocity - step(0.5, velocity)) * 2.0;","    velocity = velocity + windVector;","    vec2 sourcePos = vUv - airSpeed * vec2(oneOverWidth, oneOverHeight) * velocity;","    vec2 units = sourcePos / vec2(oneOverWidth, oneOverHeight);","    vec2 intPos = floor(units);","    vec2 frac = units - intPos;","    intPos = intPos * vec2(oneOverWidth, oneOverHeight);","    vec4 dX0Y0 = texture2D( densityMap, intPos + vec2(0.0, -oneOverHeight) );","    vec4 dX1Y0 = texture2D( densityMap, intPos + vec2(oneOverWidth, 0.0) );","    vec4 dX0Y1 = texture2D( densityMap, intPos + vec2(0.0, oneOverHeight) );","    vec4 dX1Y1 = texture2D( densityMap, intPos + vec2(oneOverWidth, oneOverHeight) );","    dX0Y0.gb = (dX0Y0.gb - step(0.5, dX0Y0.gb)) * 2.0;","    dX1Y0.gb = (dX1Y0.gb - step(0.5, dX1Y0.gb)) * 2.0;","    dX0Y1.gb = (dX0Y1.gb - step(0.5, dX0Y1.gb)) * 2.0;","    dX1Y1.gb = (dX1Y1.gb - step(0.5, dX1Y1.gb)) * 2.0;","    vec4 source = mix(mix(dX0Y0, dX1Y0, frac.x), mix(dX0Y1, dX1Y1, frac.x), frac.y);","    source.gb = source.gb * 0.5 + step(0.0, -source.gb);","    gl_FragColor = source;","}"].join("\n")},Fire.ProjectionShader1={uniforms:{oneOverWidth:{type:"f",value:null},oneOverHeight:{type:"f",value:null},densityMap:{type:"t",value:null}},vertexShader:["varying vec2 vUv;","void main() {"," \t  vUv = uv;","     vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","     gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float oneOverWidth;","uniform float oneOverHeight;","uniform sampler2D densityMap;","varying vec2 vUv;","void main() {","    float dL = texture2D( densityMap, vec2(vUv.x - oneOverWidth, vUv.y) ).g;","    float dR = texture2D( densityMap, vec2(vUv.x + oneOverWidth, vUv.y) ).g;","    float dU = texture2D( densityMap, vec2(vUv.x, vUv.y - oneOverHeight) ).b;","    float dD = texture2D( densityMap, vec2(vUv.x, vUv.y + oneOverHeight) ).b;","    dL = (dL - step(0.5, dL)) * 2.0;","    dR = (dR - step(0.5, dR)) * 2.0;","    dU = (dU - step(0.5, dU)) * 2.0;","    dD = (dD - step(0.5, dD)) * 2.0;","    float h = (oneOverWidth + oneOverHeight) * 0.5;","    float div = -0.5 * h * (dR - dL + dD - dU);","    gl_FragColor = vec4( 0.0, 0.0, div * 0.5 + step(0.0, -div), 0.0);","}"].join("\n")},Fire.ProjectionShader2={uniforms:{oneOverWidth:{type:"f",value:null},oneOverHeight:{type:"f",value:null},densityMap:{type:"t",value:null}},vertexShader:["varying vec2 vUv;","void main() {"," \t  vUv = uv;","     vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","     gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float oneOverWidth;","uniform float oneOverHeight;","uniform sampler2D densityMap;","varying vec2 vUv;","void main() {","    float div = texture2D( densityMap, vUv ).b;","    float pL = texture2D( densityMap, vec2(vUv.x - oneOverWidth, vUv.y) ).g;","    float pR = texture2D( densityMap, vec2(vUv.x + oneOverWidth, vUv.y) ).g;","    float pU = texture2D( densityMap, vec2(vUv.x, vUv.y - oneOverHeight) ).g;","    float pD = texture2D( densityMap, vec2(vUv.x, vUv.y + oneOverHeight) ).g;","    float divNorm = (div - step(0.5, div)) * 2.0;","    pL = (pL - step(0.5, pL)) * 2.0;","    pR = (pR - step(0.5, pR)) * 2.0;","    pU = (pU - step(0.5, pU)) * 2.0;","    pD = (pD - step(0.5, pD)) * 2.0;","    float p = (divNorm + pR + pL + pD + pU) * 0.25;","    gl_FragColor = vec4( 0.0, p * 0.5 + step(0.0, -p), div, 0.0);","}"].join("\n")},Fire.ProjectionShader3={uniforms:{oneOverWidth:{type:"f",value:null},oneOverHeight:{type:"f",value:null},densityMap:{type:"t",value:null},projMap:{type:"t",value:null}},vertexShader:["varying vec2 vUv;","void main() {"," \t  vUv = uv;","     vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","     gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float oneOverWidth;","uniform float oneOverHeight;","uniform sampler2D densityMap;","uniform sampler2D projMap;","varying vec2 vUv;","void main() {","    vec4 orig = texture2D(densityMap, vUv);","    float pL = texture2D( projMap, vec2(vUv.x - oneOverWidth, vUv.y) ).g;","    float pR = texture2D( projMap, vec2(vUv.x + oneOverWidth, vUv.y) ).g;","    float pU = texture2D( projMap, vec2(vUv.x, vUv.y - oneOverHeight) ).g;","    float pD = texture2D( projMap, vec2(vUv.x, vUv.y + oneOverHeight) ).g;","    float uNorm = (orig.g - step(0.5, orig.g)) * 2.0;","    float vNorm = (orig.b - step(0.5, orig.b)) * 2.0;","    pL = (pL - step(0.5, pL)) * 2.0;","    pR = (pR - step(0.5, pR)) * 2.0;","    pU = (pU - step(0.5, pU)) * 2.0;","    pD = (pD - step(0.5, pD)) * 2.0;","    float h = (oneOverWidth + oneOverHeight) * 0.5;","    float u = uNorm - (0.5 * (pR - pL) / h);","    float v = vNorm - (0.5 * (pD - pU) / h);","    gl_FragColor = vec4( orig.r, u * 0.5 + step(0.0, -u), v * 0.5 + step(0.0, -v), orig.a);","}"].join("\n")},Fire.ColorShader={uniforms:{color1:{type:"c",value:null},color2:{type:"c",value:null},color3:{type:"c",value:null},colorBias:{type:"f",value:null},densityMap:{type:"t",value:null}},vertexShader:["varying vec2 vUv;","void main() {"," \t  vUv = uv;","     vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","     gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color1;","uniform vec3 color2;","uniform vec3 color3;","uniform float colorBias;","uniform sampler2D densityMap;","varying vec2 vUv;","void main() {","    float density = texture2D( densityMap, vUv ).a;","    float temperature = texture2D( densityMap, vUv ).r;","    float bias = clamp(colorBias, 0.0001, 0.9999);","    vec3 blend1 = mix(color3, color2, temperature / bias) * (1.0 - step(bias, temperature));","    vec3 blend2 = mix(color2, color1, (temperature - bias) / (1.0 - bias) ) * step(bias, temperature);","    gl_FragColor = vec4(blend1 + blend2, density);","}"].join("\n")},Fire.DebugShader={uniforms:{color1:{type:"c",value:null},color2:{type:"c",value:null},color3:{type:"c",value:null},colorBias:{type:"f",value:null},densityMap:{type:"t",value:null}},vertexShader:["varying vec2 vUv;","void main() {"," \t  vUv = uv;","     vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","     gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform sampler2D densityMap;","varying vec2 vUv;","void main() {","    float density;","    density = texture2D( densityMap, vUv ).a;","    vec2 vel = texture2D( densityMap, vUv ).gb;","    vel = (vel - step(0.5, vel)) * 2.0;","    float r = density;","    float g = max(abs(vel.x), density * 0.5);","    float b = max(abs(vel.y), density * 0.5);","    float a = max(density * 0.5, max(abs(vel.x), abs(vel.y)));","    gl_FragColor = vec4(r, g, b, a);","}"].join("\n")},Object.assign(Box2.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Vector2;return function(t,i){var r=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("Box2: .getCenter() target is now required"),e=new Vector2),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("Box2: .getSize() target is now required"),e=new Vector2),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("Box2: .getParameter() target is now required"),t=new Vector2),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("Box2: .clampPoint() target is now required"),t=new Vector2),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Vector2;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Lensflare=function(){Mesh.call(this,Lensflare.Geometry,new MeshBasicMaterial({opacity:0,transparent:!0})),this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;var e=new Vector3,t=new Vector3,i=new DataTexture(new Uint8Array(768),16,16,RGBFormat);i.minFilter=NearestFilter,i.magFilter=NearestFilter,i.wrapS=ClampToEdgeWrapping,i.wrapT=ClampToEdgeWrapping,i.needsUpdate=!0;var r=new DataTexture(new Uint8Array(768),16,16,RGBFormat);r.minFilter=NearestFilter,r.magFilter=NearestFilter,r.wrapS=ClampToEdgeWrapping,r.wrapT=ClampToEdgeWrapping,r.needsUpdate=!0;var n=Lensflare.Geometry,o=new RawShaderMaterial({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","void main() {","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","void main() {","\tgl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );","}"].join("\n"),depthTest:!0,depthWrite:!1,transparent:!1}),a=new RawShaderMaterial({uniforms:{map:{value:i},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","\tvUV = uv;","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","varying vec2 vUV;","void main() {","\tgl_FragColor = texture2D( map, vUV );","}"].join("\n"),depthTest:!1,depthWrite:!1,transparent:!1}),s=new Mesh(n,o),l=[],u=LensflareElement.Shader,h=new RawShaderMaterial({uniforms:{map:{value:null},occlusionMap:{value:r},color:{value:new Color(16777215)},scale:{value:new Vector2},screenPosition:{value:new Vector3}},vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,blending:AdditiveBlending,transparent:!0,depthWrite:!1}),c=new Mesh(n,h);this.addElement=function(e){l.push(e)};var d=new Vector2,p=new Vector2,f=new Box2,m=new Vector4;this.onBeforeRender=function(u,v,g){u.getCurrentViewport(m);var y=m.w/m.z,_=m.z/2,b=m.w/2,x=16/m.w;if(d.set(x*y,x),f.min.set(m.x,m.y),f.max.set(m.x+(m.z-16),m.y+(m.w-16)),t.setFromMatrixPosition(this.matrixWorld),t.applyMatrix4(g.matrixWorldInverse),!(t.z>0)&&(e.copy(t).applyMatrix4(g.projectionMatrix),p.x=m.x+e.x*_+_-8,p.y=m.y+e.y*b+b-8,f.containsPoint(p))){u.copyFramebufferToTexture(p,i),(A=o.uniforms).scale.value=d,A.screenPosition.value=e,u.renderBufferDirect(g,null,n,o,s,null),u.copyFramebufferToTexture(p,r),(A=a.uniforms).scale.value=d,A.screenPosition.value=e,u.renderBufferDirect(g,null,n,a,s,null);for(var w=2*-e.x,S=2*-e.y,M=0,T=l.length;M<T;M++){var A,C=l[M];(A=h.uniforms).color.value.copy(C.color),A.map.value=C.texture,A.screenPosition.value.x=e.x+w*C.distance,A.screenPosition.value.y=e.y+S*C.distance;x=C.size/m.w,y=m.w/m.z;A.scale.value.set(x*y,x),h.uniformsNeedUpdate=!0,u.renderBufferDirect(g,null,n,h,c,null)}}},this.dispose=function(){o.dispose(),a.dispose(),h.dispose(),i.dispose(),r.dispose();for(var e=0,t=l.length;e<t;e++)l[e].texture.dispose()}};Lensflare.prototype=Object.create(Mesh.prototype),Lensflare.prototype.constructor=Lensflare,Lensflare.prototype.isLensflare=!0;var LensflareElement=function(e,t,i,r){this.texture=e,this.size=t||1,this.distance=i||0,this.color=r||new Color(16777215)};LensflareElement.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform sampler2D occlusionMap;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvUV = uv;","\tvec2 pos = position.xy;","\tvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","\tvVisibility =        visibility.r / 9.0;","\tvVisibility *= 1.0 - visibility.g / 9.0;","\tvVisibility *=       visibility.b / 9.0;","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvec4 texture = texture2D( map, vUV );","\ttexture.a *= vVisibility;","\tgl_FragColor = texture;","\tgl_FragColor.rgb *= color;","}"].join("\n")},Lensflare.Geometry=function(){var e=new BufferGeometry,t=new InterleavedBuffer(new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),5);return e.setIndex([0,1,2,0,2,3]),e.addAttribute("position",new InterleavedBufferAttribute(t,3,0,!1)),e.addAttribute("uv",new InterleavedBufferAttribute(t,2,3,!1)),e}();var LightningStorm=function(e){Object3D.call(this),e=e||{},this.stormParams=e,e.size=void 0!==e.size?e.size:1e3,e.minHeight=void 0!==e.minHeight?e.minHeight:80,e.maxHeight=void 0!==e.maxHeight?e.maxHeight:100,e.maxSlope=void 0!==e.maxSlope?e.maxSlope:1.1,e.maxLightnings=void 0!==e.maxLightnings?e.maxLightnings:3,e.lightningMinPeriod=void 0!==e.lightningMinPeriod?e.lightningMinPeriod:3,e.lightningMaxPeriod=void 0!==e.lightningMaxPeriod?e.lightningMaxPeriod:7,e.lightningMinDuration=void 0!==e.lightningMinDuration?e.lightningMinDuration:1,e.lightningMaxDuration=void 0!==e.lightningMaxDuration?e.lightningMaxDuration:2.5,this.lightningParameters=LightningStrike.copyParameters(e.lightningParameters,e.lightningParameters),this.lightningParameters.isEternal=!1,this.lightningMaterial=void 0!==e.lightningMaterial?e.lightningMaterial:new MeshBasicMaterial({color:11599871}),void 0!==e.onRayPosition?this.onRayPosition=e.onRayPosition:this.onRayPosition=function(t,i){i.set((Math.random()-.5)*e.size,0,(Math.random()-.5)*e.size);var r=_Math.lerp(e.minHeight,e.maxHeight,Math.random());t.set(e.maxSlope*(2*Math.random()-1),1,e.maxSlope*(2*Math.random()-1)).multiplyScalar(r).add(i)},this.onLightningDown=e.onLightningDown,this.inited=!1,this.nextLightningTime=0,this.lightningsMeshes=[],this.deadLightningsMeshes=[];for(var t=0;t<this.stormParams.maxLightnings;t++){var i=new Mesh(new LightningStrike(LightningStrike.copyParameters({},this.lightningParameters)),this.lightningMaterial);this.deadLightningsMeshes.push(i)}};LightningStorm.prototype=Object.create(Object3D.prototype),LightningStorm.prototype.constructor=LightningStorm,LightningStorm.prototype.isLightningStorm=!0,LightningStorm.prototype.update=function(e){if(this.inited||(this.nextLightningTime=this.getNextLightningTime(e)*Math.random(),this.inited=!0),e>=this.nextLightningTime){var t=this.deadLightningsMeshes.pop();if(t){var i=LightningStrike.copyParameters(t.geometry.rayParameters,this.lightningParameters);i.birthTime=e,i.deathTime=e+_Math.lerp(this.stormParams.lightningMinDuration,this.stormParams.lightningMaxDuration,Math.random()),this.onRayPosition(i.sourceOffset,i.destOffset),i.noiseSeed=Math.random(),this.add(t),this.lightningsMeshes.push(t)}this.nextLightningTime=this.getNextLightningTime(e)}var r=0;for(il=this.lightningsMeshes.length;r<il;){var n=this.lightningsMeshes[r],o=n.geometry,a=o.state;o.update(e),a===LightningStrike.RAY_PROPAGATING&&o.state>a&&this.onLightningDown&&this.onLightningDown(o),o.state===LightningStrike.RAY_EXTINGUISHED?(this.lightningsMeshes.splice(this.lightningsMeshes.indexOf(n),1),this.deadLightningsMeshes.push(n),this.remove(n),il--):r++}},LightningStorm.prototype.getNextLightningTime=function(e){return e+_Math.lerp(this.stormParams.lightningMinPeriod,this.stormParams.lightningMaxPeriod,Math.random())/(this.stormParams.maxLightnings+1)},LightningStorm.prototype.copy=function(e){return Object3D.prototype.copy.call(this,e),this.stormParams.size=e.stormParams.size,this.stormParams.minHeight=e.stormParams.minHeight,this.stormParams.maxHeight=e.stormParams.maxHeight,this.stormParams.maxSlope=e.stormParams.maxSlope,this.stormParams.maxLightnings=e.stormParams.maxLightnings,this.stormParams.lightningMinPeriod=e.stormParams.lightningMinPeriod,this.stormParams.lightningMaxPeriod=e.stormParams.lightningMaxPeriod,this.stormParams.lightningMinDuration=e.stormParams.lightningMinDuration,this.stormParams.lightningMaxDuration=e.stormParams.lightningMaxDuration,this.lightningParameters=LightningStrike.copyParameters({},e.lightningParameters),this.lightningMaterial=e.stormParams.lightningMaterial,this.onLightningDown=e.onLightningDown,this},LightningStrike.prototype.clone=function(){return new this.constructor(this.stormParams).copy(this)};var Reflector=function(e,t){Mesh.call(this,e),this.type="Reflector";var i=this,r=void 0!==(t=t||{}).color?new Color(t.color):new Color(8355711),n=t.textureWidth||512,o=t.textureHeight||512,a=t.clipBias||0,s=t.shader||Reflector.ReflectorShader,l=void 0!==t.recursion?t.recursion:0,u=new Plane,h=new Vector3,c=new Vector3,d=new Vector3,p=new Matrix4,f=new Vector3(0,0,-1),m=new Vector4,v=new Vector4,g=new Vector3,y=new Vector3,_=new Vector4,b=new Vector2,x=new Matrix4,w=new PerspectiveCamera,S=new WebGLRenderTarget(n,o,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat,stencilBuffer:!1});_Math.isPowerOfTwo(n)&&_Math.isPowerOfTwo(o)||(S.texture.generateMipmaps=!1);var M=new ShaderMaterial({uniforms:UniformsUtils.clone(s.uniforms),fragmentShader:s.fragmentShader,vertexShader:s.vertexShader});M.uniforms.tDiffuse.value=S.texture,M.uniforms.color.value=r,M.uniforms.textureMatrix.value=x,this.material=M,this.onBeforeRender=function(e,t,r){if("recursion"in r.userData){if(r.userData.recursion===l)return;r.userData.recursion++}if(c.setFromMatrixPosition(i.matrixWorld),d.setFromMatrixPosition(r.matrixWorld),p.extractRotation(i.matrixWorld),h.set(0,0,1),h.applyMatrix4(p),g.subVectors(c,d),!(g.dot(h)>0)){g.reflect(h).negate(),g.add(c),p.extractRotation(r.matrixWorld),f.set(0,0,-1),f.applyMatrix4(p),f.add(d),y.subVectors(c,f),y.reflect(h).negate(),y.add(c),w.position.copy(g),w.up.set(0,1,0),w.up.applyMatrix4(p),w.up.reflect(h),w.lookAt(y),w.far=r.far,w.updateMatrixWorld(),w.projectionMatrix.copy(r.projectionMatrix),w.userData.recursion=0,x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(w.projectionMatrix),x.multiply(w.matrixWorldInverse),x.multiply(i.matrixWorld),u.setFromNormalAndCoplanarPoint(h,c),u.applyMatrix4(w.matrixWorldInverse),m.set(u.normal.x,u.normal.y,u.normal.z,u.constant);var n=w.projectionMatrix;_.x=(Math.sign(m.x)+n.elements[8])/n.elements[0],_.y=(Math.sign(m.y)+n.elements[9])/n.elements[5],_.z=-1,_.w=(1+n.elements[10])/n.elements[14],m.multiplyScalar(2/m.dot(_)),n.elements[2]=m.x,n.elements[6]=m.y,n.elements[10]=m.z+1-a,n.elements[14]=m.w,i.visible=!1;var o=e.getRenderTarget(),s=e.vr.enabled,M=e.shadowMap.autoUpdate;e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(S),e.clear(),e.render(t,w),e.vr.enabled=s,e.shadowMap.autoUpdate=M,e.setRenderTarget(o);var T=r.bounds;if(void 0!==T){e.getSize(b);var A=e.getPixelRatio();v.x=T.x*b.width*A,v.y=T.y*b.height*A,v.z=T.z*b.width*A,v.w=T.w*b.height*A,e.state.viewport(v)}i.visible=!0}},this.getRenderTarget=function(){return S}};Reflector.prototype=Object.create(Mesh.prototype),Reflector.prototype.constructor=Reflector,Reflector.ReflectorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")};var ReflectorRTT=function(e,t){Reflector.call(this,e,t),this.geometry.setDrawRange(0,0)};ReflectorRTT.prototype=Object.create(Reflector.prototype);var Refractor=function(e,t){Mesh.call(this,e),this.type="Refractor";var i=this,r=void 0!==(t=t||{}).color?new Color(t.color):new Color(8355711),n=t.textureWidth||512,o=t.textureHeight||512,a=t.clipBias||0,s=t.shader||Refractor.RefractorShader,l=new PerspectiveCamera;l.matrixAutoUpdate=!1,l.userData.refractor=!0;var u=new Plane,h=new Matrix4,c=new WebGLRenderTarget(n,o,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat,stencilBuffer:!1});_Math.isPowerOfTwo(n)&&_Math.isPowerOfTwo(o)||(c.texture.generateMipmaps=!1),this.material=new ShaderMaterial({uniforms:UniformsUtils.clone(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,transparent:!0}),this.material.uniforms.color.value=r,this.material.uniforms.tDiffuse.value=c.texture,this.material.uniforms.textureMatrix.value=h;var d,p,f,m,v,g,y,_,b=(d=new Vector3,p=new Vector3,f=new Matrix4,m=new Vector3,v=new Vector3,function(e){return d.setFromMatrixPosition(i.matrixWorld),p.setFromMatrixPosition(e.matrixWorld),m.subVectors(d,p),f.extractRotation(i.matrixWorld),v.set(0,0,1),v.applyMatrix4(f),m.dot(v)<0}),x=function(){var e=new Vector3,t=new Vector3,r=new Quaternion,n=new Vector3;return function(){i.matrixWorld.decompose(t,r,n),e.set(0,0,1).applyQuaternion(r).normalize(),e.negate(),u.setFromNormalAndCoplanarPoint(e,t)}}(),w=(g=new Plane,y=new Vector4,_=new Vector4,function(e){l.matrixWorld.copy(e.matrixWorld),l.matrixWorldInverse.getInverse(l.matrixWorld),l.projectionMatrix.copy(e.projectionMatrix),l.far=e.far,g.copy(u),g.applyMatrix4(l.matrixWorldInverse),y.set(g.normal.x,g.normal.y,g.normal.z,g.constant);var t=l.projectionMatrix;_.x=(Math.sign(y.x)+t.elements[8])/t.elements[0],_.y=(Math.sign(y.y)+t.elements[9])/t.elements[5],_.z=-1,_.w=(1+t.elements[10])/t.elements[14],y.multiplyScalar(2/y.dot(_)),t.elements[2]=y.x,t.elements[6]=y.y,t.elements[10]=y.z+1-a,t.elements[14]=y.w});var S,M,T=(S=new Vector4,M=new Vector2,function(e,t,r){i.visible=!1;var n=e.getRenderTarget(),o=e.vr.enabled,a=e.shadowMap.autoUpdate;e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(c),e.clear(),e.render(t,l),e.vr.enabled=o,e.shadowMap.autoUpdate=a,e.setRenderTarget(n);var s=r.bounds;if(void 0!==s){e.getSize(M);var u=e.getPixelRatio();S.x=s.x*M.width*u,S.y=s.y*M.height*u,S.z=s.z*M.width*u,S.w=s.w*M.height*u,e.state.viewport(S)}i.visible=!0});this.onBeforeRender=function(e,t,r){!0!==r.userData.refractor&&!0!=!b(r)&&(x(),function(e){h.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),h.multiply(e.projectionMatrix),h.multiply(e.matrixWorldInverse),h.multiply(i.matrixWorld)}(r),w(r),T(e,t,r))},this.getRenderTarget=function(){return c}};Refractor.prototype=Object.create(Mesh.prototype),Refractor.prototype.constructor=Refractor,Refractor.RefractorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")};var ShadowMesh=function(e){var t=new MeshBasicMaterial({color:0,transparent:!0,opacity:.6,depthWrite:!1});Mesh.call(this,e.geometry,t),this.meshMatrix=e.matrixWorld,this.frustumCulled=!1,this.matrixAutoUpdate=!1},shadowMatrix;ShadowMesh.prototype=Object.create(Mesh.prototype),ShadowMesh.prototype.constructor=ShadowMesh,ShadowMesh.prototype.update=(shadowMatrix=new Matrix4,function(e,t){var i=e.normal.x*t.x+e.normal.y*t.y+e.normal.z*t.z+-e.constant*t.w,r=shadowMatrix.elements;r[0]=i-t.x*e.normal.x,r[4]=-t.x*e.normal.y,r[8]=-t.x*e.normal.z,r[12]=-t.x*-e.constant,r[1]=-t.y*e.normal.x,r[5]=i-t.y*e.normal.y,r[9]=-t.y*e.normal.z,r[13]=-t.y*-e.constant,r[2]=-t.z*e.normal.x,r[6]=-t.z*e.normal.y,r[10]=i-t.z*e.normal.z,r[14]=-t.z*-e.constant,r[3]=-t.w*e.normal.x,r[7]=-t.w*e.normal.y,r[11]=-t.w*e.normal.z,r[15]=i-t.w*-e.constant,this.matrix.multiplyMatrices(shadowMatrix,this.meshMatrix)});var Sky=function(){var e=Sky.SkyShader,t=new ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:UniformsUtils.clone(e.uniforms),side:BackSide});Mesh.call(this,new BoxBufferGeometry(1,1,1),t)};Sky.prototype=Object.create(Mesh.prototype),Sky.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")};var Water=function(e,t){Mesh.call(this,e);var i=this,r=void 0!==(t=t||{}).textureWidth?t.textureWidth:512,n=void 0!==t.textureHeight?t.textureHeight:512,o=void 0!==t.clipBias?t.clipBias:0,a=void 0!==t.alpha?t.alpha:1,s=void 0!==t.time?t.time:0,l=void 0!==t.waterNormals?t.waterNormals:null,u=void 0!==t.sunDirection?t.sunDirection:new Vector3(.70707,.70707,0),h=new Color(void 0!==t.sunColor?t.sunColor:16777215),c=new Color(void 0!==t.waterColor?t.waterColor:8355711),d=void 0!==t.eye?t.eye:new Vector3(0,0,0),p=void 0!==t.distortionScale?t.distortionScale:20,f=void 0!==t.side?t.side:FrontSide,m=void 0!==t.fog&&t.fog,v=new Plane,g=new Vector3,y=new Vector3,_=new Vector3,b=new Matrix4,x=new Vector3(0,0,-1),w=new Vector4,S=new Vector3,M=new Vector3,T=new Vector4,A=new Matrix4,C=new PerspectiveCamera,L=new WebGLRenderTarget(r,n,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat,stencilBuffer:!1});_Math.isPowerOfTwo(r)&&_Math.isPowerOfTwo(n)||(L.texture.generateMipmaps=!1);var N={uniforms:UniformsUtils.merge([UniformsLib.fog,UniformsLib.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new Matrix4},sunColor:{value:new Color(8355711)},sunDirection:{value:new Vector3(.70707,.70707,0)},eye:{value:new Vector3},waterColor:{value:new Color(5592405)}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec4 worldPosition;",ShaderChunk.fog_pars_vertex,ShaderChunk.shadowmap_pars_vertex,"void main() {","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","\tworldPosition = mirrorCoord.xyzw;","\tmirrorCoord = textureMatrix * mirrorCoord;","\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",ShaderChunk.fog_vertex,ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float size;","uniform float distortionScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","vec4 getNoise( vec2 uv ) {","\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );","\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );","\tvec4 noise = texture2D( normalSampler, uv0 ) +","\t\ttexture2D( normalSampler, uv1 ) +","\t\ttexture2D( normalSampler, uv2 ) +","\t\ttexture2D( normalSampler, uv3 );","\treturn noise * 0.5 - 1.0;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {","\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );","\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );","\tspecularColor += pow( direction, shiny ) * sunColor * spec;","\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}",ShaderChunk.common,ShaderChunk.packing,ShaderChunk.bsdfs,ShaderChunk.fog_pars_fragment,ShaderChunk.lights_pars_begin,ShaderChunk.shadowmap_pars_fragment,ShaderChunk.shadowmask_pars_fragment,"void main() {","\tvec4 noise = getNoise( worldPosition.xz * size );","\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","\tvec3 diffuseLight = vec3(0.0);","\tvec3 specularLight = vec3(0.0);","\tvec3 worldToEye = eye-worldPosition.xyz;","\tvec3 eyeDirection = normalize( worldToEye );","\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );","\tfloat distance = length(worldToEye);","\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );","\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","\tfloat rf0 = 0.3;","\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;","\tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);","\tvec3 outgoingLight = albedo;","\tgl_FragColor = vec4( outgoingLight, alpha );",ShaderChunk.tonemapping_fragment,ShaderChunk.fog_fragment,"}"].join("\n")},P=new ShaderMaterial({fragmentShader:N.fragmentShader,vertexShader:N.vertexShader,uniforms:UniformsUtils.clone(N.uniforms),transparent:!0,lights:!0,side:f,fog:m});P.uniforms.mirrorSampler.value=L.texture,P.uniforms.textureMatrix.value=A,P.uniforms.alpha.value=a,P.uniforms.time.value=s,P.uniforms.normalSampler.value=l,P.uniforms.sunColor.value=h,P.uniforms.waterColor.value=c,P.uniforms.sunDirection.value=u,P.uniforms.distortionScale.value=p,P.uniforms.eye.value=d,i.material=P,i.onBeforeRender=function(e,t,r){if(y.setFromMatrixPosition(i.matrixWorld),_.setFromMatrixPosition(r.matrixWorld),b.extractRotation(i.matrixWorld),g.set(0,0,1),g.applyMatrix4(b),S.subVectors(y,_),!(S.dot(g)>0)){S.reflect(g).negate(),S.add(y),b.extractRotation(r.matrixWorld),x.set(0,0,-1),x.applyMatrix4(b),x.add(_),M.subVectors(y,x),M.reflect(g).negate(),M.add(y),C.position.copy(S),C.up.set(0,1,0),C.up.applyMatrix4(b),C.up.reflect(g),C.lookAt(M),C.far=r.far,C.updateMatrixWorld(),C.projectionMatrix.copy(r.projectionMatrix),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(C.projectionMatrix),A.multiply(C.matrixWorldInverse),v.setFromNormalAndCoplanarPoint(g,y),v.applyMatrix4(C.matrixWorldInverse),w.set(v.normal.x,v.normal.y,v.normal.z,v.constant);var n=C.projectionMatrix;T.x=(Math.sign(w.x)+n.elements[8])/n.elements[0],T.y=(Math.sign(w.y)+n.elements[9])/n.elements[5],T.z=-1,T.w=(1+n.elements[10])/n.elements[14],w.multiplyScalar(2/w.dot(T)),n.elements[2]=w.x,n.elements[6]=w.y,n.elements[10]=w.z+1-o,n.elements[14]=w.w,d.setFromMatrixPosition(r.matrixWorld);var a=e.getRenderTarget(),s=e.vr.enabled,l=e.shadowMap.autoUpdate;i.visible=!1,e.vr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(L),e.clear(),e.render(t,C),i.visible=!0,e.vr.enabled=s,e.shadowMap.autoUpdate=l,e.setRenderTarget(a)}}};function Water2(e,t){Mesh.call(this,e),this.type="Water2";var i=this,r=void 0!==(t=t||{}).color?new Color(t.color):new Color(16777215),n=t.textureWidth||512,o=t.textureHeight||512,a=t.clipBias||0,s=t.flowDirection||new Vector2(1,0),l=t.flowSpeed||.03,u=t.reflectivity||.02,h=t.scale||1,c=t.shader||Water2.Water2Shader,d=new TextureLoader,p=t.flowMap||void 0,f=t.normalMap0||d.load("textures/water/Water2_1_M_Normal.jpg"),m=t.normalMap1||d.load("textures/water/Water2_2_M_Normal.jpg"),v=.15,g=.5*v,y=new Matrix4,_=new Clock;if(void 0!==Reflector)if(void 0!==Refractor){var b=new Reflector(e,{textureWidth:n,textureHeight:o,clipBias:a}),x=new Refractor(e,{textureWidth:n,textureHeight:o,clipBias:a});b.matrixAutoUpdate=!1,x.matrixAutoUpdate=!1,this.material=new ShaderMaterial({uniforms:UniformsUtils.merge([UniformsLib.fog,c.uniforms]),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,transparent:!0,fog:!0}),void 0!==p?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:p}):this.material.uniforms.flowDirection={type:"v2",value:s},f.wrapS=f.wrapT=RepeatWrapping,m.wrapS=m.wrapT=RepeatWrapping,this.material.uniforms.tReflectionMap.value=b.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=x.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=f,this.material.uniforms.tNormalMap1.value=m,this.material.uniforms.color.value=r,this.material.uniforms.reflectivity.value=u,this.material.uniforms.textureMatrix.value=y,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=g,this.material.uniforms.config.value.z=g,this.material.uniforms.config.value.w=h,this.onBeforeRender=function(e,t,r){var n,o;!function(e){y.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),y.multiply(e.projectionMatrix),y.multiply(e.matrixWorldInverse),y.multiply(i.matrixWorld)}(r),n=_.getDelta(),(o=i.material.uniforms.config).value.x+=l*n,o.value.y=o.value.x+g,o.value.x>=v?(o.value.x=0,o.value.y=g):o.value.y>=v&&(o.value.y=o.value.y-v),i.visible=!1,b.matrixWorld.copy(i.matrixWorld),x.matrixWorld.copy(i.matrixWorld),b.onBeforeRender(e,t,r),x.onBeforeRender(e,t,r),i.visible=!0}}else console.error("Water2: Required component Refractor not found.");else console.error("Water2: Required component Reflector not found.")}Water.prototype=Object.create(Mesh.prototype),Water.prototype.constructor=Water,Water2.prototype=Object.create(Mesh.prototype),Water2.prototype.constructor=Water2,Water2.Water2Shader={uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new Vector4}},vertexShader:["#include <fog_pars_vertex>","uniform mat4 textureMatrix;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tvUv = uv;","\tvCoord = textureMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvToEye = cameraPosition - worldPosition.xyz;","\tvec4 mvPosition =  viewMatrix * worldPosition;","\tgl_Position = projectionMatrix * mvPosition;","\t#include <fog_vertex>","}"].join("\n"),fragmentShader:["#include <common>","#include <fog_pars_fragment>","uniform sampler2D tReflectionMap;","uniform sampler2D tRefractionMap;","uniform sampler2D tNormalMap0;","uniform sampler2D tNormalMap1;","#ifdef USE_FLOWMAP","\tuniform sampler2D tFlowMap;","#else","\tuniform vec2 flowDirection;","#endif","uniform vec3 color;","uniform float reflectivity;","uniform vec4 config;","varying vec4 vCoord;","varying vec2 vUv;","varying vec3 vToEye;","void main() {","\tfloat flowMapOffset0 = config.x;","\tfloat flowMapOffset1 = config.y;","\tfloat halfCycle = config.z;","\tfloat scale = config.w;","\tvec3 toEye = normalize( vToEye );","\tvec2 flow;","\t#ifdef USE_FLOWMAP","\t\tflow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;","\t#else","\t\tflow = flowDirection;","\t#endif","\tflow.x *= - 1.0;","\tvec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );","\tvec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );","\tfloat flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;","\tvec4 normalColor = mix( normalColor0, normalColor1, flowLerp );","\tvec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );","\tfloat theta = max( dot( toEye, normal ), 0.0 );","\tfloat reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 coord = vCoord.xyz / vCoord.w;","\tvec2 uv = coord.xy + coord.z * normal.xz * 0.05;","\tvec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );","\tvec4 refractColor = texture2D( tRefractionMap, uv );","\tgl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );","\t#include <tonemapping_fragment>","\t#include <encodings_fragment>","\t#include <fog_fragment>","}"].join("\n")};var Ocean=function(e,t,i,r){function n(e,t){return void 0!==e?e:t}this.changed=!0,this.initial=!0,this.oceanCamera=new OrthographicCamera,this.oceanCamera.position.z=1,this.renderer=e,this.renderer.clearColor(16777215),this.scene=new Scene,r=r||{},this.clearColor=n(r.CLEAR_COLOR,[1,1,1,0]),this.geometryOrigin=n(r.GEOMETRY_ORIGIN,[-1e3,-1e3]),this.sunDirectionX=n(r.SUN_DIRECTION[0],-1),this.sunDirectionY=n(r.SUN_DIRECTION[1],1),this.sunDirectionZ=n(r.SUN_DIRECTION[2],1),this.oceanColor=n(r.OCEAN_COLOR,new Vector3(.004,.016,.047)),this.skyColor=n(r.SKY_COLOR,new Vector3(3.2,9.6,12.8)),this.exposure=n(r.EXPOSURE,.35),this.geometryResolution=n(r.GEOMETRY_RESOLUTION,32),this.geometrySize=n(r.GEOMETRY_SIZE,2e3),this.resolution=n(r.RESOLUTION,64),this.floatSize=n(r.SIZE_OF_FLOAT,4),this.windX=n(r.INITIAL_WIND[0],10),this.windY=n(r.INITIAL_WIND[1],10),this.size=n(r.INITIAL_SIZE,250),this.choppiness=n(r.INITIAL_CHOPPINESS,1.5),this.matrixNeedsUpdate=!1;var o=n(r.USE_HALF_FLOAT,!1)?HalfFloatType:FloatType,a={minFilter:LinearFilter,magFilter:LinearFilter,wrapS:ClampToEdgeWrapping,wrapT:ClampToEdgeWrapping,format:RGBAFormat,stencilBuffer:!1,depthBuffer:!1,premultiplyAlpha:!1,type:o},s={minFilter:NearestFilter,magFilter:NearestFilter,wrapS:ClampToEdgeWrapping,wrapT:ClampToEdgeWrapping,format:RGBAFormat,stencilBuffer:!1,depthBuffer:!1,premultiplyAlpha:!1,type:o},l={minFilter:NearestFilter,magFilter:NearestFilter,wrapS:RepeatWrapping,wrapT:RepeatWrapping,format:RGBAFormat,stencilBuffer:!1,depthBuffer:!1,premultiplyAlpha:!1,type:o};this.initialSpectrumFramebuffer=new WebGLRenderTarget(this.resolution,this.resolution,l),this.spectrumFramebuffer=new WebGLRenderTarget(this.resolution,this.resolution,s),this.pingPhaseFramebuffer=new WebGLRenderTarget(this.resolution,this.resolution,s),this.pongPhaseFramebuffer=new WebGLRenderTarget(this.resolution,this.resolution,s),this.pingTransformFramebuffer=new WebGLRenderTarget(this.resolution,this.resolution,s),this.pongTransformFramebuffer=new WebGLRenderTarget(this.resolution,this.resolution,s),this.displacementMapFramebuffer=new WebGLRenderTarget(this.resolution,this.resolution,a),this.normalMapFramebuffer=new WebGLRenderTarget(this.resolution,this.resolution,a);var u=ShaderLib.ocean_sim_vertex,h=ShaderLib.ocean_subtransform,c=UniformsUtils.clone(h.uniforms);this.materialOceanHorizontal=new ShaderMaterial({uniforms:c,vertexShader:u.vertexShader,fragmentShader:"#define HORIZONTAL \n"+h.fragmentShader}),this.materialOceanHorizontal.uniforms.u_transformSize={value:this.resolution},this.materialOceanHorizontal.uniforms.u_subtransformSize={value:null},this.materialOceanHorizontal.uniforms.u_input={value:null},this.materialOceanHorizontal.depthTest=!1;var d=ShaderLib.ocean_subtransform,p=UniformsUtils.clone(d.uniforms);this.materialOceanVertical=new ShaderMaterial({uniforms:p,vertexShader:u.vertexShader,fragmentShader:d.fragmentShader}),this.materialOceanVertical.uniforms.u_transformSize={value:this.resolution},this.materialOceanVertical.uniforms.u_subtransformSize={value:null},this.materialOceanVertical.uniforms.u_input={value:null},this.materialOceanVertical.depthTest=!1;var f=ShaderLib.ocean_initial_spectrum,m=UniformsUtils.clone(f.uniforms);this.materialInitialSpectrum=new ShaderMaterial({uniforms:m,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader}),this.materialInitialSpectrum.uniforms.u_wind={value:new Vector2},this.materialInitialSpectrum.uniforms.u_resolution={value:this.resolution},this.materialInitialSpectrum.depthTest=!1;var v=ShaderLib.ocean_phase,g=UniformsUtils.clone(v.uniforms);this.materialPhase=new ShaderMaterial({uniforms:g,vertexShader:u.vertexShader,fragmentShader:v.fragmentShader}),this.materialPhase.uniforms.u_resolution={value:this.resolution},this.materialPhase.depthTest=!1;var y=ShaderLib.ocean_spectrum,_=UniformsUtils.clone(y.uniforms);this.materialSpectrum=new ShaderMaterial({uniforms:_,vertexShader:u.vertexShader,fragmentShader:y.fragmentShader}),this.materialSpectrum.uniforms.u_initialSpectrum={value:null},this.materialSpectrum.uniforms.u_resolution={value:this.resolution},this.materialSpectrum.depthTest=!1;var b=ShaderLib.ocean_normals,x=UniformsUtils.clone(b.uniforms);this.materialNormal=new ShaderMaterial({uniforms:x,vertexShader:u.vertexShader,fragmentShader:b.fragmentShader}),this.materialNormal.uniforms.u_displacementMap={value:null},this.materialNormal.uniforms.u_resolution={value:this.resolution},this.materialNormal.depthTest=!1;var w=ShaderLib.ocean_main,S=UniformsUtils.clone(w.uniforms);this.materialOcean=new ShaderMaterial({uniforms:S,vertexShader:w.vertexShader,fragmentShader:w.fragmentShader}),this.materialOcean.uniforms.u_geometrySize={value:this.resolution},this.materialOcean.uniforms.u_displacementMap={value:this.displacementMapFramebuffer.texture},this.materialOcean.uniforms.u_normalMap={value:this.normalMapFramebuffer.texture},this.materialOcean.uniforms.u_oceanColor={value:this.oceanColor},this.materialOcean.uniforms.u_skyColor={value:this.skyColor},this.materialOcean.uniforms.u_sunDirection={value:new Vector3(this.sunDirectionX,this.sunDirectionY,this.sunDirectionZ)},this.materialOcean.uniforms.u_exposure={value:this.exposure},this.materialOceanHorizontal.blending=0,this.materialOceanVertical.blending=0,this.materialInitialSpectrum.blending=0,this.materialPhase.blending=0,this.materialSpectrum.blending=0,this.materialNormal.blending=0,this.materialOcean.blending=0,this.screenQuad=new Mesh(new PlaneBufferGeometry(2,2)),this.scene.add(this.screenQuad),this.generateSeedPhaseTexture(),this.generateMesh()};Ocean.prototype.generateMesh=function(){var e=new PlaneBufferGeometry(this.geometrySize,this.geometrySize,this.geometryResolution,this.geometryResolution);e.rotateX(-Math.PI/2),this.oceanMesh=new Mesh(e,this.materialOcean)},Ocean.prototype.render=function(){var e=this.renderer.getRenderTarget();this.scene.overrideMaterial=null,this.changed&&this.renderInitialSpectrum(),this.renderWavePhase(),this.renderSpectrum(),this.renderSpectrumFFT(),this.renderNormalMap(),this.scene.overrideMaterial=null,this.renderer.setRenderTarget(e)},Ocean.prototype.generateSeedPhaseTexture=function(){this.pingPhase=!0;for(var e=new window.Float32Array(this.resolution*this.resolution*4),t=0;t<this.resolution;t++)for(var i=0;i<this.resolution;i++)e[t*this.resolution*4+4*i]=2*Math.random()*Math.PI,e[t*this.resolution*4+4*i+1]=0,e[t*this.resolution*4+4*i+2]=0,e[t*this.resolution*4+4*i+3]=0;this.pingPhaseTexture=new DataTexture(e,this.resolution,this.resolution,RGBAFormat),this.pingPhaseTexture.wrapS=ClampToEdgeWrapping,this.pingPhaseTexture.wrapT=ClampToEdgeWrapping,this.pingPhaseTexture.type=FloatType,this.pingPhaseTexture.needsUpdate=!0},Ocean.prototype.renderInitialSpectrum=function(){this.scene.overrideMaterial=this.materialInitialSpectrum,this.materialInitialSpectrum.uniforms.u_wind.value.set(this.windX,this.windY),this.materialInitialSpectrum.uniforms.u_size.value=this.size,this.renderer.setRenderTarget(this.initialSpectrumFramebuffer),this.renderer.clear(),this.renderer.render(this.scene,this.oceanCamera)},Ocean.prototype.renderWavePhase=function(){this.scene.overrideMaterial=this.materialPhase,this.screenQuad.material=this.materialPhase,this.initial?(this.materialPhase.uniforms.u_phases.value=this.pingPhaseTexture,this.initial=!1):this.materialPhase.uniforms.u_phases.value=this.pingPhase?this.pingPhaseFramebuffer.texture:this.pongPhaseFramebuffer.texture,this.materialPhase.uniforms.u_deltaTime.value=this.deltaTime,this.materialPhase.uniforms.u_size.value=this.size,this.renderer.setRenderTarget(this.pingPhase?this.pongPhaseFramebuffer:this.pingPhaseFramebuffer),this.renderer.render(this.scene,this.oceanCamera),this.pingPhase=!this.pingPhase},Ocean.prototype.renderSpectrum=function(){this.scene.overrideMaterial=this.materialSpectrum,this.materialSpectrum.uniforms.u_initialSpectrum.value=this.initialSpectrumFramebuffer.texture,this.materialSpectrum.uniforms.u_phases.value=this.pingPhase?this.pingPhaseFramebuffer.texture:this.pongPhaseFramebuffer.texture,this.materialSpectrum.uniforms.u_choppiness.value=this.choppiness,this.materialSpectrum.uniforms.u_size.value=this.size,this.renderer.setRenderTarget(this.spectrumFramebuffer),this.renderer.render(this.scene,this.oceanCamera)},Ocean.prototype.renderSpectrumFFT=function(){var e=Math.log(this.resolution)/Math.log(2);this.scene.overrideMaterial=this.materialOceanHorizontal;for(var t=0;t<e;t++)0===t?(this.materialOceanHorizontal.uniforms.u_input.value=this.spectrumFramebuffer.texture,this.materialOceanHorizontal.uniforms.u_subtransformSize.value=Math.pow(2,t%e+1),this.renderer.setRenderTarget(this.pingTransformFramebuffer),this.renderer.render(this.scene,this.oceanCamera)):t%2==1?(this.materialOceanHorizontal.uniforms.u_input.value=this.pingTransformFramebuffer.texture,this.materialOceanHorizontal.uniforms.u_subtransformSize.value=Math.pow(2,t%e+1),this.renderer.setRenderTarget(this.pongTransformFramebuffer),this.renderer.render(this.scene,this.oceanCamera)):(this.materialOceanHorizontal.uniforms.u_input.value=this.pongTransformFramebuffer.texture,this.materialOceanHorizontal.uniforms.u_subtransformSize.value=Math.pow(2,t%e+1),this.renderer.setRenderTarget(this.pingTransformFramebuffer),this.renderer.render(this.scene,this.oceanCamera));this.scene.overrideMaterial=this.materialOceanVertical;for(t=e;t<2*e;t++)t===2*e-1?(this.materialOceanVertical.uniforms.u_input.value=e%2==0?this.pingTransformFramebuffer.texture:this.pongTransformFramebuffer.texture,this.materialOceanVertical.uniforms.u_subtransformSize.value=Math.pow(2,t%e+1),this.renderer.setRenderTarget(this.displacementMapFramebuffer),this.renderer.render(this.scene,this.oceanCamera)):t%2==1?(this.materialOceanVertical.uniforms.u_input.value=this.pingTransformFramebuffer.texture,this.materialOceanVertical.uniforms.u_subtransformSize.value=Math.pow(2,t%e+1),this.renderer.setRenderTarget(this.pongTransformFramebuffer),this.renderer.render(this.scene,this.oceanCamera)):(this.materialOceanVertical.uniforms.u_input.value=this.pongTransformFramebuffer.texture,this.materialOceanVertical.uniforms.u_subtransformSize.value=Math.pow(2,t%e+1),this.renderer.setRenderTarget(this.pingTransformFramebuffer),this.renderer.render(this.scene,this.oceanCamera))},Ocean.prototype.renderNormalMap=function(){this.scene.overrideMaterial=this.materialNormal,this.changed&&(this.materialNormal.uniforms.u_size.value=this.size),this.materialNormal.uniforms.u_displacementMap.value=this.displacementMapFramebuffer.texture,this.renderer.setRenderTarget(this.normalMapFramebuffer),this.renderer.clear(),this.renderer.render(this.scene,this.oceanCamera)};var PMREMCubeUVPacker=function(){var e,t=new OrthographicCamera,i=new Scene,r=((e=new ShaderMaterial({uniforms:{faceIndex:{value:0},mapSize:{value:0},envMap:{value:null},testColor:{value:new Vector3(1,1,1)}},vertexShader:"precision highp float;        varying vec2 vUv;        void main() {          vUv = uv;          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );        }",fragmentShader:"precision highp float;        varying vec2 vUv;        uniform samplerCube envMap;        uniform float mapSize;        uniform vec3 testColor;        uniform int faceIndex;                void main() {          vec3 sampleDirection;          vec2 uv = vUv;          uv = uv * 2.0 - 1.0;          uv.y *= -1.0;          if(faceIndex == 0) {            sampleDirection = normalize(vec3(1.0, uv.y, -uv.x));          } else if(faceIndex == 1) {            sampleDirection = normalize(vec3(uv.x, 1.0, uv.y));          } else if(faceIndex == 2) {            sampleDirection = normalize(vec3(uv.x, uv.y, 1.0));          } else if(faceIndex == 3) {            sampleDirection = normalize(vec3(-1.0, uv.y, uv.x));          } else if(faceIndex == 4) {            sampleDirection = normalize(vec3(uv.x, -1.0, -uv.y));          } else {            sampleDirection = normalize(vec3(-uv.x, uv.y, -1.0));          }          vec4 color = envMapTexelToLinear( textureCube( envMap, sampleDirection ) );          gl_FragColor = linearToOutputTexel( color );        }",blending:NoBlending})).type="PMREMCubeUVPacker",e),n=function(e){this.cubeLods=e;var t=4*e[0].width,i=e[0].texture,n={format:i.format,magFilter:i.magFilter,minFilter:i.minFilter,type:i.type,generateMipmaps:i.generateMipmaps,anisotropy:i.anisotropy,encoding:i.encoding===RGBEEncoding?RGBM16Encoding:i.encoding};n.encoding===RGBM16Encoding&&(n.magFilter=LinearFilter,n.minFilter=LinearFilter),this.CubeUVRenderTarget=new WebGLRenderTarget(t,t,n),this.CubeUVRenderTarget.texture.name="PMREMCubeUVPacker.cubeUv",this.CubeUVRenderTarget.texture.mapping=CubeUVReflectionMapping,this.objects=[];var o=new PlaneBufferGeometry(1,1),a=[];a.push(new Vector2(0,0)),a.push(new Vector2(1,0)),a.push(new Vector2(2,0)),a.push(new Vector2(0,1)),a.push(new Vector2(1,1)),a.push(new Vector2(2,1));var s=t;t=e[0].width;var l=0,u=4;this.numLods=Math.log(e[0].width)/Math.log(2)-2;for(var h=0;h<this.numLods;h++){var c=.5*(s-s/u);t>16&&(u*=2);for(var d=t>16?6:1,p=0,f=0,m=t,v=0;v<d;v++){for(var g=0;g<6;g++){var y=r.clone();y.uniforms.envMap.value=this.cubeLods[h].texture,y.envMap=this.cubeLods[h].texture,y.uniforms.faceIndex.value=g,y.uniforms.mapSize.value=m;var _=new Mesh(o,y);_.position.x=a[g].x*m-c+p,_.position.y=a[g].y*m-c+l+f,_.material.side=BackSide,_.scale.setScalar(m),this.objects.push(_)}f+=1.75*m,p+=1.25*m,m/=2}l+=2*t,t>16&&(t/=2)}};return n.prototype={constructor:n,update:function(e){var r=4*this.cubeLods[0].width;t.left=.5*-r,t.right=.5*r,t.top=.5*-r,t.bottom=.5*r,t.near=0,t.far=1,t.updateProjectionMatrix();for(var n=0;n<this.objects.length;n++)i.add(this.objects[n]);var o=e.gammaInput,a=e.gammaOutput,s=e.toneMapping,l=e.toneMappingExposure,u=e.getRenderTarget();e.gammaInput=!1,e.gammaOutput=!1,e.toneMapping=LinearToneMapping,e.toneMappingExposure=1,e.setRenderTarget(this.CubeUVRenderTarget),e.render(i,t),e.setRenderTarget(u),e.toneMapping=s,e.toneMappingExposure=l,e.gammaInput=o,e.gammaOutput=a;for(n=0;n<this.objects.length;n++)i.remove(this.objects[n])},dispose:function(){for(var e=0,t=this.objects.length;e<t;e++)this.objects[e].material.dispose();this.objects[0].geometry.dispose()}},n}(),PMREMGenerator=function(){var e,t=((e=new ShaderMaterial({defines:{SAMPLES_PER_LEVEL:20},uniforms:{faceIndex:{value:0},roughness:{value:.5},mapSize:{value:.5},envMap:{value:null},tFlip:{value:-1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform int faceIndex;\n\t\t\t\tuniform float roughness;\n\t\t\t\tuniform samplerCube envMap;\n\t\t\t\tuniform float mapSize;\n\t\t\t\tuniform float tFlip;\n\t\t\t\t\n\t\t\t\tfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\t\t\t\t\tfloat a = ggxRoughness + 0.0001;\n\t\t\t\t\ta *= a;\n\t\t\t\t\treturn ( 2.0 / a - 2.0 );\n\t\t\t\t}\n\t\t\t\tvec3 ImportanceSamplePhong(vec2 uv, mat3 vecSpace, float specPow) {\n\t\t\t\t\tfloat phi = uv.y * 2.0 * PI;\n\t\t\t\t\tfloat cosTheta = pow(1.0 - uv.x, 1.0 / (specPow + 1.0));\n\t\t\t\t\tfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\n\t\t\t\t\tvec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\n\t\t\t\t\treturn vecSpace * sampleDir;\n\t\t\t\t}\n\t\t\t\tvec3 ImportanceSampleGGX( vec2 uv, mat3 vecSpace, float Roughness )\n\t\t\t\t{\n\t\t\t\t\tfloat a = Roughness * Roughness;\n\t\t\t\t\tfloat Phi = 2.0 * PI * uv.x;\n\t\t\t\t\tfloat CosTheta = sqrt( (1.0 - uv.y) / ( 1.0 + (a*a - 1.0) * uv.y ) );\n\t\t\t\t\tfloat SinTheta = sqrt( 1.0 - CosTheta * CosTheta );\n\t\t\t\t\treturn vecSpace * vec3(SinTheta * cos( Phi ), SinTheta * sin( Phi ), CosTheta);\n\t\t\t\t}\n\t\t\t\tmat3 matrixFromVector(vec3 n) {\n\t\t\t\t\tfloat a = 1.0 / (1.0 + n.z);\n\t\t\t\t\tfloat b = -n.x * n.y * a;\n\t\t\t\t\tvec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\n\t\t\t\t\tvec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\n\t\t\t\t\treturn mat3(b1, b2, n);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvec4 testColorMap(float Roughness) {\n\t\t\t\t\tvec4 color;\n\t\t\t\t\tif(faceIndex == 0)\n\t\t\t\t\t\tcolor = vec4(1.0,0.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 1)\n\t\t\t\t\t\tcolor = vec4(0.0,1.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 2)\n\t\t\t\t\t\tcolor = vec4(0.0,0.0,1.0,1.0);\n\t\t\t\t\telse if(faceIndex == 3)\n\t\t\t\t\t\tcolor = vec4(1.0,1.0,0.0,1.0);\n\t\t\t\t\telse if(faceIndex == 4)\n\t\t\t\t\t\tcolor = vec4(0.0,1.0,1.0,1.0);\n\t\t\t\t\telse\n\t\t\t\t\t\tcolor = vec4(1.0,0.0,1.0,1.0);\n\t\t\t\t\tcolor *= ( 1.0 - Roughness );\n\t\t\t\t\treturn color;\n\t\t\t\t}\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec3 sampleDirection;\n\t\t\t\t\tvec2 uv = vUv*2.0 - 1.0;\n\t\t\t\t\tfloat offset = -1.0/mapSize;\n\t\t\t\t\tconst float a = -1.0;\n\t\t\t\t\tconst float b = 1.0;\n\t\t\t\t\tfloat c = -1.0 + offset;\n\t\t\t\t\tfloat d = 1.0 - offset;\n\t\t\t\t\tfloat bminusa = b - a;\n\t\t\t\t\tuv.x = (uv.x - a)/bminusa * d - (uv.x - b)/bminusa * c;\n\t\t\t\t\tuv.y = (uv.y - a)/bminusa * d - (uv.y - b)/bminusa * c;\n\t\t\t\t\tif (faceIndex==0) {\n\t\t\t\t\t\tsampleDirection = vec3(1.0, -uv.y, -uv.x);\n\t\t\t\t\t} else if (faceIndex==1) {\n\t\t\t\t\t\tsampleDirection = vec3(-1.0, -uv.y, uv.x);\n\t\t\t\t\t} else if (faceIndex==2) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, 1.0, uv.y);\n\t\t\t\t\t} else if (faceIndex==3) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, -1.0, -uv.y);\n\t\t\t\t\t} else if (faceIndex==4) {\n\t\t\t\t\t\tsampleDirection = vec3(uv.x, -uv.y, 1.0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsampleDirection = vec3(-uv.x, -uv.y, -1.0);\n\t\t\t\t\t}\n\t\t\t\t\tvec3 correctedDirection = vec3( tFlip * sampleDirection.x, sampleDirection.yz );\n\t\t\t\t\tmat3 vecSpace = matrixFromVector( normalize( correctedDirection ) );\n\t\t\t\t\tvec3 rgbColor = vec3(0.0);\n\t\t\t\t\tconst int NumSamples = SAMPLES_PER_LEVEL;\n\t\t\t\t\tvec3 vect;\n\t\t\t\t\tfloat weight = 0.0;\n\t\t\t\t\tfor( int i = 0; i < NumSamples; i ++ ) {\n\t\t\t\t\t\tfloat sini = sin(float(i));\n\t\t\t\t\t\tfloat cosi = cos(float(i));\n\t\t\t\t\t\tfloat r = rand(vec2(sini, cosi));\n\t\t\t\t\t\tvect = ImportanceSampleGGX(vec2(float(i) / float(NumSamples), r), vecSpace, roughness);\n\t\t\t\t\t\tfloat dotProd = dot(vect, normalize(sampleDirection));\n\t\t\t\t\t\tweight += dotProd;\n\t\t\t\t\t\tvec3 color = envMapTexelToLinear(textureCube(envMap, vect)).rgb;\n\t\t\t\t\t\trgbColor.rgb += color;\n\t\t\t\t\t}\n\t\t\t\t\trgbColor /= float(NumSamples);\n\t\t\t\t\t//rgbColor = testColorMap( roughness ).rgb;\n\t\t\t\t\tgl_FragColor = linearToOutputTexel( vec4( rgbColor, 1.0 ) );\n\t\t\t\t}",blending:NoBlending})).type="PMREMGenerator",e),i=new OrthographicCamera(-1,1,1,-1,0,1e3),r=new Scene,n=new Mesh(new PlaneBufferGeometry(2,2,0),t);n.material.side=DoubleSide,r.add(n),r.add(i);var o=function(e,t,i){this.sourceTexture=e,this.resolution=void 0!==i?i:256,this.samplesPerLevel=void 0!==t?t:32;var r=this.sourceTexture.encoding===LinearEncoding||this.sourceTexture.encoding===GammaEncoding||this.sourceTexture.encoding===sRGBEncoding;this.sourceTexture.minFilter=r?LinearFilter:NearestFilter,this.sourceTexture.magFilter=r?LinearFilter:NearestFilter,this.sourceTexture.generateMipmaps=this.sourceTexture.generateMipmaps&&r,this.cubeLods=[];var n=this.resolution,o={format:this.sourceTexture.format,magFilter:this.sourceTexture.magFilter,minFilter:this.sourceTexture.minFilter,type:this.sourceTexture.type,generateMipmaps:this.sourceTexture.generateMipmaps,anisotropy:this.sourceTexture.anisotropy,encoding:this.sourceTexture.encoding};this.numLods=Math.log(n)/Math.log(2)-2;for(var a=0;a<this.numLods;a++){var s=new WebGLRenderTargetCube(n,n,o);s.texture.name="PMREMGenerator.cube"+a,this.cubeLods.push(s),n=Math.max(16,n/2)}};return o.prototype={constructor:o,update:function(e){var i=this.sourceTexture.isCubeTexture?-1:1;t.defines.SAMPLES_PER_LEVEL=this.samplesPerLevel,t.uniforms.faceIndex.value=0,t.uniforms.envMap.value=this.sourceTexture,t.envMap=this.sourceTexture,t.needsUpdate=!0;var r=e.gammaInput,n=e.gammaOutput,o=e.toneMapping,a=e.toneMappingExposure,s=e.getRenderTarget();e.toneMapping=LinearToneMapping,e.toneMappingExposure=1,e.gammaInput=!1,e.gammaOutput=!1;for(var l=0;l<this.numLods;l++){var u=l/(this.numLods-1);t.uniforms.roughness.value=.9*u,t.uniforms.tFlip.value=0==l?i:1;var h=this.cubeLods[l].width;t.uniforms.mapSize.value=h,this.renderToCubeMapTarget(e,this.cubeLods[l]),l<5&&(t.uniforms.envMap.value=this.cubeLods[l].texture)}e.setRenderTarget(s),e.toneMapping=o,e.toneMappingExposure=a,e.gammaInput=r,e.gammaOutput=n},renderToCubeMapTarget:function(e,t){for(var i=0;i<6;i++)this.renderToCubeMapTargetFace(e,t,i)},renderToCubeMapTargetFace:function(e,n,o){t.uniforms.faceIndex.value=o,e.setRenderTarget(n,o),e.clear(),e.render(r,i)},dispose:function(){for(var e=0,t=this.cubeLods.length;e<t;e++)this.cubeLods[e].dispose()}},o}(),CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},LuminosityShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","float l = linearToRelativeLuminance( texel.rgb );","gl_FragColor = vec4( l, l, l, texel.w );","}"].join("\n")},ToneMapShader={uniforms:{tDiffuse:{value:null},averageLuminance:{value:1},luminanceMap:{value:null},maxLuminance:{value:16},minLuminance:{value:.01},middleGrey:{value:.6}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform float middleGrey;","uniform float minLuminance;","uniform float maxLuminance;","#ifdef ADAPTED_LUMINANCE","uniform sampler2D luminanceMap;","#else","uniform float averageLuminance;","#endif","vec3 ToneMap( vec3 vColor ) {","#ifdef ADAPTED_LUMINANCE","float fLumAvg = texture2D(luminanceMap, vec2(0.5, 0.5)).r;","#else","float fLumAvg = averageLuminance;","#endif","float fLumPixel = linearToRelativeLuminance( vColor );","float fLumScaled = (fLumPixel * middleGrey) / max( minLuminance, fLumAvg );","float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (maxLuminance * maxLuminance)))) / (1.0 + fLumScaled);","return fLumCompressed * vColor;","}","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = vec4( ToneMap( texel.xyz ), texel.w );","}"].join("\n")},AdaptiveToneMappingPass=function(e,t){Pass.call(this),this.resolution=void 0!==t?t:256,this.needsInit=!0,this.adaptive=void 0===e||!!e,this.luminanceRT=null,this.previousLuminanceRT=null,this.currentLuminanceRT=null,void 0===CopyShader&&console.error("AdaptiveToneMappingPass relies on CopyShader");var i=CopyShader;this.copyUniforms=UniformsUtils.clone(i.uniforms),this.materialCopy=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,blending:NoBlending,depthTest:!1}),void 0===LuminosityShader&&console.error("AdaptiveToneMappingPass relies on LuminosityShader"),this.materialLuminance=new ShaderMaterial({uniforms:UniformsUtils.clone(LuminosityShader.uniforms),vertexShader:LuminosityShader.vertexShader,fragmentShader:LuminosityShader.fragmentShader,blending:NoBlending}),this.adaptLuminanceShader={defines:{MIP_LEVEL_1X1:(Math.log(this.resolution)/Math.log(2)).toFixed(1)},uniforms:{lastLum:{value:null},currentLum:{value:null},minLuminance:{value:.01},delta:{value:.016},tau:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D lastLum;","uniform sampler2D currentLum;","uniform float minLuminance;","uniform float delta;","uniform float tau;","void main() {","\tvec4 lastLum = texture2D( lastLum, vUv, MIP_LEVEL_1X1 );","\tvec4 currentLum = texture2D( currentLum, vUv, MIP_LEVEL_1X1 );","\tfloat fLastLum = max( minLuminance, lastLum.r );","\tfloat fCurrentLum = max( minLuminance, currentLum.r );","\tfCurrentLum *= fCurrentLum;","\tfloat fAdaptedLum = fLastLum + (fCurrentLum - fLastLum) * (1.0 - exp(-delta * tau));","\tgl_FragColor.r = fAdaptedLum;","}"].join("\n")},this.materialAdaptiveLum=new ShaderMaterial({uniforms:UniformsUtils.clone(this.adaptLuminanceShader.uniforms),vertexShader:this.adaptLuminanceShader.vertexShader,fragmentShader:this.adaptLuminanceShader.fragmentShader,defines:Object.assign({},this.adaptLuminanceShader.defines),blending:NoBlending}),void 0===ToneMapShader&&console.error("AdaptiveToneMappingPass relies on ToneMapShader"),this.materialToneMap=new ShaderMaterial({uniforms:UniformsUtils.clone(ToneMapShader.uniforms),vertexShader:ToneMapShader.vertexShader,fragmentShader:ToneMapShader.fragmentShader,blending:NoBlending}),this.camera=new OrthographicCamera(-1,1,1,-1,0,1),this.scene=new Scene,this.quad=new Mesh(new PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};AdaptiveToneMappingPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:AdaptiveToneMappingPass,render:function(e,t,i,r,n){this.needsInit&&(this.reset(e),this.luminanceRT.texture.type=i.texture.type,this.previousLuminanceRT.texture.type=i.texture.type,this.currentLuminanceRT.texture.type=i.texture.type,this.needsInit=!1),this.adaptive&&(this.quad.material=this.materialLuminance,this.materialLuminance.uniforms.tDiffuse.value=i.texture,e.setRenderTarget(this.currentLuminanceRT),e.render(this.scene,this.camera),this.quad.material=this.materialAdaptiveLum,this.materialAdaptiveLum.uniforms.delta.value=r,this.materialAdaptiveLum.uniforms.lastLum.value=this.previousLuminanceRT.texture,this.materialAdaptiveLum.uniforms.currentLum.value=this.currentLuminanceRT.texture,e.setRenderTarget(this.luminanceRT),e.render(this.scene,this.camera),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.luminanceRT.texture,e.setRenderTarget(this.previousLuminanceRT),e.render(this.scene,this.camera)),this.quad.material=this.materialToneMap,this.materialToneMap.uniforms.tDiffuse.value=i.texture,this.renderToScreen?(e.setRenderTarget(null),e.render(this.scene,this.camera)):(e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera))},reset:function(e){this.luminanceRT&&this.luminanceRT.dispose(),this.currentLuminanceRT&&this.currentLuminanceRT.dispose(),this.previousLuminanceRT&&this.previousLuminanceRT.dispose();var t={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat};this.luminanceRT=new WebGLRenderTarget(this.resolution,this.resolution,t),this.luminanceRT.texture.name="AdaptiveToneMappingPass.l",this.luminanceRT.texture.generateMipmaps=!1,this.previousLuminanceRT=new WebGLRenderTarget(this.resolution,this.resolution,t),this.previousLuminanceRT.texture.name="AdaptiveToneMappingPass.pl",this.previousLuminanceRT.texture.generateMipmaps=!1,t.minFilter=LinearMipMapLinearFilter,t.generateMipmaps=!0,this.currentLuminanceRT=new WebGLRenderTarget(this.resolution,this.resolution,t),this.currentLuminanceRT.texture.name="AdaptiveToneMappingPass.cl",this.adaptive&&(this.materialToneMap.defines.ADAPTED_LUMINANCE="",this.materialToneMap.uniforms.luminanceMap.value=this.luminanceRT.texture),this.quad.material=new MeshBasicMaterial({color:7829367}),this.materialLuminance.needsUpdate=!0,this.materialAdaptiveLum.needsUpdate=!0,this.materialToneMap.needsUpdate=!0},setAdaptive:function(e){e?(this.adaptive=!0,this.materialToneMap.defines.ADAPTED_LUMINANCE="",this.materialToneMap.uniforms.luminanceMap.value=this.luminanceRT.texture):(this.adaptive=!1,delete this.materialToneMap.defines.ADAPTED_LUMINANCE,this.materialToneMap.uniforms.luminanceMap.value=null),this.materialToneMap.needsUpdate=!0},setAdaptionRate:function(e){e&&(this.materialAdaptiveLum.uniforms.tau.value=Math.abs(e))},setMinLuminance:function(e){e&&(this.materialToneMap.uniforms.minLuminance.value=e,this.materialAdaptiveLum.uniforms.minLuminance.value=e)},setMaxLuminance:function(e){e&&(this.materialToneMap.uniforms.maxLuminance.value=e)},setAverageLuminance:function(e){e&&(this.materialToneMap.uniforms.averageLuminance.value=e)},setMiddleGrey:function(e){e&&(this.materialToneMap.uniforms.middleGrey.value=e)},dispose:function(){this.luminanceRT&&this.luminanceRT.dispose(),this.previousLuminanceRT&&this.previousLuminanceRT.dispose(),this.currentLuminanceRT&&this.currentLuminanceRT.dispose(),this.materialLuminance&&this.materialLuminance.dispose(),this.materialAdaptiveLum&&this.materialAdaptiveLum.dispose(),this.materialCopy&&this.materialCopy.dispose(),this.materialToneMap&&this.materialToneMap.dispose()}});var AfterimageShader={uniforms:{damp:{value:.96},tOld:{value:null},tNew:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float damp;","uniform sampler2D tOld;","uniform sampler2D tNew;","varying vec2 vUv;","vec4 when_gt( vec4 x, float y ) {","return max( sign( x - y ), 0.0 );","}","void main() {","vec4 texelOld = texture2D( tOld, vUv );","vec4 texelNew = texture2D( tNew, vUv );","texelOld *= damp * when_gt( texelOld, 0.1 );","gl_FragColor = max(texelNew, texelOld);","}"].join("\n")},AfterimagePass=function(e){Pass.call(this),void 0===AfterimageShader&&console.error("AfterimagePass relies on AfterimageShader"),this.shader=AfterimageShader,this.uniforms=UniformsUtils.clone(this.shader.uniforms),this.uniforms.damp.value=void 0!==e?e:.96,this.textureComp=new WebGLRenderTarget(window.innerWidth,window.innerHeight,{minFilter:LinearFilter,magFilter:NearestFilter,format:RGBAFormat}),this.textureOld=new WebGLRenderTarget(window.innerWidth,window.innerHeight,{minFilter:LinearFilter,magFilter:NearestFilter,format:RGBAFormat}),this.shaderMaterial=new ShaderMaterial({uniforms:this.uniforms,vertexShader:this.shader.vertexShader,fragmentShader:this.shader.fragmentShader}),this.sceneComp=new Scene,this.scene=new Scene,this.camera=new OrthographicCamera(-1,1,1,-1,0,1),this.camera.position.z=1;var t=new PlaneBufferGeometry(2,2);this.quadComp=new Mesh(t,this.shaderMaterial),this.sceneComp.add(this.quadComp);var i=new Mesh(t,new MeshBasicMaterial({map:this.textureComp.texture}));this.scene.add(i)};AfterimagePass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:AfterimagePass,render:function(e,t,i){this.uniforms.tOld.value=this.textureOld.texture,this.uniforms.tNew.value=i.texture,this.quadComp.material=this.shaderMaterial,e.setRenderTarget(this.textureComp),e.render(this.sceneComp,this.camera),e.setRenderTarget(this.textureOld),e.render(this.scene,this.camera),this.renderToScreen?(e.setRenderTarget(null),e.render(this.scene,this.camera)):(e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera))}});var ConvolutionShader={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new Vector2(.001953125,0)},cKernel:{value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vec2 imageCoord = vUv;","vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","imageCoord += uImageIncrement;","}","gl_FragColor = sum;","}"].join("\n"),buildKernel:function(e){function t(e,t){return Math.exp(-e*e/(2*t*t))}var i,r,n,o,a=2*Math.ceil(3*e)+1;for(a>25&&(a=25),o=.5*(a-1),r=new Array(a),n=0,i=0;i<a;++i)r[i]=t(i-o,e),n+=r[i];for(i=0;i<a;++i)r[i]/=n;return r}},BloomPass=function(e,t,i,r){Pass.call(this),e=void 0!==e?e:1,t=void 0!==t?t:25,i=void 0!==i?i:4,r=void 0!==r?r:256;var n={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat};this.renderTargetX=new WebGLRenderTarget(r,r,n),this.renderTargetX.texture.name="BloomPass.x",this.renderTargetY=new WebGLRenderTarget(r,r,n),this.renderTargetY.texture.name="BloomPass.y",void 0===CopyShader&&console.error("BloomPass relies on CopyShader");var o=CopyShader;this.copyUniforms=UniformsUtils.clone(o.uniforms),this.copyUniforms.opacity.value=e,this.materialCopy=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:AdditiveBlending,transparent:!0}),void 0===ConvolutionShader&&console.error("BloomPass relies on ConvolutionShader");var a=ConvolutionShader;this.convolutionUniforms=UniformsUtils.clone(a.uniforms),this.convolutionUniforms.uImageIncrement.value=BloomPass.blurX,this.convolutionUniforms.cKernel.value=ConvolutionShader.buildKernel(i),this.materialConvolution=new ShaderMaterial({uniforms:this.convolutionUniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,defines:{KERNEL_SIZE_FLOAT:t.toFixed(1),KERNEL_SIZE_INT:t.toFixed(0)}}),this.needsSwap=!1,this.camera=new OrthographicCamera(-1,1,1,-1,0,1),this.scene=new Scene,this.quad=new Mesh(new PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};BloomPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:BloomPass,render:function(e,t,i,r,n){n&&e.context.disable(e.context.STENCIL_TEST),this.quad.material=this.materialConvolution,this.convolutionUniforms.tDiffuse.value=i.texture,this.convolutionUniforms.uImageIncrement.value=BloomPass.blurX,e.setRenderTarget(this.renderTargetX),e.clear(),e.render(this.scene,this.camera),this.convolutionUniforms.tDiffuse.value=this.renderTargetX.texture,this.convolutionUniforms.uImageIncrement.value=BloomPass.blurY,e.setRenderTarget(this.renderTargetY),e.clear(),e.render(this.scene,this.camera),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetY.texture,n&&e.context.enable(e.context.STENCIL_TEST),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera)}}),BloomPass.blurX=new Vector2(.001953125,0),BloomPass.blurY=new Vector2(0,.001953125);var BokehPass=function(e,t,i){Pass.call(this),this.scene=e,this.camera=t;var r=void 0!==i.focus?i.focus:1,n=void 0!==i.aspect?i.aspect:t.aspect,o=void 0!==i.aperture?i.aperture:.025,a=void 0!==i.maxblur?i.maxblur:1,s=i.width||window.innerWidth||1,l=i.height||window.innerHeight||1;this.renderTargetColor=new WebGLRenderTarget(s,l,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat}),this.renderTargetColor.texture.name="BokehPass.color",this.renderTargetDepth=this.renderTargetColor.clone(),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new MeshDepthMaterial,this.materialDepth.depthPacking=RGBADepthPacking,this.materialDepth.blending=NoBlending,void 0===BokehShader&&console.error("BokehPass relies on BokehShader");var u=BokehShader,h=UniformsUtils.clone(u.uniforms);h.tDepth.value=this.renderTargetDepth.texture,h.focus.value=r,h.aspect.value=n,h.aperture.value=o,h.maxblur.value=a,h.nearClip.value=t.near,h.farClip.value=t.far,this.materialBokeh=new ShaderMaterial({defines:Object.assign({},u.defines),uniforms:h,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader}),this.uniforms=h,this.needsSwap=!1,this.camera2=new OrthographicCamera(-1,1,1,-1,0,1),this.scene2=new Scene,this.quad2=new Mesh(new PlaneBufferGeometry(2,2),null),this.quad2.frustumCulled=!1,this.scene2.add(this.quad2),this.oldClearColor=new Color,this.oldClearAlpha=1};BokehPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:BokehPass,render:function(e,t,i,r,n){this.quad2.material=this.materialBokeh,this.scene.overrideMaterial=this.materialDepth,this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();e.autoClear;e.autoClear=!1,e.setClearColor(16777215),e.setClearAlpha(1),e.setRenderTarget(this.renderTargetDepth),e.clear(),e.render(this.scene,this.camera),this.uniforms.tColor.value=i.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.renderToScreen?(e.setRenderTarget(null),e.render(this.scene2,this.camera2)):(e.setRenderTarget(t),e.clear(),e.render(this.scene2,this.camera2)),this.scene.overrideMaterial=null,e.setClearColor(this.oldClearColor),e.setClearAlpha(this.oldClearAlpha),e.autoClear=this.oldAutoClear}});var ClearPass=function(e,t){Pass.call(this),this.needsSwap=!1,this.clearColor=void 0!==e?e:0,this.clearAlpha=void 0!==t?t:0};ClearPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:ClearPass,render:function(e,t,i,r,n){var o,a;this.clearColor&&(o=e.getClearColor().getHex(),a=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),e.setRenderTarget(this.renderToScreen?null:i),e.clear(),this.clearColor&&e.setClearColor(o,a)}});var CubeTexturePass=function(e,t,i){Pass.call(this),this.camera=e,this.needsSwap=!1,this.cubeShader=ShaderLib.cube,this.cubeMesh=new Mesh(new BoxBufferGeometry(10,10,10),new ShaderMaterial({uniforms:this.cubeShader.uniforms,vertexShader:this.cubeShader.vertexShader,fragmentShader:this.cubeShader.fragmentShader,depthTest:!1,depthWrite:!1,side:BackSide})),this.envMap=t,this.opacity=void 0!==i?i:1,this.cubeScene=new Scene,this.cubeCamera=new PerspectiveCamera,this.cubeScene.add(this.cubeMesh)};CubeTexturePass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:CubeTexturePass,render:function(e,t,i,r,n){var o=e.autoClear;e.autoClear=!1,this.cubeCamera.projectionMatrix.copy(this.camera.projectionMatrix),this.cubeCamera.quaternion.setFromRotationMatrix(this.camera.matrixWorld),this.cubeMesh.material.uniforms.tCube.value=this.envMap,this.cubeMesh.material.uniforms.opacity.value=this.opacity,this.cubeMesh.material.transparent=this.opacity<1,e.setRenderTarget(this.renderToScreen?null:i),this.clear&&e.clear(),e.render(this.cubeScene,this.cubeCamera),e.autoClear=o}});var DotScreenShader={uniforms:{tDiffuse:{value:null},tSize:{value:new Vector2(256,256)},center:{value:new Vector2(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","float s = sin( angle ), c = cos( angle );","vec2 tex = vUv * tSize - center;","vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","return ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","vec4 color = texture2D( tDiffuse, vUv );","float average = ( color.r + color.g + color.b ) / 3.0;","gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")},DotScreenPass=function(e,t,i){Pass.call(this),void 0===DotScreenShader&&console.error("DotScreenPass relies on DotScreenShader");var r=DotScreenShader;this.uniforms=UniformsUtils.clone(r.uniforms),void 0!==e&&this.uniforms.center.value.copy(e),void 0!==t&&(this.uniforms.angle.value=t),void 0!==i&&(this.uniforms.scale.value=i),this.material=new ShaderMaterial({uniforms:this.uniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}),this.camera=new OrthographicCamera(-1,1,1,-1,0,1),this.scene=new Scene,this.quad=new Mesh(new PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};DotScreenPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:DotScreenPass,render:function(e,t,i,r,n){this.uniforms.tDiffuse.value=i.texture,this.uniforms.tSize.value.set(i.width,i.height),this.quad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),e.render(this.scene,this.camera)):(e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera))}});var MaskPass=function(e,t){Pass.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1};MaskPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:MaskPass,render:function(e,t,i,r,n){var o,a,s=e.context,l=e.state;l.buffers.color.setMask(!1),l.buffers.depth.setMask(!1),l.buffers.color.setLocked(!0),l.buffers.depth.setLocked(!0),this.inverse?(o=0,a=1):(o=1,a=0),l.buffers.stencil.setTest(!0),l.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),l.buffers.stencil.setFunc(s.ALWAYS,o,4294967295),l.buffers.stencil.setClear(a),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),l.buffers.color.setLocked(!1),l.buffers.depth.setLocked(!1),l.buffers.stencil.setFunc(s.EQUAL,1,4294967295),l.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP)}});var ClearMaskPass=function(){Pass.call(this),this.needsSwap=!1};ClearMaskPass.prototype=Object.create(Pass.prototype),Object.assign(ClearMaskPass.prototype,{render:function(e,t,i,r,n){e.state.buffers.stencil.setTest(!1)}});var EffectComposer=function(e,t){if(this.renderer=e,void 0===t){var i={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,stencilBuffer:!1},r=e.getDrawingBufferSize(new Vector2);(t=new WebGLRenderTarget(r.width,r.height,i)).texture.name="EffectComposer.rt1"}this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===CopyShader&&console.error("EffectComposer relies on CopyShader"),void 0===ShaderPass&&console.error("EffectComposer relies on ShaderPass"),this.copyPass=new ShaderPass(CopyShader),this._previousFrameTime=Date.now()};Object.assign(EffectComposer.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e);var t=this.renderer.getDrawingBufferSize(new Vector2);e.setSize(t.width,t.height)},insertPass:function(e,t){this.passes.splice(t,0,e)},render:function(e){void 0===e&&(e=.001*(Date.now()-this._previousFrameTime)),this._previousFrameTime=Date.now();var t,i,r=this.renderer.getRenderTarget(),n=!1,o=this.passes.length;for(i=0;i<o;i++)if(!1!==(t=this.passes[i]).enabled){if(t.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),t.needsSwap){if(n){var a=this.renderer.context;a.stencilFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),a.stencilFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==MaskPass&&(t instanceof MaskPass?n=!0:t instanceof ClearMaskPass&&(n=!1))}this.renderer.setRenderTarget(r)},reset:function(e){if(void 0===e){var t=this.renderer.getDrawingBufferSize(new Vector2);(e=this.renderTarget1.clone()).setSize(t.width,t.height)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this.renderTarget1.setSize(e,t),this.renderTarget2.setSize(e,t);for(var i=0;i<this.passes.length;i++)this.passes[i].setSize(e,t)}});var FilmShader={uniforms:{tDiffuse:{value:null},time:{value:0},nIntensity:{value:.5},sIntensity:{value:.05},sCount:{value:4096},grayscale:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 cTextureScreen = texture2D( tDiffuse, vUv );","float dx = rand( vUv + time );","vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx, 0.0, 1.0 );","vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","if( grayscale ) {","cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","}","gl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")},FilmPass=function(e,t,i,r){Pass.call(this),void 0===FilmShader&&console.error("FilmPass relies on FilmShader");var n=FilmShader;this.uniforms=UniformsUtils.clone(n.uniforms),this.material=new ShaderMaterial({uniforms:this.uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}),void 0!==r&&(this.uniforms.grayscale.value=r),void 0!==e&&(this.uniforms.nIntensity.value=e),void 0!==t&&(this.uniforms.sIntensity.value=t),void 0!==i&&(this.uniforms.sCount.value=i),this.camera=new OrthographicCamera(-1,1,1,-1,0,1),this.scene=new Scene,this.quad=new Mesh(new PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};FilmPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:FilmPass,render:function(e,t,i,r,n){this.uniforms.tDiffuse.value=i.texture,this.uniforms.time.value+=r,this.quad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),e.render(this.scene,this.camera)):(e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera))}});var DigitalGlitch={uniforms:{tDiffuse:{value:null},tDisp:{value:null},byp:{value:0},amount:{value:.08},angle:{value:.02},seed:{value:.02},seed_x:{value:.02},seed_y:{value:.02},distortion_x:{value:.5},distortion_y:{value:.6},col_s:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform int byp;","uniform sampler2D tDiffuse;","uniform sampler2D tDisp;","uniform float amount;","uniform float angle;","uniform float seed;","uniform float seed_x;","uniform float seed_y;","uniform float distortion_x;","uniform float distortion_y;","uniform float col_s;","varying vec2 vUv;","float rand(vec2 co){","return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","void main() {","if(byp<1) {","vec2 p = vUv;","float xs = floor(gl_FragCoord.x / 0.5);","float ys = floor(gl_FragCoord.y / 0.5);","vec4 normal = texture2D (tDisp, p*seed*seed);","if(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {","if(seed_x>0.){","p.y = 1. - (p.y + distortion_y);","}","else {","p.y = distortion_y;","}","}","if(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {","if(seed_y>0.){","p.x=distortion_x;","}","else {","p.x = 1. - (p.x + distortion_x);","}","}","p.x+=normal.x*seed_x*(seed/5.);","p.y+=normal.y*seed_y*(seed/5.);","vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, p + offset);","vec4 cga = texture2D(tDiffuse, p);","vec4 cb = texture2D(tDiffuse, p - offset);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","vec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);","gl_FragColor = gl_FragColor+ snow;","}","else {","gl_FragColor=texture2D (tDiffuse, vUv);","}","}"].join("\n")},GlitchPass=function(e){Pass.call(this),void 0===DigitalGlitch&&console.error("GlitchPass relies on DigitalGlitch");var t=DigitalGlitch;this.uniforms=UniformsUtils.clone(t.uniforms),null==e&&(e=64),this.uniforms.tDisp.value=this.generateHeightmap(e),this.material=new ShaderMaterial({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.camera=new OrthographicCamera(-1,1,1,-1,0,1),this.scene=new Scene,this.quad=new Mesh(new PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.goWild=!1,this.curF=0,this.generateTrigger()};GlitchPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:GlitchPass,render:function(e,t,i,r,n){this.uniforms.tDiffuse.value=i.texture,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0,this.curF%this.randX==0||1==this.goWild?(this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=_Math.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=_Math.randFloat(-1,1),this.uniforms.seed_y.value=_Math.randFloat(-1,1),this.uniforms.distortion_x.value=_Math.randFloat(0,1),this.uniforms.distortion_y.value=_Math.randFloat(0,1),this.curF=0,this.generateTrigger()):this.curF%this.randX<this.randX/5?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=_Math.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=_Math.randFloat(0,1),this.uniforms.distortion_y.value=_Math.randFloat(0,1),this.uniforms.seed_x.value=_Math.randFloat(-.3,.3),this.uniforms.seed_y.value=_Math.randFloat(-.3,.3)):0==this.goWild&&(this.uniforms.byp.value=1),this.curF++,this.quad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),e.render(this.scene,this.camera)):(e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera))},generateTrigger:function(){this.randX=_Math.randInt(120,240)},generateHeightmap:function(e){for(var t=new Float32Array(e*e*3),i=e*e,r=0;r<i;r++){var n=_Math.randFloat(0,1);t[3*r+0]=n,t[3*r+1]=n,t[3*r+2]=n}var o=new DataTexture(t,e,e,RGBFormat,FloatType);return o.needsUpdate=!0,o}});var HalftoneShader={uniforms:{tDiffuse:{value:null},shape:{value:1},radius:{value:4},rotateR:{value:Math.PI/12*1},rotateG:{value:Math.PI/12*2},rotateB:{value:Math.PI/12*3},scatter:{value:0},width:{value:1},height:{value:1},blending:{value:1},blendingMode:{value:1},greyscale:{value:!1},disable:{value:!1}},vertexShader:["varying vec2 vUV;","void main() {","vUV = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["#define SQRT2_MINUS_ONE 0.41421356","#define SQRT2_HALF_MINUS_ONE 0.20710678","#define PI2 6.28318531","#define SHAPE_DOT 1","#define SHAPE_ELLIPSE 2","#define SHAPE_LINE 3","#define SHAPE_SQUARE 4","#define BLENDING_LINEAR 1","#define BLENDING_MULTIPLY 2","#define BLENDING_ADD 3","#define BLENDING_LIGHTER 4","#define BLENDING_DARKER 5","uniform sampler2D tDiffuse;","uniform float radius;","uniform float rotateR;","uniform float rotateG;","uniform float rotateB;","uniform float scatter;","uniform float width;","uniform float height;","uniform int shape;","uniform bool disable;","uniform float blending;","uniform int blendingMode;","varying vec2 vUV;","uniform bool greyscale;","const int samples = 8;","float blend( float a, float b, float t ) {","return a * ( 1.0 - t ) + b * t;","}","float hypot( float x, float y ) {","return sqrt( x * x + y * y );","}","float rand( vec2 seed ){","return fract( sin( dot( seed.xy, vec2( 12.9898, 78.233 ) ) ) * 43758.5453 );","}","float distanceToDotRadius( float channel, vec2 coord, vec2 normal, vec2 p, float angle, float rad_max ) {","float dist = hypot( coord.x - p.x, coord.y - p.y );","float rad = channel;","if ( shape == SHAPE_DOT ) {","rad = pow( abs( rad ), 1.125 ) * rad_max;","} else if ( shape == SHAPE_ELLIPSE ) {","rad = pow( abs( rad ), 1.125 ) * rad_max;","if ( dist != 0.0 ) {","float dot_p = abs( ( p.x - coord.x ) / dist * normal.x + ( p.y - coord.y ) / dist * normal.y );","dist = ( dist * ( 1.0 - SQRT2_HALF_MINUS_ONE ) ) + dot_p * dist * SQRT2_MINUS_ONE;","}","} else if ( shape == SHAPE_LINE ) {","rad = pow( abs( rad ), 1.5) * rad_max;","float dot_p = ( p.x - coord.x ) * normal.x + ( p.y - coord.y ) * normal.y;","dist = hypot( normal.x * dot_p, normal.y * dot_p );","} else if ( shape == SHAPE_SQUARE ) {","float theta = atan( p.y - coord.y, p.x - coord.x ) - angle;","float sin_t = abs( sin( theta ) );","float cos_t = abs( cos( theta ) );","rad = pow( abs( rad ), 1.4 );","rad = rad_max * ( rad + ( ( sin_t > cos_t ) ? rad - sin_t * rad : rad - cos_t * rad ) );","}","return rad - dist;","}","struct Cell {","vec2 normal;","vec2 p1;","vec2 p2;","vec2 p3;","vec2 p4;","float samp2;","float samp1;","float samp3;","float samp4;","};","vec4 getSample( vec2 point ) {","vec4 tex = texture2D( tDiffuse, vec2( point.x / width, point.y / height ) );","float base = rand( vec2( floor( point.x ), floor( point.y ) ) ) * PI2;","float step = PI2 / float( samples );","float dist = radius * 0.66;","for ( int i = 0; i < samples; ++i ) {","float r = base + step * float( i );","vec2 coord = point + vec2( cos( r ) * dist, sin( r ) * dist );","tex += texture2D( tDiffuse, vec2( coord.x / width, coord.y / height ) );","}","tex /= float( samples ) + 1.0;","return tex;","}","float getDotColour( Cell c, vec2 p, int channel, float angle, float aa ) {","float dist_c_1, dist_c_2, dist_c_3, dist_c_4, res;","if ( channel == 0 ) {","c.samp1 = getSample( c.p1 ).r;","c.samp2 = getSample( c.p2 ).r;","c.samp3 = getSample( c.p3 ).r;","c.samp4 = getSample( c.p4 ).r;","} else if (channel == 1) {","c.samp1 = getSample( c.p1 ).g;","c.samp2 = getSample( c.p2 ).g;","c.samp3 = getSample( c.p3 ).g;","c.samp4 = getSample( c.p4 ).g;","} else {","c.samp1 = getSample( c.p1 ).b;","c.samp3 = getSample( c.p3 ).b;","c.samp2 = getSample( c.p2 ).b;","c.samp4 = getSample( c.p4 ).b;","}","dist_c_1 = distanceToDotRadius( c.samp1, c.p1, c.normal, p, angle, radius );","dist_c_2 = distanceToDotRadius( c.samp2, c.p2, c.normal, p, angle, radius );","dist_c_3 = distanceToDotRadius( c.samp3, c.p3, c.normal, p, angle, radius );","dist_c_4 = distanceToDotRadius( c.samp4, c.p4, c.normal, p, angle, radius );","res = ( dist_c_1 > 0.0 ) ? clamp( dist_c_1 / aa, 0.0, 1.0 ) : 0.0;","res += ( dist_c_2 > 0.0 ) ? clamp( dist_c_2 / aa, 0.0, 1.0 ) : 0.0;","res += ( dist_c_3 > 0.0 ) ? clamp( dist_c_3 / aa, 0.0, 1.0 ) : 0.0;","res += ( dist_c_4 > 0.0 ) ? clamp( dist_c_4 / aa, 0.0, 1.0 ) : 0.0;","res = clamp( res, 0.0, 1.0 );","return res;","}","Cell getReferenceCell( vec2 p, vec2 origin, float grid_angle, float step ) {","Cell c;","vec2 n = vec2( cos( grid_angle ), sin( grid_angle ) );","float threshold = step * 0.5;","float dot_normal = n.x * ( p.x - origin.x ) + n.y * ( p.y - origin.y );","float dot_line = -n.y * ( p.x - origin.x ) + n.x * ( p.y - origin.y );","vec2 offset = vec2( n.x * dot_normal, n.y * dot_normal );","float offset_normal = mod( hypot( offset.x, offset.y ), step );","float normal_dir = ( dot_normal < 0.0 ) ? 1.0 : -1.0;","float normal_scale = ( ( offset_normal < threshold ) ? -offset_normal : step - offset_normal ) * normal_dir;","float offset_line = mod( hypot( ( p.x - offset.x ) - origin.x, ( p.y - offset.y ) - origin.y ), step );","float line_dir = ( dot_line < 0.0 ) ? 1.0 : -1.0;","float line_scale = ( ( offset_line < threshold ) ? -offset_line : step - offset_line ) * line_dir;","c.normal = n;","c.p1.x = p.x - n.x * normal_scale + n.y * line_scale;","c.p1.y = p.y - n.y * normal_scale - n.x * line_scale;","if ( scatter != 0.0 ) {","float off_mag = scatter * threshold * 0.5;","float off_angle = rand( vec2( floor( c.p1.x ), floor( c.p1.y ) ) ) * PI2;","c.p1.x += cos( off_angle ) * off_mag;","c.p1.y += sin( off_angle ) * off_mag;","}","float normal_step = normal_dir * ( ( offset_normal < threshold ) ? step : -step );","float line_step = line_dir * ( ( offset_line < threshold ) ? step : -step );","c.p2.x = c.p1.x - n.x * normal_step;","c.p2.y = c.p1.y - n.y * normal_step;","c.p3.x = c.p1.x + n.y * line_step;","c.p3.y = c.p1.y - n.x * line_step;","c.p4.x = c.p1.x - n.x * normal_step + n.y * line_step;","c.p4.y = c.p1.y - n.y * normal_step - n.x * line_step;","return c;","}","float blendColour( float a, float b, float t ) {","if ( blendingMode == BLENDING_LINEAR ) {","return blend( a, b, 1.0 - t );","} else if ( blendingMode == BLENDING_ADD ) {","return blend( a, min( 1.0, a + b ), t );","} else if ( blendingMode == BLENDING_MULTIPLY ) {","return blend( a, max( 0.0, a * b ), t );","} else if ( blendingMode == BLENDING_LIGHTER ) {","return blend( a, max( a, b ), t );","} else if ( blendingMode == BLENDING_DARKER ) {","return blend( a, min( a, b ), t );","} else {","return blend( a, b, 1.0 - t );","}","}","void main() {","if ( ! disable ) {","vec2 p = vec2( vUV.x * width, vUV.y * height );","vec2 origin = vec2( 0, 0 );","float aa = ( radius < 2.5 ) ? radius * 0.5 : 1.25;","Cell cell_r = getReferenceCell( p, origin, rotateR, radius );","Cell cell_g = getReferenceCell( p, origin, rotateG, radius );","Cell cell_b = getReferenceCell( p, origin, rotateB, radius );","float r = getDotColour( cell_r, p, 0, rotateR, aa );","float g = getDotColour( cell_g, p, 1, rotateG, aa );","float b = getDotColour( cell_b, p, 2, rotateB, aa );","vec4 colour = texture2D( tDiffuse, vUV );","r = blendColour( r, colour.r, blending );","g = blendColour( g, colour.g, blending );","b = blendColour( b, colour.b, blending );","if ( greyscale ) {","r = g = b = (r + b + g) / 3.0;","}","gl_FragColor = vec4( r, g, b, 1.0 );","} else {","gl_FragColor = texture2D( tDiffuse, vUV );","}","}"].join("\n")},HalftonePass=function(e,t,i){for(var r in Pass.call(this),void 0===HalftoneShader&&console.error("HalftonePass requires HalftoneShader"),this.uniforms=UniformsUtils.clone(HalftoneShader.uniforms),this.material=new ShaderMaterial({uniforms:this.uniforms,fragmentShader:HalftoneShader.fragmentShader,vertexShader:HalftoneShader.vertexShader}),this.uniforms.width.value=e,this.uniforms.height.value=t,i)i.hasOwnProperty(r)&&this.uniforms.hasOwnProperty(r)&&(this.uniforms[r].value=i[r]);this.camera=new OrthographicCamera(-1,1,1,-1,0,1),this.scene=new Scene,this.quad=new Mesh(new PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};HalftonePass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:HalftonePass,render:function(e,t,i,r,n){this.material.uniforms.tDiffuse.value=i.texture,this.quad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),e.render(this.scene,this.camera)):(e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera))},setSize:function(e,t){this.uniforms.width.value=e,this.uniforms.height.value=t}});var OutlinePass=function(e,t,i,r){this.renderScene=t,this.renderCamera=i,this.selectedObjects=void 0!==r?r:[],this.visibleEdgeColor=new Color(1,1,1),this.hiddenEdgeColor=new Color(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,Pass.call(this),this.resolution=void 0!==e?new Vector2(e.x,e.y):new Vector2(256,256);var n={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat},o=Math.round(this.resolution.x/this.downSampleRatio),a=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new MeshBasicMaterial({color:16777215}),this.maskBufferMaterial.side=DoubleSide,this.renderTargetMaskBuffer=new WebGLRenderTarget(this.resolution.x,this.resolution.y,n),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new MeshDepthMaterial,this.depthMaterial.side=DoubleSide,this.depthMaterial.depthPacking=RGBADepthPacking,this.depthMaterial.blending=NoBlending,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=DoubleSide,this.prepareMaskMaterial.fragmentShader=function(e,t){var i=t.isPerspectiveCamera?"perspective":"orthographic";return e.replace(/DEPTH_TO_VIEW_Z/g,i+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new WebGLRenderTarget(this.resolution.x,this.resolution.y,n),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new WebGLRenderTarget(o,a,n),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new WebGLRenderTarget(o,a,n),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new WebGLRenderTarget(Math.round(o/2),Math.round(a/2),n),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new WebGLRenderTarget(o,a,n),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new WebGLRenderTarget(Math.round(o/2),Math.round(a/2),n),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value=new Vector2(o,a),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value=new Vector2(Math.round(o/2),Math.round(a/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),void 0===CopyShader&&console.error("OutlinePass relies on CopyShader");var s=CopyShader;this.copyUniforms=UniformsUtils.clone(s.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,blending:NoBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new Color,this.oldClearAlpha=1,this.camera=new OrthographicCamera(-1,1,1,-1,0,1),this.scene=new Scene,this.quad=new Mesh(new PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.tempPulseColor1=new Color,this.tempPulseColor2=new Color,this.textureMatrix=new Matrix4};OutlinePass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:OutlinePass,dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(e,t){this.renderTargetMaskBuffer.setSize(e,t);var i=Math.round(e/this.downSampleRatio),r=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(i,r),this.renderTargetBlurBuffer1.setSize(i,r),this.renderTargetEdgeBuffer1.setSize(i,r),this.separableBlurMaterial1.uniforms.texSize.value=new Vector2(i,r),i=Math.round(i/2),r=Math.round(r/2),this.renderTargetBlurBuffer2.setSize(i,r),this.renderTargetEdgeBuffer2.setSize(i,r),this.separableBlurMaterial2.uniforms.texSize.value=new Vector2(i,r)},changeVisibilityOfSelectedObjects:function(e){function t(t){t.isMesh&&(e?(t.visible=t.userData.oldVisible,delete t.userData.oldVisible):(t.userData.oldVisible=t.visible,t.visible=e))}for(var i=0;i<this.selectedObjects.length;i++){this.selectedObjects[i].traverse(t)}},changeVisibilityOfNonSelectedObjects:function(e){var t=[];function i(e){e.isMesh&&t.push(e)}for(var r=0;r<this.selectedObjects.length;r++){this.selectedObjects[r].traverse(i)}this.renderScene.traverse(function(i){if(i.isMesh||i.isLine||i.isSprite){for(var r=!1,n=0;n<t.length;n++)if(t[n].id===i.id){r=!0;break}if(!r){var o=i.visible;e&&!i.bVisible||(i.visible=e),i.bVisible=o}}})},updateTextureMatrix:function(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)},render:function(e,t,i,r,n){if(this.selectedObjects.length>0){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;e.autoClear=!1,n&&e.context.disable(e.context.STENCIL_TEST),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);var a=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value=new Vector2(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this.renderScene.background=a,this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),e.render(this.scene,this.camera),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){var s=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(s),this.tempPulseColor2.multiplyScalar(s)}this.quad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value=new Vector2(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),e.render(this.scene,this.camera),this.quad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=OutlinePass.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),e.render(this.scene,this.camera),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=OutlinePass.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),e.render(this.scene,this.camera),this.quad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=OutlinePass.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),e.render(this.scene,this.camera),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=OutlinePass.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),e.render(this.scene,this.camera),this.quad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,n&&e.context.enable(e.context.STENCIL_TEST),e.setRenderTarget(i),e.render(this.scene,this.camera),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=o}this.renderToScreen&&(this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=i.texture,e.setRenderTarget(null),e.render(this.scene,this.camera))},getPrepareMaskMaterial:function(){return new ShaderMaterial({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new Vector2(.5,.5)},textureMatrix:{value:new Matrix4}},vertexShader:["varying vec4 projTexCoord;","varying vec4 vPosition;","uniform mat4 textureMatrix;","void main() {","\tvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tprojTexCoord = textureMatrix * worldPosition;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <packing>","varying vec4 vPosition;","varying vec4 projTexCoord;","uniform sampler2D depthTexture;","uniform vec2 cameraNearFar;","void main() {","\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));","\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );","\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;","\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);","}"].join("\n")})},getEdgeDetectionMaterial:function(){return new ShaderMaterial({uniforms:{maskTexture:{value:null},texSize:{value:new Vector2(.5,.5)},visibleEdgeColor:{value:new Vector3(1,1,1)},hiddenEdgeColor:{value:new Vector3(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec3 visibleEdgeColor;\t\t\t\tuniform vec3 hiddenEdgeColor;\t\t\t\t\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\t\t\t\t}"})},getSeperableBlurMaterial:function(e){return new ShaderMaterial({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new Vector2(.5,.5)},direction:{value:new Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\t\t\t\t}"})},getOverlayMaterial:function(){return new ShaderMaterial({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform sampler2D edgeTexture1;\t\t\t\tuniform sampler2D edgeTexture2;\t\t\t\tuniform sampler2D patternTexture;\t\t\t\tuniform float edgeStrength;\t\t\t\tuniform float edgeGlow;\t\t\t\tuniform bool usePatternTexture;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\t\t\t\t\tif(usePatternTexture)\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\t\t\t\t\tgl_FragColor = finalColor;\t\t\t\t}",blending:AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}}),OutlinePass.BlurDirectionX=new Vector2(1,0),OutlinePass.BlurDirectionY=new Vector2(0,1);var RenderPass=function(e,t,i,r,n){Pass.call(this),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=r,this.clearAlpha=void 0!==n?n:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};function DepthTexture(e,t,i,r,n,o,a,s,l,u){if((u=void 0!==u?u:DepthFormat)!==DepthFormat&&u!==DepthStencilFormat)throw new Error("DepthTexture format must be either DepthFormat or DepthStencilFormat");void 0===i&&u===DepthFormat&&(i=UnsignedShortType),void 0===i&&u===DepthStencilFormat&&(i=UnsignedInt248Type),Texture.call(this,null,r,n,o,a,s,u,i,l),this.image={width:e,height:t},this.magFilter=void 0!==a?a:NearestFilter,this.minFilter=void 0!==s?s:NearestFilter,this.flipY=!1,this.generateMipmaps=!1}RenderPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:RenderPass,render:function(e,t,i,r,n){var o,a,s=e.autoClear;e.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(o=e.getClearColor().getHex(),a=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(o,a),this.scene.overrideMaterial=null,e.autoClear=s}}),DepthTexture.prototype=Object.create(Texture.prototype),DepthTexture.prototype.constructor=DepthTexture,DepthTexture.prototype.isDepthTexture=!0;var SAOShader={defines:{NUM_SAMPLES:7,NUM_RINGS:4,NORMAL_TEXTURE:0,DIFFUSE_TEXTURE:0,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{type:"t",value:null},tDiffuse:{type:"t",value:null},tNormal:{type:"t",value:null},size:{type:"v2",value:new Vector2(512,512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},cameraProjectionMatrix:{type:"m4",value:new Matrix4},cameraInverseProjectionMatrix:{type:"m4",value:new Matrix4},scale:{type:"f",value:1},intensity:{type:"f",value:.1},bias:{type:"f",value:.5},minResolution:{type:"f",value:0},kernelRadius:{type:"f",value:100},randomSeed:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","varying vec2 vUv;","#if DIFFUSE_TEXTURE == 1","uniform sampler2D tDiffuse;","#endif","uniform sampler2D tDepth;","#if NORMAL_TEXTURE == 1","uniform sampler2D tNormal;","#endif","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float scale;","uniform float intensity;","uniform float bias;","uniform float kernelRadius;","uniform float minResolution;","uniform vec2 size;","uniform float randomSeed;","// RGBA depth","#include <packing>","vec4 getDefaultColor( const in vec2 screenPosition ) {","\t#if DIFFUSE_TEXTURE == 1","\treturn texture2D( tDiffuse, vUv );","\t#else","\treturn vec4( 1.0 );","\t#endif","}","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","\tclipPosition *= clipW; // unprojection.","\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {","\t#if NORMAL_TEXTURE == 1","\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","\t#else","\treturn normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );","\t#endif","}","float scaleDividedByCameraFar;","float minResolutionMultipliedByCameraFar;","float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {","\tvec3 viewDelta = sampleViewPosition - centerViewPosition;","\tfloat viewDistance = length( viewDelta );","\tfloat scaledScreenDistance = scaleDividedByCameraFar * viewDistance;","\treturn max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );","}","// moving costly divides into consts","const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );","const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );","float getAmbientOcclusion( const in vec3 centerViewPosition ) {","\t// precompute some variables require in getOcclusion.","\tscaleDividedByCameraFar = scale / cameraFar;","\tminResolutionMultipliedByCameraFar = minResolution * cameraFar;","\tvec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );","\t// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/","\tfloat angle = rand( vUv + randomSeed ) * PI2;","\tvec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;","\tvec2 radiusStep = radius;","\tfloat occlusionSum = 0.0;","\tfloat weightSum = 0.0;","\tfor( int i = 0; i < NUM_SAMPLES; i ++ ) {","\t\tvec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;","\t\tradius += radiusStep;","\t\tangle += ANGLE_STEP;","\t\tfloat sampleDepth = getDepth( sampleUv );","\t\tif( sampleDepth >= ( 1.0 - EPSILON ) ) {","\t\t\tcontinue;","\t\t}","\t\tfloat sampleViewZ = getViewZ( sampleDepth );","\t\tvec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );","\t\tocclusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );","\t\tweightSum += 1.0;","\t}","\tif( weightSum == 0.0 ) discard;","\treturn occlusionSum * ( intensity / weightSum );","}","void main() {","\tfloat centerDepth = getDepth( vUv );","\tif( centerDepth >= ( 1.0 - EPSILON ) ) {","\t\tdiscard;","\t}","\tfloat centerViewZ = getViewZ( centerDepth );","\tvec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );","\tfloat ambientOcclusion = getAmbientOcclusion( viewPosition );","\tgl_FragColor = getDefaultColor( vUv );","\tgl_FragColor.xyz *=  1.0 - ambientOcclusion;","}"].join("\n")},DepthLimitedBlurShader={defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{type:"t",value:null},size:{type:"v2",value:new Vector2(512,512)},sampleUvOffsets:{type:"v2v",value:[new Vector2(0,0)]},sampleWeights:{type:"1fv",value:[1]},tDepth:{type:"t",value:null},cameraNear:{type:"f",value:10},cameraFar:{type:"f",value:1e3},depthCutoff:{type:"f",value:10}},vertexShader:["#include <common>","uniform vec2 size;","varying vec2 vUv;","varying vec2 vInvSize;","void main() {","\tvUv = uv;","\tvInvSize = 1.0 / size;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","#include <packing>","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","uniform float depthCutoff;","uniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];","uniform float sampleWeights[ KERNEL_RADIUS + 1 ];","varying vec2 vUv;","varying vec2 vInvSize;","float getDepth( const in vec2 screenPosition ) {","\t#if DEPTH_PACKING == 1","\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","\t#else","\treturn texture2D( tDepth, screenPosition ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","void main() {","\tfloat depth = getDepth( vUv );","\tif( depth >= ( 1.0 - EPSILON ) ) {","\t\tdiscard;","\t}","\tfloat centerViewZ = -getViewZ( depth );","\tbool rBreak = false, lBreak = false;","\tfloat weightSum = sampleWeights[0];","\tvec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;","\tfor( int i = 1; i <= KERNEL_RADIUS; i ++ ) {","\t\tfloat sampleWeight = sampleWeights[i];","\t\tvec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;","\t\tvec2 sampleUv = vUv + sampleUvOffset;","\t\tfloat viewZ = -getViewZ( getDepth( sampleUv ) );","\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;","\t\tif( ! rBreak ) {","\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","\t\t\tweightSum += sampleWeight;","\t\t}","\t\tsampleUv = vUv - sampleUvOffset;","\t\tviewZ = -getViewZ( getDepth( sampleUv ) );","\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;","\t\tif( ! lBreak ) {","\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","\t\t\tweightSum += sampleWeight;","\t\t}","\t}","\tgl_FragColor = diffuseSum / weightSum;","}"].join("\n")},BlurShaderUtils={createSampleWeights:function(e,t){for(var i=function(e,t){return Math.exp(-e*e/(t*t*2))/(Math.sqrt(2*Math.PI)*t)},r=[],n=0;n<=e;n++)r.push(i(n,t));return r},createSampleOffsets:function(e,t){for(var i=[],r=0;r<=e;r++)i.push(t.clone().multiplyScalar(r));return i},configure:function(e,t,i,r){e.defines.KERNEL_RADIUS=t,e.uniforms.sampleUvOffsets.value=BlurShaderUtils.createSampleOffsets(t,r),e.uniforms.sampleWeights.value=BlurShaderUtils.createSampleWeights(t,i),e.needsUpdate=!0}},UnpackDepthRGBAShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","#include <packing>","void main() {","float depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );","gl_FragColor = vec4( vec3( depth ), opacity );","}"].join("\n")},SAOPass=function(e,t,i,r,n){(Pass.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.supportsDepthTextureExtension=void 0!==i&&i,this.supportsNormalTexture=void 0!==r&&r,this.originalClearColor=new Color,this.oldClearColor=new Color,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=void 0!==n?new Vector2(n.x,n.y):new Vector2(256,256),this.saoRenderTarget=new WebGLRenderTarget(this.resolution.x,this.resolution.y,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone(),this.beautyRenderTarget=this.saoRenderTarget.clone(),this.normalRenderTarget=new WebGLRenderTarget(this.resolution.x,this.resolution.y,{minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat}),this.depthRenderTarget=this.normalRenderTarget.clone(),this.supportsDepthTextureExtension)&&((i=new DepthTexture).type=UnsignedShortType,i.minFilter=NearestFilter,i.maxFilter=NearestFilter,this.beautyRenderTarget.depthTexture=i,this.beautyRenderTarget.depthBuffer=!0);this.depthMaterial=new MeshDepthMaterial,this.depthMaterial.depthPacking=RGBADepthPacking,this.depthMaterial.blending=NoBlending,this.normalMaterial=new MeshNormalMaterial,this.normalMaterial.blending=NoBlending,void 0===SAOShader&&console.error("SAOPass relies on SAOShader"),this.saoMaterial=new ShaderMaterial({defines:Object.assign({},SAOShader.defines),fragmentShader:SAOShader.fragmentShader,vertexShader:SAOShader.vertexShader,uniforms:UniformsUtils.clone(SAOShader.uniforms)}),this.saoMaterial.extensions.derivatives=!0,this.saoMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.saoMaterial.defines.NORMAL_TEXTURE=this.supportsNormalTexture?1:0,this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?i:this.depthRenderTarget.texture,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=NoBlending,void 0===DepthLimitedBlurShader&&console.error("SAOPass relies on DepthLimitedBlurShader"),this.vBlurMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(DepthLimitedBlurShader.uniforms),defines:Object.assign({},DepthLimitedBlurShader.defines),vertexShader:DepthLimitedBlurShader.vertexShader,fragmentShader:DepthLimitedBlurShader.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?i:this.depthRenderTarget.texture,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=NoBlending,this.hBlurMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(DepthLimitedBlurShader.uniforms),defines:Object.assign({},DepthLimitedBlurShader.defines),vertexShader:DepthLimitedBlurShader.vertexShader,fragmentShader:DepthLimitedBlurShader.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?i:this.depthRenderTarget.texture,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=NoBlending,void 0===CopyShader&&console.error("SAOPass relies on CopyShader"),this.materialCopy=new ShaderMaterial({uniforms:UniformsUtils.clone(CopyShader.uniforms),vertexShader:CopyShader.vertexShader,fragmentShader:CopyShader.fragmentShader,blending:NoBlending}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=CustomBlending,this.materialCopy.blendSrc=DstColorFactor,this.materialCopy.blendDst=ZeroFactor,this.materialCopy.blendEquation=AddEquation,this.materialCopy.blendSrcAlpha=DstAlphaFactor,this.materialCopy.blendDstAlpha=ZeroFactor,this.materialCopy.blendEquationAlpha=AddEquation,void 0===CopyShader&&console.error("SAOPass relies on UnpackDepthRGBAShader"),this.depthCopy=new ShaderMaterial({uniforms:UniformsUtils.clone(UnpackDepthRGBAShader.uniforms),vertexShader:UnpackDepthRGBAShader.vertexShader,fragmentShader:UnpackDepthRGBAShader.fragmentShader,blending:NoBlending}),this.quadCamera=new OrthographicCamera(-1,1,1,-1,0,1),this.quadScene=new Scene,this.quad=new Mesh(new PlaneBufferGeometry(2,2),null),this.quadScene.add(this.quad)};SAOPass.OUTPUT={Beauty:1,Default:0,SAO:2,Depth:3,Normal:4},SAOPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:SAOPass,render:function(e,t,i,r,n){if(this.renderToScreen&&(this.materialCopy.blending=NoBlending,this.materialCopy.uniforms.tDiffuse.value=i.texture,this.materialCopy.needsUpdate=!0,this.renderPass(e,this.materialCopy,null)),1!==this.params.output){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;e.autoClear=!1,e.setRenderTarget(this.depthRenderTarget),e.clear(),this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;var a=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=a,this.hBlurMaterial.uniforms.depthCutoff.value=a,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),this.prevStdDev===this.params.saoBlurStdDev&&this.prevNumSamples===this.params.saoBlurRadius||(BlurShaderUtils.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new Vector2(0,1)),BlurShaderUtils.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new Vector2(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),e.setClearColor(0),e.setRenderTarget(this.beautyRenderTarget),e.clear(),e.render(this.scene,this.camera),this.supportsDepthTextureExtension||this.renderOverride(e,this.depthMaterial,this.depthRenderTarget,0,1),this.supportsNormalTexture&&this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(e,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(e,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(e,this.hBlurMaterial,this.saoRenderTarget,16777215,1));var s=this.materialCopy;3===this.params.output?this.supportsDepthTextureExtension?(this.materialCopy.uniforms.tDiffuse.value=this.beautyRenderTarget.depthTexture,this.materialCopy.needsUpdate=!0):(this.depthCopy.uniforms.tDiffuse.value=this.depthRenderTarget.texture,this.depthCopy.needsUpdate=!0,s=this.depthCopy):4===this.params.output?(this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.materialCopy.needsUpdate=!0):(this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),0===this.params.output?s.blending=CustomBlending:s.blending=NoBlending,this.renderPass(e,s,this.renderToScreen?null:i),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=o}},renderPass:function(e,t,i,r,n){this.originalClearColor.copy(e.getClearColor());var o=e.getClearAlpha(),a=e.autoClear;e.setRenderTarget(i),e.autoClear=!1,null!=r&&(e.setClearColor(r),e.setClearAlpha(n||0),e.clear()),this.quad.material=t,e.render(this.quadScene,this.quadCamera),e.autoClear=a,e.setClearColor(this.originalClearColor),e.setClearAlpha(o)},renderOverride:function(e,t,i,r,n){this.originalClearColor.copy(e.getClearColor());var o=e.getClearAlpha(),a=e.autoClear;e.setRenderTarget(i),e.autoClear=!1,r=t.clearColor||r,n=t.clearAlpha||n,null!=r&&(e.setClearColor(r),e.setClearAlpha(n||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=a,e.setClearColor(this.originalClearColor),e.setClearAlpha(o)},setSize:function(e,t){this.beautyRenderTarget.setSize(e,t),this.saoRenderTarget.setSize(e,t),this.blurIntermediateRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.depthRenderTarget.setSize(e,t),this.saoMaterial.uniforms.size.value.set(e,t),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(e,t),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(e,t),this.hBlurMaterial.needsUpdate=!0}});var SavePass=function(e){Pass.call(this),void 0===CopyShader&&console.error("SavePass relies on CopyShader");var t=CopyShader;this.textureID="tDiffuse",this.uniforms=UniformsUtils.clone(t.uniforms),this.material=new ShaderMaterial({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.renderTarget=e,void 0===this.renderTarget&&(this.renderTarget=new WebGLRenderTarget(window.innerWidth,window.innerHeight,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat,stencilBuffer:!1}),this.renderTarget.texture.name="SavePass.rt"),this.needsSwap=!1,this.camera=new OrthographicCamera(-1,1,1,-1,0,1),this.scene=new Scene,this.quad=new Mesh(new PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};SavePass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:SavePass,render:function(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.quad.material=this.material,e.setRenderTarget(this.renderTarget),this.clear&&e.clear(),e.render(this.scene,this.camera)}});var SMAAShader=[{defines:{SMAA_THRESHOLD:"0.1"},uniforms:{tDiffuse:{value:null},resolution:{value:new Vector2(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","void SMAAEdgeDetectionVS( vec2 texcoord ) {","vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );","vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );","vOffset[ 2 ] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );","}","void main() {","vUv = uv;","SMAAEdgeDetectionVS( vUv );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {","vec2 threshold = vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );","vec4 delta;","vec3 C = texture2D( colorTex, texcoord ).rgb;","vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;","vec3 t = abs( C - Cleft );","delta.x = max( max( t.r, t.g ), t.b );","vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;","t = abs( C - Ctop );","delta.y = max( max( t.r, t.g ), t.b );","vec2 edges = step( threshold, delta.xy );","if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )","discard;","vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;","t = abs( C - Cright );","delta.z = max( max( t.r, t.g ), t.b );","vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;","t = abs( C - Cbottom );","delta.w = max( max( t.r, t.g ), t.b );","float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );","vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;","t = abs( C - Cleftleft );","delta.z = max( max( t.r, t.g ), t.b );","vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;","t = abs( C - Ctoptop );","delta.w = max( max( t.r, t.g ), t.b );","maxDelta = max( max( maxDelta, delta.z ), delta.w );","edges.xy *= step( 0.5 * maxDelta, delta.xy );","return vec4( edges, 0.0, 0.0 );","}","void main() {","gl_FragColor = SMAAColorEdgeDetectionPS( vUv, vOffset, tDiffuse );","}"].join("\n")},{defines:{SMAA_MAX_SEARCH_STEPS:"8",SMAA_AREATEX_MAX_DISTANCE:"16",SMAA_AREATEX_PIXEL_SIZE:"( 1.0 / vec2( 160.0, 560.0 ) )",SMAA_AREATEX_SUBTEX_SIZE:"( 1.0 / 7.0 )"},uniforms:{tDiffuse:{value:null},tArea:{value:null},tSearch:{value:null},resolution:{value:new Vector2(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","varying vec2 vPixcoord;","void SMAABlendingWeightCalculationVS( vec2 texcoord ) {","vPixcoord = texcoord / resolution;","vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );","vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );","vOffset[ 2 ] = vec4( vOffset[ 0 ].xz, vOffset[ 1 ].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );","}","void main() {","vUv = uv;","SMAABlendingWeightCalculationVS( vUv );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )","uniform sampler2D tDiffuse;","uniform sampler2D tArea;","uniform sampler2D tSearch;","uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[3];","varying vec2 vPixcoord;","vec2 round( vec2 x ) {","return sign( x ) * floor( abs( x ) + 0.5 );","}","float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {","e.r = bias + e.r * scale;","return 255.0 * texture2D( searchTex, e, 0.0 ).r;","}","float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 0.0, 1.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord -= vec2( 2.0, 0.0 ) * resolution;","if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;","}","texcoord.x += 0.25 * resolution.x;","texcoord.x += resolution.x;","texcoord.x += 2.0 * resolution.x;","texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);","return texcoord.x;","}","float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 0.0, 1.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord += vec2( 2.0, 0.0 ) * resolution;","if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;","}","texcoord.x -= 0.25 * resolution.x;","texcoord.x -= resolution.x;","texcoord.x -= 2.0 * resolution.x;","texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );","return texcoord.x;","}","float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 1.0, 0.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord += vec2( 0.0, 2.0 ) * resolution;","if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;","}","texcoord.y -= 0.25 * resolution.y;","texcoord.y -= resolution.y;","texcoord.y -= 2.0 * resolution.y;","texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );","return texcoord.y;","}","float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","vec2 e = vec2( 1.0, 0.0 );","for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","e = texture2D( edgesTex, texcoord, 0.0 ).rg;","texcoord -= vec2( 0.0, 2.0 ) * resolution;","if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;","}","texcoord.y += 0.25 * resolution.y;","texcoord.y += resolution.y;","texcoord.y += 2.0 * resolution.y;","texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );","return texcoord.y;","}","vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {","vec2 texcoord = float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;","texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );","texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;","return texture2D( areaTex, texcoord, 0.0 ).rg;","}","vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {","vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );","vec2 e = texture2D( edgesTex, texcoord ).rg;","if ( e.g > 0.0 ) {","vec2 d;","vec2 coords;","coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );","coords.y = offset[ 1 ].y;","d.x = coords.x;","float e1 = texture2D( edgesTex, coords, 0.0 ).r;","coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );","d.y = coords.x;","d = d / resolution.x - pixcoord.x;","vec2 sqrt_d = sqrt( abs( d ) );","coords.y -= 1.0 * resolution.y;","float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;","weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );","}","if ( e.r > 0.0 ) {","vec2 d;","vec2 coords;","coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );","coords.x = offset[ 0 ].x;","d.x = coords.y;","float e1 = texture2D( edgesTex, coords, 0.0 ).g;","coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );","d.y = coords.y;","d = d / resolution.y - pixcoord.y;","vec2 sqrt_d = sqrt( abs( d ) );","coords.y -= 1.0 * resolution.y;","float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;","weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );","}","return weights;","}","void main() {","gl_FragColor = SMAABlendingWeightCalculationPS( vUv, vPixcoord, vOffset, tDiffuse, tArea, tSearch, ivec4( 0.0 ) );","}"].join("\n")},{uniforms:{tDiffuse:{value:null},tColor:{value:null},resolution:{value:new Vector2(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 2 ];","void SMAANeighborhoodBlendingVS( vec2 texcoord ) {","vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );","vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );","}","void main() {","vUv = uv;","SMAANeighborhoodBlendingVS( vUv );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tColor;","uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 2 ];","vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {","vec4 a;","a.xz = texture2D( blendTex, texcoord ).xz;","a.y = texture2D( blendTex, offset[ 1 ].zw ).g;","a.w = texture2D( blendTex, offset[ 1 ].xy ).a;","if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {","return texture2D( colorTex, texcoord, 0.0 );","} else {","vec2 offset;","offset.x = a.a > a.b ? a.a : -a.b;","offset.y = a.g > a.r ? -a.g : a.r;","if ( abs( offset.x ) > abs( offset.y )) {","offset.y = 0.0;","} else {","offset.x = 0.0;","}","vec4 C = texture2D( colorTex, texcoord, 0.0 );","texcoord += sign( offset ) * resolution;","vec4 Cop = texture2D( colorTex, texcoord, 0.0 );","float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );","C.xyz = pow(C.xyz, vec3(2.2));","Cop.xyz = pow(Cop.xyz, vec3(2.2));","vec4 mixed = mix(C, Cop, s);","mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));","return mixed;","}","}","void main() {","gl_FragColor = SMAANeighborhoodBlendingPS( vUv, vOffset, tColor, tDiffuse );","}"].join("\n")}],SMAAPass=function(e,t){Pass.call(this),this.edgesRT=new WebGLRenderTarget(e,t,{depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!1,minFilter:LinearFilter,format:RGBFormat}),this.edgesRT.texture.name="SMAAPass.edges",this.weightsRT=new WebGLRenderTarget(e,t,{depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!1,minFilter:LinearFilter,format:RGBAFormat}),this.weightsRT.texture.name="SMAAPass.weights";var i=this,r=new Image;r.src=this.getAreaTexture(),r.onload=function(){i.areaTexture.needsUpdate=!0},this.areaTexture=new Texture,this.areaTexture.name="SMAAPass.area",this.areaTexture.image=r,this.areaTexture.format=RGBFormat,this.areaTexture.minFilter=LinearFilter,this.areaTexture.generateMipmaps=!1,this.areaTexture.flipY=!1;var n=new Image;n.src=this.getSearchTexture(),n.onload=function(){i.searchTexture.needsUpdate=!0},this.searchTexture=new Texture,this.searchTexture.name="SMAAPass.search",this.searchTexture.image=n,this.searchTexture.magFilter=NearestFilter,this.searchTexture.minFilter=NearestFilter,this.searchTexture.generateMipmaps=!1,this.searchTexture.flipY=!1,void 0===SMAAShader&&console.error("SMAAPass relies on SMAAShader"),this.uniformsEdges=UniformsUtils.clone(SMAAShader[0].uniforms),this.uniformsEdges.resolution.value.set(1/e,1/t),this.materialEdges=new ShaderMaterial({defines:Object.assign({},SMAAShader[0].defines),uniforms:this.uniformsEdges,vertexShader:SMAAShader[0].vertexShader,fragmentShader:SMAAShader[0].fragmentShader}),this.uniformsWeights=UniformsUtils.clone(SMAAShader[1].uniforms),this.uniformsWeights.resolution.value.set(1/e,1/t),this.uniformsWeights.tDiffuse.value=this.edgesRT.texture,this.uniformsWeights.tArea.value=this.areaTexture,this.uniformsWeights.tSearch.value=this.searchTexture,this.materialWeights=new ShaderMaterial({defines:Object.assign({},SMAAShader[1].defines),uniforms:this.uniformsWeights,vertexShader:SMAAShader[1].vertexShader,fragmentShader:SMAAShader[1].fragmentShader}),this.uniformsBlend=UniformsUtils.clone(SMAAShader[2].uniforms),this.uniformsBlend.resolution.value.set(1/e,1/t),this.uniformsBlend.tDiffuse.value=this.weightsRT.texture,this.materialBlend=new ShaderMaterial({uniforms:this.uniformsBlend,vertexShader:SMAAShader[2].vertexShader,fragmentShader:SMAAShader[2].fragmentShader}),this.needsSwap=!1,this.camera=new OrthographicCamera(-1,1,1,-1,0,1),this.scene=new Scene,this.quad=new Mesh(new PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};SMAAPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:SMAAPass,render:function(e,t,i,r,n){this.uniformsEdges.tDiffuse.value=i.texture,this.quad.material=this.materialEdges,e.setRenderTarget(this.edgesRT),this.clear&&e.clear(),e.render(this.scene,this.camera),this.quad.material=this.materialWeights,e.setRenderTarget(this.weightsRT),this.clear&&e.clear(),e.render(this.scene,this.camera),this.uniformsBlend.tColor.value=i.texture,this.quad.material=this.materialBlend,this.renderToScreen?(e.setRenderTarget(null),e.render(this.scene,this.camera)):(e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera))},setSize:function(e,t){this.edgesRT.setSize(e,t),this.weightsRT.setSize(e,t),this.materialEdges.uniforms.resolution.value.set(1/e,1/t),this.materialWeights.uniforms.resolution.value.set(1/e,1/t),this.materialBlend.uniforms.resolution.value.set(1/e,1/t)},getAreaTexture:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="},getSearchTexture:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}});var SSAARenderPass=function(e,t,i,r){Pass.call(this),this.scene=e,this.camera=t,this.sampleLevel=4,this.unbiased=!0,this.clearColor=void 0!==i?i:0,this.clearAlpha=void 0!==r?r:0,void 0===CopyShader&&console.error("SSAARenderPass relies on CopyShader");var n=CopyShader;this.copyUniforms=UniformsUtils.clone(n.uniforms),this.copyMaterial=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:AdditiveBlending,depthTest:!1,depthWrite:!1}),this.camera2=new OrthographicCamera(-1,1,1,-1,0,1),this.scene2=new Scene,this.quad2=new Mesh(new PlaneBufferGeometry(2,2),this.copyMaterial),this.quad2.frustumCulled=!1,this.scene2.add(this.quad2)};SSAARenderPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:SSAARenderPass,dispose:function(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null)},setSize:function(e,t){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(e,t)},render:function(e,t,i){this.sampleRenderTarget||(this.sampleRenderTarget=new WebGLRenderTarget(i.width,i.height,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");var r=SSAARenderPass.JitterVectors[Math.max(0,Math.min(this.sampleLevel,5))],n=e.autoClear;e.autoClear=!1;var o=e.getClearColor().getHex(),a=e.getClearAlpha(),s=1/r.length;this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture;for(var l=i.width,u=i.height,h=0;h<r.length;h++){var c=r[h];this.camera.setViewOffset&&this.camera.setViewOffset(l,u,.0625*c[0],.0625*c[1],l,u);var d=s;if(this.unbiased)d+=1/32*((h+.5)/r.length-.5);this.copyUniforms.opacity.value=d,e.setClearColor(this.clearColor,this.clearAlpha),e.setRenderTarget(this.sampleRenderTarget),e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(this.renderToScreen?null:t),0===h&&(e.setClearColor(0,0),e.clear()),e.render(this.scene2,this.camera2)}this.camera.clearViewOffset&&this.camera.clearViewOffset(),e.autoClear=n,e.setClearColor(o,a)}}),SSAARenderPass.JitterVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];var SSAOShader={defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new Vector2},cameraProjectionMatrix:{value:new Matrix4},cameraInverseProjectionMatrix:{value:new Matrix4},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tDepth;","uniform sampler2D tNoise;","uniform vec3 kernel[ KERNEL_SIZE ];","uniform vec2 resolution;","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float kernelRadius;","uniform float minDistance;","uniform float maxDistance;","varying vec2 vUv;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","\treturn texture2D( tDepth, screenPosition ).x;","}","float getLinearDepth( const in vec2 screenPosition ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;","\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","\t#else","\t\treturn texture2D( depthSampler, coord ).x;","\t#endif","}","float getViewZ( const in float depth ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","\t#else","\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );","\t#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","\tclipPosition *= clipW; // unprojection.","\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec2 screenPosition ) {","\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","}","void main() {","\tfloat depth = getDepth( vUv );","\tfloat viewZ = getViewZ( depth );","\tvec3 viewPosition = getViewPosition( vUv, depth, viewZ );","\tvec3 viewNormal = getViewNormal( vUv );"," vec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );","\tvec3 random = texture2D( tNoise, vUv * noiseScale ).xyz;","\tvec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );","\tvec3 bitangent = cross( viewNormal, tangent );","\tmat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );"," float occlusion = 0.0;"," for ( int i = 0; i < KERNEL_SIZE; i ++ ) {","\t\tvec3 sampleVector = kernelMatrix * kernel[ i ];","\t\tvec3 samplePoint = viewPosition + ( sampleVector * kernelRadius );","\t\tvec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 );","\t\tsamplePointNDC /= samplePointNDC.w;","\t\tvec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5;","\t\tfloat realDepth = getLinearDepth( samplePointUv );","\t\tfloat sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar );","\t\tfloat delta = sampleDepth - realDepth;","\t\tif ( delta > minDistance && delta < maxDistance ) {","\t\t\tocclusion += 1.0;","\t\t}","\t}","\tocclusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );","\tgl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );","}"].join("\n")},SSAODepthShader={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","varying vec2 vUv;","#include <packing>","float getLinearDepth( const in vec2 screenPosition ) {","\t#if PERSPECTIVE_CAMERA == 1","\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;","\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","\t#else","\t\treturn texture2D( depthSampler, coord ).x;","\t#endif","}","void main() {","\tfloat depth = getLinearDepth( vUv );","\tgl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );","}"].join("\n")},SSAOBlurShader={uniforms:{tDiffuse:{value:null},resolution:{value:new Vector2}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","\tvec2 texelSize = ( 1.0 / resolution );","\tfloat result = 0.0;","\tfor ( int i = - 2; i <= 2; i ++ ) {","\t\tfor ( int j = - 2; j <= 2; j ++ ) {","\t\t\tvec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;","\t\t\tresult += texture2D( tDiffuse, vUv + offset ).r;","\t\t}","\t}","\tgl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );","}"].join("\n")},SSAOPass=function(e,t,i,r){Pass.call(this),this.width=void 0!==i?i:512,this.height=void 0!==r?r:512,this.clear=!0,this.camera=t,this.scene=e,this.kernelRadius=8,this.kernelSize=32,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this.generateSampleKernel(),this.generateRandomKernelRotations();var n=new DepthTexture;n.type=UnsignedShortType,n.minFilter=NearestFilter,n.maxFilter=NearestFilter,this.beautyRenderTarget=new WebGLRenderTarget(this.width,this.height,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,depthTexture:n,depthBuffer:!0}),this.normalRenderTarget=new WebGLRenderTarget(this.width,this.height,{minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat}),this.ssaoRenderTarget=new WebGLRenderTarget(this.width,this.height,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat}),this.blurRenderTarget=this.ssaoRenderTarget.clone(),void 0===SSAOShader&&console.error("SSAOPass: The pass relies on SSAOShader."),this.ssaoMaterial=new ShaderMaterial({defines:Object.assign({},SSAOShader.defines),uniforms:UniformsUtils.clone(SSAOShader.uniforms),vertexShader:SSAOShader.vertexShader,fragmentShader:SSAOShader.fragmentShader,blending:NoBlending}),this.ssaoMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.normalMaterial=new MeshNormalMaterial,this.normalMaterial.blending=NoBlending,this.blurMaterial=new ShaderMaterial({defines:Object.assign({},SSAOBlurShader.defines),uniforms:UniformsUtils.clone(SSAOBlurShader.uniforms),vertexShader:SSAOBlurShader.vertexShader,fragmentShader:SSAOBlurShader.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new ShaderMaterial({defines:Object.assign({},SSAODepthShader.defines),uniforms:UniformsUtils.clone(SSAODepthShader.uniforms),vertexShader:SSAODepthShader.vertexShader,fragmentShader:SSAODepthShader.fragmentShader,blending:NoBlending}),this.depthRenderMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(CopyShader.uniforms),vertexShader:CopyShader.vertexShader,fragmentShader:CopyShader.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:DstColorFactor,blendDst:ZeroFactor,blendEquation:AddEquation,blendSrcAlpha:DstAlphaFactor,blendDstAlpha:ZeroFactor,blendEquationAlpha:AddEquation}),this.quadCamera=new OrthographicCamera(-1,1,1,-1,0,1),this.quadScene=new Scene,this.quad=new Mesh(new PlaneBufferGeometry(2,2),null),this.quadScene.add(this.quad),this.originalClearColor=new Color};SSAOPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:SSAOPass,dispose:function(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.quad.geometry.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose()},render:function(e,t){switch(e.setRenderTarget(this.beautyRenderTarget),e.clear(),e.render(this.scene,this.camera),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(e,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(e,this.blurMaterial,this.blurRenderTarget),this.output){case SSAOPass.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(e,this.copyMaterial,null);break;case SSAOPass.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(e,this.copyMaterial,null);break;case SSAOPass.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(e,this.copyMaterial,null);break;case SSAOPass.OUTPUT.Depth:this.renderPass(e,this.depthRenderMaterial,null);break;case SSAOPass.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(e,this.copyMaterial,null);break;case SSAOPass.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(e,this.copyMaterial,null),this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=CustomBlending,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;default:console.warn("SSAOPass: Unknown output type.")}},renderPass:function(e,t,i,r,n){this.originalClearColor.copy(e.getClearColor());var o=e.getClearAlpha(),a=e.autoClear;e.setRenderTarget(i),e.autoClear=!1,null!=r&&(e.setClearColor(r),e.setClearAlpha(n||0),e.clear()),this.quad.material=t,e.render(this.quadScene,this.quadCamera),e.autoClear=a,e.setClearColor(this.originalClearColor),e.setClearAlpha(o)},renderOverride:function(e,t,i,r,n){this.originalClearColor.copy(e.getClearColor());var o=e.getClearAlpha(),a=e.autoClear;e.setRenderTarget(i),e.autoClear=!1,r=t.clearColor||r,n=t.clearAlpha||n,null!=r&&(e.setClearColor(r),e.setClearAlpha(n||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=a,e.setClearColor(this.originalClearColor),e.setClearAlpha(o)},setSize:function(e,t){this.width=e,this.height=t,this.beautyRenderTarget.setSize(e,t),this.ssaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.blurRenderTarget.setSize(e,t),this.ssaoMaterial.uniforms.resolution.value.set(e,t),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.getInverse(this.camera.projectionMatrix),this.blurMaterial.uniforms.resolution.value.set(e,t)},generateSampleKernel:function(){for(var e=this.kernelSize,t=this.kernel,i=0;i<e;i++){var r=new Vector3;r.x=2*Math.random()-1,r.y=2*Math.random()-1,r.z=Math.random(),r.normalize();var n=i/e;n=_Math.lerp(.1,1,n*n),r.multiplyScalar(n),t.push(r)}},generateRandomKernelRotations:function(){void 0===SimplexNoise&&console.error("SSAOPass: The pass relies on SimplexNoise.");for(var e=new SimplexNoise,t=new Float32Array(64),i=0;i<16;i++){var r=4*i,n=2*Math.random()-1,o=2*Math.random()-1,a=e.noise3d(n,o,0);t[r]=a,t[r+1]=a,t[r+2]=a,t[r+3]=1}this.noiseTexture=new DataTexture(t,4,4,RGBAFormat,FloatType),this.noiseTexture.wrapS=RepeatWrapping,this.noiseTexture.wrapT=RepeatWrapping,this.noiseTexture.needsUpdate=!0}}),SSAOPass.OUTPUT={Default:0,SSAO:1,Blur:2,Beauty:3,Depth:4,Normal:5};var TAARenderPass=function(e,t,i){void 0===SSAARenderPass&&console.error("TAARenderPass relies on SSAARenderPass"),SSAARenderPass.call(this,e,t,i),this.sampleLevel=0,this.accumulate=!1};TAARenderPass.JitterVectors=SSAARenderPass.JitterVectors,TAARenderPass.prototype=Object.assign(Object.create(SSAARenderPass.prototype),{constructor:TAARenderPass,render:function(e,t,i,r){if(!this.accumulate)return SSAARenderPass.prototype.render.call(this,e,t,i,r),void(this.accumulateIndex=-1);var n=TAARenderPass.JitterVectors[5];this.sampleRenderTarget||(this.sampleRenderTarget=new WebGLRenderTarget(i.width,i.height,this.params),this.sampleRenderTarget.texture.name="TAARenderPass.sample"),this.holdRenderTarget||(this.holdRenderTarget=new WebGLRenderTarget(i.width,i.height,this.params),this.holdRenderTarget.texture.name="TAARenderPass.hold"),this.accumulate&&-1===this.accumulateIndex&&(SSAARenderPass.prototype.render.call(this,e,this.holdRenderTarget,i,r),this.accumulateIndex=0);var o=e.autoClear;e.autoClear=!1;var a=1/n.length;if(this.accumulateIndex>=0&&this.accumulateIndex<n.length){this.copyUniforms.opacity.value=a,this.copyUniforms.tDiffuse.value=t.texture;for(var s=Math.pow(2,this.sampleLevel),l=0;l<s;l++){var u=n[this.accumulateIndex];if(this.camera.setViewOffset&&this.camera.setViewOffset(i.width,i.height,.0625*u[0],.0625*u[1],i.width,i.height),e.setRenderTarget(t),e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(this.sampleRenderTarget),0===this.accumulateIndex&&e.clear(),e.render(this.scene2,this.camera2),this.accumulateIndex++,this.accumulateIndex>=n.length)break}this.camera.clearViewOffset&&this.camera.clearViewOffset()}var h=this.accumulateIndex*a;h>0&&(this.copyUniforms.opacity.value=1,this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture,e.setRenderTarget(t),e.clear(),e.render(this.scene2,this.camera2)),h<1&&(this.copyUniforms.opacity.value=1-h,this.copyUniforms.tDiffuse.value=this.holdRenderTarget.texture,e.setRenderTarget(t),0===h&&e.clear(),e.render(this.scene2,this.camera2)),e.autoClear=o}});var TexturePass=function(e,t){Pass.call(this),void 0===CopyShader&&console.error("TexturePass relies on CopyShader");var i=CopyShader;this.map=e,this.opacity=void 0!==t?t:1,this.uniforms=UniformsUtils.clone(i.uniforms),this.material=new ShaderMaterial({uniforms:this.uniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,depthTest:!1,depthWrite:!1}),this.needsSwap=!1,this.camera=new OrthographicCamera(-1,1,1,-1,0,1),this.scene=new Scene,this.quad=new Mesh(new PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};TexturePass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:TexturePass,render:function(e,t,i,r,n){var o=e.autoClear;e.autoClear=!1,this.quad.material=this.material,this.uniforms.opacity.value=this.opacity,this.uniforms.tDiffuse.value=this.map,this.material.transparent=this.opacity<1,e.setRenderTarget(this.renderToScreen?null:i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.autoClear=o}});var LuminosityHighPassShader={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{type:"t",value:null},luminosityThreshold:{type:"f",value:1},smoothWidth:{type:"f",value:1},defaultColor:{type:"c",value:new Color(0)},defaultOpacity:{type:"f",value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")},UnrealBloomPass=function(e,t,i,r){Pass.call(this),this.strength=void 0!==t?t:1,this.radius=i,this.threshold=r,this.resolution=void 0!==e?new Vector2(e.x,e.y):new Vector2(256,256),this.clearColor=new Color(0,0,0);var n={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new WebGLRenderTarget(o,a,n),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var s=0;s<this.nMips;s++){var l=new WebGLRenderTarget(o,a,n);l.texture.name="UnrealBloomPass.h"+s,l.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(l);var u=new WebGLRenderTarget(o,a,n);u.texture.name="UnrealBloomPass.v"+s,u.texture.generateMipmaps=!1,this.renderTargetsVertical.push(u),o=Math.round(o/2),a=Math.round(a/2)}void 0===LuminosityHighPassShader&&console.error("UnrealBloomPass relies on LuminosityHighPassShader");var h=LuminosityHighPassShader;this.highPassUniforms=UniformsUtils.clone(h.uniforms),this.highPassUniforms.luminosityThreshold.value=r,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var c=[3,5,7,9,11];for(o=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2),s=0;s<this.nMips;s++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(c[s])),this.separableBlurMaterials[s].uniforms.texSize.value=new Vector2(o,a),o=Math.round(o/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new Vector3(1,1,1),new Vector3(1,1,1),new Vector3(1,1,1),new Vector3(1,1,1),new Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===CopyShader&&console.error("BloomPass relies on CopyShader");var d=CopyShader;this.copyUniforms=UniformsUtils.clone(d.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,blending:AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new Color,this.oldClearAlpha=1,this.camera=new OrthographicCamera(-1,1,1,-1,0,1),this.scene=new Scene,this.basic=new MeshBasicMaterial,this.quad=new Mesh(new PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};UnrealBloomPass.prototype=Object.assign(Object.create(Pass.prototype),{constructor:UnrealBloomPass,dispose:function(){for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()},setSize:function(e,t){var i=Math.round(e/2),r=Math.round(t/2);this.renderTargetBright.setSize(i,r);for(var n=0;n<this.nMips;n++)this.renderTargetsHorizontal[n].setSize(i,r),this.renderTargetsVertical[n].setSize(i,r),this.separableBlurMaterials[n].uniforms.texSize.value=new Vector2(i,r),i=Math.round(i/2),r=Math.round(r/2)},render:function(e,t,i,r,n){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),n&&e.context.disable(e.context.STENCIL_TEST),this.renderToScreen&&(this.quad.material=this.basic,this.basic.map=i.texture,e.setRenderTarget(null),e.clear(),e.render(this.scene,this.camera)),this.highPassUniforms.tDiffuse.value=i.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.quad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),e.render(this.scene,this.camera);for(var a=this.renderTargetBright,s=0;s<this.nMips;s++)this.quad.material=this.separableBlurMaterials[s],this.separableBlurMaterials[s].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[s].uniforms.direction.value=UnrealBloomPass.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[s]),e.clear(),e.render(this.scene,this.camera),this.separableBlurMaterials[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurMaterials[s].uniforms.direction.value=UnrealBloomPass.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[s]),e.clear(),e.render(this.scene,this.camera),a=this.renderTargetsVertical[s];this.quad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),e.render(this.scene,this.camera),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,n&&e.context.enable(e.context.STENCIL_TEST),this.renderToScreen?(e.setRenderTarget(null),e.render(this.scene,this.camera)):(e.setRenderTarget(i),e.render(this.scene,this.camera)),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=o},getSeperableBlurMaterial:function(e){return new ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new Vector2(.5,.5)},direction:{value:new Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(e){return new ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),UnrealBloomPass.BlurDirectionX=new Vector2(1,0),UnrealBloomPass.BlurDirectionY=new Vector2(0,1);var PRNG=function(){this.seed=1,this.next=function(){return this.gen()/2147483647},this.nextRange=function(e,t){return e+(t-e)*this.next()},this.gen=function(){return this.seed=16807*this.seed%2147483647}},CSS2DObject=function(e){Object3D.call(this),this.element=e,this.element.style.position="absolute",this.addEventListener("removed",function(e){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})};CSS2DObject.prototype=Object.create(Object3D.prototype),CSS2DObject.prototype.constructor=CSS2DObject;var CSS2DRenderer=function(){var e,t,i,r;console.log("CSS2DRenderer",REVISION);var n=new Vector3,o=new Matrix4,a=new Matrix4,s={objects:new WeakMap},l=document.createElement("div");l.style.overflow="hidden",this.domElement=l,this.getSize=function(){return{width:e,height:t}},this.setSize=function(n,o){i=(e=n)/2,r=(t=o)/2,l.style.width=n+"px",l.style.height=o+"px"};var u,h,c=function(e,t){if(e instanceof CSS2DObject){n.setFromMatrixPosition(e.matrixWorld),n.applyMatrix4(a);var o=e.element,u="translate(-50%,-50%) translate("+(n.x*i+i)+"px,"+(-n.y*r+r)+"px)";o.style.WebkitTransform=u,o.style.MozTransform=u,o.style.oTransform=u,o.style.transform=u;var h={distanceToCameraSquared:d(t,e)};s.objects.set(e,h),o.parentNode!==l&&l.appendChild(o)}for(var p=0,f=e.children.length;p<f;p++)c(e.children[p],t)},d=(u=new Vector3,h=new Vector3,function(e,t){return u.setFromMatrixPosition(e.matrixWorld),h.setFromMatrixPosition(t.matrixWorld),u.distanceToSquared(h)}),p=function(e){for(var t=function(e){var t=[];return e.traverse(function(e){e instanceof CSS2DObject&&t.push(e)}),t}(e).sort(function(e,t){return s.objects.get(e).distanceToCameraSquared-s.objects.get(t).distanceToCameraSquared}),i=t.length,r=0,n=t.length;r<n;r++)t[r].element.style.zIndex=i-r};this.render=function(e,t){e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),o.copy(t.matrixWorldInverse),a.multiplyMatrices(t.projectionMatrix,o),c(e,t),p(e)}},CSS3DObject=function(e){Object3D.call(this),this.element=e,this.element.style.position="absolute",this.addEventListener("removed",function(){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})};CSS3DObject.prototype=Object.create(Object3D.prototype),CSS3DObject.prototype.constructor=CSS3DObject;var CSS3DSprite=function(e){CSS3DObject.call(this,e)};CSS3DSprite.prototype=Object.create(CSS3DObject.prototype),CSS3DSprite.prototype.constructor=CSS3DSprite;var CSS3DRenderer=function(){var e,t,i,r;console.log("CSS3DRenderer",REVISION);var n=new Matrix4,o={camera:{fov:0,style:""},objects:new WeakMap},a=document.createElement("div");a.style.overflow="hidden",this.domElement=a;var s=document.createElement("div");s.style.WebkitTransformStyle="preserve-3d",s.style.transformStyle="preserve-3d",a.appendChild(s);var l=/Trident/i.test(navigator.userAgent);function u(e){return Math.abs(e)<1e-10?0:e}function h(e){var t=e.elements;return"matrix3d("+u(t[0])+","+u(-t[1])+","+u(t[2])+","+u(t[3])+","+u(t[4])+","+u(-t[5])+","+u(t[6])+","+u(t[7])+","+u(t[8])+","+u(-t[9])+","+u(t[10])+","+u(t[11])+","+u(t[12])+","+u(-t[13])+","+u(t[14])+","+u(t[15])+")"}function c(e,t){var n=e.elements,o="matrix3d("+u(n[0])+","+u(n[1])+","+u(n[2])+","+u(n[3])+","+u(-n[4])+","+u(-n[5])+","+u(-n[6])+","+u(-n[7])+","+u(n[8])+","+u(n[9])+","+u(n[10])+","+u(n[11])+","+u(n[12])+","+u(n[13])+","+u(n[14])+","+u(n[15])+")";return l?"translate(-50%,-50%)translate("+i+"px,"+r+"px)"+t+o:"translate(-50%,-50%)"+o}this.getSize=function(){return{width:e,height:t}},this.setSize=function(n,o){i=(e=n)/2,r=(t=o)/2,a.style.width=n+"px",a.style.height=o+"px",s.style.width=n+"px",s.style.height=o+"px"};var d,p,f=(d=new Vector3,p=new Vector3,function(e,t){return d.setFromMatrixPosition(e.matrixWorld),p.setFromMatrixPosition(t.matrixWorld),d.distanceToSquared(p)});function m(e){for(var t=function(e){var t=[];return e.traverse(function(e){e instanceof CSS3DObject&&t.push(e)}),t}(e).sort(function(e,t){return o.objects.get(e).distanceToCameraSquared-o.objects.get(t).distanceToCameraSquared}),i=t.length,r=0,n=t.length;r<n;r++)t[r].element.style.zIndex=i-r}this.render=function(e,t){var d=t.projectionMatrix.elements[5]*r;if(o.camera.fov!==d&&(t.isPerspectiveCamera&&(a.style.WebkitPerspective=d+"px",a.style.perspective=d+"px"),o.camera.fov=d),e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),t.isOrthographicCamera)var p=-(t.right+t.left)/2,v=(t.top+t.bottom)/2;var g=t.isOrthographicCamera?"scale("+d+")translate("+u(p)+"px,"+u(v)+"px)"+h(t.matrixWorldInverse):"translateZ("+d+"px)"+h(t.matrixWorldInverse),y=g+"translate("+i+"px,"+r+"px)";o.camera.style===y||l||(s.style.WebkitTransform=y,s.style.transform=y,o.camera.style=y),function e(t,i,r){if(t instanceof CSS3DObject){var a;t instanceof CSS3DSprite?(n.copy(i.matrixWorldInverse),n.transpose(),n.copyPosition(t.matrixWorld),n.scale(t.scale),n.elements[3]=0,n.elements[7]=0,n.elements[11]=0,n.elements[15]=1,a=c(n,r)):a=c(t.matrixWorld,r);var u=t.element,h=o.objects.get(t);if(void 0===h||h.style!==a){u.style.WebkitTransform=a,u.style.transform=a;var d={style:a};l&&(d.distanceToCameraSquared=f(i,t)),o.objects.set(t,d)}u.parentNode!==s&&s.appendChild(u)}for(var p=0,m=t.children.length;p<m;p++)e(t.children[p],i,r)}(e,t,g),l&&m(e)}},RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},RenderableFace=function(){this.id=0,this.v1=new RenderableVertex,this.v2=new RenderableVertex,this.v3=new RenderableVertex,this.normalModel=new Vector3,this.vertexNormalsModel=[new Vector3,new Vector3,new Vector3],this.vertexNormalsLength=0,this.color=new Color,this.material=null,this.uvs=[new Vector2,new Vector2,new Vector2],this.z=0,this.renderOrder=0},RenderableVertex=function(){this.position=new Vector3,this.positionWorld=new Vector3,this.positionScreen=new Vector4,this.visible=!0};RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)};var RenderableLine=function(){this.id=0,this.v1=new RenderableVertex,this.v2=new RenderableVertex,this.vertexColors=[new Color,new Color],this.material=null,this.z=0,this.renderOrder=0},RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new Vector2,this.material=null,this.renderOrder=0},Projector=function(){var e,t,i,r,n,o,a,s,l,u,h,c=[],d=0,p=[],f=0,m=[],v=0,g=[],y=0,_=[],b=0,x={objects:[],lights:[],elements:[]},w=new Vector3,S=new Vector4,M=new Box3(new Vector3(-1,-1,-1),new Vector3(1,1,1)),T=new Box3,A=new Array(3),C=new Matrix4,L=new Matrix4,N=new Matrix4,P=new Matrix3,k=new Frustum,E=new Vector4,D=new Vector4;this.projectVector=function(e,t){console.warn("Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("Projector: .pickingRay() is now raycaster.setFromCamera().")};var O=new function(){var e=[],t=[],r=[],o=null,s=new Matrix3;function l(e){var t=e.position,i=e.positionWorld,r=e.positionScreen;i.copy(t).applyMatrix4(h),r.copy(i).applyMatrix4(L);var n=1/r.w;r.x*=n,r.y*=n,r.z*=n,e.visible=r.x>=-1&&r.x<=1&&r.y>=-1&&r.y<=1&&r.z>=-1&&r.z<=1}function u(e,t,i){return!0===e.visible||!0===t.visible||!0===i.visible||(A[0]=e.positionScreen,A[1]=t.positionScreen,A[2]=i.positionScreen,M.intersectsBox(T.setFromPoints(A)))}function c(e,t,i){return(i.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(i.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(i){(o=i).material,s.getNormalMatrix(o.matrixWorld),e.length=0,t.length=0,r.length=0},projectVertex:l,checkTriangleVisibility:u,checkBackfaceCulling:c,pushVertex:function(e,t,r){(i=I()).position.set(e,t,r),l(i)},pushNormal:function(t,i,r){e.push(t,i,r)},pushColor:function(e,i,r){t.push(e,i,r)},pushUv:function(e,t){r.push(e,t)},pushLine:function(e,i){var r=p[e],n=p[i];r.positionScreen.copy(r.position).applyMatrix4(N),n.positionScreen.copy(n.position).applyMatrix4(N),!0===z(r.positionScreen,n.positionScreen)&&(r.positionScreen.multiplyScalar(1/r.positionScreen.w),n.positionScreen.multiplyScalar(1/n.positionScreen.w),(a=U()).id=o.id,a.v1.copy(r),a.v2.copy(n),a.z=Math.max(r.positionScreen.z,n.positionScreen.z),a.renderOrder=o.renderOrder,a.material=o.material,o.material.vertexColors===VertexColors&&(a.vertexColors[0].fromArray(t,3*e),a.vertexColors[1].fromArray(t,3*i)),x.elements.push(a))},pushTriangle:function(i,a,l,h){var d=arguments,f=p[i],m=p[a],v=p[l];if(!1!==u(f,m,v)&&(h.side===DoubleSide||!0===c(f,m,v))){(n=B()).id=o.id,n.v1.copy(f),n.v2.copy(m),n.v3.copy(v),n.z=(f.positionScreen.z+m.positionScreen.z+v.positionScreen.z)/3,n.renderOrder=o.renderOrder,w.subVectors(v.position,m.position),S.subVectors(f.position,m.position),w.cross(S),n.normalModel.copy(w),n.normalModel.applyMatrix3(s).normalize();for(var g=0;g<3;g++){var y=n.vertexNormalsModel[g];y.fromArray(e,3*d[g]),y.applyMatrix3(s).normalize(),n.uvs[g].fromArray(r,2*d[g])}n.vertexNormalsLength=3,n.material=h,h.vertexColors!==FaceColors&&h.vertexColors!==VertexColors||n.color.fromArray(t,3*i),x.elements.push(n)}}}};function R(i){(e=function(){if(t===d){var e=new RenderableObject;return c.push(e),d++,t++,e}return c[t++]}()).id=i.id,e.object=i,w.setFromMatrixPosition(i.matrixWorld),w.applyMatrix4(L),e.z=w.z,e.renderOrder=i.renderOrder,x.objects.push(e)}function F(e,t,i){var r=1/e.w;e.z*=r,e.z>=-1&&e.z<=1&&((l=function(){if(u===b){var e=new RenderableSprite;return _.push(e),b++,u++,e}return _[u++]}()).id=t.id,l.x=e.x*r,l.y=e.y*r,l.z=e.z,l.renderOrder=t.renderOrder,l.object=t,l.rotation=t.rotation,l.scale.x=t.scale.x*Math.abs(l.x-(e.x+i.projectionMatrix.elements[0])/(e.w+i.projectionMatrix.elements[12])),l.scale.y=t.scale.y*Math.abs(l.y-(e.y+i.projectionMatrix.elements[5])/(e.w+i.projectionMatrix.elements[13])),l.material=t.material,x.elements.push(l))}function I(){if(r===f){var e=new RenderableVertex;return p.push(e),f++,r++,e}return p[r++]}function B(){if(o===v){var e=new RenderableFace;return m.push(e),v++,o++,e}return m[o++]}function U(){if(s===y){var e=new RenderableLine;return g.push(e),y++,s++,e}return g[s++]}function V(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function z(e,t){var i=0,r=1,n=e.z+e.w,o=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return n>=0&&o>=0&&a>=0&&s>=0||!(n<0&&o<0||a<0&&s<0)&&(n<0?i=Math.max(i,n/(n-o)):o<0&&(r=Math.min(r,n/(n-o))),a<0?i=Math.max(i,a/(a-s)):s<0&&(r=Math.min(r,a/(a-s))),!(r<i)&&(e.lerp(t,i),t.lerp(e,1-r),!0))}this.projectScene=function(e,i,l,c){o=0,s=0,u=0,x.elements.length=0,!0===e.autoUpdate&&e.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld(),C.copy(i.matrixWorldInverse),L.multiplyMatrices(i.projectionMatrix,C),k.setFromMatrix(L),t=0,x.objects.length=0,x.lights.length=0,function e(t){if(!1!==t.visible){if(t instanceof Light)x.lights.push(t);else if(t instanceof Mesh||t instanceof Line||t instanceof Points){if(!1===t.material.visible)return;if(!0===t.frustumCulled&&!1===k.intersectsObject(t))return;R(t)}else if(t instanceof Sprite){if(!1===t.material.visible)return;if(!0===t.frustumCulled&&!1===k.intersectsSprite(t))return;R(t)}for(var i=t.children,r=0,n=i.length;r<n;r++)e(i[r])}}(e),!0===l&&x.objects.sort(V);for(var d=x.objects,f=0,m=d.length;f<m;f++){var v=d[f].object,g=v.geometry;if(O.setObject(v),h=v.matrixWorld,r=0,v instanceof Mesh){if(g instanceof BufferGeometry){var y=v.material,_=Array.isArray(y),b=g.attributes,M=g.groups;if(void 0===b.position)continue;for(var T=0,A=(Te=b.position.array).length;T<A;T+=3){var G=Te[T],j=Te[T+1],W=Te[T+2];if(!0===y.morphTargets)for(var H=g.morphAttributes.position,q=v.morphTargetInfluences,Y=0,X=H.length;Y<X;Y++){if(0!==(ae=q[Y]))G+=((se=H[Y]).getX(T/3)-Te[T])*ae,j+=(se.getY(T/3)-Te[T+1])*ae,W+=(se.getZ(T/3)-Te[T+2])*ae}O.pushVertex(G,j,W)}if(void 0!==b.normal){var K=b.normal.array;for(T=0,A=K.length;T<A;T+=3)O.pushNormal(K[T],K[T+1],K[T+2])}if(void 0!==b.color)for(T=0,A=(Se=b.color.array).length;T<A;T+=3)O.pushColor(Se[T],Se[T+1],Se[T+2]);if(void 0!==b.uv){var Q=b.uv.array;for(T=0,A=Q.length;T<A;T+=2)O.pushUv(Q[T],Q[T+1])}if(null!==g.index){var Z=g.index.array;if(M.length>0)for(var J=0;J<M.length;J++){var $=M[J];if(void 0!==(y=!0===_?v.material[$.materialIndex]:v.material))for(T=$.start,A=$.start+$.count;T<A;T+=3)O.pushTriangle(Z[T],Z[T+1],Z[T+2],y)}else for(T=0,A=Z.length;T<A;T+=3)O.pushTriangle(Z[T],Z[T+1],Z[T+2],y)}else if(M.length>0)for(J=0;J<M.length;J++){$=M[J];if(void 0!==(y=!0===_?v.material[$.materialIndex]:v.material))for(T=$.start,A=$.start+$.count;T<A;T+=3)O.pushTriangle(T,T+1,T+2,y)}else for(T=0,A=Te.length/3;T<A;T+=3)O.pushTriangle(T,T+1,T+2,y)}else if(g instanceof Geometry){var ee=g.vertices,te=g.faces,ie=g.faceVertexUvs[0];P.getNormalMatrix(h);y=v.material,_=Array.isArray(y);for(var re=0,ne=ee.length;re<ne;re++){var oe=ee[re];if(w.copy(oe),!0===y.morphTargets)for(H=g.morphTargets,q=v.morphTargetInfluences,Y=0,X=H.length;Y<X;Y++){var ae;if(0!==(ae=q[Y])){var se,le=(se=H[Y]).vertices[re];w.x+=(le.x-oe.x)*ae,w.y+=(le.y-oe.y)*ae,w.z+=(le.z-oe.z)*ae}}O.pushVertex(w.x,w.y,w.z)}for(var ue=0,he=te.length;ue<he;ue++){var ce=te[ue];if(void 0!==(y=!0===_?v.material[ce.materialIndex]:v.material)){var de=y.side,pe=p[ce.a],fe=p[ce.b],me=p[ce.c];if(!1!==O.checkTriangleVisibility(pe,fe,me)){var ve=O.checkBackfaceCulling(pe,fe,me);if(de!==DoubleSide){if(de===FrontSide&&!1===ve)continue;if(de===BackSide&&!0===ve)continue}(n=B()).id=v.id,n.v1.copy(pe),n.v2.copy(fe),n.v3.copy(me),n.normalModel.copy(ce.normal),!1!==ve||de!==BackSide&&de!==DoubleSide||n.normalModel.negate(),n.normalModel.applyMatrix3(P).normalize();for(var ge=ce.vertexNormals,ye=0,_e=Math.min(ge.length,3);ye<_e;ye++){var be=n.vertexNormalsModel[ye];be.copy(ge[ye]),!1!==ve||de!==BackSide&&de!==DoubleSide||be.negate(),be.applyMatrix3(P).normalize()}n.vertexNormalsLength=ge.length;var xe=ie[ue];if(void 0!==xe)for(var we=0;we<3;we++)n.uvs[we].copy(xe[we]);n.color=ce.color,n.material=y,n.z=(pe.positionScreen.z+fe.positionScreen.z+me.positionScreen.z)/3,n.renderOrder=v.renderOrder,x.elements.push(n)}}}}}else if(v instanceof Line){if(N.multiplyMatrices(L,h),g instanceof BufferGeometry){if(void 0!==(b=g.attributes).position){for(T=0,A=(Te=b.position.array).length;T<A;T+=3)O.pushVertex(Te[T],Te[T+1],Te[T+2]);if(void 0!==b.color){var Se;for(T=0,A=(Se=b.color.array).length;T<A;T+=3)O.pushColor(Se[T],Se[T+1],Se[T+2])}if(null!==g.index)for(T=0,A=(Z=g.index.array).length;T<A;T+=2)O.pushLine(Z[T],Z[T+1]);else{var Me=v instanceof LineSegments?2:1;for(T=0,A=Te.length/3-1;T<A;T+=Me)O.pushLine(T,T+1)}}}else if(g instanceof Geometry){if(0===(ee=v.geometry.vertices).length)continue;(pe=I()).positionScreen.copy(ee[0]).applyMatrix4(N);for(Me=v instanceof LineSegments?2:1,re=1,ne=ee.length;re<ne;re++)(pe=I()).positionScreen.copy(ee[re]).applyMatrix4(N),(re+1)%Me>0||(fe=p[r-2],E.copy(pe.positionScreen),D.copy(fe.positionScreen),!0===z(E,D)&&(E.multiplyScalar(1/E.w),D.multiplyScalar(1/D.w),(a=U()).id=v.id,a.v1.positionScreen.copy(E),a.v2.positionScreen.copy(D),a.z=Math.max(E.z,D.z),a.renderOrder=v.renderOrder,a.material=v.material,v.material.vertexColors===VertexColors&&(a.vertexColors[0].copy(v.geometry.colors[re]),a.vertexColors[1].copy(v.geometry.colors[re-1])),x.elements.push(a)))}}else if(v instanceof Points){if(N.multiplyMatrices(L,h),g instanceof Geometry)for(re=0,ne=(ee=v.geometry.vertices).length;re<ne;re++){oe=ee[re];S.set(oe.x,oe.y,oe.z,1),S.applyMatrix4(N),F(S,v,i)}else if(g instanceof BufferGeometry){if(void 0!==(b=g.attributes).position){var Te;for(T=0,A=(Te=b.position.array).length;T<A;T+=3)S.set(Te[T],Te[T+1],Te[T+2],1),S.applyMatrix4(N),F(S,v,i)}}}else v instanceof Sprite&&(v.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,v.matrixWorld),S.set(h.elements[12],h.elements[13],h.elements[14],1),S.applyMatrix4(L),F(S,v,i))}return!0===c&&x.elements.sort(V),x}},RaytracingRenderer=function(e){console.log("RaytracingRenderer",REVISION),e=e||{};var t,i,r=this,n=[],o=!1,a=document.createElement("canvas"),s=a.getContext("2d",{alpha:!0===e.alpha}),l=new Color(0);this.domElement=a,this.autoClear=!0;var u=e.workers,h=e.blockSize||64;this.randomize=e.randomize;var c,d,p,f=[],m=0,v=0;function g(e){e.postMessage({init:[t,i],worker:e.id,blockSize:h})}function y(e){if(!f.length)return o=!1,r.dispatchEvent({type:"complete"});var t=f.pop(),i=t%d*h,n=(t/d|0)*h;e.postMessage({render:!0,x:i,y:n,sceneId:v}),s.fillStyle="#"+e.color,s.fillRect(i,n,h,h)}console.log("%cSpinning off "+u+" Workers ","font-size: 20px; background: black; color: white; font-family: monospace;"),this.setWorkers=function(t){for(u=t||navigator.hardwareConcurrency||4;n.length<u;){var i=new Worker(e.workerPath);i.id=m++,i.onmessage=function(e){var t=e.data;if(t&&t.blockSize&&v==t.sceneId){var i=new ImageData(new Uint8ClampedArray(t.data),t.blockSize,t.blockSize);if(s.putImageData(i,t.blockX,t.blockY),console.log("Worker "+this.id,t.time/1e3,(Date.now()-x)/1e3+" s"),n.length>u)return n.splice(n.indexOf(this),1),this.terminate();y(this)}},i.color=(new Color).setHSL(Math.random(),.8,.8).getHexString(),n.push(i),g(i),o&&(i.postMessage({scene:_,camera:b,annex:w,sceneId:v}),y(i))}if(!o)for(;n.length>u;)n.pop().terminate()},this.setWorkers(u),this.setClearColor=function(e){l.set(e)},this.setPixelRatio=function(){},this.setSize=function(e,r){a.width=e,a.height=r,t=a.width,i=a.height,s.fillStyle="white",n.forEach(g)},this.setSize(a.width,a.height),this.clear=function(){};var _,b,x,w={},S={mirror:1,reflectivity:1,refractionRatio:1,glass:1};function M(e){var t=e.material;if(t&&!(t.uuid in w)){var i={};for(var r in S)void 0!==t[r]&&(i[r]=t[r]);w[t.uuid]=i}}this.render=function(e,a){o=!0,!0===e.autoUpdate&&e.updateMatrixWorld(),null===a.parent&&a.updateMatrixWorld(),_=e.toJSON(),b=a.toJSON(),++v,e.traverse(M),n.forEach(function(e){e.postMessage({scene:_,camera:b,annex:w,sceneId:v})}),s.clearRect(0,0,t,i),x=Date.now(),d=Math.ceil(t/h),p=Math.ceil(i/h),c=d*p,f=[];for(var l=0;l<c;l++)f.push(l);if(r.randomize)for(l=0;l<c;l++){var u=Math.random()*c|0,m=f[u];f[u]=f[l],f[l]=m}n.forEach(y)}};Object.assign(RaytracingRenderer.prototype,EventDispatcher.prototype);var SoftwareRenderer=function(e){console.log("SoftwareRenderer",REVISION);var t,i,r,n,o,a,s,l,u,h,c,d,p,f,m,v,g=void 0!==(e=e||{}).canvas?e.canvas:document.createElement("canvas"),y=g.getContext("2d",{alpha:!0===e.alpha}),_={},b={},x=new Color(0),w=!0===e.alpha?0:1,S=1,M=2,T=4,A=(1<<T)-1,C=3,L=1<<C,N=1<<24,P=!1,k=new Vector3(0,0,1),E=new Vector3,D=1/0,O=1/0,R=0,F=0,I=1/0,B=1/0,U=0,V=0,z=new Projector,G=new Vector4,j=new Vector4,W=new Vector4,H=new Vector2,q=new Vector2,Y=new Vector2,X=[],K=0,Q=[],Z=0,J=[],$=0,ee=this;function te(){return!0===e.alpha?w:1}function ie(e){for(var r=t*i*4,n=0;n<r;n+=4)d[n]=255*e.r|0,d[n+1]=255*e.g|0,d[n+2]=255*e.b|0,d[n+3]=255*te()|0;y.fillStyle="rgba("+(255*x.r|0)+","+(255*x.g|0)+","+(255*x.b|0)+","+te()+")",y.fillRect(0,0,t,i)}function re(e,t){var i=0,r=0,n=255*e.color.r,o=255*e.color.g,a=255*e.color.b,s=new Uint8Array(768);if(t){for(;i<204;)s[r++]=Math.min(i*n/204,255),s[r++]=Math.min(i*o/204,255),s[r++]=Math.min(i*a/204,255),++i;for(;i<256;)s[r++]=Math.min(n+(i-204)*(255-n)/82,255),s[r++]=Math.min(o+(i-204)*(255-o)/82,255),s[r++]=Math.min(a+(i-204)*(255-a)/82,255),++i}else for(;i<256;)s[r++]=Math.min(i*n/255,255),s[r++]=Math.min(i*o/255,255),s[r++]=Math.min(i*a/255,255),++i;return s}function ne(e,t,i,r,n,o,a,s,l){var u=4*i,h=b[l.map.id];if(h.data){var c=h.width,d=l.transparent,p=c-1,f=h.data,m=4*((o*c&p)*c+(n*c&p));if(d){var v=f[m],g=f[m+1],y=f[m+2],_=f[m+3]*l.opacity/255,x=e[u],w=e[u+1],S=e[u+2];e[u]=v*_+x*(1-_),e[u+1]=g*_+w*(1-_),e[u+2]=y*_+S*(1-_),e[u+3]=(l.opacity<<8)-1,255==e[u+3]&&(t[i]=r)}else e[u]=f[m],e[u+1]=f[m+1],e[u+2]=f[m+2],e[u+3]=(l.opacity<<8)-1,t[i]=r}}function oe(e,t,i,r,n,o,a,s,l){var u=4*i,h=b[l.map.id];if(h.data){var c=h.width,d=l.transparent,p=3*(a>0?~~a:0),f=c-1,m=h.data,v=4*((o*c&f)*c+(n*c&f));if(d){var g=l.palette[p]*m[v],y=l.palette[p+1]*m[v+1],_=l.palette[p+2]*m[v+2],x=m[v+3]*l.opacity/256,w=e[u],S=e[u+1],M=e[u+2];e[u]=g*x+w*(1-x),e[u+1]=y*x+S*(1-x),e[u+2]=_*x+M*(1-x),e[u+3]=(l.opacity<<8)-1,255==e[u+3]&&(t[i]=r)}else e[u]=l.palette[p]*m[v]>>8,e[u+1]=l.palette[p+1]*m[v+1]>>8,e[u+2]=l.palette[p+2]*m[v+2]>>8,e[u+3]=(l.opacity<<8)-1,t[i]=r}}function ae(e){var t=e.id,i=_[t];if(i&&e.map&&!b[e.map.id]&&delete _[t],void 0===_[t]||!0===e.needsUpdate){if(e instanceof MeshBasicMaterial||e instanceof MeshLambertMaterial||e instanceof MeshPhongMaterial||e instanceof SpriteMaterial)if(e instanceof MeshLambertMaterial?e.palette||(e.palette=re(e,!1)):e instanceof MeshPhongMaterial&&(e.palette||(e.palette=re(e,!0))),e.map){var r=new SoftwareRenderer.Texture;if(r.fromImage(e.map.image),!r.data)return;b[e.map.id]=r,i=e instanceof MeshBasicMaterial||e instanceof SpriteMaterial?ne:oe}else n=e.vertexColors===FaceColors||e.vertexColors===VertexColors?["var colorOffset = offset * 4;","buffer[ colorOffset ] = face.color.r * 255;","buffer[ colorOffset + 1 ] = face.color.g * 255;","buffer[ colorOffset + 2 ] = face.color.b * 255;","buffer[ colorOffset + 3 ] = material.opacity * 255;","depthBuf[ offset ] = depth;"].join("\n"):["var colorOffset = offset * 4;","buffer[ colorOffset ] = material.color.r * 255;","buffer[ colorOffset + 1 ] = material.color.g * 255;","buffer[ colorOffset + 2 ] = material.color.b * 255;","buffer[ colorOffset + 3 ] = material.opacity * 255;","depthBuf[ offset ] = depth;"].join("\n"),i=new Function("buffer, depthBuf, offset, depth, u, v, n, face, material",n);else if(e instanceof LineBasicMaterial){var n=["var colorOffset = offset * 4;","buffer[ colorOffset ] = material.color.r * (color1.r+color2.r) * 0.5 * 255;","buffer[ colorOffset + 1 ] = material.color.g * (color1.g+color2.g) * 0.5 * 255;","buffer[ colorOffset + 2 ] = material.color.b * (color1.b+color2.b) * 0.5 * 255;","buffer[ colorOffset + 3 ] = 255;","depthBuf[ offset ] = depth;"].join("\n");i=new Function("buffer, depthBuf, offset, depth, color1, color2, material",n)}else{n=["var colorOffset = offset * 4;","buffer[ colorOffset ] = u * 255;","buffer[ colorOffset + 1 ] = v * 255;","buffer[ colorOffset + 2 ] = 0;","buffer[ colorOffset + 3 ] = 255;","depthBuf[ offset ] = depth;"].join("\n");i=new Function("buffer, depthBuf, offset, depth, u, v, n, face, material",n)}_[t]=i,e.needsUpdate=!1}return i}function se(e,n,c,f,g,y,_,b,x){if(!(e.z<-1||e.z>1||n.z<-1||n.z>1||c.z<-1||c.z>1)){var w=1<<T,N=e.x*o+l|0,P=n.x*o+l|0,k=c.x*o+l|0,E=e.y*a+u|0,I=n.y*a+u|0,B=c.y*a+u|0,U=b.vertexNormalsModel&&b.vertexNormalsModel.length,V=f&&g&&y,z=Math.max(Math.sqrt((N-P)*(N-P)+(E-I)*(E-I)),Math.sqrt((P-k)*(P-k)+(I-B)*(I-B)),Math.sqrt((k-N)*(k-N)+(B-E)*(B-E)));if(!(b instanceof RenderableSprite)&&z>100*w){var G,j,W,H,q,Y,ee,te,ie,re,ne={vertexNormalsModel:[],color:b.color};if(V)$===J.length?(G=new Vector2,J.push(G),++$,j=new Vector2,J.push(j),++$,W=new Vector2,J.push(W),++$):(G=J[$],j=J[++$],W=J[++$],++$),H=(1+n.z)*(n.w/e.w)/(1+e.z),G.copy(f).multiplyScalar(H).add(g).multiplyScalar(1/(H+1)),H=(1+c.z)*(c.w/n.w)/(1+n.z),j.copy(g).multiplyScalar(H).add(y).multiplyScalar(1/(H+1)),H=(1+e.z)*(e.w/c.w)/(1+c.z),W.copy(y).multiplyScalar(H).add(f).multiplyScalar(1/(H+1));return K===X.length?(q=new Vector4,X.push(q),++K,Y=new Vector4,X.push(Y),++K,ee=new Vector4,X.push(ee),++K):(q=X[K],Y=X[++K],ee=X[++K],++K),q.copy(e).add(n).multiplyScalar(.5),Y.copy(n).add(c).multiplyScalar(.5),ee.copy(c).add(e).multiplyScalar(.5),U&&(Z===Q.length?(te=new Vector3,Q.push(te),++Z,ie=new Vector3,Q.push(ie),++Z,re=new Vector3,Q.push(re),++Z):(te=Q[Z],ie=Q[++Z],re=Q[++Z],++Z),te.copy(b.vertexNormalsModel[0]).add(b.vertexNormalsModel[1]).normalize(),ie.copy(b.vertexNormalsModel[1]).add(b.vertexNormalsModel[2]).normalize(),re.copy(b.vertexNormalsModel[2]).add(b.vertexNormalsModel[0]).normalize()),U&&(ne.vertexNormalsModel[0]=b.vertexNormalsModel[0],ne.vertexNormalsModel[1]=te,ne.vertexNormalsModel[2]=re),se(e,q,ee,f,G,W,_,ne,x),U&&(ne.vertexNormalsModel[0]=b.vertexNormalsModel[1],ne.vertexNormalsModel[1]=ie,ne.vertexNormalsModel[2]=te),se(n,Y,q,g,j,G,_,ne,x),U&&(ne.vertexNormalsModel[0]=te,ne.vertexNormalsModel[1]=ie,ne.vertexNormalsModel[2]=re),se(q,Y,ee,G,j,W,_,ne,x),U&&(ne.vertexNormalsModel[0]=b.vertexNormalsModel[2],ne.vertexNormalsModel[1]=re,ne.vertexNormalsModel[2]=ie),void se(c,ee,Y,y,W,j,_,ne,x)}var oe,ae,le,he,ce,de,pe,fe,me,ve,ge,ye,_e=e.z*s+h|0,be=n.z*s+h|0,xe=c.z*s+h|0;V=!1;f&&g&&y&&(V=!0,oe=f.x,ae=1-f.y,le=g.x,he=1-g.y,ce=y.x,de=1-y.y),U&&(pe=b.vertexNormalsModel[0],fe=b.vertexNormalsModel[1],me=b.vertexNormalsModel[2],ve=255*pe.z,ge=255*fe.z,ye=255*me.z);var we=N-P,Se=I-E,Me=P-k,Te=B-I,Ae=k-N,Ce=E-B,Le=Math.max(Math.min(N,P,k)+A>>T,0),Ne=Math.min(Math.max(N,P,k)+A>>T,t),Pe=Math.max(Math.min(E,I,B)+A>>T,0),ke=Math.min(Math.max(E,I,B)+A>>T,i);D=Math.min(Le,D),R=Math.max(Ne,R),O=Math.min(Pe,O),F=Math.max(ke,F);var Ee=L,De=(Le&=~(Ee-1))<<T,Oe=(Pe&=~(Ee-1))<<T,Re=Se*(De-N)+we*(Oe-E),Fe=Te*(De-P)+Me*(Oe-I),Ie=Ce*(De-k)+Ae*(Oe-B);(Se>0||0==Se&&we>0)&&Re++,(Te>0||0==Te&&Me>0)&&Fe++,(Ce>0||0==Ce&&Ae>0)&&Ie++;var Be,Ue,Ve,ze,Ge,je=_e-be,We=xe-_e,He=1/(we*Ce-Ae*Se),qe=He*(je*Ce-We*Se),Ye=He*(je*Ae-we*We),Xe=_e+(De-N)*qe+(Oe-E)*Ye|0;if(V){var Ke=oe-le,Qe=ce-oe,Ze=He*(Ke*Ce-Qe*Se),Je=He*(Ke*Ae-we*Qe),$e=ae-he,et=de-ae;Ve=oe+(De-N)*Ze+(Oe-E)*Je,ze=ae+(De-N)*(Be=He*($e*Ce-et*Se))+(Oe-E)*(Ue=He*($e*Ae-we*et)),Ze*=w,Je*=w,Be*=w,Ue*=w}if(U){var tt,it=ve-ge,rt=ye-ve,nt=He*(it*Ce-rt*Se);Ge=ve+(De-N)*nt+(Oe-E)*(tt=He*(it*Ae-we*rt)),nt*=w,tt*=w}var ot=Ee-1,at=0,st=0,lt=0,ut=0,ht=0,ct=0,dt=0,pt=0;we>=0?st-=ot*we:at-=ot*we,Se>=0?st-=ot*Se:at-=ot*Se,Me>=0?ut-=ot*Me:lt-=ot*Me,Te>=0?ut-=ot*Te:lt-=ot*Te,Ae>=0?ct-=ot*Ae:ht-=ot*Ae,Ce>=0?ct-=ot*Ce:ht-=ot*Ce,(qe=qe*w|0)>=0?pt+=ot*qe:dt+=ot*qe,(Ye=Ye*w|0)>=0?pt+=ot*Ye:dt+=ot*Ye;var ft,mt,vt,gt=t-Ee,yt=Re=Re-1>>T,_t=Fe=Fe-1>>T,bt=Ie=Ie-1>>T,xt=Xe,wt=-Ee,St=wt*Se,Mt=wt*Te,Tt=wt*Ce,At=wt*qe;V&&(ft=wt*Ze,mt=wt*Be),U&&(vt=wt*nt);for(var Ct=Le,Lt=Pe;Lt<ke;Lt+=Ee){for(;Ct>=Le&&Ct<Ne&&yt>=st&&_t>=ut&&bt>=ct;)Ct+=wt,yt+=St,_t+=Mt,bt+=Tt,xt+=At,V&&(Ve+=ft,ze+=mt),U&&(Ge+=vt);for(wt=-wt,St=-St,Mt=-Mt,Tt=-Tt,At=-At,V&&(ft=-ft,mt=-mt),U&&(vt=-vt);yt+=St,_t+=Mt,bt+=Tt,xt+=At,V&&(Ve+=ft,ze+=mt),U&&(Ge+=vt),!((Ct+=wt)<Le||Ct>=Ne);)if(yt<st){if(St<0)break}else if(_t<ut){if(Mt<0)break}else if(bt<ct){if(Tt<0)break}else{var Nt=Ct>>C,Pt=Lt>>C,kt=Nt+Pt*r,Et=xt+dt;if(!(m[kt]<Et)){var Dt=v[kt];Dt&M&&ue(Nt,Pt),v[kt]=Dt&~(S|M);var Ot=Ct+Lt*t;if(yt>=at&&_t>=lt&&bt>=ht){var Rt=xt+pt;m[kt]=Math.min(m[kt],Rt);var Ft=yt,It=_t,Bt=xt;V&&(Wt=Ve,Ht=ze),U&&(qt=Ge);for(var Ut=0;Ut<Ee;Ut++){var Vt=Ft,zt=It,Gt=Bt;V&&(Xt=Wt,Kt=Ht),U&&(Qt=qt);for(var jt=0;jt<Ee;jt++){(Jt=Gt)<p[Ot]&&_(d,p,Ot,Jt,Xt,Kt,Qt,b,x),Vt+=Se,zt+=Te,Gt+=qe,V&&(Xt+=Ze,Kt+=Be),U&&(Qt+=nt),Ot++}Ft+=we,It+=Me,Bt+=Ye,V&&(Wt+=Je,Ht+=Ue),U&&(qt+=tt),Ot+=gt}}else{Ft=yt,It=_t;var Wt,Ht,qt,Yt=bt;Bt=xt;V&&(Wt=Ve,Ht=ze),U&&(qt=Ge);for(Ut=0;Ut<Ee;Ut++){Vt=Ft,zt=It;var Xt,Kt,Qt,Zt=Yt;Gt=Bt;V&&(Xt=Wt,Kt=Ht),U&&(Qt=qt);for(jt=0;jt<Ee;jt++){var Jt;if((Vt|zt|Zt)>=0)(Jt=Gt)<p[Ot]&&_(d,p,Ot,Jt,Xt,Kt,Qt,b,x);Vt+=Se,zt+=Te,Zt+=Ce,Gt+=qe,V&&(Xt+=Ze,Kt+=Be),U&&(Qt+=nt),Ot++}Ft+=we,It+=Me,Yt+=Ae,Bt+=Ye,V&&(Wt+=Je,Ht+=Ue),U&&(qt+=tt),Ot+=gt}}}}yt+=Ee*we,_t+=Ee*Me,bt+=Ee*Ae,xt+=Ee*Ye,V&&(Ve+=Ee*Je,ze+=Ee*Ue),U&&(Ge+=Ee*tt)}}}function le(e,n,c,f,y,_){if(P||(P=!0,L=1<<(C=0),ee.setSize(g.width,g.height)),!(e.z<-1||e.z>1||n.z<-1||n.z>1)){var b=Math.floor(.5*(_.linewidth-1)),x=e.x*o+l|0,w=n.x*o+l|0,N=e.y*a+u|0,I=n.y*a+u|0,B=e.z*s+h|0,U=n.z*s+h|0,V=x-w,z=N-I,G=B-U,j=Math.max(Math.min(x,w)+A>>T,0),W=Math.min(Math.max(x,w)+A>>T,t),H=Math.max(Math.min(N,I)+A>>T,0),q=Math.min(Math.max(N,I)+A>>T,i),Y=Math.max(Math.min(B,U)+A>>T,0),X=Math.max(B,U)+A>>T;D=Math.min(j,D),R=Math.max(W,R),O=Math.min(H,O),F=Math.max(q,F);var K,Q,Z,J,$,te=Math.sqrt(z*z+V*V),ie=V/te,re=z/te,ne=G/te;for(E.set(ie,re,ne),E.cross(k),E.normalize();te>0;){K=(K=w+te*ie)+A>>T,Q=(Q=I+te*re)+A>>T,$=U+te*ne+A>>T;for(var oe=-b;oe<=b;++oe)if(Z=Math.floor(K+E.x*oe),J=Math.floor(Q+E.y*oe),!(D>=Z||R<=Z||O>=J||F<=J)){var ae=Z>>C,se=J>>C,le=ae+se*r;if(!(m[le]<Y)){m[le]=Math.min(m[le],X);var he=v[le];he&M&&ue(ae,se),v[le]=he&~(S|M);var ce=Z+J*t;$<p[ce]&&y(d,p,ce,$,c,f,_)}}--te}}}function ue(e,i){for(var r=e*L+i*L*t,n=4*r,o=t-L,a=4*o,s=0;s<L;s++){for(var l=0;l<L;l++)p[r++]=N,d[n++]=255*x.r|0,d[n++]=255*x.g|0,d[n++]=255*x.b|0,d[n++]=255*te()|0;r+=o,n+=a}}this.domElement=g,this.autoClear=!0,this.setClearColor=function(e,t){x.set(e),w=t,ie(x)},this.setPixelRatio=function(){},this.setSize=function(e,_){r=Math.floor(e/L),n=Math.floor(_/L);var b=1<<T;o=b*(t=r*L)/2,a=-b*(i=n*L)/2,s=N/2,l=b*t/2+.5,u=b*i/2+.5,h=N/2+.5,g.width=t,g.height=i,c=y.getImageData(0,0,t,i),d=c.data,p=new Int32Array(d.length/4),f=r*n,m=new Int32Array(f),v=new Uint8Array(f);for(var w=0,M=p.length;w<M;w++)p[w]=N;for(w=0;w<f;w++)v[w]=S;ie(x)},this.clear=function(){D=1/0,O=1/0,R=0,F=0,K=0,Z=0,$=0;for(var e=0;e<f;e++)m[e]=N,v[e]=v[e]&S?S:M},this.render=function(e,t){this.clear();var i=e.background;i&&i.isColor&&ie(i);for(var o=z.projectScene(e,t,!1,!1).elements,a=0,s=o.length;a<s;a++){var l=o[a],u=l.material;if(p=ae(u))if(l instanceof RenderableFace)l.uvs?se(l.v1.positionScreen,l.v2.positionScreen,l.v3.positionScreen,l.uvs[0],l.uvs[1],l.uvs[2],p,l,u):se(l.v1.positionScreen,l.v2.positionScreen,l.v3.positionScreen,null,null,null,p,l,u);else if(l instanceof RenderableSprite){var h=.5*l.scale.x,d=.5*l.scale.y;G.copy(l),G.x-=h,G.y+=d,j.copy(l),j.x-=h,j.y-=d,W.copy(l),W.x+=h,W.y+=d,u.map?(H.set(0,1),q.set(0,0),Y.set(1,1),se(G,j,W,H,q,Y,p,l,u)):se(G,j,W,null,null,null,p,l,u),G.copy(l),G.x+=h,G.y+=d,j.copy(l),j.x-=h,j.y-=d,W.copy(l),W.x+=h,W.y-=d,u.map?(H.set(1,1),q.set(0,0),Y.set(1,0),se(G,j,W,H,q,Y,p,l,u)):se(G,j,W,null,null,null,p,l,u)}else if(l instanceof RenderableLine){var p=ae(u);le(l.v1.positionScreen,l.v2.positionScreen,l.vertexColors[0],l.vertexColors[1],p,u)}}!function(){for(var e=0,t=0;t<n;t++)for(var i=0;i<r;i++)v[e]&M&&(ue(i,t),v[e]=S),e++}();var f=Math.min(D,I),m=Math.min(O,B),g=Math.max(R,U)-f,_=Math.max(F,V)-m;f!==1/0&&y.putImageData(c,0,0,f,m,g,_),I=D,B=O,U=R,V=F}};SoftwareRenderer.Texture=function(){var e;this.fromImage=function(t){if(!(!t||t.width<=0||t.height<=0)){void 0===e&&(e=document.createElement("canvas"));var i=t.width>t.height?t.width:t.height;i=_Math.ceilPowerOfTwo(i),e.width==i&&e.height==i||(e.width=i,e.height=i);var r=e.getContext("2d");r.clearRect(0,0,i,i),r.drawImage(t,0,0,i,i);var n=r.getImageData(0,0,i,i);this.data=n.data,this.width=i,this.height=i,this.srcUrl=t.src}}};var SVGObject=function(e){Object3D.call(this),this.node=e};SVGObject.prototype=Object.create(Object3D.prototype),SVGObject.prototype.constructor=SVGObject;var SVGRenderer=function(){console.log("SVGRenderer",REVISION);var e,t,i,r,n,o,a,s,l,u,h,c,d,p=this,f=new Projector,m=document.createElementNS("http://www.w3.org/2000/svg","svg"),v=new Box2,g=new Box2,y=new Color,_=new Color,b=new Color,x=new Color,w=new Color,S=new Color,M=1,T=new Vector3,A=new Vector3,C=new Vector3,L=new Matrix3,N=new Matrix4,P=new Matrix4,k=[],E=0,D=1,O=null;function R(){for(E=0;m.childNodes.length>0;)m.removeChild(m.childNodes[0])}function F(e,t){var i=Math.floor(255*e.r)+","+Math.floor(255*e.g)+","+Math.floor(255*e.b);return void 0===t||1===t?"rgb("+i+")":"rgb("+i+"); fill-opacity: "+t}function I(e){return null!==O?e.toFixed(O):e}function B(e,t,i){var r=t.scale.x*o,n=t.scale.y*a;i.isPointsMaterial&&(r*=i.size,n*=i.size);var s="M"+I(e.x-.5*r)+","+I(e.y-.5*n)+"h"+I(r)+"v"+I(n)+"h"+I(-r)+"z",l="";(i.isSpriteMaterial||i.isPointsMaterial)&&(l="fill:"+F(i.color,i.opacity)),z(l,s)}function U(e,t,i,r){var n="M"+I(e.positionScreen.x)+","+I(e.positionScreen.y)+"L"+I(t.positionScreen.x)+","+I(t.positionScreen.y);if(r.isLineBasicMaterial){var o="fill:none;stroke:"+F(r.color,r.opacity)+";stroke-width:"+r.linewidth+";stroke-linecap:"+r.linecap;r.isLineDashedMaterial&&(o=o+";stroke-dasharray:"+r.dashSize+","+r.gapSize),z(o,n)}}function V(e,t,r,n,o){p.info.render.vertices+=3,p.info.render.faces++;var a="M"+I(e.positionScreen.x)+","+I(e.positionScreen.y)+"L"+I(t.positionScreen.x)+","+I(t.positionScreen.y)+"L"+I(r.positionScreen.x)+","+I(r.positionScreen.y)+"z";o.isMeshBasicMaterial?(y.copy(o.color),o.vertexColors!==FaceColors&&o.vertexColors!==VertexColors||y.multiply(n.color)):o.isMeshLambertMaterial||o.isMeshPhongMaterial||o.isMeshStandardMaterial?(_.copy(o.color),o.vertexColors!==FaceColors&&o.vertexColors!==VertexColors||_.multiply(n.color),y.copy(b),A.copy(e.positionWorld).add(t.positionWorld).add(r.positionWorld).divideScalar(3),function(e,t,i,r){for(var n=0,o=e.length;n<o;n++){var a=e[n],s=a.color;if(a.isDirectionalLight){var l=T.setFromMatrixPosition(a.matrixWorld).normalize();if((u=i.dot(l))<=0)continue;u*=a.intensity,r.r+=s.r*u,r.g+=s.g*u,r.b+=s.b*u}else if(a.isPointLight){var u;if(l=T.setFromMatrixPosition(a.matrixWorld),(u=i.dot(T.subVectors(l,t).normalize()))<=0)continue;if(0==(u*=0==a.distance?1:1-Math.min(t.distanceTo(l)/a.distance,1)))continue;u*=a.intensity,r.r+=s.r*u,r.g+=s.g*u,r.b+=s.b*u}}}(i,A,n.normalModel,y),y.multiply(_).add(o.emissive)):o.isMeshNormalMaterial&&(C.copy(n.normalModel).applyMatrix3(L),y.setRGB(C.x,C.y,C.z).multiplyScalar(.5).addScalar(.5)),z(o.wireframe?"fill:none;stroke:"+F(y,o.opacity)+";stroke-width:"+o.wireframeLinewidth+";stroke-linecap:"+o.wireframeLinecap+";stroke-linejoin:"+o.wireframeLinejoin:"fill:"+F(y,o.opacity),a)}function z(e,t){d===e?c+=t:(G(),d=e,c=t)}function G(){c&&((h=function(e){if(null==k[e])return k[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==D&&k[e].setAttribute("shape-rendering","crispEdges"),k[e];return k[e]}(E++)).setAttribute("d",c),h.setAttribute("style",d),m.appendChild(h)),c="",d=""}this.domElement=m,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":D=1;break;case"low":D=0}},this.setClearColor=function(e,t){S.set(e),M=void 0!==t?t:1},this.setPixelRatio=function(){},this.setSize=function(e,t){o=(r=e)/2,a=(n=t)/2,m.setAttribute("viewBox",-o+" "+-a+" "+r+" "+n),m.setAttribute("width",r),m.setAttribute("height",n),v.min.set(-o,-a),v.max.set(o,a)},this.setPrecision=function(e){O=e},this.clear=function(){R(),m.style.backgroundColor=F(S,M)},this.render=function(r,n){if(n instanceof Camera!=!1){var h=r.background;h&&h.isColor?(R(),m.style.backgroundColor=F(h)):!0===this.autoClear&&this.clear(),p.info.render.vertices=0,p.info.render.faces=0,N.copy(n.matrixWorldInverse),P.multiplyMatrices(n.projectionMatrix,N),e=f.projectScene(r,n,this.sortObjects,this.sortElements),t=e.elements,i=e.lights,L.getNormalMatrix(n.matrixWorldInverse),function(e){b.setRGB(0,0,0),x.setRGB(0,0,0),w.setRGB(0,0,0);for(var t=0,i=e.length;t<i;t++){var r=e[t],n=r.color;r.isAmbientLight?(b.r+=n.r,b.g+=n.g,b.b+=n.b):r.isDirectionalLight?(x.r+=n.r,x.g+=n.g,x.b+=n.b):r.isPointLight&&(w.r+=n.r,w.g+=n.g,w.b+=n.b)}}(i),c="",d="";for(var y=0,_=t.length;y<_;y++){var S=t[y],M=S.material;if(void 0!==M&&0!==M.opacity)if(g.makeEmpty(),S instanceof RenderableSprite)(s=S).x*=o,s.y*=-a,B(s,S,M);else if(S instanceof RenderableLine)s=S.v1,l=S.v2,s.positionScreen.x*=o,s.positionScreen.y*=-a,l.positionScreen.x*=o,l.positionScreen.y*=-a,g.setFromPoints([s.positionScreen,l.positionScreen]),!0===v.intersectsBox(g)&&U(s,l,S,M);else if(S instanceof RenderableFace){if(s=S.v1,l=S.v2,u=S.v3,s.positionScreen.z<-1||s.positionScreen.z>1)continue;if(l.positionScreen.z<-1||l.positionScreen.z>1)continue;if(u.positionScreen.z<-1||u.positionScreen.z>1)continue;s.positionScreen.x*=o,s.positionScreen.y*=-a,l.positionScreen.x*=o,l.positionScreen.y*=-a,u.positionScreen.x*=o,u.positionScreen.y*=-a,g.setFromPoints([s.positionScreen,l.positionScreen,u.positionScreen]),!0===v.intersectsBox(g)&&V(s,l,u,S,M)}}G(),r.traverseVisible(function(e){if(e instanceof SVGObject){if(T.setFromMatrixPosition(e.matrixWorld),T.applyMatrix4(P),T.z<-1||T.z>1)return;var t=T.x*o,i=-T.y*a,r=e.node;r.setAttribute("transform","translate("+t+","+i+")"),m.appendChild(r)}})}else console.error("SVGRenderer.render: camera is not an instance of Camera.")}};function WebGLAnimation(){var e=null,t=!1,i=null;function r(n,o){!1!==t&&(i(n,o),e.requestAnimationFrame(r))}return{start:function(){!0!==t&&null!==i&&(e.requestAnimationFrame(r),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function WebGLAttributes(e){var t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(i){i.isInterleavedBufferAttribute&&(i=i.data);var r=t.get(i);r&&(e.deleteBuffer(r.buffer),t.delete(i))},update:function(i,r){i.isInterleavedBufferAttribute&&(i=i.data);var n=t.get(i);void 0===n?t.set(i,function(t,i){var r=t.array,n=t.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW,o=e.createBuffer();e.bindBuffer(i,o),e.bufferData(i,r,n),t.onUploadCallback();var a=e.FLOAT;return r instanceof Float32Array?a=e.FLOAT:r instanceof Float64Array?console.warn("WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?a=e.UNSIGNED_SHORT:r instanceof Int16Array?a=e.SHORT:r instanceof Uint32Array?a=e.UNSIGNED_INT:r instanceof Int32Array?a=e.INT:r instanceof Int8Array?a=e.BYTE:r instanceof Uint8Array&&(a=e.UNSIGNED_BYTE),{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(i,r)):n.version<i.version&&(function(t,i,r){var n=i.array,o=i.updateRange;e.bindBuffer(r,t),!1===i.dynamic?e.bufferData(r,n,e.STATIC_DRAW):-1===o.count?e.bufferSubData(r,0,n):0===o.count?console.error("WebGLObjects.updateBuffer: dynamic BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(r,o.offset*n.BYTES_PER_ELEMENT,n.subarray(o.offset,o.offset+o.count)),o.count=-1)}(n.buffer,i,r),n.version=i.version)}}}function WebGLBackground(e,t,i,r){var n,o,a=new Color(0),s=0,l=null,u=0;function h(e,i){t.buffers.color.setClear(e.r,e.g,e.b,i,r)}return{getClearColor:function(){return a},setClearColor:function(e,t){a.set(e),h(a,s=void 0!==t?t:1)},getClearAlpha:function(){return s},setClearAlpha:function(e){h(a,s=e)},render:function(t,r,c,d){var p=r.background;if(null===p?(h(a,s),l=null,u=0):p&&p.isColor&&(h(p,1),d=!0,l=null,u=0),(e.autoClear||d)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),p&&(p.isCubeTexture||p.isWebGLRenderTargetCube)){void 0===o&&((o=new Mesh(new BoxBufferGeometry(1,1,1),new ShaderMaterial({type:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.cube.uniforms),vertexShader:ShaderLib.cube.vertexShader,fragmentShader:ShaderLib.cube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),o.geometry.removeAttribute("uv"),o.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.tCube.value}}),i.update(o));var f=p.isWebGLRenderTargetCube?p.texture:p;o.material.uniforms.tCube.value=f,o.material.uniforms.tFlip.value=p.isWebGLRenderTargetCube?1:-1,l===p&&u===f.version||(o.material.needsUpdate=!0,l=p,u=f.version),t.unshift(o,o.geometry,o.material,0,0,null)}else p&&p.isTexture&&(void 0===n&&((n=new Mesh(new PlaneBufferGeometry(2,2),new ShaderMaterial({type:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),Object.defineProperty(n.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(n)),n.material.uniforms.t2D.value=p,!0===p.matrixAutoUpdate&&p.updateMatrix(),n.material.uniforms.uvTransform.value.copy(p.matrix),l===p&&u===p.version||(n.material.needsUpdate=!0,l=p,u=p.version),t.unshift(n,n.geometry,n.material,0,0,null))}}}function WebGLBufferRenderer(e,t,i,r){var n;this.setMode=function(e){n=e},this.render=function(t,r){e.drawArrays(n,t,r),i.update(r,n)},this.renderInstances=function(o,a,s){var l;if(r.isWebGL2)l=e;else if(null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("WebGLBufferRenderer: using InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[r.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](n,a,s,o.maxInstancedCount),i.update(s,n,o.maxInstancedCount)}}function WebGLCapabilities(e,t,i){var r;function n(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,a=void 0!==i.precision?i.precision:"highp",s=n(a);s!==a&&(console.warn("WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var l=!0===i.logarithmicDepthBuffer,u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),c=e.getParameter(e.MAX_TEXTURE_SIZE),d=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),p=e.getParameter(e.MAX_VERTEX_ATTRIBS),f=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),m=e.getParameter(e.MAX_VARYING_VECTORS),v=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),g=h>0,y=o||!!t.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==r)return r;var i=t.get("EXT_texture_filter_anisotropic");return r=null!==i?e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:n,precision:a,logarithmicDepthBuffer:l,maxTextures:u,maxVertexTextures:h,maxTextureSize:c,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:v,vertexTextures:g,floatFragmentTextures:y,floatVertexTextures:g&&y,maxSamples:o?e.getParameter(e.MAX_SAMPLES):0}}function WebGLClipping(){var e=this,t=null,i=0,r=!1,n=!1,o=new Plane,a=new Matrix3,s={value:null,needsUpdate:!1};function l(){s.value!==t&&(s.value=t,s.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function u(t,i,r,n){var l=null!==t?t.length:0,u=null;if(0!==l){if(u=s.value,!0!==n||null===u){var h=r+4*l,c=i.matrixWorldInverse;a.getNormalMatrix(c),(null===u||u.length<h)&&(u=new Float32Array(h));for(var d=0,p=r;d!==l;++d,p+=4)o.copy(t[d]).applyMatrix4(c,a),o.normal.toArray(u,p),u[p+3]=o.constant}s.value=u,s.needsUpdate=!0}return e.numPlanes=l,u}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,n,o){var a=0!==e.length||n||0!==i||r;return r=n,t=u(e,o,0),i=e.length,a},this.beginShadows=function(){n=!0,u(null)},this.endShadows=function(){n=!1,l()},this.setState=function(e,o,a,h,c,d){if(!r||null===e||0===e.length||n&&!a)n?u(null):l();else{var p=n?0:i,f=4*p,m=c.clippingState||null;s.value=m,m=u(e,h,f,d);for(var v=0;v!==f;++v)m[v]=t[v];c.clippingState=m,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=p}}}function WebGLExtensions(e){var t={};return{get:function(i){if(void 0!==t[i])return t[i];var r;switch(i){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(i)}return null===r&&console.warn("WebGLRenderer: "+i+" extension not supported."),t[i]=r,r}}}function WebGLGeometries(e,t,i){var r={},n={};function o(e){var a=e.target,s=r[a.id];for(var l in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[l]);a.removeEventListener("dispose",o),delete r[a.id];var u=n[s.id];u&&(t.remove(u),delete n[s.id]),i.memory.geometries--}return{get:function(e,t){var n=r[t.id];return n||(t.addEventListener("dispose",o),t.isBufferGeometry?n=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new BufferGeometry).setFromObject(e)),n=t._bufferGeometry),r[t.id]=n,i.memory.geometries++,n)},update:function(i){var r=i.index,n=i.attributes;for(var o in null!==r&&t.update(r,e.ELEMENT_ARRAY_BUFFER),n)t.update(n[o],e.ARRAY_BUFFER);var a=i.morphAttributes;for(var o in a)for(var s=a[o],l=0,u=s.length;l<u;l++)t.update(s[l],e.ARRAY_BUFFER)},getWireframeAttribute:function(i){var r=n[i.id];if(r)return r;var o,a=[],s=i.index,l=i.attributes;if(null!==s)for(var u=0,h=(o=s.array).length;u<h;u+=3){var c=o[u+0],d=o[u+1],p=o[u+2];a.push(c,d,d,p,p,c)}else for(u=0,h=(o=l.position.array).length/3-1;u<h;u+=3)c=u+0,d=u+1,p=u+2,a.push(c,d,d,p,p,c);return r=new(arrayMax(a)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(a,1),t.update(r,e.ELEMENT_ARRAY_BUFFER),n[i.id]=r,r}}}function WebGLIndexedBufferRenderer(e,t,i,r){var n,o,a;this.setMode=function(e){n=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,r){e.drawElements(n,r,o,t*a),i.update(r,n)},this.renderInstances=function(s,l,u){var h;if(r.isWebGL2)h=e;else if(null===(h=t.get("ANGLE_instanced_arrays")))return void console.error("WebGLIndexedBufferRenderer: using InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[r.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](n,u,o,l*a,s.maxInstancedCount),i.update(u,n,s.maxInstancedCount)}}function WebGLInfo(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(i,r,n){switch(n=n||1,t.calls++,r){case e.TRIANGLES:t.triangles+=n*(i/3);break;case e.TRIANGLE_STRIP:case e.TRIANGLE_FAN:t.triangles+=n*(i-2);break;case e.LINES:t.lines+=n*(i/2);break;case e.LINE_STRIP:t.lines+=n*(i-1);break;case e.LINE_LOOP:t.lines+=n*i;break;case e.POINTS:t.points+=n*i;break;default:console.error("WebGLInfo: Unknown draw mode:",r)}}}}function absNumericalSort(e,t){return Math.abs(t[1])-Math.abs(e[1])}function WebGLMorphtargets(e){var t={},i=new Float32Array(8);return{update:function(r,n,o,a){var s=r.morphTargetInfluences,l=s.length,u=t[n.id];if(void 0===u){u=[];for(var h=0;h<l;h++)u[h]=[h,0];t[n.id]=u}var c=o.morphTargets&&n.morphAttributes.position,d=o.morphNormals&&n.morphAttributes.normal;for(h=0;h<l;h++)0!==(p=u[h])[1]&&(c&&n.removeAttribute("morphTarget"+h),d&&n.removeAttribute("morphNormal"+h));for(h=0;h<l;h++)(p=u[h])[0]=h,p[1]=s[h];for(u.sort(absNumericalSort),h=0;h<8;h++){var p;if(p=u[h]){var f=p[0],m=p[1];if(m){c&&n.addAttribute("morphTarget"+h,c[f]),d&&n.addAttribute("morphNormal"+h,d[f]),i[h]=m;continue}}i[h]=0}a.getUniforms().setValue(e,"morphTargetInfluences",i)}}}function WebGLObjects(e,t){var i={};return{update:function(r){var n=t.render.frame,o=r.geometry,a=e.get(r,o);return i[a.id]!==n&&(o.isGeometry&&a.updateFromObject(r),e.update(a),i[a.id]=n),a},dispose:function(){i={}}}}function DataTexture3D(e,t,i,r){Texture.call(this,null),this.image={data:e,width:t,height:i,depth:r},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1}DataTexture3D.prototype=Object.create(Texture.prototype),DataTexture3D.prototype.constructor=DataTexture3D,DataTexture3D.prototype.isDataTexture3D=!0;var emptyTexture=new Texture,emptyTexture3d=new DataTexture3D,emptyCubeTexture=new CubeTexture;function UniformContainer(){this.seq=[],this.map={}}var arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(e,t,i){var r=e[0];if(r<=0||r>0)return e;var n=t*i,o=arrayCacheF32[n];if(void 0===o&&(o=new Float32Array(n),arrayCacheF32[n]=o),0!==t){r.toArray(o,0);for(var a=1,s=0;a!==t;++a)s+=i,e[a].toArray(o,s)}return o}function arraysEqual(e,t){if(e.length!==t.length)return!1;for(var i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function copyArray(e,t){for(var i=0,r=t.length;i<r;i++)e[i]=t[i]}function allocTexUnits(e,t){var i=arrayCacheI32[t];void 0===i&&(i=new Int32Array(t),arrayCacheI32[t]=i);for(var r=0;r!==t;++r)i[r]=e.allocTextureUnit();return i}function setValue1f(e,t){var i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function setValue1i(e,t){var i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function setValue2fv(e,t){var i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(arraysEqual(i,t))return;e.uniform2fv(this.addr,t),copyArray(i,t)}}function setValue3fv(e,t){var i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(arraysEqual(i,t))return;e.uniform3fv(this.addr,t),copyArray(i,t)}}function setValue4fv(e,t){var i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(arraysEqual(i,t))return;e.uniform4fv(this.addr,t),copyArray(i,t)}}function setValue2fm(e,t){var i=this.cache,r=t.elements;if(void 0===r){if(arraysEqual(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),copyArray(i,t)}else{if(arraysEqual(i,r))return;mat2array.set(r),e.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(i,r)}}function setValue3fm(e,t){var i=this.cache,r=t.elements;if(void 0===r){if(arraysEqual(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),copyArray(i,t)}else{if(arraysEqual(i,r))return;mat3array.set(r),e.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(i,r)}}function setValue4fm(e,t){var i=this.cache,r=t.elements;if(void 0===r){if(arraysEqual(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),copyArray(i,t)}else{if(arraysEqual(i,r))return;mat4array.set(r),e.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(i,r)}}function setValueT1(e,t,i){var r=this.cache,n=i.allocTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(t||emptyTexture,n)}function setValueT3D1(e,t,i){var r=this.cache,n=i.allocTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||emptyTexture3d,n)}function setValueT6(e,t,i){var r=this.cache,n=i.allocTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(t||emptyCubeTexture,n)}function setValue2iv(e,t){var i=this.cache;arraysEqual(i,t)||(e.uniform2iv(this.addr,t),copyArray(i,t))}function setValue3iv(e,t){var i=this.cache;arraysEqual(i,t)||(e.uniform3iv(this.addr,t),copyArray(i,t))}function setValue4iv(e,t){var i=this.cache;arraysEqual(i,t)||(e.uniform4iv(this.addr,t),copyArray(i,t))}function getSingularSetter(e){switch(e){case 5126:return setValue1f;case 35664:return setValue2fv;case 35665:return setValue3fv;case 35666:return setValue4fv;case 35674:return setValue2fm;case 35675:return setValue3fm;case 35676:return setValue4fm;case 35678:case 36198:return setValueT1;case 35679:return setValueT3D1;case 35680:return setValueT6;case 5124:case 35670:return setValue1i;case 35667:case 35671:return setValue2iv;case 35668:case 35672:return setValue3iv;case 35669:case 35673:return setValue4iv}}function setValue1fv(e,t){var i=this.cache;arraysEqual(i,t)||(e.uniform1fv(this.addr,t),copyArray(i,t))}function setValue1iv(e,t){var i=this.cache;arraysEqual(i,t)||(e.uniform1iv(this.addr,t),copyArray(i,t))}function setValueV2a(e,t){var i=this.cache,r=flatten(t,this.size,2);arraysEqual(i,r)||(e.uniform2fv(this.addr,r),this.updateCache(r))}function setValueV3a(e,t){var i=this.cache,r=flatten(t,this.size,3);arraysEqual(i,r)||(e.uniform3fv(this.addr,r),this.updateCache(r))}function setValueV4a(e,t){var i=this.cache,r=flatten(t,this.size,4);arraysEqual(i,r)||(e.uniform4fv(this.addr,r),this.updateCache(r))}function setValueM2a(e,t){var i=this.cache,r=flatten(t,this.size,4);arraysEqual(i,r)||(e.uniformMatrix2fv(this.addr,!1,r),this.updateCache(r))}function setValueM3a(e,t){var i=this.cache,r=flatten(t,this.size,9);arraysEqual(i,r)||(e.uniformMatrix3fv(this.addr,!1,r),this.updateCache(r))}function setValueM4a(e,t){var i=this.cache,r=flatten(t,this.size,16);arraysEqual(i,r)||(e.uniformMatrix4fv(this.addr,!1,r),this.updateCache(r))}function setValueT1a(e,t,i){var r=this.cache,n=t.length,o=allocTexUnits(i,n);!1===arraysEqual(r,o)&&(e.uniform1iv(this.addr,o),copyArray(r,o));for(var a=0;a!==n;++a)i.setTexture2D(t[a]||emptyTexture,o[a])}function setValueT6a(e,t,i){var r=this.cache,n=t.length,o=allocTexUnits(i,n);!1===arraysEqual(r,o)&&(e.uniform1iv(this.addr,o),copyArray(r,o));for(var a=0;a!==n;++a)i.setTextureCube(t[a]||emptyCubeTexture,o[a])}function getPureArraySetter(e){switch(e){case 5126:return setValue1fv;case 35664:return setValueV2a;case 35665:return setValueV3a;case 35666:return setValueV4a;case 35674:return setValueM2a;case 35675:return setValueM3a;case 35676:return setValueM4a;case 35678:return setValueT1a;case 35680:return setValueT6a;case 5124:case 35670:return setValue1iv;case 35667:case 35671:return setValue2iv;case 35668:case 35672:return setValue3iv;case 35669:case 35673:return setValue4iv}}function SingleUniform(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=getSingularSetter(t.type)}function PureArrayUniform(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=getPureArraySetter(t.type)}function StructuredUniform(e){this.id=e,UniformContainer.call(this)}PureArrayUniform.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),copyArray(t,e)},StructuredUniform.prototype.setValue=function(e,t,i){for(var r=this.seq,n=0,o=r.length;n!==o;++n){var a=r[n];a.setValue(e,t[a.id],i)}};var RePathPart=/([\w\d_]+)(\])?(\[|\.)?/g;function addUniform(e,t){e.seq.push(t),e.map[t.id]=t}function parseUniform(e,t,i){var r=e.name,n=r.length;for(RePathPart.lastIndex=0;;){var o=RePathPart.exec(r),a=RePathPart.lastIndex,s=o[1],l="]"===o[2],u=o[3];if(l&&(s|=0),void 0===u||"["===u&&a+2===n){addUniform(i,void 0===u?new SingleUniform(s,e,t):new PureArrayUniform(s,e,t));break}var h=i.map[s];void 0===h&&addUniform(i,h=new StructuredUniform(s)),i=h}}function WebGLUniforms(e,t,i){UniformContainer.call(this),this.renderer=i;for(var r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),n=0;n<r;++n){var o=e.getActiveUniform(t,n);parseUniform(o,e.getUniformLocation(t,o.name),this)}}function addLineNumbers(e){for(var t=e.split("\n"),i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join("\n")}function WebGLShader(e,t,i){var r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),!1===e.getShaderParameter(r,e.COMPILE_STATUS)&&console.error("WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(r)&&console.warn("WebGLShader: gl.getShaderInfoLog()",t===e.VERTEX_SHADER?"vertex":"fragment",e.getShaderInfoLog(r),addLineNumbers(i)),r}WebGLUniforms.prototype.setValue=function(e,t,i){var r=this.map[t];void 0!==r&&r.setValue(e,i,this.renderer)},WebGLUniforms.prototype.setOptional=function(e,t,i){var r=t[i];void 0!==r&&this.setValue(e,i,r)},WebGLUniforms.upload=function(e,t,i,r){for(var n=0,o=t.length;n!==o;++n){var a=t[n],s=i[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,r)}},WebGLUniforms.seqWithValue=function(e,t){for(var i=[],r=0,n=e.length;r!==n;++r){var o=e[r];o.id in t&&i.push(o)}return i};var programIdCount=0;function getEncodingComponents(e){switch(e){case LinearEncoding:return["Linear","( value )"];case sRGBEncoding:return["sRGB","( value )"];case RGBEEncoding:return["RGBE","( value )"];case RGBM7Encoding:return["RGBM","( value, 7.0 )"];case RGBM16Encoding:return["RGBM","( value, 16.0 )"];case RGBDEncoding:return["RGBD","( value, 256.0 )"];case GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function getTexelDecodingFunction(e,t){var i=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function getTexelEncodingFunction(e,t){var i=getEncodingComponents(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function getToneMappingFunction(e,t){var i;switch(t){case LinearToneMapping:i="Linear";break;case ReinhardToneMapping:i="Reinhard";break;case Uncharted2ToneMapping:i="Uncharted2";break;case CineonToneMapping:i="OptimizedCineon";break;case ACESFilmicToneMapping:i="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function generateExtensions(e,t,i){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap&&!t.objectSpaceNormalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&i.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&i.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&i.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join("\n")}function generateDefines(e){var t=[];for(var i in e){var r=e[i];!1!==r&&t.push("#define "+i+" "+r)}return t.join("\n")}function fetchAttributeLocations(e,t){for(var i={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),n=0;n<r;n++){var o=e.getActiveAttrib(t,n).name;i[o]=e.getAttribLocation(t,o)}return i}function filterEmptyLine(e){return""!==e}function replaceLightNums(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function replaceClippingPlaneNums(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function parseIncludes(e){return e.replace(/^[ \t]*#include +<([\w\d.\/]+)>/gm,function(e,t){var i=ShaderChunk[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return parseIncludes(i)})}function unrollLoops(e){return e.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(e,t,i,r){for(var n="",o=parseInt(t);o<parseInt(i);o++)n+=r.replace(/\[ i \]/g,"[ "+o+" ]");return n})}function WebGLProgram(e,t,i,r,n,o,a){var s=e.context,l=r.defines,u=n.vertexShader,h=n.fragmentShader,c="SHADOWMAP_TYPE_BASIC";o.shadowMapType===PCFShadowMap?c="SHADOWMAP_TYPE_PCF":o.shadowMapType===PCFSoftShadowMap&&(c="SHADOWMAP_TYPE_PCF_SOFT");var d="ENVMAP_TYPE_CUBE",p="ENVMAP_MODE_REFLECTION",f="ENVMAP_BLENDING_MULTIPLY";if(o.envMap){switch(r.envMap.mapping){case CubeReflectionMapping:case CubeRefractionMapping:d="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:case CubeUVRefractionMapping:d="ENVMAP_TYPE_CUBE_UV";break;case EquirectangularReflectionMapping:case EquirectangularRefractionMapping:d="ENVMAP_TYPE_EQUIREC";break;case SphericalReflectionMapping:d="ENVMAP_TYPE_SPHERE"}switch(r.envMap.mapping){case CubeRefractionMapping:case EquirectangularRefractionMapping:p="ENVMAP_MODE_REFRACTION"}switch(r.combine){case MultiplyOperation:f="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:f="ENVMAP_BLENDING_MIX";break;case AddOperation:f="ENVMAP_BLENDING_ADD"}}var m,v,g=e.gammaFactor>0?e.gammaFactor:1,y=a.isWebGL2?"":generateExtensions(r.extensions,o,t),_=generateDefines(l),b=s.createProgram();if(r.isRawShaderMaterial?((m=[_].filter(filterEmptyLine).join("\n")).length>0&&(m+="\n"),(v=[y,_].filter(filterEmptyLine).join("\n")).length>0&&(v+="\n")):(m=["precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+n.name,_,o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+g,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+p:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexTangents?"#define USE_TANGENT":"",o.vertexColors?"#define USE_COLOR":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&!1===o.flatShading?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+c:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(a.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n"),v=[y,"precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+n.name,_,o.alphaTest?"#define ALPHATEST "+o.alphaTest+(o.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+g,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.matcap?"#define USE_MATCAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+d:"",o.envMap?"#define "+p:"",o.envMap?"#define "+f:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexTangents?"#define USE_TANGENT":"",o.vertexColors?"#define USE_COLOR":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+c:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(a.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",o.envMap&&(a.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",o.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",o.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",o.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",o.outputEncoding||o.mapEncoding||o.matcapEncoding||o.envMapEncoding||o.emissiveMapEncoding?ShaderChunk.encodings_pars_fragment:"",o.mapEncoding?getTexelDecodingFunction("mapTexelToLinear",o.mapEncoding):"",o.matcapEncoding?getTexelDecodingFunction("matcapTexelToLinear",o.matcapEncoding):"",o.envMapEncoding?getTexelDecodingFunction("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMapEncoding?getTexelDecodingFunction("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.outputEncoding?getTexelEncodingFunction("linearToOutputTexel",o.outputEncoding):"",o.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")),u=replaceClippingPlaneNums(u=replaceLightNums(u=parseIncludes(u),o),o),h=replaceClippingPlaneNums(h=replaceLightNums(h=parseIncludes(h),o),o),u=unrollLoops(u),h=unrollLoops(h),a.isWebGL2&&!r.isRawShaderMaterial){var x=!1,w=/^\s*#version\s+300\s+es\s*\n/;r.isShaderMaterial&&null!==u.match(w)&&null!==h.match(w)&&(x=!0,u=u.replace(w,""),h=h.replace(w,"")),m=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+m,v=["#version 300 es\n","#define varying in",x?"":"out highp vec4 pc_fragColor;",x?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v}var S=m+u,M=v+h,T=WebGLShader(s,s.VERTEX_SHADER,S),A=WebGLShader(s,s.FRAGMENT_SHADER,M);s.attachShader(b,T),s.attachShader(b,A),void 0!==r.index0AttributeName?s.bindAttribLocation(b,0,r.index0AttributeName):!0===o.morphTargets&&s.bindAttribLocation(b,0,"position"),s.linkProgram(b);var C,L,N=s.getProgramInfoLog(b).trim(),P=s.getShaderInfoLog(T).trim(),k=s.getShaderInfoLog(A).trim(),E=!0,D=!0;return!1===s.getProgramParameter(b,s.LINK_STATUS)?(E=!1,console.error("WebGLProgram: shader error: ",s.getError(),"gl.VALIDATE_STATUS",s.getProgramParameter(b,s.VALIDATE_STATUS),"gl.getProgramInfoLog",N,P,k)):""!==N?console.warn("WebGLProgram: gl.getProgramInfoLog()",N):""!==P&&""!==k||(D=!1),D&&(this.diagnostics={runnable:E,material:r,programLog:N,vertexShader:{log:P,prefix:m},fragmentShader:{log:k,prefix:v}}),s.deleteShader(T),s.deleteShader(A),this.getUniforms=function(){return void 0===C&&(C=new WebGLUniforms(s,b,e)),C},this.getAttributes=function(){return void 0===L&&(L=fetchAttributeLocations(s,b)),L},this.destroy=function(){s.deleteProgram(b),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.name=n.name,this.id=programIdCount++,this.code=i,this.usedTimes=1,this.program=b,this.vertexShader=T,this.fragmentShader=A,this}function WebGLPrograms(e,t,i){var r=[],n={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},o=["precision","supportsVertexTextures","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function a(e,t){var i;return e?e.isTexture?i=e.encoding:e.isWebGLRenderTarget&&(console.warn("WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=e.texture.encoding):i=LinearEncoding,i===LinearEncoding&&t&&(i=GammaEncoding),i}this.getParameters=function(t,r,o,s,l,u,h){var c=n[t.type],d=h.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(i.floatVertexTextures)return 1024;var r=i.maxVertexUniforms,n=Math.floor((r-20)/4),o=Math.min(n,t.length);return o<t.length?(console.warn("WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+o+"."),0):o}(h):0,p=i.precision;null!==t.precision&&(p=i.getMaxPrecision(t.precision))!==t.precision&&console.warn("WebGLProgram.getParameters:",t.precision,"not supported, using",p,"instead.");var f=e.getRenderTarget();return{shaderID:c,precision:p,supportsVertexTextures:i.vertexTextures,outputEncoding:a(f?f.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:a(t.map,e.gammaInput),matcap:!!t.matcap,matcapEncoding:a(t.matcap,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:a(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===CubeUVReflectionMapping||t.envMap.mapping===CubeUVRefractionMapping),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:a(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:t.normalMapType===ObjectSpaceNormalMap,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexTangents:t.normalMap&&t.vertexTangents,vertexColors:t.vertexColors,fog:!!s,useFog:t.fog,fogExp:s&&s.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:i.logarithmicDepthBuffer,skinning:t.skinning&&d>0,maxBones:d,useVertexTexture:i.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:r.directional.length,numPointLights:r.point.length,numSpotLights:r.spot.length,numRectAreaLights:r.rectArea.length,numHemiLights:r.hemi.length,numClippingPlanes:l,numClipIntersection:u,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&h.receiveShadow&&o.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===DoubleSide,flipSided:t.side===BackSide,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCode=function(t,i){var r=[];if(i.shaderID?r.push(i.shaderID):(r.push(t.fragmentShader),r.push(t.vertexShader)),void 0!==t.defines)for(var n in t.defines)r.push(n),r.push(t.defines[n]);for(var a=0;a<o.length;a++)r.push(i[o[a]]);return r.push(t.onBeforeCompile.toString()),r.push(e.gammaOutput),r.push(e.gammaFactor),r.join()},this.acquireProgram=function(n,o,a,s){for(var l,u=0,h=r.length;u<h;u++){var c=r[u];if(c.code===s){++(l=c).usedTimes;break}}return void 0===l&&(l=new WebGLProgram(e,t,s,n,o,a,i),r.push(l)),l},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),e.destroy()}},this.programs=r}function WebGLProperties(){var e=new WeakMap;return{get:function(t){var i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,r){e.get(t)[i]=r},dispose:function(){e=new WeakMap}}}function painterSortStable(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function reversePainterSortStable(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function WebGLRenderList(){var e=[],t=0,i=[],r=[];function n(i,r,n,o,a,s){var l=e[t];return void 0===l?(l={id:i.id,object:i,geometry:r,material:n,program:n.program,groupOrder:o,renderOrder:i.renderOrder,z:a,group:s},e[t]=l):(l.id=i.id,l.object=i,l.geometry=r,l.material=n,l.program=n.program,l.groupOrder=o,l.renderOrder=i.renderOrder,l.z=a,l.group=s),t++,l}return{opaque:i,transparent:r,init:function(){t=0,i.length=0,r.length=0},push:function(e,t,o,a,s,l){var u=n(e,t,o,a,s,l);(!0===o.transparent?r:i).push(u)},unshift:function(e,t,o,a,s,l){var u=n(e,t,o,a,s,l);(!0===o.transparent?r:i).unshift(u)},sort:function(){i.length>1&&i.sort(painterSortStable),r.length>1&&r.sort(reversePainterSortStable)}}}function WebGLRenderLists(){var e={};function t(i){var r=i.target;r.removeEventListener("dispose",t),delete e[r.id]}return{get:function(i,r){var n,o=e[i.id];return void 0===o?(n=new WebGLRenderList,e[i.id]={},e[i.id][r.id]=n,i.addEventListener("dispose",t)):void 0===(n=o[r.id])&&(n=new WebGLRenderList,o[r.id]=n),n},dispose:function(){e={}}}}function UniformsCache(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var i;switch(t.type){case"DirectionalLight":i={direction:new Vector3,color:new Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":i={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":i={position:new Vector3,color:new Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":i={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":i={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return e[t.id]=i,i}}}var count=0;function WebGLLights(){var e=new UniformsCache,t={id:count++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},i=new Vector3,r=new Matrix4,n=new Matrix4;return{setup:function(o,a,s){for(var l=0,u=0,h=0,c=0,d=0,p=0,f=0,m=0,v=s.matrixWorldInverse,g=0,y=o.length;g<y;g++){var _=o[g],b=_.color,x=_.intensity,w=_.distance,S=_.shadow&&_.shadow.map?_.shadow.map.texture:null;if(_.isAmbientLight)l+=b.r*x,u+=b.g*x,h+=b.b*x;else if(_.isDirectionalLight){if((T=e.get(_)).color.copy(_.color).multiplyScalar(_.intensity),T.direction.setFromMatrixPosition(_.matrixWorld),i.setFromMatrixPosition(_.target.matrixWorld),T.direction.sub(i),T.direction.transformDirection(v),T.shadow=_.castShadow,_.castShadow){var M=_.shadow;T.shadowBias=M.bias,T.shadowRadius=M.radius,T.shadowMapSize=M.mapSize}t.directionalShadowMap[c]=S,t.directionalShadowMatrix[c]=_.shadow.matrix,t.directional[c]=T,c++}else if(_.isSpotLight)(T=e.get(_)).position.setFromMatrixPosition(_.matrixWorld),T.position.applyMatrix4(v),T.color.copy(b).multiplyScalar(x),T.distance=w,T.direction.setFromMatrixPosition(_.matrixWorld),i.setFromMatrixPosition(_.target.matrixWorld),T.direction.sub(i),T.direction.transformDirection(v),T.coneCos=Math.cos(_.angle),T.penumbraCos=Math.cos(_.angle*(1-_.penumbra)),T.decay=_.decay,T.shadow=_.castShadow,_.castShadow&&(M=_.shadow,T.shadowBias=M.bias,T.shadowRadius=M.radius,T.shadowMapSize=M.mapSize),t.spotShadowMap[p]=S,t.spotShadowMatrix[p]=_.shadow.matrix,t.spot[p]=T,p++;else if(_.isRectAreaLight)(T=e.get(_)).color.copy(b).multiplyScalar(x),T.position.setFromMatrixPosition(_.matrixWorld),T.position.applyMatrix4(v),n.identity(),r.copy(_.matrixWorld),r.premultiply(v),n.extractRotation(r),T.halfWidth.set(.5*_.width,0,0),T.halfHeight.set(0,.5*_.height,0),T.halfWidth.applyMatrix4(n),T.halfHeight.applyMatrix4(n),t.rectArea[f]=T,f++;else if(_.isPointLight)(T=e.get(_)).position.setFromMatrixPosition(_.matrixWorld),T.position.applyMatrix4(v),T.color.copy(_.color).multiplyScalar(_.intensity),T.distance=_.distance,T.decay=_.decay,T.shadow=_.castShadow,_.castShadow&&(M=_.shadow,T.shadowBias=M.bias,T.shadowRadius=M.radius,T.shadowMapSize=M.mapSize,T.shadowCameraNear=M.camera.near,T.shadowCameraFar=M.camera.far),t.pointShadowMap[d]=S,t.pointShadowMatrix[d]=_.shadow.matrix,t.point[d]=T,d++;else if(_.isHemisphereLight){var T;(T=e.get(_)).direction.setFromMatrixPosition(_.matrixWorld),T.direction.transformDirection(v),T.direction.normalize(),T.skyColor.copy(_.color).multiplyScalar(x),T.groundColor.copy(_.groundColor).multiplyScalar(x),t.hemi[m]=T,m++}}t.ambient[0]=l,t.ambient[1]=u,t.ambient[2]=h,t.directional.length=c,t.spot.length=p,t.rectArea.length=f,t.point.length=d,t.hemi.length=m,t.hash.stateID=t.id,t.hash.directionalLength=c,t.hash.pointLength=d,t.hash.spotLength=p,t.hash.rectAreaLength=f,t.hash.hemiLength=m,t.hash.shadowsLength=a.length},state:t}}function WebGLRenderState(){var e=new WebGLLights,t=[],i=[];return{init:function(){t.length=0,i.length=0},state:{lightsArray:t,shadowsArray:i,lights:e},setupLights:function(r){e.setup(t,i,r)},pushLight:function(e){t.push(e)},pushShadow:function(e){i.push(e)}}}function WebGLRenderStates(){var e={};function t(i){var r=i.target;r.removeEventListener("dispose",t),delete e[r.id]}return{get:function(i,r){var n;return void 0===e[i.id]?(n=new WebGLRenderState,e[i.id]={},e[i.id][r.id]=n,i.addEventListener("dispose",t)):void 0===e[i.id][r.id]?(n=new WebGLRenderState,e[i.id][r.id]=n):n=e[i.id][r.id],n},dispose:function(){e={}}}}function WebGLShadowMap(e,t,i){for(var r=new Frustum,n=new Matrix4,o=new Vector2,a=new Vector2(i,i),s=new Vector3,l=new Vector3,u=1,h=2,c=1+(u|h),d=new Array(c),p=new Array(c),f={},m={0:BackSide,1:FrontSide,2:DoubleSide},v=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],g=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)],y=[new Vector4,new Vector4,new Vector4,new Vector4,new Vector4,new Vector4],_=0;_!==c;++_){var b=0!=(_&u),x=0!=(_&h),w=new MeshDepthMaterial({depthPacking:RGBADepthPacking,morphTargets:b,skinning:x});d[_]=w;var S=new MeshDistanceMaterial({morphTargets:b,skinning:x});p[_]=S}var M=this;function T(t,i,r,n,o,a){var s=t.geometry,l=null,c=d,v=t.customDepthMaterial;if(r&&(c=p,v=t.customDistanceMaterial),v)l=v;else{var g=!1;i.morphTargets&&(s&&s.isBufferGeometry?g=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:s&&s.isGeometry&&(g=s.morphTargets&&s.morphTargets.length>0)),t.isSkinnedMesh&&!1===i.skinning&&console.warn("WebGLShadowMap: SkinnedMesh with material.skinning set to false:",t);var y=t.isSkinnedMesh&&i.skinning,_=0;g&&(_|=u),y&&(_|=h),l=c[_]}if(e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){var b=l.uuid,x=i.uuid,w=f[b];void 0===w&&(w={},f[b]=w);var S=w[x];void 0===S&&(S=l.clone(),w[x]=S),l=S}return l.visible=i.visible,l.wireframe=i.wireframe,l.side=null!=i.shadowSide?i.shadowSide:m[i.side],l.clipShadows=i.clipShadows,l.clippingPlanes=i.clippingPlanes,l.clipIntersection=i.clipIntersection,l.wireframeLinewidth=i.wireframeLinewidth,l.linewidth=i.linewidth,r&&l.isMeshDistanceMaterial&&(l.referencePosition.copy(n),l.nearDistance=o,l.farDistance=a),l}function A(i,n,o,a){if(!1!==i.visible){if(i.layers.test(n.layers)&&(i.isMesh||i.isLine||i.isPoints)&&i.castShadow&&(!i.frustumCulled||r.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,i.matrixWorld);var s=t.update(i),u=i.material;if(Array.isArray(u))for(var h=s.groups,c=0,d=h.length;c<d;c++){var p=h[c],f=u[p.materialIndex];if(f&&f.visible){var m=T(i,f,a,l,o.near,o.far);e.renderBufferDirect(o,null,s,m,i,p)}}else if(u.visible){m=T(i,u,a,l,o.near,o.far);e.renderBufferDirect(o,null,s,m,i,null)}}for(var v=i.children,g=0,y=v.length;g<y;g++)A(v[g],n,o,a)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap,this.render=function(t,i,u){if(!1!==M.enabled&&(!1!==M.autoUpdate||!1!==M.needsUpdate)&&0!==t.length){var h,c=e.getRenderTarget(),d=e.state;d.setBlending(NoBlending),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(var p=0,f=t.length;p<f;p++){var m=t[p],_=m.shadow,b=m&&m.isPointLight;if(void 0!==_){var x=_.camera;if(o.copy(_.mapSize),o.min(a),b){var w=o.x,S=o.y;y[0].set(2*w,S,w,S),y[1].set(0,S,w,S),y[2].set(3*w,S,w,S),y[3].set(w,S,w,S),y[4].set(3*w,0,w,S),y[5].set(w,0,w,S),o.x*=4,o.y*=2}if(null===_.map){var T={minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat};_.map=new WebGLRenderTarget(o.x,o.y,T),_.map.texture.name=m.name+".shadowMap",x.updateProjectionMatrix()}_.isSpotLightShadow&&_.update(m);var C=_.map,L=_.matrix;l.setFromMatrixPosition(m.matrixWorld),x.position.copy(l),b?(h=6,L.makeTranslation(-l.x,-l.y,-l.z)):(h=1,s.setFromMatrixPosition(m.target.matrixWorld),x.lookAt(s),x.updateMatrixWorld(),L.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),L.multiply(x.projectionMatrix),L.multiply(x.matrixWorldInverse)),e.setRenderTarget(C),e.clear();for(var N=0;N<h;N++){if(b){s.copy(x.position),s.add(v[N]),x.up.copy(g[N]),x.lookAt(s),x.updateMatrixWorld();var P=y[N];d.viewport(P)}n.multiplyMatrices(x.projectionMatrix,x.matrixWorldInverse),r.setFromMatrix(n),A(i,u,x,b)}}else console.warn("WebGLShadowMap:",m,"has no shadow.")}M.needsUpdate=!1,e.setRenderTarget(c)}}}function WebGLState(e,t,i,r){var n=new function(){var t=!1,i=new Vector4,r=null,n=new Vector4(0,0,0,0);return{setMask:function(i){r===i||t||(e.colorMask(i,i,i,i),r=i)},setLocked:function(e){t=e},setClear:function(t,r,o,a,s){!0===s&&(t*=a,r*=a,o*=a),i.set(t,r,o,a),!1===n.equals(i)&&(e.clearColor(t,r,o,a),n.copy(i))},reset:function(){t=!1,r=null,n.set(-1,0,0,0)}}},o=new function(){var t=!1,i=null,r=null,n=null;return{setTest:function(t){t?U(e.DEPTH_TEST):V(e.DEPTH_TEST)},setMask:function(r){i===r||t||(e.depthMask(r),i=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case NeverDepth:e.depthFunc(e.NEVER);break;case AlwaysDepth:e.depthFunc(e.ALWAYS);break;case LessDepth:e.depthFunc(e.LESS);break;case LessEqualDepth:e.depthFunc(e.LEQUAL);break;case EqualDepth:e.depthFunc(e.EQUAL);break;case GreaterEqualDepth:e.depthFunc(e.GEQUAL);break;case GreaterDepth:e.depthFunc(e.GREATER);break;case NotEqualDepth:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);r=t}},setLocked:function(e){t=e},setClear:function(t){n!==t&&(e.clearDepth(t),n=t)},reset:function(){t=!1,i=null,r=null,n=null}}},a=new function(){var t=!1,i=null,r=null,n=null,o=null,a=null,s=null,l=null,u=null;return{setTest:function(t){t?U(e.STENCIL_TEST):V(e.STENCIL_TEST)},setMask:function(r){i===r||t||(e.stencilMask(r),i=r)},setFunc:function(t,i,a){r===t&&n===i&&o===a||(e.stencilFunc(t,i,a),r=t,n=i,o=a)},setOp:function(t,i,r){a===t&&s===i&&l===r||(e.stencilOp(t,i,r),a=t,s=i,l=r)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,i=null,r=null,n=null,o=null,a=null,s=null,l=null,u=null}}},s=e.getParameter(e.MAX_VERTEX_ATTRIBS),l=new Uint8Array(s),u=new Uint8Array(s),h=new Uint8Array(s),c={},d=null,p=null,f=null,m=null,v=null,g=null,y=null,_=null,b=null,x=null,w=!1,S=null,M=null,T=null,A=null,C=null,L=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),N=!1,P=0,k=e.getParameter(e.VERSION);-1!==k.indexOf("WebGL")?(P=parseFloat(/^WebGL\ ([0-9])/.exec(k)[1]),N=P>=1):-1!==k.indexOf("OpenGL ES")&&(P=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(k)[1]),N=P>=2);var E=null,D={},O=new Vector4,R=new Vector4;function F(t,i,r){var n=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var a=0;a<r;a++)e.texImage2D(i+a,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,n);return o}var I={};function B(i,n){(l[i]=1,0===u[i]&&(e.enableVertexAttribArray(i),u[i]=1),h[i]!==n)&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,n),h[i]=n)}function U(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function V(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}function z(t,r,n,o,a,s,l,u){if(t!==NoBlending){if(f||(U(e.BLEND),f=!0),t===CustomBlending)a=a||r,s=s||n,l=l||o,r===v&&a===_||(e.blendEquationSeparate(i.convert(r),i.convert(a)),v=r,_=a),n===g&&o===y&&s===b&&l===x||(e.blendFuncSeparate(i.convert(n),i.convert(o),i.convert(s),i.convert(l)),g=n,y=o,b=s,x=l),m=t,w=null;else if(t!==m||u!==w){if(v===AddEquation&&_===AddEquation||(e.blendEquation(e.FUNC_ADD),v=AddEquation,_=AddEquation),u)switch(t){case NormalBlending:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:e.blendFunc(e.ONE,e.ONE);break;case SubtractiveBlending:e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA);break;case MultiplyBlending:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("WebGLState: Invalid blending: ",t)}else switch(t){case NormalBlending:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case SubtractiveBlending:e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR);break;case MultiplyBlending:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("WebGLState: Invalid blending: ",t)}g=null,y=null,b=null,x=null,m=t,w=u}}else f&&(V(e.BLEND),f=!1)}function G(t){S!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),S=t)}function j(t){t!==CullFaceNone?(U(e.CULL_FACE),t!==M&&(t===CullFaceBack?e.cullFace(e.BACK):t===CullFaceFront?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):V(e.CULL_FACE),M=t}function W(t,i,r){t?(U(e.POLYGON_OFFSET_FILL),A===i&&C===r||(e.polygonOffset(i,r),A=i,C=r)):V(e.POLYGON_OFFSET_FILL)}function H(t){void 0===t&&(t=e.TEXTURE0+L-1),E!==t&&(e.activeTexture(t),E=t)}return I[e.TEXTURE_2D]=F(e.TEXTURE_2D,e.TEXTURE_2D,1),I[e.TEXTURE_CUBE_MAP]=F(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),n.setClear(0,0,0,1),o.setClear(1),a.setClear(0),U(e.DEPTH_TEST),o.setFunc(LessEqualDepth),G(!1),j(CullFaceBack),U(e.CULL_FACE),z(NoBlending),{buffers:{color:n,depth:o,stencil:a},initAttributes:function(){for(var e=0,t=l.length;e<t;e++)l[e]=0},enableAttribute:function(e){B(e,0)},enableAttributeAndDivisor:B,disableUnusedAttributes:function(){for(var t=0,i=u.length;t!==i;++t)u[t]!==l[t]&&(e.disableVertexAttribArray(t),u[t]=0)},enable:U,disable:V,getCompressedTextureFormats:function(){if(null===d&&(d=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")||t.get("WEBGL_compressed_texture_astc")))for(var i=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),r=0;r<i.length;r++)d.push(i[r]);return d},useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:z,setMaterial:function(t,i){t.side===DoubleSide?V(e.CULL_FACE):U(e.CULL_FACE);var r=t.side===BackSide;i&&(r=!r),G(r),t.blending===NormalBlending&&!1===t.transparent?z(NoBlending):z(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),o.setFunc(t.depthFunc),o.setTest(t.depthTest),o.setMask(t.depthWrite),n.setMask(t.colorWrite),W(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:G,setCullFace:j,setLineWidth:function(t){t!==T&&(N&&e.lineWidth(t),T=t)},setPolygonOffset:W,setScissorTest:function(t){t?U(e.SCISSOR_TEST):V(e.SCISSOR_TEST)},activeTexture:H,bindTexture:function(t,i){null===E&&H();var r=D[E];void 0===r&&(r={type:void 0,texture:void 0},D[E]=r),r.type===t&&r.texture===i||(e.bindTexture(t,i||I[t]),r.type=t,r.texture=i)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("WebGLState:",e)}},scissor:function(t){!1===O.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),O.copy(t))},viewport:function(t){!1===R.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),R.copy(t))},reset:function(){for(var t=0;t<u.length;t++)1===u[t]&&(e.disableVertexAttribArray(t),u[t]=0);c={},d=null,E=null,D={},p=null,m=null,S=null,M=null,n.reset(),o.reset(),a.reset()}}}function WebGLTextures(e,t,i,r,n,o,a){var s,l={},u="undefined"!=typeof OffscreenCanvas;function h(e,t){return u?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function c(e,t,i,r){var n=1;if((e.width>r||e.height>r)&&(n=r/Math.max(e.width,e.height)),n<1||!0===t){if(e instanceof ImageBitmap||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement){var o=t?_Math.floorPowerOfTwo:Math.floor,a=o(n*e.width),l=o(n*e.height);void 0===s&&(s=h(a,l));var c=i?h(a,l):s;return c.width=a,c.height=l,c.getContext("2d").drawImage(e,0,0,a,l),console.warn("WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+l+")."),u?c.transferToImageBitmap():c}return"data"in e&&console.warn("WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function d(e){return _Math.isPowerOfTwo(e.width)&&_Math.isPowerOfTwo(e.height)}function p(e,t){return e.generateMipmaps&&t&&e.minFilter!==NearestFilter&&e.minFilter!==LinearFilter}function f(t,i,n,o){e.generateMipmap(t),r.get(i).__maxMipLevel=Math.log(Math.max(n,o))*Math.LOG2E}function m(i,r){if(!n.isWebGL2)return i;var o=i;return i===e.RED&&(r===e.FLOAT&&(o=e.R32F),r===e.HALF_FLOAT&&(o=e.R16F),r===e.UNSIGNED_BYTE&&(o=e.R8)),i===e.RGB&&(r===e.FLOAT&&(o=e.RGB32F),r===e.HALF_FLOAT&&(o=e.RGB16F),r===e.UNSIGNED_BYTE&&(o=e.RGB8)),i===e.RGBA&&(r===e.FLOAT&&(o=e.RGBA32F),r===e.HALF_FLOAT&&(o=e.RGBA16F),r===e.UNSIGNED_BYTE&&(o=e.RGBA8)),o===e.R16F||o===e.R32F||o===e.RGBA16F||o===e.RGBA32F?t.get("EXT_color_buffer_float"):o!==e.RGB16F&&o!==e.RGB32F||console.warn("WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),o}function v(t){return t===NearestFilter||t===NearestMipMapNearestFilter||t===NearestMipMapLinearFilter?e.NEAREST:e.LINEAR}function g(t){var i=t.target;i.removeEventListener("dispose",g),function(t){var i=r.get(t);if(void 0===i.__webglInit)return;e.deleteTexture(i.__webglTexture),r.remove(t)}(i),i.isVideoTexture&&delete l[i.id],a.memory.textures--}function y(t){var i=t.target;i.removeEventListener("dispose",y),function(t){var i=r.get(t),n=r.get(t.texture);if(!t)return;void 0!==n.__webglTexture&&e.deleteTexture(n.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLRenderTargetCube)for(var o=0;o<6;o++)e.deleteFramebuffer(i.__webglFramebuffer[o]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[o]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer);r.remove(t.texture),r.remove(t)}(i),a.memory.textures--}function _(t,n){var o=r.get(t);if(t.isVideoTexture&&function(e){var t=e.id,i=a.render.frame;l[t]!==i&&(l[t]=i,e.update())}(t),t.version>0&&o.__version!==t.version){var s=t.image;if(void 0===s)console.warn("WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==s.complete)return void w(o,t,n);console.warn("WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(e.TEXTURE0+n),i.bindTexture(e.TEXTURE_2D,o.__webglTexture)}function b(i,a,s){var l;if(s?(e.texParameteri(i,e.TEXTURE_WRAP_S,o.convert(a.wrapS)),e.texParameteri(i,e.TEXTURE_WRAP_T,o.convert(a.wrapT)),i===e.TEXTURE_3D&&e.texParameteri(i,e.TEXTURE_WRAP_R,o.convert(a.wrapR)),e.texParameteri(i,e.TEXTURE_MAG_FILTER,o.convert(a.magFilter)),e.texParameteri(i,e.TEXTURE_MIN_FILTER,o.convert(a.minFilter))):(e.texParameteri(i,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(i,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),i===e.TEXTURE_3D&&e.texParameteri(i,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),a.wrapS===ClampToEdgeWrapping&&a.wrapT===ClampToEdgeWrapping||console.warn("WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to ClampToEdgeWrapping."),e.texParameteri(i,e.TEXTURE_MAG_FILTER,v(a.magFilter)),e.texParameteri(i,e.TEXTURE_MIN_FILTER,v(a.minFilter)),a.minFilter!==NearestFilter&&a.minFilter!==LinearFilter&&console.warn("WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to NearestFilter or LinearFilter.")),l=t.get("EXT_texture_filter_anisotropic")){if(a.type===FloatType&&null===t.get("OES_texture_float_linear"))return;if(a.type===HalfFloatType&&null===(n.isWebGL2||t.get("OES_texture_half_float_linear")))return;(a.anisotropy>1||r.get(a).__currentAnisotropy)&&(e.texParameterf(i,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,n.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy)}}function x(t,i){void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",g),t.__webglTexture=e.createTexture(),a.memory.textures++)}function w(t,r,a){var s=r.isDataTexture3D?e.TEXTURE_3D:e.TEXTURE_2D;x(t,r),i.activeTexture(e.TEXTURE0+a),i.bindTexture(s,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment);var l=function(e){return!n.isWebGL2&&(e.wrapS!==ClampToEdgeWrapping||e.wrapT!==ClampToEdgeWrapping||e.minFilter!==NearestFilter&&e.minFilter!==LinearFilter)}(r)&&!1===d(r.image),u=c(r.image,l,!1,n.maxTextureSize),h=d(u)||n.isWebGL2,v=o.convert(r.format),g=o.convert(r.type),y=m(v,g);b(s,r,h);var _,w=r.mipmaps;if(r.isDepthTexture){if(y=e.DEPTH_COMPONENT,r.type===FloatType){if(!n.isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");y=e.DEPTH_COMPONENT32F}else n.isWebGL2&&(y=e.DEPTH_COMPONENT16);r.format===DepthFormat&&y===e.DEPTH_COMPONENT&&r.type!==UnsignedShortType&&r.type!==UnsignedIntType&&(console.warn("WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=UnsignedShortType,g=o.convert(r.type)),r.format===DepthStencilFormat&&(y=e.DEPTH_STENCIL,r.type!==UnsignedInt248Type&&(console.warn("WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=UnsignedInt248Type,g=o.convert(r.type))),i.texImage2D(e.TEXTURE_2D,0,y,u.width,u.height,0,v,g,null)}else if(r.isDataTexture)if(w.length>0&&h){for(var S=0,M=w.length;S<M;S++)_=w[S],i.texImage2D(e.TEXTURE_2D,S,y,_.width,_.height,0,v,g,_.data);r.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else i.texImage2D(e.TEXTURE_2D,0,y,u.width,u.height,0,v,g,u.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(S=0,M=w.length;S<M;S++)_=w[S],r.format!==RGBAFormat&&r.format!==RGBFormat?i.getCompressedTextureFormats().indexOf(v)>-1?i.compressedTexImage2D(e.TEXTURE_2D,S,y,_.width,_.height,0,_.data):console.warn("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(e.TEXTURE_2D,S,y,_.width,_.height,0,v,g,_.data);t.__maxMipLevel=w.length-1}else if(r.isDataTexture3D)i.texImage3D(e.TEXTURE_3D,0,y,u.width,u.height,u.depth,0,v,g,u.data),t.__maxMipLevel=0;else if(w.length>0&&h){for(S=0,M=w.length;S<M;S++)_=w[S],i.texImage2D(e.TEXTURE_2D,S,y,v,g,_);r.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else i.texImage2D(e.TEXTURE_2D,0,y,v,g,u),t.__maxMipLevel=0;p(r,h)&&f(e.TEXTURE_2D,r,u.width,u.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function S(t,n,a,s){var l=o.convert(n.texture.format),u=o.convert(n.texture.type),h=m(l,u);i.texImage2D(s,0,h,n.width,n.height,0,l,u,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,a,s,r.get(n.texture).__webglTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}function M(t,i,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),i.depthBuffer&&!i.stencilBuffer){if(r){var n=A(i);e.renderbufferStorageMultisample(e.RENDERBUFFER,n,e.DEPTH_COMPONENT16,i.width,i.height)}else e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,i.width,i.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(i.depthBuffer&&i.stencilBuffer){if(r){n=A(i);e.renderbufferStorageMultisample(e.RENDERBUFFER,n,e.DEPTH_STENCIL,i.width,i.height)}else e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,i.width,i.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{var a=m(o.convert(i.texture.format),o.convert(i.texture.type));if(r){n=A(i);e.renderbufferStorageMultisample(e.RENDERBUFFER,n,a,i.width,i.height)}else e.renderbufferStorage(e.RENDERBUFFER,a,i.width,i.height)}e.bindRenderbuffer(e.RENDERBUFFER,null)}function T(t){var i=r.get(t),n=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(n)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(e.FRAMEBUFFER,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),_(i.depthTexture,0);var n=r.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===DepthFormat)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,n,0);else{if(i.depthTexture.format!==DepthStencilFormat)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,n,0)}}(i.__webglFramebuffer,t)}else if(n){i.__webglDepthbuffer=[];for(var o=0;o<6;o++)e.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[o]),i.__webglDepthbuffer[o]=e.createRenderbuffer(),M(i.__webglDepthbuffer[o],t)}else e.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),M(i.__webglDepthbuffer,t);e.bindFramebuffer(e.FRAMEBUFFER,null)}function A(e){return n.isWebGL2&&e.isWebGLMultisampleRenderTarget?Math.min(n.maxSamples,e.samples):0}this.setTexture2D=_,this.setTexture3D=function(t,n){var o=r.get(t);t.version>0&&o.__version!==t.version?w(o,t,n):(i.activeTexture(e.TEXTURE0+n),i.bindTexture(e.TEXTURE_3D,o.__webglTexture))},this.setTextureCube=function(t,a){var s=r.get(t);if(6===t.image.length)if(t.version>0&&s.__version!==t.version){x(s,t),i.activeTexture(e.TEXTURE0+a),i.bindTexture(e.TEXTURE_CUBE_MAP,s.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var l=t&&t.isCompressedTexture,u=t.image[0]&&t.image[0].isDataTexture,h=[],v=0;v<6;v++)h[v]=l||u?u?t.image[v].image:t.image[v]:c(t.image[v],!1,!0,n.maxCubemapSize);var g=h[0],y=d(g)||n.isWebGL2,_=o.convert(t.format),w=o.convert(t.type),S=m(_,w);for(b(e.TEXTURE_CUBE_MAP,t,y),v=0;v<6;v++)if(l)for(var M,T=h[v].mipmaps,A=0,C=T.length;A<C;A++)M=T[A],t.format!==RGBAFormat&&t.format!==RGBFormat?i.getCompressedTextureFormats().indexOf(_)>-1?i.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+v,A,S,M.width,M.height,0,M.data):console.warn("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+v,A,S,M.width,M.height,0,_,w,M.data);else u?i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+v,0,S,h[v].width,h[v].height,0,_,w,h[v].data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+v,0,S,_,w,h[v]);s.__maxMipLevel=l?T.length-1:0,p(t,y)&&f(e.TEXTURE_CUBE_MAP,t,g.width,g.height),s.__version=t.version,t.onUpdate&&t.onUpdate(t)}else i.activeTexture(e.TEXTURE0+a),i.bindTexture(e.TEXTURE_CUBE_MAP,s.__webglTexture)},this.setTextureCubeDynamic=function(t,n){i.activeTexture(e.TEXTURE0+n),i.bindTexture(e.TEXTURE_CUBE_MAP,r.get(t).__webglTexture)},this.setupRenderTarget=function(t){var s=r.get(t),l=r.get(t.texture);t.addEventListener("dispose",y),l.__webglTexture=e.createTexture(),a.memory.textures++;var u=!0===t.isWebGLRenderTargetCube,h=!0===t.isWebGLMultisampleRenderTarget,c=d(t)||n.isWebGL2;if(u){s.__webglFramebuffer=[];for(var v=0;v<6;v++)s.__webglFramebuffer[v]=e.createFramebuffer()}else if(s.__webglFramebuffer=e.createFramebuffer(),h)if(n.isWebGL2){s.__webglMultisampledFramebuffer=e.createFramebuffer(),s.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,s.__webglColorRenderbuffer);var g=m(o.convert(t.texture.format),o.convert(t.texture.type)),_=A(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,_,g,t.width,t.height),e.bindFramebuffer(e.FRAMEBUFFER,s.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,s.__webglColorRenderbuffer),e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(s.__webglDepthRenderbuffer=e.createRenderbuffer(),M(s.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(e.FRAMEBUFFER,null)}else console.warn("WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(u){for(i.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture),b(e.TEXTURE_CUBE_MAP,t.texture,c),v=0;v<6;v++)S(s.__webglFramebuffer[v],t,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+v);p(t.texture,c)&&f(e.TEXTURE_CUBE_MAP,t.texture,t.width,t.height),i.bindTexture(e.TEXTURE_CUBE_MAP,null)}else i.bindTexture(e.TEXTURE_2D,l.__webglTexture),b(e.TEXTURE_2D,t.texture,c),S(s.__webglFramebuffer,t,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),p(t.texture,c)&&f(e.TEXTURE_2D,t.texture,t.width,t.height),i.bindTexture(e.TEXTURE_2D,null);t.depthBuffer&&T(t)},this.updateRenderTargetMipmap=function(t){var o=t.texture;if(p(o,d(t)||n.isWebGL2)){var a=t.isWebGLRenderTargetCube?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,s=r.get(o).__webglTexture;i.bindTexture(a,s),f(a,o,t.width,t.height),i.bindTexture(a,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(n.isWebGL2){var i=r.get(t);e.bindFramebuffer(e.READ_FRAMEBUFFER,i.__webglMultisampledFramebuffer),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,i.__webglFramebuffer);var o=t.width,a=t.height,s=e.COLOR_BUFFER_BIT;t.depthBuffer&&(s|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(s|=e.STENCIL_BUFFER_BIT),e.blitFramebuffer(0,0,o,a,0,0,o,a,s,e.NEAREST)}else console.warn("WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}}function WebGLUtils(e,t,i){return{convert:function(r){var n;if(r===RepeatWrapping)return e.REPEAT;if(r===ClampToEdgeWrapping)return e.CLAMP_TO_EDGE;if(r===MirroredRepeatWrapping)return e.MIRRORED_REPEAT;if(r===NearestFilter)return e.NEAREST;if(r===NearestMipMapNearestFilter)return e.NEAREST_MIPMAP_NEAREST;if(r===NearestMipMapLinearFilter)return e.NEAREST_MIPMAP_LINEAR;if(r===LinearFilter)return e.LINEAR;if(r===LinearMipMapNearestFilter)return e.LINEAR_MIPMAP_NEAREST;if(r===LinearMipMapLinearFilter)return e.LINEAR_MIPMAP_LINEAR;if(r===UnsignedByteType)return e.UNSIGNED_BYTE;if(r===UnsignedShort4444Type)return e.UNSIGNED_SHORT_4_4_4_4;if(r===UnsignedShort5551Type)return e.UNSIGNED_SHORT_5_5_5_1;if(r===UnsignedShort565Type)return e.UNSIGNED_SHORT_5_6_5;if(r===ByteType)return e.BYTE;if(r===ShortType)return e.SHORT;if(r===UnsignedShortType)return e.UNSIGNED_SHORT;if(r===IntType)return e.INT;if(r===UnsignedIntType)return e.UNSIGNED_INT;if(r===FloatType)return e.FLOAT;if(r===HalfFloatType){if(i.isWebGL2)return e.HALF_FLOAT;if(null!==(n=t.get("OES_texture_half_float")))return n.HALF_FLOAT_OES}if(r===AlphaFormat)return e.ALPHA;if(r===RGBFormat)return e.RGB;if(r===RGBAFormat)return e.RGBA;if(r===LuminanceFormat)return e.LUMINANCE;if(r===LuminanceAlphaFormat)return e.LUMINANCE_ALPHA;if(r===DepthFormat)return e.DEPTH_COMPONENT;if(r===DepthStencilFormat)return e.DEPTH_STENCIL;if(r===RedFormat)return e.RED;if(r===AddEquation)return e.FUNC_ADD;if(r===SubtractEquation)return e.FUNC_SUBTRACT;if(r===ReverseSubtractEquation)return e.FUNC_REVERSE_SUBTRACT;if(r===ZeroFactor)return e.ZERO;if(r===OneFactor)return e.ONE;if(r===SrcColorFactor)return e.SRC_COLOR;if(r===OneMinusSrcColorFactor)return e.ONE_MINUS_SRC_COLOR;if(r===SrcAlphaFactor)return e.SRC_ALPHA;if(r===OneMinusSrcAlphaFactor)return e.ONE_MINUS_SRC_ALPHA;if(r===DstAlphaFactor)return e.DST_ALPHA;if(r===OneMinusDstAlphaFactor)return e.ONE_MINUS_DST_ALPHA;if(r===DstColorFactor)return e.DST_COLOR;if(r===OneMinusDstColorFactor)return e.ONE_MINUS_DST_COLOR;if(r===SrcAlphaSaturateFactor)return e.SRC_ALPHA_SATURATE;if((r===RGB_S3TC_DXT1_Format||r===RGBA_S3TC_DXT1_Format||r===RGBA_S3TC_DXT3_Format||r===RGBA_S3TC_DXT5_Format)&&null!==(n=t.get("WEBGL_compressed_texture_s3tc"))){if(r===RGB_S3TC_DXT1_Format)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===RGBA_S3TC_DXT1_Format)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===RGBA_S3TC_DXT3_Format)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===RGBA_S3TC_DXT5_Format)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((r===RGB_PVRTC_4BPPV1_Format||r===RGB_PVRTC_2BPPV1_Format||r===RGBA_PVRTC_4BPPV1_Format||r===RGBA_PVRTC_2BPPV1_Format)&&null!==(n=t.get("WEBGL_compressed_texture_pvrtc"))){if(r===RGB_PVRTC_4BPPV1_Format)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===RGB_PVRTC_2BPPV1_Format)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===RGBA_PVRTC_4BPPV1_Format)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===RGBA_PVRTC_2BPPV1_Format)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(r===RGB_ETC1_Format&&null!==(n=t.get("WEBGL_compressed_texture_etc1")))return n.COMPRESSED_RGB_ETC1_WEBGL;if((r===RGBA_ASTC_4x4_Format||r===RGBA_ASTC_5x4_Format||r===RGBA_ASTC_5x5_Format||r===RGBA_ASTC_6x5_Format||r===RGBA_ASTC_6x6_Format||r===RGBA_ASTC_8x5_Format||r===RGBA_ASTC_8x6_Format||r===RGBA_ASTC_8x8_Format||r===RGBA_ASTC_10x5_Format||r===RGBA_ASTC_10x6_Format||r===RGBA_ASTC_10x8_Format||r===RGBA_ASTC_10x10_Format||r===RGBA_ASTC_12x10_Format||r===RGBA_ASTC_12x12_Format)&&null!==(n=t.get("WEBGL_compressed_texture_astc")))return r;if(r===MinEquation||r===MaxEquation){if(i.isWebGL2){if(r===MinEquation)return e.MIN;if(r===MaxEquation)return e.MAX}if(null!==(n=t.get("EXT_blend_minmax"))){if(r===MinEquation)return n.MIN_EXT;if(r===MaxEquation)return n.MAX_EXT}}if(r===UnsignedInt248Type){if(i.isWebGL2)return e.UNSIGNED_INT_24_8;if(null!==(n=t.get("WEBGL_depth_texture")))return n.UNSIGNED_INT_24_8_WEBGL}return 0}}}function ArrayCamera(e){PerspectiveCamera.call(this),this.cameras=e||[]}ArrayCamera.prototype=Object.assign(Object.create(PerspectiveCamera.prototype),{constructor:ArrayCamera,isArrayCamera:!0});var cameraLPos=new Vector3,cameraRPos=new Vector3;function setProjectionFromUnion(e,t,i){cameraLPos.setFromMatrixPosition(t.matrixWorld),cameraRPos.setFromMatrixPosition(i.matrixWorld);var r=cameraLPos.distanceTo(cameraRPos),n=t.projectionMatrix.elements,o=i.projectionMatrix.elements,a=n[14]/(n[10]-1),s=n[14]/(n[10]+1),l=(n[9]+1)/n[5],u=(n[9]-1)/n[5],h=(n[8]-1)/n[0],c=(o[8]+1)/o[0],d=a*h,p=a*c,f=r/(-h+c),m=f*-h;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var v=a+f,g=s+f,y=d-m,_=p+(r-m),b=l*s/g*v,x=u*s/g*v;e.projectionMatrix.makePerspective(y,_,b,x,v,g)}function WebVRManager(e){var t=this,i=null,r=null,n=null,o=[],a=new Matrix4,s=new Matrix4,l=1,u="stage";"undefined"!=typeof window&&"VRFrameData"in window&&(r=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",_,!1));var h=new Matrix4,c=new Quaternion,d=new Vector3,p=new PerspectiveCamera;p.bounds=new Vector4(0,0,.5,1),p.layers.enable(1);var f=new PerspectiveCamera;f.bounds=new Vector4(.5,0,.5,1),f.layers.enable(2);var m=new ArrayCamera([p,f]);function v(){return null!==i&&!0===i.isPresenting}m.layers.enable(1),m.layers.enable(2);var g,y=new Vector2;function _(){if(v()){var r=i.getEyeParameters("left"),n=r.renderWidth*l,o=r.renderHeight*l;g=e.getPixelRatio(),e.getSize(y),e.setDrawingBufferSize(2*n,o,1),w.start()}else t.enabled&&e.setDrawingBufferSize(y.width,y.height,g),w.stop()}var b=[];function x(e){for(var t=navigator.getGamepads&&navigator.getGamepads(),i=0,r=0,n=t.length;i<n;i++){var o=t[i];if(o&&("Daydream Controller"===o.id||"Gear VR Controller"===o.id||"Oculus Go Controller"===o.id||"OpenVR Gamepad"===o.id||o.id.startsWith("Oculus Touch")||o.id.startsWith("Spatial Controller"))){if(r===e)return o;r++}}}this.enabled=!1,this.getController=function(e){var t=o[e];return void 0===t&&((t=new Group).matrixAutoUpdate=!1,t.visible=!1,o[e]=t),t},this.getDevice=function(){return i},this.setDevice=function(e){void 0!==e&&(i=e),w.setContext(e)},this.setFramebufferScaleFactor=function(e){l=e},this.setFrameOfReferenceType=function(e){u=e},this.setPoseTarget=function(e){void 0!==e&&(n=e)},this.getCamera=function(e){var t="stage"===u?1.6:0;if(!1===v())return e.position.set(0,t,0),e.rotation.set(0,0,0),e;if(i.depthNear=e.near,i.depthFar=e.far,i.getFrameData(r),"stage"===u){var l=i.stageParameters;l?a.fromArray(l.sittingToStandingTransform):a.makeTranslation(0,t,0)}var g=r.pose,y=null!==n?n:e;y.matrix.copy(a),y.matrix.decompose(y.position,y.quaternion,y.scale),null!==g.orientation&&(c.fromArray(g.orientation),y.quaternion.multiply(c)),null!==g.position&&(c.setFromRotationMatrix(a),d.fromArray(g.position),d.applyQuaternion(c),y.position.add(d)),y.updateMatrixWorld(),p.near=e.near,f.near=e.near,p.far=e.far,f.far=e.far,p.matrixWorldInverse.fromArray(r.leftViewMatrix),f.matrixWorldInverse.fromArray(r.rightViewMatrix),s.getInverse(a),"stage"===u&&(p.matrixWorldInverse.multiply(s),f.matrixWorldInverse.multiply(s));var _=y.parent;null!==_&&(h.getInverse(_.matrixWorld),p.matrixWorldInverse.multiply(h),f.matrixWorldInverse.multiply(h)),p.matrixWorld.getInverse(p.matrixWorldInverse),f.matrixWorld.getInverse(f.matrixWorldInverse),p.projectionMatrix.fromArray(r.leftProjectionMatrix),f.projectionMatrix.fromArray(r.rightProjectionMatrix),setProjectionFromUnion(m,p,f);var w=i.getLayers();if(w.length){var S=w[0];null!==S.leftBounds&&4===S.leftBounds.length&&p.bounds.fromArray(S.leftBounds),null!==S.rightBounds&&4===S.rightBounds.length&&f.bounds.fromArray(S.rightBounds)}return function(){for(var e=0;e<o.length;e++){var t=o[e],i=x(e);if(void 0!==i&&void 0!==i.pose){if(null===i.pose)return;var r=i.pose;!1===r.hasPosition&&t.position.set(.2,-.6,-.05),null!==r.position&&t.position.fromArray(r.position),null!==r.orientation&&t.quaternion.fromArray(r.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(a),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0,t.visible=!0;var n="Daydream Controller"===i.id?0:1;b[e]!==i.buttons[n].pressed&&(b[e]=i.buttons[n].pressed,!0===b[e]?t.dispatchEvent({type:"selectstart"}):(t.dispatchEvent({type:"selectend"}),t.dispatchEvent({type:"select"})))}else t.visible=!1}}(),m},this.getStandingMatrix=function(){return a},this.isPresenting=v;var w=new WebGLAnimation;this.setAnimationLoop=function(e){w.setAnimationLoop(e)},this.submitFrame=function(){v()&&i.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",_)}}function WebXRManager(e){var t=e.context,i=null,r=null,n=1,o=null,a="stage",s=null,l=[],u=[];function h(){return null!==r&&null!==o}var c=new PerspectiveCamera;c.layers.enable(1),c.viewport=new Vector4;var d=new PerspectiveCamera;d.layers.enable(2),d.viewport=new Vector4;var p=new ArrayCamera([c,d]);function f(e){var t=l[u.indexOf(e.inputSource)];t&&t.dispatchEvent({type:e.type})}function m(){e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),y.stop()}function v(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}p.layers.enable(1),p.layers.enable(2),this.enabled=!1,this.getController=function(e){var t=l[e];return void 0===t&&((t=new Group).matrixAutoUpdate=!1,t.visible=!1,l[e]=t),t},this.getDevice=function(){return i},this.setDevice=function(e){void 0!==e&&(i=e),e instanceof XRDevice&&t.setCompatibleXRDevice(e)},this.setFramebufferScaleFactor=function(e){n=e},this.setFrameOfReferenceType=function(e){a=e},this.setSession=function(i){null!==(r=i)&&(r.addEventListener("select",f),r.addEventListener("selectstart",f),r.addEventListener("selectend",f),r.addEventListener("end",m),r.baseLayer=new XRWebGLLayer(r,t,{framebufferScaleFactor:n}),r.requestFrameOfReference(a).then(function(t){o=t,e.setFramebuffer(r.baseLayer.framebuffer),y.setContext(r),y.start()}),u=r.getInputSources(),r.addEventListener("inputsourceschange",function(){u=r.getInputSources(),console.log(u);for(var e=0;e<l.length;e++){l[e].userData.inputSource=u[e]}}))},this.getCamera=function(e){if(h()){var t=e.parent,i=p.cameras;v(p,t);for(var r=0;r<i.length;r++)v(i[r],t);e.matrixWorld.copy(p.matrixWorld);for(var n=e.children,o=(r=0,n.length);r<o;r++)n[r].updateMatrixWorld(!0);return setProjectionFromUnion(p,c,d),p}return e},this.isPresenting=h;var g=null;var y=new WebGLAnimation;y.setAnimationLoop(function(e,t){if(null!==(s=t.getDevicePose(o)))for(var i=r.baseLayer,n=t.views,a=0;a<n.length;a++){var h=n[a],c=i.getViewport(h),d=s.getViewMatrix(h),f=p.cameras[a];f.matrix.fromArray(d).getInverse(f.matrix),f.projectionMatrix.fromArray(h.projectionMatrix),f.viewport.set(c.x,c.y,c.width,c.height),0===a&&p.matrix.copy(f.matrix)}for(a=0;a<l.length;a++){var m=l[a],v=u[a];if(v){var y=t.getInputPose(v,o);if(null!==y){"targetRay"in y?m.matrix.elements=y.targetRay.transformMatrix:"pointerMatrix"in y&&(m.matrix.elements=y.pointerMatrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.visible=!0;continue}}m.visible=!1}g&&g(e)}),this.setAnimationLoop=function(e){g=e},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("WebXRManager: getStandingMatrix() is no longer needed."),new Matrix4},this.submitFrame=function(){}}function WebGLRenderer(e){console.log("WebGLRenderer",REVISION);var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),i=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,n=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,u=void 0!==e.powerPreference?e.powerPreference:"default",h=null,c=null;this.domElement=t,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=LinearToneMapping,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var d,p,f,m,v,g,y,_,b,x,w,S,M,T,A,C,L,N,P=this,k=!1,E=null,D=null,O=null,R=-1,F={geometry:null,program:null,wireframe:!1},I=null,B=null,U=new Vector4,V=new Vector4,z=null,G=0,j=t.width,W=t.height,H=1,q=new Vector4(0,0,j,W),Y=new Vector4(0,0,j,W),X=!1,K=new Frustum,Q=new WebGLClipping,Z=!1,J=!1,$=new Matrix4,ee=new Vector3;function te(){return null===D?H:1}try{var ie={alpha:r,depth:n,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:u};if(t.addEventListener("webglcontextlost",ae,!1),t.addEventListener("webglcontextrestored",se,!1),null===(d=i||t.getContext("webgl",ie)||t.getContext("experimental-webgl",ie)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===d.getShaderPrecisionFormat&&(d.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("WebGLRenderer: "+e.message),e}function re(){p=new WebGLExtensions(d),(f=new WebGLCapabilities(d,p,e)).isWebGL2||(p.get("WEBGL_depth_texture"),p.get("OES_texture_float"),p.get("OES_texture_half_float"),p.get("OES_texture_half_float_linear"),p.get("OES_standard_derivatives"),p.get("OES_element_index_uint"),p.get("ANGLE_instanced_arrays")),p.get("OES_texture_float_linear"),N=new WebGLUtils(d,p,f),(m=new WebGLState(d,p,N,f)).scissor(V.copy(Y).multiplyScalar(H)),m.viewport(U.copy(q).multiplyScalar(H)),v=new WebGLInfo(d),g=new WebGLProperties,y=new WebGLTextures(d,p,m,g,f,N,v),_=new WebGLAttributes(d),b=new WebGLGeometries(d,_,v),x=new WebGLObjects(b,v),A=new WebGLMorphtargets(d),w=new WebGLPrograms(P,p,f),S=new WebGLRenderLists,M=new WebGLRenderStates,T=new WebGLBackground(P,m,x,s),C=new WebGLBufferRenderer(d,p,v,f),L=new WebGLIndexedBufferRenderer(d,p,v,f),v.programs=w.programs,P.context=d,P.capabilities=f,P.extensions=p,P.properties=g,P.renderLists=S,P.state=m,P.info=v}re();var ne=null;"undefined"!=typeof navigator&&(ne="xr"in navigator?new WebXRManager(P):new WebVRManager(P)),this.vr=ne;var oe=new WebGLShadowMap(P,x,f.maxTextureSize);function ae(e){e.preventDefault(),console.log("WebGLRenderer: Context Lost."),k=!0}function se(){console.log("WebGLRenderer: Context Restored."),k=!1,re()}function le(e){var t=e.target;t.removeEventListener("dispose",le),function(e){ue(e),g.remove(e)}(t)}function ue(e){var t=g.get(e).program;e.program=void 0,void 0!==t&&w.releaseProgram(t)}this.shadowMap=oe,this.getContext=function(){return d},this.getContextAttributes=function(){return d.getContextAttributes()},this.forceContextLoss=function(){var e=p.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=p.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return H},this.setPixelRatio=function(e){void 0!==e&&(H=e,this.setSize(j,W,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new Vector2),e.set(j,W)},this.setSize=function(e,i,r){ne.isPresenting()?console.warn("WebGLRenderer: Can't change size while VR device is presenting."):(j=e,W=i,t.width=e*H,t.height=i*H,!1!==r&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new Vector2),e.set(j*H,W*H)},this.setDrawingBufferSize=function(e,i,r){j=e,W=i,H=r,t.width=e*r,t.height=i*r,this.setViewport(0,0,e,i)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new Vector4),e.copy(U)},this.getViewport=function(e){return e.copy(q)},this.setViewport=function(e,t,i,r){e.isVector4?q.set(e.x,e.y,e.z,e.w):q.set(e,t,i,r),m.viewport(U.copy(q).multiplyScalar(H))},this.getScissor=function(e){return e.copy(Y)},this.setScissor=function(e,t,i,r){e.isVector4?Y.set(e.x,e.y,e.z,e.w):Y.set(e,t,i,r),m.scissor(V.copy(Y).multiplyScalar(H))},this.getScissorTest=function(){return X},this.setScissorTest=function(e){m.setScissorTest(X=e)},this.getClearColor=function(){return T.getClearColor()},this.setClearColor=function(){T.setClearColor.apply(T,arguments)},this.getClearAlpha=function(){return T.getClearAlpha()},this.setClearAlpha=function(){T.setClearAlpha.apply(T,arguments)},this.clear=function(e,t,i){var r=0;(void 0===e||e)&&(r|=d.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=d.DEPTH_BUFFER_BIT),(void 0===i||i)&&(r|=d.STENCIL_BUFFER_BIT),d.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ae,!1),t.removeEventListener("webglcontextrestored",se,!1),S.dispose(),M.dispose(),g.dispose(),x.dispose(),ne.dispose(),de.stop()},this.renderBufferImmediate=function(e,t){m.initAttributes();var i=g.get(e);e.hasPositions&&!i.position&&(i.position=d.createBuffer()),e.hasNormals&&!i.normal&&(i.normal=d.createBuffer()),e.hasUvs&&!i.uv&&(i.uv=d.createBuffer()),e.hasColors&&!i.color&&(i.color=d.createBuffer());var r=t.getAttributes();e.hasPositions&&(d.bindBuffer(d.ARRAY_BUFFER,i.position),d.bufferData(d.ARRAY_BUFFER,e.positionArray,d.DYNAMIC_DRAW),m.enableAttribute(r.position),d.vertexAttribPointer(r.position,3,d.FLOAT,!1,0,0)),e.hasNormals&&(d.bindBuffer(d.ARRAY_BUFFER,i.normal),d.bufferData(d.ARRAY_BUFFER,e.normalArray,d.DYNAMIC_DRAW),m.enableAttribute(r.normal),d.vertexAttribPointer(r.normal,3,d.FLOAT,!1,0,0)),e.hasUvs&&(d.bindBuffer(d.ARRAY_BUFFER,i.uv),d.bufferData(d.ARRAY_BUFFER,e.uvArray,d.DYNAMIC_DRAW),m.enableAttribute(r.uv),d.vertexAttribPointer(r.uv,2,d.FLOAT,!1,0,0)),e.hasColors&&(d.bindBuffer(d.ARRAY_BUFFER,i.color),d.bufferData(d.ARRAY_BUFFER,e.colorArray,d.DYNAMIC_DRAW),m.enableAttribute(r.color),d.vertexAttribPointer(r.color,3,d.FLOAT,!1,0,0)),m.disableUnusedAttributes(),d.drawArrays(d.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,r,n,o){var a=n.isMesh&&n.matrixWorld.determinant()<0;m.setMaterial(r,a);var s=ve(e,t,r,n),l=!1;F.geometry===i.id&&F.program===s.id&&F.wireframe===(!0===r.wireframe)||(F.geometry=i.id,F.program=s.id,F.wireframe=!0===r.wireframe,l=!0),n.morphTargetInfluences&&(A.update(n,i,r,s),l=!0);var u,h=i.index,c=i.attributes.position,v=1;!0===r.wireframe&&(h=b.getWireframeAttribute(i),v=2);var g=C;null!==h&&(u=_.get(h),(g=L).setIndex(u)),l&&(!function(e,t,i){if(i&&i.isInstancedBufferGeometry&&!f.isWebGL2&&null===p.get("ANGLE_instanced_arrays"))return void console.error("WebGLRenderer.setupVertexAttributes: using InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");m.initAttributes();var r=i.attributes,n=t.getAttributes(),o=e.defaultAttributeValues;for(var a in n){var s=n[a];if(s>=0){var l=r[a];if(void 0!==l){var u=l.normalized,h=l.itemSize,c=_.get(l);if(void 0===c)continue;var v=c.buffer,g=c.type,y=c.bytesPerElement;if(l.isInterleavedBufferAttribute){var b=l.data,x=b.stride,w=l.offset;b&&b.isInstancedInterleavedBuffer?(m.enableAttributeAndDivisor(s,b.meshPerAttribute),void 0===i.maxInstancedCount&&(i.maxInstancedCount=b.meshPerAttribute*b.count)):m.enableAttribute(s),d.bindBuffer(d.ARRAY_BUFFER,v),d.vertexAttribPointer(s,h,g,u,x*y,w*y)}else l.isInstancedBufferAttribute?(m.enableAttributeAndDivisor(s,l.meshPerAttribute),void 0===i.maxInstancedCount&&(i.maxInstancedCount=l.meshPerAttribute*l.count)):m.enableAttribute(s),d.bindBuffer(d.ARRAY_BUFFER,v),d.vertexAttribPointer(s,h,g,u,0,0)}else if(void 0!==o){var S=o[a];if(void 0!==S)switch(S.length){case 2:d.vertexAttrib2fv(s,S);break;case 3:d.vertexAttrib3fv(s,S);break;case 4:d.vertexAttrib4fv(s,S);break;default:d.vertexAttrib1fv(s,S)}}}}m.disableUnusedAttributes()}(r,s,i),null!==h&&d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,u.buffer));var y=1/0;null!==h?y=h.count:void 0!==c&&(y=c.count);var x=i.drawRange.start*v,w=i.drawRange.count*v,S=null!==o?o.start*v:0,M=null!==o?o.count*v:1/0,T=Math.max(x,S),N=Math.min(y,x+w,S+M)-1,P=Math.max(0,N-T+1);if(0!==P){if(n.isMesh)if(!0===r.wireframe)m.setLineWidth(r.wireframeLinewidth*te()),g.setMode(d.LINES);else switch(n.drawMode){case TrianglesDrawMode:g.setMode(d.TRIANGLES);break;case TriangleStripDrawMode:g.setMode(d.TRIANGLE_STRIP);break;case TriangleFanDrawMode:g.setMode(d.TRIANGLE_FAN)}else if(n.isLine){var k=r.linewidth;void 0===k&&(k=1),m.setLineWidth(k*te()),n.isLineSegments?g.setMode(d.LINES):n.isLineLoop?g.setMode(d.LINE_LOOP):g.setMode(d.LINE_STRIP)}else n.isPoints?g.setMode(d.POINTS):n.isSprite&&g.setMode(d.TRIANGLES);i&&i.isInstancedBufferGeometry?i.maxInstancedCount>0&&g.renderInstances(i,T,P):g.render(T,P)}},this.compile=function(e,t){(c=M.get(e,t)).init(),e.traverse(function(e){e.isLight&&(c.pushLight(e),e.castShadow&&c.pushShadow(e))}),c.setupLights(t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var i=0;i<t.material.length;i++)me(t.material[i],e.fog,t);else me(t.material,e.fog,t)})};var he=null;var ce,de=new WebGLAnimation;function pe(e,t,i,r){for(var n=0,o=e.length;n<o;n++){var a=e[n],s=a.object,l=a.geometry,u=void 0===r?a.material:r,h=a.group;if(i.isArrayCamera){B=i;for(var d=i.cameras,p=0,f=d.length;p<f;p++){var v=d[p];if(s.layers.test(v.layers)){if("viewport"in v)m.viewport(U.copy(v.viewport));else{var g=v.bounds,y=g.x*j,_=g.y*W,b=g.z*j,x=g.w*W;m.viewport(U.set(y,_,b,x).multiplyScalar(H))}c.setupLights(v),fe(s,t,v,l,u,h)}}}else B=null,fe(s,t,i,l,u,h)}}function fe(e,t,i,r,n,o){if(e.onBeforeRender(P,t,i,r,n,o),c=M.get(t,B||i),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){m.setMaterial(n);var a=ve(i,t.fog,n,e);F.geometry=null,F.program=null,F.wireframe=!1,function(e,t){e.render(function(e){P.renderBufferImmediate(e,t)})}(e,a)}else P.renderBufferDirect(i,t.fog,r,n,e,o);e.onAfterRender(P,t,i,r,n,o),c=M.get(t,B||i)}function me(e,t,i){var r=g.get(e),n=c.state.lights,o=c.state.shadowsArray,a=r.lightsHash,s=n.state.hash,l=w.getParameters(e,n.state,o,t,Q.numPlanes,Q.numIntersection,i),u=w.getProgramCode(e,l),h=r.program,d=!0;if(void 0===h)e.addEventListener("dispose",le);else if(h.code!==u)ue(e);else if(a.stateID!==s.stateID||a.directionalLength!==s.directionalLength||a.pointLength!==s.pointLength||a.spotLength!==s.spotLength||a.rectAreaLength!==s.rectAreaLength||a.hemiLength!==s.hemiLength||a.shadowsLength!==s.shadowsLength)a.stateID=s.stateID,a.directionalLength=s.directionalLength,a.pointLength=s.pointLength,a.spotLength=s.spotLength,a.rectAreaLength=s.rectAreaLength,a.hemiLength=s.hemiLength,a.shadowsLength=s.shadowsLength,d=!1;else{if(void 0!==l.shaderID)return;d=!1}if(d){if(l.shaderID){var p=ShaderLib[l.shaderID];r.shader={name:e.type,uniforms:cloneUniforms(p.uniforms),vertexShader:p.vertexShader,fragmentShader:p.fragmentShader}}else r.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(r.shader,P),u=w.getProgramCode(e,l),h=w.acquireProgram(e,r.shader,l,u),r.program=h,e.program=h}var f=h.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var m=0;m<P.maxMorphTargets;m++)f["morphTarget"+m]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(m=0;m<P.maxMorphNormals;m++)f["morphNormal"+m]>=0&&e.numSupportedMorphNormals++}var v=r.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=Q.numPlanes,r.numIntersection=Q.numIntersection,v.clippingPlanes=Q.uniform),r.fog=t,void 0===a&&(r.lightsHash=a={}),a.stateID=s.stateID,a.directionalLength=s.directionalLength,a.pointLength=s.pointLength,a.spotLength=s.spotLength,a.rectAreaLength=s.rectAreaLength,a.hemiLength=s.hemiLength,a.shadowsLength=s.shadowsLength,e.lights&&(v.ambientLightColor.value=n.state.ambient,v.directionalLights.value=n.state.directional,v.spotLights.value=n.state.spot,v.rectAreaLights.value=n.state.rectArea,v.pointLights.value=n.state.point,v.hemisphereLights.value=n.state.hemi,v.directionalShadowMap.value=n.state.directionalShadowMap,v.directionalShadowMatrix.value=n.state.directionalShadowMatrix,v.spotShadowMap.value=n.state.spotShadowMap,v.spotShadowMatrix.value=n.state.spotShadowMatrix,v.pointShadowMap.value=n.state.pointShadowMap,v.pointShadowMatrix.value=n.state.pointShadowMatrix);var y=r.program.getUniforms(),_=WebGLUniforms.seqWithValue(y.seq,v);r.uniformsList=_}function ve(e,t,i,r){G=0;var n=g.get(i),o=c.state.lights,a=n.lightsHash,s=o.state.hash;if(Z&&(J||e!==I)){var l=e===I&&i.id===R;Q.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,e,n,l)}!1===i.needsUpdate&&(void 0===n.program?i.needsUpdate=!0:i.fog&&n.fog!==t?i.needsUpdate=!0:(!i.lights||a.stateID===s.stateID&&a.directionalLength===s.directionalLength&&a.pointLength===s.pointLength&&a.spotLength===s.spotLength&&a.rectAreaLength===s.rectAreaLength&&a.hemiLength===s.hemiLength&&a.shadowsLength===s.shadowsLength)&&(void 0===n.numClippingPlanes||n.numClippingPlanes===Q.numPlanes&&n.numIntersection===Q.numIntersection)||(i.needsUpdate=!0)),i.needsUpdate&&(me(i,t,r),i.needsUpdate=!1);var u,h,p=!1,v=!1,y=!1,_=n.program,b=_.getUniforms(),x=n.shader.uniforms;if(m.useProgram(_.program)&&(p=!0,v=!0,y=!0),i.id!==R&&(R=i.id,v=!0),p||I!==e){if(b.setValue(d,"projectionMatrix",e.projectionMatrix),f.logarithmicDepthBuffer&&b.setValue(d,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),I!==e&&(I=e,v=!0,y=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.envMap){var w=b.map.cameraPosition;void 0!==w&&w.setValue(d,ee.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning)&&b.setValue(d,"viewMatrix",e.matrixWorldInverse)}if(i.skinning){b.setOptional(d,r,"bindMatrix"),b.setOptional(d,r,"bindMatrixInverse");var S=r.skeleton;if(S){var M=S.bones;if(f.floatVertexTextures){if(void 0===S.boneTexture){var T=Math.sqrt(4*M.length);T=_Math.ceilPowerOfTwo(T),T=Math.max(T,4);var A=new Float32Array(T*T*4);A.set(S.boneMatrices);var C=new DataTexture(A,T,T,RGBAFormat,FloatType);C.needsUpdate=!0,S.boneMatrices=A,S.boneTexture=C,S.boneTextureSize=T}b.setValue(d,"boneTexture",S.boneTexture),b.setValue(d,"boneTextureSize",S.boneTextureSize)}else b.setOptional(d,S,"boneMatrices")}}return v&&(b.setValue(d,"toneMappingExposure",P.toneMappingExposure),b.setValue(d,"toneMappingWhitePoint",P.toneMappingWhitePoint),i.lights&&(h=y,(u=x).ambientLightColor.needsUpdate=h,u.directionalLights.needsUpdate=h,u.pointLights.needsUpdate=h,u.spotLights.needsUpdate=h,u.rectAreaLights.needsUpdate=h,u.hemisphereLights.needsUpdate=h),t&&i.fog&&function(e,t){e.fogColor.value=t.color,t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(x,t),i.isMeshBasicMaterial?ge(x,i):i.isMeshLambertMaterial?(ge(x,i),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(x,i)):i.isMeshPhongMaterial?(ge(x,i),i.isMeshToonMaterial?function(e,t){ye(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(x,i):ye(x,i)):i.isMeshStandardMaterial?(ge(x,i),i.isMeshPhysicalMaterial?function(e,t){_e(e,t),e.reflectivity.value=t.reflectivity,e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness}(x,i):_e(x,i)):i.isMeshMatcapMaterial?(ge(x,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(x,i)):i.isMeshDepthMaterial?(ge(x,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(x,i)):i.isMeshDistanceMaterial?(ge(x,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(x,i)):i.isMeshNormalMaterial?(ge(x,i),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(x,i)):i.isLineBasicMaterial?(function(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}(x,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(x,i)):i.isPointsMaterial?function(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size*H,e.scale.value=.5*W,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(x,i):i.isSpriteMaterial?function(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity,e.rotation.value=t.rotation,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(x,i):i.isShadowMaterial&&(x.color.value=i.color,x.opacity.value=i.opacity),void 0!==x.ltc_1&&(x.ltc_1.value=UniformsLib.LTC_1),void 0!==x.ltc_2&&(x.ltc_2.value=UniformsLib.LTC_2),WebGLUniforms.upload(d,n.uniformsList,x,P)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(WebGLUniforms.upload(d,n.uniformsList,x,P),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&b.setValue(d,"center",r.center),b.setValue(d,"modelViewMatrix",r.modelViewMatrix),b.setValue(d,"normalMatrix",r.normalMatrix),b.setValue(d,"modelMatrix",r.matrixWorld),_}function ge(e,t){var i;e.opacity.value=t.opacity,t.color&&(e.diffuse.value=t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=g.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?i=t.map:t.specularMap?i=t.specularMap:t.displacementMap?i=t.displacementMap:t.normalMap?i=t.normalMap:t.bumpMap?i=t.bumpMap:t.roughnessMap?i=t.roughnessMap:t.metalnessMap?i=t.metalnessMap:t.alphaMap?i=t.alphaMap:t.emissiveMap&&(i=t.emissiveMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}function ye(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function _e(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===BackSide&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===BackSide&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}de.setAnimationLoop(function(e){ne.isPresenting()||he&&he(e)}),"undefined"!=typeof window&&de.setContext(window),this.setAnimationLoop=function(e){he=e,ne.setAnimationLoop(e),de.start()},this.render=function(e,t){var i,r;if(void 0!==arguments[2]&&(console.warn("WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),i=arguments[2]),void 0!==arguments[3]&&(console.warn("WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),t&&t.isCamera){if(!k){F.geometry=null,F.program=null,F.wireframe=!1,R=-1,I=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),ne.enabled&&(t=ne.getCamera(t)),(c=M.get(e,t)).init(),e.onBeforeRender(P,e,t,i||D),$.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),K.setFromMatrix($),J=this.localClippingEnabled,Z=Q.init(this.clippingPlanes,J,t),(h=S.get(e,t)).init(),function e(t,i,r,n){if(!1===t.visible)return;var o=t.layers.test(i.layers);if(o)if(t.isGroup)r=t.renderOrder;else if(t.isLight)c.pushLight(t),t.castShadow&&c.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||K.intersectsSprite(t)){n&&ee.setFromMatrixPosition(t.matrixWorld).applyMatrix4($);var a=x.update(t),s=t.material;h.push(t,a,s,r,ee.z,null)}}else if(t.isImmediateRenderObject)n&&ee.setFromMatrixPosition(t.matrixWorld).applyMatrix4($),h.push(t,null,t.material,r,ee.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.update(),!t.frustumCulled||K.intersectsObject(t))){n&&ee.setFromMatrixPosition(t.matrixWorld).applyMatrix4($);var a=x.update(t),s=t.material;if(Array.isArray(s))for(var l=a.groups,u=0,d=l.length;u<d;u++){var p=l[u],f=s[p.materialIndex];f&&f.visible&&h.push(t,a,f,r,ee.z,p)}else s.visible&&h.push(t,a,s,r,ee.z,null)}var m=t.children;for(var u=0,d=m.length;u<d;u++)e(m[u],i,r,n)}(e,t,0,P.sortObjects),!0===P.sortObjects&&h.sort(),Z&&Q.beginShadows();var n=c.state.shadowsArray;oe.render(n,e,t),c.setupLights(t),Z&&Q.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==i&&this.setRenderTarget(i),T.render(h,e,t,r);var o=h.opaque,a=h.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;o.length&&pe(o,e,t,s),a.length&&pe(a,e,t,s)}else o.length&&pe(o,e,t),a.length&&pe(a,e,t);null!==D&&(y.updateRenderTargetMipmap(D),y.updateMultisampleRenderTarget(D)),m.buffers.depth.setTest(!0),m.buffers.depth.setMask(!0),m.buffers.color.setMask(!0),m.setPolygonOffset(!1),e.onAfterRender(P,e,t),ne.enabled&&ne.submitFrame(),h=null,c=null}}else console.error("WebGLRenderer.render: camera is not an instance of Camera.")},this.allocTextureUnit=function(){var e=G;return e>=f.maxTextures&&console.warn("WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+f.maxTextures),G+=1,e},this.setTexture2D=(ce=!1,function(e,t){e&&e.isWebGLRenderTarget&&(ce||(console.warn("WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),ce=!0),e=e.texture),y.setTexture2D(e,t)}),this.setTexture3D=function(e,t){y.setTexture3D(e,t)},this.setTexture=function(){var e=!1;return function(t,i){e||(console.warn("WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),e=!0),y.setTexture2D(t,i)}}(),this.setTextureCube=function(){var e=!1;return function(t,i){t&&t.isWebGLRenderTargetCube&&(e||(console.warn("WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?y.setTextureCube(t,i):y.setTextureCubeDynamic(t,i)}}(),this.setFramebuffer=function(e){E=e},this.getRenderTarget=function(){return D},this.setRenderTarget=function(e,t,i){D=e,e&&void 0===g.get(e).__webglFramebuffer&&y.setupRenderTarget(e);var r=E,n=!1;if(e){var o=g.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(r=o[t||0],n=!0):r=e.isWebGLMultisampleRenderTarget?g.get(e).__webglMultisampledFramebuffer:o,U.copy(e.viewport),V.copy(e.scissor),z=e.scissorTest}else U.copy(q).multiplyScalar(H),V.copy(Y).multiplyScalar(H),z=X;if(O!==r&&(d.bindFramebuffer(d.FRAMEBUFFER,r),O=r),m.viewport(U),m.scissor(V),m.setScissorTest(z),n){var a=g.get(e.texture);d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_CUBE_MAP_POSITIVE_X+t||0,a.__webglTexture,i||0)}},this.readRenderTargetPixels=function(e,t,i,r,n,o){if(e&&e.isWebGLRenderTarget){var a=g.get(e).__webglFramebuffer;if(a){var s=!1;a!==O&&(d.bindFramebuffer(d.FRAMEBUFFER,a),s=!0);try{var l=e.texture,u=l.format,h=l.type;if(u!==RGBAFormat&&N.convert(u)!==d.getParameter(d.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(h===UnsignedByteType||N.convert(h)===d.getParameter(d.IMPLEMENTATION_COLOR_READ_TYPE)||h===FloatType&&(f.isWebGL2||p.get("OES_texture_float")||p.get("WEBGL_color_buffer_float"))||h===HalfFloatType&&(f.isWebGL2?p.get("EXT_color_buffer_float"):p.get("EXT_color_buffer_half_float"))))return void console.error("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");d.checkFramebufferStatus(d.FRAMEBUFFER)===d.FRAMEBUFFER_COMPLETE?t>=0&&t<=e.width-r&&i>=0&&i<=e.height-n&&d.readPixels(t,i,r,n,N.convert(u),N.convert(h),o):console.error("WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&d.bindFramebuffer(d.FRAMEBUFFER,O)}}}else console.error("WebGLRenderer.readRenderTargetPixels: renderTarget is not WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,i){var r=t.image.width,n=t.image.height,o=N.convert(t.format);this.setTexture2D(t,0),d.copyTexImage2D(d.TEXTURE_2D,i||0,o,e.x,e.y,r,n,0)},this.copyTextureToTexture=function(e,t,i,r){var n=t.image.width,o=t.image.height,a=N.convert(i.format),s=N.convert(i.type);this.setTexture2D(i,0),t.isDataTexture?d.texSubImage2D(d.TEXTURE_2D,r||0,e.x,e.y,n,o,a,s,t.image.data):d.texSubImage2D(d.TEXTURE_2D,r||0,e.x,e.y,a,s,t.image)}}function Uniform(e){"string"==typeof e&&(console.warn("Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}Uniform.prototype.clone=function(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())};var FXAAShader={uniforms:{tDiffuse:{value:null},resolution:{value:new Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","","","","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","","#if (FXAA_PC == 1)","","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immediates.","    // Immediates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","","                    }","                    #endif","","                }","                #endif","","            }","            #endif","","        }","        #endif","","    }","    #endif","","                        }","                        #endif","","                    }","                    #endif","","                }","                #endif","","            }","            #endif","","        }","        #endif","","    }","","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")},WebGLDeferredRenderer=function(e){e=e||{};var t,i,r,n,o,a,s,l,u,h,c,d,p,f,m,v,g,y,_,b,x,w,S=this,M=!1,T=!1,A=!1,C=!1,L=new ShaderMaterial({visible:!1}),N=new Vector3,P={},k={},E={},D={},O={},R={},F={},I={},B={},U=60,V={},z={},G={};function j(e){var t,i,r,n=P[e.uuid],a=k[e.uuid];void 0===n&&((s=new Scene).userData.lights={},(n=Me()).scene=s,P[e.uuid]=n);if(void 0===a){var s;(s=new Scene).userData.lights={};var l=(t=ShaderDeferred.emissiveLight,i=new ShaderMaterial({uniforms:Object.assign({},t.uniforms),vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,blending:NoBlending,depthWrite:!1}),(r=new Mesh(new PlaneBufferGeometry(2,2),i)).onBeforeRender=function(e,t,i,r,n,a){n.uniforms.samplerColor.value=o.renderTarget2.texture},r);s.userData.emissiveLight=l,s.add(l),(a=Me()).scene=s,k[e.uuid]=a}n.used=!0,a.used=!0;var u=n.scene,h=a.scene;h.userData.emissiveLight.visible=!A,x=u,w=h}function W(e,t,i,r){var n=t[e.uuid];return void 0===n&&((n=Me()).material=i(e),t[e.uuid]=n),n.used=!0,r(n.material,e),V[n.material.uuid]=e,n.material}function H(e,t,i){if(void 0!==e.material){if(Array.isArray(e.material))for(var r=0,n=e.material.length;r<n;r++)e.material[r]=t(e.material[r]);else e.material=t(e.material);e.onBeforeRender=i}}function q(e){if(void 0!==e.material)if(Array.isArray(e.material))for(var t=0,i=e.material.length;t<i;t++)e.material[t]=V[e.material[t].uuid];else e.material=V[e.material.uuid]}function Y(e){H(e,X,Z)}function X(e){return W(e,A?D:E,K,Q)}function K(e){var t=A?ShaderDeferred.normalDepthShininess:ShaderDeferred.normalDepth;return new ShaderMaterial({uniforms:Object.assign({},t.uniforms),fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,blending:NoBlending})}function Q(e,t){void 0!==t.skinning&&(e.skinning=t.skinning),void 0!==t.morphTargets&&(e.morphTargets=t.morphTargets),!0===t.visible?e.visible=!t.transparent:e.visible=!1}function Z(e,t,i,r,n,o){if(A){var a=V[n.uuid];void 0!==a&&void 0!==a.shininess&&(n.uniforms.shininess.value=a.shininess)}}function J(e){H(e,$,ie)}function $(e){return W(e,O,ee,te)}function ee(e){var t=ShaderDeferred.color,i=new ShaderMaterial({uniforms:Object.assign({},t.uniforms),fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,blending:NoBlending});return void 0!==e.map&&(i.map=e.map),i}function te(e,t){void 0!==t.map&&(e.map=t.map),void 0!==t.skinning&&(e.skinning=t.skinning),void 0!==t.morphTargets&&(e.morphTargets=t.morphTargets),!0===t.visible?e.visible=!t.transparent:e.visible=!1}function ie(e,t,i,r,n,o){var a,s,l=V[n.uuid],u=n.uniforms;!0===l.isMeshBasicMaterial?s=l.color:(a=l.color,s=l.emissive);var h=l.specular,c=l.shininess,d=l.map;void 0!==a&&u.diffuse.value.copy(a),void 0!==s&&u.emissive.value.copy(s),void 0!==h&&u.specular.value.copy(h),void 0!==c&&void 0!==u.shininess&&(u.shininess.value=c),void 0!==d&&(u.map.value=d)}function re(e){H(e,ne,se)}function ne(e){return!0===e.transparent?(V[e.uuid]=e,e):W(e,R,oe,ae)}function oe(e){var t=ShaderDeferred.reconstruction,i=new ShaderMaterial({uniforms:Object.assign({},t.uniforms),fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,blending:NoBlending});return void 0!==e.map&&(i.map=e.map),i}function ae(e,t){te(e,t)}function se(e,t,i,r,n,o){if(!0!==n.transparent)ie(0,0,0,0,n),n.uniforms.samplerLight.value=d.renderTarget2.texture;else{var a=z[this.uuid];a&&a.call(this,e,t,i,r,n,o)}}function le(e){if(void 0!==e.material)if(Array.isArray(e.material))for(var t=0,i=e.material.length;t<i;t++)void 0===G[e.material[t].uuid]&&(G[e.material[t].uuid]=e.material[t].visible,e.material[t].visible=e.material[t].transparent&&e.material[t].visible);else void 0===G[e.material.uuid]&&(G[e.material.uuid]=e.material.visible,e.material.visible=e.material.transparent&&e.material.visible)}function ue(e){if(void 0!==e.material)if(Array.isArray(e.material))for(var t=0,i=e.material.length;t<i;t++)e.material[t].visible=G[e.material[t].uuid];else e.material.visible=G[e.material.uuid]}function he(e){return e.isPointLight?((t=fe(e,new SphereBufferGeometry(1,16,8))).onBeforeRender=ge,t):e.isSpotLight?function(e){var t=fe(e,new PlaneBufferGeometry(2,2));return t.onBeforeRender=ye,t}(e):e.isDirectionalLight?function(e){var t=fe(e,new PlaneBufferGeometry(2,2));return t.onBeforeRender=_e,t}(e):null;var t}function ce(e){return e.isPointLight?((t=me(A?ShaderDeferred.pointLightPre:ShaderDeferred.pointLight)).side=BackSide,t.depthFunc=GreaterEqualDepth,t):e.isSpotLight?function(){var e=me(A?ShaderDeferred.spotLightPre:ShaderDeferred.spotLight);return e.depthTest=!1,e}():e.isDirectionalLight?function(){var e=me(A?ShaderDeferred.directionalLightPre:ShaderDeferred.directionalLight);return e.depthTest=!1,e}():null;var t}function de(e){var t=A?B:I,i=t[e.uuid];return void 0===i&&((i=Me()).material=ce(e.userData.originalLight),t[e.uuid]=i),i.used=!0,i.material}function pe(e){e.userData.originalLight.isPointLight&&function(e){var t=e.userData.originalLight,i=t.distance;i>0&&(e.scale.set(1,1,1).multiplyScalar(i),e.position.setFromMatrixPosition(t.matrixWorld))}(e)}function fe(e,t){var i=new Mesh(t,L);return i.userData.originalLight=e,i}function me(e){var t=new ShaderMaterial({uniforms:Object.assign({},e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,transparent:!0,blending:AdditiveBlending,depthWrite:!1});return A&&(t.premultipliedAlpha=!0),t}function ve(e){A?e.samplerNormalDepthShininess.value=c.renderTarget2.texture:(e.samplerNormalDepth.value=c.renderTarget2.texture,e.samplerColor.value=o.renderTarget2.texture)}function ge(e,t,i,r,n,o){var a=this.userData.originalLight,s=a.distance,l=n.uniforms;l.lightColor.value.copy(a.color),s>0?(l.lightRadius.value=s,l.lightIntensity.value=a.intensity,l.lightPositionVS.value.setFromMatrixPosition(a.matrixWorld).applyMatrix4(b.matrixWorldInverse)):l.lightRadius.value=1/0,ve(l)}function ye(e,t,i,r,n,o){var a=this.userData.originalLight,s=this.material.uniforms;s.lightAngle.value=a.angle,s.lightColor.value.copy(a.color),s.lightIntensity.value=a.intensity,s.lightPositionVS.value.setFromMatrixPosition(a.matrixWorld).applyMatrix4(b.matrixWorldInverse);var l=s.lightDirectionVS.value,u=N;l.setFromMatrixPosition(a.matrixWorld),u.setFromMatrixPosition(a.target.matrixWorld),l.sub(u).normalize().transformDirection(b.matrixWorldInverse),ve(s)}function _e(e,t,i,r,n,o){var a=this.userData.originalLight,s=this.material.uniforms;s.lightColor.value.copy(a.color),s.lightIntensity.value=a.intensity;var l=s.lightDirectionVS.value,u=N;l.setFromMatrixPosition(a.matrixWorld),u.setFromMatrixPosition(a.target.matrixWorld),l.sub(u).normalize().transformDirection(b.matrixWorldInverse),ve(s)}function be(e){if(void 0!==e.material&&(z[e.uuid]=e.onBeforeRender,!T&&!A&&e.visible))if(Array.isArray(e.material)){for(var t=0,i=e.material.length;t<i;t++)if(!0===e.material[t].visible&&!0===e.material[t].transparent){T=!0;break}}else!0===e.material.visible&&!0===e.material.transparent&&(T=!0)}function xe(e){void 0!==e.material&&(e.onBeforeRender=z[e.uuid])}function we(e){if(!0===e.isLight){var t=F[e.uuid];void 0===t&&((t=Me()).light=he(e),F[e.uuid]=t),t.used=!0;var i=t.light;if(null!==i){var r=!0===e.isPointLight?x:w,n=r.userData.lights;void 0===n[i.uuid]&&(r.add(i),n[i.uuid]={light:i,found:!0}),n[i.uuid].found=!0}}}function Se(e){for(var t=e.userData.lights,i=Object.keys(t),r=0,n=i.length;r<n;r++){var o=i[r];if(!1===t[o].found)e.remove(t[o].light),delete t[o];else{var a=t[o].light;a.material=de(a),pe(a),t[o].found=!1}}}function Me(){return{used:!0,keepAlive:C,count:0}}function Te(e){for(var t=Object.keys(e),i=0,r=t.length;i<r;i++){var n=t[i];!1===e[n].used?(e[n].count++,!1===e[n].keepAlive&&e[n].count>U&&delete e[n]):(e[n].used=!1,e[n].count=0)}}function Ae(e){for(var t=Object.keys(e),i=0,r=t.length;i<r;i++){e[t[i]]=void 0}}function Ce(e,t){!A&&T&&(e.traverse(le),e.traverse(xe),s.scene=e,s.camera=t),A?(s.renderToScreen=!1,s.enabled=!1,l.renderToScreen=!1,l.enabled=!1,M?(g.renderToScreen=!1,y.renderToScreen=!0,y.enabled=!0):(g.renderToScreen=!0,y.renderToScreen=!1,y.enabled=!1)):T?M?(g.renderToScreen=!1,s.renderToScreen=!1,s.enabled=!0,l.renderToScreen=!1,l.enabled=!1,y.renderToScreen=!0,y.enabled=!0):(g.renderToScreen=!1,s.renderToScreen=!1,s.enabled=!0,l.renderToScreen=!0,l.enabled=!0,y.renderToScreen=!1,y.enabled=!1):M?(g.renderToScreen=!1,s.renderToScreen=!1,s.enabled=!1,l.renderToScreen=!1,l.enabled=!1,y.renderToScreen=!0,y.enabled=!0):(g.renderToScreen=!0,s.renderToScreen=!1,s.enabled=!1,l.renderToScreen=!1,l.enabled=!1,y.renderToScreen=!1,y.enabled=!1),S.renderer.autoClearDepth=!1,S.renderer.autoClearStencil=!1,p.render(),!A&&T&&e.traverse(ue)}this.renderer=void 0,this.domElement=void 0,this.forwardRendering=!1,this.setSize=function(e,t){r=e,n=t,this.renderer.setSize(r,n),c.setSize(r,n),o.setSize(r,n),d.setSize(r,n),u.setSize(r,n),p.setSize(r,n),_.image.width=r,_.image.height=n,_.needsUpdate=!0,y.uniforms.resolution.value.set(1/r,1/n)},this.setAntialias=function(e){M=e},this.enableLightPrePass=function(e){A=e,g.uniforms.samplerResult.value=A?u.renderTarget2.texture:d.renderTarget2.texture},this.render=function(e,s){if(this.forwardRendering)this.renderer.render(e,s);else{var l=e.autoUpdate,p=this.renderer.autoClearColor,g=this.renderer.autoClearDepth,y=this.renderer.autoClearStencil;b=s,j(e),e.autoUpdate=!1,e.updateMatrixWorld(),T=!1,e.traverse(be),function(e){var t=ShaderDeferredCommon.commonUniforms;t.viewWidth.value=r,t.viewHeight.value=n,t.matProjInverse.value.getInverse(e.projectionMatrix)}(s),function(e,r){e.traverse(Y),f.scene=e,f.camera=r,S.renderer.autoClearDepth=!0,S.renderer.autoClearStencil=!0,i.buffers.stencil.setTest(!0),i.buffers.stencil.setFunc(t.ALWAYS,1,4294967295),i.buffers.stencil.setOp(t.REPLACE,t.REPLACE,t.REPLACE),c.render(),e.traverse(q)}(e,s),A?(function(e,r){e.traverse(we),Se(x),Se(w),m.scene=x,m.camera=r,v.scene=w,S.renderer.autoClearDepth=!1,S.renderer.autoClearStencil=!1,i.buffers.stencil.setFunc(t.EQUAL,1,4294967295),i.buffers.stencil.setOp(t.KEEP,t.KEEP,t.KEEP),d.render()}(e,s),function(e,t){e.traverse(re),h.scene=e,h.camera=t,S.renderer.autoClearDepth=!1,S.renderer.autoClearStencil=!1,u.render(),i.buffers.stencil.setTest(!1),e.traverse(q)}(e,s)):(function(e,r){e.traverse(J),a.scene=e,a.camera=r,S.renderer.autoClearDepth=!1,S.renderer.autoClearStencil=!1,i.buffers.stencil.setFunc(t.EQUAL,1,4294967295),i.buffers.stencil.setOp(t.KEEP,t.KEEP,t.KEEP),o.render(),e.traverse(q)}(e,s),function(e,t){e.traverse(we),Se(x),Se(w),m.scene=x,m.camera=t,v.scene=w,S.renderer.autoClearDepth=!1,S.renderer.autoClearStencil=!1,d.render(),i.buffers.stencil.setTest(!1)}(e,s)),Ce(e,s),e.traverse(xe),Te(P),Te(k),Te(E),Te(D),Te(O),Te(R),Te(I),Te(B),Te(F),Ae(V),Ae(z),Ae(G),e.autoUpdate=l,this.renderer.autoClearColor=p,this.renderer.autoClearDepth=g,this.renderer.autoClearStencil=y}},function(e){S.renderer=void 0!==e.renderer?e.renderer:new WebGLRenderer,S.domElement=S.renderer.domElement,t=S.renderer.context,i=S.renderer.state,r=void 0!==e.width?e.width:S.renderer.getSize(new Vector2).width,n=void 0!==e.height?e.height:S.renderer.getSize(new Vector2).height;var b=void 0!==e.antialias&&e.antialias;void 0!==e.cacheKeepAlive&&(C=e.cacheKeepAlive),_=new DepthTexture(r,n,UnsignedInt248Type,void 0,void 0,void 0,void 0,void 0,void 0,DepthStencilFormat),function(){(f=new RenderPass).clear=!0;var e=new WebGLRenderTarget(r,n,{minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat,type:FloatType,stencilBuffer:!0,depthTexture:_});e.texture.generateMipamps=!1,(c=new EffectComposer(S.renderer,e)).addPass(f)}(),function(){(a=new RenderPass).clear=!0;var e=new WebGLRenderTarget(r,n,{minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat,type:FloatType,depthTexture:_});e.texture.generateMipamps=!1,(o=new EffectComposer(S.renderer,e)).addPass(a)}(),function(){(v=new RenderPass).clear=!0,v.camera=new OrthographicCamera(-1,1,1,-1,0,1),(m=new RenderPass).clear=!1;var e=new WebGLRenderTarget(r,n,{minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat,type:FloatType,depthTexture:_});e.texture.generateMipamps=!1,(d=new EffectComposer(S.renderer,e)).addPass(v),d.addPass(m)}(),function(){(h=new RenderPass).clear=!0;var e=new WebGLRenderTarget(r,n,{minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat,type:FloatType,depthTexture:_});e.texture.generateMipamps=!1,(u=new EffectComposer(S.renderer,e)).addPass(h)}(),function(){(g=new ShaderPass(ShaderDeferred.final)).clear=!0,g.uniforms.samplerResult.value=d.renderTarget2.texture,g.material.blending=NoBlending,g.material.depthWrite=!1,g.material.depthTest=!1,(s=new RenderPass).clear=!1,l=new ShaderPass(CopyShader),y=new ShaderPass(FXAAShader);var e=new WebGLRenderTarget(r,n,{minFilter:NearestFilter,magFilter:LinearFilter,format:RGBFormat,type:UnsignedByteType,depthTexture:_});e.texture.generateMipamps=!1,(p=new EffectComposer(S.renderer,e)).addPass(g),p.addPass(s),p.addPass(l),p.addPass(y)}(),S.setSize(r,n),S.setAntialias(b),S.enableLightPrePass(!1)}(e)},DeferredShaderChunk={packVector3:["float vec3_to_float( vec3 data ) {","\tconst float unit = 255.0/256.0;","\thighp float compressed = fract( data.x * unit ) + floor( data.y * unit * 255.0 ) + floor( data.z * unit * 255.0 ) * 255.0;","\treturn compressed;","}"].join("\n"),unpackFloat:["vec3 float_to_vec3( float data ) {","\tconst float unit = 255.0;","\tvec3 uncompressed;","\tuncompressed.x = fract( data );","\tfloat zInt = floor( data / unit );","\tuncompressed.z = fract( zInt / unit );","\tuncompressed.y = fract( floor( data - ( zInt * unit ) ) / unit );","\treturn uncompressed;","}"].join("\n"),packNormal:["vec2 normal_to_vec2( vec3 normal ) {","\treturn normal.xy / sqrt( normal.z * 8.0 + 8.0 ) + 0.5;","}"].join("\n"),unpackVector2:["vec3 vec2_to_normal( vec2 data ) {","\tvec2 fenc = data * 4.0 - 2.0;","\tfloat f = dot( fenc, fenc );","\tfloat g = sqrt( 1.0 - f / 4.0 );","\tvec3 normal;","\tnormal.xy = fenc * g;","\tnormal.z = 1.0 - f / 2.0;","\treturn normal;","}"].join("\n"),computeTextureCoord:["vec2 texCoord = gl_FragCoord.xy / vec2( viewWidth, viewHeight );"].join("\n"),packNormalDepth:["vec4 packedNormalDepth;","packedNormalDepth.xyz = normal * 0.5 + 0.5;","packedNormalDepth.w = position.z / position.w;"].join("\n"),unpackNormalDepth:["vec4 normalDepthMap = texture2D( samplerNormalDepth, texCoord );","float depth = normalDepthMap.w;","if ( depth == 0.0 ) discard;","vec3 normal = normalDepthMap.xyz * 2.0 - 1.0;"].join("\n"),packNormalDepthShininess:["vec4 packedNormalDepthShininess;","packedNormalDepthShininess.xy = normal_to_vec2( normal );","packedNormalDepthShininess.z = shininess;","packedNormalDepthShininess.w = position.z / position.w;"].join("\n"),unpackNormalDepthShininess:["vec4 normalDepthMap = texture2D( samplerNormalDepthShininess, texCoord );","float depth = normalDepthMap.w;","if ( depth == 0.0 ) discard;","vec3 normal = vec2_to_normal( normalDepthMap.xy );","float shininess = normalDepthMap.z;"].join("\n"),packColor:["vec4 packedColor;","packedColor.x = vec3_to_float( diffuseColor.rgb );","packedColor.y = vec3_to_float( emissiveColor );","packedColor.z = vec3_to_float( specularColor );","packedColor.w = shininess;"].join("\n"),unpackColor:["vec4 colorMap = texture2D( samplerColor, texCoord );","vec3 diffuseColor = float_to_vec3( colorMap.x );","vec3 emissiveColor = float_to_vec3( colorMap.y );","vec3 specularColor = float_to_vec3( colorMap.z );","float shininess = colorMap.w;"].join("\n"),packLight:["vec4 packedLight;","packedLight.xyz = lightIntensity * lightColor * max( dot( lightVector, normal ), 0.0 ) * attenuation;","packedLight.w = lightIntensity * specular * max( dot( lightVector, normal ), 0.0 ) * attenuation;"].join("\n"),computeVertexPositionVS:["vec2 xy = texCoord * 2.0 - 1.0;","vec4 vertexPositionProjected = vec4( xy, depth, 1.0 );","vec4 vertexPositionVS = matProjInverse * vertexPositionProjected;","vertexPositionVS.xyz /= vertexPositionVS.w;","vertexPositionVS.w = 1.0;"].join("\n"),computeSpecular:["vec3 halfVector = normalize( lightVector - normalize( vertexPositionVS.xyz ) );","float dotNormalHalf = max( dot( normal, halfVector ), 0.0 );","float specular = 0.31830988618 * ( shininess * 0.5 + 1.0 ) * pow( dotNormalHalf, shininess );"].join("\n"),combine:["gl_FragColor = vec4( lightIntensity * lightColor * max( dot( lightVector, normal ), 0.0 ) * ( diffuseColor + specular * specularColor ) * attenuation, 1.0 );"].join("\n")},ShaderDeferredCommon={commonUniforms:{matProjInverse:new Uniform(new Matrix4),viewWidth:new Uniform(800),viewHeight:new Uniform(600)}},ShaderDeferred={normalDepth:{uniforms:{},vertexShader:["varying vec3 vNormal;","varying vec4 vPosition;","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","\tvNormal = normalize( transformedNormal );","\tvPosition = gl_Position;","}"].join("\n"),fragmentShader:["varying vec3 vNormal;","varying vec4 vPosition;","void main() {","\tvec3 normal = vNormal;","\tvec4 position = vPosition;",DeferredShaderChunk.packNormalDepth,"\tgl_FragColor = packedNormalDepth;","}"].join("\n")},color:{uniforms:{map:new Uniform(null),offsetRepeat:new Uniform(new Vector4(0,0,1,1)),diffuse:new Uniform(new Color(0)),emissive:new Uniform(new Color(0)),specular:new Uniform(new Color(0)),shininess:new Uniform(30)},vertexShader:["#include <uv_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <uv_vertex>","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","#include <uv_pars_fragment>","#include <map_pars_fragment>",DeferredShaderChunk.packVector3,"void main() {","\tvec4 diffuseColor = vec4( diffuse, 1.0 );","\tvec3 emissiveColor = emissive;","\tvec3 specularColor = specular;","#include <map_fragment>",DeferredShaderChunk.packColor,"\tgl_FragColor = packedColor;","}"].join("\n")},emissiveLight:{uniforms:Object.assign({samplerColor:new Uniform(null)},ShaderDeferredCommon.commonUniforms),vertexShader:["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;",DeferredShaderChunk.unpackFloat,"void main() {",DeferredShaderChunk.computeTextureCoord,DeferredShaderChunk.unpackColor,"\tgl_FragColor = vec4( emissiveColor, 1.0 );","}"].join("\n")},pointLight:{uniforms:Object.assign({samplerNormalDepth:new Uniform(null),samplerColor:new Uniform(null),lightColor:new Uniform(new Color(0)),lightPositionVS:new Uniform(new Vector3(0,1,0)),lightIntensity:new Uniform(1),lightRadius:new Uniform(1)},ShaderDeferredCommon.commonUniforms),vertexShader:["void main() {","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D samplerNormalDepth;","uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform float lightIntensity;","uniform float lightRadius;","uniform mat4 matProjInverse;",DeferredShaderChunk.unpackFloat,"void main() {",DeferredShaderChunk.computeTextureCoord,DeferredShaderChunk.unpackNormalDepth,DeferredShaderChunk.computeVertexPositionVS,"\tvec3 lightVector = lightPositionVS - vertexPositionVS.xyz;","\tfloat distance = length( lightVector );","\tif ( distance > lightRadius ) discard;","\tlightVector = normalize( lightVector );",DeferredShaderChunk.unpackColor,DeferredShaderChunk.computeSpecular,"\t//float cutoff = 0.3;","\t//float denom = distance / lightRadius + 1.0;","\t//float attenuation = 1.0 / ( denom * denom );","\t//attenuation = ( attenuation - cutoff ) / ( 1.0 - cutoff );","\t//attenuation = max( attenuation, 0.0 );","\t//attenuation *= attenuation;","\t//diffuseColor *= saturate( -distance / lightRadius + 1.0 );","\t//float attenuation = 1.0;","\tfloat attenuation = saturate( -distance / lightRadius + 1.0 );",DeferredShaderChunk.combine,"}"].join("\n")},spotLight:{uniforms:Object.assign({samplerNormalDepth:new Uniform(null),samplerColor:new Uniform(null),lightColor:new Uniform(new Color(0)),lightDirectionVS:new Uniform(new Vector3(0,1,0)),lightPositionVS:new Uniform(new Vector3(0,1,0)),lightAngle:new Uniform(1),lightIntensity:new Uniform(1)},ShaderDeferredCommon.commonUniforms),vertexShader:["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D samplerNormalDepth;","uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform vec3 lightDirectionVS;","uniform float lightAngle;","uniform float lightIntensity;","uniform mat4 matProjInverse;",DeferredShaderChunk.unpackFloat,"void main() {",DeferredShaderChunk.computeTextureCoord,DeferredShaderChunk.unpackNormalDepth,DeferredShaderChunk.computeVertexPositionVS,DeferredShaderChunk.unpackColor,"\tvec3 lightVector = normalize( lightPositionVS.xyz - vertexPositionVS.xyz );","\tfloat rho = dot( lightDirectionVS, lightVector );","\tfloat rhoMax = cos( lightAngle );","\tif ( rho <= rhoMax ) discard;","\tfloat theta = rhoMax + 0.0001;","\tfloat phi = rhoMax + 0.05;","\tfloat falloff = 4.0;","\tfloat spot = 0.0;","\tif ( rho >= phi ) {","\t\tspot = 1.0;","\t} else if ( rho <= theta ) {","\t\tspot = 0.0;","\t} else { ","\t\tspot = pow( ( rho - theta ) / ( phi - theta ), falloff );","\t}","\tdiffuseColor *= spot;",DeferredShaderChunk.computeSpecular,"\tconst float attenuation = 1.0;",DeferredShaderChunk.combine,"}"].join("\n")},directionalLight:{uniforms:Object.assign({samplerNormalDepth:new Uniform(null),samplerColor:new Uniform(null),lightColor:new Uniform(new Color(0)),lightDirectionVS:new Uniform(new Vector3(0,1,0)),lightIntensity:new Uniform(1)},ShaderDeferredCommon.commonUniforms),vertexShader:["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D samplerNormalDepth;","uniform sampler2D samplerColor;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightDirectionVS;","uniform float lightIntensity;","uniform mat4 matProjInverse;",DeferredShaderChunk.unpackFloat,"void main() {",DeferredShaderChunk.computeTextureCoord,DeferredShaderChunk.unpackNormalDepth,DeferredShaderChunk.computeVertexPositionVS,DeferredShaderChunk.unpackColor,"\tvec3 lightVector = normalize( lightDirectionVS );",DeferredShaderChunk.computeSpecular,"\tconst float attenuation = 1.0;",DeferredShaderChunk.combine,"}"].join("\n")},normalDepthShininess:{uniforms:{shininess:new Uniform(30)},vertexShader:["varying vec3 vNormal;","varying vec4 vPosition;","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","\tvNormal = normalize( transformedNormal );","\tvPosition = gl_Position;","}"].join("\n"),fragmentShader:["varying vec3 vNormal;","varying vec4 vPosition;","uniform float shininess;",DeferredShaderChunk.packNormal,"void main() {","\tvec3 normal = vNormal;","\tvec4 position = vPosition;",DeferredShaderChunk.packNormalDepthShininess,"\tgl_FragColor = packedNormalDepthShininess;","}"].join("\n")},pointLightPre:{uniforms:Object.assign({samplerNormalDepthShininess:new Uniform(null),lightColor:new Uniform(new Color(0)),lightPositionVS:new Uniform(new Vector3(0,1,0)),lightIntensity:new Uniform(1),lightRadius:new Uniform(1)},ShaderDeferredCommon.commonUniforms),vertexShader:["void main() {","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D samplerNormalDepthShininess;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform float lightIntensity;","uniform float lightRadius;","uniform mat4 matProjInverse;",DeferredShaderChunk.unpackFloat,DeferredShaderChunk.unpackVector2,"void main() {",DeferredShaderChunk.computeTextureCoord,DeferredShaderChunk.unpackNormalDepthShininess,DeferredShaderChunk.computeVertexPositionVS,"\tvec3 lightVector = lightPositionVS - vertexPositionVS.xyz;","\tfloat distance = length( lightVector );","\tif ( distance > lightRadius ) discard;","\tlightVector = normalize( lightVector );",DeferredShaderChunk.computeSpecular,"\tfloat attenuation = saturate( -distance / lightRadius + 1.0 );",DeferredShaderChunk.packLight,"\tgl_FragColor = packedLight;","}"].join("\n")},spotLightPre:{uniforms:Object.assign({samplerNormalDepthShininess:new Uniform(null),lightColor:new Uniform(new Color(0)),lightDirectionVS:new Uniform(new Vector3(0,1,0)),lightPositionVS:new Uniform(new Vector3(0,1,0)),lightAngle:new Uniform(1),lightIntensity:new Uniform(1)},ShaderDeferredCommon.commonUniforms),vertexShader:["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D samplerNormalDepthShininess;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightPositionVS;","uniform vec3 lightDirectionVS;","uniform float lightAngle;","uniform float lightIntensity;","uniform mat4 matProjInverse;",DeferredShaderChunk.unpackFloat,DeferredShaderChunk.unpackVector2,"void main() {",DeferredShaderChunk.computeTextureCoord,DeferredShaderChunk.unpackNormalDepthShininess,DeferredShaderChunk.computeVertexPositionVS,"\tvec3 lightVector = normalize( lightPositionVS.xyz - vertexPositionVS.xyz );","\tfloat rho = dot( lightDirectionVS, lightVector );","\tfloat rhoMax = cos( lightAngle );","\tif ( rho <= rhoMax ) discard;","\tfloat theta = rhoMax + 0.0001;","\tfloat phi = rhoMax + 0.05;","\tfloat falloff = 4.0;","\tfloat spot = 0.0;","\tif ( rho >= phi ) {","\t\tspot = 1.0;","\t} else if ( rho <= theta ) {","\t\tspot = 0.0;","\t} else { ","\t\tspot = pow( ( rho - theta ) / ( phi - theta ), falloff );","\t}",DeferredShaderChunk.computeSpecular,"\tconst float attenuation = 1.0;",DeferredShaderChunk.packLight,"\tgl_FragColor = spot * packedLight;","}"].join("\n")},directionalLightPre:{uniforms:Object.assign({samplerNormalDepthShininess:new Uniform(null),lightColor:new Uniform(new Color(0)),lightDirectionVS:new Uniform(new Vector3(0,1,0)),lightIntensity:new Uniform(1)},ShaderDeferredCommon.commonUniforms),vertexShader:["void main() { ","\tgl_Position = vec4( sign( position.xy ), 0.0, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D samplerNormalDepthShininess;","uniform float viewHeight;","uniform float viewWidth;","uniform vec3 lightColor;","uniform vec3 lightDirectionVS;","uniform float lightIntensity;","uniform mat4 matProjInverse;",DeferredShaderChunk.unpackFloat,DeferredShaderChunk.unpackVector2,"void main() {",DeferredShaderChunk.computeTextureCoord,DeferredShaderChunk.unpackNormalDepthShininess,DeferredShaderChunk.computeVertexPositionVS,"\tvec3 lightVector = normalize( lightDirectionVS );",DeferredShaderChunk.computeSpecular,"\tconst float attenuation = 1.0;",DeferredShaderChunk.packLight,"\tgl_FragColor = packedLight;","}"].join("\n")},reconstruction:{uniforms:Object.assign({samplerLight:new Uniform(null),map:new Uniform(null),offsetRepeat:new Uniform(new Vector4(0,0,1,1)),diffuse:new Uniform(new Color(0)),emissive:new Uniform(new Color(0)),specular:new Uniform(new Color(0)),shininess:new Uniform(30)},ShaderDeferredCommon.commonUniforms),vertexShader:["#include <uv_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","void main() {","#include <uv_vertex>","#include <begin_vertex>","#include <beginnormal_vertex>","#include <skinbase_vertex>","#include <skinnormal_vertex>","#include <defaultnormal_vertex>","#include <morphtarget_vertex>","#include <skinning_vertex>","#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D samplerLight;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float viewHeight;","uniform float viewWidth;","#include <uv_pars_fragment>","#include <map_pars_fragment>",DeferredShaderChunk.unpackFloat,"void main() {","\tvec4 diffuseColor = vec4( diffuse, 1.0 );","\tvec3 emissiveColor = emissive;","\tvec3 specularColor = specular;",DeferredShaderChunk.computeTextureCoord,"\tvec4 light = texture2D( samplerLight, texCoord );","#include <map_fragment>","\tvec3 diffuseFinal = diffuseColor.rgb * light.rgb;","\tvec3 emissiveFinal = emissiveColor;","\tvec3 specularFinal = specularColor * light.rgb * light.a;","\tgl_FragColor = vec4( diffuseFinal + emissiveFinal + specularFinal, 1.0 );","}"].join("\n")},final:{uniforms:{samplerResult:new Uniform(null)},vertexShader:["varying vec2 texCoord;","void main() {","\tvec4 pos = vec4( sign( position.xy ), 0.0, 1.0 );","\ttexCoord = pos.xy * vec2( 0.5 ) + 0.5;","\tgl_Position = pos;","}"].join("\n"),fragmentShader:["varying vec2 texCoord;","uniform sampler2D samplerResult;","void main() {","\tgl_FragColor = texture2D( samplerResult, texCoord );","}"].join("\n")}};function RollerCoasterGeometry(e,t){BufferGeometry.call(this);var i=[],r=[],n=[],o=[1,1,1],a=[1,1,0],s=new Vector3(0,1,0),l=new Vector3,u=new Vector3,h=new Quaternion,c=new Quaternion;c.setFromAxisAngle(s,Math.PI/2);var d=new Vector3,p=new Vector3;p.copy(e.getPointAt(0));for(var f=[new Vector3(-.225,0,0),new Vector3(0,-.05,0),new Vector3(0,-.175,0),new Vector3(0,-.05,0),new Vector3(.225,0,0),new Vector3(0,-.175,0)],m=2*Math.PI,v=5,g=[],y=0;y<v;y++){var _=y/v*m;g.push(new Vector3(.06*Math.sin(_),.06*Math.cos(_),0))}v=6;var b=[];for(y=0;y<v;y++){_=y/v*m;b.push(new Vector3(.025*Math.sin(_),.025*Math.cos(_),0))}var x=new Vector3,w=new Vector3;function S(e,t){w.set(0,0,-1).applyQuaternion(h);for(var o=0;o<e.length;o++)x.copy(e[o]),x.applyQuaternion(h),x.add(d),i.push(x.x,x.y,x.z),r.push(w.x,w.y,w.z),n.push(t[0],t[1],t[2]);w.set(0,0,1).applyQuaternion(h);for(o=e.length-1;o>=0;o--)x.copy(e[o]),x.applyQuaternion(h),x.add(d),i.push(x.x,x.y,x.z),r.push(w.x,w.y,w.z),n.push(t[0],t[1],t[2])}var M=new Vector3,T=new Vector3,A=new Vector3,C=new Vector3,L=new Vector3,N=new Vector3,P=new Vector3,k=new Vector3;function E(e,t,o){for(var a=0,s=e.length;a<s;a++){var l=e[a],u=e[(a+1)%s];M.copy(l).add(t),M.applyQuaternion(h),M.add(d),T.copy(u).add(t),T.applyQuaternion(h),T.add(d),A.copy(u).add(t),A.applyQuaternion(c),A.add(p),C.copy(l).add(t),C.applyQuaternion(c),C.add(p),i.push(M.x,M.y,M.z),i.push(T.x,T.y,T.z),i.push(C.x,C.y,C.z),i.push(T.x,T.y,T.z),i.push(A.x,A.y,A.z),i.push(C.x,C.y,C.z),L.copy(l),L.applyQuaternion(h),L.normalize(),N.copy(u),N.applyQuaternion(h),N.normalize(),P.copy(u),P.applyQuaternion(c),P.normalize(),k.copy(l),k.applyQuaternion(c),k.normalize(),r.push(L.x,L.y,L.z),r.push(N.x,N.y,N.z),r.push(k.x,k.y,k.z),r.push(N.x,N.y,N.z),r.push(P.x,P.y,P.z),r.push(k.x,k.y,k.z),n.push(o[0],o[1],o[2]),n.push(o[0],o[1],o[2]),n.push(o[0],o[1],o[2]),n.push(o[0],o[1],o[2]),n.push(o[0],o[1],o[2]),n.push(o[0],o[1],o[2])}}var D=new Vector3;for(y=1;y<=t;y++){d.copy(e.getPointAt(y/t)),s.set(0,1,0),l.subVectors(d,p).normalize(),u.crossVectors(s,l).normalize(),s.crossVectors(l,u);_=Math.atan2(l.x,l.z);h.setFromAxisAngle(s,_),y%2==0&&S(f,a),E(g,D.set(0,-.125,0),a),E(b,D.set(.2,0,0),o),E(b,D.set(-.2,0,0),o),p.copy(d),c.copy(h)}this.addAttribute("position",new BufferAttribute(new Float32Array(i),3)),this.addAttribute("normal",new BufferAttribute(new Float32Array(r),3)),this.addAttribute("color",new BufferAttribute(new Float32Array(n),3))}function RollerCoasterLiftersGeometry(e,t){BufferGeometry.call(this);var i=[],r=[],n=new Quaternion,o=new Vector3(0,1,0),a=new Vector3,s=new Vector3,l=[new Vector3(0,.05,-.05),new Vector3(0,.05,.05),new Vector3(0,-.05,0)],u=[new Vector3(-.05,0,.05),new Vector3(-.05,0,-.05),new Vector3(.05,0,0)],h=[new Vector3(.05,0,-.05),new Vector3(.05,0,.05),new Vector3(-.05,0,0)],c=new Vector3,d=new Vector3,p=new Vector3,f=new Vector3,m=new Vector3,v=new Vector3,g=new Vector3,y=new Vector3;function _(e,t,o){for(var a=0,s=e.length;a<s;a++){var l=e[a],u=e[(a+1)%s];c.copy(l),c.applyQuaternion(n),c.add(t),d.copy(u),d.applyQuaternion(n),d.add(t),p.copy(u),p.applyQuaternion(n),p.add(o),f.copy(l),f.applyQuaternion(n),f.add(o),i.push(c.x,c.y,c.z),i.push(d.x,d.y,d.z),i.push(f.x,f.y,f.z),i.push(d.x,d.y,d.z),i.push(p.x,p.y,p.z),i.push(f.x,f.y,f.z),m.copy(l),m.applyQuaternion(n),m.normalize(),v.copy(u),v.applyQuaternion(n),v.normalize(),g.copy(u),g.applyQuaternion(n),g.normalize(),y.copy(l),y.applyQuaternion(n),y.normalize(),r.push(m.x,m.y,m.z),r.push(v.x,v.y,v.z),r.push(y.x,y.y,y.z),r.push(v.x,v.y,v.z),r.push(g.x,g.y,g.z),r.push(y.x,y.y,y.z)}}for(var b=new Vector3,x=new Vector3,w=1;w<=t;w++){a.copy(e.getPointAt(w/t)),s.copy(e.getTangentAt(w/t));var S=Math.atan2(s.x,s.z);n.setFromAxisAngle(o,S),a.y>10?(b.set(-.75,-.35,0),b.applyQuaternion(n),b.add(a),x.set(.75,-.35,0),x.applyQuaternion(n),x.add(a),_(l,b,x),b.set(-.7,-.3,0),b.applyQuaternion(n),b.add(a),x.set(-.7,-a.y,0),x.applyQuaternion(n),x.add(a),_(u,b,x),b.set(.7,-.3,0),b.applyQuaternion(n),b.add(a),x.set(.7,-a.y,0),x.applyQuaternion(n),x.add(a),_(h,b,x)):(b.set(0,-.2,0),b.applyQuaternion(n),b.add(a),x.set(0,-a.y,0),x.applyQuaternion(n),x.add(a),_(h,b,x))}this.addAttribute("position",new BufferAttribute(new Float32Array(i),3)),this.addAttribute("normal",new BufferAttribute(new Float32Array(r),3))}function RollerCoasterShadowGeometry(e,t){BufferGeometry.call(this);var i=[],r=new Vector3(0,1,0),n=new Vector3,o=new Quaternion,a=new Quaternion;a.setFromAxisAngle(r,Math.PI/2);var s=new Vector3,l=new Vector3;l.copy(e.getPointAt(0)),l.y=0;for(var u=new Vector3,h=new Vector3,c=new Vector3,d=new Vector3,p=1;p<=t;p++){s.copy(e.getPointAt(p/t)),s.y=0,n.subVectors(s,l);var f=Math.atan2(n.x,n.z);o.setFromAxisAngle(r,f),u.set(-.3,0,0),u.applyQuaternion(o),u.add(s),h.set(.3,0,0),h.applyQuaternion(o),h.add(s),c.set(.3,0,0),c.applyQuaternion(a),c.add(l),d.set(-.3,0,0),d.applyQuaternion(a),d.add(l),i.push(u.x,u.y,u.z),i.push(h.x,h.y,h.z),i.push(d.x,d.y,d.z),i.push(h.x,h.y,h.z),i.push(c.x,c.y,c.z),i.push(d.x,d.y,d.z),l.copy(s),a.copy(o)}this.addAttribute("position",new BufferAttribute(new Float32Array(i),3))}function SkyGeometry(){BufferGeometry.call(this);for(var e=[],t=0;t<100;t++){var i=800*Math.random()-400,r=50*Math.random()+50,n=800*Math.random()-400,o=40*Math.random()+20;e.push(i-o,r,n-o),e.push(i+o,r,n-o),e.push(i-o,r,n+o),e.push(i+o,r,n-o),e.push(i+o,r,n+o),e.push(i-o,r,n+o)}this.addAttribute("position",new BufferAttribute(new Float32Array(e),3))}function TreesGeometry(e){BufferGeometry.call(this);var t=[],i=[],r=new Raycaster;r.ray.direction.set(0,-1,0);for(var n=0;n<2e3;n++){var o=500*Math.random()-250,a=500*Math.random()-250;r.ray.origin.set(o,50,a);var s=r.intersectObject(e);if(0!==s.length){var l=s[0].point.y,u=5*Math.random()+.5,h=Math.random()*Math.PI*2;t.push(o+Math.sin(h),l,a+Math.cos(h)),t.push(o,l+u,a),t.push(o+Math.sin(h+Math.PI),l,a+Math.cos(h+Math.PI)),h+=Math.PI/2,t.push(o+Math.sin(h),l,a+Math.cos(h)),t.push(o,l+u,a),t.push(o+Math.sin(h+Math.PI),l,a+Math.cos(h+Math.PI));for(var c=.1*Math.random(),d=0;d<6;d++)i.push(.2+c,.4+c,0)}}this.addAttribute("position",new BufferAttribute(new Float32Array(t),3)),this.addAttribute("color",new BufferAttribute(new Float32Array(i),3))}RollerCoasterGeometry.prototype=Object.create(BufferGeometry.prototype),RollerCoasterLiftersGeometry.prototype=Object.create(BufferGeometry.prototype),RollerCoasterShadowGeometry.prototype=Object.create(BufferGeometry.prototype),SkyGeometry.prototype=Object.create(BufferGeometry.prototype),TreesGeometry.prototype=Object.create(BufferGeometry.prototype);var ShaderGodRays={godrays_depthMask:{uniforms:{tInput:{value:null}},vertexShader:["varying vec2 vUv;","void main() {"," vUv = uv;"," gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tInput;","void main() {","\tgl_FragColor = vec4( 1.0 ) - texture2D( tInput, vUv );","}"].join("\n")},godrays_generate:{uniforms:{tInput:{value:null},fStepSize:{value:1},vSunPositionScreenSpace:{value:new Vector2(.5,.5)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define TAPS_PER_PASS 6.0","varying vec2 vUv;","uniform sampler2D tInput;","uniform vec2 vSunPositionScreenSpace;","uniform float fStepSize;","void main() {","vec2 delta = vSunPositionScreenSpace - vUv;","float dist = length( delta );","vec2 stepv = fStepSize * delta / dist;","float iters = dist/fStepSize;","vec2 uv = vUv.xy;","float col = 0.0;","if ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","if ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r;","uv += stepv;","gl_FragColor = vec4( col/TAPS_PER_PASS );","gl_FragColor.a = 1.0;","}"].join("\n")},godrays_combine:{uniforms:{tColors:{value:null},tGodRays:{value:null},fGodRayIntensity:{value:.69},vSunPositionScreenSpace:{value:new Vector2(.5,.5)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform sampler2D tColors;","uniform sampler2D tGodRays;","uniform vec2 vSunPositionScreenSpace;","uniform float fGodRayIntensity;","void main() {","gl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );","gl_FragColor.a = 1.0;","}"].join("\n")},godrays_fake_sun:{uniforms:{vSunPositionScreenSpace:{value:new Vector2(.5,.5)},fAspect:{value:1},sunColor:{value:new Color(16772608)},bgColor:{value:new Color(0)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","uniform vec2 vSunPositionScreenSpace;","uniform float fAspect;","uniform vec3 sunColor;","uniform vec3 bgColor;","void main() {","vec2 diff = vUv - vSunPositionScreenSpace;","diff.x *= fAspect;","float prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );","prop = 0.35 * pow( 1.0 - prop, 3.0 );","gl_FragColor.xyz = mix( sunColor, bgColor, 1.0 - prop );","gl_FragColor.w = 1.0;","}"].join("\n")}},BasicShader={uniforms:{},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["void main() {","gl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );","}"].join("\n")},BleachBypassShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 base = texture2D( tDiffuse, vUv );","vec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","float lum = dot( lumCoeff, base.rgb );","vec3 blend = vec3( lum );","float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","vec3 result1 = 2.0 * base.rgb * blend;","vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","vec3 newColor = mix( result1, result2, L );","float A2 = opacity * base.a;","vec3 mixRGB = A2 * newColor.rgb;","mixRGB += ( ( 1.0 - A2 ) * base.rgb );","gl_FragColor = vec4( mixRGB, base.a );","}"].join("\n")},BlendShader={uniforms:{tDiffuse1:{value:null},tDiffuse2:{value:null},mixRatio:{value:.5},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform float mixRatio;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tDiffuse1, vUv );","vec4 texel2 = texture2D( tDiffuse2, vUv );","gl_FragColor = opacity * mix( texel1, texel2, mixRatio );","}"].join("\n")},BrightnessContrastShader={uniforms:{tDiffuse:{value:null},brightness:{value:0},contrast:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float brightness;","uniform float contrast;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","gl_FragColor.rgb += brightness;","if (contrast > 0.0) {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;","} else {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;","}","}"].join("\n")},ColorCorrectionShader={uniforms:{tDiffuse:{value:null},powRGB:{value:new Vector3(2,2,2)},mulRGB:{value:new Vector3(1,1,1)},addRGB:{value:new Vector3(0,0,0)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 powRGB;","uniform vec3 mulRGB;","uniform vec3 addRGB;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","gl_FragColor.rgb = mulRGB * pow( ( gl_FragColor.rgb + addRGB ), powRGB );","}"].join("\n")},ColorifyShader={uniforms:{tDiffuse:{value:null},color:{value:new Color(16777215)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","gl_FragColor = vec4( v * color, texel.w );","}"].join("\n")},DOFMipMapShader={uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},maxblur:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float focus;","uniform float maxblur;","uniform sampler2D tColor;","uniform sampler2D tDepth;","varying vec2 vUv;","void main() {","vec4 depth = texture2D( tDepth, vUv );","float factor = depth.x - focus;","vec4 col = texture2D( tColor, vUv, 2.0 * maxblur * abs( focus - depth.x ) );","gl_FragColor = col;","gl_FragColor.a = 1.0;","}"].join("\n")},FocusShader={uniforms:{tDiffuse:{value:null},screenWidth:{value:1024},screenHeight:{value:1024},sampleDistance:{value:.94},waveFactor:{value:.00125}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float screenWidth;","uniform float screenHeight;","uniform float sampleDistance;","uniform float waveFactor;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color, org, tmp, add;","float sample_dist, f;","vec2 vin;","vec2 uv = vUv;","add = color = org = texture2D( tDiffuse, uv );","vin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );","sample_dist = dot( vin, vin ) * 2.0;","f = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;","vec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );","add += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","add += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );","if( tmp.b < color.b ) color = tmp;","color = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );","color = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );","gl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );","}"].join("\n")},FreiChenShader={uniforms:{tDiffuse:{value:null},aspect:{value:new Vector2(512,512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform vec2 aspect;","vec2 texel = vec2(1.0 / aspect.x, 1.0 / aspect.y);","mat3 G[9];","const mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );","const mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );","const mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );","const mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );","const mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );","const mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );","const mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );","const mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );","const mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );","void main(void)","{","G[0] = g0,","G[1] = g1,","G[2] = g2,","G[3] = g3,","G[4] = g4,","G[5] = g5,","G[6] = g6,","G[7] = g7,","G[8] = g8;","mat3 I;","float cnv[9];","vec3 sample;","for (float i=0.0; i<3.0; i++) {","for (float j=0.0; j<3.0; j++) {","sample = texture2D(tDiffuse, vUv + texel * vec2(i-1.0,j-1.0) ).rgb;","I[int(i)][int(j)] = length(sample);","}","}","for (int i=0; i<9; i++) {","float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);","cnv[i] = dp3 * dp3;","}","float M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);","float S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);","gl_FragColor = vec4(vec3(sqrt(M/S)), 1.0);","}"].join("\n")},FresnelShader={uniforms:{mRefractionRatio:{value:1.02},mFresnelBias:{value:.1},mFresnelPower:{value:2},mFresnelScale:{value:1},tCube:{value:null}},vertexShader:["uniform float mRefractionRatio;","uniform float mFresnelBias;","uniform float mFresnelScale;","uniform float mFresnelPower;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","vec3 I = worldPosition.xyz - cameraPosition;","vReflect = reflect( I, worldNormal );","vRefract[0] = refract( normalize( I ), worldNormal, mRefractionRatio );","vRefract[1] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.99 );","vRefract[2] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.98 );","vReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), mFresnelPower );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","vec4 refractedColor = vec4( 1.0 );","refractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;","refractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;","refractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;","gl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );","}"].join("\n")},GammaCorrectionShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );","gl_FragColor = LinearToGamma( tex, float( GAMMA_FACTOR ) );","}"].join("\n")},HorizontalBlurShader={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},HorizontalTiltShiftShader={uniforms:{tDiffuse:{value:null},h:{value:1/512},r:{value:.35}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float hh = h * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},HueSaturationShader={uniforms:{tDiffuse:{value:null},hue:{value:0},saturation:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float hue;","uniform float saturation;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","float angle = hue * 3.14159265;","float s = sin(angle), c = cos(angle);","vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;","float len = length(gl_FragColor.rgb);","gl_FragColor.rgb = vec3(","dot(gl_FragColor.rgb, weights.xyz),","dot(gl_FragColor.rgb, weights.zxy),","dot(gl_FragColor.rgb, weights.yzx)",");","float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;","if (saturation > 0.0) {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - saturation));","} else {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-saturation);","}","}"].join("\n")},KaleidoShader={uniforms:{tDiffuse:{value:null},sides:{value:6},angle:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float sides;","uniform float angle;","varying vec2 vUv;","void main() {","vec2 p = vUv - 0.5;","float r = length(p);","float a = atan(p.y, p.x) + angle;","float tau = 2. * 3.1416 ;","a = mod(a, tau/sides);","a = abs(a - tau/sides/2.) ;","p = r * vec2(cos(a), sin(a));","vec4 color = texture2D(tDiffuse, p + 0.5);","gl_FragColor = color;","}"].join("\n")},MirrorShader={uniforms:{tDiffuse:{value:null},side:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform int side;","varying vec2 vUv;","void main() {","vec2 p = vUv;","if (side == 0){","if (p.x > 0.5) p.x = 1.0 - p.x;","}else if (side == 1){","if (p.x < 0.5) p.x = 1.0 - p.x;","}else if (side == 2){","if (p.y < 0.5) p.y = 1.0 - p.y;","}else if (side == 3){","if (p.y > 0.5) p.y = 1.0 - p.y;","} ","vec4 color = texture2D(tDiffuse, p);","gl_FragColor = color;","}"].join("\n")},NormalMapShader={uniforms:{heightMap:{value:null},resolution:{value:new Vector2(512,512)},scale:{value:new Vector2(1,1)},height:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float height;","uniform vec2 resolution;","uniform sampler2D heightMap;","varying vec2 vUv;","void main() {","float val = texture2D( heightMap, vUv ).x;","float valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;","float valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;","gl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );","}"].join("\n")},ParallaxShader={modes:{none:"NO_PARALLAX",basic:"USE_BASIC_PARALLAX",steep:"USE_STEEP_PARALLAX",occlusion:"USE_OCLUSION_PARALLAX",relief:"USE_RELIEF_PARALLAX"},uniforms:{bumpMap:{value:null},map:{value:null},parallaxScale:{value:null},parallaxMinLayers:{value:null},parallaxMaxLayers:{value:null}},vertexShader:["varying vec2 vUv;","varying vec3 vViewPosition;","varying vec3 vNormal;","void main() {","vUv = uv;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform sampler2D bumpMap;","uniform sampler2D map;","uniform float parallaxScale;","uniform float parallaxMinLayers;","uniform float parallaxMaxLayers;","varying vec2 vUv;","varying vec3 vViewPosition;","varying vec3 vNormal;","#ifdef USE_BASIC_PARALLAX","vec2 parallaxMap( in vec3 V ) {","float initialHeight = texture2D( bumpMap, vUv ).r;","vec2 texCoordOffset = parallaxScale * V.xy * initialHeight;","return vUv - texCoordOffset;","}","#else","vec2 parallaxMap( in vec3 V ) {","float numLayers = mix( parallaxMaxLayers, parallaxMinLayers, abs( dot( vec3( 0.0, 0.0, 1.0 ), V ) ) );","float layerHeight = 1.0 / numLayers;","float currentLayerHeight = 0.0;","vec2 dtex = parallaxScale * V.xy / V.z / numLayers;","vec2 currentTextureCoords = vUv;","float heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","for ( int i = 0; i < 30; i += 1 ) {","if ( heightFromTexture <= currentLayerHeight ) {","break;","}","currentLayerHeight += layerHeight;","currentTextureCoords -= dtex;","heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","}","#ifdef USE_STEEP_PARALLAX","return currentTextureCoords;","#elif defined( USE_RELIEF_PARALLAX )","vec2 deltaTexCoord = dtex / 2.0;","float deltaHeight = layerHeight / 2.0;","currentTextureCoords += deltaTexCoord;","currentLayerHeight -= deltaHeight;","const int numSearches = 5;","for ( int i = 0; i < numSearches; i += 1 ) {","deltaTexCoord /= 2.0;","deltaHeight /= 2.0;","heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;","if( heightFromTexture > currentLayerHeight ) {","currentTextureCoords -= deltaTexCoord;","currentLayerHeight += deltaHeight;","} else {","currentTextureCoords += deltaTexCoord;","currentLayerHeight -= deltaHeight;","}","}","return currentTextureCoords;","#elif defined( USE_OCLUSION_PARALLAX )","vec2 prevTCoords = currentTextureCoords + dtex;","float nextH = heightFromTexture - currentLayerHeight;","float prevH = texture2D( bumpMap, prevTCoords ).r - currentLayerHeight + layerHeight;","float weight = nextH / ( nextH - prevH );","return prevTCoords * weight + currentTextureCoords * ( 1.0 - weight );","#else","return vUv;","#endif","}","#endif","vec2 perturbUv( vec3 surfPosition, vec3 surfNormal, vec3 viewPosition ) {","vec2 texDx = dFdx( vUv );","vec2 texDy = dFdy( vUv );","vec3 vSigmaX = dFdx( surfPosition );","vec3 vSigmaY = dFdy( surfPosition );","vec3 vR1 = cross( vSigmaY, surfNormal );","vec3 vR2 = cross( surfNormal, vSigmaX );","float fDet = dot( vSigmaX, vR1 );","vec2 vProjVscr = ( 1.0 / fDet ) * vec2( dot( vR1, viewPosition ), dot( vR2, viewPosition ) );","vec3 vProjVtex;","vProjVtex.xy = texDx * vProjVscr.x + texDy * vProjVscr.y;","vProjVtex.z = dot( surfNormal, viewPosition );","return parallaxMap( vProjVtex );","}","void main() {","vec2 mapUv = perturbUv( -vViewPosition, normalize( vNormal ), normalize( vViewPosition ) );","gl_FragColor = texture2D( map, mapUv );","}"].join("\n")},PixelShader={uniforms:{tDiffuse:{value:null},resolution:{value:null},pixelSize:{value:1}},vertexShader:["varying highp vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float pixelSize;","uniform vec2 resolution;","varying highp vec2 vUv;","void main(){","vec2 dxy = pixelSize / resolution;","vec2 coord = dxy * floor( vUv / dxy );","gl_FragColor = texture2D(tDiffuse, coord);","}"].join("\n")},RGBShiftShader={uniforms:{tDiffuse:{value:null},amount:{value:.005},angle:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float amount;","uniform float angle;","varying vec2 vUv;","void main() {","vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, vUv + offset);","vec4 cga = texture2D(tDiffuse, vUv);","vec4 cb = texture2D(tDiffuse, vUv - offset);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","}"].join("\n")},SepiaShader={uniforms:{tDiffuse:{value:null},amount:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color = texture2D( tDiffuse, vUv );","vec3 c = color.rgb;","color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );","color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );","color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );","gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );","}"].join("\n")},SobelOperatorShader={uniforms:{tDiffuse:{value:null},resolution:{value:new Vector2}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","vec2 texel = vec2( 1.0 / resolution.x, 1.0 / resolution.y );","const mat3 Gx = mat3( -1, -2, -1, 0, 0, 0, 1, 2, 1 );","const mat3 Gy = mat3( -1, 0, 1, -2, 0, 2, -1, 0, 1 );","float tx0y0 = texture2D( tDiffuse, vUv + texel * vec2( -1, -1 ) ).r;","float tx0y1 = texture2D( tDiffuse, vUv + texel * vec2( -1,  0 ) ).r;","float tx0y2 = texture2D( tDiffuse, vUv + texel * vec2( -1,  1 ) ).r;","float tx1y0 = texture2D( tDiffuse, vUv + texel * vec2(  0, -1 ) ).r;","float tx1y1 = texture2D( tDiffuse, vUv + texel * vec2(  0,  0 ) ).r;","float tx1y2 = texture2D( tDiffuse, vUv + texel * vec2(  0,  1 ) ).r;","float tx2y0 = texture2D( tDiffuse, vUv + texel * vec2(  1, -1 ) ).r;","float tx2y1 = texture2D( tDiffuse, vUv + texel * vec2(  1,  0 ) ).r;","float tx2y2 = texture2D( tDiffuse, vUv + texel * vec2(  1,  1 ) ).r;","float valueGx = Gx[0][0] * tx0y0 + Gx[1][0] * tx1y0 + Gx[2][0] * tx2y0 + ","Gx[0][1] * tx0y1 + Gx[1][1] * tx1y1 + Gx[2][1] * tx2y1 + ","Gx[0][2] * tx0y2 + Gx[1][2] * tx1y2 + Gx[2][2] * tx2y2; ","float valueGy = Gy[0][0] * tx0y0 + Gy[1][0] * tx1y0 + Gy[2][0] * tx2y0 + ","Gy[0][1] * tx0y1 + Gy[1][1] * tx1y1 + Gy[2][1] * tx2y1 + ","Gy[0][2] * tx0y2 + Gy[1][2] * tx1y2 + Gy[2][2] * tx2y2; ","float G = sqrt( ( valueGx * valueGx ) + ( valueGy * valueGy ) );","gl_FragColor = vec4( vec3( G ), 1 );","}"].join("\n")},TechnicolorShader={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );","vec4 newTex = vec4(tex.r, (tex.g + tex.b) * .5, (tex.g + tex.b) * .5, 1.0);","gl_FragColor = newTex;","}"].join("\n")},TriangleBlurShader={uniforms:{texture:{value:null},delta:{value:new Vector2(1,1)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <common>","#define ITERATIONS 10.0","uniform sampler2D texture;","uniform vec2 delta;","varying vec2 vUv;","void main() {","vec4 color = vec4( 0.0 );","float total = 0.0;","float offset = rand( vUv );","for ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {","float percent = ( t + offset - 0.5 ) / ITERATIONS;","float weight = 1.0 - abs( percent );","color += texture2D( texture, vUv + delta * percent ) * weight;","total += weight;","}","gl_FragColor = color / total;","}"].join("\n")},VerticalBlurShader={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},VerticalTiltShiftShader={uniforms:{tDiffuse:{value:null},v:{value:1/512},r:{value:.35}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float vv = v * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},VignetteShader={uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n")},VolumeRenderShader1={uniforms:{u_size:{value:new Vector3(1,1,1)},u_renderstyle:{value:0},u_renderthreshold:{value:.5},u_clim:{value:new Vector2(1,1)},u_data:{value:null},u_cmdata:{value:null}},vertexShader:["varying vec4 v_nearpos;","varying vec4 v_farpos;","varying vec3 v_position;","mat4 inversemat(mat4 m) {","float","a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],","a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],","a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],","a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],","b00 = a00 * a11 - a01 * a10,","b01 = a00 * a12 - a02 * a10,","b02 = a00 * a13 - a03 * a10,","b03 = a01 * a12 - a02 * a11,","b04 = a01 * a13 - a03 * a11,","b05 = a02 * a13 - a03 * a12,","b06 = a20 * a31 - a21 * a30,","b07 = a20 * a32 - a22 * a30,","b08 = a20 * a33 - a23 * a30,","b09 = a21 * a32 - a22 * a31,","b10 = a21 * a33 - a23 * a31,","b11 = a22 * a33 - a23 * a32,","det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;","return mat4(","a11 * b11 - a12 * b10 + a13 * b09,","a02 * b10 - a01 * b11 - a03 * b09,","a31 * b05 - a32 * b04 + a33 * b03,","a22 * b04 - a21 * b05 - a23 * b03,","a12 * b08 - a10 * b11 - a13 * b07,","a00 * b11 - a02 * b08 + a03 * b07,","a32 * b02 - a30 * b05 - a33 * b01,","a20 * b05 - a22 * b02 + a23 * b01,","a10 * b10 - a11 * b08 + a13 * b06,","a01 * b08 - a00 * b10 - a03 * b06,","a30 * b04 - a31 * b02 + a33 * b00,","a21 * b02 - a20 * b04 - a23 * b00,","a11 * b07 - a10 * b09 - a12 * b06,","a00 * b09 - a01 * b07 + a02 * b06,","a31 * b01 - a30 * b03 - a32 * b00,","a20 * b03 - a21 * b01 + a22 * b00) / det;","}","void main() {","mat4 viewtransformf = viewMatrix;","mat4 viewtransformi = inversemat(viewMatrix);","vec4 position4 = vec4(position, 1.0);","vec4 pos_in_cam = viewtransformf * position4;","pos_in_cam.z = -pos_in_cam.w;","v_nearpos = viewtransformi * pos_in_cam;","pos_in_cam.z = pos_in_cam.w;","v_farpos = viewtransformi * pos_in_cam;","v_position = position;","gl_Position = projectionMatrix * viewMatrix * modelMatrix * position4;","}"].join("\n"),fragmentShader:["precision highp float;","precision mediump sampler3D;","uniform vec3 u_size;","uniform int u_renderstyle;","uniform float u_renderthreshold;","uniform vec2 u_clim;","uniform sampler3D u_data;","uniform sampler2D u_cmdata;","varying vec3 v_position;","varying vec4 v_nearpos;","varying vec4 v_farpos;","const int MAX_STEPS = 887;  // 887 for 512^3, 1774 for 1024^3","const int REFINEMENT_STEPS = 4;","const float relative_step_size = 1.0;","const vec4 ambient_color = vec4(0.2, 0.4, 0.2, 1.0);","const vec4 diffuse_color = vec4(0.8, 0.2, 0.2, 1.0);","const vec4 specular_color = vec4(1.0, 1.0, 1.0, 1.0);","const float shininess = 40.0;","void cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);","void cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);","float sample1(vec3 texcoords);","vec4 apply_colormap(float val);","vec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray);","void main() {","vec3 farpos = v_farpos.xyz / v_farpos.w;","vec3 nearpos = v_nearpos.xyz / v_nearpos.w;","vec3 view_ray = normalize(nearpos.xyz - farpos.xyz);","float distance = dot(nearpos - v_position, view_ray);","distance = max(distance, min((-0.5 - v_position.x) / view_ray.x,","(u_size.x - 0.5 - v_position.x) / view_ray.x));","distance = max(distance, min((-0.5 - v_position.y) / view_ray.y,","(u_size.y - 0.5 - v_position.y) / view_ray.y));","distance = max(distance, min((-0.5 - v_position.z) / view_ray.z,","(u_size.z - 0.5 - v_position.z) / view_ray.z));","vec3 front = v_position + view_ray * distance;","int nsteps = int(-distance / relative_step_size + 0.5);","if ( nsteps < 1 )","discard;","vec3 step = ((v_position - front) / u_size) / float(nsteps);","vec3 start_loc = front / u_size;","if (u_renderstyle == 0)","cast_mip(start_loc, step, nsteps, view_ray);","else if (u_renderstyle == 1)","cast_iso(start_loc, step, nsteps, view_ray);","if (gl_FragColor.a < 0.05)","discard;","}","float sample1(vec3 texcoords) {","","return texture(u_data, texcoords.xyz).r;","}","vec4 apply_colormap(float val) {","val = (val - u_clim[0]) / (u_clim[1] - u_clim[0]);","return texture2D(u_cmdata, vec2(val, 0.5));","}","void cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {","float max_val = -1e6;","int max_i = 100;","vec3 loc = start_loc;","for (int iter=0; iter<MAX_STEPS; iter++) {","if (iter >= nsteps)","break;","float val = sample1(loc);","if (val > max_val) {","max_val = val;","max_i = iter;","}","loc += step;","}","vec3 iloc = start_loc + step * (float(max_i) - 0.5);","vec3 istep = step / float(REFINEMENT_STEPS);","for (int i=0; i<REFINEMENT_STEPS; i++) {","max_val = max(max_val, sample1(iloc));","iloc += istep;","}","gl_FragColor = apply_colormap(max_val);","}","void cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {","gl_FragColor = vec4(0.0);  // init transparent","vec4 color3 = vec4(0.0);  // final color","vec3 dstep = 1.5 / u_size;  // step to sample derivative","vec3 loc = start_loc;","float low_threshold = u_renderthreshold - 0.02 * (u_clim[1] - u_clim[0]);","for (int iter=0; iter<MAX_STEPS; iter++) {","if (iter >= nsteps)","break;","float val = sample1(loc);","if (val > low_threshold) {","vec3 iloc = loc - 0.5 * step;","vec3 istep = step / float(REFINEMENT_STEPS);","for (int i=0; i<REFINEMENT_STEPS; i++) {","val = sample1(iloc);","if (val > u_renderthreshold) {","gl_FragColor = add_lighting(val, iloc, dstep, view_ray);","return;","}","iloc += istep;","}","}","loc += step;","}","}","vec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray)","{","vec3 V = normalize(view_ray);","vec3 N;","float val1, val2;","val1 = sample1(loc + vec3(-step[0], 0.0, 0.0));","val2 = sample1(loc + vec3(+step[0], 0.0, 0.0));","N[0] = val1 - val2;","val = max(max(val1, val2), val);","val1 = sample1(loc + vec3(0.0, -step[1], 0.0));","val2 = sample1(loc + vec3(0.0, +step[1], 0.0));","N[1] = val1 - val2;","val = max(max(val1, val2), val);","val1 = sample1(loc + vec3(0.0, 0.0, -step[2]));","val2 = sample1(loc + vec3(0.0, 0.0, +step[2]));","N[2] = val1 - val2;","val = max(max(val1, val2), val);","float gm = length(N); // gradient magnitude","N = normalize(N);","float Nselect = float(dot(N, V) > 0.0);","N = (2.0 * Nselect - 1.0) * N;  // ==  Nselect * N - (1.0-Nselect)*N;","vec4 ambient_color = vec4(0.0, 0.0, 0.0, 0.0);","vec4 diffuse_color = vec4(0.0, 0.0, 0.0, 0.0);","vec4 specular_color = vec4(0.0, 0.0, 0.0, 0.0);","for (int i=0; i<1; i++)","{","vec3 L = normalize(view_ray);  //lightDirs[i];","float lightEnabled = float( length(L) > 0.0 );","L = normalize(L + (1.0 - lightEnabled));","float lambertTerm = clamp(dot(N, L), 0.0, 1.0);","vec3 H = normalize(L+V); // Halfway vector","float specularTerm = pow(max(dot(H, N), 0.0), shininess);","float mask1 = lightEnabled;","ambient_color +=  mask1 * ambient_color;  // * gl_LightSource[i].ambient;","diffuse_color +=  mask1 * lambertTerm;","specular_color += mask1 * specularTerm * specular_color;","}","vec4 final_color;","vec4 color = apply_colormap(val);","final_color = color * (ambient_color + diffuse_color) + specular_color;","final_color.a = color.a;","return final_color;","}"].join("\n")},WaterRefractionShader={uniforms:{color:{type:"c",value:null},time:{type:"f",value:0},tDiffuse:{type:"t",value:null},tDudv:{type:"t",value:null},textureMatrix:{type:"m4",value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec2 vUv;","varying vec4 vUvRefraction;","void main() {","\tvUv = uv;","\tvUvRefraction = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform float time;","uniform sampler2D tDiffuse;","uniform sampler2D tDudv;","varying vec2 vUv;","varying vec4 vUvRefraction;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ),blendOverlay( base.b, blend.b ) );","}","void main() {"," float waveStrength = 0.1;"," float waveSpeed = 0.03;","\tvec2 distortedUv = texture2D( tDudv, vec2( vUv.x + time * waveSpeed, vUv.y ) ).rg * waveStrength;","\tdistortedUv = vUv.xy + vec2( distortedUv.x, distortedUv.y + time * waveSpeed );","\tvec2 distortion = ( texture2D( tDudv, distortedUv ).rg * 2.0 - 1.0 ) * waveStrength;"," vec4 uv = vec4( vUvRefraction );"," uv.xy += distortion;","\tvec4 base = texture2DProj( tDiffuse, uv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")},ShaderSkin={skinSimple:{uniforms:UniformsUtils.merge([UniformsLib.fog,UniformsLib.lights,{enableBump:{value:0},enableSpecular:{value:0},tDiffuse:{value:null},tBeckmann:{value:null},diffuse:{value:new Color(15658734)},specular:{value:new Color(1118481)},opacity:{value:1},uRoughness:{value:.15},uSpecularBrightness:{value:.75},bumpMap:{value:null},bumpScale:{value:1},specularMap:{value:null},offsetRepeat:{value:new Vector4(0,0,1,1)},uWrapRGB:{value:new Vector3(.75,.375,.1875)}}]),fragmentShader:["#define USE_BUMPMAP","uniform bool enableBump;","uniform bool enableSpecular;","uniform vec3 diffuse;","uniform vec3 specular;","uniform float opacity;","uniform float uRoughness;","uniform float uSpecularBrightness;","uniform vec3 uWrapRGB;","uniform sampler2D tDiffuse;","uniform sampler2D tBeckmann;","uniform sampler2D specularMap;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",ShaderChunk.common,ShaderChunk.bsdfs,ShaderChunk.packing,ShaderChunk.lights_pars_begin,ShaderChunk.fog_pars_fragment,ShaderChunk.bumpmap_pars_fragment,"float fresnelReflectance( vec3 H, vec3 V, float F0 ) {","float base = 1.0 - dot( V, H );","float exponential = pow( base, 5.0 );","return exponential + F0 * ( 1.0 - exponential );","}","float KS_Skin_Specular( vec3 N,","vec3 L,","vec3 V,","float m,","float rho_s",") {","float result = 0.0;","float ndotl = dot( N, L );","if( ndotl > 0.0 ) {","vec3 h = L + V;","vec3 H = normalize( h );","float ndoth = dot( N, H );","float PH = pow( 2.0 * texture2D( tBeckmann, vec2( ndoth, m ) ).x, 10.0 );","float F = fresnelReflectance( H, V, 0.028 );","float frSpec = max( PH * F / dot( h, h ), 0.0 );","result = ndotl * rho_s * frSpec;","}","return result;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );","vec4 diffuseColor = vec4( diffuse, opacity );","vec4 colDiffuse = texture2D( tDiffuse, vUv );","colDiffuse.rgb *= colDiffuse.rgb;","diffuseColor = diffuseColor * colDiffuse;","vec3 normal = normalize( vNormal );","vec3 viewerDirection = normalize( vViewPosition );","float specularStrength;","if ( enableSpecular ) {","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","} else {","specularStrength = 1.0;","}","#ifdef USE_BUMPMAP","if ( enableBump ) normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","vec3 totalSpecularLight = vec3( 0.0 );","vec3 totalDiffuseLight = vec3( 0.0 );","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 lVector = pointLights[ i ].position + vViewPosition.xyz;","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","lVector = normalize( lVector );","float pointDiffuseWeightFull = max( dot( normal, lVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, lVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), uWrapRGB );","float pointSpecularWeight = KS_Skin_Specular( normal, lVector, viewerDirection, uRoughness, uSpecularBrightness );","totalDiffuseLight += pointLight[ i ].color * ( pointDiffuseWeight * attenuation );","totalSpecularLight += pointLight[ i ].color * specular * ( pointSpecularWeight * specularStrength * attenuation );","}","#endif","#if NUM_DIR_LIGHTS > 0","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","float dirDiffuseWeightFull = max( dot( normal, dirVector ), 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3 ( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), uWrapRGB );","float dirSpecularWeight = KS_Skin_Specular( normal, dirVector, viewerDirection, uRoughness, uSpecularBrightness );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","totalSpecularLight += directionalLights[ i ].color * ( dirSpecularWeight * specularStrength );","}","#endif","#if NUM_HEMI_LIGHTS > 0","for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","vec3 lVector = hemisphereLightDirection[ i ];","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","totalDiffuseLight += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","hemiSpecularWeight += KS_Skin_Specular( normal, lVector, viewerDirection, uRoughness, uSpecularBrightness );","vec3 lVectorGround = -lVector;","hemiSpecularWeight += KS_Skin_Specular( normal, lVectorGround, viewerDirection, uRoughness, uSpecularBrightness );","vec3 hemiSpecularColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","totalSpecularLight += hemiSpecularColor * specular * ( hemiSpecularWeight * specularStrength );","}","#endif","outgoingLight += diffuseColor.xyz * ( totalDiffuseLight + ambientLightColor * diffuse ) + totalSpecularLight;","gl_FragColor = linearToOutputTexel( vec4( outgoingLight, diffuseColor.a ) );",ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["uniform vec4 offsetRepeat;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",ShaderChunk.common,ShaderChunk.lights_pars_begin,ShaderChunk.fog_pars_vertex,"void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","gl_Position = projectionMatrix * mvPosition;",ShaderChunk.fog_vertex,"}"].join("\n")},skin:{uniforms:UniformsUtils.merge([UniformsLib.fog,UniformsLib.lights,{passID:{value:0},tDiffuse:{value:null},tNormal:{value:null},tBlur1:{value:null},tBlur2:{value:null},tBlur3:{value:null},tBlur4:{value:null},tBeckmann:{value:null},uNormalScale:{value:1},diffuse:{value:new Color(15658734)},specular:{value:new Color(1118481)},opacity:{value:1},uRoughness:{value:.15},uSpecularBrightness:{value:.75}}]),fragmentShader:["uniform vec3 diffuse;","uniform vec3 specular;","uniform float opacity;","uniform float uRoughness;","uniform float uSpecularBrightness;","uniform int passID;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tBlur1;","uniform sampler2D tBlur2;","uniform sampler2D tBlur3;","uniform sampler2D tBlur4;","uniform sampler2D tBeckmann;","uniform float uNormalScale;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",ShaderChunk.common,ShaderChunk.lights_pars_begin,ShaderChunk.fog_pars_fragment,"float fresnelReflectance( vec3 H, vec3 V, float F0 ) {","float base = 1.0 - dot( V, H );","float exponential = pow( base, 5.0 );","return exponential + F0 * ( 1.0 - exponential );","}","float KS_Skin_Specular( vec3 N,","vec3 L,","vec3 V,","float m,","float rho_s",") {","float result = 0.0;","float ndotl = dot( N, L );","if( ndotl > 0.0 ) {","vec3 h = L + V;","vec3 H = normalize( h );","float ndoth = dot( N, H );","float PH = pow( 2.0 * texture2D( tBeckmann, vec2( ndoth, m ) ).x, 10.0 );","float F = fresnelReflectance( H, V, 0.028 );","float frSpec = max( PH * F / dot( h, h ), 0.0 );","result = ndotl * rho_s * frSpec;","}","return result;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );","vec4 diffuseColor = vec4( diffuse, opacity );","vec4 mSpecular = vec4( specular, opacity );","vec4 colDiffuse = texture2D( tDiffuse, vUv );","colDiffuse *= colDiffuse;","diffuseColor *= colDiffuse;","vec4 posAndU = vec4( -vViewPosition, vUv.x );","vec4 posAndU_dx = dFdx( posAndU ),  posAndU_dy = dFdy( posAndU );","vec3 tangent = posAndU_dx.w * posAndU_dx.xyz + posAndU_dy.w * posAndU_dy.xyz;","vec3 normal = normalize( vNormal );","vec3 binormal = normalize( cross( tangent, normal ) );","tangent = cross( normal, binormal );","mat3 tsb = mat3( tangent, binormal, normal );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","vec3 finalNormal = tsb * normalTex;","normal = normalize( finalNormal );","vec3 viewerDirection = normalize( vViewPosition );","vec3 totalDiffuseLight = vec3( 0.0 );","vec3 totalSpecularLight = vec3( 0.0 );","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 pointVector = normalize( pointLights[ i ].direction );","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","totalDiffuseLight += pointLightColor[ i ] * ( pointDiffuseWeight * attenuation );","if ( passID == 1 ) {","float pointSpecularWeight = KS_Skin_Specular( normal, pointVector, viewerDirection, uRoughness, uSpecularBrightness );","totalSpecularLight += pointLightColor[ i ] * mSpecular.xyz * ( pointSpecularWeight * attenuation );","}","}","#endif","#if NUM_DIR_LIGHTS > 0","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","if ( passID == 1 ) {","float dirSpecularWeight = KS_Skin_Specular( normal, dirVector, viewerDirection, uRoughness, uSpecularBrightness );","totalSpecularLight += directionalLights[ i ].color * mSpecular.xyz * dirSpecularWeight;","}","}","#endif","outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalSpecularLight );","if ( passID == 0 ) {","outgoingLight = sqrt( outgoingLight );","} else if ( passID == 1 ) {","#ifdef VERSION1","vec3 nonblurColor = sqrt(outgoingLight );","#else","vec3 nonblurColor = outgoingLight;","#endif","vec3 blur1Color = texture2D( tBlur1, vUv ).xyz;","vec3 blur2Color = texture2D( tBlur2, vUv ).xyz;","vec3 blur3Color = texture2D( tBlur3, vUv ).xyz;","vec3 blur4Color = texture2D( tBlur4, vUv ).xyz;","outgoingLight = vec3( vec3( 0.22,  0.437, 0.635 ) * nonblurColor + ","vec3( 0.101, 0.355, 0.365 ) * blur1Color + ","vec3( 0.119, 0.208, 0.0 )   * blur2Color + ","vec3( 0.114, 0.0,   0.0 )   * blur3Color + ","vec3( 0.444, 0.0,   0.0 )   * blur4Color );","outgoingLight *= sqrt( colDiffuse.xyz );","outgoingLight += ambientLightColor * diffuse * colDiffuse.xyz + totalSpecularLight;","#ifndef VERSION1","outgoingLight = sqrt( outgoingLight );","#endif","}","gl_FragColor = vec4( outgoingLight, diffuseColor.a );",ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",ShaderChunk.common,ShaderChunk.fog_pars_vertex,"void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv;","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;","gl_Position = projectionMatrix * displacedPosition;","#else","gl_Position = projectionMatrix * mvPosition;","#endif",ShaderChunk.fog_vertex,"}"].join("\n"),vertexShaderUV:["varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",ShaderChunk.common,"void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","vNormal = normalize( normalMatrix * normal );","vUv = uv;","gl_Position = vec4( uv.x * 2.0 - 1.0, uv.y * 2.0 - 1.0, 0.0, 1.0 );","}"].join("\n")},beckmann:{uniforms:{},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec2 vUv;","float PHBeckmann( float ndoth, float m ) {","float alpha = acos( ndoth );","float ta = tan( alpha );","float val = 1.0 / ( m * m * pow( ndoth, 4.0 ) ) * exp( -( ta * ta ) / ( m * m ) );","return val;","}","float KSTextureCompute( vec2 tex ) {","return 0.5 * pow( PHBeckmann( tex.x, tex.y ), 0.1 );","}","void main() {","float x = KSTextureCompute( vUv );","gl_FragColor = vec4( x, x, x, 1.0 );","}"].join("\n")}},ShaderTerrain={terrain:{uniforms:UniformsUtils.merge([UniformsLib.fog,UniformsLib.lights,{enableDiffuse1:{value:0},enableDiffuse2:{value:0},enableSpecular:{value:0},enableReflection:{value:0},tDiffuse1:{value:null},tDiffuse2:{value:null},tDetail:{value:null},tNormal:{value:null},tSpecular:{value:null},tDisplacement:{value:null},uNormalScale:{value:1},uDisplacementBias:{value:0},uDisplacementScale:{value:1},diffuse:{value:new Color(15658734)},specular:{value:new Color(1118481)},shininess:{value:30},opacity:{value:1},uRepeatBase:{value:new Vector2(1,1)},uRepeatOverlay:{value:new Vector2(1,1)},uOffset:{value:new Vector2(0,0)}}]),fragmentShader:["uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse1;","uniform bool enableDiffuse2;","uniform bool enableSpecular;","uniform sampler2D tDiffuse1;","uniform sampler2D tDiffuse2;","uniform sampler2D tDetail;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tDisplacement;","uniform float uNormalScale;","uniform vec2 uRepeatOverlay;","uniform vec2 uRepeatBase;","uniform vec2 uOffset;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",ShaderChunk.common,ShaderChunk.bsdfs,ShaderChunk.lights_pars_begin,ShaderChunk.shadowmap_pars_fragment,ShaderChunk.fog_pars_fragment,"float calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {","if ( decayExponent > 0.0 ) {","return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );","}","return 1.0;","}","void main() {","vec3 outgoingLight = vec3( 0.0 );","vec4 diffuseColor = vec4( diffuse, opacity );","vec3 specularTex = vec3( 1.0 );","vec2 uvOverlay = uRepeatOverlay * vUv + uOffset;","vec2 uvBase = uRepeatBase * vUv;","vec3 normalTex = texture2D( tDetail, uvOverlay ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse1 && enableDiffuse2 ) {","vec4 colDiffuse1 = texture2D( tDiffuse1, uvOverlay );","vec4 colDiffuse2 = texture2D( tDiffuse2, uvOverlay );","colDiffuse1 = GammaToLinear( colDiffuse1, float( GAMMA_FACTOR ) );","colDiffuse2 = GammaToLinear( colDiffuse2, float( GAMMA_FACTOR ) );","diffuseColor *= mix ( colDiffuse1, colDiffuse2, 1.0 - texture2D( tDisplacement, uvBase ) );"," } else if( enableDiffuse1 ) {","diffuseColor *= texture2D( tDiffuse1, uvOverlay );","} else if( enableDiffuse2 ) {","diffuseColor *= texture2D( tDiffuse2, uvOverlay );","}","if( enableSpecular )","specularTex = texture2D( tSpecular, uvOverlay ).xyz;","mat3 tsb = mat3( vTangent, vBinormal, vNormal );","vec3 finalNormal = tsb * normalTex;","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","vec3 totalDiffuseLight = vec3( 0.0 );","vec3 totalSpecularLight = vec3( 0.0 );","#if NUM_POINT_LIGHTS > 0","for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","vec3 lVector = pointLights[ i ].position + vViewPosition.xyz;","float attenuation = calcLightAttenuation( length( lVector ), pointLights[ i ].distance, pointLights[ i ].decay );","lVector = normalize( lVector );","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointDiffuseWeight = max( dot( normal, lVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","totalDiffuseLight += attenuation * pointLights[ i ].color * pointDiffuseWeight;","totalSpecularLight += attenuation * pointLights[ i ].color * specular * pointSpecularWeight * pointDiffuseWeight;","}","#endif","#if NUM_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < NUM_DIR_LIGHTS; i++ ) {","vec3 dirVector = directionalLights[ i ].direction;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","totalDiffuseLight += directionalLights[ i ].color * dirDiffuseWeight;","totalSpecularLight += directionalLights[ i ].color * specular * dirSpecularWeight * dirDiffuseWeight;","}","#endif","#if NUM_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","vec3 lVector = hemisphereLightDirection[ i ];","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","totalDiffuseLight += mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight );","float hemiSpecularWeight = 0.0;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","hemiSpecularWeight += specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","totalSpecularLight += specular * mix( hemisphereLights[ i ].groundColor, hemisphereLights[ i ].skyColor, hemiDiffuseWeight ) * hemiSpecularWeight * hemiDiffuseWeight;","}","#endif","outgoingLight += diffuseColor.xyz * ( totalDiffuseLight + ambientLightColor + totalSpecularLight );","gl_FragColor = vec4( outgoingLight, diffuseColor.a );",ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uRepeatBase;","uniform sampler2D tNormal;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",ShaderChunk.shadowmap_pars_vertex,ShaderChunk.fog_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","vBinormal = cross( vNormal, vTangent ) * tangent.w;","vBinormal = normalize( vBinormal );","vUv = uv;","vec2 uvBase = uv * uRepeatBase;","#ifdef VERTEX_TEXTURES","vec3 dv = texture2D( tDisplacement, uvBase ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","vec3 displacedPosition = normal * df + position;","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","#else","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;","vViewPosition = -mvPosition.xyz;","vec3 normalTex = texture2D( tNormal, uvBase ).xyz * 2.0 - 1.0;","vNormal = normalMatrix * normalTex;",ShaderChunk.shadowmap_vertex,ShaderChunk.fog_vertex,"}"].join("\n")}},ShaderToon={toon1:{uniforms:{uDirLightPos:{value:new Vector3},uDirLightColor:{value:new Color(15658734)},uAmbientLightColor:{value:new Color(328965)},uBaseColor:{value:new Color(16777215)}},vertexShader:["varying vec3 vNormal;","varying vec3 vRefract;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec3 worldNormal = normalize ( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","vNormal = normalize( normalMatrix * normal );","vec3 I = worldPosition.xyz - cameraPosition;","vRefract = refract( normalize( I ), worldNormal, 1.02 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","varying vec3 vRefract;","void main() {","float directionalLightWeighting = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","float intensity = smoothstep( - 0.5, 1.0, pow( length(lightWeighting), 20.0 ) );","intensity += length(lightWeighting) * 0.2;","float cameraWeighting = dot( normalize( vNormal ), vRefract );","intensity += pow( 1.0 - length( cameraWeighting ), 6.0 );","intensity = intensity * 0.2 + 0.3;","if ( intensity < 0.50 ) {","gl_FragColor = vec4( 2.0 * intensity * uBaseColor, 1.0 );","} else {","gl_FragColor = vec4( 1.0 - 2.0 * ( 1.0 - intensity ) * ( 1.0 - uBaseColor ), 1.0 );","}","}"].join("\n")},toon2:{uniforms:{uDirLightPos:{value:new Vector3},uDirLightColor:{value:new Color(15658734)},uAmbientLightColor:{value:new Color(328965)},uBaseColor:{value:new Color(15658734)},uLineColor1:{value:new Color(8421504)},uLineColor2:{value:new Color(0)},uLineColor3:{value:new Color(0)},uLineColor4:{value:new Color(0)}},vertexShader:["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float camera = max( dot( normalize( vNormal ), vec3( 0.0, 0.0, 1.0 ) ), 0.4);","float light = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(uAmbientLightColor + uDirLightColor * light) < 1.00 ) {","gl_FragColor *= vec4( uLineColor1, 1.0 );","}","if ( length(uAmbientLightColor + uDirLightColor * camera) < 0.50 ) {","gl_FragColor *= vec4( uLineColor2, 1.0 );","}","}"].join("\n")},hatching:{uniforms:{uDirLightPos:{value:new Vector3},uDirLightColor:{value:new Color(15658734)},uAmbientLightColor:{value:new Color(328965)},uBaseColor:{value:new Color(16777215)},uLineColor1:{value:new Color(0)},uLineColor2:{value:new Color(0)},uLineColor3:{value:new Color(0)},uLineColor4:{value:new Color(0)}},vertexShader:["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(lightWeighting) < 1.00 ) {","if ( mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","if ( length(lightWeighting) < 0.75 ) {","if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor2, 1.0 );","}","}","if ( length(lightWeighting) < 0.50 ) {","if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor3, 1.0 );","}","}","if ( length(lightWeighting) < 0.3465 ) {","if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","gl_FragColor = vec4( uLineColor4, 1.0 );","}","}","}"].join("\n")},dotted:{uniforms:{uDirLightPos:{value:new Vector3},uDirLightColor:{value:new Color(15658734)},uAmbientLightColor:{value:new Color(328965)},uBaseColor:{value:new Color(16777215)},uLineColor1:{value:new Color(0)}},vertexShader:["varying vec3 vNormal;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","}"].join("\n"),fragmentShader:["uniform vec3 uBaseColor;","uniform vec3 uLineColor1;","uniform vec3 uLineColor2;","uniform vec3 uLineColor3;","uniform vec3 uLineColor4;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform vec3 uAmbientLightColor;","varying vec3 vNormal;","void main() {","float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);","vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;","gl_FragColor = vec4( uBaseColor, 1.0 );","if ( length(lightWeighting) < 1.00 ) {","if ( ( mod(gl_FragCoord.x, 4.001) + mod(gl_FragCoord.y, 4.0) ) > 6.00 ) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","if ( length(lightWeighting) < 0.50 ) {","if ( ( mod(gl_FragCoord.x + 2.0, 4.001) + mod(gl_FragCoord.y + 2.0, 4.0) ) > 6.00 ) {","gl_FragColor = vec4( uLineColor1, 1.0 );","}","}","}"].join("\n")}},TranslucentShader=function(){this.uniforms=UniformsUtils.merge([UniformsLib.common,UniformsLib.lights,{color:{value:new Color(16777215)},diffuse:{value:new Color(16777215)},specular:{value:new Color(16777215)},emissive:{value:new Color(0)},opacity:{value:1},shininess:{value:1},thicknessMap:{value:null},thicknessColor:{value:new Color(16777215)},thicknessDistortion:{value:.1},thicknessAmbient:{value:0},thicknessAttenuation:{value:.1},thicknessPower:{value:2},thicknessScale:{value:10}}]),this.fragmentShader=["#define USE_MAP","#define PHONG","#define TRANSLUCENT","#include <common>","#include <bsdfs>","#include <uv_pars_fragment>","#include <map_pars_fragment>","#include <lights_phong_pars_fragment>","varying vec3 vColor;","uniform vec3 diffuse;","uniform vec3 specular;","uniform vec3 emissive;","uniform float opacity;","uniform float shininess;","uniform sampler2D thicknessMap;","uniform float thicknessPower;","uniform float thicknessScale;","uniform float thicknessDistortion;","uniform float thicknessAmbient;","uniform float thicknessAttenuation;","uniform vec3 thicknessColor;",ShaderChunk.lights_pars_begin,"void RE_Direct_Scattering(const in IncidentLight directLight, const in vec2 uv, const in GeometricContext geometry, inout ReflectedLight reflectedLight) {","\tvec3 thickness = thicknessColor * texture2D(thicknessMap, uv).r;","\tvec3 scatteringHalf = normalize(directLight.direction + (geometry.normal * thicknessDistortion));","\tfloat scatteringDot = pow(saturate(dot(geometry.viewDir, -scatteringHalf)), thicknessPower) * thicknessScale;","\tvec3 scatteringIllu = (scatteringDot + thicknessAmbient) * thickness;","\treflectedLight.directDiffuse += scatteringIllu * thicknessAttenuation * directLight.color;","}","void main() {","\tvec3 normal = normalize( vNormal );","\tvec3 viewerDirection = normalize( vViewPosition );","\tvec4 diffuseColor = vec4( diffuse, opacity );","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",ShaderChunk.map_fragment,ShaderChunk.color_fragment,ShaderChunk.specularmap_fragment,"\tvec3 totalEmissiveRadiance = emissive;",ShaderChunk.lights_phong_fragment,"\tGeometricContext geometry;","\tgeometry.position = - vViewPosition;","\tgeometry.normal = normal;","\tgeometry.viewDir = normalize( vViewPosition );","\tIncidentLight directLight;","\t#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )","\t\tPointLight pointLight;","\t\t#pragma unroll_loop","\t\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {","\t\t \tpointLight = pointLights[ i ];","\t\t \tgetPointDirectLightIrradiance( pointLight, geometry, directLight );","\t\t\t#ifdef USE_SHADOWMAP","\t\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;","\t\t\t#endif","\t\t\tRE_Direct( directLight, geometry, material, reflectedLight );","\t\t\t#if defined( TRANSLUCENT ) && defined( USE_MAP )","\t\t\tRE_Direct_Scattering(directLight, vUv, geometry, reflectedLight);","\t\t\t#endif","\t\t}","\t\t#endif","\t#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )","\t\tDirectionalLight directionalLight;","\t\t#pragma unroll_loop","\t\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {","\t\t\tdirectionalLight = directionalLights[ i ];","\t\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );","\t\t\t#ifdef USE_SHADOWMAP","\t\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","\t\t\t#endif","\t\t\tRE_Direct( directLight, geometry, material, reflectedLight );","\t\t\t#if defined( TRANSLUCENT ) && defined( USE_MAP )","\t\t\tRE_Direct_Scattering(directLight, vUv, geometry, reflectedLight);","\t\t\t#endif","\t\t}","\t#endif","\t#if defined( RE_IndirectDiffuse )","\t\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );","\t\t#if ( NUM_HEMI_LIGHTS > 0 )","\t\t\t#pragma unroll_loop","\t\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {","\t\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );","\t\t\t}","\t\t#endif","\t#endif","\t#if defined( RE_IndirectSpecular )","\t\tvec3 radiance = vec3( 0.0 );","\t\tvec3 clearCoatRadiance = vec3( 0.0 );","\t#endif",ShaderChunk.lights_fragment_end,"\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;","\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );",ShaderChunk.encodings_fragment,"}"].join("\n"),this.vertexShader=["varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vViewPosition;",ShaderChunk.common,"void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tvViewPosition = -mvPosition.xyz;","\tvNormal = normalize( normalMatrix * normal );","\tvUv = uv;","\tgl_Position = projectionMatrix * mvPosition;","}"].join("\n")},TimelinerController=function(e,t,i){this._scene=e,this._trackInfo=t,this._onUpdate=i,this._mixer=new AnimationMixer(e),this._clip=null,this._action=null,this._tracks={},this._propRefs={},this._channelNames=[]};TimelinerController.prototype={constructor:TimelinerController,init:function(e){for(var t=[],i=this._trackInfo,r=0,n=i.length;r!==n;++r){var o=i[r];t.push(this._addTrack(o.type,o.propertyPath,o.initialValue,o.interpolation))}this._clip=new AnimationClip("editclip",0,t),this._action=this._mixer.clipAction(this._clip).play()},setDisplayTime:function(e){this._action.time=e,this._mixer.update(0),this._onUpdate()},setDuration:function(e){this._clip.duration=e},getChannelNames:function(){return this._channelNames},getChannelKeyTimes:function(e){return this._tracks[e].times},setKeyframe:function(e,t){var i=this._tracks[e],r=i.times,n=Timeliner.binarySearch(r,t),o=i.values,a=i.getValueSize(),s=n*a;if(n<0){s=(n=~n)*a;for(var l=r.length+1,u=o.length+a,h=l-1;h!==n;--h)r[h]=r[h-1];h=u-1;for(var c=s+a-1;h!==c;--h)o[h]=o[h-a]}r[n]=t,this._propRefs[e].getValue(o,s)},delKeyframe:function(e,t){var i=this._tracks[e],r=i.times,n=Timeliner.binarySearch(r,t);if(r.length>1&&n>=0){for(var o=r.length-1,a=i.values,s=i.getValueSize(),l=a.length-s,u=n;u!==o;++u)r[u]=r[u+1];r.pop();for(var h=n*s;h!==l;++h)a[h]=a[h+s];a.length=l}},moveKeyframe:function(e,t,i,r){var n=this._tracks[e],o=n.times,a=Timeliner.binarySearch(o,t);if(a>=0){for(var s=r?o.length:a+1,l=o[a-1]<=t||!r&&t>=o[a+1];a!==s;)o[a++]+=i;l&&this._sort(n)}},serialize:function(){for(var e={duration:this._clip.duration,channels:{}},t=this._channelNames,i=this._tracks,r=e.channels,n=0,o=t.length;n!==o;++n){var a=t[n],s=i[a];r[a]={times:s.times,values:s.values}}return e},deserialize:function(e){var t=this._channelNames,i=this._tracks,r=e.channels;this.setDuration(e.duration);for(var n=0,o=t.length;n!==o;++n){var a=t[n],s=i[a],l=r[a];this._setArray(s.times,l.times),this._setArray(s.values,l.values)}this.setDisplayTime(this._mixer.time)},_sort:function(e){var t=e.times,i=AnimationUtils.getKeyframeOrder(t);this._setArray(t,AnimationUtils.sortedArray(t,1,i));var r=e.values,n=e.getValueSize();this._setArray(r,AnimationUtils.sortedArray(r,n,i))},_setArray:function(e,t){e.length=0,e.push.apply(e,t)},_addTrack:function(e,t,i,r){var n=new e(t,[0],i,r);return n.times=Array.prototype.slice.call(n.times),n.values=Array.prototype.slice.call(n.values),this._channelNames.push(t),this._tracks[t]=n,this._propRefs[t]=new PropertyBinding(this._scene,t),n}};var TypedArrayUtils={quicksortIP:function(e,t,i){for(var r,n,o=[],a=-1,s=0,l=e.length/t-1,u=0,h=0,c=0,d=function(i,r){for(i*=t,r*=t,c=0;c<t;c++)u=e[i+c],e[i+c]=e[r+c],e[r+c]=u},p=new Float32Array(t),f=new Float32Array(t);;)if(l-s<=25){for(n=s+1;n<=l;n++){for(h=0;h<t;h++)p[h]=e[n*t+h];for(r=n-1;r>=s&&e[r*t+i]>p[i];){for(h=0;h<t;h++)e[(r+1)*t+h]=e[r*t+h];r--}for(h=0;h<t;h++)e[(r+1)*t+h]=p[h]}if(-1==a)break;l=o[a--],s=o[a--]}else{for(n=l,d(s+l>>1,r=s+1),e[s*t+i]>e[l*t+i]&&d(s,l),e[r*t+i]>e[l*t+i]&&d(r,l),e[s*t+i]>e[r*t+i]&&d(s,r),h=0;h<t;h++)f[h]=e[r*t+h];for(;;){do{r++}while(e[r*t+i]<f[i]);do{n--}while(e[n*t+i]>f[i]);if(n<r)break;d(r,n)}for(h=0;h<t;h++)e[(s+1)*t+h]=e[n*t+h],e[n*t+h]=f[h];l-r+1>=n-s?(o[++a]=r,o[++a]=l,l=n-1):(o[++a]=s,o[++a]=n-1,s=r)}return e},Kdtree:function(e,t,i){var r=this,n=0,o=function(e,t){return e.subarray(t*i,t*i+i)};this.root=function e(t,a,s,l){var u,h,c=a%i,d=t.length/i;return a>n&&(n=a),0===d?null:1===d?new r.Node(o(t,0),a,s,l):(TypedArrayUtils.quicksortIP(t,i,c),u=Math.floor(d/2),(h=new r.Node(o(t,u),a,s,u+l)).left=e(t.subarray(0,u*i),a+1,h,l),h.right=e(t.subarray((u+1)*i,t.length),a+1,h,l+u+1),h)}(e,0,null,0),this.getMaxDepth=function(){return n},this.nearest=function(e,n,o){var a,s,l;if(l=new TypedArrayUtils.Kdtree.BinaryHeap(function(e){return-e[1]}),o)for(a=0;a<n;a+=1)l.push([null,o]);for(function r(o){var a,s,u,h,c=o.depth%i,d=t(e,o.obj),p=[];function f(e,t){l.push([e,t]),l.size()>n&&l.pop()}for(h=0;h<i;h+=1)h===o.depth%i?p[h]=e[h]:p[h]=o.obj[h];s=t(p,o.obj),null!==o.right||null!==o.left?(r(a=null===o.right?o.left:null===o.left?o.right:e[c]<o.obj[c]?o.left:o.right),(l.size()<n||d<l.peek()[1])&&f(o,d),(l.size()<n||Math.abs(s)<l.peek()[1])&&null!==(u=a===o.left?o.right:o.left)&&r(u)):(l.size()<n||d<l.peek()[1])&&f(o,d)}(r.root),s=[],a=0;a<n;a+=1)l.content[a][0]&&s.push([l.content[a][0],l.content[a][1]]);return s}}};TypedArrayUtils.Kdtree.prototype.Node=function(e,t,i,r){this.obj=e,this.left=null,this.right=null,this.parent=i,this.depth=t,this.pos=r},TypedArrayUtils.Kdtree.BinaryHeap=function(e){this.content=[],this.scoreFunction=e},TypedArrayUtils.Kdtree.BinaryHeap.prototype={push:function(e){this.content.push(e),this.bubbleUp(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e},peek:function(){return this.content[0]},remove:function(e){for(var t=this.content.length,i=0;i<t;i++)if(this.content[i]==e){var r=this.content.pop();return void(i!=t-1&&(this.content[i]=r,this.scoreFunction(r)<this.scoreFunction(e)?this.bubbleUp(i):this.sinkDown(i)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(e){for(var t=this.content[e];e>0;){var i=Math.floor((e+1)/2)-1,r=this.content[i];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[i]=t,this.content[e]=r,e=i}},sinkDown:function(e){for(var t=this.content.length,i=this.content[e],r=this.scoreFunction(i);;){var n=2*(e+1),o=n-1,a=null;if(o<t){var s=this.content[o],l=this.scoreFunction(s);l<r&&(a=o)}if(n<t){var u=this.content[n];this.scoreFunction(u)<(null===a?r:l)&&(a=n)}if(null===a)break;this.content[e]=this.content[a],this.content[a]=i,e=a}}};var GeometryUtils={merge:function(e,t,i){var r;console.warn("GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t instanceof Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,i)},randomPointInTriangle:function(){var e=new Vector3;return function(t,i,r){var n=new Vector3,o=Math.random(),a=Math.random();o+a>1&&(o=1-o,a=1-a);var s=1-o-a;return n.copy(t),n.multiplyScalar(o),e.copy(i),e.multiplyScalar(a),n.add(e),e.copy(r),e.multiplyScalar(s),n.add(e),n}}(),randomPointInFace:function(e,t){var i,r,n;return i=t.vertices[e.a],r=t.vertices[e.b],n=t.vertices[e.c],GeometryUtils.randomPointInTriangle(i,r,n)},randomPointsInGeometry:function(e,t){var i,r,n,o,a,s=e.faces,l=e.vertices,u=s.length,h=0,c=[];for(r=0;r<u;r++)n=l[(i=s[r]).a],o=l[i.b],a=l[i.c],i._area=GeometryUtils.triangleArea(n,o,a),h+=i._area,c[r]=h;function d(e){return function t(i,r){if(r<i)return i;var n=i+Math.floor((r-i)/2);return c[n]>e?t(i,n-1):c[n]<e?t(n+1,r):n}(0,c.length-1)}var p,f=[];for(r=0;r<t;r++)p=d(Math.random()*h),f[r]=GeometryUtils.randomPointInFace(s[p],e);return f},randomPointsInBufferGeometry:function(e,t){var i,r,n,o,a=e.attributes.position.array,s=0,l=[];r=new Vector3,n=new Vector3,o=new Vector3;var u=a.length/9;for(i=0;i<u;i++)r.set(a[9*i+0],a[9*i+1],a[9*i+2]),n.set(a[9*i+3],a[9*i+4],a[9*i+5]),o.set(a[9*i+6],a[9*i+7],a[9*i+8]),s+=GeometryUtils.triangleArea(r,n,o),l.push(s);function h(e){return function t(i,r){if(r<i)return i;var n=i+Math.floor((r-i)/2);return l[n]>e?t(i,n-1):l[n]<e?t(n+1,r):n}(0,l.length-1)}var c,d=[];for(i=0;i<t;i++)c=h(Math.random()*s),r.set(a[9*c+0],a[9*c+1],a[9*c+2]),n.set(a[9*c+3],a[9*c+4],a[9*c+5]),o.set(a[9*c+6],a[9*c+7],a[9*c+8]),d[i]=GeometryUtils.randomPointInTriangle(r,n,o);return d},triangleArea:(vector1=new Vector3,vector2=new Vector3,function(e,t,i){return vector1.subVectors(t,e),vector2.subVectors(i,e),vector1.cross(vector2),.5*vector1.length()}),center:function(e){return console.warn("GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},vector1,vector2,MathUtils={setQuaternionFromProperEuler:function(e,t,i,r,n){var o=Math.cos,a=Math.sin,s=o(i/2),l=a(i/2),u=o((t+r)/2),h=a((t+r)/2),c=o((t-r)/2),d=a((t-r)/2),p=o((r-t)/2),f=a((r-t)/2);"XYX"===n?e.set(s*h,l*c,l*d,s*u):"YZY"===n?e.set(l*d,s*h,l*c,s*u):"ZXZ"===n?e.set(l*c,l*d,s*h,s*u):"XZX"===n?e.set(s*h,l*f,l*p,s*u):"YXY"===n?e.set(l*p,s*h,l*f,s*u):"ZYZ"===n?e.set(l*f,l*p,s*h,s*u):console.warn("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}},SceneUtils={createMultiMaterialObject:function(e,t){for(var i=new Group,r=0,n=t.length;r<n;r++)i.add(new Mesh(e,t[r]));return i},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(e,t,i){e.applyMatrix((new Matrix4).getInverse(i.matrixWorld)),t.remove(e),i.add(e)}},ShadowMapViewer=function(e){var t,i=this,r=void 0!==e.name&&""!==e.name,n=10,o=10,a=256,s=256,l=new OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,1,10);l.position.set(0,0,2);var u,h,c=new Scene,d=UnpackDepthRGBAShader,p=new UniformsUtils.clone(d.uniforms),f=new ShaderMaterial({uniforms:p,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader}),m=new Mesh(new PlaneBufferGeometry(a,s),f);if(c.add(m),r){var v=(u=document.createElement("canvas")).getContext("2d");v.font="Bold 20px Arial";var g=v.measureText(e.name).width;u.width=g,u.height=25,v.font="Bold 20px Arial",v.fillStyle="rgba( 255, 0, 0, 1 )",v.fillText(e.name,0,20);var y=new Texture(u);y.magFilter=LinearFilter,y.minFilter=LinearFilter,y.needsUpdate=!0;var _=new MeshBasicMaterial({map:y,side:DoubleSide});_.transparent=!0;var b=new PlaneBufferGeometry(u.width,u.height);h=new Mesh(b,_),c.add(h)}this.enabled=!0,this.size={width:a,height:s,set:function(e,t){this.width=e,this.height=t,m.scale.set(this.width/a,this.height/s,1),i.position.set(i.position.x,i.position.y)}},this.position={x:n,y:o,set:function(e,t){this.x=e,this.y=t;var n=i.size.width,o=i.size.height;m.position.set(-window.innerWidth/2+n/2+this.x,window.innerHeight/2-o/2-this.y,0),r&&h.position.set(m.position.x,m.position.y-i.size.height/2+u.height/2,0)}},this.render=function(i){this.enabled&&(p.tDiffuse.value=e.shadow.map.texture,t=i.autoClear,i.autoClear=!1,i.clearDepth(),i.render(c,l),i.autoClear=t)},this.updateForWindowResize=function(){this.enabled&&(l.left=window.innerWidth/-2,l.right=window.innerWidth/2,l.top=window.innerHeight/2,l.bottom=window.innerHeight/-2,l.updateProjectionMatrix(),this.update())},this.update=function(){this.position.set(this.position.x,this.position.y),this.size.set(this.size.width,this.size.height)},this.update()};function getBoneList(e){var t=[];e&&e.isBone&&t.push(e);for(var i=0;i<e.children.length;i++)t.push.apply(t,getBoneList(e.children[i]));return t}function SkeletonHelper(e){for(var t=getBoneList(e),i=new BufferGeometry,r=[],n=[],o=new Color(0,0,1),a=new Color(0,1,0),s=0;s<t.length;s++){var l=t[s];l.parent&&l.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),n.push(o.r,o.g,o.b),n.push(a.r,a.g,a.b))}i.addAttribute("position",new Float32BufferAttribute(r,3)),i.addAttribute("color",new Float32BufferAttribute(n,3));var u=new LineBasicMaterial({vertexColors:VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});LineSegments.call(this,i,u),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}ShadowMapViewer.prototype.constructor=ShadowMapViewer,SkeletonHelper.prototype=Object.create(LineSegments.prototype),SkeletonHelper.prototype.constructor=SkeletonHelper,SkeletonHelper.prototype.updateMatrixWorld=function(){var e=new Vector3,t=new Matrix4,i=new Matrix4;return function(r){var n=this.bones,o=this.geometry,a=o.getAttribute("position");i.getInverse(this.root.matrixWorld);for(var s=0,l=0;s<n.length;s++){var u=n[s];u.parent&&u.parent.isBone&&(t.multiplyMatrices(i,u.matrixWorld),e.setFromMatrixPosition(t),a.setXYZ(l,e.x,e.y,e.z),t.multiplyMatrices(i,u.parent.matrixWorld),e.setFromMatrixPosition(t),a.setXYZ(l+1,e.x,e.y,e.z),l+=2)}o.getAttribute("position").needsUpdate=!0,Object3D.prototype.updateMatrixWorld.call(this,r)}}();var SkeletonUtils={retarget:function(){var e=new Vector3,t=new Quaternion,i=new Vector3,r=new Matrix4,n=new Matrix4,o=new Matrix4;return function(a,s,l){(l=l||{}).preserveMatrix=void 0===l.preserveMatrix||l.preserveMatrix,l.preservePosition=void 0===l.preservePosition||l.preservePosition,l.preserveHipPosition=void 0!==l.preserveHipPosition&&l.preserveHipPosition,l.useTargetMatrix=void 0!==l.useTargetMatrix&&l.useTargetMatrix,l.hip=void 0!==l.hip?l.hip:"hip",l.names=l.names||{};var u,h,c,d,p,f,m=s.isObject3D?s.skeleton.bones:this.getBones(s),v=a.isObject3D?a.skeleton.bones:this.getBones(a);if(a.isObject3D?a.skeleton.pose():(l.useTargetMatrix=!0,l.preserveMatrix=!1),l.preservePosition)for(p=[],f=0;f<v.length;f++)p.push(v[f].position.clone());if(l.preserveMatrix)for(a.updateMatrixWorld(),a.matrixWorld.identity(),f=0;f<a.children.length;++f)a.children[f].updateMatrixWorld(!0);if(l.offsets)for(u=[],f=0;f<v.length;++f)h=v[f],c=l.names[h.name]||h.name,l.offsets&&l.offsets[c]&&(h.matrix.multiply(l.offsets[c]),h.matrix.decompose(h.position,h.quaternion,h.scale),h.updateMatrixWorld()),u.push(h.matrixWorld.clone());for(f=0;f<v.length;++f){if(h=v[f],c=l.names[h.name]||h.name,d=this.getBoneByName(c,m),o.copy(h.matrixWorld),d){if(d.updateMatrixWorld(),l.useTargetMatrix?n.copy(d.matrixWorld):(n.getInverse(a.matrixWorld),n.multiply(d.matrixWorld)),i.setFromMatrixScale(n),n.scale(i.set(1/i.x,1/i.y,1/i.z)),o.makeRotationFromQuaternion(t.setFromRotationMatrix(n)),a.isObject3D){var g=v.indexOf(h),y=u?u[g]:r.getInverse(a.skeleton.boneInverses[g]);o.multiply(y)}o.copyPosition(n)}h.parent&&h.parent.isBone?(h.matrix.getInverse(h.parent.matrixWorld),h.matrix.multiply(o)):h.matrix.copy(o),l.preserveHipPosition&&c===l.hip&&h.matrix.setPosition(e.set(0,h.position.y,0)),h.matrix.decompose(h.position,h.quaternion,h.scale),h.updateMatrixWorld()}if(l.preservePosition)for(f=0;f<v.length;++f)h=v[f],(c=l.names[h.name]||h.name)!==l.hip&&h.position.copy(p[f]);l.preserveMatrix&&a.updateMatrixWorld(!0)}}(),retargetClip:function(e,t,i,r){(r=r||{}).useFirstFramePosition=void 0!==r.useFirstFramePosition&&r.useFirstFramePosition,r.fps=void 0!==r.fps?r.fps:30,r.names=r.names||[],t.isObject3D||(t=this.getHelperFromSkeleton(t));var n,o,a,s,l,u,h=Math.round(i.duration*(r.fps/1e3)*1e3),c=1/r.fps,d=[],p=new AnimationMixer(t),f=this.getBones(e.skeleton),m=[];for(p.clipAction(i).play(),p.update(0),t.updateMatrixWorld(),l=0;l<h;++l){var v=l*c;for(this.retarget(e,t,r),u=0;u<f.length;++u)s=r.names[f[u].name]||f[u].name,this.getBoneByName(s,t.skeleton)&&(o=f[u],a=m[u]=m[u]||{bone:o},r.hip===s&&(a.pos||(a.pos={times:new Float32Array(h),values:new Float32Array(3*h)}),r.useFirstFramePosition&&(0===l&&(n=o.position.clone()),o.position.sub(n)),a.pos.times[l]=v,o.position.toArray(a.pos.values,3*l)),a.quat||(a.quat={times:new Float32Array(h),values:new Float32Array(4*h)}),a.quat.times[l]=v,o.quaternion.toArray(a.quat.values,4*l));p.update(c),t.updateMatrixWorld()}for(l=0;l<m.length;++l)(a=m[l])&&(a.pos&&d.push(new VectorKeyframeTrack(".bones["+a.bone.name+"].position",a.pos.times,a.pos.values)),d.push(new QuaternionKeyframeTrack(".bones["+a.bone.name+"].quaternion",a.quat.times,a.quat.values)));return p.uncacheAction(i),new AnimationClip(i.name,-1,d)},getHelperFromSkeleton:function(e){var t=new SkeletonHelper(e.bones[0]);return t.skeleton=e,t},getSkeletonOffsets:(targetParentPos=new Vector3,targetPos=new Vector3,sourceParentPos=new Vector3,sourcePos=new Vector3,targetDir=new Vector2,sourceDir=new Vector2,function(e,t,i){(i=i||{}).hip=void 0!==i.hip?i.hip:"hip",i.names=i.names||{},t.isObject3D||(t=this.getHelperFromSkeleton(t));var r,n,o,a,s=Object.keys(i.names),l=Object.values(i.names),u=t.isObject3D?t.skeleton.bones:this.getBones(t),h=e.isObject3D?e.skeleton.bones:this.getBones(e),c=[];for(e.skeleton.pose(),a=0;a<h.length;++a)if(r=h[a],o=i.names[r.name]||r.name,(n=this.getBoneByName(o,u))&&o!==i.hip){var d=this.getNearestBone(r.parent,s),p=this.getNearestBone(n.parent,l);d.updateMatrixWorld(),p.updateMatrixWorld(),targetParentPos.setFromMatrixPosition(d.matrixWorld),targetPos.setFromMatrixPosition(r.matrixWorld),sourceParentPos.setFromMatrixPosition(p.matrixWorld),sourcePos.setFromMatrixPosition(n.matrixWorld),targetDir.subVectors(new Vector2(targetPos.x,targetPos.y),new Vector2(targetParentPos.x,targetParentPos.y)).normalize(),sourceDir.subVectors(new Vector2(sourcePos.x,sourcePos.y),new Vector2(sourceParentPos.x,sourceParentPos.y)).normalize();var f=targetDir.angle()-sourceDir.angle(),m=(new Matrix4).makeRotationFromEuler(new Euler(0,0,f));r.matrix.multiply(m),r.matrix.decompose(r.position,r.quaternion,r.scale),r.updateMatrixWorld(),c[o]=m}return c}),renameBones:function(e,t){for(var i=this.getBones(e),r=0;r<i.length;++r){var n=i[r];t[n.name]&&(n.name=t[n.name])}return this},getBones:function(e){return Array.isArray(e)?e:e.bones},getBoneByName:function(e,t){for(var i=0,r=this.getBones(t);i<r.length;i++)if(e===r[i].name)return r[i]},getNearestBone:function(e,t){for(;e.isBone;){if(-1!==t.indexOf(e.name))return e;e=e.parent}},findBoneTrackData:function(e,t){for(var i=/\[(.*)\]\.(.*)/,r={name:e},n=0;n<t.length;++n){var o=i.exec(t[n].name);o&&e===o[1]&&(r[o[2]]=n)}return r},getEqualsBonesNames:function(e,t){var i=this.getBones(e),r=this.getBones(t),n=[];e:for(var o=0;o<i.length;o++)for(var a=i[o].name,s=0;s<r.length;s++)if(a===r[s].name){n.push(a);continue e}return n}},targetParentPos,targetPos,sourceParentPos,sourcePos,targetDir,sourceDir,UVsDebug=function(e,t){var i="abc",r=new Vector2,n=new Vector2,o=[new Vector2,new Vector2,new Vector2],a=[],s=document.createElement("canvas"),l=t||1024,u=t||1024;s.width=l,s.height=u;var h=s.getContext("2d");if(h.lineWidth=2,h.strokeStyle="rgba( 0, 0, 0, 1.0 )",h.textAlign="center",h.fillStyle="rgba( 255, 255, 255, 1.0 )",h.fillRect(0,0,l,u),e.isGeometry)for(var c=e.faces,d=e.faceVertexUvs[0],p=0,f=d.length;p<f;p++){a=c[p];var m=d[p];a[0]=a.a,a[1]=a.b,a[2]=a.c,o[0].copy(m[0]),o[1].copy(m[1]),o[2].copy(m[2]),y(a,o,p)}else{var v=e.index,g=e.attributes.uv;if(v)for(p=0,f=v.count;p<f;p+=3)a[0]=v.getX(p),a[1]=v.getX(p+1),a[2]=v.getX(p+2),o[0].fromBufferAttribute(g,a[0]),o[1].fromBufferAttribute(g,a[1]),o[2].fromBufferAttribute(g,a[2]),y(a,o,p);else for(p=0,f=g.count;p<f;p+=3)a[0]=p,a[1]=p+1,a[2]=p+2,o[0].fromBufferAttribute(g,a[0]),o[1].fromBufferAttribute(g,a[1]),o[2].fromBufferAttribute(g,a[2]),y(a,o,p)}return s;function y(e,t,o){h.beginPath(),r.set(0,0);for(var a=0,s=t.length;a<s;a++){var c=t[a];r.x+=c.x,r.y+=c.y,0===a?h.moveTo(c.x*l,(1-c.y)*u):h.lineTo(c.x*l,(1-c.y)*u)}for(h.closePath(),h.stroke(),r.divideScalar(t.length),h.font="12pt Arial bold",h.fillStyle="rgba( 0, 0, 0, 1.0 )",h.fillText(o,r.x*l,(1-r.y)*u),r.x>.95&&h.fillText(o,r.x%1*l,(1-r.y)*u),h.font="8pt Arial bold",h.fillStyle="rgba( 0, 0, 0, 1.0 )",a=0,s=t.length;a<s;a++){c=t[a];n.addVectors(r,c).divideScalar(2);var d=e[a];h.fillText(i[a]+d,n.x*l,(1-n.y)*u),n.x>.95&&h.fillText(i[a]+d,n.x%1*l,(1-n.y)*u)}}},VolumeSlice=function(e,t,i){var r=this;this.volume=e,t=t||0,Object.defineProperty(this,"index",{get:function(){return t},set:function(e){return t=e,r.geometryNeedsUpdate=!0,t}}),this.axis=i||"z",this.canvas=document.createElement("canvas"),this.canvasBuffer=document.createElement("canvas"),this.updateGeometry();var n=new Texture(this.canvas);n.minFilter=LinearFilter,n.wrapS=n.wrapT=ClampToEdgeWrapping;var o=new MeshBasicMaterial({map:n,side:DoubleSide,transparent:!0});this.mesh=new Mesh(this.geometry,o),this.geometryNeedsUpdate=!0,this.repaint()};VolumeSlice.prototype={constructor:VolumeSlice,repaint:function(){this.geometryNeedsUpdate&&this.updateGeometry();var e=this.iLength,t=this.jLength,i=this.sliceAccess,r=this.volume,n=this.canvasBuffer,o=this.ctxBuffer,a=o.getImageData(0,0,e,t),s=a.data,l=r.data,u=r.upperThreshold,h=r.lowerThreshold,c=r.windowLow,d=r.windowHigh,p=0;if("label"===r.dataType)for(var f=0;f<t;f++)for(var m=0;m<e;m++){var v=l[i(m,f)];v=v>=this.colorMap.length?v%this.colorMap.length+1:v;var g=this.colorMap[v];s[4*p]=g>>24&255,s[4*p+1]=g>>16&255,s[4*p+2]=g>>8&255,s[4*p+3]=255&g,p++}else for(f=0;f<t;f++)for(m=0;m<e;m++){var y=l[i(m,f)],_=255;_=u>=y&&h<=y?_:0,y=(y=Math.floor(255*(y-c)/(d-c)))>255?255:y<0?0:0|y,s[4*p]=y,s[4*p+1]=y,s[4*p+2]=y,s[4*p+3]=_,p++}o.putImageData(a,0,0),this.ctx.drawImage(n,0,0,e,t,0,0,this.canvas.width,this.canvas.height),this.mesh.material.map.needsUpdate=!0},updateGeometry:function(){var e=this.volume.extractPerpendicularPlane(this.axis,this.index);this.sliceAccess=e.sliceAccess,this.jLength=e.jLength,this.iLength=e.iLength,this.matrix=e.matrix,this.canvas.width=e.planeWidth,this.canvas.height=e.planeHeight,this.canvasBuffer.width=this.iLength,this.canvasBuffer.height=this.jLength,this.ctx=this.canvas.getContext("2d"),this.ctxBuffer=this.canvasBuffer.getContext("2d"),this.geometry&&this.geometry.dispose(),this.geometry=new PlaneBufferGeometry(e.planeWidth,e.planeHeight),this.mesh&&(this.mesh.geometry=this.geometry,this.mesh.matrix.identity(),this.mesh.applyMatrix(this.matrix)),this.geometryNeedsUpdate=!1}};var DaydreamController=function(){Object3D.call(this);var e,t=this,i=[0,0],r=!1,n=new Vector3;this.matrixAutoUpdate=!1,this.getGamepad=function(){return e},this.getTouchpadState=function(){return r},this.update=function(){if(void 0!==(e=function(){for(var e=navigator.getGamepads&&navigator.getGamepads(),t=0;t<4;t++){var i=e[t];if(i&&"Daydream Controller"===i.id)return i}}())&&void 0!==e.pose){var o=e.pose;if(null===o)return;null!==o.orientation&&t.quaternion.fromArray(o.orientation),t.updateMatrix(),t.visible=!0,null===o.angularVelocity||n.equals(o.angularVelocity)||(n.fromArray(o.angularVelocity),t.dispatchEvent({type:"angularvelocitychanged",angularVelocity:n})),i[0]===e.axes[0]&&i[1]===e.axes[1]||(i[0]=e.axes[0],i[1]=e.axes[1],t.dispatchEvent({type:"axischanged",axes:i})),r!==e.buttons[0].pressed&&(r=e.buttons[0].pressed,t.dispatchEvent({type:r?"touchpaddown":"touchpadup"}))}else t.visible=!1},this.getTouchPadState=function(){return console.warn("DaydreamController: getTouchPadState() is now getTouchpadState()"),r}};DaydreamController.prototype=Object.create(Object3D.prototype),DaydreamController.prototype.constructor=DaydreamController;var GearVRController=function(){Object3D.call(this);var e,t=this,i=[0,0],r=!1,n=!1,o=new Vector3;this.matrixAutoUpdate=!0,this.getGamepad=function(){return e},this.getTouchpadState=function(){return r},this.update=function(){if(void 0!==(e=function(){for(var e=navigator.getGamepads&&navigator.getGamepads(),t=0;t<4;t++){var i=e[t];if(i&&("Gear VR Controller"===i.id||"Oculus Go Controller"===i.id))return i}}())&&void 0!==e.pose){var a=e.pose;if(null===a)return;null!==a.orientation&&t.quaternion.fromArray(a.orientation),t.updateMatrix(),t.visible=!0,null===a.angularVelocity||o.equals(a.angularVelocity)||(o.fromArray(a.angularVelocity),t.dispatchEvent({type:"angularvelocitychanged",angularVelocity:o})),i[0]===e.axes[0]&&i[1]===e.axes[1]||(i[0]=e.axes[0],i[1]=e.axes[1],t.dispatchEvent({type:"axischanged",axes:i})),r!==e.buttons[0].pressed&&(r=e.buttons[0].pressed,t.dispatchEvent({type:r?"touchpaddown":"touchpadup",axes:i})),n!==e.buttons[1].pressed&&(n=e.buttons[1].pressed,t.dispatchEvent({type:n?"triggerdown":"triggerup"}))}else t.visible=!1},this.getTouchPadState=function(){return console.warn("GearVRController: getTouchPadState() is now getTouchpadState()"),r},this.setHand=function(){console.warn("GearVRController: setHand() has been removed.")}};GearVRController.prototype=Object.create(Object3D.prototype),GearVRController.prototype.constructor=GearVRController;var ViveController=function(e){Object3D.call(this);var t,i=this,r=[0,0],n=!1,o=!1,a=!1,s=!1;this.matrixAutoUpdate=!1,this.standingMatrix=new Matrix4,this.getGamepad=function(){return t},this.getButtonState=function(e){return"thumbpad"===e?n:"trigger"===e?o:"grips"===e?a:"menu"===e?s:void 0},this.update=function(){if(void 0!==(t=function(e){for(var t=navigator.getGamepads&&navigator.getGamepads(),i=0,r=0;i<t.length;i++){var n=t[i];if(n&&("OpenVR Gamepad"===n.id||n.id.startsWith("Oculus Touch")||n.id.startsWith("Spatial Controller"))){if(r===e)return n;r++}}}(e))&&void 0!==t.pose){if(null===t.pose)return;var l=t.pose;null!==l.position&&i.position.fromArray(l.position),null!==l.orientation&&i.quaternion.fromArray(l.orientation),i.matrix.compose(i.position,i.quaternion,i.scale),i.matrix.premultiply(i.standingMatrix),i.matrixWorldNeedsUpdate=!0,i.visible=!0,r[0]===t.axes[0]&&r[1]===t.axes[1]||(r[0]=t.axes[0],r[1]=t.axes[1],i.dispatchEvent({type:"axischanged",axes:r})),n!==t.buttons[0].pressed&&(n=t.buttons[0].pressed,i.dispatchEvent({type:n?"thumbpaddown":"thumbpadup",axes:r})),o!==t.buttons[1].pressed&&(o=t.buttons[1].pressed,i.dispatchEvent({type:o?"triggerdown":"triggerup"})),a!==t.buttons[2].pressed&&(a=t.buttons[2].pressed,i.dispatchEvent({type:a?"gripsdown":"gripsup"})),s!==t.buttons[3].pressed&&(s=t.buttons[3].pressed,i.dispatchEvent({type:s?"menudown":"menuup"}))}else i.visible=!1}};function CircleGeometry(e,t,i,r){Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},this.fromBufferGeometry(new CircleBufferGeometry(e,t,i,r)),this.mergeVertices()}function CircleBufferGeometry(e,t,i,r){BufferGeometry.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},e=e||1,t=void 0!==t?Math.max(3,t):8,i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI;var n,o,a=[],s=[],l=[],u=[],h=new Vector3,c=new Vector2;for(s.push(0,0,0),l.push(0,0,1),u.push(.5,.5),o=0,n=3;o<=t;o++,n+=3){var d=i+o/t*r;h.x=e*Math.cos(d),h.y=e*Math.sin(d),s.push(h.x,h.y,h.z),l.push(0,0,1),c.x=(s[n]/e+1)/2,c.y=(s[n+1]/e+1)/2,u.push(c.x,c.y)}for(n=1;n<=t;n++)a.push(n,n+1,0);this.setIndex(a),this.addAttribute("position",new Float32BufferAttribute(s,3)),this.addAttribute("normal",new Float32BufferAttribute(l,3)),this.addAttribute("uv",new Float32BufferAttribute(u,2))}function IcosahedronGeometry(e,t){Geometry.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new IcosahedronBufferGeometry(e,t)),this.mergeVertices()}function IcosahedronBufferGeometry(e,t){var i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1];PolyhedronBufferGeometry.call(this,r,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function ShapeGeometry(e,t){Geometry.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new ShapeBufferGeometry(e,t)),this.mergeVertices()}function ShapeBufferGeometry(e,t){BufferGeometry.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var i=[],r=[],n=[],o=[],a=0,s=0;if(!1===Array.isArray(e))u(e);else for(var l=0;l<e.length;l++)u(e[l]),this.addGroup(a,s,l),a+=s,s=0;function u(e){var a,l,u,h=r.length/3,c=e.extractPoints(t),d=c.shape,p=c.holes;for(!1===ShapeUtils.isClockWise(d)&&(d=d.reverse()),a=0,l=p.length;a<l;a++)u=p[a],!0===ShapeUtils.isClockWise(u)&&(p[a]=u.reverse());var f=ShapeUtils.triangulateShape(d,p);for(a=0,l=p.length;a<l;a++)u=p[a],d=d.concat(u);for(a=0,l=d.length;a<l;a++){var m=d[a];r.push(m.x,m.y,0),n.push(0,0,1),o.push(m.x,m.y)}for(a=0,l=f.length;a<l;a++){var v=f[a],g=v[0]+h,y=v[1]+h,_=v[2]+h;i.push(g,y,_),s+=3}}this.setIndex(i),this.addAttribute("position",new Float32BufferAttribute(r,3)),this.addAttribute("normal",new Float32BufferAttribute(n,3)),this.addAttribute("uv",new Float32BufferAttribute(o,2))}function toJSON(e,t){if(t.shapes=[],Array.isArray(e))for(var i=0,r=e.length;i<r;i++){var n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}ViveController.prototype=Object.create(Object3D.prototype),ViveController.prototype.constructor=ViveController,CircleGeometry.prototype=Object.create(Geometry.prototype),CircleGeometry.prototype.constructor=CircleGeometry,CircleBufferGeometry.prototype=Object.create(BufferGeometry.prototype),CircleBufferGeometry.prototype.constructor=CircleBufferGeometry,IcosahedronGeometry.prototype=Object.create(Geometry.prototype),IcosahedronGeometry.prototype.constructor=IcosahedronGeometry,IcosahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),IcosahedronBufferGeometry.prototype.constructor=IcosahedronBufferGeometry,ShapeGeometry.prototype=Object.create(Geometry.prototype),ShapeGeometry.prototype.constructor=ShapeGeometry,ShapeGeometry.prototype.toJSON=function(){var e=Geometry.prototype.toJSON.call(this);return toJSON(this.parameters.shapes,e)},ShapeBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ShapeBufferGeometry.prototype.constructor=ShapeBufferGeometry,ShapeBufferGeometry.prototype.toJSON=function(){var e=BufferGeometry.prototype.toJSON.call(this);return toJSON(this.parameters.shapes,e)};var PaintViveController=function(e){ViveController.call(this,e);var t=2*Math.PI,i={COLOR:0,SIZE:1},r=i.COLOR,n=new Color(1,1,1),o=1;var a=new Mesh(s=new CircleBufferGeometry(1,32),d=new MeshBasicMaterial({map:function(){var e=document.createElement("canvas");e.width=256,e.height=256;for(var i=e.getContext("2d"),r=i.getImageData(0,0,256,256),n=r.data,o=new Color,a=0,s=0;a<n.length;a+=4,s++){var l=s%256/256-.5,u=Math.floor(s/256)/256-.5;o.setHSL(Math.atan2(u,l)/t,1,2*(.5-Math.sqrt(l*l+u*u))),n[a+0]=256*o.r,n[a+1]=256*o.g,n[a+2]=256*o.b,n[a+3]=256}return i.putImageData(r,0,0),new CanvasTexture(e)}()}));a.position.set(0,.005,.0495),a.rotation.x=-1.45,a.scale.setScalar(.02),this.add(a);var s=new IcosahedronBufferGeometry(.1,2);(d=new MeshBasicMaterial).color=n;var l=new Mesh(s,d);a.add(l);var u=new Group;u.position.set(0,.005,.0495),u.rotation.x=-1.45,u.scale.setScalar(.02),this.add(u);var h=new Shape;h.moveTo(0,-1),h.lineTo(1,1),h.lineTo(-1,1);var c=new Mesh(s=new ShapeBufferGeometry(h),d=new MeshBasicMaterial({color:2236962,wireframe:!0}));c.position.z=.001,f(c.geometry,1),u.add(c);var d;s=new ShapeBufferGeometry(h);(d=new MeshBasicMaterial({side:DoubleSide})).color=n;var p=new Mesh(s,d);function f(e,t){var i=Math.atan(.25),r=1.5*t,n=Math.tan(i)*r*2,o=e.attributes.position;o.setXYZ(0,0,-.75,0),o.setXYZ(1,0+n/2,-.75+r,0),o.setXYZ(2,0-n/2,-.75+r,0),o.needsUpdate=!0}p.position.z=.0011,f(p.geometry,.5),u.add(p),u.visible=!1,this.getColor=function(){return n},this.getSize=function(){return o},this.addEventListener("axischanged",function(e){if(!1!==this.getButtonState("thumbpad")){var a=e.axes[0]/2,s=-e.axes[1]/2;if(r===i.COLOR&&(n.setHSL(Math.atan2(s,a)/t,1,2*(.5-Math.sqrt(a*a+s*s))),l.position.set(e.axes[0],e.axes[1],0)),r===i.SIZE){var u=.5-s;o=2*u,f(p.geometry,u)}}}),this.addEventListener("gripsdown",function(){return r===i.COLOR?(r=i.SIZE,a.visible=!1,void(u.visible=!0)):r===i.SIZE?(r=i.COLOR,a.visible=!0,void(u.visible=!1)):void 0})};PaintViveController.prototype=Object.create(ViveController.prototype),PaintViveController.prototype.constructor=PaintViveController;var WebVR={createButton:function(e,t){function i(t){o.style.display="",o.style.cursor="pointer",o.style.left="calc(50% - 50px)",o.style.width="100px",o.textContent="ENTER VR",o.onmouseenter=function(){o.style.opacity="1.0"},o.onmouseleave=function(){o.style.opacity="0.5"},o.onclick=function(){t.isPresenting?t.exitPresent():t.requestPresent([{source:e.domElement}])},e.vr.setDevice(t)}function r(){o.style.display="",o.style.cursor="auto",o.style.left="calc(50% - 75px)",o.style.width="150px",o.textContent="VR NOT FOUND",o.onmouseenter=null,o.onmouseleave=null,o.onclick=null,e.vr.setDevice(null)}function n(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}var o;if(t&&t.frameOfReferenceType&&e.vr.setFrameOfReferenceType(t.frameOfReferenceType),"xr"in navigator)return(o=document.createElement("button")).style.display="none",n(o),navigator.xr.requestDevice().then(function(t){t.supportsSession({immersive:!0,exclusive:!0}).then(function(){!function(t){var i=null;function r(t){t.addEventListener("end",n),e.vr.setSession(t),o.textContent="EXIT VR",i=t}function n(t){i.removeEventListener("end",n),e.vr.setSession(null),o.textContent="ENTER VR",i=null}o.style.display="",o.style.cursor="pointer",o.style.left="calc(50% - 50px)",o.style.width="100px",o.textContent="ENTER VR",o.onmouseenter=function(){o.style.opacity="1.0"},o.onmouseleave=function(){o.style.opacity="0.5"},o.onclick=function(){null===i?t.requestSession({immersive:!0,exclusive:!0}).then(r):i.end()},e.vr.setDevice(t)}(t)}).catch(r)}).catch(r),o;if("getVRDisplays"in navigator)return(o=document.createElement("button")).style.display="none",n(o),window.addEventListener("vrdisplayconnect",function(e){i(e.display)},!1),window.addEventListener("vrdisplaydisconnect",function(e){r()},!1),window.addEventListener("vrdisplaypresentchange",function(e){o.textContent=e.display.isPresenting?"EXIT VR":"ENTER VR"},!1),window.addEventListener("vrdisplayactivate",function(t){t.display.requestPresent([{source:e.domElement}])},!1),navigator.getVRDisplays().then(function(e){e.length>0?i(e[0]):r()}).catch(r),o;var a=document.createElement("a");return a.href="https://webvr.info",a.innerHTML="WEBVR NOT SUPPORTED",a.style.left="calc(50% - 90px)",a.style.width="180px",a.style.textDecoration="none",n(a),a},checkAvailability:function(){return console.warn("WEBVR.checkAvailability has been deprecated."),new Promise(function(){})},getMessageContainer:function(){return console.warn("WEBVR.getMessageContainer has been deprecated."),document.createElement("div")},getButton:function(){return console.warn("WEBVR.getButton has been deprecated."),document.createElement("div")},getVRDisplay:function(){console.warn("WEBVR.getVRDisplay has been deprecated.")}},WebGL={isWebGLAvailable:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}},isWebGL2Available:function(){try{var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}},getWebGLErrorMessage:function(){return this.getErrorMessage(1)},getWebGL2ErrorMessage:function(){return this.getErrorMessage(2)},getErrorMessage:function(e){var t={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext},i='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>',r=document.createElement("div");return r.id="webglmessage",r.style.fontFamily="monospace",r.style.fontSize="13px",r.style.fontWeight="normal",r.style.textAlign="center",r.style.background="#fff",r.style.color="#000",r.style.padding="1.5em",r.style.width="400px",r.style.margin="5em auto 0",i=(i=t[e]?i.replace("$0","graphics card"):i.replace("$0","browser")).replace("$1",{1:"WebGL",2:"WebGL 2"}[e]),r.innerHTML=i,r}},context;function AnimationObjectGroup(){var e=arguments;this.uuid=_Math.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var i=0,r=arguments.length;i!==r;++i)t[e[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function Audio(e){Object3D.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function AudioAnalyser(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}Object.assign(AnimationObjectGroup.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=arguments,t=this._objects,i=t.length,r=this.nCachedObjects_,n=this._indicesByUUID,o=this._paths,a=this._parsedPaths,s=this._bindings,l=s.length,u=void 0,h=0,c=arguments.length;h!==c;++h){var d=e[h],p=d.uuid,f=n[p];if(void 0===f){f=i++,n[p]=f,t.push(d);for(var m=0,v=l;m!==v;++m)s[m].push(new PropertyBinding(d,o[m],a[m]))}else if(f<r){u=t[f];var g=--r,y=t[g];n[y.uuid]=f,t[f]=y,n[p]=g,t[g]=d;for(m=0,v=l;m!==v;++m){var _=s[m],b=_[g],x=_[f];_[f]=b,void 0===x&&(x=new PropertyBinding(d,o[m],a[m])),_[g]=x}}else t[f]!==u&&console.error("AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var e=arguments,t=this._objects,i=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,o=n.length,a=0,s=arguments.length;a!==s;++a){var l=e[a],u=l.uuid,h=r[u];if(void 0!==h&&h>=i){var c=i++,d=t[c];r[d.uuid]=h,t[h]=d,r[u]=c,t[c]=l;for(var p=0,f=o;p!==f;++p){var m=n[p],v=m[c],g=m[h];m[h]=v,m[c]=g}}}this.nCachedObjects_=i},uncache:function(){for(var e=arguments,t=this._objects,i=t.length,r=this.nCachedObjects_,n=this._indicesByUUID,o=this._bindings,a=o.length,s=0,l=arguments.length;s!==l;++s){var u=e[s].uuid,h=n[u];if(void 0!==h)if(delete n[u],h<r){var c=--r,d=t[c],p=t[y=--i];n[d.uuid]=h,t[h]=d,n[p.uuid]=c,t[c]=p,t.pop();for(var f=0,m=a;f!==m;++f){var v=(_=o[f])[c],g=_[y];_[h]=v,_[c]=g,_.pop()}}else{var y;n[(p=t[y=--i]).uuid]=h,t[h]=p,t.pop();for(f=0,m=a;f!==m;++f){var _;(_=o[f])[h]=_[y],_.pop()}}}this.nCachedObjects_=r},subscribe_:function(e,t){var i=this._bindingsIndicesByPath,r=i[e],n=this._bindings;if(void 0!==r)return n[r];var o=this._paths,a=this._parsedPaths,s=this._objects,l=s.length,u=this.nCachedObjects_,h=new Array(l);r=n.length,i[e]=r,o.push(e),a.push(t),n.push(h);for(var c=u,d=s.length;c!==d;++c){var p=s[c];h[c]=new PropertyBinding(p,e,t)}return h},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){var r=this._paths,n=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];t[e[a]]=i,o[i]=s,o.pop(),n[i]=n[a],n.pop(),r[i]=r[a],r.pop()}}}),Audio.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Audio,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("Audio: this Audio has no playback control.")}else console.warn("Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this;console.warn("Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}),Object.assign(AudioAnalyser.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),i=0;i<t.length;i++)e+=t[i];return e/t.length}});var AudioContext={getContext:function(){return void 0===context&&(context=new(window.AudioContext||window.webkitAudioContext)),context},setContext:function(e){context=e}};function AudioListener(){Object3D.call(this),this.type="AudioListener",this.context=AudioContext.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0}function PositionalAudio(e){Audio.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function InstancedBufferAttribute(e,t,i,r){"number"==typeof i&&(r=i,i=!1,console.error("InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),BufferAttribute.call(this,e,t,i),this.meshPerAttribute=r||1}function Font(e){this.type="Font",this.data=e}function createPaths(e,t,i){for(var r=Array.from?Array.from(e):String(e).split(""),n=t/i.resolution,o=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*n,a=[],s=0,l=0,u=0;u<r.length;u++){var h=r[u];if("\n"===h)s=0,l-=o;else{var c=createPath(h,n,s,l,i);s+=c.offsetX,a.push(c.path)}}return a}function createPath(e,t,i,r,n){var o=n.glyphs[e]||n.glyphs["?"];if(o){var a,s,l,u,h,c,d,p,f=new ShapePath;if(o.o)for(var m=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),v=0,g=m.length;v<g;){switch(m[v++]){case"m":a=m[v++]*t+i,s=m[v++]*t+r,f.moveTo(a,s);break;case"l":a=m[v++]*t+i,s=m[v++]*t+r,f.lineTo(a,s);break;case"q":l=m[v++]*t+i,u=m[v++]*t+r,h=m[v++]*t+i,c=m[v++]*t+r,f.quadraticCurveTo(h,c,l,u);break;case"b":l=m[v++]*t+i,u=m[v++]*t+r,h=m[v++]*t+i,c=m[v++]*t+r,d=m[v++]*t+i,p=m[v++]*t+r,f.bezierCurveTo(h,c,d,p,l,u)}}return{offsetX:o.ha*t,path:f}}}function ConeGeometry(e,t,i,r,n,o,a){CylinderGeometry.call(this,0,e,t,i,r,n,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:o,thetaLength:a}}function ConeBufferGeometry(e,t,i,r,n,o,a){CylinderBufferGeometry.call(this,0,e,t,i,r,n,o,a),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:o,thetaLength:a}}function DodecahedronGeometry(e,t){Geometry.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new DodecahedronBufferGeometry(e,t)),this.mergeVertices()}function DodecahedronBufferGeometry(e,t){var i=(1+Math.sqrt(5))/2,r=1/i,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r];PolyhedronBufferGeometry.call(this,n,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function EdgesGeometry(e,t){BufferGeometry.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var i,r,n,o,a=[],s=Math.cos(_Math.DEG2RAD*t),l=[0,0],u={},h=["a","b","c"];e.isBufferGeometry?(o=new Geometry).fromBufferGeometry(e):o=e.clone(),o.mergeVertices(),o.computeFaceNormals();for(var c=o.vertices,d=o.faces,p=0,f=d.length;p<f;p++)for(var m=d[p],v=0;v<3;v++)i=m[h[v]],r=m[h[(v+1)%3]],l[0]=Math.min(i,r),l[1]=Math.max(i,r),void 0===u[n=l[0]+","+l[1]]?u[n]={index1:l[0],index2:l[1],face1:p,face2:void 0}:u[n].face2=p;for(n in u){var g=u[n];if(void 0===g.face2||d[g.face1].normal.dot(d[g.face2].normal)<=s){var y=c[g.index1];a.push(y.x,y.y,y.z),y=c[g.index2],a.push(y.x,y.y,y.z)}}this.addAttribute("position",new Float32BufferAttribute(a,3))}function ExtrudeGeometry(e,t){Geometry.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new ExtrudeBufferGeometry(e,t)),this.mergeVertices()}function ExtrudeBufferGeometry(e,t){BufferGeometry.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var i=this,r=[],n=[],o=0,a=e.length;o<a;o++){s(e[o])}function s(e){var o=[],a=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:100,u=void 0===t.bevelEnabled||t.bevelEnabled,h=void 0!==t.bevelThickness?t.bevelThickness:6,c=void 0!==t.bevelSize?t.bevelSize:h-2,d=void 0!==t.bevelSegments?t.bevelSegments:3,p=t.extrudePath,f=void 0!==t.UVGenerator?t.UVGenerator:WorldUVGenerator;void 0!==t.amount&&(console.warn("ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);var m,v,g,y,_,b,x,w,S=!1;p&&(m=p.getSpacedPoints(s),S=!0,u=!1,v=p.computeFrenetFrames(s,!1),g=new Vector3,y=new Vector3,_=new Vector3),u||(d=0,h=0,c=0);var M=e.extractPoints(a),T=M.shape,A=M.holes;if(!ShapeUtils.isClockWise(T))for(T=T.reverse(),x=0,w=A.length;x<w;x++)b=A[x],ShapeUtils.isClockWise(b)&&(A[x]=b.reverse());var C=ShapeUtils.triangulateShape(T,A),L=T;for(x=0,w=A.length;x<w;x++)b=A[x],T=T.concat(b);function N(e,t,i){return t||console.error("ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}var P,k,E,D,O,R,F=T.length,I=C.length;function B(e,t,i){var r,n,o,a=e.x-t.x,s=e.y-t.y,l=i.x-e.x,u=i.y-e.y,h=a*a+s*s,c=a*u-s*l;if(Math.abs(c)>Number.EPSILON){var d=Math.sqrt(h),p=Math.sqrt(l*l+u*u),f=t.x-s/d,m=t.y+a/d,v=((i.x-u/p-f)*u-(i.y+l/p-m)*l)/(a*u-s*l),g=(r=f+a*v-e.x)*r+(n=m+s*v-e.y)*n;if(g<=2)return new Vector2(r,n);o=Math.sqrt(g/2)}else{var y=!1;a>Number.EPSILON?l>Number.EPSILON&&(y=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(u)&&(y=!0),y?(r=-s,n=a,o=Math.sqrt(h)):(r=a,n=s,o=Math.sqrt(h/2))}return new Vector2(r/o,n/o)}for(var U=[],V=0,z=L.length,G=z-1,j=V+1;V<z;V++,G++,j++)G===z&&(G=0),j===z&&(j=0),U[V]=B(L[V],L[G],L[j]);var W,H,q=[],Y=U.concat();for(x=0,w=A.length;x<w;x++){for(b=A[x],W=[],V=0,G=(z=b.length)-1,j=V+1;V<z;V++,G++,j++)G===z&&(G=0),j===z&&(j=0),W[V]=B(b[V],b[G],b[j]);q.push(W),Y=Y.concat(W)}for(P=0;P<d;P++){for(E=P/d,D=h*Math.cos(E*Math.PI/2),k=c*Math.sin(E*Math.PI/2),V=0,z=L.length;V<z;V++)K((O=N(L[V],U[V],k)).x,O.y,-D);for(x=0,w=A.length;x<w;x++)for(b=A[x],W=q[x],V=0,z=b.length;V<z;V++)K((O=N(b[V],W[V],k)).x,O.y,-D)}for(k=c,V=0;V<F;V++)O=u?N(T[V],Y[V],k):T[V],S?(y.copy(v.normals[0]).multiplyScalar(O.x),g.copy(v.binormals[0]).multiplyScalar(O.y),_.copy(m[0]).add(y).add(g),K(_.x,_.y,_.z)):K(O.x,O.y,0);for(H=1;H<=s;H++)for(V=0;V<F;V++)O=u?N(T[V],Y[V],k):T[V],S?(y.copy(v.normals[H]).multiplyScalar(O.x),g.copy(v.binormals[H]).multiplyScalar(O.y),_.copy(m[H]).add(y).add(g),K(_.x,_.y,_.z)):K(O.x,O.y,l/s*H);for(P=d-1;P>=0;P--){for(E=P/d,D=h*Math.cos(E*Math.PI/2),k=c*Math.sin(E*Math.PI/2),V=0,z=L.length;V<z;V++)K((O=N(L[V],U[V],k)).x,O.y,l+D);for(x=0,w=A.length;x<w;x++)for(b=A[x],W=q[x],V=0,z=b.length;V<z;V++)O=N(b[V],W[V],k),S?K(O.x,O.y+m[s-1].y,m[s-1].x+D):K(O.x,O.y,l+D)}function X(e,t){var i,r;for(V=e.length;--V>=0;){i=V,(r=V-1)<0&&(r=e.length-1);var n=0,o=s+2*d;for(n=0;n<o;n++){var a=F*n,l=F*(n+1);Z(t+i+a,t+r+a,t+r+l,t+i+l)}}}function K(e,t,i){o.push(e),o.push(t),o.push(i)}function Q(e,t,n){J(e),J(t),J(n);var o=r.length/3,a=f.generateTopUV(i,r,o-3,o-2,o-1);$(a[0]),$(a[1]),$(a[2])}function Z(e,t,n,o){J(e),J(t),J(o),J(t),J(n),J(o);var a=r.length/3,s=f.generateSideWallUV(i,r,a-6,a-3,a-2,a-1);$(s[0]),$(s[1]),$(s[3]),$(s[1]),$(s[2]),$(s[3])}function J(e){r.push(o[3*e+0]),r.push(o[3*e+1]),r.push(o[3*e+2])}function $(e){n.push(e.x),n.push(e.y)}!function(){var e=r.length/3;if(u){var t=0,n=F*t;for(V=0;V<I;V++)Q((R=C[V])[2]+n,R[1]+n,R[0]+n);for(n=F*(t=s+2*d),V=0;V<I;V++)Q((R=C[V])[0]+n,R[1]+n,R[2]+n)}else{for(V=0;V<I;V++)Q((R=C[V])[2],R[1],R[0]);for(V=0;V<I;V++)Q((R=C[V])[0]+F*s,R[1]+F*s,R[2]+F*s)}i.addGroup(e,r.length/3-e,0)}(),function(){var e=r.length/3,t=0;for(X(L,t),t+=L.length,x=0,w=A.length;x<w;x++)X(b=A[x],t),t+=b.length;i.addGroup(e,r.length/3-e,1)}()}this.addAttribute("position",new Float32BufferAttribute(r,3)),this.addAttribute("uv",new Float32BufferAttribute(n,2)),this.computeVertexNormals()}AudioListener.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:AudioListener,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(){var e=new Vector3,t=new Quaternion,i=new Vector3,r=new Vector3,n=new Clock;return function(o){Object3D.prototype.updateMatrixWorld.call(this,o);var a=this.context.listener,s=this.up;if(this.timeDelta=n.getDelta(),this.matrixWorld.decompose(e,t,i),r.set(0,0,-1).applyQuaternion(t),a.positionX){var l=this.context.currentTime+this.timeDelta;a.positionX.linearRampToValueAtTime(e.x,l),a.positionY.linearRampToValueAtTime(e.y,l),a.positionZ.linearRampToValueAtTime(e.z,l),a.forwardX.linearRampToValueAtTime(r.x,l),a.forwardY.linearRampToValueAtTime(r.y,l),a.forwardZ.linearRampToValueAtTime(r.z,l),a.upX.linearRampToValueAtTime(s.x,l),a.upY.linearRampToValueAtTime(s.y,l),a.upZ.linearRampToValueAtTime(s.z,l)}else a.setPosition(e.x,e.y,e.z),a.setOrientation(r.x,r.y,r.z,s.x,s.y,s.z)}}()}),PositionalAudio.prototype=Object.assign(Object.create(Audio.prototype),{constructor:PositionalAudio,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this},updateMatrixWorld:function(){var e=new Vector3,t=new Quaternion,i=new Vector3,r=new Vector3;return function(n){if(Object3D.prototype.updateMatrixWorld.call(this,n),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(e,t,i),r.set(0,0,1).applyQuaternion(t);var o=this.panner;if(o.positionX){var a=this.context.currentTime+this.listener.timeDelta;o.positionX.linearRampToValueAtTime(e.x,a),o.positionY.linearRampToValueAtTime(e.y,a),o.positionZ.linearRampToValueAtTime(e.z,a),o.orientationX.linearRampToValueAtTime(r.x,a),o.orientationY.linearRampToValueAtTime(r.y,a),o.orientationZ.linearRampToValueAtTime(r.z,a)}else o.setPosition(e.x,e.y,e.z),o.setOrientation(r.x,r.y,r.z)}}}()}),InstancedBufferAttribute.prototype=Object.assign(Object.create(BufferAttribute.prototype),{constructor:InstancedBufferAttribute,isInstancedBufferAttribute:!0,copy:function(e){return BufferAttribute.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(Font.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var i=[],r=createPaths(e,t,this.data),n=0,o=r.length;n<o;n++)Array.prototype.push.apply(i,r[n].toShapes());return i}}),ConeGeometry.prototype=Object.create(CylinderGeometry.prototype),ConeGeometry.prototype.constructor=ConeGeometry,ConeBufferGeometry.prototype=Object.create(CylinderBufferGeometry.prototype),ConeBufferGeometry.prototype.constructor=ConeBufferGeometry,DodecahedronGeometry.prototype=Object.create(Geometry.prototype),DodecahedronGeometry.prototype.constructor=DodecahedronGeometry,DodecahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),DodecahedronBufferGeometry.prototype.constructor=DodecahedronBufferGeometry,EdgesGeometry.prototype=Object.create(BufferGeometry.prototype),EdgesGeometry.prototype.constructor=EdgesGeometry,ExtrudeGeometry.prototype=Object.create(Geometry.prototype),ExtrudeGeometry.prototype.constructor=ExtrudeGeometry,ExtrudeGeometry.prototype.toJSON=function(){var e=Geometry.prototype.toJSON.call(this);return toJSON$1(this.parameters.shapes,this.parameters.options,e)},ExtrudeBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ExtrudeBufferGeometry.prototype.constructor=ExtrudeBufferGeometry,ExtrudeBufferGeometry.prototype.toJSON=function(){var e=BufferGeometry.prototype.toJSON.call(this);return toJSON$1(this.parameters.shapes,this.parameters.options,e)};var WorldUVGenerator={generateTopUV:function(e,t,i,r,n){var o=t[3*i],a=t[3*i+1],s=t[3*r],l=t[3*r+1],u=t[3*n],h=t[3*n+1];return[new Vector2(o,a),new Vector2(s,l),new Vector2(u,h)]},generateSideWallUV:function(e,t,i,r,n,o){var a=t[3*i],s=t[3*i+1],l=t[3*i+2],u=t[3*r],h=t[3*r+1],c=t[3*r+2],d=t[3*n],p=t[3*n+1],f=t[3*n+2],m=t[3*o],v=t[3*o+1],g=t[3*o+2];return Math.abs(s-h)<.01?[new Vector2(a,1-l),new Vector2(u,1-c),new Vector2(d,1-f),new Vector2(m,1-g)]:[new Vector2(s,1-l),new Vector2(h,1-c),new Vector2(p,1-f),new Vector2(v,1-g)]}},lineGeometry,coneGeometry,radians,axis;function toJSON$1(e,t,i){if(i.shapes=[],Array.isArray(e))for(var r=0,n=e.length;r<n;r++){var o=e[r];i.shapes.push(o.uuid)}else i.shapes.push(e.uuid);return void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON()),i}function LatheGeometry(e,t,i,r){Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},this.fromBufferGeometry(new LatheBufferGeometry(e,t,i,r)),this.mergeVertices()}function LatheBufferGeometry(e,t,i,r){BufferGeometry.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t)||12,i=i||0,r=r||2*Math.PI,r=_Math.clamp(r,0,2*Math.PI);var n,o,a,s=[],l=[],u=[],h=1/t,c=new Vector3,d=new Vector2;for(o=0;o<=t;o++){var p=i+o*h*r,f=Math.sin(p),m=Math.cos(p);for(a=0;a<=e.length-1;a++)c.x=e[a].x*f,c.y=e[a].y,c.z=e[a].x*m,l.push(c.x,c.y,c.z),d.x=o/t,d.y=a/(e.length-1),u.push(d.x,d.y)}for(o=0;o<t;o++)for(a=0;a<e.length-1;a++){var v=n=a+o*e.length,g=n+e.length,y=n+e.length+1,_=n+1;s.push(v,g,_),s.push(g,y,_)}if(this.setIndex(s),this.addAttribute("position",new Float32BufferAttribute(l,3)),this.addAttribute("uv",new Float32BufferAttribute(u,2)),this.computeVertexNormals(),r===2*Math.PI){var b=this.attributes.normal.array,x=new Vector3,w=new Vector3,S=new Vector3;for(n=t*e.length*3,o=0,a=0;o<e.length;o++,a+=3)x.x=b[a+0],x.y=b[a+1],x.z=b[a+2],w.x=b[n+a+0],w.y=b[n+a+1],w.z=b[n+a+2],S.addVectors(x,w).normalize(),b[a+0]=b[n+a+0]=S.x,b[a+1]=b[n+a+1]=S.y,b[a+2]=b[n+a+2]=S.z}}function ParametricGeometry(e,t,i){Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i},this.fromBufferGeometry(new ParametricBufferGeometry(e,t,i)),this.mergeVertices()}function ParametricBufferGeometry(e,t,i){BufferGeometry.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:i};var r,n,o=[],a=[],s=[],l=[],u=new Vector3,h=new Vector3,c=new Vector3,d=new Vector3,p=new Vector3;e.length<3&&console.error("ParametricGeometry: Function must now modify a Vector3 as third parameter.");var f=t+1;for(r=0;r<=i;r++){var m=r/i;for(n=0;n<=t;n++){var v=n/t;e(v,m,h),a.push(h.x,h.y,h.z),v-1e-5>=0?(e(v-1e-5,m,c),d.subVectors(h,c)):(e(v+1e-5,m,c),d.subVectors(c,h)),m-1e-5>=0?(e(v,m-1e-5,c),p.subVectors(h,c)):(e(v,m+1e-5,c),p.subVectors(c,h)),u.crossVectors(d,p).normalize(),s.push(u.x,u.y,u.z),l.push(v,m)}}for(r=0;r<i;r++)for(n=0;n<t;n++){var g=r*f+n,y=r*f+n+1,_=(r+1)*f+n+1,b=(r+1)*f+n;o.push(g,y,b),o.push(y,_,b)}this.setIndex(o),this.addAttribute("position",new Float32BufferAttribute(a,3)),this.addAttribute("normal",new Float32BufferAttribute(s,3)),this.addAttribute("uv",new Float32BufferAttribute(l,2))}function RingGeometry(e,t,i,r,n,o){Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:o},this.fromBufferGeometry(new RingBufferGeometry(e,t,i,r,n,o)),this.mergeVertices()}function RingBufferGeometry(e,t,i,r,n,o){BufferGeometry.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:o},e=e||.5,t=t||1,n=void 0!==n?n:0,o=void 0!==o?o:2*Math.PI,i=void 0!==i?Math.max(3,i):8;var a,s,l,u=[],h=[],c=[],d=[],p=e,f=(t-e)/(r=void 0!==r?Math.max(1,r):1),m=new Vector3,v=new Vector2;for(s=0;s<=r;s++){for(l=0;l<=i;l++)a=n+l/i*o,m.x=p*Math.cos(a),m.y=p*Math.sin(a),h.push(m.x,m.y,m.z),c.push(0,0,1),v.x=(m.x/t+1)/2,v.y=(m.y/t+1)/2,d.push(v.x,v.y);p+=f}for(s=0;s<r;s++){var g=s*(i+1);for(l=0;l<i;l++){var y=a=l+g,_=a+i+1,b=a+i+2,x=a+1;u.push(y,_,x),u.push(_,b,x)}}this.setIndex(u),this.addAttribute("position",new Float32BufferAttribute(h,3)),this.addAttribute("normal",new Float32BufferAttribute(c,3)),this.addAttribute("uv",new Float32BufferAttribute(d,2))}function TetrahedronGeometry(e,t){Geometry.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new TetrahedronBufferGeometry(e,t)),this.mergeVertices()}function TetrahedronBufferGeometry(e,t){PolyhedronBufferGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function TextGeometry(e,t){Geometry.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new TextBufferGeometry(e,t)),this.mergeVertices()}function TextBufferGeometry(e,t){var i=(t=t||{}).font;if(!i||!i.isFont)return console.error("TextGeometry: font parameter is not an instance of Font."),new Geometry;var r=i.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),ExtrudeBufferGeometry.call(this,r,t),this.type="TextBufferGeometry"}function TorusKnotGeometry(e,t,i,r,n,o,a){Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:o},void 0!==a&&console.warn("TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new TorusKnotBufferGeometry(e,t,i,r,n,o)),this.mergeVertices()}function TorusKnotBufferGeometry(e,t,i,r,n,o){BufferGeometry.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:o},e=e||1,t=t||.4,i=Math.floor(i)||64,r=Math.floor(r)||8,n=n||2,o=o||3;var a,s,l=[],u=[],h=[],c=[],d=new Vector3,p=new Vector3,f=new Vector3,m=new Vector3,v=new Vector3,g=new Vector3,y=new Vector3;for(a=0;a<=i;++a){var _=a/i*n*Math.PI*2;for(C(_,n,o,e,f),C(_+.01,n,o,e,m),g.subVectors(m,f),y.addVectors(m,f),v.crossVectors(g,y),y.crossVectors(v,g),v.normalize(),y.normalize(),s=0;s<=r;++s){var b=s/r*Math.PI*2,x=-t*Math.cos(b),w=t*Math.sin(b);d.x=f.x+(x*y.x+w*v.x),d.y=f.y+(x*y.y+w*v.y),d.z=f.z+(x*y.z+w*v.z),u.push(d.x,d.y,d.z),p.subVectors(d,f).normalize(),h.push(p.x,p.y,p.z),c.push(a/i),c.push(s/r)}}for(s=1;s<=i;s++)for(a=1;a<=r;a++){var S=(r+1)*(s-1)+(a-1),M=(r+1)*s+(a-1),T=(r+1)*s+a,A=(r+1)*(s-1)+a;l.push(S,M,A),l.push(M,T,A)}function C(e,t,i,r,n){var o=Math.cos(e),a=Math.sin(e),s=i/t*e,l=Math.cos(s);n.x=r*(2+l)*.5*o,n.y=r*(2+l)*a*.5,n.z=r*Math.sin(s)*.5}this.setIndex(l),this.addAttribute("position",new Float32BufferAttribute(u,3)),this.addAttribute("normal",new Float32BufferAttribute(h,3)),this.addAttribute("uv",new Float32BufferAttribute(c,2))}function TubeGeometry(e,t,i,r,n,o){Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:n},void 0!==o&&console.warn("TubeGeometry: taper has been removed.");var a=new TubeBufferGeometry(e,t,i,r,n);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function TubeBufferGeometry(e,t,i,r,n){BufferGeometry.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:n},t=t||64,i=i||1,r=r||8,n=n||!1;var o=e.computeFrenetFrames(t,n);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var a,s,l=new Vector3,u=new Vector3,h=new Vector2,c=new Vector3,d=[],p=[],f=[],m=[];function v(n){c=e.getPointAt(n/t,c);var a=o.normals[n],h=o.binormals[n];for(s=0;s<=r;s++){var f=s/r*Math.PI*2,m=Math.sin(f),v=-Math.cos(f);u.x=v*a.x+m*h.x,u.y=v*a.y+m*h.y,u.z=v*a.z+m*h.z,u.normalize(),p.push(u.x,u.y,u.z),l.x=c.x+i*u.x,l.y=c.y+i*u.y,l.z=c.z+i*u.z,d.push(l.x,l.y,l.z)}}!function(){for(a=0;a<t;a++)v(a);v(!1===n?t:0),function(){for(a=0;a<=t;a++)for(s=0;s<=r;s++)h.x=a/t,h.y=s/r,f.push(h.x,h.y)}(),function(){for(s=1;s<=t;s++)for(a=1;a<=r;a++){var e=(r+1)*(s-1)+(a-1),i=(r+1)*s+(a-1),n=(r+1)*s+a,o=(r+1)*(s-1)+a;m.push(e,i,o),m.push(i,n,o)}}()}(),this.setIndex(m),this.addAttribute("position",new Float32BufferAttribute(d,3)),this.addAttribute("normal",new Float32BufferAttribute(p,3)),this.addAttribute("uv",new Float32BufferAttribute(f,2))}function ArrowHelper(e,t,i,r,n,o){Object3D.call(this),void 0===e&&(e=new Vector3(0,0,1)),void 0===t&&(t=new Vector3(0,0,0)),void 0===i&&(i=1),void 0===r&&(r=16776960),void 0===n&&(n=.2*i),void 0===o&&(o=.2*n),void 0===lineGeometry&&((lineGeometry=new BufferGeometry).addAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),(coneGeometry=new CylinderBufferGeometry(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Line(lineGeometry,new LineBasicMaterial({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(coneGeometry,new MeshBasicMaterial({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,n,o)}function AxesHelper(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=new BufferGeometry;i.addAttribute("position",new Float32BufferAttribute(t,3)),i.addAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var r=new LineBasicMaterial({vertexColors:VertexColors});LineSegments.call(this,i,r)}function Box3Helper(e,t){this.type="Box3Helper",this.box=e;var i=void 0!==t?t:16776960,r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new BufferGeometry;n.setIndex(new BufferAttribute(r,1)),n.addAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),LineSegments.call(this,n,new LineBasicMaterial({color:i})),this.geometry.computeBoundingSphere()}function BoxHelper(e,t){this.object=e,void 0===t&&(t=16776960);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),n=new BufferGeometry;n.setIndex(new BufferAttribute(i,1)),n.addAttribute("position",new BufferAttribute(r,3)),LineSegments.call(this,n,new LineBasicMaterial({color:t})),this.matrixAutoUpdate=!1,this.update()}function CameraHelper(e){var t=new BufferGeometry,i=new LineBasicMaterial({color:16777215,vertexColors:FaceColors}),r=[],n=[],o={},a=new Color(16755200),s=new Color(16711680),l=new Color(43775),u=new Color(16777215),h=new Color(3355443);function c(e,t,i){d(e,i),d(t,i)}function d(e,t){r.push(0,0,0),n.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(r.length/3-1)}c("n1","n2",a),c("n2","n4",a),c("n4","n3",a),c("n3","n1",a),c("f1","f2",a),c("f2","f4",a),c("f4","f3",a),c("f3","f1",a),c("n1","f1",a),c("n2","f2",a),c("n3","f3",a),c("n4","f4",a),c("p","n1",s),c("p","n2",s),c("p","n3",s),c("p","n4",s),c("u1","u2",l),c("u2","u3",l),c("u3","u1",l),c("c","t",u),c("p","c",h),c("cn1","cn2",h),c("cn3","cn4",h),c("cf1","cf2",h),c("cf3","cf4",h),t.addAttribute("position",new Float32BufferAttribute(r,3)),t.addAttribute("color",new Float32BufferAttribute(n,3)),LineSegments.call(this,t,i),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function DirectionalLightHelper(e,t,i){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===t&&(t=1);var r=new BufferGeometry;r.addAttribute("position",new Float32BufferAttribute([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var n=new LineBasicMaterial({fog:!1});this.lightPlane=new Line(r,n),this.add(this.lightPlane),(r=new BufferGeometry).addAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(r,n),this.add(this.targetLine),this.update()}function FaceNormalsHelper(e,t,i,r){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==i?i:16776960,o=void 0!==r?r:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=s.faces.length:console.warn("FaceNormalsHelper: only Geometry is supported. Use VertexNormalsHelper, instead.");var l=new BufferGeometry,u=new Float32BufferAttribute(2*a*3,3);l.addAttribute("position",u),LineSegments.call(this,l,new LineBasicMaterial({color:n,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function GridHelper(e,t,i,r){e=e||10,t=t||10,i=new Color(void 0!==i?i:4473924),r=new Color(void 0!==r?r:8947848);for(var n=t/2,o=e/t,a=e/2,s=[],l=[],u=0,h=0,c=-a;u<=t;u++,c+=o){s.push(-a,0,c,a,0,c),s.push(c,0,-a,c,0,a);var d=u===n?i:r;d.toArray(l,h),h+=3,d.toArray(l,h),h+=3,d.toArray(l,h),h+=3,d.toArray(l,h),h+=3}var p=new BufferGeometry;p.addAttribute("position",new Float32BufferAttribute(s,3)),p.addAttribute("color",new Float32BufferAttribute(l,3));var f=new LineBasicMaterial({vertexColors:VertexColors});LineSegments.call(this,p,f)}function HemisphereLightHelper(e,t,i){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;var r=new OctahedronBufferGeometry(t);r.rotateY(.5*Math.PI),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=VertexColors);var n=r.getAttribute("position"),o=new Float32Array(3*n.count);r.addAttribute("color",new BufferAttribute(o,3)),this.add(new Mesh(r,this.material)),this.update()}function PlaneHelper(e,t,i){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var r=void 0!==i?i:16776960,n=new BufferGeometry;n.addAttribute("position",new Float32BufferAttribute([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),n.computeBoundingSphere(),Line.call(this,n,new LineBasicMaterial({color:r}));var o=new BufferGeometry;o.addAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new Mesh(o,new MeshBasicMaterial({color:r,opacity:.2,transparent:!0,depthWrite:!1})))}function PointLightHelper(e,t,i){this.light=e,this.light.updateMatrixWorld(),this.color=i;var r=new SphereBufferGeometry(t,4,2),n=new MeshBasicMaterial({wireframe:!0,fog:!1});Mesh.call(this,r,n),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function PolarGridHelper(e,t,i,r,n,o){e=e||10,t=t||16,i=i||8,r=r||64,n=new Color(void 0!==n?n:4473924),o=new Color(void 0!==o?o:8947848);var a,s,l,u,h,c,d,p=[],f=[];for(u=0;u<=t;u++)l=u/t*(2*Math.PI),a=Math.sin(l)*e,s=Math.cos(l)*e,p.push(0,0,0),p.push(a,0,s),d=1&u?n:o,f.push(d.r,d.g,d.b),f.push(d.r,d.g,d.b);for(u=0;u<=i;u++)for(d=1&u?n:o,c=e-e/i*u,h=0;h<r;h++)l=h/r*(2*Math.PI),a=Math.sin(l)*c,s=Math.cos(l)*c,p.push(a,0,s),f.push(d.r,d.g,d.b),l=(h+1)/r*(2*Math.PI),a=Math.sin(l)*c,s=Math.cos(l)*c,p.push(a,0,s),f.push(d.r,d.g,d.b);var m=new BufferGeometry;m.addAttribute("position",new Float32BufferAttribute(p,3)),m.addAttribute("color",new Float32BufferAttribute(f,3));var v=new LineBasicMaterial({vertexColors:VertexColors});LineSegments.call(this,m,v)}function PositionalAudioHelper(e,t,i,r){this.audio=e,this.range=t||1,this.divisionsInnerAngle=i||16,this.divisionsOuterAngle=r||2;var n=new BufferGeometry,o=this.divisionsInnerAngle+2*this.divisionsOuterAngle,a=new Float32Array(3*(3*o+3));n.addAttribute("position",new BufferAttribute(a,3));var s=new LineBasicMaterial({color:65280}),l=new LineBasicMaterial({color:16776960});Line.call(this,n,[l,s]),this.update()}function RectAreaLightHelper(e,t){this.type="RectAreaLightHelper",this.light=e,this.color=t;var i=new BufferGeometry;i.addAttribute("position",new Float32BufferAttribute([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),i.computeBoundingSphere();var r=new LineBasicMaterial({fog:!1});Line.call(this,i,r);var n=new BufferGeometry;n.addAttribute("position",new Float32BufferAttribute([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),n.computeBoundingSphere(),this.add(new Mesh(n,new MeshBasicMaterial({side:BackSide,fog:!1}))),this.update()}function SpotLightHelper(e,t){Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var i=new BufferGeometry,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],n=0,o=1;n<32;n++,o++){var a=n/32*Math.PI*2,s=o/32*Math.PI*2;r.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}i.addAttribute("position",new Float32BufferAttribute(r,3));var l=new LineBasicMaterial({fog:!1});this.cone=new LineSegments(i,l),this.add(this.cone),this.update()}function VertexNormalsHelper(e,t,i,r){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==i?i:16711680,o=void 0!==r?r:1,a=0,s=this.object.geometry;s&&s.isGeometry?a=3*s.faces.length:s&&s.isBufferGeometry&&(a=s.attributes.normal.count);var l=new BufferGeometry,u=new Float32BufferAttribute(2*a*3,3);l.addAttribute("position",u),LineSegments.call(this,l,new LineBasicMaterial({color:n,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function RectAreaLight(e,t,i,r){Light.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==i?i:10,this.height=void 0!==r?r:10}function AnimationLoader(e){this.manager=void 0!==e?e:DefaultLoadingManager}function AudioLoader(e){this.manager=void 0!==e?e:DefaultLoadingManager}function BufferGeometryLoader(e){this.manager=void 0!==e?e:DefaultLoadingManager}LatheGeometry.prototype=Object.create(Geometry.prototype),LatheGeometry.prototype.constructor=LatheGeometry,LatheBufferGeometry.prototype=Object.create(BufferGeometry.prototype),LatheBufferGeometry.prototype.constructor=LatheBufferGeometry,ParametricGeometry.prototype=Object.create(Geometry.prototype),ParametricGeometry.prototype.constructor=ParametricGeometry,ParametricBufferGeometry.prototype=Object.create(BufferGeometry.prototype),ParametricBufferGeometry.prototype.constructor=ParametricBufferGeometry,RingGeometry.prototype=Object.create(Geometry.prototype),RingGeometry.prototype.constructor=RingGeometry,RingBufferGeometry.prototype=Object.create(BufferGeometry.prototype),RingBufferGeometry.prototype.constructor=RingBufferGeometry,TetrahedronGeometry.prototype=Object.create(Geometry.prototype),TetrahedronGeometry.prototype.constructor=TetrahedronGeometry,TetrahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),TetrahedronBufferGeometry.prototype.constructor=TetrahedronBufferGeometry,TextGeometry.prototype=Object.create(Geometry.prototype),TextGeometry.prototype.constructor=TextGeometry,TextBufferGeometry.prototype=Object.create(ExtrudeBufferGeometry.prototype),TextBufferGeometry.prototype.constructor=TextBufferGeometry,TorusKnotGeometry.prototype=Object.create(Geometry.prototype),TorusKnotGeometry.prototype.constructor=TorusKnotGeometry,TorusKnotBufferGeometry.prototype=Object.create(BufferGeometry.prototype),TorusKnotBufferGeometry.prototype.constructor=TorusKnotBufferGeometry,TubeGeometry.prototype=Object.create(Geometry.prototype),TubeGeometry.prototype.constructor=TubeGeometry,TubeBufferGeometry.prototype=Object.create(BufferGeometry.prototype),TubeBufferGeometry.prototype.constructor=TubeBufferGeometry,TubeBufferGeometry.prototype.toJSON=function(){var e=BufferGeometry.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},ArrowHelper.prototype=Object.create(Object3D.prototype),ArrowHelper.prototype.constructor=ArrowHelper,ArrowHelper.prototype.setDirection=(axis=new Vector3,function(e){e.y>.99999?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(axis.set(e.z,0,-e.x).normalize(),radians=Math.acos(e.y),this.quaternion.setFromAxisAngle(axis,radians))}),ArrowHelper.prototype.setLength=function(e,t,i){void 0===t&&(t=.2*e),void 0===i&&(i=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()},ArrowHelper.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},ArrowHelper.prototype.copy=function(e){return Object3D.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},ArrowHelper.prototype.clone=function(){return(new this.constructor).copy(this)},AxesHelper.prototype=Object.create(LineSegments.prototype),AxesHelper.prototype.constructor=AxesHelper,Box3Helper.prototype=Object.create(LineSegments.prototype),Box3Helper.prototype.constructor=Box3Helper,Box3Helper.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),Object3D.prototype.updateMatrixWorld.call(this,e))},BoxHelper.prototype=Object.create(LineSegments.prototype),BoxHelper.prototype.constructor=BoxHelper,BoxHelper.prototype.update=function(){var e=new Box3;return function(t){if(void 0!==t&&console.warn("BoxHelper: .update() has no longer arguments."),void 0!==this.object&&e.setFromObject(this.object),!e.isEmpty()){var i=e.min,r=e.max,n=this.geometry.attributes.position,o=n.array;o[0]=r.x,o[1]=r.y,o[2]=r.z,o[3]=i.x,o[4]=r.y,o[5]=r.z,o[6]=i.x,o[7]=i.y,o[8]=r.z,o[9]=r.x,o[10]=i.y,o[11]=r.z,o[12]=r.x,o[13]=r.y,o[14]=i.z,o[15]=i.x,o[16]=r.y,o[17]=i.z,o[18]=i.x,o[19]=i.y,o[20]=i.z,o[21]=r.x,o[22]=i.y,o[23]=i.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),BoxHelper.prototype.setFromObject=function(e){return this.object=e,this.update(),this},BoxHelper.prototype.copy=function(e){return LineSegments.prototype.copy.call(this,e),this.object=e.object,this},BoxHelper.prototype.clone=function(){return(new this.constructor).copy(this)},CameraHelper.prototype=Object.create(LineSegments.prototype),CameraHelper.prototype.constructor=CameraHelper,CameraHelper.prototype.update=function(){var e,t,i=new Vector3,r=new Camera;function n(n,o,a,s){i.set(o,a,s).unproject(r);var l=t[n];if(void 0!==l)for(var u=e.getAttribute("position"),h=0,c=l.length;h<c;h++)u.setXYZ(l[h],i.x,i.y,i.z)}return function(){e=this.geometry,t=this.pointMap;r.projectionMatrix.copy(this.camera.projectionMatrix),n("c",0,0,-1),n("t",0,0,1),n("n1",-1,-1,-1),n("n2",1,-1,-1),n("n3",-1,1,-1),n("n4",1,1,-1),n("f1",-1,-1,1),n("f2",1,-1,1),n("f3",-1,1,1),n("f4",1,1,1),n("u1",.7,1.1,-1),n("u2",-.7,1.1,-1),n("u3",0,2,-1),n("cf1",-1,0,1),n("cf2",1,0,1),n("cf3",0,-1,1),n("cf4",0,1,1),n("cn1",-1,0,-1),n("cn2",1,0,-1),n("cn3",0,-1,-1),n("cn4",0,1,-1),e.getAttribute("position").needsUpdate=!0}}(),DirectionalLightHelper.prototype=Object.create(Object3D.prototype),DirectionalLightHelper.prototype.constructor=DirectionalLightHelper,DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},DirectionalLightHelper.prototype.update=function(){var e=new Vector3,t=new Vector3,i=new Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),i.subVectors(t,e),this.lightPlane.lookAt(t),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(t),this.targetLine.scale.z=i.length()}}(),FaceNormalsHelper.prototype=Object.create(LineSegments.prototype),FaceNormalsHelper.prototype.constructor=FaceNormalsHelper,FaceNormalsHelper.prototype.update=function(){var e=new Vector3,t=new Vector3,i=new Matrix3;return function(){this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);for(var r=this.object.matrixWorld,n=this.geometry.attributes.position,o=this.object.geometry,a=o.vertices,s=o.faces,l=0,u=0,h=s.length;u<h;u++){var c=s[u],d=c.normal;e.copy(a[c.a]).add(a[c.b]).add(a[c.c]).divideScalar(3).applyMatrix4(r),t.copy(d).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),n.setXYZ(l,e.x,e.y,e.z),l+=1,n.setXYZ(l,t.x,t.y,t.z),l+=1}n.needsUpdate=!0}}(),GridHelper.prototype=Object.create(LineSegments.prototype),GridHelper.prototype.constructor=GridHelper,HemisphereLightHelper.prototype=Object.create(Object3D.prototype),HemisphereLightHelper.prototype.constructor=HemisphereLightHelper,HemisphereLightHelper.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},HemisphereLightHelper.prototype.update=function(){var e=new Vector3,t=new Color,i=new Color;return function(){var r=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var n=r.geometry.getAttribute("color");t.copy(this.light.color),i.copy(this.light.groundColor);for(var o=0,a=n.count;o<a;o++){var s=o<a/2?t:i;n.setXYZ(o,s.r,s.g,s.b)}n.needsUpdate=!0}r.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),PlaneHelper.prototype=Object.create(Line.prototype),PlaneHelper.prototype.constructor=PlaneHelper,PlaneHelper.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?BackSide:FrontSide,this.lookAt(this.plane.normal),Object3D.prototype.updateMatrixWorld.call(this,e)},PointLightHelper.prototype=Object.create(Mesh.prototype),PointLightHelper.prototype.constructor=PointLightHelper,PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},PointLightHelper.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},PolarGridHelper.prototype=Object.create(LineSegments.prototype),PolarGridHelper.prototype.constructor=PolarGridHelper,PositionalAudioHelper.prototype=Object.create(Line.prototype),PositionalAudioHelper.prototype.constructor=PositionalAudioHelper,PositionalAudioHelper.prototype.update=function(){var e,t,i=this.audio,r=this.range,n=this.divisionsInnerAngle,o=this.divisionsOuterAngle,a=_Math.degToRad(i.panner.coneInnerAngle),s=_Math.degToRad(i.panner.coneOuterAngle),l=a/2,u=s/2,h=0,c=0,d=this.geometry,p=d.attributes.position;function f(i,n,o,a){var s=(n-i)/o;for(p.setXYZ(h,0,0,0),c++,e=i;e<n;e+=s)t=h+c,p.setXYZ(t,Math.sin(e)*r,0,Math.cos(e)*r),p.setXYZ(t+1,Math.sin(Math.min(e+s,n))*r,0,Math.cos(Math.min(e+s,n))*r),p.setXYZ(t+2,0,0,0),c+=3;d.addGroup(h,c,a),h+=c,c=0}d.clearGroups(),f(-u,-l,o,0),f(-l,l,n,1),f(l,u,o,0),p.needsUpdate=!0,a===s&&(this.material[0].visible=!1)},PositionalAudioHelper.prototype.dispose=function(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()},RectAreaLightHelper.prototype=Object.create(Line.prototype),RectAreaLightHelper.prototype.constructor=RectAreaLightHelper,RectAreaLightHelper.prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}},RectAreaLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()},SpotLightHelper.prototype=Object.create(Object3D.prototype),SpotLightHelper.prototype.constructor=SpotLightHelper,SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},SpotLightHelper.prototype.update=function(){var e=new Vector3;return function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,i=t*Math.tan(this.light.angle);this.cone.scale.set(i,i,t),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),VertexNormalsHelper.prototype=Object.create(LineSegments.prototype),VertexNormalsHelper.prototype.constructor=VertexNormalsHelper,VertexNormalsHelper.prototype.update=function(){var e=new Vector3,t=new Vector3,i=new Matrix3;return function(){var r=["a","b","c"];this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);var n=this.object.matrixWorld,o=this.geometry.attributes.position,a=this.object.geometry;if(a&&a.isGeometry)for(var s=a.vertices,l=a.faces,u=0,h=0,c=l.length;h<c;h++)for(var d=l[h],p=0,f=d.vertexNormals.length;p<f;p++){var m=s[d[r[p]]],v=d.vertexNormals[p];e.copy(m).applyMatrix4(n),t.copy(v).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),o.setXYZ(u,e.x,e.y,e.z),u+=1,o.setXYZ(u,t.x,t.y,t.z),u+=1}else if(a&&a.isBufferGeometry){var g=a.attributes.position,y=a.attributes.normal;for(u=0,p=0,f=g.count;p<f;p++)e.set(g.getX(p),g.getY(p),g.getZ(p)).applyMatrix4(n),t.set(y.getX(p),y.getY(p),y.getZ(p)),t.applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),o.setXYZ(u,e.x,e.y,e.z),u+=1,o.setXYZ(u,t.x,t.y,t.z),u+=1}o.needsUpdate=!0}}(),RectAreaLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:RectAreaLight,isRectAreaLight:!0,copy:function(e){return Light.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=Light.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),Object.assign(AnimationLoader.prototype,{load:function(e,t,i,r){var n=this,o=new FileLoader(n.manager);o.setPath(n.path),o.load(e,function(e){t(n.parse(JSON.parse(e)))},i,r)},parse:function(e,t){for(var i=[],r=0;r<e.length;r++){var n=AnimationClip.parse(e[r]);i.push(n)}t(i)},setPath:function(e){return this.path=e,this}}),Object.assign(AudioLoader.prototype,{load:function(e,t,i,r){var n=new FileLoader(this.manager);n.setResponseType("arraybuffer"),n.setPath(this.path),n.load(e,function(e){var i=e.slice(0);AudioContext.getContext().decodeAudioData(i,function(e){t(e)})},i,r)},setPath:function(e){return this.path=e,this}}),Object.assign(BufferGeometryLoader.prototype,{load:function(e,t,i,r){var n=this,o=new FileLoader(n.manager);o.setPath(n.path),o.load(e,function(e){t(n.parse(JSON.parse(e)))},i,r)},parse:function(e){var t=new BufferGeometry,i=e.data.index;if(void 0!==i){var r=new TYPED_ARRAYS[i.type](i.array);t.setIndex(new BufferAttribute(r,1))}var n=e.data.attributes;for(var o in n){var a=n[o],s=new BufferAttribute(r=new TYPED_ARRAYS[a.type](a.array),a.itemSize,a.normalized);void 0!==a.name&&(s.name=a.name),t.addAttribute(o,s)}var l=e.data.morphAttributes;if(l)for(var o in l){for(var u=l[o],h=[],c=0,d=u.length;c<d;c++){a=u[c],s=new BufferAttribute(r=new TYPED_ARRAYS[a.type](a.array),a.itemSize,a.normalized);void 0!==a.name&&(s.name=a.name),h.push(s)}t.morphAttributes[o]=h}var p=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==p){c=0;for(var f=p.length;c!==f;++c){var m=p[c];t.addGroup(m.start,m.count,m.materialIndex)}}var v=e.data.boundingSphere;if(void 0!==v){var g=new Vector3;void 0!==v.center&&g.fromArray(v.center),t.boundingSphere=new Sphere(g,v.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t},setPath:function(e){return this.path=e,this}});var TYPED_ARRAYS={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array},matrixPosition;function CubeTextureLoader(e){this.manager=void 0!==e?e:DefaultLoadingManager}function FontLoader(e){this.manager=void 0!==e?e:DefaultLoadingManager}function ImageBitmapLoader(e){"undefined"==typeof createImageBitmap&&console.warn("ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==e?e:DefaultLoadingManager,this.options=void 0}function LOD(){Object3D.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function Fog(e,t,i){this.name="",this.color=new Color(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3}function FogExp2(e,t){this.name="",this.color=new Color(e),this.density=void 0!==t?t:25e-5}Object.assign(CubeTextureLoader.prototype,{crossOrigin:"anonymous",load:function(e,t,i,r){var n=new CubeTexture,o=new ImageLoader(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function s(i){o.load(e[i],function(e){n.images[i]=e,6===++a&&(n.needsUpdate=!0,t&&t(n))},void 0,r)}for(var l=0;l<e.length;++l)s(l);return n},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(FontLoader.prototype,{load:function(e,t,i,r){var n=this,o=new FileLoader(this.manager);o.setPath(this.path),o.load(e,function(e){var i;try{i=JSON.parse(e)}catch(t){console.warn("FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(e.substring(65,e.length-2))}var r=n.parse(i);t&&t(r)},i,r)},parse:function(e){return new Font(e)},setPath:function(e){return this.path=e,this}}),ImageBitmapLoader.prototype={constructor:ImageBitmapLoader,setOptions:function(e){return this.options=e,this},load:function(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,o=Cache.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout(function(){t&&t(o),n.manager.itemEnd(e)},0),o;fetch(e).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,n.options)}).then(function(i){Cache.add(e,i),t&&t(i),n.manager.itemEnd(e)}).catch(function(t){r&&r(t),n.manager.itemError(e),n.manager.itemEnd(e)}),n.manager.itemStart(e)},setCrossOrigin:function(){return this},setPath:function(e){return this.path=e,this}},LOD.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LOD,copy:function(e){Object3D.prototype.copy.call(this,e,!1);for(var t=e.levels,i=0,r=t.length;i<r;i++){var n=t[i];this.addLevel(n.object.clone(),n.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var i=this.levels,r=0;r<i.length&&!(t<i[r].distance);r++);i.splice(r,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,i=1,r=t.length;i<r&&!(e<t[i].distance);i++);return t[i-1].object},raycast:(matrixPosition=new Vector3,function(e,t){matrixPosition.setFromMatrixPosition(this.matrixWorld);var i=e.ray.origin.distanceTo(matrixPosition);this.getObjectForDistance(i).raycast(e,t)}),update:function(){var e=new Vector3,t=new Vector3;return function(i){var r=this.levels;if(r.length>1){e.setFromMatrixPosition(i.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var n=e.distanceTo(t);r[0].object.visible=!0;for(var o=1,a=r.length;o<a&&n>=r[o].distance;o++)r[o-1].object.visible=!1,r[o].object.visible=!0;for(;o<a;o++)r[o].object.visible=!1}}}(),toJSON:function(e){var t=Object3D.prototype.toJSON.call(this,e);t.object.levels=[];for(var i=this.levels,r=0,n=i.length;r<n;r++){var o=i[r];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),Object.assign(Fog.prototype,{isFog:!0,clone:function(){return new Fog(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.assign(FogExp2.prototype,{isFogExp2:!0,clone:function(){return new FogExp2(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}});var Geometries={WireframeGeometry:WireframeGeometry,TetrahedronGeometry:TetrahedronGeometry,TetrahedronBufferGeometry:TetrahedronBufferGeometry,OctahedronGeometry:OctahedronGeometry,OctahedronBufferGeometry:OctahedronBufferGeometry,IcosahedronGeometry:IcosahedronGeometry,IcosahedronBufferGeometry:IcosahedronBufferGeometry,DodecahedronGeometry:DodecahedronGeometry,DodecahedronBufferGeometry:DodecahedronBufferGeometry,PolyhedronGeometry:PolyhedronGeometry,PolyhedronBufferGeometry:PolyhedronBufferGeometry,TubeGeometry:TubeGeometry,TubeBufferGeometry:TubeBufferGeometry,TorusKnotGeometry:TorusKnotGeometry,TorusGeometry:TorusGeometry,TorusBufferGeometry:TorusBufferGeometry,TextGeometry:TextGeometry,TextBufferGeometry:TextBufferGeometry,SphereGeometry:SphereGeometry,SphereBufferGeometry:SphereBufferGeometry,RingGeometry:RingGeometry,RingBufferGeometry:RingBufferGeometry,PlaneGeometry:PlaneGeometry,PlaneBufferGeometry:PlaneBufferGeometry,LatheGeometry:LatheGeometry,LatheBufferGeometry:LatheBufferGeometry,ShapeGeometry:ShapeGeometry,ShapeBufferGeometry:ShapeBufferGeometry,ExtrudeGeometry:ExtrudeGeometry,ExtrudeBufferGeometry:ExtrudeBufferGeometry,EdgesGeometry:EdgesGeometry,ConeGeometry:ConeGeometry,ConeBufferGeometry:ConeBufferGeometry,CylinderGeometry:CylinderGeometry,CylinderBufferGeometry:CylinderBufferGeometry,CircleGeometry:CircleGeometry,CircleBufferGeometry:CircleBufferGeometry,BoxGeometry:BoxGeometry,BoxBufferGeometry:BoxBufferGeometry};function ObjectLoader(e){this.manager=void 0!==e?e:DefaultLoadingManager,this.resourcePath=""}Object.assign(ObjectLoader.prototype,{crossOrigin:"anonymous",load:function(e,t,i,r){var n=this,o=void 0===this.path?LoaderUtils.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;var a=new FileLoader(n.manager);a.setPath(this.path),a.load(e,function(i){var o=null;try{o=JSON.parse(i)}catch(t){return void 0!==r&&r(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?n.parse(o,t):console.error("ObjectLoader: Can't load "+e)},i,r)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){var i=this.parseShape(e.shapes),r=this.parseGeometries(e.geometries,i),n=this.parseImages(e.images,function(){void 0!==t&&t(s)}),o=this.parseTextures(e.textures,n),a=this.parseMaterials(e.materials,o),s=this.parseObject(e.object,r,a);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var i=0,r=e.length;i<r;i++){var n=(new Shape).fromJSON(e[i]);t[n.uuid]=n}return t},parseGeometries:function(e,t){var i={};if(void 0!==e)for(var r=new BufferGeometryLoader,n=0,o=e.length;n<o;n++){var a,s=e[n];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new Geometries[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new Geometries[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new Geometries[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new Geometries[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new Geometries[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new Geometries[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new Geometries[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new Geometries[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new Geometries[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new Geometries[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":a=new Geometries[s.type]((new Curves[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":a=new Geometries[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new Geometries[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var l=[],u=0,h=s.shapes.length;u<h;u++){var c=t[s.shapes[u]];l.push(c)}a=new Geometries[s.type](l,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(l=[],u=0,h=s.shapes.length;u<h;u++){c=t[s.shapes[u]];l.push(c)}var d=s.options.extrudePath;void 0!==d&&(s.options.extrudePath=(new Curves[d.type]).fromJSON(d)),a=new Geometries[s.type](l,s.options);break;case"BufferGeometry":a=r.parse(s);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE)a=(new LegacyJSONLoader).parse(s,this.resourcePath).geometry;else console.error('ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),!0===a.isBufferGeometry&&void 0!==s.userData&&(a.userData=s.userData),i[s.uuid]=a}return i},parseMaterials:function(e,t){var i={},r={};if(void 0!==e){var n=new MaterialLoader;n.setTextures(t);for(var o=0,a=e.length;o<a;o++){var s=e[o];if("MultiMaterial"===s.type){for(var l=[],u=0;u<s.materials.length;u++){var h=s.materials[u];void 0===i[h.uuid]&&(i[h.uuid]=n.parse(h)),l.push(i[h.uuid])}r[s.uuid]=l}else void 0===i[s.uuid]&&(i[s.uuid]=n.parse(s)),r[s.uuid]=i[s.uuid]}}return r},parseAnimations:function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i],n=AnimationClip.parse(r);void 0!==r.uuid&&(n.uuid=r.uuid),t.push(n)}return t},parseImages:function(e,t){var i=this,r={};function n(e){return i.manager.itemStart(e),o.load(e,function(){i.manager.itemEnd(e)},void 0,function(){i.manager.itemError(e),i.manager.itemEnd(e)})}if(void 0!==e&&e.length>0){var o=new ImageLoader(new LoadingManager(t));o.setCrossOrigin(this.crossOrigin);for(var a=0,s=e.length;a<s;a++){var l=e[a],u=l.url;if(Array.isArray(u)){r[l.uuid]=[];for(var h=0,c=u.length;h<c;h++){var d=u[h],p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d)?d:i.resourcePath+d;r[l.uuid].push(n(p))}}else{p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:i.resourcePath+l.url;r[l.uuid]=n(p)}}}return r},parseTextures:function(e,t){function i(e,t){return"number"==typeof e?e:(console.warn("ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var r={};if(void 0!==e)for(var n=0,o=e.length;n<o;n++){var a,s=e[n];void 0===s.image&&console.warn('ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("ObjectLoader: Undefined image",s.image),(a=Array.isArray(t[s.image])?new CubeTexture(t[s.image]):new Texture(t[s.image])).needsUpdate=!0,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=i(s.mapping,TEXTURE_MAPPING)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=i(s.wrap[0],TEXTURE_WRAPPING),a.wrapT=i(s.wrap[1],TEXTURE_WRAPPING)),void 0!==s.format&&(a.format=s.format),void 0!==s.type&&(a.type=s.type),void 0!==s.encoding&&(a.encoding=s.encoding),void 0!==s.minFilter&&(a.minFilter=i(s.minFilter,TEXTURE_FILTER)),void 0!==s.magFilter&&(a.magFilter=i(s.magFilter,TEXTURE_FILTER)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(a.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(a.unpackAlignment=s.unpackAlignment),r[s.uuid]=a}return r},parseObject:function(e,t,i){var r;function n(e){return void 0===t[e]&&console.warn("ObjectLoader: Undefined geometry",e),t[e]}function o(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],r=0,n=e.length;r<n;r++){var o=e[r];void 0===i[o]&&console.warn("ObjectLoader: Undefined material",o),t.push(i[o])}return t}return void 0===i[e]&&console.warn("ObjectLoader: Undefined material",e),i[e]}}switch(e.type){case"Scene":r=new Scene,void 0!==e.background&&Number.isInteger(e.background)&&(r.background=new Color(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?r.fog=new Fog(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(r.fog=new FogExp2(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":r=new PerspectiveCamera(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(r.focus=e.focus),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.filmGauge&&(r.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(r.filmOffset=e.filmOffset),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new AmbientLight(e.color,e.intensity);break;case"DirectionalLight":r=new DirectionalLight(e.color,e.intensity);break;case"PointLight":r=new PointLight(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new RectAreaLight(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new SpotLight(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new HemisphereLight(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var a=n(e.geometry),s=o(e.material);r=a.bones&&a.bones.length>0?new SkinnedMesh(a,s):new Mesh(a,s),void 0!==e.drawMode&&r.setDrawMode(e.drawMode);break;case"LOD":r=new LOD;break;case"Line":r=new Line(n(e.geometry),o(e.material),e.mode);break;case"LineLoop":r=new LineLoop(n(e.geometry),o(e.material));break;case"LineSegments":r=new LineSegments(n(e.geometry),o(e.material));break;case"PointCloud":case"Points":r=new Points(n(e.geometry),o(e.material));break;case"Sprite":r=new Sprite(o(e.material));break;case"Group":r=new Group;break;default:r=new Object3D}if(r.uuid=e.uuid,void 0!==e.name&&(r.name=e.name),void 0!==e.matrix?(r.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==e.position&&r.position.fromArray(e.position),void 0!==e.rotation&&r.rotation.fromArray(e.rotation),void 0!==e.quaternion&&r.quaternion.fromArray(e.quaternion),void 0!==e.scale&&r.scale.fromArray(e.scale)),void 0!==e.castShadow&&(r.castShadow=e.castShadow),void 0!==e.receiveShadow&&(r.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(r.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(r.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&r.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(r.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.frustumCulled&&(r.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(r.renderOrder=e.renderOrder),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.layers&&(r.layers.mask=e.layers),void 0!==e.children)for(var l=e.children,u=0;u<l.length;u++)r.add(this.parseObject(l[u],t,i));if("LOD"===e.type)for(var h=e.levels,c=0;c<h.length;c++){var d=h[c],p=r.getObjectByProperty("uuid",d.object);void 0!==p&&r.addLevel(p,d.distance)}return r}});var TEXTURE_MAPPING={UVMapping:UVMapping,CubeReflectionMapping:CubeReflectionMapping,CubeRefractionMapping:CubeRefractionMapping,EquirectangularReflectionMapping:EquirectangularReflectionMapping,EquirectangularRefractionMapping:EquirectangularRefractionMapping,SphericalReflectionMapping:SphericalReflectionMapping,CubeUVReflectionMapping:CubeUVReflectionMapping,CubeUVRefractionMapping:CubeUVRefractionMapping},TEXTURE_WRAPPING={RepeatWrapping:RepeatWrapping,ClampToEdgeWrapping:ClampToEdgeWrapping,MirroredRepeatWrapping:MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter:NearestFilter,NearestMipMapNearestFilter:NearestMipMapNearestFilter,NearestMipMapLinearFilter:NearestMipMapLinearFilter,LinearFilter:LinearFilter,LinearMipMapNearestFilter:LinearMipMapNearestFilter,LinearMipMapLinearFilter:LinearMipMapLinearFilter};function MeshMatcapMaterial(e){Material$1.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.lights=!1,this.setValues(e)}function Cylindrical(e,t,i){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==i?i:0,this}function WebGL2Renderer(e){console.log("WebGL2Renderer",REVISION);var t,i=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=void 0!==e.context?e.context:null,n=void 0!==e.alpha&&e.alpha,o=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,s=void 0!==e.antialias&&e.antialias,l=void 0===e.premultipliedAlpha||e.premultipliedAlpha,u=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,h=void 0!==e.powerPreference?e.powerPreference:"default";try{var c={alpha:n,depth:o,stencil:a,antialias:s,premultipliedAlpha:l,preserveDrawingBuffer:u,powerPreference:h};if(i.addEventListener("webglcontextlost",function(e){e.preventDefault()},!1),i.addEventListener("webglcontextrestored",function(){}),null===(t=r||i.getContext("webgl2",c)))throw null!==i.getContext("webgl2")?new Error("Error creating WebGL2 context with your selected attributes."):new Error("Error creating WebGL2 context.")}catch(e){console.error("WebGL2Renderer: "+e.message)}var d=!0,p=!0,f=!0,m=new Color(0),v=0,g=i.width,y=i.height,_=1,b=new Vector4(0,0,g,y),x=new WebGLExtensions(t),w=new WebGLState(t,x,function(){});function S(e,t,r){g=e,y=t,i.width=e*_,i.height=t*_,!1!==r&&(i.style.width=e+"px",i.style.height=t+"px"),function(e,t,i,r){w.viewport(b.set(e,t,i,r))}(0,0,e,t)}return{domElement:i,clear:function(e,i,r){var n=0;(void 0===e||e)&&(n|=t.COLOR_BUFFER_BIT),(void 0===i||i)&&(n|=t.DEPTH_BUFFER_BIT),(void 0===r||r)&&(n|=t.STENCIL_BUFFER_BIT),t.clear(n)},setPixelRatio:function(e){void 0!==e&&(_=e,S(b.z,b.w,!1))},setSize:S,render:function(e,t){if(void 0===t||!0===t.isCamera){var i=e.background;null===i?w.buffers.color.setClear(m.r,m.g,m.b,v,l):i&&i.isColor&&w.buffers.color.setClear(i.r,i.g,i.b,1,l),this.clear(d,p,f)}else console.error("WebGL2Renderer.render: camera is not an instance of Camera.")}}}function WebGLMultisampleRenderTarget(e,t,i){WebGLRenderTarget.call(this,e,t,i),this.samples=4}function VideoTexture(e,t,i,r,n,o,a,s,l){Texture.call(this,e,t,i,r,n,o,a,s,l),this.format=void 0!==a?a:RGBFormat,this.minFilter=void 0!==o?o:LinearFilter,this.magFilter=void 0!==n?n:LinearFilter,this.generateMipmaps=!1}MeshMatcapMaterial.prototype=Object.create(Material$1.prototype),MeshMatcapMaterial.prototype.constructor=MeshMatcapMaterial,MeshMatcapMaterial.prototype.isMeshMatcapMaterial=!0,MeshMatcapMaterial.prototype.copy=function(e){return Material$1.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Object.assign(Cylindrical.prototype,{set:function(e,t,i){return this.radius=e,this.theta=t,this.y=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}}),WebGLMultisampleRenderTarget.prototype=Object.assign(Object.create(WebGLRenderTarget.prototype),{constructor:WebGLMultisampleRenderTarget,isWebGLMultisampleRenderTarget:!0,copy:function(e){return WebGLRenderTarget.prototype.copy.call(this,e),this.samples=e.samples,this}}),VideoTexture.prototype=Object.assign(Object.create(Texture.prototype),{constructor:VideoTexture,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}})}]);